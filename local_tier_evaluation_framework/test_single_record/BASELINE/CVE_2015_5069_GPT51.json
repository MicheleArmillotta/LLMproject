[
  {
    "file_path": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
    "id": [
      "get_wml_location",
      "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_1/code_before.cpp",
      "993-1052"
    ],
    "function_name": "get_wml_location",
    "contextual_snippet": "MAIN FUNCTION:\n#include <CoreFoundation/CFBase.h>\n#include <CoreFoundation/CFString.h>\n#include <CoreFoundation/CoreFoundation.h>\n#include <boost/foreach.hpp>\n#include \"version.hpp\"\n#include \"serialization/unicode.hpp\"\n#include \"serialization/string_utils.hpp\"\n#include \"scoped_resource.hpp\"\n#include \"log.hpp\"\n#include \"game_preferences.hpp\"\n#include \"game_config.hpp\"\n#include \"filesystem.hpp\"\n#include \"config.hpp\"\n#include <cstring>\n#include <boost/algorithm/string.hpp>\n#include <set>\n#include <iomanip>\n#include <fstream>\n#include <cerrno>\n#include <libgen.h>\n#include <dirent.h>\n#include <unistd.h>\n#include <cctype>\n#include \"filesystem_win32.ii\"\n#include <sys/stat.h>\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nstd::string get_wml_location(const std::string &filename, const std::string &current_dir)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\" << std::endl;\n\n\tassert(game_config::path.empty() == false);\n\n\tstd::string result;\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename\" << std::endl;\n\t\treturn result;\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\" << std::endl;\n\t\treturn result;\n\t}\n\n\tbool already_found = false;\n\n\tif (filename[0] == '~')\n\t{\n\t\t// If the filename starts with '~', look in the user data directory.\n\t\tresult = get_user_data_dir() + \"/data/\" + filename.substr(1);\n\t\tDBG_FS << \"  trying '\" << result << \"'\" << std::endl;\n\n\t\talready_found = file_exists(result) || is_directory(result);\n\t}\n\telse if (filename.size() >= 2 && filename[0] == '.' && filename[1] == '/')\n\t{\n\t\t// If the filename begins with a \"./\", look in the same directory\n\t\t// as the file currently being preprocessed.\n\n\t\tif (!current_dir.empty())\n\t\t{\n\t\t\tresult = current_dir;\n\t\t}\n\t\telse\n\t\t{\n\t\t\tresult = game_config::path;\n\t\t}\n\n\t\tresult += filename.substr(2);\n\t}\n\telse if (!game_config::path.empty())\n\t\tresult = game_config::path + \"/data/\" + filename;\n\n\tDBG_FS << \"  trying '\" << result << \"'\" << std::endl;\n\n\tif (result.empty() ||\n\t    (!already_found && !file_exists(result) && !is_directory(result)))\n\t{\n\t\tDBG_FS << \"  not found\" << std::endl;\n\t\tresult.clear();\n\t}\n\telse\n\t\tDBG_FS << \"  found: '\" << result << \"'\" << std::endl;\n\n\treturn result;\n}\n\n-------- CONTEXTUAL INFORMATIONS - CALLEES CODE --------\n-------- Code of the functions used by the analyzed function -------- \n\n\nCallee: is_directory\nbool is_directory(const std::string& fname)\n{\n\tif(fname.empty()) {\n\t\treturn false;\n\t}\n\tif(fname[0] != '/' && !game_config::path.empty()) {\n\t\tif(is_directory_internal(game_config::path + \"/\" + fname))\n\t\t\treturn true;\n\t}\n\n\treturn is_directory_internal(fname);\n}\n\nCallee: file_exists\nbool file_exists(const std::string& name)\n{\n#ifdef _WIN32\n       struct stat st;\n       return (::stat(name.c_str(), &st) == 0);\n#else\n\tstruct stat st;\n\treturn (::stat(name.c_str(), &st) != -1);\n#endif\n}\n\nCallee: get_user_data_dir\nstd::string get_user_data_dir()\n{\n\t// ensure setup gets called only once per session\n\t// FIXME: this is okay and optimized, but how should we react\n\t// if the user deletes a dir while we are running?\n\tif (user_data_dir.empty())\n\t{\n\t\tset_user_data_dir(std::string());\n\t}\n\treturn user_data_dir;\n}\n",
    "Vulnerable": true,
    "Description": "The function get_wml_location() logs full filesystem paths (including paths under the user data directory and game_config::path) to the log streams DBG_FS, LOG_FS, and ERR_FS. These logs can include internal directory structures and user-specific paths. If logs are accessible to untrusted users or exposed in error reports, this constitutes an information exposure (CWE-200). The function also logs when illegal paths containing \"..\" are used, revealing validation behavior and the exact rejected input. While the returned value is just a path string to a resource (expected behavior), the detailed logging of file locations and errors can leak sensitive filesystem information if not properly access-controlled."
  },
  {
    "file_path": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
    "id": [
      "is_legal_file",
      "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-5069/snippet_2/code_before.cpp",
      "989-1004"
    ],
    "function_name": "is_legal_file",
    "contextual_snippet": "MAIN FUNCTION:\n#include \"version.hpp\"\n#include \"util.hpp\"\n#include \"log.hpp\"\n#include \"game_config.hpp\"\n#include \"config.hpp\"\n#include <windows.h>\n#include <boost/locale.hpp>\n#include <set>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/device/file_descriptor.hpp>\n#include <boost/system/windows_error.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"serialization/unicode.hpp\"\n#include \"filesystem.hpp\"\n#include \"global.hpp\"\n\n#define ERR_FS LOG_STREAM(err, log_filesystem)\n#define LOG_FS LOG_STREAM(info, log_filesystem)\n#define DBG_FS LOG_STREAM(debug, log_filesystem)\n\nstatic bool is_legal_file(const std::string &filename)\n{\n\tDBG_FS << \"Looking for '\" << filename << \"'.\\n\";\n\n\tif (filename.empty()) {\n\t\tLOG_FS << \"  invalid filename\\n\";\n\t\treturn false;\n\t}\n\n\tif (filename.find(\"..\") != std::string::npos) {\n\t\tERR_FS << \"Illegal path '\" << filename << \"' (\\\"..\\\" not allowed).\\n\";\n\t\treturn false;\n\t}\n\n\treturn true;\n}\n\n-------- CONTEXTUAL INFORMATIONS - CALLEES CODE --------\n-------- Code of the functions used by the analyzed function -------- \n\n",
    "Vulnerable": true,
    "Description": "The function logs full filenames, including potentially sensitive paths, to different log streams (info, error, debug). These logs may reveal filesystem layout, internal directory names, validation rules (e.g., \"..\" not allowed), and other operational details (CWE-200: Information Exposure). If an attacker can access these logs or influence the filename input, they can learn about internal paths, validation behavior, and possibly user-specific or configuration-related file locations. No access control or redaction is visible in the provided code, so the function is considered vulnerable to information exposure via logging."
  }
]