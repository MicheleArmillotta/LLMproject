[
  {
    "file_path": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
    "id": [
      "ntlm_fetch_string",
      "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2019-12529/repo/lib/ntlmauth/ntlmauth.cc",
      "96-145"
    ],
    "function_name": "ntlm_fetch_string",
    "contextual_snippet": "MAIN FUNCTION:\n#include \"util.h\"       /* for base64-related stuff */\n#include \"ntlmauth/ntlmauth.h\"\n#include <strings.h>\n#include <random>\n#include <cstring>\n#include \"squid.h\"\n\nlstring\nntlm_fetch_string(const ntlmhdr *packet, const int32_t packet_size, const strhdr * str, const uint32_t flags)\n{\n    static char buf[NTLM_MAX_FIELD_LENGTH];\n    lstring rv;\n    char *d;\n\n    rv.str = NULL;\n    rv.l = -1;\n\n    int16_t l = le16toh(str->len);\n    int32_t o = le32toh(str->offset);\n    // debug(\"ntlm_fetch_string(plength=%d,l=%d,o=%d)\\n\",packet_size,l,o);\n\n    if (l < 0 || l > NTLM_MAX_FIELD_LENGTH || o + l > packet_size || o == 0) {\n        debug(\"ntlm_fetch_string: insane data (pkt-sz: %d, fetch len: %d, offset: %d)\\n\", packet_size,l,o);\n        return rv;\n    }\n    rv.str = (char *)packet + o;\n    rv.l = 0;\n    if ((flags & NTLM_NEGOTIATE_ASCII) == 0) {\n        /* UNICODE string */\n        unsigned short *s = (unsigned short *)rv.str;\n        rv.str = d = buf;\n\n        for (uint32_t len = (l>>1); len; ++s, --len) {\n            uint16_t c = le16toh(*s);\n            if (c > 254 || c == '\\0') {\n                fprintf(stderr, \"ntlmssp: bad unicode: %04x\\n\", c);\n                return rv;\n            }\n            *d = static_cast<char>(c&0xFF);\n            ++d;\n            ++rv.l;\n        }\n    } else {\n        /* ASCII/OEM string */\n        char *sc = rv.str;\n\n        for (; l>=0; ++sc, --l) {\n            if (*sc == '\\0' || !xisprint(*sc)) {\n                fprintf(stderr, \"ntlmssp: bad ascii: %04x\\n\", *sc);\n                return rv;\n            }\n            ++rv.l;\n        }\n    }\n\n    return rv;\n}\n\n-------- CONTEXTUAL INFORMATIONS - CALLEES CODE --------\n-------- Code of the functions used by the analyzed function -------- \n\n",
    "Vulnerable": true,
    "Description": "The function may expose sensitive information through detailed error messages. When encountering invalid Unicode or ASCII data in an NTLM packet, it prints messages to stderr that include the exact invalid character value (e.g., `ntlmssp: bad unicode: %04x` and `ntlmssp: bad ascii: %04x`). Since this function processes NTLM authentication packets, these characters can be part of user credentials or other authentication-related fields. Emitting such low-level parsing details and raw character values to a potentially unprotected log or stderr can leak internal protocol state and possibly fragments of user-supplied or credential-related data to unauthorized observers, constituting an information exposure (CWE-200)."
  }
]