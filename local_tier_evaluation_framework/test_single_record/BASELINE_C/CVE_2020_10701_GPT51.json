[
  {
    "file_path": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
    "id": [
      "virDomainAgentSetResponseTimeout",
      "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
      "12564-12590"
    ],
    "function_name": "virDomainAgentSetResponseTimeout",
    "contextual_snippet": "MAIN FUNCTION:\n#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nint\nvirDomainAgentSetResponseTimeout(virDomainPtr domain,\n                                 int timeout,\n                                 unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"timeout=%i, flags=0x%x\",\n                     timeout, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    conn = domain->conn;\n\n    if (conn->driver->domainAgentSetResponseTimeout) {\n        if (conn->driver->domainAgentSetResponseTimeout(domain, timeout, flags) < 0)\n            goto error;\n        return 0;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(conn);\n    return -1;\n}\n\n-------- CONTEXTUAL INFORMATIONS - CALLEES CODE --------\n-------- Code of the functions used by the analyzed function -------- \n\n\nCallee: virDispatchError\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}\n\nCallee: virResetLastError\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}\n",
    "Vulnerable": true,
    "Description": "The function virDomainAgentSetResponseTimeout performs a potentially sensitive operation (changing the VM/guest agent response timeout) purely based on a virDomainPtr and flags, then directly forwards the request to conn->driver->domainAgentSetResponseTimeout without doing any access-control or authorization checks. There is no validation of the callerâ€™s identity, role, or permissions, nor any restriction on what flags/timeout values are allowed. If this function is exposed via a public API and the underlying driver does not enforce access control itself, an unprivileged caller that obtains a virDomainPtr could modify agent behavior for that domain, which constitutes improper access control (CWE-284). The code relies entirely on external/driver-side checks that are not visible here, so from the perspective of this function alone, access control is missing/insufficient for the operation it performs."
  }
]