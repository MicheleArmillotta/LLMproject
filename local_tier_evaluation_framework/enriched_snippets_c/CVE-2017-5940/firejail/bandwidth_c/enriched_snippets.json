[
  {
    "function_name": "bandwidth_pid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "329-463",
    "snippet": "void bandwidth_pid(pid_t pid, const char *command, const char *dev, int down, int up) {\n\tEUID_ASSERT();\n\t//************************\n\t// verify sandbox\n\t//************************\n\tEUID_ROOT();\n\tchar *comm = pid_proc_comm(pid);\n\tEUID_USER();\n\tif (!comm) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox\\n\");\n\t\texit(1);\n\t}\n\n\t// check for firejail sandbox\n\tif (strcmp(comm, \"firejail\") != 0) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox\\n\");\n\t\texit(1);\n\t}\n\tfree(comm);\n\t\n\t// check network namespace\n\tchar *name;\n\tif (asprintf(&name, \"/run/firejail/network/%d-netmap\", pid) == -1)\n\t\terrExit(\"asprintf\");\n\tstruct stat s;\n\tif (stat(name, &s) == -1) {\n\t\tfprintf(stderr, \"Error: the sandbox doesn't use a new network namespace\\n\");\n\t\texit(1);\n\t}\n\n\t//************************\n\t// join the network namespace\n\t//************************\n\tpid_t child;\n\tif (find_child(pid, &child) == -1) {\n\t\tfprintf(stderr, \"Error: cannot join the network namespace\\n\");\n\t\texit(1);\n\t}\n\n\tEUID_ROOT();\n\tif (join_namespace(child, \"net\")) {\n\t\tfprintf(stderr, \"Error: cannot join the network namespace\\n\");\n\t\texit(1);\n\t}\n\n\t// set run file\n\tif (strcmp(command, \"set\") == 0)\n\t\tbandwidth_set(pid, dev, down, up);\n\telse if (strcmp(command, \"clear\") == 0)\n\t\tbandwidth_remove(pid, dev);\n\n\t//************************\n\t// build command\n\t//************************\n\tchar *devname = NULL;\n\tif (dev) {\n\t\t// read network map file\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n\t\t\tfprintf(stderr, \"Error: cannot read network map file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\t\n\t\tchar buf[1024];\n\t\tint len = strlen(dev);\n\t\twhile (fgets(buf, 1024, fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (*buf == '\\0')\n\t\t\t\tbreak;\n\n\t\t\tif (strncmp(buf, dev, len) == 0  && buf[len] == ':') {\n\t\t\t\tdevname = strdup(buf + len + 1);\n\t\t\t\tif (!devname)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\t// check device in namespace\n\t\t\t\tif (if_nametoindex(devname) == 0) {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot find network device %s\\n\", devname);\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfree(fname);\n\t\tfclose(fp);\n\t}\n\t\n\t// build fshaper.sh command\n\tchar *cmd = NULL;\n\tif (devname) {\n\t\tif (strcmp(command, \"set\") == 0) {\n\t\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s %s %d %d\",\n\t\t\t\tLIBDIR, command, devname, down, up) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t}\n\t\telse {\n\t\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s %s\",\n\t\t\t\tLIBDIR, command, devname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t}\n\t}\n\telse {\n\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s\", LIBDIR, command) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\tassert(cmd);\n\n\t// wipe out environment variables\n\tenviron = NULL;\n\n\t//************************\n\t// build command\n\t//************************\n\t// elevate privileges\n\tif (setreuid(0, 0))\n\t\terrExit(\"setreuid\");\n\tif (setregid(0, 0))\n\t\terrExit(\"setregid\");\n\n\tchar *arg[4];\n\targ[0] = \"/bin/sh\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\tclearenv();\n\texecvp(arg[0], arg);\n\t\n\t// it will never get here\n\terrExit(\"execvp\");\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"execvp\""
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "execvp",
          "args": [
            "arg[0]",
            "arg"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clearenv",
          "args": [],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setregid\""
          ],
          "line": 451
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setregid",
          "args": [
            "0",
            "0"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setreuid\""
          ],
          "line": 449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setreuid",
          "args": [
            "0",
            "0"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "cmd"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&cmd",
            "\"%s/firejail/fshaper.sh --%s\"",
            "LIBDIR",
            "command"
          ],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 432
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&cmd",
            "\"%s/firejail/fshaper.sh --%s %s\"",
            "LIBDIR",
            "command",
            "devname"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&cmd",
            "\"%s/firejail/fshaper.sh --%s %s %d %d\"",
            "LIBDIR",
            "command",
            "devname",
            "down",
            "up"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "command",
            "\"set\""
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 412
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot find network device %s\\n\"",
            "devname"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "if_nametoindex",
          "args": [
            "devname"
          ],
          "line": 410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "buf + len + 1"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "buf",
            "dev",
            "len"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "buf",
            "'\\n'"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "1024",
            "fp"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "dev"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read network map file %s\\n\"",
            "fname"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"r\""
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d-netmap\"",
            "RUN_FIREJAIL_NETWORK_DIR",
            "(int) pid"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bandwidth_remove",
          "args": [
            "pid",
            "dev"
          ],
          "line": 378
        },
        "resolved": true,
        "details": {
          "function_name": "bandwidth_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "257-274",
          "snippet": "void bandwidth_remove(pid_t pid, const char *dev) {\n\tbandwidth_create_run_file(pid);\n\t\n\t// read bandwidth file\n\tread_bandwidth_file(pid);\n\t\n\t// find the element and remove it\n\tIFBW *elem = ifbw_find(dev);\n\tif (elem) {\n\t\tifbw_remove(elem);\n\t\twrite_bandwidth_file(pid) ;\n\t}\n\t\n\t// remove the file if there are no entries in the list\n\tif (ifbw == NULL) {\n\t\t bandwidth_del_run_file(pid);\n\t}\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nvoid bandwidth_remove(pid_t pid, const char *dev) {\n\tbandwidth_create_run_file(pid);\n\t\n\t// read bandwidth file\n\tread_bandwidth_file(pid);\n\t\n\t// find the element and remove it\n\tIFBW *elem = ifbw_find(dev);\n\tif (elem) {\n\t\tifbw_remove(elem);\n\t\twrite_bandwidth_file(pid) ;\n\t}\n\t\n\t// remove the file if there are no entries in the list\n\tif (ifbw == NULL) {\n\t\t bandwidth_del_run_file(pid);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "command",
            "\"clear\""
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bandwidth_set",
          "args": [
            "pid",
            "dev",
            "down",
            "up"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "bandwidth_set",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "277-308",
          "snippet": "void bandwidth_set(pid_t pid, const char *dev, int down, int up) {\n\t// create bandwidth directory & file in case they are not in the filesystem yet\n\tbandwidth_create_run_file(pid);\n\n\t// create the new text entry\n\tchar *txt;\n\tif (asprintf(&txt, \"%s: RX %dKB/s, TX %dKB/s\", dev, down, up) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// read bandwidth file\n\tread_bandwidth_file(pid);\n\n\t// look for an existing entry and replace the text\n\tIFBW *ptr = ifbw_find(dev);\n\tif (ptr) {\n\t\tassert(ptr->txt);\n\t\tfree(ptr->txt);\n\t\tptr->txt = txt;\n\t}\n\t// ... or add a new entry\n\telse {\n\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\tif (!ifbw_new)\n\t\t\terrExit(\"malloc\");\n\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\tifbw_new->txt = txt;\n\t\t\n\t\t// add it to the linked list\n\t\tifbw_add(ifbw_new);\n\t}\n\twrite_bandwidth_file(pid) ;\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_set(pid_t pid, const char *dev, int down, int up) {\n\t// create bandwidth directory & file in case they are not in the filesystem yet\n\tbandwidth_create_run_file(pid);\n\n\t// create the new text entry\n\tchar *txt;\n\tif (asprintf(&txt, \"%s: RX %dKB/s, TX %dKB/s\", dev, down, up) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// read bandwidth file\n\tread_bandwidth_file(pid);\n\n\t// look for an existing entry and replace the text\n\tIFBW *ptr = ifbw_find(dev);\n\tif (ptr) {\n\t\tassert(ptr->txt);\n\t\tfree(ptr->txt);\n\t\tptr->txt = txt;\n\t}\n\t// ... or add a new entry\n\telse {\n\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\tif (!ifbw_new)\n\t\t\terrExit(\"malloc\");\n\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\tifbw_new->txt = txt;\n\t\t\n\t\t// add it to the linked list\n\t\tifbw_add(ifbw_new);\n\t}\n\twrite_bandwidth_file(pid) ;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "command",
            "\"set\""
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot join the network namespace\\n\""
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "join_namespace",
          "args": [
            "child",
            "\"net\""
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot join the network namespace\\n\""
          ],
          "line": 364
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "find_child",
          "args": [
            "pid",
            "&child"
          ],
          "line": 363
        },
        "resolved": true,
        "details": {
          "function_name": "find_child",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "395-454",
          "snippet": "int find_child(pid_t parent, pid_t *child) {\n\tEUID_ASSERT();\n\t*child = 0;\t\t\t\t  // use it to flag a found child\n\n\tDIR *dir;\n\tEUID_ROOT();\t\t\t\t  // grsecurity fix\n\tif (!(dir = opendir(\"/proc\"))) {\n\t\t// sleep 2 seconds and try again\n\t\tsleep(2);\n\t\tif (!(dir = opendir(\"/proc\"))) {\n\t\t\tfprintf(stderr, \"Error: cannot open /proc directory\\n\");\n\t\t\texit(1);\n\t\t}\n\t}\n\n\tstruct dirent *entry;\n\tchar *end;\n\twhile (*child == 0 && (entry = readdir(dir))) {\n\t\tpid_t pid = strtol(entry->d_name, &end, 10);\n\t\tif (end == entry->d_name || *end)\n\t\t\tcontinue;\n\t\tif (pid == parent)\n\t\t\tcontinue;\n\n\t\t// open stat file\n\t\tchar *file;\n\t\tif (asprintf(&file, \"/proc/%u/status\", pid) == -1) {\n\t\t\tperror(\"asprintf\");\n\t\t\texit(1);\n\t\t}\n\t\tFILE *fp = fopen(file, \"r\");\n\t\tif (!fp) {\n\t\t\tfree(file);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// look for firejail executable name\n\t\tchar buf[BUFLEN];\n\t\twhile (fgets(buf, BUFLEN - 1, fp)) {\n\t\t\tif (strncmp(buf, \"PPid:\", 5) == 0) {\n\t\t\t\tchar *ptr = buf + 5;\n\t\t\t\twhile (*ptr != '\\0' && (*ptr == ' ' || *ptr == '\\t')) {\n\t\t\t\t\tptr++;\n\t\t\t\t}\n\t\t\t\tif (*ptr == '\\0') {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot read /proc file\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tif (parent == atoi(ptr))\n\t\t\t\t\t*child = pid;\n\t\t\t\tbreak;\t\t  // stop reading the file\n\t\t\t}\n\t\t}\n\t\tfclose(fp);\n\t\tfree(file);\n\t}\n\tclosedir(dir);\n\tEUID_USER();\n\treturn (*child)? 0:1;\t\t\t  // 0 = found, 1 = not found\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define BUFLEN 4096"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define BUFLEN 4096\n\nint find_child(pid_t parent, pid_t *child) {\n\tEUID_ASSERT();\n\t*child = 0;\t\t\t\t  // use it to flag a found child\n\n\tDIR *dir;\n\tEUID_ROOT();\t\t\t\t  // grsecurity fix\n\tif (!(dir = opendir(\"/proc\"))) {\n\t\t// sleep 2 seconds and try again\n\t\tsleep(2);\n\t\tif (!(dir = opendir(\"/proc\"))) {\n\t\t\tfprintf(stderr, \"Error: cannot open /proc directory\\n\");\n\t\t\texit(1);\n\t\t}\n\t}\n\n\tstruct dirent *entry;\n\tchar *end;\n\twhile (*child == 0 && (entry = readdir(dir))) {\n\t\tpid_t pid = strtol(entry->d_name, &end, 10);\n\t\tif (end == entry->d_name || *end)\n\t\t\tcontinue;\n\t\tif (pid == parent)\n\t\t\tcontinue;\n\n\t\t// open stat file\n\t\tchar *file;\n\t\tif (asprintf(&file, \"/proc/%u/status\", pid) == -1) {\n\t\t\tperror(\"asprintf\");\n\t\t\texit(1);\n\t\t}\n\t\tFILE *fp = fopen(file, \"r\");\n\t\tif (!fp) {\n\t\t\tfree(file);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// look for firejail executable name\n\t\tchar buf[BUFLEN];\n\t\twhile (fgets(buf, BUFLEN - 1, fp)) {\n\t\t\tif (strncmp(buf, \"PPid:\", 5) == 0) {\n\t\t\t\tchar *ptr = buf + 5;\n\t\t\t\twhile (*ptr != '\\0' && (*ptr == ' ' || *ptr == '\\t')) {\n\t\t\t\t\tptr++;\n\t\t\t\t}\n\t\t\t\tif (*ptr == '\\0') {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot read /proc file\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tif (parent == atoi(ptr))\n\t\t\t\t\t*child = pid;\n\t\t\t\tbreak;\t\t  // stop reading the file\n\t\t\t}\n\t\t}\n\t\tfclose(fp);\n\t\tfree(file);\n\t}\n\tclosedir(dir);\n\tEUID_USER();\n\treturn (*child)? 0:1;\t\t\t  // 0 = found, 1 = not found\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: the sandbox doesn't use a new network namespace\\n\""
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "name",
            "&s"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&name",
            "\"/run/firejail/network/%d-netmap\"",
            "pid"
          ],
          "line": 351
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "comm"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot find sandbox\\n\""
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "comm",
            "\"firejail\""
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot find sandbox\\n\""
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pid_proc_comm",
          "args": [
            "pid"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_pid(pid_t pid, const char *command, const char *dev, int down, int up) {\n\tEUID_ASSERT();\n\t//************************\n\t// verify sandbox\n\t//************************\n\tEUID_ROOT();\n\tchar *comm = pid_proc_comm(pid);\n\tEUID_USER();\n\tif (!comm) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox\\n\");\n\t\texit(1);\n\t}\n\n\t// check for firejail sandbox\n\tif (strcmp(comm, \"firejail\") != 0) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox\\n\");\n\t\texit(1);\n\t}\n\tfree(comm);\n\t\n\t// check network namespace\n\tchar *name;\n\tif (asprintf(&name, \"/run/firejail/network/%d-netmap\", pid) == -1)\n\t\terrExit(\"asprintf\");\n\tstruct stat s;\n\tif (stat(name, &s) == -1) {\n\t\tfprintf(stderr, \"Error: the sandbox doesn't use a new network namespace\\n\");\n\t\texit(1);\n\t}\n\n\t//************************\n\t// join the network namespace\n\t//************************\n\tpid_t child;\n\tif (find_child(pid, &child) == -1) {\n\t\tfprintf(stderr, \"Error: cannot join the network namespace\\n\");\n\t\texit(1);\n\t}\n\n\tEUID_ROOT();\n\tif (join_namespace(child, \"net\")) {\n\t\tfprintf(stderr, \"Error: cannot join the network namespace\\n\");\n\t\texit(1);\n\t}\n\n\t// set run file\n\tif (strcmp(command, \"set\") == 0)\n\t\tbandwidth_set(pid, dev, down, up);\n\telse if (strcmp(command, \"clear\") == 0)\n\t\tbandwidth_remove(pid, dev);\n\n\t//************************\n\t// build command\n\t//************************\n\tchar *devname = NULL;\n\tif (dev) {\n\t\t// read network map file\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n\t\t\tfprintf(stderr, \"Error: cannot read network map file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\t\n\t\tchar buf[1024];\n\t\tint len = strlen(dev);\n\t\twhile (fgets(buf, 1024, fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (*buf == '\\0')\n\t\t\t\tbreak;\n\n\t\t\tif (strncmp(buf, dev, len) == 0  && buf[len] == ':') {\n\t\t\t\tdevname = strdup(buf + len + 1);\n\t\t\t\tif (!devname)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\t// check device in namespace\n\t\t\t\tif (if_nametoindex(devname) == 0) {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot find network device %s\\n\", devname);\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfree(fname);\n\t\tfclose(fp);\n\t}\n\t\n\t// build fshaper.sh command\n\tchar *cmd = NULL;\n\tif (devname) {\n\t\tif (strcmp(command, \"set\") == 0) {\n\t\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s %s %d %d\",\n\t\t\t\tLIBDIR, command, devname, down, up) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t}\n\t\telse {\n\t\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s %s\",\n\t\t\t\tLIBDIR, command, devname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t}\n\t}\n\telse {\n\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s\", LIBDIR, command) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\tassert(cmd);\n\n\t// wipe out environment variables\n\tenviron = NULL;\n\n\t//************************\n\t// build command\n\t//************************\n\t// elevate privileges\n\tif (setreuid(0, 0))\n\t\terrExit(\"setreuid\");\n\tif (setregid(0, 0))\n\t\terrExit(\"setregid\");\n\n\tchar *arg[4];\n\targ[0] = \"/bin/sh\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\tclearenv();\n\texecvp(arg[0], arg);\n\t\n\t// it will never get here\n\terrExit(\"execvp\");\n}"
  },
  {
    "function_name": "bandwidth_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "314-327",
    "snippet": "void bandwidth_name(const char *name, const char *command, const char *dev, int down, int up) {\n\tEUID_ASSERT();\n\tif (!name || strlen(name) == 0) {\n\t\tfprintf(stderr, \"Error: invalid sandbox name\\n\");\n\t\texit(1);\n\t}\n\tpid_t pid;\n\tif (name2pid(name, &pid)) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox %s\\n\", name);\n\t\texit(1);\n\t}\n\n\tbandwidth_pid(pid, command, dev, down, up);\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bandwidth_pid",
          "args": [
            "pid",
            "command",
            "dev",
            "down",
            "up"
          ],
          "line": 326
        },
        "resolved": true,
        "details": {
          "function_name": "bandwidth_pid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "329-463",
          "snippet": "void bandwidth_pid(pid_t pid, const char *command, const char *dev, int down, int up) {\n\tEUID_ASSERT();\n\t//************************\n\t// verify sandbox\n\t//************************\n\tEUID_ROOT();\n\tchar *comm = pid_proc_comm(pid);\n\tEUID_USER();\n\tif (!comm) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox\\n\");\n\t\texit(1);\n\t}\n\n\t// check for firejail sandbox\n\tif (strcmp(comm, \"firejail\") != 0) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox\\n\");\n\t\texit(1);\n\t}\n\tfree(comm);\n\t\n\t// check network namespace\n\tchar *name;\n\tif (asprintf(&name, \"/run/firejail/network/%d-netmap\", pid) == -1)\n\t\terrExit(\"asprintf\");\n\tstruct stat s;\n\tif (stat(name, &s) == -1) {\n\t\tfprintf(stderr, \"Error: the sandbox doesn't use a new network namespace\\n\");\n\t\texit(1);\n\t}\n\n\t//************************\n\t// join the network namespace\n\t//************************\n\tpid_t child;\n\tif (find_child(pid, &child) == -1) {\n\t\tfprintf(stderr, \"Error: cannot join the network namespace\\n\");\n\t\texit(1);\n\t}\n\n\tEUID_ROOT();\n\tif (join_namespace(child, \"net\")) {\n\t\tfprintf(stderr, \"Error: cannot join the network namespace\\n\");\n\t\texit(1);\n\t}\n\n\t// set run file\n\tif (strcmp(command, \"set\") == 0)\n\t\tbandwidth_set(pid, dev, down, up);\n\telse if (strcmp(command, \"clear\") == 0)\n\t\tbandwidth_remove(pid, dev);\n\n\t//************************\n\t// build command\n\t//************************\n\tchar *devname = NULL;\n\tif (dev) {\n\t\t// read network map file\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n\t\t\tfprintf(stderr, \"Error: cannot read network map file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\t\n\t\tchar buf[1024];\n\t\tint len = strlen(dev);\n\t\twhile (fgets(buf, 1024, fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (*buf == '\\0')\n\t\t\t\tbreak;\n\n\t\t\tif (strncmp(buf, dev, len) == 0  && buf[len] == ':') {\n\t\t\t\tdevname = strdup(buf + len + 1);\n\t\t\t\tif (!devname)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\t// check device in namespace\n\t\t\t\tif (if_nametoindex(devname) == 0) {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot find network device %s\\n\", devname);\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfree(fname);\n\t\tfclose(fp);\n\t}\n\t\n\t// build fshaper.sh command\n\tchar *cmd = NULL;\n\tif (devname) {\n\t\tif (strcmp(command, \"set\") == 0) {\n\t\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s %s %d %d\",\n\t\t\t\tLIBDIR, command, devname, down, up) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t}\n\t\telse {\n\t\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s %s\",\n\t\t\t\tLIBDIR, command, devname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t}\n\t}\n\telse {\n\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s\", LIBDIR, command) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\tassert(cmd);\n\n\t// wipe out environment variables\n\tenviron = NULL;\n\n\t//************************\n\t// build command\n\t//************************\n\t// elevate privileges\n\tif (setreuid(0, 0))\n\t\terrExit(\"setreuid\");\n\tif (setregid(0, 0))\n\t\terrExit(\"setregid\");\n\n\tchar *arg[4];\n\targ[0] = \"/bin/sh\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\tclearenv();\n\texecvp(arg[0], arg);\n\t\n\t// it will never get here\n\terrExit(\"execvp\");\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_pid(pid_t pid, const char *command, const char *dev, int down, int up) {\n\tEUID_ASSERT();\n\t//************************\n\t// verify sandbox\n\t//************************\n\tEUID_ROOT();\n\tchar *comm = pid_proc_comm(pid);\n\tEUID_USER();\n\tif (!comm) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox\\n\");\n\t\texit(1);\n\t}\n\n\t// check for firejail sandbox\n\tif (strcmp(comm, \"firejail\") != 0) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox\\n\");\n\t\texit(1);\n\t}\n\tfree(comm);\n\t\n\t// check network namespace\n\tchar *name;\n\tif (asprintf(&name, \"/run/firejail/network/%d-netmap\", pid) == -1)\n\t\terrExit(\"asprintf\");\n\tstruct stat s;\n\tif (stat(name, &s) == -1) {\n\t\tfprintf(stderr, \"Error: the sandbox doesn't use a new network namespace\\n\");\n\t\texit(1);\n\t}\n\n\t//************************\n\t// join the network namespace\n\t//************************\n\tpid_t child;\n\tif (find_child(pid, &child) == -1) {\n\t\tfprintf(stderr, \"Error: cannot join the network namespace\\n\");\n\t\texit(1);\n\t}\n\n\tEUID_ROOT();\n\tif (join_namespace(child, \"net\")) {\n\t\tfprintf(stderr, \"Error: cannot join the network namespace\\n\");\n\t\texit(1);\n\t}\n\n\t// set run file\n\tif (strcmp(command, \"set\") == 0)\n\t\tbandwidth_set(pid, dev, down, up);\n\telse if (strcmp(command, \"clear\") == 0)\n\t\tbandwidth_remove(pid, dev);\n\n\t//************************\n\t// build command\n\t//************************\n\tchar *devname = NULL;\n\tif (dev) {\n\t\t// read network map file\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n\t\t\tfprintf(stderr, \"Error: cannot read network map file %s\\n\", fname);\n\t\t\texit(1);\n\t\t}\n\t\t\n\t\tchar buf[1024];\n\t\tint len = strlen(dev);\n\t\twhile (fgets(buf, 1024, fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (*buf == '\\0')\n\t\t\t\tbreak;\n\n\t\t\tif (strncmp(buf, dev, len) == 0  && buf[len] == ':') {\n\t\t\t\tdevname = strdup(buf + len + 1);\n\t\t\t\tif (!devname)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\t// check device in namespace\n\t\t\t\tif (if_nametoindex(devname) == 0) {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot find network device %s\\n\", devname);\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t\tfree(fname);\n\t\tfclose(fp);\n\t}\n\t\n\t// build fshaper.sh command\n\tchar *cmd = NULL;\n\tif (devname) {\n\t\tif (strcmp(command, \"set\") == 0) {\n\t\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s %s %d %d\",\n\t\t\t\tLIBDIR, command, devname, down, up) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t}\n\t\telse {\n\t\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s %s\",\n\t\t\t\tLIBDIR, command, devname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t}\n\t}\n\telse {\n\t\tif (asprintf(&cmd, \"%s/firejail/fshaper.sh --%s\", LIBDIR, command) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\tassert(cmd);\n\n\t// wipe out environment variables\n\tenviron = NULL;\n\n\t//************************\n\t// build command\n\t//************************\n\t// elevate privileges\n\tif (setreuid(0, 0))\n\t\terrExit(\"setreuid\");\n\tif (setregid(0, 0))\n\t\terrExit(\"setregid\");\n\n\tchar *arg[4];\n\targ[0] = \"/bin/sh\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\tclearenv();\n\texecvp(arg[0], arg);\n\t\n\t// it will never get here\n\terrExit(\"execvp\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 323
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot find sandbox %s\\n\"",
            "name"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "name2pid",
          "args": [
            "name",
            "&pid"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: invalid sandbox name\\n\""
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_name(const char *name, const char *command, const char *dev, int down, int up) {\n\tEUID_ASSERT();\n\tif (!name || strlen(name) == 0) {\n\t\tfprintf(stderr, \"Error: invalid sandbox name\\n\");\n\t\texit(1);\n\t}\n\tpid_t pid;\n\tif (name2pid(name, &pid)) {\n\t\tfprintf(stderr, \"Error: cannot find sandbox %s\\n\", name);\n\t\texit(1);\n\t}\n\n\tbandwidth_pid(pid, command, dev, down, up);\n}"
  },
  {
    "function_name": "bandwidth_set",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "277-308",
    "snippet": "void bandwidth_set(pid_t pid, const char *dev, int down, int up) {\n\t// create bandwidth directory & file in case they are not in the filesystem yet\n\tbandwidth_create_run_file(pid);\n\n\t// create the new text entry\n\tchar *txt;\n\tif (asprintf(&txt, \"%s: RX %dKB/s, TX %dKB/s\", dev, down, up) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// read bandwidth file\n\tread_bandwidth_file(pid);\n\n\t// look for an existing entry and replace the text\n\tIFBW *ptr = ifbw_find(dev);\n\tif (ptr) {\n\t\tassert(ptr->txt);\n\t\tfree(ptr->txt);\n\t\tptr->txt = txt;\n\t}\n\t// ... or add a new entry\n\telse {\n\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\tif (!ifbw_new)\n\t\t\terrExit(\"malloc\");\n\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\tifbw_new->txt = txt;\n\t\t\n\t\t// add it to the linked list\n\t\tifbw_add(ifbw_new);\n\t}\n\twrite_bandwidth_file(pid) ;\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "write_bandwidth_file",
          "args": [
            "pid"
          ],
          "line": 307
        },
        "resolved": true,
        "details": {
          "function_name": "write_bandwidth_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "225-250",
          "snippet": "static void write_bandwidth_file(pid_t pid) {\n\tif (ifbw == NULL)\n\t\treturn; // nothing to do\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tIFBW *ptr = ifbw;\n\t\twhile (ptr) {\n\t\t\tif (fprintf(fp, \"%s\\n\", ptr->txt) < 0)\n\t\t\t\tgoto errout;\n\t\t\tptr = ptr->next;\n\t\t}\n\t\tfclose(fp);\n\t}\n\telse\n\t\tgoto errout;\n\treturn;\n\nerrout:\n\tfprintf(stderr, \"Error: cannot write bandwidth file %s\\n\", fname);\n\texit(1);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void write_bandwidth_file(pid_t pid) {\n\tif (ifbw == NULL)\n\t\treturn; // nothing to do\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tIFBW *ptr = ifbw;\n\t\twhile (ptr) {\n\t\t\tif (fprintf(fp, \"%s\\n\", ptr->txt) < 0)\n\t\t\t\tgoto errout;\n\t\t\tptr = ptr->next;\n\t\t}\n\t\tfclose(fp);\n\t}\n\telse\n\t\tgoto errout;\n\treturn;\n\nerrout:\n\tfprintf(stderr, \"Error: cannot write bandwidth file %s\\n\", fname);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ifbw_add",
          "args": [
            "ifbw_new"
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "ifbw_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "48-54",
          "snippet": "static void ifbw_add(IFBW *ptr) {\n\tassert(ptr);\n\n\tif (ifbw != NULL)\n\t\tptr->next = ifbw;\n\tifbw = ptr;\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void ifbw_add(IFBW *ptr) {\n\tassert(ptr);\n\n\tif (ifbw != NULL)\n\t\tptr->next = ifbw;\n\tifbw = ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "ifbw_new",
            "0",
            "sizeof(IFBW)"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"malloc\""
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(IFBW)"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "ptr->txt"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "ptr->txt"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ifbw_find",
          "args": [
            "dev"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "ifbw_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "57-73",
          "snippet": "IFBW *ifbw_find(const char *dev) {\n\tassert(dev);\n\tint len = strlen(dev);\n\tassert(len);\n\t\n\tif (ifbw == NULL)\n\t\treturn NULL;\n\t\n\tIFBW *ptr = ifbw;\n\twhile (ptr) {\n\t\tif (strncmp(ptr->txt, dev, len) == 0 && ptr->txt[len] == ':')\n\t\t\treturn ptr;\n\t\tptr = ptr->next;\n\t}\n\t\n\treturn NULL;\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nIFBW *ifbw_find(const char *dev) {\n\tassert(dev);\n\tint len = strlen(dev);\n\tassert(len);\n\t\n\tif (ifbw == NULL)\n\t\treturn NULL;\n\t\n\tIFBW *ptr = ifbw;\n\twhile (ptr) {\n\t\tif (strncmp(ptr->txt, dev, len) == 0 && ptr->txt[len] == ':')\n\t\t\treturn ptr;\n\t\tptr = ptr->next;\n\t}\n\t\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read_bandwidth_file",
          "args": [
            "pid"
          ],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "read_bandwidth_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "190-223",
          "snippet": "static void read_bandwidth_file(pid_t pid) {\n\tassert(ifbw == NULL);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"r\");\n\tif (fp) {\n\t\tchar buf[1024];\n\t\twhile (fgets(buf, 1024,fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (strlen(buf) == 0)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// create a new IFBW entry\n\t\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\t\tif (!ifbw_new)\n\t\t\t\terrExit(\"malloc\");\n\t\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\t\tifbw_new->txt = strdup(buf);\n\t\t\tif (!ifbw_new->txt)\n\t\t\t\terrExit(\"strdup\");\n\t\t\t\n\t\t\t// add it to the linked list\n\t\t\tifbw_add(ifbw_new);\n\t\t}\t\n\t\t\n\t\tfclose(fp);\t\t\n\t}\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void read_bandwidth_file(pid_t pid) {\n\tassert(ifbw == NULL);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"r\");\n\tif (fp) {\n\t\tchar buf[1024];\n\t\twhile (fgets(buf, 1024,fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (strlen(buf) == 0)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// create a new IFBW entry\n\t\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\t\tif (!ifbw_new)\n\t\t\t\terrExit(\"malloc\");\n\t\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\t\tifbw_new->txt = strdup(buf);\n\t\t\tif (!ifbw_new->txt)\n\t\t\t\terrExit(\"strdup\");\n\t\t\t\n\t\t\t// add it to the linked list\n\t\t\tifbw_add(ifbw_new);\n\t\t}\t\n\t\t\n\t\tfclose(fp);\t\t\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&txt",
            "\"%s: RX %dKB/s, TX %dKB/s\"",
            "dev",
            "down",
            "up"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bandwidth_create_run_file",
          "args": [
            "pid"
          ],
          "line": 279
        },
        "resolved": true,
        "details": {
          "function_name": "bandwidth_create_run_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "117-142",
          "snippet": "static void bandwidth_create_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// if the file already exists, do nothing\n\tstruct stat s;\n\tif (stat(fname, &s) == 0) {\n\t\tfree(fname);\n\t\treturn;\n\t}\n\n\t// create an empty file and set mod and ownership\n\t/* coverity[toctou] */\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\t\tfclose(fp);\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot create bandwidth file\\n\");\n\t\texit(1);\n\t}\n\t\n\tfree(fname);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nstatic void bandwidth_create_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// if the file already exists, do nothing\n\tstruct stat s;\n\tif (stat(fname, &s) == 0) {\n\t\tfree(fname);\n\t\treturn;\n\t}\n\n\t// create an empty file and set mod and ownership\n\t/* coverity[toctou] */\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\t\tfclose(fp);\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot create bandwidth file\\n\");\n\t\texit(1);\n\t}\n\t\n\tfree(fname);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_set(pid_t pid, const char *dev, int down, int up) {\n\t// create bandwidth directory & file in case they are not in the filesystem yet\n\tbandwidth_create_run_file(pid);\n\n\t// create the new text entry\n\tchar *txt;\n\tif (asprintf(&txt, \"%s: RX %dKB/s, TX %dKB/s\", dev, down, up) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// read bandwidth file\n\tread_bandwidth_file(pid);\n\n\t// look for an existing entry and replace the text\n\tIFBW *ptr = ifbw_find(dev);\n\tif (ptr) {\n\t\tassert(ptr->txt);\n\t\tfree(ptr->txt);\n\t\tptr->txt = txt;\n\t}\n\t// ... or add a new entry\n\telse {\n\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\tif (!ifbw_new)\n\t\t\terrExit(\"malloc\");\n\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\tifbw_new->txt = txt;\n\t\t\n\t\t// add it to the linked list\n\t\tifbw_add(ifbw_new);\n\t}\n\twrite_bandwidth_file(pid) ;\n}"
  },
  {
    "function_name": "bandwidth_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "257-274",
    "snippet": "void bandwidth_remove(pid_t pid, const char *dev) {\n\tbandwidth_create_run_file(pid);\n\t\n\t// read bandwidth file\n\tread_bandwidth_file(pid);\n\t\n\t// find the element and remove it\n\tIFBW *elem = ifbw_find(dev);\n\tif (elem) {\n\t\tifbw_remove(elem);\n\t\twrite_bandwidth_file(pid) ;\n\t}\n\t\n\t// remove the file if there are no entries in the list\n\tif (ifbw == NULL) {\n\t\t bandwidth_del_run_file(pid);\n\t}\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "IFBW *ifbw = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "bandwidth_del_run_file",
          "args": [
            "pid"
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "bandwidth_del_run_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "145-151",
          "snippet": "void bandwidth_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "write_bandwidth_file",
          "args": [
            "pid"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "write_bandwidth_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "225-250",
          "snippet": "static void write_bandwidth_file(pid_t pid) {\n\tif (ifbw == NULL)\n\t\treturn; // nothing to do\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tIFBW *ptr = ifbw;\n\t\twhile (ptr) {\n\t\t\tif (fprintf(fp, \"%s\\n\", ptr->txt) < 0)\n\t\t\t\tgoto errout;\n\t\t\tptr = ptr->next;\n\t\t}\n\t\tfclose(fp);\n\t}\n\telse\n\t\tgoto errout;\n\treturn;\n\nerrout:\n\tfprintf(stderr, \"Error: cannot write bandwidth file %s\\n\", fname);\n\texit(1);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void write_bandwidth_file(pid_t pid) {\n\tif (ifbw == NULL)\n\t\treturn; // nothing to do\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tIFBW *ptr = ifbw;\n\t\twhile (ptr) {\n\t\t\tif (fprintf(fp, \"%s\\n\", ptr->txt) < 0)\n\t\t\t\tgoto errout;\n\t\t\tptr = ptr->next;\n\t\t}\n\t\tfclose(fp);\n\t}\n\telse\n\t\tgoto errout;\n\treturn;\n\nerrout:\n\tfprintf(stderr, \"Error: cannot write bandwidth file %s\\n\", fname);\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ifbw_remove",
          "args": [
            "elem"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "ifbw_remove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "75-99",
          "snippet": "void ifbw_remove(IFBW *r) {\n\tif (ifbw == NULL)\n\t\treturn;\n\t\n\t// remove the first element\n\tif (ifbw == r) {\n\t\tifbw = ifbw->next;\n\t\treturn;\n\t}\n\t\n\t// walk the list\n\tIFBW *ptr = ifbw->next;\n\tIFBW *prev = ifbw;\n\twhile (ptr) {\n\t\tif (ptr == r) {\n\t\t\tprev->next = ptr->next;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tprev = ptr;\n\t\tptr = ptr->next;\n\t}\t\n\t\n\treturn;\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nvoid ifbw_remove(IFBW *r) {\n\tif (ifbw == NULL)\n\t\treturn;\n\t\n\t// remove the first element\n\tif (ifbw == r) {\n\t\tifbw = ifbw->next;\n\t\treturn;\n\t}\n\t\n\t// walk the list\n\tIFBW *ptr = ifbw->next;\n\tIFBW *prev = ifbw;\n\twhile (ptr) {\n\t\tif (ptr == r) {\n\t\t\tprev->next = ptr->next;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tprev = ptr;\n\t\tptr = ptr->next;\n\t}\t\n\t\n\treturn;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ifbw_find",
          "args": [
            "dev"
          ],
          "line": 264
        },
        "resolved": true,
        "details": {
          "function_name": "ifbw_find",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "57-73",
          "snippet": "IFBW *ifbw_find(const char *dev) {\n\tassert(dev);\n\tint len = strlen(dev);\n\tassert(len);\n\t\n\tif (ifbw == NULL)\n\t\treturn NULL;\n\t\n\tIFBW *ptr = ifbw;\n\twhile (ptr) {\n\t\tif (strncmp(ptr->txt, dev, len) == 0 && ptr->txt[len] == ':')\n\t\t\treturn ptr;\n\t\tptr = ptr->next;\n\t}\n\t\n\treturn NULL;\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nIFBW *ifbw_find(const char *dev) {\n\tassert(dev);\n\tint len = strlen(dev);\n\tassert(len);\n\t\n\tif (ifbw == NULL)\n\t\treturn NULL;\n\t\n\tIFBW *ptr = ifbw;\n\twhile (ptr) {\n\t\tif (strncmp(ptr->txt, dev, len) == 0 && ptr->txt[len] == ':')\n\t\t\treturn ptr;\n\t\tptr = ptr->next;\n\t}\n\t\n\treturn NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read_bandwidth_file",
          "args": [
            "pid"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "read_bandwidth_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "190-223",
          "snippet": "static void read_bandwidth_file(pid_t pid) {\n\tassert(ifbw == NULL);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"r\");\n\tif (fp) {\n\t\tchar buf[1024];\n\t\twhile (fgets(buf, 1024,fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (strlen(buf) == 0)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// create a new IFBW entry\n\t\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\t\tif (!ifbw_new)\n\t\t\t\terrExit(\"malloc\");\n\t\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\t\tifbw_new->txt = strdup(buf);\n\t\t\tif (!ifbw_new->txt)\n\t\t\t\terrExit(\"strdup\");\n\t\t\t\n\t\t\t// add it to the linked list\n\t\t\tifbw_add(ifbw_new);\n\t\t}\t\n\t\t\n\t\tfclose(fp);\t\t\n\t}\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void read_bandwidth_file(pid_t pid) {\n\tassert(ifbw == NULL);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"r\");\n\tif (fp) {\n\t\tchar buf[1024];\n\t\twhile (fgets(buf, 1024,fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (strlen(buf) == 0)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// create a new IFBW entry\n\t\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\t\tif (!ifbw_new)\n\t\t\t\terrExit(\"malloc\");\n\t\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\t\tifbw_new->txt = strdup(buf);\n\t\t\tif (!ifbw_new->txt)\n\t\t\t\terrExit(\"strdup\");\n\t\t\t\n\t\t\t// add it to the linked list\n\t\t\tifbw_add(ifbw_new);\n\t\t}\t\n\t\t\n\t\tfclose(fp);\t\t\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "bandwidth_create_run_file",
          "args": [
            "pid"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "bandwidth_create_run_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "117-142",
          "snippet": "static void bandwidth_create_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// if the file already exists, do nothing\n\tstruct stat s;\n\tif (stat(fname, &s) == 0) {\n\t\tfree(fname);\n\t\treturn;\n\t}\n\n\t// create an empty file and set mod and ownership\n\t/* coverity[toctou] */\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\t\tfclose(fp);\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot create bandwidth file\\n\");\n\t\texit(1);\n\t}\n\t\n\tfree(fname);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nstatic void bandwidth_create_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// if the file already exists, do nothing\n\tstruct stat s;\n\tif (stat(fname, &s) == 0) {\n\t\tfree(fname);\n\t\treturn;\n\t}\n\n\t// create an empty file and set mod and ownership\n\t/* coverity[toctou] */\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\t\tfclose(fp);\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot create bandwidth file\\n\");\n\t\texit(1);\n\t}\n\t\n\tfree(fname);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nvoid bandwidth_remove(pid_t pid, const char *dev) {\n\tbandwidth_create_run_file(pid);\n\t\n\t// read bandwidth file\n\tread_bandwidth_file(pid);\n\t\n\t// find the element and remove it\n\tIFBW *elem = ifbw_find(dev);\n\tif (elem) {\n\t\tifbw_remove(elem);\n\t\twrite_bandwidth_file(pid) ;\n\t}\n\t\n\t// remove the file if there are no entries in the list\n\tif (ifbw == NULL) {\n\t\t bandwidth_del_run_file(pid);\n\t}\n}"
  },
  {
    "function_name": "write_bandwidth_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "225-250",
    "snippet": "static void write_bandwidth_file(pid_t pid) {\n\tif (ifbw == NULL)\n\t\treturn; // nothing to do\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tIFBW *ptr = ifbw;\n\t\twhile (ptr) {\n\t\t\tif (fprintf(fp, \"%s\\n\", ptr->txt) < 0)\n\t\t\t\tgoto errout;\n\t\t\tptr = ptr->next;\n\t\t}\n\t\tfclose(fp);\n\t}\n\telse\n\t\tgoto errout;\n\treturn;\n\nerrout:\n\tfprintf(stderr, \"Error: cannot write bandwidth file %s\\n\", fname);\n\texit(1);\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "IFBW *ifbw = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot write bandwidth file %s\\n\"",
            "fname"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"%s\\n\"",
            "ptr->txt"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"w\""
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d-bandwidth\"",
            "RUN_FIREJAIL_BANDWIDTH_DIR",
            "(int) pid"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void write_bandwidth_file(pid_t pid) {\n\tif (ifbw == NULL)\n\t\treturn; // nothing to do\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tIFBW *ptr = ifbw;\n\t\twhile (ptr) {\n\t\t\tif (fprintf(fp, \"%s\\n\", ptr->txt) < 0)\n\t\t\t\tgoto errout;\n\t\t\tptr = ptr->next;\n\t\t}\n\t\tfclose(fp);\n\t}\n\telse\n\t\tgoto errout;\n\treturn;\n\nerrout:\n\tfprintf(stderr, \"Error: cannot write bandwidth file %s\\n\", fname);\n\texit(1);\n}"
  },
  {
    "function_name": "read_bandwidth_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "190-223",
    "snippet": "static void read_bandwidth_file(pid_t pid) {\n\tassert(ifbw == NULL);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"r\");\n\tif (fp) {\n\t\tchar buf[1024];\n\t\twhile (fgets(buf, 1024,fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (strlen(buf) == 0)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// create a new IFBW entry\n\t\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\t\tif (!ifbw_new)\n\t\t\t\terrExit(\"malloc\");\n\t\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\t\tifbw_new->txt = strdup(buf);\n\t\t\tif (!ifbw_new->txt)\n\t\t\t\terrExit(\"strdup\");\n\t\t\t\n\t\t\t// add it to the linked list\n\t\t\tifbw_add(ifbw_new);\n\t\t}\t\n\t\t\n\t\tfclose(fp);\t\t\n\t}\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "IFBW *ifbw = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ifbw_add",
          "args": [
            "ifbw_new"
          ],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "ifbw_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "48-54",
          "snippet": "static void ifbw_add(IFBW *ptr) {\n\tassert(ptr);\n\n\tif (ifbw != NULL)\n\t\tptr->next = ifbw;\n\tifbw = ptr;\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "IFBW *ifbw = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void ifbw_add(IFBW *ptr) {\n\tassert(ptr);\n\n\tif (ifbw != NULL)\n\t\tptr->next = ifbw;\n\tifbw = ptr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "buf"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "ifbw_new",
            "0",
            "sizeof(IFBW)"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"malloc\""
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(IFBW)"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "buf",
            "'\\n'"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "1024",
            "fp"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"r\""
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d-bandwidth\"",
            "RUN_FIREJAIL_BANDWIDTH_DIR",
            "(int) pid"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "ifbw == NULL"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void read_bandwidth_file(pid_t pid) {\n\tassert(ifbw == NULL);\n\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\tFILE *fp = fopen(fname, \"r\");\n\tif (fp) {\n\t\tchar buf[1024];\n\t\twhile (fgets(buf, 1024,fp)) {\n\t\t\t// remove '\\n'\n\t\t\tchar *ptr = strchr(buf, '\\n');\n\t\t\tif (ptr)\n\t\t\t\t*ptr = '\\0';\n\t\t\tif (strlen(buf) == 0)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// create a new IFBW entry\n\t\t\tIFBW *ifbw_new = malloc(sizeof(IFBW));\n\t\t\tif (!ifbw_new)\n\t\t\t\terrExit(\"malloc\");\n\t\t\tmemset(ifbw_new, 0, sizeof(IFBW));\n\t\t\tifbw_new->txt = strdup(buf);\n\t\t\tif (!ifbw_new->txt)\n\t\t\t\terrExit(\"strdup\");\n\t\t\t\n\t\t\t// add it to the linked list\n\t\t\tifbw_add(ifbw_new);\n\t\t}\t\n\t\t\n\t\tfclose(fp);\t\t\n\t}\n}"
  },
  {
    "function_name": "network_set_run_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "161-187",
    "snippet": "void network_set_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// create an empty file and set mod and ownership\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tif (cfg.bridge0.configured)\n\t\t\tfprintf(fp, \"%s:%s\\n\", cfg.bridge0.dev, cfg.bridge0.devsandbox);\n\t\tif (cfg.bridge1.configured)\n\t\t\tfprintf(fp, \"%s:%s\\n\", cfg.bridge1.dev, cfg.bridge1.devsandbox);\n\t\tif (cfg.bridge2.configured)\n\t\t\tfprintf(fp, \"%s:%s\\n\", cfg.bridge2.dev, cfg.bridge2.devsandbox);\n\t\tif (cfg.bridge3.configured)\n\t\t\tfprintf(fp, \"%s:%s\\n\", cfg.bridge3.dev, cfg.bridge3.devsandbox);\n\n\t\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\t\tfclose(fp);\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot create network map file\\n\");\n\t\texit(1);\n\t}\n\t\n\tfree(fname);\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot create network map file\\n\""
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET_PERMS_STREAM",
          "args": [
            "fp",
            "0",
            "0",
            "0644"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"%s:%s\\n\"",
            "cfg.bridge3.dev",
            "cfg.bridge3.devsandbox"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"%s:%s\\n\"",
            "cfg.bridge2.dev",
            "cfg.bridge2.devsandbox"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"%s:%s\\n\"",
            "cfg.bridge1.dev",
            "cfg.bridge1.devsandbox"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"%s:%s\\n\"",
            "cfg.bridge0.dev",
            "cfg.bridge0.devsandbox"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"w\""
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d-netmap\"",
            "RUN_FIREJAIL_NETWORK_DIR",
            "(int) pid"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid network_set_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// create an empty file and set mod and ownership\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tif (cfg.bridge0.configured)\n\t\t\tfprintf(fp, \"%s:%s\\n\", cfg.bridge0.dev, cfg.bridge0.devsandbox);\n\t\tif (cfg.bridge1.configured)\n\t\t\tfprintf(fp, \"%s:%s\\n\", cfg.bridge1.dev, cfg.bridge1.devsandbox);\n\t\tif (cfg.bridge2.configured)\n\t\t\tfprintf(fp, \"%s:%s\\n\", cfg.bridge2.dev, cfg.bridge2.devsandbox);\n\t\tif (cfg.bridge3.configured)\n\t\t\tfprintf(fp, \"%s:%s\\n\", cfg.bridge3.dev, cfg.bridge3.devsandbox);\n\n\t\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\t\tfclose(fp);\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot create network map file\\n\");\n\t\texit(1);\n\t}\n\t\n\tfree(fname);\n}"
  },
  {
    "function_name": "network_del_run_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "153-159",
    "snippet": "void network_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "fname"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d-netmap\"",
            "RUN_FIREJAIL_NETWORK_DIR",
            "(int) pid"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid network_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}"
  },
  {
    "function_name": "bandwidth_del_run_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "145-151",
    "snippet": "void bandwidth_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "fname"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d-bandwidth\"",
            "RUN_FIREJAIL_BANDWIDTH_DIR",
            "(int) pid"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}"
  },
  {
    "function_name": "bandwidth_create_run_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "117-142",
    "snippet": "static void bandwidth_create_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// if the file already exists, do nothing\n\tstruct stat s;\n\tif (stat(fname, &s) == 0) {\n\t\tfree(fname);\n\t\treturn;\n\t}\n\n\t// create an empty file and set mod and ownership\n\t/* coverity[toctou] */\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\t\tfclose(fp);\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot create bandwidth file\\n\");\n\t\texit(1);\n\t}\n\t\n\tfree(fname);\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot create bandwidth file\\n\""
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET_PERMS_STREAM",
          "args": [
            "fp",
            "0",
            "0",
            "0644"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"w\""
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "fname",
            "&s"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d-bandwidth\"",
            "RUN_FIREJAIL_BANDWIDTH_DIR",
            "(int) pid"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nstatic void bandwidth_create_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\t// if the file already exists, do nothing\n\tstruct stat s;\n\tif (stat(fname, &s) == 0) {\n\t\tfree(fname);\n\t\treturn;\n\t}\n\n\t// create an empty file and set mod and ownership\n\t/* coverity[toctou] */\n\tFILE *fp = fopen(fname, \"w\");\n\tif (fp) {\n\t\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\t\tfclose(fp);\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot create bandwidth file\\n\");\n\t\texit(1);\n\t}\n\t\n\tfree(fname);\n}"
  },
  {
    "function_name": "fibw_count",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "101-111",
    "snippet": "int fibw_count(void) {\n\tint rv = 0;\n\tIFBW *ptr = ifbw;\n\n\twhile (ptr) {\n\t\trv++;\n\t\tptr = ptr->next;\n\t}\n\t\n\treturn rv;\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "IFBW *ifbw = NULL;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nint fibw_count(void) {\n\tint rv = 0;\n\tIFBW *ptr = ifbw;\n\n\twhile (ptr) {\n\t\trv++;\n\t\tptr = ptr->next;\n\t}\n\t\n\treturn rv;\n}"
  },
  {
    "function_name": "ifbw_remove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "75-99",
    "snippet": "void ifbw_remove(IFBW *r) {\n\tif (ifbw == NULL)\n\t\treturn;\n\t\n\t// remove the first element\n\tif (ifbw == r) {\n\t\tifbw = ifbw->next;\n\t\treturn;\n\t}\n\t\n\t// walk the list\n\tIFBW *ptr = ifbw->next;\n\tIFBW *prev = ifbw;\n\twhile (ptr) {\n\t\tif (ptr == r) {\n\t\t\tprev->next = ptr->next;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tprev = ptr;\n\t\tptr = ptr->next;\n\t}\t\n\t\n\treturn;\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "IFBW *ifbw = NULL;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nvoid ifbw_remove(IFBW *r) {\n\tif (ifbw == NULL)\n\t\treturn;\n\t\n\t// remove the first element\n\tif (ifbw == r) {\n\t\tifbw = ifbw->next;\n\t\treturn;\n\t}\n\t\n\t// walk the list\n\tIFBW *ptr = ifbw->next;\n\tIFBW *prev = ifbw;\n\twhile (ptr) {\n\t\tif (ptr == r) {\n\t\t\tprev->next = ptr->next;\n\t\t\treturn;\n\t\t}\n\t\t\n\t\tprev = ptr;\n\t\tptr = ptr->next;\n\t}\t\n\t\n\treturn;\n}"
  },
  {
    "function_name": "ifbw_find",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "57-73",
    "snippet": "IFBW *ifbw_find(const char *dev) {\n\tassert(dev);\n\tint len = strlen(dev);\n\tassert(len);\n\t\n\tif (ifbw == NULL)\n\t\treturn NULL;\n\t\n\tIFBW *ptr = ifbw;\n\twhile (ptr) {\n\t\tif (strncmp(ptr->txt, dev, len) == 0 && ptr->txt[len] == ':')\n\t\t\treturn ptr;\n\t\tptr = ptr->next;\n\t}\n\t\n\treturn NULL;\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "IFBW *ifbw = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "ptr->txt",
            "dev",
            "len"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "len"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "dev"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "dev"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nIFBW *ifbw_find(const char *dev) {\n\tassert(dev);\n\tint len = strlen(dev);\n\tassert(len);\n\t\n\tif (ifbw == NULL)\n\t\treturn NULL;\n\t\n\tIFBW *ptr = ifbw;\n\twhile (ptr) {\n\t\tif (strncmp(ptr->txt, dev, len) == 0 && ptr->txt[len] == ':')\n\t\t\treturn ptr;\n\t\tptr = ptr->next;\n\t}\n\t\n\treturn NULL;\n}"
  },
  {
    "function_name": "ifbw_add",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "48-54",
    "snippet": "static void ifbw_add(IFBW *ptr) {\n\tassert(ptr);\n\n\tif (ifbw != NULL)\n\t\tptr->next = ifbw;\n\tifbw = ptr;\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "IFBW *ifbw = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "ptr"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void ifbw_add(IFBW *ptr) {\n\tassert(ptr);\n\n\tif (ifbw != NULL)\n\t\tptr->next = ifbw;\n\tifbw = ptr;\n}"
  },
  {
    "function_name": "ifbw_print",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
    "lines": "39-45",
    "snippet": "static void ifbw_print(void) {\n\tIFBW *ptr = ifbw;\n\twhile (ptr) {\n\t\tprintf(\"#%s#\\n\", ptr->txt);\n\t\tptr = ptr->next;\n\t}\n}",
    "includes": [
      "#include \"firejail.h\"",
      "#include <net/if.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <stdio.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "IFBW *ifbw = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"#%s#\\n\"",
            "ptr->txt"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nIFBW *ifbw = NULL;\n\nstatic void ifbw_print(void) {\n\tIFBW *ptr = ifbw;\n\twhile (ptr) {\n\t\tprintf(\"#%s#\\n\", ptr->txt);\n\t\tptr = ptr->next;\n\t}\n}"
  }
]