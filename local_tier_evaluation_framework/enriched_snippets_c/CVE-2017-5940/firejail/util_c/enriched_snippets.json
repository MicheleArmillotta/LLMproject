[
  {
    "function_name": "set_perms",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "733-740",
    "snippet": "int set_perms(const char *fname, uid_t uid, gid_t gid, mode_t mode) {\n\tassert(fname);\n\tif (chmod(fname, mode) == -1)\n\t\treturn 1;\n\tif (chown(fname, uid, gid) == -1)\n\t\treturn 1;\n\treturn 0;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "chown",
          "args": [
            "fname",
            "uid",
            "gid"
          ],
          "line": 737
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chmod",
          "args": [
            "fname",
            "mode"
          ],
          "line": 735
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "fname"
          ],
          "line": 734
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nint set_perms(const char *fname, uid_t uid, gid_t gid, mode_t mode) {\n\tassert(fname);\n\tif (chmod(fname, mode) == -1)\n\t\treturn 1;\n\tif (chown(fname, uid, gid) == -1)\n\t\treturn 1;\n\treturn 0;\n}"
  },
  {
    "function_name": "flush_stdin",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "721-731",
    "snippet": "void flush_stdin(void) {\n\tif (isatty(STDIN_FILENO)) {\n\t\tint cnt = 0;\n\t\tioctl(STDIN_FILENO, FIONREAD, &cnt);\n\t\tif (cnt) {\n\t\t\tif (!arg_quiet)\n\t\t\t\tprintf(\"Warning: removing %d bytes from stdin\\n\", cnt);\n\t\t\tioctl(STDIN_FILENO, TCFLSH, TCIFLUSH);\n\t\t}\n\t}\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "STDIN_FILENO",
            "TCFLSH",
            "TCIFLUSH"
          ],
          "line": 728
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Warning: removing %d bytes from stdin\\n\"",
            "cnt"
          ],
          "line": 727
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "STDIN_FILENO",
            "FIONREAD",
            "&cnt"
          ],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "isatty",
          "args": [
            "STDIN_FILENO"
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid flush_stdin(void) {\n\tif (isatty(STDIN_FILENO)) {\n\t\tint cnt = 0;\n\t\tioctl(STDIN_FILENO, FIONREAD, &cnt);\n\t\tif (cnt) {\n\t\t\tif (!arg_quiet)\n\t\t\t\tprintf(\"Warning: removing %d bytes from stdin\\n\", cnt);\n\t\t\tioctl(STDIN_FILENO, TCFLSH, TCIFLUSH);\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "remove_directory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "716-719",
    "snippet": "int remove_directory(const char *path) {\n\t// FTW_PHYS - do not follow symbolic links\n\treturn nftw(path, remove_callback, 64, FTW_DEPTH | FTW_PHYS);\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nftw",
          "args": [
            "path",
            "remove_callback",
            "64",
            "FTW_DEPTH | FTW_PHYS"
          ],
          "line": 718
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nint remove_directory(const char *path) {\n\t// FTW_PHYS - do not follow symbolic links\n\treturn nftw(path, remove_callback, 64, FTW_DEPTH | FTW_PHYS);\n}"
  },
  {
    "function_name": "remove_callback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "703-713",
    "snippet": "static int remove_callback(const char *fpath, const struct stat *sb, int typeflag, struct FTW *ftwbuf) {\n\t(void) sb;\n\t(void) typeflag;\n\t(void) ftwbuf;\n\t\n\tint rv = remove(fpath);\n\tif (rv)\n\t\tperror(fpath);\n\n\treturn rv;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "fpath"
          ],
          "line": 710
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove",
          "args": [
            "fpath"
          ],
          "line": 708
        },
        "resolved": true,
        "details": {
          "function_name": "remove_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "716-719",
          "snippet": "int remove_directory(const char *path) {\n\t// FTW_PHYS - do not follow symbolic links\n\treturn nftw(path, remove_callback, 64, FTW_DEPTH | FTW_PHYS);\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nint remove_directory(const char *path) {\n\t// FTW_PHYS - do not follow symbolic links\n\treturn nftw(path, remove_callback, 64, FTW_DEPTH | FTW_PHYS);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nstatic int remove_callback(const char *fpath, const struct stat *sb, int typeflag, struct FTW *ftwbuf) {\n\t(void) sb;\n\t(void) typeflag;\n\t(void) ftwbuf;\n\t\n\tint rv = remove(fpath);\n\tif (rv)\n\t\tperror(fpath);\n\n\treturn rv;\n}"
  },
  {
    "function_name": "get_group_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "692-700",
    "snippet": "uid_t get_group_id(const char *group) {\n\t// find tty group id\n\tgid_t gid = 0;\n\tstruct group *g = getgrnam(group);\n\tif (g)\n\t\tgid = g->gr_gid;\n\n\treturn gid;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "getgrnam",
          "args": [
            "group"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nuid_t get_group_id(const char *group) {\n\t// find tty group id\n\tgid_t gid = 0;\n\tstruct group *g = getgrnam(group);\n\tif (g)\n\t\tgid = g->gr_gid;\n\n\treturn gid;\n}"
  },
  {
    "function_name": "invalid_filename",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "668-689",
    "snippet": "void invalid_filename(const char *fname) {\n\tEUID_ASSERT();\n\tassert(fname);\n\tconst char *ptr = fname;\n\n\tif (arg_debug_check_filename)\n\t\tprintf(\"Checking filename %s\\n\", fname);\n\n\tif (strncmp(ptr, \"${HOME}\", 7) == 0)\n\t\tptr = fname + 7;\n\telse if (strncmp(ptr, \"${PATH}\", 7) == 0)\n\t\tptr = fname + 7;\n\telse if (strcmp(fname, \"${DOWNLOADS}\") == 0)\n\t\treturn;\n\n\tint len = strlen(ptr);\n\t// file globbing ('*') is allowed\n\tif (strcspn(ptr, \"\\\\&!?\\\"'<>%^(){}[];,\") != (size_t)len) {\n\t\tfprintf(stderr, \"Error: \\\"%s\\\" is an invalid filename\\n\", ptr);\n\t\texit(1);\n\t}\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 687
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: \\\"%s\\\" is an invalid filename\\n\"",
            "ptr"
          ],
          "line": 686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcspn",
          "args": [
            "ptr",
            "\"\\\\&!?\\\"'<>%^(){}[];,\""
          ],
          "line": 685
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "ptr"
          ],
          "line": 683
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "fname",
            "\"${DOWNLOADS}\""
          ],
          "line": 680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "ptr",
            "\"${PATH}\"",
            "7"
          ],
          "line": 678
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "ptr",
            "\"${HOME}\"",
            "7"
          ],
          "line": 676
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Checking filename %s\\n\"",
            "fname"
          ],
          "line": 674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "fname"
          ],
          "line": 670
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid invalid_filename(const char *fname) {\n\tEUID_ASSERT();\n\tassert(fname);\n\tconst char *ptr = fname;\n\n\tif (arg_debug_check_filename)\n\t\tprintf(\"Checking filename %s\\n\", fname);\n\n\tif (strncmp(ptr, \"${HOME}\", 7) == 0)\n\t\tptr = fname + 7;\n\telse if (strncmp(ptr, \"${PATH}\", 7) == 0)\n\t\tptr = fname + 7;\n\telse if (strcmp(fname, \"${DOWNLOADS}\") == 0)\n\t\treturn;\n\n\tint len = strlen(ptr);\n\t// file globbing ('*') is allowed\n\tif (strcspn(ptr, \"\\\\&!?\\\"'<>%^(){}[];,\") != (size_t)len) {\n\t\tfprintf(stderr, \"Error: \\\"%s\\\" is an invalid filename\\n\", ptr);\n\t\texit(1);\n\t}\n}"
  },
  {
    "function_name": "pid_get_uid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "621-665",
    "snippet": "uid_t pid_get_uid(pid_t pid) {\n\tEUID_ASSERT();\n\tuid_t rv = 0;\n\n\t// open status file\n\tchar *file;\n\tif (asprintf(&file, \"/proc/%u/status\", pid) == -1) {\n\t\tperror(\"asprintf\");\n\t\texit(1);\n\t}\n\tEUID_ROOT();\t\t\t\t  // grsecurity fix\n\tFILE *fp = fopen(file, \"r\");\n\tif (!fp) {\n\t\tfree(file);\n\t\tfprintf(stderr, \"Error: cannot open /proc file\\n\");\n\t\texit(1);\n\t}\n\n\t// extract uid\n\tstatic const int PIDS_BUFLEN = 1024;\n\tchar buf[PIDS_BUFLEN];\n\twhile (fgets(buf, PIDS_BUFLEN - 1, fp)) {\n\t\tif (strncmp(buf, \"Uid:\", 4) == 0) {\n\t\t\tchar *ptr = buf + 5;\n\t\t\twhile (*ptr != '\\0' && (*ptr == ' ' || *ptr == '\\t')) {\n\t\t\t\tptr++;\n\t\t\t}\n\t\t\tif (*ptr == '\\0')\n\t\t\t\tbreak;\n\n\t\t\trv = atoi(ptr);\n\t\t\tbreak;\t\t\t  // break regardless!\n\t\t}\n\t}\n\n\tfclose(fp);\n\tfree(file);\n\tEUID_USER();\t\t\t\t  // grsecurity fix\n\n\tif (rv == 0) {\n\t\tfprintf(stderr, \"Error: cannot read /proc file\\n\");\n\t\texit(1);\n\t}\n\treturn rv;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 662
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read /proc file\\n\""
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 658
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "file"
          ],
          "line": 657
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 656
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "ptr"
          ],
          "line": 651
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "buf",
            "\"Uid:\"",
            "4"
          ],
          "line": 643
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "PIDS_BUFLEN - 1",
            "fp"
          ],
          "line": 642
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot open /proc file\\n\""
          ],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "file"
          ],
          "line": 634
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "file",
            "\"r\""
          ],
          "line": 632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 631
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"asprintf\""
          ],
          "line": 628
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&file",
            "\"/proc/%u/status\"",
            "pid"
          ],
          "line": 627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 622
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nuid_t pid_get_uid(pid_t pid) {\n\tEUID_ASSERT();\n\tuid_t rv = 0;\n\n\t// open status file\n\tchar *file;\n\tif (asprintf(&file, \"/proc/%u/status\", pid) == -1) {\n\t\tperror(\"asprintf\");\n\t\texit(1);\n\t}\n\tEUID_ROOT();\t\t\t\t  // grsecurity fix\n\tFILE *fp = fopen(file, \"r\");\n\tif (!fp) {\n\t\tfree(file);\n\t\tfprintf(stderr, \"Error: cannot open /proc file\\n\");\n\t\texit(1);\n\t}\n\n\t// extract uid\n\tstatic const int PIDS_BUFLEN = 1024;\n\tchar buf[PIDS_BUFLEN];\n\twhile (fgets(buf, PIDS_BUFLEN - 1, fp)) {\n\t\tif (strncmp(buf, \"Uid:\", 4) == 0) {\n\t\t\tchar *ptr = buf + 5;\n\t\t\twhile (*ptr != '\\0' && (*ptr == ' ' || *ptr == '\\t')) {\n\t\t\t\tptr++;\n\t\t\t}\n\t\t\tif (*ptr == '\\0')\n\t\t\t\tbreak;\n\n\t\t\trv = atoi(ptr);\n\t\t\tbreak;\t\t\t  // break regardless!\n\t\t}\n\t}\n\n\tfclose(fp);\n\tfree(file);\n\tEUID_USER();\t\t\t\t  // grsecurity fix\n\n\tif (rv == 0) {\n\t\tfprintf(stderr, \"Error: cannot read /proc file\\n\");\n\t\texit(1);\n\t}\n\treturn rv;\n}"
  },
  {
    "function_name": "gnu_basename",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "613-618",
    "snippet": "const char *gnu_basename(const char *path) {\n\tconst char *last_slash = strrchr(path, '/');\n\tif (!last_slash)\n\t\treturn path;\n\treturn last_slash+1;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "path",
            "'/'"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nconst char *gnu_basename(const char *path) {\n\tconst char *last_slash = strrchr(path, '/');\n\tif (!last_slash)\n\t\treturn path;\n\treturn last_slash+1;\n}"
  },
  {
    "function_name": "expand_home",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "589-607",
    "snippet": "char *expand_home(const char *path, const char* homedir) {\n\tassert(path);\n\tassert(homedir);\n\n\t// Replace home macro\n\tchar *new_name = NULL;\n\tif (strncmp(path, \"${HOME}\", 7) == 0) {\n\t\tif (asprintf(&new_name, \"%s%s\", homedir, path + 7) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\treturn new_name;\n\t}\n\telse if (*path == '~') {\n\t\tif (asprintf(&new_name, \"%s%s\", homedir, path + 1) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\treturn new_name;\n\t}\n\n\treturn strdup(path);\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "path"
          ],
          "line": 606
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 602
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&new_name",
            "\"%s%s\"",
            "homedir",
            "path + 1"
          ],
          "line": 601
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&new_name",
            "\"%s%s\"",
            "homedir",
            "path + 7"
          ],
          "line": 596
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "path",
            "\"${HOME}\"",
            "7"
          ],
          "line": 595
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "homedir"
          ],
          "line": 591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "path"
          ],
          "line": 590
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nchar *expand_home(const char *path, const char* homedir) {\n\tassert(path);\n\tassert(homedir);\n\n\t// Replace home macro\n\tchar *new_name = NULL;\n\tif (strncmp(path, \"${HOME}\", 7) == 0) {\n\t\tif (asprintf(&new_name, \"%s%s\", homedir, path + 7) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\treturn new_name;\n\t}\n\telse if (*path == '~') {\n\t\tif (asprintf(&new_name, \"%s%s\", homedir, path + 1) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\treturn new_name;\n\t}\n\n\treturn strdup(path);\n}"
  },
  {
    "function_name": "notify_other",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "572-581",
    "snippet": "void notify_other(int fd) {\n\tFILE* stream;\n\tint newfd = dup(fd);\n\tif (newfd == -1)\n\t\terrExit(\"dup\");\n\tstream = fdopen(newfd, \"w\");\n\tfprintf(stream, \"arg_noroot=%d\\n\", arg_noroot);\n\tfflush(stream);\n\tfclose(stream);\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "stream"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "stream"
          ],
          "line": 579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stream",
            "\"arg_noroot=%d\\n\"",
            "arg_noroot"
          ],
          "line": 578
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fdopen",
          "args": [
            "newfd",
            "\"w\""
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"dup\""
          ],
          "line": 576
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup",
          "args": [
            "fd"
          ],
          "line": 574
        },
        "resolved": true,
        "details": {
          "function_name": "duplicate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_bin.c",
          "lines": "158-207",
          "snippet": "static void duplicate(char *fname) {\n\tchar *path = check_dir_or_file(fname);\n\tif (!path)\n\t\treturn;\n\n\t// expand path, just in case this is a symbolic link\n\tchar *full_path;\n\tif (asprintf(&full_path, \"%s/%s\", path, fname) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\tchar *actual_path = realpath(full_path, NULL);\n\tif (actual_path) {\n\t\t// if the file is a symbolic link not under path, make a symbolic link\n\t\tif (is_link(full_path) && strncmp(actual_path, path, strlen(path))) {\n\t\t\tchar *lnkname;\n\t\t\tif (asprintf(&lnkname, \"%s/%s\", RUN_BIN_DIR, fname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tint rv = symlink(actual_path, lnkname);\n\t\t\tif (rv)\n\t\t\t\tfprintf(stderr, \"Warning cannot create symbolic link %s\\n\", lnkname);\n\t\t\telse if (arg_debug)\n\t\t\t\tprintf(\"Created symbolic link %s -> %s\\n\", lnkname, actual_path);\n\t\t\tfree(lnkname);\n\t\t}\n\t\telse {\n\t\t\t// copy the file\n\t\t\tif (arg_debug)\n\t\t\t\tprintf(\"running: %s -a %s %s/%s\", RUN_CP_COMMAND, actual_path, RUN_BIN_DIR, fname);\n\n\t\t\tpid_t child = fork();\n\t\t\tif (child < 0)\n\t\t\t\terrExit(\"fork\");\n\t\t\tif (child == 0) {\n\t\t\t\tchar *f;\n\t\t\t\tif (asprintf(&f, \"%s/%s\", RUN_BIN_DIR, fname) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\tclearenv();\n\t\t\t\texeclp(RUN_CP_COMMAND, RUN_CP_COMMAND, \"-a\", actual_path, f, NULL);\n\t\t\t\tperror(\"execlp\");\n\t\t\t\t_exit(1);\n\t\t\t}\n\t\t\t// wait for the child to finish\n\t\t\twaitpid(child, NULL, 0);\n\t\t\n\t\t}\n\t\tfree(actual_path);\n\t}\n\n\tfree(full_path);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nstatic void duplicate(char *fname) {\n\tchar *path = check_dir_or_file(fname);\n\tif (!path)\n\t\treturn;\n\n\t// expand path, just in case this is a symbolic link\n\tchar *full_path;\n\tif (asprintf(&full_path, \"%s/%s\", path, fname) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\tchar *actual_path = realpath(full_path, NULL);\n\tif (actual_path) {\n\t\t// if the file is a symbolic link not under path, make a symbolic link\n\t\tif (is_link(full_path) && strncmp(actual_path, path, strlen(path))) {\n\t\t\tchar *lnkname;\n\t\t\tif (asprintf(&lnkname, \"%s/%s\", RUN_BIN_DIR, fname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tint rv = symlink(actual_path, lnkname);\n\t\t\tif (rv)\n\t\t\t\tfprintf(stderr, \"Warning cannot create symbolic link %s\\n\", lnkname);\n\t\t\telse if (arg_debug)\n\t\t\t\tprintf(\"Created symbolic link %s -> %s\\n\", lnkname, actual_path);\n\t\t\tfree(lnkname);\n\t\t}\n\t\telse {\n\t\t\t// copy the file\n\t\t\tif (arg_debug)\n\t\t\t\tprintf(\"running: %s -a %s %s/%s\", RUN_CP_COMMAND, actual_path, RUN_BIN_DIR, fname);\n\n\t\t\tpid_t child = fork();\n\t\t\tif (child < 0)\n\t\t\t\terrExit(\"fork\");\n\t\t\tif (child == 0) {\n\t\t\t\tchar *f;\n\t\t\t\tif (asprintf(&f, \"%s/%s\", RUN_BIN_DIR, fname) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\tclearenv();\n\t\t\t\texeclp(RUN_CP_COMMAND, RUN_CP_COMMAND, \"-a\", actual_path, f, NULL);\n\t\t\t\tperror(\"execlp\");\n\t\t\t\t_exit(1);\n\t\t\t}\n\t\t\t// wait for the child to finish\n\t\t\twaitpid(child, NULL, 0);\n\t\t\n\t\t}\n\t\tfree(actual_path);\n\t}\n\n\tfree(full_path);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid notify_other(int fd) {\n\tFILE* stream;\n\tint newfd = dup(fd);\n\tif (newfd == -1)\n\t\terrExit(\"dup\");\n\tstream = fdopen(newfd, \"w\");\n\tfprintf(stream, \"arg_noroot=%d\\n\", arg_noroot);\n\tfflush(stream);\n\tfclose(stream);\n}"
  },
  {
    "function_name": "wait_for_other",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "541-569",
    "snippet": "void wait_for_other(int fd) {\n\t//****************************\n\t// wait for the parent to be initialized\n\t//****************************\n\tchar childstr[BUFLEN + 1];\n\tint newfd = dup(fd);\n\tif (newfd == -1)\n\t\terrExit(\"dup\");\n\tFILE* stream;\n\tstream = fdopen(newfd, \"r\");\n\t*childstr = '\\0';\n\tif (fgets(childstr, BUFLEN, stream)) {\n\t\t// remove \\n)\n\t\tchar *ptr = childstr;\n\t\twhile(*ptr !='\\0' && *ptr != '\\n')\n\t\t\tptr++;\n\t\tif (*ptr == '\\0')\n\t\t\terrExit(\"fgets\");\n\t\t*ptr = '\\0';\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot establish communication with the parent, exiting...\\n\");\n\t\texit(1);\n\t}\n\tif (strcmp(childstr, \"arg_noroot=0\") == 0)\n\t\targ_noroot = 0;\n\n\tfclose(stream);\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [
      "#define BUFLEN 4096"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "stream"
          ],
          "line": 568
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "childstr",
            "\"arg_noroot=0\""
          ],
          "line": 565
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 563
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot establish communication with the parent, exiting...\\n\""
          ],
          "line": 562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"fgets\""
          ],
          "line": 558
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "childstr",
            "BUFLEN",
            "stream"
          ],
          "line": 552
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fdopen",
          "args": [
            "newfd",
            "\"r\""
          ],
          "line": 550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"dup\""
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup",
          "args": [
            "fd"
          ],
          "line": 546
        },
        "resolved": true,
        "details": {
          "function_name": "duplicate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_bin.c",
          "lines": "158-207",
          "snippet": "static void duplicate(char *fname) {\n\tchar *path = check_dir_or_file(fname);\n\tif (!path)\n\t\treturn;\n\n\t// expand path, just in case this is a symbolic link\n\tchar *full_path;\n\tif (asprintf(&full_path, \"%s/%s\", path, fname) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\tchar *actual_path = realpath(full_path, NULL);\n\tif (actual_path) {\n\t\t// if the file is a symbolic link not under path, make a symbolic link\n\t\tif (is_link(full_path) && strncmp(actual_path, path, strlen(path))) {\n\t\t\tchar *lnkname;\n\t\t\tif (asprintf(&lnkname, \"%s/%s\", RUN_BIN_DIR, fname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tint rv = symlink(actual_path, lnkname);\n\t\t\tif (rv)\n\t\t\t\tfprintf(stderr, \"Warning cannot create symbolic link %s\\n\", lnkname);\n\t\t\telse if (arg_debug)\n\t\t\t\tprintf(\"Created symbolic link %s -> %s\\n\", lnkname, actual_path);\n\t\t\tfree(lnkname);\n\t\t}\n\t\telse {\n\t\t\t// copy the file\n\t\t\tif (arg_debug)\n\t\t\t\tprintf(\"running: %s -a %s %s/%s\", RUN_CP_COMMAND, actual_path, RUN_BIN_DIR, fname);\n\n\t\t\tpid_t child = fork();\n\t\t\tif (child < 0)\n\t\t\t\terrExit(\"fork\");\n\t\t\tif (child == 0) {\n\t\t\t\tchar *f;\n\t\t\t\tif (asprintf(&f, \"%s/%s\", RUN_BIN_DIR, fname) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\tclearenv();\n\t\t\t\texeclp(RUN_CP_COMMAND, RUN_CP_COMMAND, \"-a\", actual_path, f, NULL);\n\t\t\t\tperror(\"execlp\");\n\t\t\t\t_exit(1);\n\t\t\t}\n\t\t\t// wait for the child to finish\n\t\t\twaitpid(child, NULL, 0);\n\t\t\n\t\t}\n\t\tfree(actual_path);\n\t}\n\n\tfree(full_path);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/wait.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/wait.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nstatic void duplicate(char *fname) {\n\tchar *path = check_dir_or_file(fname);\n\tif (!path)\n\t\treturn;\n\n\t// expand path, just in case this is a symbolic link\n\tchar *full_path;\n\tif (asprintf(&full_path, \"%s/%s\", path, fname) == -1)\n\t\terrExit(\"asprintf\");\n\t\n\tchar *actual_path = realpath(full_path, NULL);\n\tif (actual_path) {\n\t\t// if the file is a symbolic link not under path, make a symbolic link\n\t\tif (is_link(full_path) && strncmp(actual_path, path, strlen(path))) {\n\t\t\tchar *lnkname;\n\t\t\tif (asprintf(&lnkname, \"%s/%s\", RUN_BIN_DIR, fname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tint rv = symlink(actual_path, lnkname);\n\t\t\tif (rv)\n\t\t\t\tfprintf(stderr, \"Warning cannot create symbolic link %s\\n\", lnkname);\n\t\t\telse if (arg_debug)\n\t\t\t\tprintf(\"Created symbolic link %s -> %s\\n\", lnkname, actual_path);\n\t\t\tfree(lnkname);\n\t\t}\n\t\telse {\n\t\t\t// copy the file\n\t\t\tif (arg_debug)\n\t\t\t\tprintf(\"running: %s -a %s %s/%s\", RUN_CP_COMMAND, actual_path, RUN_BIN_DIR, fname);\n\n\t\t\tpid_t child = fork();\n\t\t\tif (child < 0)\n\t\t\t\terrExit(\"fork\");\n\t\t\tif (child == 0) {\n\t\t\t\tchar *f;\n\t\t\t\tif (asprintf(&f, \"%s/%s\", RUN_BIN_DIR, fname) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\tclearenv();\n\t\t\t\texeclp(RUN_CP_COMMAND, RUN_CP_COMMAND, \"-a\", actual_path, f, NULL);\n\t\t\t\tperror(\"execlp\");\n\t\t\t\t_exit(1);\n\t\t\t}\n\t\t\t// wait for the child to finish\n\t\t\twaitpid(child, NULL, 0);\n\t\t\n\t\t}\n\t\tfree(actual_path);\n\t}\n\n\tfree(full_path);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define BUFLEN 4096\n\nvoid wait_for_other(int fd) {\n\t//****************************\n\t// wait for the parent to be initialized\n\t//****************************\n\tchar childstr[BUFLEN + 1];\n\tint newfd = dup(fd);\n\tif (newfd == -1)\n\t\terrExit(\"dup\");\n\tFILE* stream;\n\tstream = fdopen(newfd, \"r\");\n\t*childstr = '\\0';\n\tif (fgets(childstr, BUFLEN, stream)) {\n\t\t// remove \\n)\n\t\tchar *ptr = childstr;\n\t\twhile(*ptr !='\\0' && *ptr != '\\n')\n\t\t\tptr++;\n\t\tif (*ptr == '\\0')\n\t\t\terrExit(\"fgets\");\n\t\t*ptr = '\\0';\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: cannot establish communication with the parent, exiting...\\n\");\n\t\texit(1);\n\t}\n\tif (strcmp(childstr, \"arg_noroot=0\") == 0)\n\t\targ_noroot = 0;\n\n\tfclose(stream);\n}"
  },
  {
    "function_name": "update_map",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "514-538",
    "snippet": "void update_map(char *mapping, char *map_file) {\n\tint fd;\n\tsize_t j;\n\tsize_t map_len;\t\t\t\t  /* Length of 'mapping' */\n\n\t/* Replace commas in mapping string with newlines */\n\n\tmap_len = strlen(mapping);\n\tfor (j = 0; j < map_len; j++)\n\t\tif (mapping[j] == ',')\n\t\t\tmapping[j] = '\\n';\n\n\tfd = open(map_file, O_RDWR);\n\tif (fd == -1) {\n\t\tfprintf(stderr, \"Error: cannot open %s: %s\\n\", map_file, strerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tif (write(fd, mapping, map_len) != (ssize_t)map_len) {\n\t\tfprintf(stderr, \"Error: cannot write to %s: %s\\n\", map_file, strerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tclose(fd);\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 534
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot write to %s: %s\\n\"",
            "map_file",
            "strerror(errno)"
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "write",
          "args": [
            "fd",
            "mapping",
            "map_len"
          ],
          "line": 532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot open %s: %s\\n\"",
            "map_file",
            "strerror(errno)"
          ],
          "line": 528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "map_file",
            "O_RDWR"
          ],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "mapping"
          ],
          "line": 521
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid update_map(char *mapping, char *map_file) {\n\tint fd;\n\tsize_t j;\n\tsize_t map_len;\t\t\t\t  /* Length of 'mapping' */\n\n\t/* Replace commas in mapping string with newlines */\n\n\tmap_len = strlen(mapping);\n\tfor (j = 0; j < map_len; j++)\n\t\tif (mapping[j] == ',')\n\t\t\tmapping[j] = '\\n';\n\n\tfd = open(map_file, O_RDWR);\n\tif (fd == -1) {\n\t\tfprintf(stderr, \"Error: cannot open %s: %s\\n\", map_file, strerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tif (write(fd, mapping, map_len) != (ssize_t)map_len) {\n\t\tfprintf(stderr, \"Error: cannot write to %s: %s\\n\", map_file, strerror(errno));\n\t\texit(EXIT_FAILURE);\n\t}\n\n\tclose(fd);\n}"
  },
  {
    "function_name": "extract_command_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "457-511",
    "snippet": "void extract_command_name(int index, char **argv) {\n\tEUID_ASSERT();\n\tassert(argv);\n\tassert(argv[index]);\n\n\t// configure command index\n\tcfg.original_program_index = index;\n\n\tchar *str = strdup(argv[index]);\n\tif (!str)\n\t\terrExit(\"strdup\");\n\n\t// if we have a symbolic link, use the real path to extract the name\n//\tif (is_link(argv[index])) {\n//\t\tchar*newname = realpath(argv[index], NULL);\n//\t\tif (newname) {\n//\t\t\tfree(str);\n//\t\t\tstr = newname;\n//\t\t}\n//\t}\n\n\t// configure command name\n\tcfg.command_name = str;\n\tif (!cfg.command_name)\n\t\terrExit(\"strdup\");\n\n\t// restrict the command name to the first word\n\tchar *ptr = cfg.command_name;\n\twhile (*ptr != ' ' && *ptr != '\\t' && *ptr != '\\0')\n\t\tptr++;\n\t*ptr = '\\0';\n\n\t// remove the path: /usr/bin/firefox becomes firefox\n\tptr = strrchr(cfg.command_name, '/');\n\tif (ptr) {\n\t\tptr++;\n\t\tif (*ptr == '\\0') {\n\t\t\tfprintf(stderr, \"Error: invalid command name\\n\");\n\t\t\texit(1);\n\t\t}\n\n\t\tchar *tmp = strdup(ptr);\n\t\tif (!tmp)\n\t\t\terrExit(\"strdup\");\n\n\t\t// limit the command to the first '.'\n\t\tchar *ptr2 = tmp;\n\t\twhile (*ptr2 != '.' && *ptr2 != '\\0')\n\t\t\tptr2++;\n\t\t*ptr2 = '\\0';\n\n\t\tfree(cfg.command_name);\n\t\tcfg.command_name = tmp;\n\t}\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "cfg.command_name"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "ptr"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 495
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: invalid command name\\n\""
          ],
          "line": 494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "cfg.command_name",
            "'/'"
          ],
          "line": 490
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "argv[index]"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "argv[index]"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "argv"
          ],
          "line": 459
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid extract_command_name(int index, char **argv) {\n\tEUID_ASSERT();\n\tassert(argv);\n\tassert(argv[index]);\n\n\t// configure command index\n\tcfg.original_program_index = index;\n\n\tchar *str = strdup(argv[index]);\n\tif (!str)\n\t\terrExit(\"strdup\");\n\n\t// if we have a symbolic link, use the real path to extract the name\n//\tif (is_link(argv[index])) {\n//\t\tchar*newname = realpath(argv[index], NULL);\n//\t\tif (newname) {\n//\t\t\tfree(str);\n//\t\t\tstr = newname;\n//\t\t}\n//\t}\n\n\t// configure command name\n\tcfg.command_name = str;\n\tif (!cfg.command_name)\n\t\terrExit(\"strdup\");\n\n\t// restrict the command name to the first word\n\tchar *ptr = cfg.command_name;\n\twhile (*ptr != ' ' && *ptr != '\\t' && *ptr != '\\0')\n\t\tptr++;\n\t*ptr = '\\0';\n\n\t// remove the path: /usr/bin/firefox becomes firefox\n\tptr = strrchr(cfg.command_name, '/');\n\tif (ptr) {\n\t\tptr++;\n\t\tif (*ptr == '\\0') {\n\t\t\tfprintf(stderr, \"Error: invalid command name\\n\");\n\t\t\texit(1);\n\t\t}\n\n\t\tchar *tmp = strdup(ptr);\n\t\tif (!tmp)\n\t\t\terrExit(\"strdup\");\n\n\t\t// limit the command to the first '.'\n\t\tchar *ptr2 = tmp;\n\t\twhile (*ptr2 != '.' && *ptr2 != '\\0')\n\t\t\tptr2++;\n\t\t*ptr2 = '\\0';\n\n\t\tfree(cfg.command_name);\n\t\tcfg.command_name = tmp;\n\t}\n}"
  },
  {
    "function_name": "find_child",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "395-454",
    "snippet": "int find_child(pid_t parent, pid_t *child) {\n\tEUID_ASSERT();\n\t*child = 0;\t\t\t\t  // use it to flag a found child\n\n\tDIR *dir;\n\tEUID_ROOT();\t\t\t\t  // grsecurity fix\n\tif (!(dir = opendir(\"/proc\"))) {\n\t\t// sleep 2 seconds and try again\n\t\tsleep(2);\n\t\tif (!(dir = opendir(\"/proc\"))) {\n\t\t\tfprintf(stderr, \"Error: cannot open /proc directory\\n\");\n\t\t\texit(1);\n\t\t}\n\t}\n\n\tstruct dirent *entry;\n\tchar *end;\n\twhile (*child == 0 && (entry = readdir(dir))) {\n\t\tpid_t pid = strtol(entry->d_name, &end, 10);\n\t\tif (end == entry->d_name || *end)\n\t\t\tcontinue;\n\t\tif (pid == parent)\n\t\t\tcontinue;\n\n\t\t// open stat file\n\t\tchar *file;\n\t\tif (asprintf(&file, \"/proc/%u/status\", pid) == -1) {\n\t\t\tperror(\"asprintf\");\n\t\t\texit(1);\n\t\t}\n\t\tFILE *fp = fopen(file, \"r\");\n\t\tif (!fp) {\n\t\t\tfree(file);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// look for firejail executable name\n\t\tchar buf[BUFLEN];\n\t\twhile (fgets(buf, BUFLEN - 1, fp)) {\n\t\t\tif (strncmp(buf, \"PPid:\", 5) == 0) {\n\t\t\t\tchar *ptr = buf + 5;\n\t\t\t\twhile (*ptr != '\\0' && (*ptr == ' ' || *ptr == '\\t')) {\n\t\t\t\t\tptr++;\n\t\t\t\t}\n\t\t\t\tif (*ptr == '\\0') {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot read /proc file\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tif (parent == atoi(ptr))\n\t\t\t\t\t*child = pid;\n\t\t\t\tbreak;\t\t  // stop reading the file\n\t\t\t}\n\t\t}\n\t\tfclose(fp);\n\t\tfree(file);\n\t}\n\tclosedir(dir);\n\tEUID_USER();\n\treturn (*child)? 0:1;\t\t\t  // 0 = found, 1 = not found\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [
      "#define BUFLEN 4096"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "closedir",
          "args": [
            "dir"
          ],
          "line": 451
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "file"
          ],
          "line": 449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "ptr"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 441
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot read /proc file\\n\""
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "buf",
            "\"PPid:\"",
            "5"
          ],
          "line": 434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "buf",
            "BUFLEN - 1",
            "fp"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "file"
          ],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "file",
            "\"r\""
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "perror",
          "args": [
            "\"asprintf\""
          ],
          "line": 422
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&file",
            "\"/proc/%u/status\"",
            "pid"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strtol",
          "args": [
            "entry->d_name",
            "&end",
            "10"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "readdir",
          "args": [
            "dir"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot open /proc directory\\n\""
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opendir",
          "args": [
            "\"/proc\""
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "2"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opendir",
          "args": [
            "\"/proc\""
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define BUFLEN 4096\n\nint find_child(pid_t parent, pid_t *child) {\n\tEUID_ASSERT();\n\t*child = 0;\t\t\t\t  // use it to flag a found child\n\n\tDIR *dir;\n\tEUID_ROOT();\t\t\t\t  // grsecurity fix\n\tif (!(dir = opendir(\"/proc\"))) {\n\t\t// sleep 2 seconds and try again\n\t\tsleep(2);\n\t\tif (!(dir = opendir(\"/proc\"))) {\n\t\t\tfprintf(stderr, \"Error: cannot open /proc directory\\n\");\n\t\t\texit(1);\n\t\t}\n\t}\n\n\tstruct dirent *entry;\n\tchar *end;\n\twhile (*child == 0 && (entry = readdir(dir))) {\n\t\tpid_t pid = strtol(entry->d_name, &end, 10);\n\t\tif (end == entry->d_name || *end)\n\t\t\tcontinue;\n\t\tif (pid == parent)\n\t\t\tcontinue;\n\n\t\t// open stat file\n\t\tchar *file;\n\t\tif (asprintf(&file, \"/proc/%u/status\", pid) == -1) {\n\t\t\tperror(\"asprintf\");\n\t\t\texit(1);\n\t\t}\n\t\tFILE *fp = fopen(file, \"r\");\n\t\tif (!fp) {\n\t\t\tfree(file);\n\t\t\tcontinue;\n\t\t}\n\n\t\t// look for firejail executable name\n\t\tchar buf[BUFLEN];\n\t\twhile (fgets(buf, BUFLEN - 1, fp)) {\n\t\t\tif (strncmp(buf, \"PPid:\", 5) == 0) {\n\t\t\t\tchar *ptr = buf + 5;\n\t\t\t\twhile (*ptr != '\\0' && (*ptr == ' ' || *ptr == '\\t')) {\n\t\t\t\t\tptr++;\n\t\t\t\t}\n\t\t\t\tif (*ptr == '\\0') {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot read /proc file\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tif (parent == atoi(ptr))\n\t\t\t\t\t*child = pid;\n\t\t\t\tbreak;\t\t  // stop reading the file\n\t\t\t}\n\t\t}\n\t\tfclose(fp);\n\t\tfree(file);\n\t}\n\tclosedir(dir);\n\tEUID_USER();\n\treturn (*child)? 0:1;\t\t\t  // 0 = found, 1 = not found\n}"
  },
  {
    "function_name": "not_unsigned",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "376-390",
    "snippet": "int not_unsigned(const char *str) {\n\tEUID_ASSERT();\n\n\tint rv = 0;\n\tconst char *ptr = str;\n\twhile (*ptr != ' ' && *ptr != '\\t' && *ptr != '\\0') {\n\t\tif (!isdigit(*ptr)) {\n\t\t\trv = 1;\n\t\t\tbreak;\n\t\t}\n\t\tptr++;\n\t}\n\n\treturn rv;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "isdigit",
          "args": [
            "*ptr"
          ],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nint not_unsigned(const char *str) {\n\tEUID_ASSERT();\n\n\tint rv = 0;\n\tconst char *ptr = str;\n\twhile (*ptr != ' ' && *ptr != '\\t' && *ptr != '\\0') {\n\t\tif (!isdigit(*ptr)) {\n\t\t\trv = 1;\n\t\t\tbreak;\n\t\t}\n\t\tptr++;\n\t}\n\n\treturn rv;\n}"
  },
  {
    "function_name": "split_comma",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "361-373",
    "snippet": "char *split_comma(char *str) {\n\tEUID_ASSERT();\n\tif (str == NULL || *str == '\\0')\n\t\treturn NULL;\n\tchar *ptr = strchr(str, ',');\n\tif (!ptr)\n\t\treturn NULL;\n\t*ptr = '\\0';\n\tptr++;\n\tif (*ptr == '\\0')\n\t\treturn NULL;\n\treturn ptr;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "str",
            "','"
          ],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nchar *split_comma(char *str) {\n\tEUID_ASSERT();\n\tif (str == NULL || *str == '\\0')\n\t\treturn NULL;\n\tchar *ptr = strchr(str, ',');\n\tif (!ptr)\n\t\treturn NULL;\n\t*ptr = '\\0';\n\tptr++;\n\tif (*ptr == '\\0')\n\t\treturn NULL;\n\treturn ptr;\n}"
  },
  {
    "function_name": "line_remove_spaces",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "311-358",
    "snippet": "char *line_remove_spaces(const char *buf) {\n\tEUID_ASSERT();\n\tassert(buf);\n\tif (strlen(buf) == 0)\n\t\treturn NULL;\n\n\t// allocate memory for the new string\n\tchar *rv = malloc(strlen(buf) + 1);\n\tif (rv == NULL)\n\t\terrExit(\"malloc\");\n\n\t// remove space at start of line\n\tconst char *ptr1 = buf;\n\twhile (*ptr1 == ' ' || *ptr1 == '\\t')\n\t\tptr1++;\n\n\t// copy data and remove additional spaces\n\tchar *ptr2 = rv;\n\tint state = 0;\n\twhile (*ptr1 != '\\0') {\n\t\tif (*ptr1 == '\\n' || *ptr1 == '\\r')\n\t\t\tbreak;\n\n\t\tif (state == 0) {\n\t\t\tif (*ptr1 != ' ' && *ptr1 != '\\t')\n\t\t\t\t*ptr2++ = *ptr1++;\n\t\t\telse {\n\t\t\t\t*ptr2++ = ' ';\n\t\t\t\tptr1++;\n\t\t\t\tstate = 1;\n\t\t\t}\n\t\t}\n\t\telse {\t\t\t\t  // state == 1\n\t\t\twhile (*ptr1 == ' ' || *ptr1 == '\\t')\n\t\t\t\tptr1++;\n\t\t\tstate = 0;\n\t\t}\n\t}\n\n\t// strip last blank character if any\n\tif (ptr2 > rv && *(ptr2 - 1) == ' ')\n\t\t--ptr2;\n\t*ptr2 = '\\0';\n\t//\tif (arg_debug)\n\t//\t\tprintf(\"Processing line #%s#\\n\", rv);\n\n\treturn rv;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"malloc\""
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "strlen(buf) + 1"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "buf"
          ],
          "line": 314
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "buf"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nchar *line_remove_spaces(const char *buf) {\n\tEUID_ASSERT();\n\tassert(buf);\n\tif (strlen(buf) == 0)\n\t\treturn NULL;\n\n\t// allocate memory for the new string\n\tchar *rv = malloc(strlen(buf) + 1);\n\tif (rv == NULL)\n\t\terrExit(\"malloc\");\n\n\t// remove space at start of line\n\tconst char *ptr1 = buf;\n\twhile (*ptr1 == ' ' || *ptr1 == '\\t')\n\t\tptr1++;\n\n\t// copy data and remove additional spaces\n\tchar *ptr2 = rv;\n\tint state = 0;\n\twhile (*ptr1 != '\\0') {\n\t\tif (*ptr1 == '\\n' || *ptr1 == '\\r')\n\t\t\tbreak;\n\n\t\tif (state == 0) {\n\t\t\tif (*ptr1 != ' ' && *ptr1 != '\\t')\n\t\t\t\t*ptr2++ = *ptr1++;\n\t\t\telse {\n\t\t\t\t*ptr2++ = ' ';\n\t\t\t\tptr1++;\n\t\t\t\tstate = 1;\n\t\t\t}\n\t\t}\n\t\telse {\t\t\t\t  // state == 1\n\t\t\twhile (*ptr1 == ' ' || *ptr1 == '\\t')\n\t\t\t\tptr1++;\n\t\t\tstate = 0;\n\t\t}\n\t}\n\n\t// strip last blank character if any\n\tif (ptr2 > rv && *(ptr2 - 1) == ' ')\n\t\t--ptr2;\n\t*ptr2 = '\\0';\n\t//\tif (arg_debug)\n\t//\t\tprintf(\"Processing line #%s#\\n\", rv);\n\n\treturn rv;\n}"
  },
  {
    "function_name": "is_link",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "295-307",
    "snippet": "int is_link(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\tstruct stat s;\n\tif (lstat(fname, &s) == 0) {\n\t\tif (S_ISLNK(s.st_mode))\n\t\t\treturn 1;\n\t}\n\n\treturn 0;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "S_ISLNK",
          "args": [
            "s.st_mode"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lstat",
          "args": [
            "fname",
            "&s"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "fname"
          ],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nint is_link(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\tstruct stat s;\n\tif (lstat(fname, &s) == 0) {\n\t\tif (S_ISLNK(s.st_mode))\n\t\t\treturn 1;\n\t}\n\n\treturn 0;\n}"
  },
  {
    "function_name": "is_dir",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "264-291",
    "snippet": "int is_dir(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\t// if fname doesn't end in '/', add one\n\tint rv;\n\tstruct stat s;\n\tif (fname[strlen(fname) - 1] == '/')\n\t\trv = stat(fname, &s);\n\telse {\n\t\tchar *tmp;\n\t\tif (asprintf(&tmp, \"%s/\", fname) == -1) {\n\t\t\tfprintf(stderr, \"Error: cannot allocate memory, %s:%d\\n\", __FILE__, __LINE__);\n\t\t\terrExit(\"asprintf\");\n\t\t}\n\t\trv = stat(tmp, &s);\n\t\tfree(tmp);\n\t}\n\n\tif (rv == -1)\n\t\treturn 0;\n\n\tif (S_ISDIR(s.st_mode))\n\t\treturn 1;\n\n\treturn 0;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "s.st_mode"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "tmp"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "tmp",
            "&s"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot allocate memory, %s:%d\\n\"",
            "__FILE__",
            "__LINE__"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&tmp",
            "\"%s/\"",
            "fname"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "fname",
            "&s"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "fname"
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "fname"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nint is_dir(const char *fname) {\n\tassert(fname);\n\tif (*fname == '\\0')\n\t\treturn 0;\n\n\t// if fname doesn't end in '/', add one\n\tint rv;\n\tstruct stat s;\n\tif (fname[strlen(fname) - 1] == '/')\n\t\trv = stat(fname, &s);\n\telse {\n\t\tchar *tmp;\n\t\tif (asprintf(&tmp, \"%s/\", fname) == -1) {\n\t\t\tfprintf(stderr, \"Error: cannot allocate memory, %s:%d\\n\", __FILE__, __LINE__);\n\t\t\terrExit(\"asprintf\");\n\t\t}\n\t\trv = stat(tmp, &s);\n\t\tfree(tmp);\n\t}\n\n\tif (rv == -1)\n\t\treturn 0;\n\n\tif (S_ISDIR(s.st_mode))\n\t\treturn 1;\n\n\treturn 0;\n}"
  },
  {
    "function_name": "touch_file_as_user",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "243-261",
    "snippet": "void touch_file_as_user(const char *fname, uid_t uid, gid_t gid, mode_t mode) {\n\tpid_t child = fork();\n\tif (child < 0)\n\t\terrExit(\"fork\");\n\tif (child == 0) {\n\t\t// drop privileges\n\t\tdrop_privs(0);\n\n\t\tFILE *fp = fopen(fname, \"w\");\n\t\tif (fp) {\n\t\t\tfprintf(fp, \"\\n\");\n\t\t\tSET_PERMS_STREAM(fp, uid, gid, mode);\n\t\t\tfclose(fp);\n\t\t}\n\t\t_exit(0);\n\t}\n\t// wait for the child to finish\n\twaitpid(child, NULL, 0);\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "waitpid",
          "args": [
            "child",
            "NULL",
            "0"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exit",
          "args": [
            "0"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET_PERMS_STREAM",
          "args": [
            "fp",
            "uid",
            "gid",
            "mode"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"\\n\""
          ],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"w\""
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "drop_privs",
          "args": [
            "0"
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "drop_privs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "36-81",
          "snippet": "void drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_GROUPS 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define MAX_GROUPS 1024\n\nvoid drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"fork\""
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid touch_file_as_user(const char *fname, uid_t uid, gid_t gid, mode_t mode) {\n\tpid_t child = fork();\n\tif (child < 0)\n\t\terrExit(\"fork\");\n\tif (child == 0) {\n\t\t// drop privileges\n\t\tdrop_privs(0);\n\n\t\tFILE *fp = fopen(fname, \"w\");\n\t\tif (fp) {\n\t\t\tfprintf(fp, \"\\n\");\n\t\t\tSET_PERMS_STREAM(fp, uid, gid, mode);\n\t\t\tfclose(fp);\n\t\t}\n\t\t_exit(0);\n\t}\n\t// wait for the child to finish\n\twaitpid(child, NULL, 0);\n}"
  },
  {
    "function_name": "copy_file_as_user",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "224-240",
    "snippet": "void copy_file_as_user(const char *srcname, const char *destname, uid_t uid, gid_t gid, mode_t mode) {\n\tpid_t child = fork();\n\tif (child < 0)\n\t\terrExit(\"fork\");\n\tif (child == 0) {\n\t\t// drop privileges\n\t\tdrop_privs(0);\n\n\t\t// copy, set permissions and ownership\n\t\tint rv = copy_file(srcname, destname, uid, gid, mode);\n\t\tif (rv)\n\t\t\tfprintf(stderr, \"Warning: cannot transfer .Xauthority in private home directory\\n\");\n\t\t_exit(0);\n\t}\n\t// wait for the child to finish\n\twaitpid(child, NULL, 0);\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "waitpid",
          "args": [
            "child",
            "NULL",
            "0"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exit",
          "args": [
            "0"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Warning: cannot transfer .Xauthority in private home directory\\n\""
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "copy_file",
          "args": [
            "srcname",
            "destname",
            "uid",
            "gid",
            "mode"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "copy_file_as_user",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "224-240",
          "snippet": "void copy_file_as_user(const char *srcname, const char *destname, uid_t uid, gid_t gid, mode_t mode) {\n\tpid_t child = fork();\n\tif (child < 0)\n\t\terrExit(\"fork\");\n\tif (child == 0) {\n\t\t// drop privileges\n\t\tdrop_privs(0);\n\n\t\t// copy, set permissions and ownership\n\t\tint rv = copy_file(srcname, destname, uid, gid, mode);\n\t\tif (rv)\n\t\t\tfprintf(stderr, \"Warning: cannot transfer .Xauthority in private home directory\\n\");\n\t\t_exit(0);\n\t}\n\t// wait for the child to finish\n\twaitpid(child, NULL, 0);\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "drop_privs",
          "args": [
            "0"
          ],
          "line": 230
        },
        "resolved": true,
        "details": {
          "function_name": "drop_privs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "36-81",
          "snippet": "void drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_GROUPS 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define MAX_GROUPS 1024\n\nvoid drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"fork\""
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid copy_file_as_user(const char *srcname, const char *destname, uid_t uid, gid_t gid, mode_t mode) {\n\tpid_t child = fork();\n\tif (child < 0)\n\t\terrExit(\"fork\");\n\tif (child == 0) {\n\t\t// drop privileges\n\t\tdrop_privs(0);\n\n\t\t// copy, set permissions and ownership\n\t\tint rv = copy_file(srcname, destname, uid, gid, mode);\n\t\tif (rv)\n\t\t\tfprintf(stderr, \"Warning: cannot transfer .Xauthority in private home directory\\n\");\n\t\t_exit(0);\n\t}\n\t// wait for the child to finish\n\twaitpid(child, NULL, 0);\n}"
  },
  {
    "function_name": "copy_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "176-221",
    "snippet": "int copy_file(const char *srcname, const char *destname, uid_t uid, gid_t gid, mode_t mode) {\n\tassert(srcname);\n\tassert(destname);\n\n\t// open source\n\tint src = open(srcname, O_RDONLY);\n\tif (src < 0) {\n\t\tfprintf(stderr, \"Warning: cannot open %s, file not copied\\n\", srcname);\n\t\treturn -1;\n\t}\n\n\t// open destination\n\tint dst = open(destname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Warning: cannot open %s, file not copied\\n\", destname);\n\t\tclose(src);\n\t\treturn -1;\n\t}\n\n\t// copy\n\tssize_t len;\n\tstatic const int BUFLEN = 1024;\n\tunsigned char buf[BUFLEN];\n\twhile ((len = read(src, buf, BUFLEN)) > 0) {\n\t\tint done = 0;\n\t\twhile (done != len) {\n\t\t\tint rv = write(dst, buf + done, len - done);\n\t\t\tif (rv == -1) {\n\t\t\t\tclose(src);\n\t\t\t\tclose(dst);\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tdone += rv;\n\t\t}\n\t}\n\n\tif (fchown(dst, uid, gid) == -1)\n\t\terrExit(\"fchown\");\n\tif (fchmod(dst, mode) == -1)\n\t\terrExit(\"fchmod\");\n\n\tclose(src);\n\tclose(dst);\n\treturn 0;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [
      "#define BUFLEN 4096"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "dst"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "src"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"fchmod\""
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fchmod",
          "args": [
            "dst",
            "mode"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"fchown\""
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fchown",
          "args": [
            "dst",
            "uid",
            "gid"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "dst"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "src"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "write",
          "args": [
            "dst",
            "buf + done",
            "len - done"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "src",
            "buf",
            "BUFLEN"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "close",
          "args": [
            "src"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Warning: cannot open %s, file not copied\\n\"",
            "destname"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "destname",
            "O_CREAT|O_WRONLY|O_TRUNC",
            "S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Warning: cannot open %s, file not copied\\n\"",
            "srcname"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "srcname",
            "O_RDONLY"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "destname"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "srcname"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define BUFLEN 4096\n\nint copy_file(const char *srcname, const char *destname, uid_t uid, gid_t gid, mode_t mode) {\n\tassert(srcname);\n\tassert(destname);\n\n\t// open source\n\tint src = open(srcname, O_RDONLY);\n\tif (src < 0) {\n\t\tfprintf(stderr, \"Warning: cannot open %s, file not copied\\n\", srcname);\n\t\treturn -1;\n\t}\n\n\t// open destination\n\tint dst = open(destname, O_CREAT|O_WRONLY|O_TRUNC, S_IRUSR | S_IWUSR | S_IRGRP | S_IROTH);\n\tif (dst < 0) {\n\t\tfprintf(stderr, \"Warning: cannot open %s, file not copied\\n\", destname);\n\t\tclose(src);\n\t\treturn -1;\n\t}\n\n\t// copy\n\tssize_t len;\n\tstatic const int BUFLEN = 1024;\n\tunsigned char buf[BUFLEN];\n\twhile ((len = read(src, buf, BUFLEN)) > 0) {\n\t\tint done = 0;\n\t\twhile (done != len) {\n\t\t\tint rv = write(dst, buf + done, len - done);\n\t\t\tif (rv == -1) {\n\t\t\t\tclose(src);\n\t\t\t\tclose(dst);\n\t\t\t\treturn -1;\n\t\t\t}\n\n\t\t\tdone += rv;\n\t\t}\n\t}\n\n\tif (fchown(dst, uid, gid) == -1)\n\t\terrExit(\"fchown\");\n\tif (fchmod(dst, mode) == -1)\n\t\terrExit(\"fchmod\");\n\n\tclose(src);\n\tclose(dst);\n\treturn 0;\n}"
  },
  {
    "function_name": "logerr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "165-172",
    "snippet": "void logerr(const char *msg) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_ERR, \"%s\\n\", msg);\n\tcloselog();\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "closelog",
          "args": [],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "syslog",
          "args": [
            "LOG_ERR",
            "\"%s\\n\"",
            "msg"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "openlog",
          "args": [
            "\"firejail\"",
            "LOG_NDELAY | LOG_PID",
            "LOG_USER"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid logerr(const char *msg) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_ERR, \"%s\\n\", msg);\n\tcloselog();\n}"
  },
  {
    "function_name": "logargs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "141-162",
    "snippet": "void logargs(int argc, char **argv) {\n\tif (!arg_debug)\n\t\treturn;\n\n\tint i;\n\tint len = 0;\n\n\t// calculate message length\n\tfor (i = 0; i < argc; i++)\n\t\tlen += strlen(argv[i]) + 1;\t  // + ' '\n\n\t// build message\n\tchar msg[len + 1];\n\tchar *ptr = msg;\n\tfor (i = 0; i < argc; i++) {\n\t\tsprintf(ptr, \"%s \", argv[i]);\n\t\tptr += strlen(ptr);\n\t}\n\n\t// log message\n\tlogmsg(msg);\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "logmsg",
          "args": [
            "msg"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "logmsg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "131-138",
          "snippet": "void logmsg(const char *msg) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"%s\\n\", msg);\n\tcloselog();\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid logmsg(const char *msg) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"%s\\n\", msg);\n\tcloselog();\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "ptr"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "ptr",
            "\"%s \"",
            "argv[i]"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "argv[i]"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid logargs(int argc, char **argv) {\n\tif (!arg_debug)\n\t\treturn;\n\n\tint i;\n\tint len = 0;\n\n\t// calculate message length\n\tfor (i = 0; i < argc; i++)\n\t\tlen += strlen(argv[i]) + 1;\t  // + ' '\n\n\t// build message\n\tchar msg[len + 1];\n\tchar *ptr = msg;\n\tfor (i = 0; i < argc; i++) {\n\t\tsprintf(ptr, \"%s \", argv[i]);\n\t\tptr += strlen(ptr);\n\t}\n\n\t// log message\n\tlogmsg(msg);\n}"
  },
  {
    "function_name": "logmsg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "131-138",
    "snippet": "void logmsg(const char *msg) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"%s\\n\", msg);\n\tcloselog();\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "closelog",
          "args": [],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "syslog",
          "args": [
            "LOG_INFO",
            "\"%s\\n\"",
            "msg"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "openlog",
          "args": [
            "\"firejail\"",
            "LOG_NDELAY | LOG_PID",
            "LOG_USER"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid logmsg(const char *msg) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"%s\\n\", msg);\n\tcloselog();\n}"
  },
  {
    "function_name": "logsignal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "121-128",
    "snippet": "void logsignal(int s) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"Signal %d caught\", s);\n\tcloselog();\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "closelog",
          "args": [],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "syslog",
          "args": [
            "LOG_INFO",
            "\"Signal %d caught\"",
            "s"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "openlog",
          "args": [
            "\"firejail\"",
            "LOG_NDELAY | LOG_PID",
            "LOG_USER"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid logsignal(int s) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"Signal %d caught\", s);\n\tcloselog();\n}"
  },
  {
    "function_name": "mkpath_as_root",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "84-118",
    "snippet": "int mkpath_as_root(const char* path) {\n\tassert(path && *path);\n\n\t// work on a copy of the path\n\tchar *file_path = strdup(path);\n\tif (!file_path)\n\t\terrExit(\"strdup\");\n\n\tchar* p;\n\tint done = 0;\n\tfor (p=strchr(file_path+1, '/'); p; p=strchr(p+1, '/')) {\n\t\t*p='\\0';\n\t\tif (mkdir(file_path, 0755)==-1) {\n\t\t\tif (errno != EEXIST) {\n\t\t\t\t*p='/';\n\t\t\t\tfree(file_path);\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (chmod(file_path, 0755) == -1)\n\t\t\t\terrExit(\"chmod\");\n\t\t\tif (chown(file_path, 0, 0) == -1)\n\t\t\t\terrExit(\"chown\");\n\t\t\tdone = 1;\n\t\t}\n\n\t\t*p='/';\n\t}\n\tif (done)\n\t\tfs_logger2(\"mkpath\", path);\n\n\tfree(file_path);\n\treturn 0;\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "file_path"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs_logger2",
          "args": [
            "\"mkpath\"",
            "path"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "fs_logger2int",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_logger.c",
          "lines": "73-80",
          "snippet": "void fs_logger2int(const char *msg1, int d) {\n\tFsMsg *ptr = newmsg();\n\tchar *str;\n\tif (asprintf(&str, \"%s %d\", msg1, d) == -1)\n\t\terrExit(\"asprintf\");\n\tptr->msg = str;\n\tinsertmsg(ptr);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid fs_logger2int(const char *msg1, int d) {\n\tFsMsg *ptr = newmsg();\n\tchar *str;\n\tif (asprintf(&str, \"%s %d\", msg1, d) == -1)\n\t\terrExit(\"asprintf\");\n\tptr->msg = str;\n\tinsertmsg(ptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"chown\""
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chown",
          "args": [
            "file_path",
            "0",
            "0"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"chmod\""
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chmod",
          "args": [
            "file_path",
            "0755"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "file_path"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mkdir",
          "args": [
            "file_path",
            "0755"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "p+1",
            "'/'"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "file_path+1",
            "'/'"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "path"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "path && *path"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nint mkpath_as_root(const char* path) {\n\tassert(path && *path);\n\n\t// work on a copy of the path\n\tchar *file_path = strdup(path);\n\tif (!file_path)\n\t\terrExit(\"strdup\");\n\n\tchar* p;\n\tint done = 0;\n\tfor (p=strchr(file_path+1, '/'); p; p=strchr(p+1, '/')) {\n\t\t*p='\\0';\n\t\tif (mkdir(file_path, 0755)==-1) {\n\t\t\tif (errno != EEXIST) {\n\t\t\t\t*p='/';\n\t\t\t\tfree(file_path);\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (chmod(file_path, 0755) == -1)\n\t\t\t\terrExit(\"chmod\");\n\t\t\tif (chown(file_path, 0, 0) == -1)\n\t\t\t\terrExit(\"chown\");\n\t\t\tdone = 1;\n\t\t}\n\n\t\t*p='/';\n\t}\n\tif (done)\n\t\tfs_logger2(\"mkpath\", path);\n\n\tfree(file_path);\n\treturn 0;\n}"
  },
  {
    "function_name": "drop_privs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
    "lines": "36-81",
    "snippet": "void drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}",
    "includes": [
      "#include <sys/wait.h>",
      "#include <termios.h>",
      "#include <sys/ioctl.h>",
      "#include <grp.h>",
      "#include <dirent.h>",
      "#include <errno.h>",
      "#include <syslog.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <ftw.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [
      "#define MAX_GROUPS 1024"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setuid/getuid\""
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setuid",
          "args": [
            "getuid()"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setgid/getgid\""
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgid",
          "args": [
            "getgid()"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getgid",
          "args": [],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setgroups\""
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "0",
            "NULL"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Warning: cannot set supplementary group list, dropping them\\n\""
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "ngroups",
            "groups"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setgroups\""
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "0",
            "NULL"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Warning: cannot extract supplementary group list, dropping them\\n\""
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%u, \"",
            "groups[i]"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Username %s, groups \"",
            "cfg.username"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getgrouplist",
          "args": [
            "cfg.username",
            "gid",
            "groups",
            "&ngroups"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "cfg.username"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Username %s, no supplementary groups\\n\"",
            "cfg.username"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setgroups\""
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setgroups",
          "args": [
            "0",
            "NULL"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getgid",
          "args": [],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define MAX_GROUPS 1024\n\nvoid drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}"
  }
]