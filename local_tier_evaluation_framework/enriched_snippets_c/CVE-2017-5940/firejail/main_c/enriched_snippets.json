[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "858-1153",
    "snippet": "int main(int argc, char **argv) {\n\tint i;\n\tint prog_index = -1;\t\t\t  // index in argv where the program command starts\n\tint lockfd = -1;\n\tint option_cgroup = 0;\n\tint option_force = 0;\n\tint custom_profile = 0;\t// custom profile loaded\n\tchar *custom_profile_dir = NULL; // custom profile directory\n\tint arg_noprofile = 0; // use default.profile if none other found/specified\n#ifdef HAVE_SECCOMP\n\tint highest_errno = errno_highest_nr();\n#endif\n\n\tdetect_quiet(argc, argv);\n\tdetect_allow_debuggers(argc, argv);\n\n\t// drop permissions by default and rise them when required\n\tEUID_INIT();\n\tEUID_USER();\n\n\n\t// check argv[0] symlink wrapper if this is not a login shell\n\tif (*argv[0] != '-')\n\t\trun_symlink(argc, argv);\n\n\t// check if we already have a sandbox running\n\t// If LXC is detected, start firejail sandbox\n\t// otherwise try to detect a PID namespace by looking under /proc for specific kernel processes and:\n\t//\t- if --force flag is set, start firejail sandbox\n\t//\t-- if --force flag is not set, start the application in a /bin/bash shell \n\tif (check_namespace_virt() == 0) {\n\t\tEUID_ROOT();\n\t\tint rv = check_kernel_procs();\n\t\tEUID_USER();\n\t\tif (rv == 0) {\n\t\t\t// if --force option is passed to the program, disregard the existing sandbox\n\t\t\tint found = 0;\n\t\t\tfor (i = 1; i < argc; i++) {\n\t\t\t\tif (strcmp(argv[i], \"--force\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--list\") == 0 ||\t\n\t\t\t\t    strcmp(argv[i], \"--netstats\") == 0 ||\t\n\t\t\t\t    strcmp(argv[i], \"--tree\") == 0 ||\t\n\t\t\t\t    strcmp(argv[i], \"--top\") == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--ls=\", 5) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--get=\", 6) == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--debug-caps\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--debug-errnos\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--debug-syscalls\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--debug-protocols\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--help\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--version\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--overlay-clean\") == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--dns.print=\", 12) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--bandwidth=\", 12) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--caps.print=\", 13) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--cpu.print=\", 12) == 0 ||\n\t//********************************************************************************\n\t// todo: fix the following problems\n\t\t\t\t    strncmp(argv[i], \"--join=\", 7) == 0 ||\n\t//[netblue@debian Downloads]$ firejail --join=896\n\t//Switching to pid 897, the first child process inside the sandbox\n\t//Error: seccomp file not found\n\t//********************************************************************************\n\t\n\t\t\t\t    strncmp(argv[i], \"--join-filesystem=\", 18) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--join-network=\", 15) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--fs.print=\", 11) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--protocol.print=\", 17) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--seccomp.print\", 15) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--shutdown=\", 11) == 0) {\n\t\t\t\t\tfound = 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\n\t\t\t\t// detect end of firejail params\n\t\t\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\t\t\tbreak;\n\t\t\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tif (found == 0) {\n\t\t\t\t// start the program directly without sandboxing\n\t\t\t\trun_no_sandbox(argc, argv);\n\t\t\t\t// it will never get here!\n\t\t\t\tassert(0);\n\t\t\t}\n\t\t\telse\n\t\t\t\toption_force = 1;\n\t\t}\n\t}\n\t\n\t// check root/suid\n\tEUID_ROOT();\n\tif (geteuid()) {\n\t\t// detect --version\n\t\tfor (i = 1; i < argc; i++) {\n\t\t\tif (strcmp(argv[i], \"--version\") == 0) {\n\t\t\t\tprintf(\"firejail version %s\\n\", VERSION);\n\t\t\t\texit(0);\n\t\t\t}\n\t\t\t\n\t\t\t// detect end of firejail params\n\t\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\t\tbreak;\n\t\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\t\tbreak;\n\t\t}\n\t\texit(1);\n\t}\n\tEUID_USER();\n\n\t// initialize globals\n\tinit_cfg(argc, argv);\n\n\n\t// check firejail directories\n\tEUID_ROOT();\n\tfs_build_firejail_dir();\n\tbandwidth_del_run_file(sandbox_pid);\n\tnetwork_del_run_file(sandbox_pid);\n\tdelete_name_file(sandbox_pid);\n\tdelete_x11_file(sandbox_pid);\n\t\n\tEUID_USER();\n\t\n\t//check if the parent is sshd daemon\n\tint parent_sshd = 0;\n\t{\n\t\tpid_t ppid = getppid();\n\t\tEUID_ROOT();\n\t\tchar *comm = pid_proc_comm(ppid);\n\t\tEUID_USER();\n\t\tif (comm) {\n\t\t\tif (strcmp(comm, \"sshd\") == 0) {\n\t\t\t\targ_quiet = 1;\n\t\t\t\tparent_sshd = 1;\n\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t\t{EUID_ROOT();\n\t\t\t\tFILE *fp = fopen(\"/firelog\", \"w\");\n\t\t\t\tif (fp) {\n\t\t\t\t\tint i;\n\t\t\t\t\tfprintf(fp, \"argc %d: \", argc);\n\t\t\t\t\tfor (i = 0; i < argc; i++)\n\t\t\t\t\t\tfprintf(fp, \"#%s# \", argv[i]);\n\t\t\t\t\tfprintf(fp, \"\\n\");\n\t\t\t\t\tfclose(fp);\n\t\t\t\t}\n\t\t\t\tEUID_USER();}\n#endif\n\t\t\t\t// run sftp and scp directly without any sandboxing\n\t\t\t\t// regular login has argv[0] == \"-firejail\"\n\t\t\t\tif (*argv[0] != '-') {\n\t\t\t\t\tif (strcmp(argv[1], \"-c\") == 0 && argc > 2) {\n\t\t\t\t\t\tif (strcmp(argv[2], \"/usr/lib/openssh/sftp-server\") == 0 ||\n\t\t\t\t\t\t    strncmp(argv[2], \"scp \", 4) == 0) {\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t\t\t\t\t{EUID_ROOT();\n\t\t\t\t\t\t\tFILE *fp = fopen(\"/firelog\", \"a\");\n\t\t\t\t\t\t\tif (fp) {\n\t\t\t\t\t\t\t\tfprintf(fp, \"run without a sandbox\\n\");\n\t\t\t\t\t\t\t\tfclose(fp);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tEUID_USER();}\n#endif\n\t\t\t\t\t\t    \n\t\t\t\t\t\t    \tdrop_privs(1);\n\t\t\t\t\t\t    \tint rv = system(argv[2]);\n\t\t\t\t\t\t    \texit(rv);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfree(comm);\n\t\t}\n\t}\n\t\n\t// is this a login shell, or a command passed by sshd, insert command line options from /etc/firejail/login.users\n\tif (*argv[0] == '-' || parent_sshd) {\n\t\tif (argc == 1)\n\t\t\tlogin_shell = 1;\n\t\tfullargc = restricted_shell(cfg.username);\n\t\tif (fullargc) {\n\t\t\t\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t{EUID_ROOT();\n\t\t\tFILE *fp = fopen(\"/firelog\", \"a\");\n\t\t\tif (fp) {\n\t\t\t\tfprintf(fp, \"fullargc %d: \",  fullargc);\n\t\t\t\tint i;\n\t\t\t\tfor (i = 0; i < fullargc; i++)\n\t\t\t\t\tfprintf(fp, \"#%s# \", fullargv[i]);\n\t\t\t\tfprintf(fp, \"\\n\");\n\t\t\t\tfclose(fp);\n\t\t\t}\n\t\t\tEUID_USER();}\n#endif\n\t\t\t\n\t\t\tint j;\n\t\t\tfor (i = 1, j = fullargc; i < argc && j < MAX_ARGS; i++, j++, fullargc++)\n\t\t\t\tfullargv[j] = argv[i];\n\n\t\t\t// replace argc/argv with fullargc/fullargv\n\t\t\targv = fullargv;\n\t\t\targc = j;\n\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t{EUID_ROOT();\n\t\t\tFILE *fp = fopen(\"/firelog\", \"a\");\n\t\t\tif (fp) {\n\t\t\t\tfprintf(fp, \"argc %d: \", argc);\n\t\t\t\tint i;\n\t\t\t\tfor (i = 0; i < argc; i++)\n\t\t\t\t\tfprintf(fp, \"#%s# \", argv[i]);\n\t\t\t\tfprintf(fp, \"\\n\");\n\t\t\t\tfclose(fp);\n\t\t\t}\n\t\t\tEUID_USER();}\n#endif\n\t\t}\n\t}\n\telse {\n\t\t// check --output option and execute it;\n\t\tcheck_output(argc, argv); // the function will not return if --output option was found\n\t}\n\t\n\t\n\t// check for force-nonewprivs in /etc/firejail/firejail.config file\n\tif (checkcfg(CFG_FORCE_NONEWPRIVS))\n\t\targ_nonewprivs = 1;\n\t\n\tif (arg_allow_debuggers) {\n\t\tchar *cmd = strdup(\"noblacklist ${PATH}/strace\");\n\t\tif (!cmd)\n\t\t\terrExit(\"strdup\");\n\t\tprofile_add(cmd);\n\t}\n\t\n\t// parse arguments\n\tfor (i = 1; i < argc; i++) {\n\t\trun_cmd_and_exit(i, argc, argv); // will exit if the command is recognized\n\t\t\n\t\tif (strcmp(argv[i], \"--debug\") == 0) {\n\t\t\tif (!arg_quiet) {\n\t\t\t\targ_debug = 1;\n\t\t\t\tif (option_force)\n\t\t\t\t\tprintf(\"Entering sandbox-in-sandbox mode\\n\");\n\t\t\t}\n\t\t}\n\t\telse if (strcmp(argv[i], \"--debug-check-filename\") == 0)\n\t\t\targ_debug_check_filename = 1;\n\t\telse if (strcmp(argv[i], \"--debug-blacklists\") == 0)\n\t\t\targ_debug_blacklists = 1;\n\t\telse if (strcmp(argv[i], \"--debug-whitelists\") == 0)\n\t\t\targ_debug_whitelists = 1;\n\t\telse if (strcmp(argv[i], \"--quiet\") == 0) {\n\t\t\targ_quiet = 1;\n\t\t\targ_debug = 0;\n\t\t}\n\t\telse if (strcmp(argv[i], \"--force\") == 0)\n\t\t\t;\n\t\telse if (strcmp(argv[i], \"--allow-debuggers\") == 0) {\n\t\t\t// already handled\n\t\t}\n\n\t\t//*************************************\n\t\t// filtering\n\t\t//*************************************\n#ifdef HAVE_APPARMOR\n\t\telse if (strcmp(argv[i], \"--apparmor\") == 0)\n\t\t\targ_apparmor = 1;\n#endif\t\n#ifdef HAVE_SECCOMP\n\t\telse if (strncmp(argv[i], \"--protocol=\", 11) == 0) {\n\t\t\tif (checkcfg(CFG_SECCOMP)) {\n\t\t\t\tprotocol_store(argv[i] + 11);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfprintf(stderr, \"Error: seccomp feature is disabled in Firejail configuration file\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse if (strcmp(argv[i], \"--seccomp\") == 0) {\n\t\t\tif (checkcfg(CFG_SECCOMP)) {\n\t\t\t\tif (arg_seccomp) {\n\t\t\t\t\tfprintf(stderr, \"Error: seccomp already enabled\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\targ_seccomp = 1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfprintf(stderr, \"Error: seccomp feature is disabled in Firejail configuration file\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "Config cfg;",
      "int arg_debug = 0;",
      "int arg_debug_check_filename;",
      "int arg_debug_blacklists;",
      "int arg_debug_whitelists;",
      "int arg_seccomp = 0;",
      "int arg_nonewprivs = 0;",
      "int arg_quiet = 0;",
      "int arg_apparmor = 0;",
      "int arg_allow_debuggers = 0;",
      "int login_shell = 0;",
      "char *fullargv[MAX_ARGS];",
      "int fullargc = 0;",
      "static pid_t child = 0;",
      "pid_t sandbox_pid;",
      "static void set_name_file(pid_t pid);",
      "static void delete_name_file(pid_t pid);",
      "static void delete_x11_file(pid_t pid);",
      "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
      "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
      "pid_t pid;",
      "pid_t pid;",
      "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
      "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 1151
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: seccomp feature is disabled in Firejail configuration file\\n\""
          ],
          "line": 1150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: seccomp already enabled\\n\""
          ],
          "line": 1144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "seccomp\") == 0) {\n\t\t\tif",
          "args": [
            "checkcfg(CFG_SECCOMP)"
          ],
          "line": 1141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkcfg",
          "args": [
            "CFG_SECCOMP"
          ],
          "line": 1142
        },
        "resolved": true,
        "details": {
          "function_name": "checkcfg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/checkcfg.c",
          "lines": "32-286",
          "snippet": "int checkcfg(int val) {\n\tassert(val < CFG_MAX);\n\tint line = 0;\n\n\tif (!initialized) {\n\t\t// initialize defaults\n\t\tint i;\n\t\tfor (i = 0; i < CFG_MAX; i++)\n\t\t\tcfg_val[i] = 1; // most of them are enabled by default\n\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 0; // disabled by default\n\t\tcfg_val[CFG_FORCE_NONEWPRIVS] = 0; // disabled by default\n\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 0; // disabled by default\n\t\t\n\t\t// open configuration file\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"%s/firejail.config\", SYSCONFDIR) == -1)\n\t\t\terrExit(\"asprintf\");\n\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n#ifdef HAVE_GLOBALCFG\t\t\t\n\t\t\tfprintf(stderr, \"Error: Firejail configuration file %s not found\\n\", fname);\n\t\t\texit(1);\n#else\n\t\t\tinitialized = 1;\n\t\t\treturn\tcfg_val[val];\n#endif\t\n\t\t}\n\t\t\n\t\t// if the file exists, it should be owned by root\n\t\tstruct stat s;\n\t\tif (stat(fname, &s) == -1)\n\t\t\terrExit(\"stat\");\n\t\tif (s.st_uid != 0) {\n\t\t\tfprintf(stderr, \"Error: configuration file should be owned by root\\n\");\n\t\t\texit(1);\n\t\t}\n\n\t\t// read configuration file\n\t\tchar buf[MAX_READ];\n\t\twhile (fgets(buf,MAX_READ, fp)) {\n\t\t\tline++;\n\t\t\tif (*buf == '#' || *buf == '\\n') \n\t\t\t\tcontinue;\n\n\t\t\t// parse line\t\t\t\t\n\t\t\tchar *ptr = line_remove_spaces(buf);\n\t\t\tif (!ptr)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// file transfer\t\n\t\t\tif (strncmp(ptr, \"file-transfer \", 14) == 0) {\n\t\t\t\tif (strcmp(ptr + 14, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_FILE_TRANSFER] = 1;\n\t\t\t\telse if (strcmp(ptr + 14, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_FILE_TRANSFER] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// x11\n\t\t\telse if (strncmp(ptr, \"x11 \", 4) == 0) {\n\t\t\t\tif (strcmp(ptr + 4, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_X11] = 1;\n\t\t\t\telse if (strcmp(ptr + 4, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_X11] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// bind\n\t\t\telse if (strncmp(ptr, \"bind \", 5) == 0) {\n\t\t\t\tif (strcmp(ptr + 5, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_BIND] = 1;\n\t\t\t\telse if (strcmp(ptr + 5, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_BIND] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// user namespace\n\t\t\telse if (strncmp(ptr, \"userns \", 7) == 0) {\n\t\t\t\tif (strcmp(ptr + 7, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_USERNS] = 1;\n\t\t\t\telse if (strcmp(ptr + 7, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_USERNS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// chroot\n\t\t\telse if (strncmp(ptr, \"chroot \", 7) == 0) {\n\t\t\t\tif (strcmp(ptr + 7, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT] = 1;\n\t\t\t\telse if (strcmp(ptr + 7, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// nonewprivs\n\t\t\telse if (strncmp(ptr, \"force-nonewprivs \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 1;\n\t\t\t\telse if (strcmp(ptr + 17, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// seccomp\n\t\t\telse if (strncmp(ptr, \"seccomp \", 8) == 0) {\n\t\t\t\tif (strcmp(ptr + 8, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 1;\n\t\t\t\telse if (strcmp(ptr + 8, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// whitelist\n\t\t\telse if (strncmp(ptr, \"whitelist \", 10) == 0) {\n\t\t\t\tif (strcmp(ptr + 10, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_WHITELIST] = 1;\n\t\t\t\telse if (strcmp(ptr + 10, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_WHITELIST] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// network\n\t\t\telse if (strncmp(ptr, \"network \", 8) == 0) {\n\t\t\t\tif (strcmp(ptr + 8, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_NETWORK] = 1;\n\t\t\t\telse if (strcmp(ptr + 8, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_NETWORK] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// network\n\t\t\telse if (strncmp(ptr, \"restricted-network \", 19) == 0) {\n\t\t\t\tif (strcmp(ptr + 19, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 1;\n\t\t\t\telse if (strcmp(ptr + 19, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// netfilter\n\t\t\telse if (strncmp(ptr, \"netfilter-default \", 18) == 0) {\n\t\t\t\tchar *fname = ptr + 18;\n\t\t\t\twhile (*fname == ' ' || *fname == '\\t')\n\t\t\t\t\tptr++;\n\t\t\t\tchar *end = strchr(fname, ' ');\n\t\t\t\tif (end)\n\t\t\t\t\t*end = '\\0';\n\t\t\t\t\n\t\t\t\t// is the file present?\n\t\t\t\tstruct stat s;\n\t\t\t\tif (stat(fname, &s) == -1) {\n\t\t\t\t\tfprintf(stderr, \"Error: netfilter-default file %s not available\\n\", fname);\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tnetfilter_default = strdup(fname);\n\t\t\t\tif (!netfilter_default)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tprintf(\"netfilter default file %s\\n\", fname);\n\t\t\t}\n\t\t\t\n\t\t\t// Xephyr screen size\n\t\t\telse if (strncmp(ptr, \"xephyr-screen \", 14) == 0) {\n\t\t\t\t// expecting two numbers and an x between them\n\t\t\t\tint n1;\n\t\t\t\tint n2;\n\t\t\t\tint rv = sscanf(ptr + 14, \"%dx%d\", &n1, &n2);\n\t\t\t\tif (rv != 2)\n\t\t\t\t\tgoto errout;\n\t\t\t\tif (asprintf(&xephyr_screen, \"%dx%d\", n1, n2) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t}\n\t\n\t\t\t// xephyr window title\n\t\t\telse if (strncmp(ptr, \"xephyr-window-title \", 20) == 0) {\n\t\t\t\tif (strcmp(ptr + 20, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_XEPHYR_WINDOW_TITLE] = 1;\n\t\t\t\telse if (strcmp(ptr + 20, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_XEPHYR_WINDOW_TITLE] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t\t\n\t\t\t// Xephyr command extra parameters\n\t\t\telse if (strncmp(ptr, \"xephyr-extra-params \", 19) == 0) {\n\t\t\t\txephyr_extra_params = strdup(ptr + 19);\n\t\t\t\tif (!xephyr_extra_params)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t}\n\t\t\t\n\t\t\t// quiet by default\n\t\t\telse if (strncmp(ptr, \"quiet-by-default \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\targ_quiet = 1;\n\t\t\t}\n\t\t\t// remount /proc and /sys\n\t\t\telse if (strncmp(ptr, \"remount-proc-sys \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_REMOUNT_PROC_SYS] = 1;\n\t\t\t\telse if (strcmp(ptr + 17, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_REMOUNT_PROC_SYS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"overlayfs \", 10) == 0) {\n\t\t\t\tif (strcmp(ptr + 10, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_OVERLAYFS] = 1;\n\t\t\t\telse if (strcmp(ptr + 10, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_OVERLAYFS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"private-home \", 13) == 0) {\n\t\t\t\tif (strcmp(ptr + 13, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_HOME] = 1;\n\t\t\t\telse if (strcmp(ptr + 13, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_HOME] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"chroot-desktop \", 15) == 0) {\n\t\t\t\tif (strcmp(ptr + 15, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT_DESKTOP] = 1;\n\t\t\t\telse if (strcmp(ptr + 15, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT_DESKTOP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"private-bin-no-local \", 21) == 0) {\n\t\t\t\tif (strcmp(ptr + 21, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 1;\n\t\t\t\telse if (strcmp(ptr + 21, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse\n\t\t\t\tgoto errout;\n\n\t\t\tfree(ptr);\n\t\t}\n\n\t\tfclose(fp);\n\t\tfree(fname);\n\t\tinitialized = 1;\n\t}\n\t\n\treturn cfg_val[val];\n\t\nerrout:\n\tfprintf(stderr, \"Error: invalid line %d in firejail configuration file\\n\", line );\n\texit(1);\n}",
          "includes": [
            "#include <linux/loop.h>",
            "#include <sys/stat.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_READ 8192\t\t\t\t  // line buffer for profile files"
          ],
          "globals_used": [
            "static int initialized = 0;",
            "static int cfg_val[CFG_MAX];",
            "char *xephyr_screen = \"800x600\";",
            "char *xephyr_extra_params = \"\";",
            "char *netfilter_default = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/loop.h>\n#include <sys/stat.h>\n#include \"firejail.h\"\n\n#define MAX_READ 8192\t\t\t\t  // line buffer for profile files\n\nstatic int initialized = 0;\nstatic int cfg_val[CFG_MAX];\nchar *xephyr_screen = \"800x600\";\nchar *xephyr_extra_params = \"\";\nchar *netfilter_default = NULL;\n\nint checkcfg(int val) {\n\tassert(val < CFG_MAX);\n\tint line = 0;\n\n\tif (!initialized) {\n\t\t// initialize defaults\n\t\tint i;\n\t\tfor (i = 0; i < CFG_MAX; i++)\n\t\t\tcfg_val[i] = 1; // most of them are enabled by default\n\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 0; // disabled by default\n\t\tcfg_val[CFG_FORCE_NONEWPRIVS] = 0; // disabled by default\n\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 0; // disabled by default\n\t\t\n\t\t// open configuration file\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"%s/firejail.config\", SYSCONFDIR) == -1)\n\t\t\terrExit(\"asprintf\");\n\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n#ifdef HAVE_GLOBALCFG\t\t\t\n\t\t\tfprintf(stderr, \"Error: Firejail configuration file %s not found\\n\", fname);\n\t\t\texit(1);\n#else\n\t\t\tinitialized = 1;\n\t\t\treturn\tcfg_val[val];\n#endif\t\n\t\t}\n\t\t\n\t\t// if the file exists, it should be owned by root\n\t\tstruct stat s;\n\t\tif (stat(fname, &s) == -1)\n\t\t\terrExit(\"stat\");\n\t\tif (s.st_uid != 0) {\n\t\t\tfprintf(stderr, \"Error: configuration file should be owned by root\\n\");\n\t\t\texit(1);\n\t\t}\n\n\t\t// read configuration file\n\t\tchar buf[MAX_READ];\n\t\twhile (fgets(buf,MAX_READ, fp)) {\n\t\t\tline++;\n\t\t\tif (*buf == '#' || *buf == '\\n') \n\t\t\t\tcontinue;\n\n\t\t\t// parse line\t\t\t\t\n\t\t\tchar *ptr = line_remove_spaces(buf);\n\t\t\tif (!ptr)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// file transfer\t\n\t\t\tif (strncmp(ptr, \"file-transfer \", 14) == 0) {\n\t\t\t\tif (strcmp(ptr + 14, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_FILE_TRANSFER] = 1;\n\t\t\t\telse if (strcmp(ptr + 14, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_FILE_TRANSFER] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// x11\n\t\t\telse if (strncmp(ptr, \"x11 \", 4) == 0) {\n\t\t\t\tif (strcmp(ptr + 4, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_X11] = 1;\n\t\t\t\telse if (strcmp(ptr + 4, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_X11] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// bind\n\t\t\telse if (strncmp(ptr, \"bind \", 5) == 0) {\n\t\t\t\tif (strcmp(ptr + 5, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_BIND] = 1;\n\t\t\t\telse if (strcmp(ptr + 5, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_BIND] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// user namespace\n\t\t\telse if (strncmp(ptr, \"userns \", 7) == 0) {\n\t\t\t\tif (strcmp(ptr + 7, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_USERNS] = 1;\n\t\t\t\telse if (strcmp(ptr + 7, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_USERNS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// chroot\n\t\t\telse if (strncmp(ptr, \"chroot \", 7) == 0) {\n\t\t\t\tif (strcmp(ptr + 7, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT] = 1;\n\t\t\t\telse if (strcmp(ptr + 7, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// nonewprivs\n\t\t\telse if (strncmp(ptr, \"force-nonewprivs \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 1;\n\t\t\t\telse if (strcmp(ptr + 17, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// seccomp\n\t\t\telse if (strncmp(ptr, \"seccomp \", 8) == 0) {\n\t\t\t\tif (strcmp(ptr + 8, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 1;\n\t\t\t\telse if (strcmp(ptr + 8, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// whitelist\n\t\t\telse if (strncmp(ptr, \"whitelist \", 10) == 0) {\n\t\t\t\tif (strcmp(ptr + 10, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_WHITELIST] = 1;\n\t\t\t\telse if (strcmp(ptr + 10, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_WHITELIST] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// network\n\t\t\telse if (strncmp(ptr, \"network \", 8) == 0) {\n\t\t\t\tif (strcmp(ptr + 8, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_NETWORK] = 1;\n\t\t\t\telse if (strcmp(ptr + 8, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_NETWORK] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// network\n\t\t\telse if (strncmp(ptr, \"restricted-network \", 19) == 0) {\n\t\t\t\tif (strcmp(ptr + 19, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 1;\n\t\t\t\telse if (strcmp(ptr + 19, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// netfilter\n\t\t\telse if (strncmp(ptr, \"netfilter-default \", 18) == 0) {\n\t\t\t\tchar *fname = ptr + 18;\n\t\t\t\twhile (*fname == ' ' || *fname == '\\t')\n\t\t\t\t\tptr++;\n\t\t\t\tchar *end = strchr(fname, ' ');\n\t\t\t\tif (end)\n\t\t\t\t\t*end = '\\0';\n\t\t\t\t\n\t\t\t\t// is the file present?\n\t\t\t\tstruct stat s;\n\t\t\t\tif (stat(fname, &s) == -1) {\n\t\t\t\t\tfprintf(stderr, \"Error: netfilter-default file %s not available\\n\", fname);\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tnetfilter_default = strdup(fname);\n\t\t\t\tif (!netfilter_default)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tprintf(\"netfilter default file %s\\n\", fname);\n\t\t\t}\n\t\t\t\n\t\t\t// Xephyr screen size\n\t\t\telse if (strncmp(ptr, \"xephyr-screen \", 14) == 0) {\n\t\t\t\t// expecting two numbers and an x between them\n\t\t\t\tint n1;\n\t\t\t\tint n2;\n\t\t\t\tint rv = sscanf(ptr + 14, \"%dx%d\", &n1, &n2);\n\t\t\t\tif (rv != 2)\n\t\t\t\t\tgoto errout;\n\t\t\t\tif (asprintf(&xephyr_screen, \"%dx%d\", n1, n2) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t}\n\t\n\t\t\t// xephyr window title\n\t\t\telse if (strncmp(ptr, \"xephyr-window-title \", 20) == 0) {\n\t\t\t\tif (strcmp(ptr + 20, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_XEPHYR_WINDOW_TITLE] = 1;\n\t\t\t\telse if (strcmp(ptr + 20, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_XEPHYR_WINDOW_TITLE] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t\t\n\t\t\t// Xephyr command extra parameters\n\t\t\telse if (strncmp(ptr, \"xephyr-extra-params \", 19) == 0) {\n\t\t\t\txephyr_extra_params = strdup(ptr + 19);\n\t\t\t\tif (!xephyr_extra_params)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t}\n\t\t\t\n\t\t\t// quiet by default\n\t\t\telse if (strncmp(ptr, \"quiet-by-default \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\targ_quiet = 1;\n\t\t\t}\n\t\t\t// remount /proc and /sys\n\t\t\telse if (strncmp(ptr, \"remount-proc-sys \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_REMOUNT_PROC_SYS] = 1;\n\t\t\t\telse if (strcmp(ptr + 17, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_REMOUNT_PROC_SYS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"overlayfs \", 10) == 0) {\n\t\t\t\tif (strcmp(ptr + 10, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_OVERLAYFS] = 1;\n\t\t\t\telse if (strcmp(ptr + 10, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_OVERLAYFS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"private-home \", 13) == 0) {\n\t\t\t\tif (strcmp(ptr + 13, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_HOME] = 1;\n\t\t\t\telse if (strcmp(ptr + 13, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_HOME] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"chroot-desktop \", 15) == 0) {\n\t\t\t\tif (strcmp(ptr + 15, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT_DESKTOP] = 1;\n\t\t\t\telse if (strcmp(ptr + 15, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT_DESKTOP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"private-bin-no-local \", 21) == 0) {\n\t\t\t\tif (strcmp(ptr + 21, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 1;\n\t\t\t\telse if (strcmp(ptr + 21, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse\n\t\t\t\tgoto errout;\n\n\t\t\tfree(ptr);\n\t\t}\n\n\t\tfclose(fp);\n\t\tfree(fname);\n\t\tinitialized = 1;\n\t}\n\t\n\treturn cfg_val[val];\n\t\nerrout:\n\tfprintf(stderr, \"Error: invalid line %d in firejail configuration file\\n\", line );\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: seccomp feature is disabled in Firejail configuration file\\n\""
          ],
          "line": 1137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "protocol_store",
          "args": [
            "argv[i] + 11"
          ],
          "line": 1134
        },
        "resolved": true,
        "details": {
          "function_name": "protocol_store",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/protocol.c",
          "lines": "121-156",
          "snippet": "void protocol_store(const char *prlist) {\n\tEUID_ASSERT();\n\tassert(prlist);\n\t\n\tif (cfg.protocol && !arg_quiet) {\n\t\tfprintf(stderr, \"Warning: a protocol list is present, the new list \\\"%s\\\" will not be installed\\n\", prlist);\n\t\treturn;\n\t}\n\t\n\t// temporary list\n\tchar *tmplist = strdup(prlist);\n\tif (!tmplist)\n\t\terrExit(\"strdup\");\n\t\n\t// check list\n\tchar *token = strtok(tmplist, \",\");\n\tif (!token)\n\t\tgoto errout;\n\t\t\n\twhile (token) {\n\t\tif (!is_protocol(token))\n\t\t\tgoto errout;\n\t\ttoken = strtok(NULL, \",\");\n\t}\t\n\tfree(tmplist);\n\t\n\t// store list\n\tcfg.protocol = strdup(prlist);\n\tif (!cfg.protocol)\n\t\terrExit(\"strdup\");\n\treturn;\n\t\t\nerrout:\n\tfprintf(stderr, \"Error: invalid protocol list\\n\");\n\texit(1);\n}",
          "includes": [
            "#include <sys/socket.h>",
            "#include <sys/types.h>",
            "#include \"seccomp.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/socket.h>\n#include <sys/types.h>\n#include \"seccomp.h\"\n#include \"firejail.h\"\n\nvoid protocol_store(const char *prlist) {\n\tEUID_ASSERT();\n\tassert(prlist);\n\t\n\tif (cfg.protocol && !arg_quiet) {\n\t\tfprintf(stderr, \"Warning: a protocol list is present, the new list \\\"%s\\\" will not be installed\\n\", prlist);\n\t\treturn;\n\t}\n\t\n\t// temporary list\n\tchar *tmplist = strdup(prlist);\n\tif (!tmplist)\n\t\terrExit(\"strdup\");\n\t\n\t// check list\n\tchar *token = strtok(tmplist, \",\");\n\tif (!token)\n\t\tgoto errout;\n\t\t\n\twhile (token) {\n\t\tif (!is_protocol(token))\n\t\t\tgoto errout;\n\t\ttoken = strtok(NULL, \",\");\n\t}\t\n\tfree(tmplist);\n\t\n\t// store list\n\tcfg.protocol = strdup(prlist);\n\tif (!cfg.protocol)\n\t\terrExit(\"strdup\");\n\treturn;\n\t\t\nerrout:\n\tfprintf(stderr, \"Error: invalid protocol list\\n\");\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--allow-debuggers\""
          ],
          "line": 1120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--force\""
          ],
          "line": 1118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--quiet\""
          ],
          "line": 1114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--debug-whitelists\""
          ],
          "line": 1112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--debug-blacklists\""
          ],
          "line": 1110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--debug-check-filename\""
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Entering sandbox-in-sandbox mode\\n\""
          ],
          "line": 1105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--debug\""
          ],
          "line": 1101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "run_cmd_and_exit",
          "args": [
            "i",
            "argc",
            "argv"
          ],
          "line": 1099
        },
        "resolved": true,
        "details": {
          "function_name": "run_cmd_and_exit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "259-312",
          "snippet": "static void run_cmd_and_exit(int i, int argc, char **argv) {\n\tEUID_ASSERT();\n\t\n\t//*************************************\n\t// basic arguments\n\t//*************************************\n\tif (strcmp(argv[i], \"--help\") == 0 ||\n\t    strcmp(argv[i], \"-?\") == 0) {\n\t\tusage();\n\t\texit(0);\n\t}\n\telse if (strcmp(argv[i], \"--version\") == 0) {\n\t\tprintf(\"firejail version %s\\n\", VERSION);\n\t\tprintf(\"\\n\");\n\t\tprint_compiletime_support();\n\t\tprintf(\"\\n\");\n\t\texit(0);\n\t}\n#ifdef HAVE_OVERLAYFS\n\telse if (strcmp(argv[i], \"--overlay-clean\") == 0) {\n\t\tif (checkcfg(CFG_OVERLAYFS)) {\n\t\t\tchar *path;\n\t\t\tif (asprintf(&path, \"%s/.firejail\", cfg.homedir) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tEUID_ROOT();\n\t\t\tif (setreuid(0, 0) < 0)\n\t\t\t\terrExit(\"setreuid\");\n\t\t\tif (setregid(0, 0) < 0)\n\t\t\t\terrExit(\"setregid\");\n\t\t\terrno = 0;\n\t\t\tint rv = remove_directory(path);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Error: cannot removed overlays stored in ~/.firejail directory, errno %d\\n\", errno);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tfprintf(stderr, \"Error: overlayfs feature is disabled in Firejail configuration file\\n\");\n\t\t\texit(1);\n\t\t}\n\t\texit(0);\n\t}\n#endif\n#ifdef HAVE_X11\n\telse if (strcmp(argv[i], \"--x11\") == 0) {\n\t\tif (checkcfg(CFG_X11)) {\n\t\t\tx11_start(argc, argv);\n\t\t\texit(0);\n\t\t}\n\t\telse {\n\t\t\tfprintf(stderr, \"Error: --x11 feature is disabled in Firejail configuration file\\n\");\n\t\t\texit(1);\n\t\t}\n\t}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "Config cfg;",
            "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
            "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
            "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
            "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nConfig cfg;\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nstatic void run_cmd_and_exit(int i, int argc, char **argv) {\n\tEUID_ASSERT();\n\t\n\t//*************************************\n\t// basic arguments\n\t//*************************************\n\tif (strcmp(argv[i], \"--help\") == 0 ||\n\t    strcmp(argv[i], \"-?\") == 0) {\n\t\tusage();\n\t\texit(0);\n\t}\n\telse if (strcmp(argv[i], \"--version\") == 0) {\n\t\tprintf(\"firejail version %s\\n\", VERSION);\n\t\tprintf(\"\\n\");\n\t\tprint_compiletime_support();\n\t\tprintf(\"\\n\");\n\t\texit(0);\n\t}\n#ifdef HAVE_OVERLAYFS\n\telse if (strcmp(argv[i], \"--overlay-clean\") == 0) {\n\t\tif (checkcfg(CFG_OVERLAYFS)) {\n\t\t\tchar *path;\n\t\t\tif (asprintf(&path, \"%s/.firejail\", cfg.homedir) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tEUID_ROOT();\n\t\t\tif (setreuid(0, 0) < 0)\n\t\t\t\terrExit(\"setreuid\");\n\t\t\tif (setregid(0, 0) < 0)\n\t\t\t\terrExit(\"setregid\");\n\t\t\terrno = 0;\n\t\t\tint rv = remove_directory(path);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Error: cannot removed overlays stored in ~/.firejail directory, errno %d\\n\", errno);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tfprintf(stderr, \"Error: overlayfs feature is disabled in Firejail configuration file\\n\");\n\t\t\texit(1);\n\t\t}\n\t\texit(0);\n\t}\n#endif\n#ifdef HAVE_X11\n\telse if (strcmp(argv[i], \"--x11\") == 0) {\n\t\tif (checkcfg(CFG_X11)) {\n\t\t\tx11_start(argc, argv);\n\t\t\texit(0);\n\t\t}\n\t\telse {\n\t\t\tfprintf(stderr, \"Error: --x11 feature is disabled in Firejail configuration file\\n\");\n\t\t\texit(1);\n\t\t}\n\t}"
        }
      },
      {
        "call_info": {
          "callee": "profile_add",
          "args": [
            "cmd"
          ],
          "line": 1094
        },
        "resolved": true,
        "details": {
          "function_name": "profile_add",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/profile.c",
          "lines": "919-938",
          "snippet": "void profile_add(char *str) {\n\tEUID_ASSERT();\n\t\n\tProfileEntry *prf = malloc(sizeof(ProfileEntry));\n\tif (!prf)\n\t\terrExit(\"malloc\");\n\tmemset(prf, 0, sizeof(ProfileEntry));\n\tprf->next = NULL;\n\tprf->data = str;\t\n\n\t// add prf to the list\n\tif (cfg.profile == NULL) {\n\t\tcfg.profile = prf;\n\t\treturn;\n\t}\n\tProfileEntry *ptr = cfg.profile;\n\twhile (ptr->next != NULL)\n\t\tptr = ptr->next;\n\tptr->next = prf;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <dirent.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <dirent.h>\n#include \"firejail.h\"\n\nvoid profile_add(char *str) {\n\tEUID_ASSERT();\n\t\n\tProfileEntry *prf = malloc(sizeof(ProfileEntry));\n\tif (!prf)\n\t\terrExit(\"malloc\");\n\tmemset(prf, 0, sizeof(ProfileEntry));\n\tprf->next = NULL;\n\tprf->data = str;\t\n\n\t// add prf to the list\n\tif (cfg.profile == NULL) {\n\t\tcfg.profile = prf;\n\t\treturn;\n\t}\n\tProfileEntry *ptr = cfg.profile;\n\twhile (ptr->next != NULL)\n\t\tptr = ptr->next;\n\tptr->next = prf;\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 1093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "\"noblacklist ${PATH}/strace\""
          ],
          "line": 1091
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "check_output",
          "args": [
            "argc",
            "argv"
          ],
          "line": 1082
        },
        "resolved": true,
        "details": {
          "function_name": "check_output",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/output.c",
          "lines": "25-104",
          "snippet": "void check_output(int argc, char **argv) {\n\tEUID_ASSERT();\n\t\n\tint i;\n\tchar *outfile = NULL;\n\n\tint found = 0;\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strncmp(argv[i], \"--output=\", 9) == 0) {\n\t\t\tfound = 1;\n\t\t\tinvalid_filename(argv[i] + 9);\n\t\t\toutfile = argv[i] + 9;\n\n\t\t\t// do not accept directories, links, and files with \"..\"\n\t\t\tif (strstr(outfile, \"..\") || is_link(outfile) || is_dir(outfile)) {\n\t\t\t\tfprintf(stderr, \"Error: invalid output file. Links, directories and files with \\\"..\\\" are not allowed.\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t\n\t\t\tstruct stat s;\n\t\t\tif (stat(outfile, &s) == 0) {\n\t\t\t\t// check permissions\n\t\t\t\tif (s.st_uid != getuid() || s.st_gid != getgid()) {\n\t\t\t\t\tfprintf(stderr, \"Error: the output file needs to be owned by the current user.\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// check hard links\n\t\t\t\tif (s.st_nlink != 1) {\n\t\t\t\t\tfprintf(stderr, \"Error: no hard links allowed.\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* coverity[toctou] */\n\t\t\tFILE *fp = fopen(outfile, \"a\");\n\t\t\tif (!fp) {\n\t\t\t\tfprintf(stderr, \"Error: cannot open output file %s\\n\", outfile);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tfclose(fp);\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (!found)\n\t\treturn;\n\n\n\t// build the new command line\n\tint len = 0;\n\tfor (i = 0; i < argc; i++) {\n\t\tlen += strlen(argv[i]) + 1; // + ' '\n\t}\n\tlen += 100 + strlen(LIBDIR) + strlen(outfile); // tee command\n\t\n\tchar *cmd = malloc(len + 1); // + '\\0'\n\tif (!cmd)\n\t\terrExit(\"malloc\");\n\t\n\tchar *ptr = cmd;\n\tfor (i = 0; i < argc; i++) {\n\t\tif (strncmp(argv[i], \"--output=\", 9) == 0)\n\t\t\tcontinue;\n\t\tptr += sprintf(ptr, \"%s \", argv[i]);\n\t}\n\tsprintf(ptr, \"2>&1 | %s/firejail/ftee %s\", LIBDIR, outfile);\n\n\t// run command\n\tdrop_privs(0);\n\tchar *a[4];\n\ta[0] = \"/bin/bash\";\n\ta[1] = \"-c\";\n\ta[2] = cmd;\n\ta[3] = NULL;\n\n\texecvp(a[0], a); \n\n\tperror(\"execvp\");\n\texit(1);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid check_output(int argc, char **argv) {\n\tEUID_ASSERT();\n\t\n\tint i;\n\tchar *outfile = NULL;\n\n\tint found = 0;\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strncmp(argv[i], \"--output=\", 9) == 0) {\n\t\t\tfound = 1;\n\t\t\tinvalid_filename(argv[i] + 9);\n\t\t\toutfile = argv[i] + 9;\n\n\t\t\t// do not accept directories, links, and files with \"..\"\n\t\t\tif (strstr(outfile, \"..\") || is_link(outfile) || is_dir(outfile)) {\n\t\t\t\tfprintf(stderr, \"Error: invalid output file. Links, directories and files with \\\"..\\\" are not allowed.\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t\n\t\t\tstruct stat s;\n\t\t\tif (stat(outfile, &s) == 0) {\n\t\t\t\t// check permissions\n\t\t\t\tif (s.st_uid != getuid() || s.st_gid != getgid()) {\n\t\t\t\t\tfprintf(stderr, \"Error: the output file needs to be owned by the current user.\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// check hard links\n\t\t\t\tif (s.st_nlink != 1) {\n\t\t\t\t\tfprintf(stderr, \"Error: no hard links allowed.\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t/* coverity[toctou] */\n\t\t\tFILE *fp = fopen(outfile, \"a\");\n\t\t\tif (!fp) {\n\t\t\t\tfprintf(stderr, \"Error: cannot open output file %s\\n\", outfile);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tfclose(fp);\n\t\t\tbreak;\n\t\t}\n\t}\n\tif (!found)\n\t\treturn;\n\n\n\t// build the new command line\n\tint len = 0;\n\tfor (i = 0; i < argc; i++) {\n\t\tlen += strlen(argv[i]) + 1; // + ' '\n\t}\n\tlen += 100 + strlen(LIBDIR) + strlen(outfile); // tee command\n\t\n\tchar *cmd = malloc(len + 1); // + '\\0'\n\tif (!cmd)\n\t\terrExit(\"malloc\");\n\t\n\tchar *ptr = cmd;\n\tfor (i = 0; i < argc; i++) {\n\t\tif (strncmp(argv[i], \"--output=\", 9) == 0)\n\t\t\tcontinue;\n\t\tptr += sprintf(ptr, \"%s \", argv[i]);\n\t}\n\tsprintf(ptr, \"2>&1 | %s/firejail/ftee %s\", LIBDIR, outfile);\n\n\t// run command\n\tdrop_privs(0);\n\tchar *a[4];\n\ta[0] = \"/bin/bash\";\n\ta[1] = \"-c\";\n\ta[2] = cmd;\n\ta[3] = NULL;\n\n\texecvp(a[0], a); \n\n\tperror(\"execvp\");\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 1076
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 1074
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"\\n\""
          ],
          "line": 1073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"#%s# \"",
            "argv[i]"
          ],
          "line": 1072
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"argc %d: \"",
            "argc"
          ],
          "line": 1069
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "\"/firelog\"",
            "\"a\""
          ],
          "line": 1067
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 1066
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 1054
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 1052
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"\\n\""
          ],
          "line": 1051
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"#%s# \"",
            "fullargv[i]"
          ],
          "line": 1050
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"fullargc %d: \"",
            "fullargc"
          ],
          "line": 1047
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "\"/firelog\"",
            "\"a\""
          ],
          "line": 1045
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 1044
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "restricted_shell",
          "args": [
            "cfg.username"
          ],
          "line": 1040
        },
        "resolved": true,
        "details": {
          "function_name": "restricted_shell",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/restricted_shell.c",
          "lines": "27-132",
          "snippet": "int restricted_shell(const char *user) {\n\tEUID_ASSERT();\n\tassert(user);\n\n\t// open profile file:\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/login.users\", SYSCONFDIR) == -1)\n\t\terrExit(\"asprintf\");\n\tFILE *fp = fopen(fname, \"r\");\n\tfree(fname);\n\tif (fp == NULL)\n\t\treturn 0;\n\n\tint lineno = 0;\n\tchar buf[MAX_READ];\n\twhile (fgets(buf, MAX_READ, fp)) {\n\t\tlineno++;\n\n\t\t// remove empty spaces at the beginning of the line\n\t\tchar *ptr = buf;\n\t\twhile (*ptr == ' ' || *ptr == '\\t') { \n\t\t\tptr++;\n\t\t}\n\t\tif (*ptr == '\\n' || *ptr == '#')\n\t\t\tcontinue;\n\n\t\t//\n\t\t// parse line\n\t\t//\n\t\t\n\t\t// extract users\n\t\tchar *usr = ptr;\n\t\tchar *args = strchr(usr, ':');\n\t\tif (args == NULL) {\n\t\t\tfprintf(stderr, \"Error: users.conf line %d\\n\", lineno);\n\t\t\texit(1);\n\t\t}\n\t\t\n\t\t*args = '\\0';\n\t\targs++;\n\t\tptr = strchr(args, '\\n');\n\t\tif (ptr)\n\t\t\t*ptr = '\\0';\n\t\t\n\t\t// extract firejail command line arguments\n\t\tchar *ptr2 = args;\n\t\tint found = 0;\n\t\twhile (*ptr2 != '\\0') {\n\t\t\tif (*ptr2 != ' ' && *ptr2 != '\\t') {\n\t\t\t\tfound = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tptr2++;\n\t\t}\n\t\t// if nothing follows, continue\n\t\tif (!found)\n\t\t\tcontinue;\n\t\t\n\t\t// user name globbing\n\t\tif (fnmatch(usr, user, 0) == 0) {\n\t\t    \t// process program arguments\n\n\t\t    \tfullargv[0] = \"firejail\";\n\t\t    \tint i;\n\t\t    \tptr = args;\n\t\t    \tfor (i = 1; i < MAX_ARGS; i++) {\n\t\t    \t\t// skip blanks\n\t\t    \t\twhile (*ptr == ' ' || *ptr == '\\t')\n\t\t    \t\t\tptr++;\n\t\t    \t\tfullargv[i] = ptr;\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t\t{EUID_ROOT();\n\t\t\t\tFILE *fp = fopen(\"/firelog\", \"a\");\n\t\t\t\tif (fp) {\n\t\t\t\t\tfprintf(fp, \"i %d ptr #%s#\\n\", i, fullargv[i]);\n\t\t\t\t\tfclose(fp);\n\t\t\t\t}\n\t\t\t\tEUID_USER();}\n#endif\t\t\t\t\n\t\t    \t\t\n\t\t    \t\tif (*ptr != '\\0') {\n\t\t    \t\t\t// go to the end of the word\n\t\t\t    \t\twhile (*ptr != ' ' && *ptr != '\\t' && *ptr != '\\0')\n\t\t\t    \t\t\tptr++;\n\t\t    \t\t\t*ptr ='\\0';\n\t\t    \t\t\tfullargv[i] = strdup(fullargv[i]);\n\t\t    \t\t\tif (fullargv[i] == NULL)\n\t\t    \t\t\t\terrExit(\"strdup\");\n\t\t    \t\t\tptr++;\n\t\t    \t\t\twhile (*ptr == ' ' || *ptr == '\\t')\n\t\t    \t\t\t\tptr++;\n\t\t    \t\t\tif (*ptr != '\\0')\n\t\t\t    \t\t\tcontinue;\n\t\t    \t\t}\n\t    \t\t\tfullargv[i] = strdup(fullargv[i]);\n\t\t\t\tfclose(fp);\n\t\t    \t\treturn i + 1;\n\t\t\t}\n\t\t\tfprintf(stderr, \"Error: too many program arguments in users.conf line %d\\n\", lineno);\n\t\t\texit(1);\n\t\t}\n\t}\n\tfclose(fp);\n\n\treturn 0;   \n}",
          "includes": [
            "#include <fnmatch.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_READ 4096\t// maximum line length"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fnmatch.h>\n#include \"firejail.h\"\n\n#define MAX_READ 4096\t// maximum line length\n\nint restricted_shell(const char *user) {\n\tEUID_ASSERT();\n\tassert(user);\n\n\t// open profile file:\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/login.users\", SYSCONFDIR) == -1)\n\t\terrExit(\"asprintf\");\n\tFILE *fp = fopen(fname, \"r\");\n\tfree(fname);\n\tif (fp == NULL)\n\t\treturn 0;\n\n\tint lineno = 0;\n\tchar buf[MAX_READ];\n\twhile (fgets(buf, MAX_READ, fp)) {\n\t\tlineno++;\n\n\t\t// remove empty spaces at the beginning of the line\n\t\tchar *ptr = buf;\n\t\twhile (*ptr == ' ' || *ptr == '\\t') { \n\t\t\tptr++;\n\t\t}\n\t\tif (*ptr == '\\n' || *ptr == '#')\n\t\t\tcontinue;\n\n\t\t//\n\t\t// parse line\n\t\t//\n\t\t\n\t\t// extract users\n\t\tchar *usr = ptr;\n\t\tchar *args = strchr(usr, ':');\n\t\tif (args == NULL) {\n\t\t\tfprintf(stderr, \"Error: users.conf line %d\\n\", lineno);\n\t\t\texit(1);\n\t\t}\n\t\t\n\t\t*args = '\\0';\n\t\targs++;\n\t\tptr = strchr(args, '\\n');\n\t\tif (ptr)\n\t\t\t*ptr = '\\0';\n\t\t\n\t\t// extract firejail command line arguments\n\t\tchar *ptr2 = args;\n\t\tint found = 0;\n\t\twhile (*ptr2 != '\\0') {\n\t\t\tif (*ptr2 != ' ' && *ptr2 != '\\t') {\n\t\t\t\tfound = 1;\n\t\t\t\tbreak;\n\t\t\t}\n\t\t\tptr2++;\n\t\t}\n\t\t// if nothing follows, continue\n\t\tif (!found)\n\t\t\tcontinue;\n\t\t\n\t\t// user name globbing\n\t\tif (fnmatch(usr, user, 0) == 0) {\n\t\t    \t// process program arguments\n\n\t\t    \tfullargv[0] = \"firejail\";\n\t\t    \tint i;\n\t\t    \tptr = args;\n\t\t    \tfor (i = 1; i < MAX_ARGS; i++) {\n\t\t    \t\t// skip blanks\n\t\t    \t\twhile (*ptr == ' ' || *ptr == '\\t')\n\t\t    \t\t\tptr++;\n\t\t    \t\tfullargv[i] = ptr;\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t\t{EUID_ROOT();\n\t\t\t\tFILE *fp = fopen(\"/firelog\", \"a\");\n\t\t\t\tif (fp) {\n\t\t\t\t\tfprintf(fp, \"i %d ptr #%s#\\n\", i, fullargv[i]);\n\t\t\t\t\tfclose(fp);\n\t\t\t\t}\n\t\t\t\tEUID_USER();}\n#endif\t\t\t\t\n\t\t    \t\t\n\t\t    \t\tif (*ptr != '\\0') {\n\t\t    \t\t\t// go to the end of the word\n\t\t\t    \t\twhile (*ptr != ' ' && *ptr != '\\t' && *ptr != '\\0')\n\t\t\t    \t\t\tptr++;\n\t\t    \t\t\t*ptr ='\\0';\n\t\t    \t\t\tfullargv[i] = strdup(fullargv[i]);\n\t\t    \t\t\tif (fullargv[i] == NULL)\n\t\t    \t\t\t\terrExit(\"strdup\");\n\t\t    \t\t\tptr++;\n\t\t    \t\t\twhile (*ptr == ' ' || *ptr == '\\t')\n\t\t    \t\t\t\tptr++;\n\t\t    \t\t\tif (*ptr != '\\0')\n\t\t\t    \t\t\tcontinue;\n\t\t    \t\t}\n\t    \t\t\tfullargv[i] = strdup(fullargv[i]);\n\t\t\t\tfclose(fp);\n\t\t    \t\treturn i + 1;\n\t\t\t}\n\t\t\tfprintf(stderr, \"Error: too many program arguments in users.conf line %d\\n\", lineno);\n\t\t\texit(1);\n\t\t}\n\t}\n\tfclose(fp);\n\n\treturn 0;   \n}"
        }
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "comm"
          ],
          "line": 1032
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "system",
          "args": [
            "argv[2]"
          ],
          "line": 1026
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "drop_privs",
          "args": [
            "1"
          ],
          "line": 1025
        },
        "resolved": true,
        "details": {
          "function_name": "drop_privs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "36-81",
          "snippet": "void drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_GROUPS 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define MAX_GROUPS 1024\n\nvoid drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 1022
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 1020
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"run without a sandbox\\n\""
          ],
          "line": 1019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "\"/firelog\"",
            "\"a\""
          ],
          "line": 1017
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 1016
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[2]",
            "\"scp \"",
            "4"
          ],
          "line": 1014
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[2]",
            "\"/usr/lib/openssh/sftp-server\""
          ],
          "line": 1013
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[1]",
            "\"-c\""
          ],
          "line": 1012
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 1007
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 1005
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"\\n\""
          ],
          "line": 1004
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"#%s# \"",
            "argv[i]"
          ],
          "line": 1003
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"argc %d: \"",
            "argc"
          ],
          "line": 1001
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "\"/firelog\"",
            "\"w\""
          ],
          "line": 998
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "comm",
            "\"sshd\""
          ],
          "line": 992
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 990
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pid_proc_comm",
          "args": [
            "ppid"
          ],
          "line": 989
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 988
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getppid",
          "args": [],
          "line": 987
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 982
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "delete_x11_file",
          "args": [
            "sandbox_pid"
          ],
          "line": 980
        },
        "resolved": true,
        "details": {
          "function_name": "delete_x11_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "773-780",
          "snippet": "static void delete_x11_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_X11_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void set_name_file(pid_t pid);",
            "static void delete_name_file(pid_t pid);",
            "static void delete_x11_file(pid_t pid);",
            "pid_t pid;",
            "pid_t pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nstatic void delete_x11_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_X11_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "delete_name_file",
          "args": [
            "sandbox_pid"
          ],
          "line": 979
        },
        "resolved": true,
        "details": {
          "function_name": "delete_name_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "746-753",
          "snippet": "static void delete_name_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_NAME_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void set_name_file(pid_t pid);",
            "static void delete_name_file(pid_t pid);",
            "static void delete_x11_file(pid_t pid);",
            "pid_t pid;",
            "pid_t pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nstatic void delete_name_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_NAME_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "network_del_run_file",
          "args": [
            "sandbox_pid"
          ],
          "line": 978
        },
        "resolved": true,
        "details": {
          "function_name": "network_del_run_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "153-159",
          "snippet": "void network_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid network_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bandwidth_del_run_file",
          "args": [
            "sandbox_pid"
          ],
          "line": 977
        },
        "resolved": true,
        "details": {
          "function_name": "bandwidth_del_run_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "145-151",
          "snippet": "void bandwidth_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fs_build_firejail_dir",
          "args": [],
          "line": 976
        },
        "resolved": true,
        "details": {
          "function_name": "fs_build_firejail_dir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs.c",
          "lines": "73-114",
          "snippet": "void fs_build_firejail_dir(void) {\n\tstruct stat s;\n\n\t// CentOS 6 doesn't have /run directory\n\tif (stat(RUN_FIREJAIL_BASEDIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_BASEDIR, 0755);\n\t}\n\n\t// check /run/firejail directory belongs to root end exit if doesn't!\n\tif (stat(RUN_FIREJAIL_DIR, &s) == 0) {\n\t\tif (s.st_uid != 0 || s.st_gid != 0) {\n\t\t\tfprintf(stderr, \"Error: non-root %s directory, exiting...\\n\", RUN_FIREJAIL_DIR);\n\t\t\texit(1);\n\t\t}\n\t}\n\telse {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_DIR, 0755);\n\t}\n\t\n\tif (stat(RUN_FIREJAIL_NETWORK_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_NETWORK_DIR, 0755);\n\t}\n\t\n\tif (stat(RUN_FIREJAIL_BANDWIDTH_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_BANDWIDTH_DIR, 0755);\n\t}\n\t\t\n\tif (stat(RUN_FIREJAIL_NAME_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_NAME_DIR, 0755);\n\t}\n\t\n\tif (stat(RUN_FIREJAIL_X11_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_X11_DIR, 0755);\n\t}\n\t\n\tif (stat(RUN_FIREJAIL_APPIMAGE_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_APPIMAGE_DIR, 0755);\n\t}\n\t\n\tcreate_empty_dir();\n\tcreate_empty_file();\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <errno.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <glob.h>",
            "#include <fnmatch.h>",
            "#include <linux/limits.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <glob.h>\n#include <fnmatch.h>\n#include <linux/limits.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nvoid fs_build_firejail_dir(void) {\n\tstruct stat s;\n\n\t// CentOS 6 doesn't have /run directory\n\tif (stat(RUN_FIREJAIL_BASEDIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_BASEDIR, 0755);\n\t}\n\n\t// check /run/firejail directory belongs to root end exit if doesn't!\n\tif (stat(RUN_FIREJAIL_DIR, &s) == 0) {\n\t\tif (s.st_uid != 0 || s.st_gid != 0) {\n\t\t\tfprintf(stderr, \"Error: non-root %s directory, exiting...\\n\", RUN_FIREJAIL_DIR);\n\t\t\texit(1);\n\t\t}\n\t}\n\telse {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_DIR, 0755);\n\t}\n\t\n\tif (stat(RUN_FIREJAIL_NETWORK_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_NETWORK_DIR, 0755);\n\t}\n\t\n\tif (stat(RUN_FIREJAIL_BANDWIDTH_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_BANDWIDTH_DIR, 0755);\n\t}\n\t\t\n\tif (stat(RUN_FIREJAIL_NAME_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_NAME_DIR, 0755);\n\t}\n\t\n\tif (stat(RUN_FIREJAIL_X11_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_X11_DIR, 0755);\n\t}\n\t\n\tif (stat(RUN_FIREJAIL_APPIMAGE_DIR, &s)) {\n\t\tcreate_dir_as_root(RUN_FIREJAIL_APPIMAGE_DIR, 0755);\n\t}\n\t\n\tcreate_empty_dir();\n\tcreate_empty_file();\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 975
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "init_cfg",
          "args": [
            "argc",
            "argv"
          ],
          "line": 971
        },
        "resolved": true,
        "details": {
          "function_name": "init_cfg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "180-218",
          "snippet": "static void init_cfg(int argc, char **argv) {\n\tEUID_ASSERT();\n\tmemset(&cfg, 0, sizeof(cfg));\n\n\tcfg.original_argv = argv;\n\tcfg.original_argc = argc;\n\tcfg.bridge0.devsandbox = \"eth0\";\n\tcfg.bridge1.devsandbox = \"eth1\";\n\tcfg.bridge2.devsandbox = \"eth2\";\n\tcfg.bridge3.devsandbox = \"eth3\";\n\t\n\t// extract user data\n\tEUID_ROOT(); // rise permissions for grsecurity\n\tstruct passwd *pw = getpwuid(getuid());\n\tif (!pw)\n\t\terrExit(\"getpwuid\");\n\tEUID_USER();\n\tcfg.username = strdup(pw->pw_name);\n\tif (!cfg.username)\n\t\terrExit(\"strdup\");\n\n\t// build home directory name\n\tcfg.homedir = NULL;\n\tif (pw->pw_dir != NULL) {\n\t\tcfg.homedir = strdup(pw->pw_dir);\n\t\tif (!cfg.homedir)\n\t\t\terrExit(\"strdup\");\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: user %s doesn't have a user directory assigned\\n\", cfg.username);\n\t\texit(1);\n\t}\n\tcfg.cwd = getcwd(NULL, 0);\n\n\t// initialize random number generator\n\tsandbox_pid = getpid();\n\ttime_t t = time(NULL);\n\tsrand(t ^ sandbox_pid);\n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "Config cfg;",
            "pid_t sandbox_pid;",
            "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
            "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
            "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
            "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nConfig cfg;\npid_t sandbox_pid;\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nstatic void init_cfg(int argc, char **argv) {\n\tEUID_ASSERT();\n\tmemset(&cfg, 0, sizeof(cfg));\n\n\tcfg.original_argv = argv;\n\tcfg.original_argc = argc;\n\tcfg.bridge0.devsandbox = \"eth0\";\n\tcfg.bridge1.devsandbox = \"eth1\";\n\tcfg.bridge2.devsandbox = \"eth2\";\n\tcfg.bridge3.devsandbox = \"eth3\";\n\t\n\t// extract user data\n\tEUID_ROOT(); // rise permissions for grsecurity\n\tstruct passwd *pw = getpwuid(getuid());\n\tif (!pw)\n\t\terrExit(\"getpwuid\");\n\tEUID_USER();\n\tcfg.username = strdup(pw->pw_name);\n\tif (!cfg.username)\n\t\terrExit(\"strdup\");\n\n\t// build home directory name\n\tcfg.homedir = NULL;\n\tif (pw->pw_dir != NULL) {\n\t\tcfg.homedir = strdup(pw->pw_dir);\n\t\tif (!cfg.homedir)\n\t\t\terrExit(\"strdup\");\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: user %s doesn't have a user directory assigned\\n\", cfg.username);\n\t\texit(1);\n\t}\n\tcfg.cwd = getcwd(NULL, 0);\n\n\t// initialize random number generator\n\tsandbox_pid = getpid();\n\ttime_t t = time(NULL);\n\tsrand(t ^ sandbox_pid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 968
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--\"",
            "2"
          ],
          "line": 963
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--\""
          ],
          "line": 961
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"firejail version %s\\n\"",
            "VERSION"
          ],
          "line": 956
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--version\""
          ],
          "line": 955
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 952
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 951
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "0"
          ],
          "line": 943
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "run_no_sandbox",
          "args": [
            "argc",
            "argv"
          ],
          "line": 941
        },
        "resolved": true,
        "details": {
          "function_name": "run_no_sandbox",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/no_sandbox.c",
          "lines": "162-291",
          "snippet": "void run_no_sandbox(int argc, char **argv) {\n\tEUID_ASSERT();\n\n\t// process limited subset of options\n\tint i;\n\tfor (i = 0; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--csh\") == 0) {\n\t\t\tif (arg_shell_none) {\n\t\t\t\tfprintf(stderr, \"Error: --shell=none was already specified.\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tif (cfg.shell) {\n\t\t\t\tfprintf(stderr, \"Error: only one default user shell can be specified\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tcfg.shell = \"/bin/csh\";\n\t\t}\n\t\telse if (strcmp(argv[i], \"--zsh\") == 0) {\n\t\t\tif (arg_shell_none) {\n\t\t\t\tfprintf(stderr, \"Error: --shell=none was already specified.\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tif (cfg.shell) {\n\t\t\t\tfprintf(stderr, \"Error: only one default user shell can be specified\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tcfg.shell = \"/bin/zsh\";\n\t\t}\n\t\telse if (strcmp(argv[i], \"--shell=none\") == 0) {\n\t\t\targ_shell_none = 1;\n\t\t\tif (cfg.shell) {\n\t\t\t\tfprintf(stderr, \"Error: a shell was already specified\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(argv[i], \"--shell=\", 8) == 0) {\n\t\t\tif (arg_shell_none) {\n\t\t\t\tfprintf(stderr, \"Error: --shell=none was already specified.\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tinvalid_filename(argv[i] + 8);\n\n\t\t\tif (cfg.shell) {\n\t\t\t\tfprintf(stderr, \"Error: only one user shell can be specified\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tcfg.shell = argv[i] + 8;\n\n\t\t\tif (is_dir(cfg.shell) || strstr(cfg.shell, \"..\")) {\n\t\t\t\tfprintf(stderr, \"Error: invalid shell\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\n\t\t\t// access call checks as real UID/GID, not as effective UID/GID\n\t\t\tif(cfg.chrootdir) {\n\t\t\t\tchar *shellpath;\n\t\t\t\tif (asprintf(&shellpath, \"%s%s\", cfg.chrootdir, cfg.shell) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\tif (access(shellpath, R_OK)) {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot access shell file in chroot\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tfree(shellpath);\n\t\t\t} else if (access(cfg.shell, R_OK)) {\n\t\t\t\tfprintf(stderr, \"Error: cannot access shell file\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t}\n\n\t// use $SHELL to get shell used in sandbox\n\tif (!arg_shell_none && !cfg.shell) {\n\t\tchar *shell =  getenv(\"SHELL\");\n\t\tif (access(shell, R_OK) == 0)\n\t\t\tcfg.shell = shell;\n\t}\n\t// guess shell otherwise\n\tif (!arg_shell_none && !cfg.shell) {\n\t\tcfg.shell = guess_shell();\n\t\tif (arg_debug)\n\t\t\tprintf(\"Autoselecting %s as shell\\n\", cfg.shell);\n\t}\n\tif (!arg_shell_none && !cfg.shell) {\n\t\tfprintf(stderr, \"Error: unable to guess your shell, please set explicitly by using --shell option.\\n\");\n\t\texit(1);\n\t}\n\n\tint prog_index = 0;\n\t// find first non option arg:\n\t//\t- first argument not starting wiht --,\n\t//\t- whatever follows after -c (example: firejail -c ls)\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"-c\") == 0) {\n\t\t\tprog_index = i + 1;\n\t\t\tif (prog_index == argc) {\n\t\t\t\tfprintf(stderr, \"Error: option -c requires an argument\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\t// check first argument not starting with --\n\t\tif (strncmp(argv[i],\"--\",2) != 0) {\n\t\t\tprog_index = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!arg_shell_none) {\n\t\tif (prog_index == 0) {\n\t\t\tcfg.command_line = cfg.shell;\n\t\t\tcfg.window_title = cfg.shell;\n\t\t} else {\n\t\t\tbuild_cmdline(&cfg.command_line, &cfg.window_title, argc, argv, prog_index);\n\t\t}\n\t}\n\n\tcfg.original_argv = argv;\n\tcfg.original_program_index = prog_index;\n\n\tchar *command;\n\tif (prog_index == 0)\n\t\tcommand = cfg.shell;\n\telse\n\t\tcommand = argv[prog_index];\n\tif (!arg_quiet)\n\t\tfprintf(stderr, \"Warning: an existing sandbox was detected. \"\n\t\t\t\"%s will run without any additional sandboxing features\\n\", command);\n\n\tstart_application();\n}",
          "includes": [
            "#include <grp.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <grp.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid run_no_sandbox(int argc, char **argv) {\n\tEUID_ASSERT();\n\n\t// process limited subset of options\n\tint i;\n\tfor (i = 0; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--csh\") == 0) {\n\t\t\tif (arg_shell_none) {\n\t\t\t\tfprintf(stderr, \"Error: --shell=none was already specified.\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tif (cfg.shell) {\n\t\t\t\tfprintf(stderr, \"Error: only one default user shell can be specified\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tcfg.shell = \"/bin/csh\";\n\t\t}\n\t\telse if (strcmp(argv[i], \"--zsh\") == 0) {\n\t\t\tif (arg_shell_none) {\n\t\t\t\tfprintf(stderr, \"Error: --shell=none was already specified.\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tif (cfg.shell) {\n\t\t\t\tfprintf(stderr, \"Error: only one default user shell can be specified\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tcfg.shell = \"/bin/zsh\";\n\t\t}\n\t\telse if (strcmp(argv[i], \"--shell=none\") == 0) {\n\t\t\targ_shell_none = 1;\n\t\t\tif (cfg.shell) {\n\t\t\t\tfprintf(stderr, \"Error: a shell was already specified\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(argv[i], \"--shell=\", 8) == 0) {\n\t\t\tif (arg_shell_none) {\n\t\t\t\tfprintf(stderr, \"Error: --shell=none was already specified.\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tinvalid_filename(argv[i] + 8);\n\n\t\t\tif (cfg.shell) {\n\t\t\t\tfprintf(stderr, \"Error: only one user shell can be specified\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tcfg.shell = argv[i] + 8;\n\n\t\t\tif (is_dir(cfg.shell) || strstr(cfg.shell, \"..\")) {\n\t\t\t\tfprintf(stderr, \"Error: invalid shell\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\n\t\t\t// access call checks as real UID/GID, not as effective UID/GID\n\t\t\tif(cfg.chrootdir) {\n\t\t\t\tchar *shellpath;\n\t\t\t\tif (asprintf(&shellpath, \"%s%s\", cfg.chrootdir, cfg.shell) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\tif (access(shellpath, R_OK)) {\n\t\t\t\t\tfprintf(stderr, \"Error: cannot access shell file in chroot\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\tfree(shellpath);\n\t\t\t} else if (access(cfg.shell, R_OK)) {\n\t\t\t\tfprintf(stderr, \"Error: cannot access shell file\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t}\n\n\t// use $SHELL to get shell used in sandbox\n\tif (!arg_shell_none && !cfg.shell) {\n\t\tchar *shell =  getenv(\"SHELL\");\n\t\tif (access(shell, R_OK) == 0)\n\t\t\tcfg.shell = shell;\n\t}\n\t// guess shell otherwise\n\tif (!arg_shell_none && !cfg.shell) {\n\t\tcfg.shell = guess_shell();\n\t\tif (arg_debug)\n\t\t\tprintf(\"Autoselecting %s as shell\\n\", cfg.shell);\n\t}\n\tif (!arg_shell_none && !cfg.shell) {\n\t\tfprintf(stderr, \"Error: unable to guess your shell, please set explicitly by using --shell option.\\n\");\n\t\texit(1);\n\t}\n\n\tint prog_index = 0;\n\t// find first non option arg:\n\t//\t- first argument not starting wiht --,\n\t//\t- whatever follows after -c (example: firejail -c ls)\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"-c\") == 0) {\n\t\t\tprog_index = i + 1;\n\t\t\tif (prog_index == argc) {\n\t\t\t\tfprintf(stderr, \"Error: option -c requires an argument\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tbreak;\n\t\t}\n\t\t// check first argument not starting with --\n\t\tif (strncmp(argv[i],\"--\",2) != 0) {\n\t\t\tprog_index = i;\n\t\t\tbreak;\n\t\t}\n\t}\n\n\tif (!arg_shell_none) {\n\t\tif (prog_index == 0) {\n\t\t\tcfg.command_line = cfg.shell;\n\t\t\tcfg.window_title = cfg.shell;\n\t\t} else {\n\t\t\tbuild_cmdline(&cfg.command_line, &cfg.window_title, argc, argv, prog_index);\n\t\t}\n\t}\n\n\tcfg.original_argv = argv;\n\tcfg.original_program_index = prog_index;\n\n\tchar *command;\n\tif (prog_index == 0)\n\t\tcommand = cfg.shell;\n\telse\n\t\tcommand = argv[prog_index];\n\tif (!arg_quiet)\n\t\tfprintf(stderr, \"Warning: an existing sandbox was detected. \"\n\t\t\t\"%s will run without any additional sandboxing features\\n\", command);\n\n\tstart_application();\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--\"",
            "2"
          ],
          "line": 935
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--\""
          ],
          "line": 933
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--shutdown=\"",
            "11"
          ],
          "line": 927
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--seccomp.print\"",
            "15"
          ],
          "line": 926
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--protocol.print=\"",
            "17"
          ],
          "line": 925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--fs.print=\"",
            "11"
          ],
          "line": 924
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--join-network=\"",
            "15"
          ],
          "line": 923
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--join-filesystem=\"",
            "18"
          ],
          "line": 922
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--join=\"",
            "7"
          ],
          "line": 916
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--cpu.print=\"",
            "12"
          ],
          "line": 913
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--caps.print=\"",
            "13"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--bandwidth=\"",
            "12"
          ],
          "line": 911
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--dns.print=\"",
            "12"
          ],
          "line": 910
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--overlay-clean\""
          ],
          "line": 909
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--version\""
          ],
          "line": 908
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--help\""
          ],
          "line": 907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--debug-protocols\""
          ],
          "line": 906
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--debug-syscalls\""
          ],
          "line": 905
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--debug-errnos\""
          ],
          "line": 904
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--debug-caps\""
          ],
          "line": 903
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--get=\"",
            "6"
          ],
          "line": 902
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--ls=\"",
            "5"
          ],
          "line": 901
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--top\""
          ],
          "line": 900
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--tree\""
          ],
          "line": 899
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--netstats\""
          ],
          "line": 898
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--list\""
          ],
          "line": 897
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--force\""
          ],
          "line": 896
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 891
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "check_kernel_procs",
          "args": [],
          "line": 890
        },
        "resolved": true,
        "details": {
          "function_name": "check_kernel_procs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/no_sandbox.c",
          "lines": "87-160",
          "snippet": "int check_kernel_procs(void) {\n\t// we run this function with EUID set in order to detect grsecurity\n\t// only user processes are available in /proc when running grsecurity\n\t// EUID_ASSERT();\n\n\tchar *kern_proc[] = {\n\t\t\"kthreadd\",\n\t\t\"ksoftirqd\",\n\t\t\"kworker\",\n\t\t\"rcu_sched\",\n\t\t\"rcu_bh\",\n\t\tNULL\t// NULL terminated list\n\t};\n\tint i;\n\n\tif (arg_debug)\n\t\tprintf(\"Looking for kernel processes\\n\");\n\n\t// look at the first 10 processes\n\t// if a kernel process is found, return 1\n\tfor (i = 1; i <= 10; i++) { \n\t\tstruct stat s;\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"/proc/%d/comm\", i) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\tif (stat(fname, &s) == -1) {\n\t\t\tfree(fname);\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\t// open file\n\t\t/* coverity[toctou] */\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n\t\t\tfprintf(stderr, \"Warning: cannot open %s\\n\", fname);\n\t\t\tfree(fname);\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\t// read file\n\t\tchar buf[100];\n\t\tif (fgets(buf, 10, fp) == NULL) {\n\t\t\tfprintf(stderr, \"Warning: cannot read %s\\n\", fname);\n\t\t\tfclose(fp);\n\t\t\tfree(fname);\n\t\t\tcontinue;\n\t\t}\n\t\t// clean /n\n\t\tchar *ptr;\n\t\tif ((ptr = strchr(buf, '\\n')) != NULL)\n\t\t\t*ptr = '\\0';\n\t\t\n\t\t// check process name against the kernel list\n\t\tint j = 0;\n\t\twhile (kern_proc[j] != NULL) {\n\t\t\tif (strncmp(buf, kern_proc[j], strlen(kern_proc[j])) == 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tprintf(\"Found %s process, we are not running in a sandbox\\n\", buf);\n\t\t\t\tfclose(fp);\n\t\t\t\tfree(fname);\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tj++;\n\t\t}\n\t\t\n\t\tfclose(fp);\n\t\tfree(fname);\n\t}\n\n\tif (arg_debug)\n\t\tprintf(\"No kernel processes found, we are already running in a sandbox\\n\");\n\n\treturn 0;\n}",
          "includes": [
            "#include <grp.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <grp.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nint check_kernel_procs(void) {\n\t// we run this function with EUID set in order to detect grsecurity\n\t// only user processes are available in /proc when running grsecurity\n\t// EUID_ASSERT();\n\n\tchar *kern_proc[] = {\n\t\t\"kthreadd\",\n\t\t\"ksoftirqd\",\n\t\t\"kworker\",\n\t\t\"rcu_sched\",\n\t\t\"rcu_bh\",\n\t\tNULL\t// NULL terminated list\n\t};\n\tint i;\n\n\tif (arg_debug)\n\t\tprintf(\"Looking for kernel processes\\n\");\n\n\t// look at the first 10 processes\n\t// if a kernel process is found, return 1\n\tfor (i = 1; i <= 10; i++) { \n\t\tstruct stat s;\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"/proc/%d/comm\", i) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\tif (stat(fname, &s) == -1) {\n\t\t\tfree(fname);\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\t// open file\n\t\t/* coverity[toctou] */\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n\t\t\tfprintf(stderr, \"Warning: cannot open %s\\n\", fname);\n\t\t\tfree(fname);\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\t// read file\n\t\tchar buf[100];\n\t\tif (fgets(buf, 10, fp) == NULL) {\n\t\t\tfprintf(stderr, \"Warning: cannot read %s\\n\", fname);\n\t\t\tfclose(fp);\n\t\t\tfree(fname);\n\t\t\tcontinue;\n\t\t}\n\t\t// clean /n\n\t\tchar *ptr;\n\t\tif ((ptr = strchr(buf, '\\n')) != NULL)\n\t\t\t*ptr = '\\0';\n\t\t\n\t\t// check process name against the kernel list\n\t\tint j = 0;\n\t\twhile (kern_proc[j] != NULL) {\n\t\t\tif (strncmp(buf, kern_proc[j], strlen(kern_proc[j])) == 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tprintf(\"Found %s process, we are not running in a sandbox\\n\", buf);\n\t\t\t\tfclose(fp);\n\t\t\t\tfree(fname);\n\t\t\t\treturn 1;\n\t\t\t}\n\t\t\tj++;\n\t\t}\n\t\t\n\t\tfclose(fp);\n\t\tfree(fname);\n\t}\n\n\tif (arg_debug)\n\t\tprintf(\"No kernel processes found, we are already running in a sandbox\\n\");\n\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 889
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "check_namespace_virt",
          "args": [],
          "line": 888
        },
        "resolved": true,
        "details": {
          "function_name": "check_namespace_virt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/no_sandbox.c",
          "lines": "40-83",
          "snippet": "int check_namespace_virt(void) {\n\tEUID_ASSERT();\n\t\n\t// check container environment variable\n\tchar *str = getenv(\"container\");\n\tif (str && is_container(str))\n\t\treturn 1;\n\t\n\t// check PID 1 container environment variable\n\tEUID_ROOT();\n\tFILE *fp = fopen(\"/proc/1/environ\", \"r\");\n\tif (fp) {\n\t\tint c = 0;\n\t\twhile (c != EOF) {\n\t\t\t// read one line\n\t\t\tchar buf[MAX_BUF];\n\t\t\tint i = 0;\n\t\t\twhile ((c = fgetc(fp)) != EOF) {\n\t\t\t\tif (c == 0)\n\t\t\t\t\tbreak;\n\t\t\t\tbuf[i] = (char) c;\n\t\t\t\tif (++i == (MAX_BUF - 1))\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbuf[i] = '\\0';\n\t\t\t\n\t\t\t// check env var name\n\t\t\tif (strncmp(buf, \"container=\", 10) == 0) {\n\t\t\t\t// found it\n\t\t\t\tif (is_container(buf + 10)) {\n\t\t\t\t\tfclose(fp);\n\t\t\t\t\tEUID_USER();\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t}\n//\t\t\tprintf(\"i %d c %d, buf #%s#\\n\", i, c, buf);\n\t\t}\n\t\t\n\t\tfclose(fp);\n\t}\n\t\t\n\tEUID_USER();\n\treturn 0;\n}",
          "includes": [
            "#include <grp.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_BUF 4096"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <grp.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\n#define MAX_BUF 4096\n\nint check_namespace_virt(void) {\n\tEUID_ASSERT();\n\t\n\t// check container environment variable\n\tchar *str = getenv(\"container\");\n\tif (str && is_container(str))\n\t\treturn 1;\n\t\n\t// check PID 1 container environment variable\n\tEUID_ROOT();\n\tFILE *fp = fopen(\"/proc/1/environ\", \"r\");\n\tif (fp) {\n\t\tint c = 0;\n\t\twhile (c != EOF) {\n\t\t\t// read one line\n\t\t\tchar buf[MAX_BUF];\n\t\t\tint i = 0;\n\t\t\twhile ((c = fgetc(fp)) != EOF) {\n\t\t\t\tif (c == 0)\n\t\t\t\t\tbreak;\n\t\t\t\tbuf[i] = (char) c;\n\t\t\t\tif (++i == (MAX_BUF - 1))\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\tbuf[i] = '\\0';\n\t\t\t\n\t\t\t// check env var name\n\t\t\tif (strncmp(buf, \"container=\", 10) == 0) {\n\t\t\t\t// found it\n\t\t\t\tif (is_container(buf + 10)) {\n\t\t\t\t\tfclose(fp);\n\t\t\t\t\tEUID_USER();\n\t\t\t\t\treturn 1;\n\t\t\t\t}\n\t\t\t}\n//\t\t\tprintf(\"i %d c %d, buf #%s#\\n\", i, c, buf);\n\t\t}\n\t\t\n\t\tfclose(fp);\n\t}\n\t\t\n\tEUID_USER();\n\treturn 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "run_symlink",
          "args": [
            "argc",
            "argv"
          ],
          "line": 881
        },
        "resolved": true,
        "details": {
          "function_name": "run_symlink",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/run_symlink.c",
          "lines": "25-113",
          "snippet": "void run_symlink(int argc, char **argv) {\n\tEUID_ASSERT();\n\t\n\tchar *program = strrchr(argv[0], '/');\n\tif (program)\n\t\tprogram += 1;\n\telse\n\t\tprogram = argv[0];\n\tif (strcmp(program, \"firejail\") == 0)\n\t\treturn;\n\n\t// find the real program\n\t// probably the first entry returend by \"which -a\" is a symlink - use the second entry!\n\tchar *p = getenv(\"PATH\");\n\tif (!p) {\n\t\tfprintf(stderr, \"Error: PATH environment variable not set\\n\");\n\t\texit(1);\n\t}\n\t\n\tchar *path = strdup(p);\n\tif (!path)\n\t\terrExit(\"strdup\");\n\n\tchar *selfpath = realpath(\"/proc/self/exe\", NULL);\n\tif (!selfpath)\n\t\terrExit(\"realpath\");\n\n\t// look in path for our program\n\tchar *tok = strtok(path, \":\");\n\tint found = 0;\n\twhile (tok) {\n\t\tchar *name;\n\t\tif (asprintf(&name, \"%s/%s\", tok, program) == -1)\n\t\t\terrExit(\"asprintf\");\n\n\t\tstruct stat s;\n\t\tif (stat(name, &s) == 0) {\n\t\t\tchar* rp = realpath(name, NULL);\n\t\t\tif (!rp)\n\t\t\t\terrExit(\"realpath\");\n\n\t\t\tif (strcmp(selfpath, rp) != 0) {\n\t\t\t\tprogram = strdup(name);\n\t\t\t\tfound = 1;\n\t\t\t\tfree(rp);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tfree(rp);\n\t\t}\n\n\t\tfree(name);\n\t\ttok = strtok(NULL, \":\");\n\t}\n\tif (!found) {\n\t\tfprintf(stderr, \"Error: cannot find the program in the path\\n\");\n\t\texit(1);\n\t}\n\n\tfree(selfpath);\n\n\n\t// start the argv[0] program in a new sandbox\n\tchar *firejail;\n\tif (asprintf(&firejail, \"%s/bin/firejail\", PREFIX) == -1)\n\t\terrExit(\"asprintf\");\n\n\tprintf(\"Redirecting symlink to %s\\n\", program);\n\n\t// drop privileges\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n\n\t// run command\n\tchar *a[3 + argc];\n\ta[0] = firejail;\n\ta[1] = program;\n\tint i;\n\tfor (i = 0; i < (argc - 1); i++) {\n\t\ta[i + 2] = argv[i + 1];\n\t}\n\ta[i + 2] = NULL;\n\texecvp(a[0], a); \n\n\tperror(\"execvp\");\n\texit(1);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid run_symlink(int argc, char **argv) {\n\tEUID_ASSERT();\n\t\n\tchar *program = strrchr(argv[0], '/');\n\tif (program)\n\t\tprogram += 1;\n\telse\n\t\tprogram = argv[0];\n\tif (strcmp(program, \"firejail\") == 0)\n\t\treturn;\n\n\t// find the real program\n\t// probably the first entry returend by \"which -a\" is a symlink - use the second entry!\n\tchar *p = getenv(\"PATH\");\n\tif (!p) {\n\t\tfprintf(stderr, \"Error: PATH environment variable not set\\n\");\n\t\texit(1);\n\t}\n\t\n\tchar *path = strdup(p);\n\tif (!path)\n\t\terrExit(\"strdup\");\n\n\tchar *selfpath = realpath(\"/proc/self/exe\", NULL);\n\tif (!selfpath)\n\t\terrExit(\"realpath\");\n\n\t// look in path for our program\n\tchar *tok = strtok(path, \":\");\n\tint found = 0;\n\twhile (tok) {\n\t\tchar *name;\n\t\tif (asprintf(&name, \"%s/%s\", tok, program) == -1)\n\t\t\terrExit(\"asprintf\");\n\n\t\tstruct stat s;\n\t\tif (stat(name, &s) == 0) {\n\t\t\tchar* rp = realpath(name, NULL);\n\t\t\tif (!rp)\n\t\t\t\terrExit(\"realpath\");\n\n\t\t\tif (strcmp(selfpath, rp) != 0) {\n\t\t\t\tprogram = strdup(name);\n\t\t\t\tfound = 1;\n\t\t\t\tfree(rp);\n\t\t\t\tbreak;\n\t\t\t}\n\n\t\t\tfree(rp);\n\t\t}\n\n\t\tfree(name);\n\t\ttok = strtok(NULL, \":\");\n\t}\n\tif (!found) {\n\t\tfprintf(stderr, \"Error: cannot find the program in the path\\n\");\n\t\texit(1);\n\t}\n\n\tfree(selfpath);\n\n\n\t// start the argv[0] program in a new sandbox\n\tchar *firejail;\n\tif (asprintf(&firejail, \"%s/bin/firejail\", PREFIX) == -1)\n\t\terrExit(\"asprintf\");\n\n\tprintf(\"Redirecting symlink to %s\\n\", program);\n\n\t// drop privileges\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n\n\t// run command\n\tchar *a[3 + argc];\n\ta[0] = firejail;\n\ta[1] = program;\n\tint i;\n\tfor (i = 0; i < (argc - 1); i++) {\n\t\ta[i + 2] = argv[i + 1];\n\t}\n\ta[i + 2] = NULL;\n\texecvp(a[0], a); \n\n\tperror(\"execvp\");\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_INIT",
          "args": [],
          "line": 875
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "detect_allow_debuggers",
          "args": [
            "argc",
            "argv"
          ],
          "line": 872
        },
        "resolved": true,
        "details": {
          "function_name": "detect_allow_debuggers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "800-834",
          "snippet": "static void detect_allow_debuggers(int argc, char **argv) {\n\tint i;\n\t\n\t// detect --allow-debuggers\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--allow-debuggers\") == 0) {\n\t\t\t// check kernel version\n\t\t\tstruct utsname u;\n\t\t\tint rv = uname(&u);\n\t\t\tif (rv != 0)\n\t\t\t\terrExit(\"uname\");\n\t\t\tint major;\n\t\t\tint minor;\n\t\t\tif (2 != sscanf(u.release, \"%d.%d\", &major, &minor)) {\n\t\t\t\tfprintf(stderr, \"Error: cannot extract Linux kernel version: %s\\n\", u.version);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tif (major < 4 || (major == 4 && minor < 8)) {\n\t\t\t\tfprintf(stderr, \"Error: --allow-debuggers is disabled on Linux kernels prior to 4.8. \"\n\t\t\t\t\t\"A bug in ptrace call allows a full bypass of the seccomp filter. \"\n\t\t\t\t\t\"Your current kernel version is %d.%d.\\n\", major, minor);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t\n\t\t\targ_allow_debuggers = 1;\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// detect end of firejail params\n\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\tbreak;\n\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_allow_debuggers = 0;",
            "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
            "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
            "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
            "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_allow_debuggers = 0;\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nstatic void detect_allow_debuggers(int argc, char **argv) {\n\tint i;\n\t\n\t// detect --allow-debuggers\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--allow-debuggers\") == 0) {\n\t\t\t// check kernel version\n\t\t\tstruct utsname u;\n\t\t\tint rv = uname(&u);\n\t\t\tif (rv != 0)\n\t\t\t\terrExit(\"uname\");\n\t\t\tint major;\n\t\t\tint minor;\n\t\t\tif (2 != sscanf(u.release, \"%d.%d\", &major, &minor)) {\n\t\t\t\tfprintf(stderr, \"Error: cannot extract Linux kernel version: %s\\n\", u.version);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tif (major < 4 || (major == 4 && minor < 8)) {\n\t\t\t\tfprintf(stderr, \"Error: --allow-debuggers is disabled on Linux kernels prior to 4.8. \"\n\t\t\t\t\t\"A bug in ptrace call allows a full bypass of the seccomp filter. \"\n\t\t\t\t\t\"Your current kernel version is %d.%d.\\n\", major, minor);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t\n\t\t\targ_allow_debuggers = 1;\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// detect end of firejail params\n\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\tbreak;\n\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "detect_quiet",
          "args": [
            "argc",
            "argv"
          ],
          "line": 871
        },
        "resolved": true,
        "details": {
          "function_name": "detect_quiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "782-798",
          "snippet": "static void detect_quiet(int argc, char **argv) {\n\tint i;\n\t\n\t// detect --quiet\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--quiet\") == 0) {\n\t\t\targ_quiet = 1;\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// detect end of firejail params\n\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\tbreak;\n\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\tbreak;\n\t}\n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_quiet = 0;",
            "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
            "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
            "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
            "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_quiet = 0;\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nstatic void detect_quiet(int argc, char **argv) {\n\tint i;\n\t\n\t// detect --quiet\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--quiet\") == 0) {\n\t\t\targ_quiet = 1;\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// detect end of firejail params\n\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\tbreak;\n\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\tbreak;\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "errno_highest_nr",
          "args": [],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "errno_highest_nr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/errno.c",
          "lines": "174-183",
          "snippet": "int errno_highest_nr(void) {\n\tint i, max = 0;\n\tint elems = sizeof(errnolist) / sizeof(errnolist[0]);\n\tfor (i = 0; i < elems; i++) {\n\t\tif (errnolist[i].nr > max)\n\t\t\tmax = errnolist[i].nr;\n\t}\n\n\treturn max;\n}",
          "includes": [
            "#include <errno.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include \"firejail.h\"\n\nint errno_highest_nr(void) {\n\tint i, max = 0;\n\tint elems = sizeof(errnolist) / sizeof(errnolist[0]);\n\tfor (i = 0; i < elems; i++) {\n\t\tif (errnolist[i].nr > max)\n\t\t\tmax = errnolist[i].nr;\n\t}\n\n\treturn max;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nConfig cfg;\nint arg_debug = 0;\nint arg_debug_check_filename;\nint arg_debug_blacklists;\nint arg_debug_whitelists;\nint arg_seccomp = 0;\nint arg_nonewprivs = 0;\nint arg_quiet = 0;\nint arg_apparmor = 0;\nint arg_allow_debuggers = 0;\nint login_shell = 0;\nchar *fullargv[MAX_ARGS];\nint fullargc = 0;\nstatic pid_t child = 0;\npid_t sandbox_pid;\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\npid_t pid;\npid_t pid;\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nint main(int argc, char **argv) {\n\tint i;\n\tint prog_index = -1;\t\t\t  // index in argv where the program command starts\n\tint lockfd = -1;\n\tint option_cgroup = 0;\n\tint option_force = 0;\n\tint custom_profile = 0;\t// custom profile loaded\n\tchar *custom_profile_dir = NULL; // custom profile directory\n\tint arg_noprofile = 0; // use default.profile if none other found/specified\n#ifdef HAVE_SECCOMP\n\tint highest_errno = errno_highest_nr();\n#endif\n\n\tdetect_quiet(argc, argv);\n\tdetect_allow_debuggers(argc, argv);\n\n\t// drop permissions by default and rise them when required\n\tEUID_INIT();\n\tEUID_USER();\n\n\n\t// check argv[0] symlink wrapper if this is not a login shell\n\tif (*argv[0] != '-')\n\t\trun_symlink(argc, argv);\n\n\t// check if we already have a sandbox running\n\t// If LXC is detected, start firejail sandbox\n\t// otherwise try to detect a PID namespace by looking under /proc for specific kernel processes and:\n\t//\t- if --force flag is set, start firejail sandbox\n\t//\t-- if --force flag is not set, start the application in a /bin/bash shell \n\tif (check_namespace_virt() == 0) {\n\t\tEUID_ROOT();\n\t\tint rv = check_kernel_procs();\n\t\tEUID_USER();\n\t\tif (rv == 0) {\n\t\t\t// if --force option is passed to the program, disregard the existing sandbox\n\t\t\tint found = 0;\n\t\t\tfor (i = 1; i < argc; i++) {\n\t\t\t\tif (strcmp(argv[i], \"--force\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--list\") == 0 ||\t\n\t\t\t\t    strcmp(argv[i], \"--netstats\") == 0 ||\t\n\t\t\t\t    strcmp(argv[i], \"--tree\") == 0 ||\t\n\t\t\t\t    strcmp(argv[i], \"--top\") == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--ls=\", 5) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--get=\", 6) == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--debug-caps\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--debug-errnos\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--debug-syscalls\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--debug-protocols\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--help\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--version\") == 0 ||\n\t\t\t\t    strcmp(argv[i], \"--overlay-clean\") == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--dns.print=\", 12) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--bandwidth=\", 12) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--caps.print=\", 13) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--cpu.print=\", 12) == 0 ||\n\t//********************************************************************************\n\t// todo: fix the following problems\n\t\t\t\t    strncmp(argv[i], \"--join=\", 7) == 0 ||\n\t//[netblue@debian Downloads]$ firejail --join=896\n\t//Switching to pid 897, the first child process inside the sandbox\n\t//Error: seccomp file not found\n\t//********************************************************************************\n\t\n\t\t\t\t    strncmp(argv[i], \"--join-filesystem=\", 18) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--join-network=\", 15) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--fs.print=\", 11) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--protocol.print=\", 17) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--seccomp.print\", 15) == 0 ||\n\t\t\t\t    strncmp(argv[i], \"--shutdown=\", 11) == 0) {\n\t\t\t\t\tfound = 1;\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\n\t\t\t\t// detect end of firejail params\n\t\t\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\t\t\tbreak;\n\t\t\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tif (found == 0) {\n\t\t\t\t// start the program directly without sandboxing\n\t\t\t\trun_no_sandbox(argc, argv);\n\t\t\t\t// it will never get here!\n\t\t\t\tassert(0);\n\t\t\t}\n\t\t\telse\n\t\t\t\toption_force = 1;\n\t\t}\n\t}\n\t\n\t// check root/suid\n\tEUID_ROOT();\n\tif (geteuid()) {\n\t\t// detect --version\n\t\tfor (i = 1; i < argc; i++) {\n\t\t\tif (strcmp(argv[i], \"--version\") == 0) {\n\t\t\t\tprintf(\"firejail version %s\\n\", VERSION);\n\t\t\t\texit(0);\n\t\t\t}\n\t\t\t\n\t\t\t// detect end of firejail params\n\t\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\t\tbreak;\n\t\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\t\tbreak;\n\t\t}\n\t\texit(1);\n\t}\n\tEUID_USER();\n\n\t// initialize globals\n\tinit_cfg(argc, argv);\n\n\n\t// check firejail directories\n\tEUID_ROOT();\n\tfs_build_firejail_dir();\n\tbandwidth_del_run_file(sandbox_pid);\n\tnetwork_del_run_file(sandbox_pid);\n\tdelete_name_file(sandbox_pid);\n\tdelete_x11_file(sandbox_pid);\n\t\n\tEUID_USER();\n\t\n\t//check if the parent is sshd daemon\n\tint parent_sshd = 0;\n\t{\n\t\tpid_t ppid = getppid();\n\t\tEUID_ROOT();\n\t\tchar *comm = pid_proc_comm(ppid);\n\t\tEUID_USER();\n\t\tif (comm) {\n\t\t\tif (strcmp(comm, \"sshd\") == 0) {\n\t\t\t\targ_quiet = 1;\n\t\t\t\tparent_sshd = 1;\n\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t\t{EUID_ROOT();\n\t\t\t\tFILE *fp = fopen(\"/firelog\", \"w\");\n\t\t\t\tif (fp) {\n\t\t\t\t\tint i;\n\t\t\t\t\tfprintf(fp, \"argc %d: \", argc);\n\t\t\t\t\tfor (i = 0; i < argc; i++)\n\t\t\t\t\t\tfprintf(fp, \"#%s# \", argv[i]);\n\t\t\t\t\tfprintf(fp, \"\\n\");\n\t\t\t\t\tfclose(fp);\n\t\t\t\t}\n\t\t\t\tEUID_USER();}\n#endif\n\t\t\t\t// run sftp and scp directly without any sandboxing\n\t\t\t\t// regular login has argv[0] == \"-firejail\"\n\t\t\t\tif (*argv[0] != '-') {\n\t\t\t\t\tif (strcmp(argv[1], \"-c\") == 0 && argc > 2) {\n\t\t\t\t\t\tif (strcmp(argv[2], \"/usr/lib/openssh/sftp-server\") == 0 ||\n\t\t\t\t\t\t    strncmp(argv[2], \"scp \", 4) == 0) {\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t\t\t\t\t{EUID_ROOT();\n\t\t\t\t\t\t\tFILE *fp = fopen(\"/firelog\", \"a\");\n\t\t\t\t\t\t\tif (fp) {\n\t\t\t\t\t\t\t\tfprintf(fp, \"run without a sandbox\\n\");\n\t\t\t\t\t\t\t\tfclose(fp);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\tEUID_USER();}\n#endif\n\t\t\t\t\t\t    \n\t\t\t\t\t\t    \tdrop_privs(1);\n\t\t\t\t\t\t    \tint rv = system(argv[2]);\n\t\t\t\t\t\t    \texit(rv);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t\tfree(comm);\n\t\t}\n\t}\n\t\n\t// is this a login shell, or a command passed by sshd, insert command line options from /etc/firejail/login.users\n\tif (*argv[0] == '-' || parent_sshd) {\n\t\tif (argc == 1)\n\t\t\tlogin_shell = 1;\n\t\tfullargc = restricted_shell(cfg.username);\n\t\tif (fullargc) {\n\t\t\t\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t{EUID_ROOT();\n\t\t\tFILE *fp = fopen(\"/firelog\", \"a\");\n\t\t\tif (fp) {\n\t\t\t\tfprintf(fp, \"fullargc %d: \",  fullargc);\n\t\t\t\tint i;\n\t\t\t\tfor (i = 0; i < fullargc; i++)\n\t\t\t\t\tfprintf(fp, \"#%s# \", fullargv[i]);\n\t\t\t\tfprintf(fp, \"\\n\");\n\t\t\t\tfclose(fp);\n\t\t\t}\n\t\t\tEUID_USER();}\n#endif\n\t\t\t\n\t\t\tint j;\n\t\t\tfor (i = 1, j = fullargc; i < argc && j < MAX_ARGS; i++, j++, fullargc++)\n\t\t\t\tfullargv[j] = argv[i];\n\n\t\t\t// replace argc/argv with fullargc/fullargv\n\t\t\targv = fullargv;\n\t\t\targc = j;\n\n#ifdef DEBUG_RESTRICTED_SHELL\n\t\t\t{EUID_ROOT();\n\t\t\tFILE *fp = fopen(\"/firelog\", \"a\");\n\t\t\tif (fp) {\n\t\t\t\tfprintf(fp, \"argc %d: \", argc);\n\t\t\t\tint i;\n\t\t\t\tfor (i = 0; i < argc; i++)\n\t\t\t\t\tfprintf(fp, \"#%s# \", argv[i]);\n\t\t\t\tfprintf(fp, \"\\n\");\n\t\t\t\tfclose(fp);\n\t\t\t}\n\t\t\tEUID_USER();}\n#endif\n\t\t}\n\t}\n\telse {\n\t\t// check --output option and execute it;\n\t\tcheck_output(argc, argv); // the function will not return if --output option was found\n\t}\n\t\n\t\n\t// check for force-nonewprivs in /etc/firejail/firejail.config file\n\tif (checkcfg(CFG_FORCE_NONEWPRIVS))\n\t\targ_nonewprivs = 1;\n\t\n\tif (arg_allow_debuggers) {\n\t\tchar *cmd = strdup(\"noblacklist ${PATH}/strace\");\n\t\tif (!cmd)\n\t\t\terrExit(\"strdup\");\n\t\tprofile_add(cmd);\n\t}\n\t\n\t// parse arguments\n\tfor (i = 1; i < argc; i++) {\n\t\trun_cmd_and_exit(i, argc, argv); // will exit if the command is recognized\n\t\t\n\t\tif (strcmp(argv[i], \"--debug\") == 0) {\n\t\t\tif (!arg_quiet) {\n\t\t\t\targ_debug = 1;\n\t\t\t\tif (option_force)\n\t\t\t\t\tprintf(\"Entering sandbox-in-sandbox mode\\n\");\n\t\t\t}\n\t\t}\n\t\telse if (strcmp(argv[i], \"--debug-check-filename\") == 0)\n\t\t\targ_debug_check_filename = 1;\n\t\telse if (strcmp(argv[i], \"--debug-blacklists\") == 0)\n\t\t\targ_debug_blacklists = 1;\n\t\telse if (strcmp(argv[i], \"--debug-whitelists\") == 0)\n\t\t\targ_debug_whitelists = 1;\n\t\telse if (strcmp(argv[i], \"--quiet\") == 0) {\n\t\t\targ_quiet = 1;\n\t\t\targ_debug = 0;\n\t\t}\n\t\telse if (strcmp(argv[i], \"--force\") == 0)\n\t\t\t;\n\t\telse if (strcmp(argv[i], \"--allow-debuggers\") == 0) {\n\t\t\t// already handled\n\t\t}\n\n\t\t//*************************************\n\t\t// filtering\n\t\t//*************************************\n#ifdef HAVE_APPARMOR\n\t\telse if (strcmp(argv[i], \"--apparmor\") == 0)\n\t\t\targ_apparmor = 1;\n#endif\t\n#ifdef HAVE_SECCOMP\n\t\telse if (strncmp(argv[i], \"--protocol=\", 11) == 0) {\n\t\t\tif (checkcfg(CFG_SECCOMP)) {\n\t\t\t\tprotocol_store(argv[i] + 11);\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfprintf(stderr, \"Error: seccomp feature is disabled in Firejail configuration file\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse if (strcmp(argv[i], \"--seccomp\") == 0) {\n\t\t\tif (checkcfg(CFG_SECCOMP)) {\n\t\t\t\tif (arg_seccomp) {\n\t\t\t\t\tfprintf(stderr, \"Error: seccomp already enabled\\n\");\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\targ_seccomp = 1;\n\t\t\t}\n\t\t\telse {\n\t\t\t\tfprintf(stderr, \"Error: seccomp feature is disabled in Firejail configuration file\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}"
  },
  {
    "function_name": "guess_shell",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "836-853",
    "snippet": "char *guess_shell(void) {\n\tchar *shell = NULL;\n\t// shells in order of preference\n\tchar *shells[] = {\"/bin/bash\", \"/bin/csh\", \"/usr/bin/zsh\", \"/bin/sh\", \"/bin/ash\", NULL };\n\n\tint i = 0;\n\twhile (shells[i] != NULL) {\n\t\tstruct stat s;\n\t\t// access call checks as real UID/GID, not as effective UID/GID\n\t\tif (stat(shells[i], &s) == 0 && access(shells[i], R_OK) == 0) {\n\t\t\tshell = shells[i];\n\t\t\tbreak;\n\t\t}\n\t\ti++;\n\t}\n\n\treturn shell;\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "access",
          "args": [
            "shells[i]",
            "R_OK"
          ],
          "line": 845
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "shells[i]",
            "&s"
          ],
          "line": 845
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nchar *guess_shell(void) {\n\tchar *shell = NULL;\n\t// shells in order of preference\n\tchar *shells[] = {\"/bin/bash\", \"/bin/csh\", \"/usr/bin/zsh\", \"/bin/sh\", \"/bin/ash\", NULL };\n\n\tint i = 0;\n\twhile (shells[i] != NULL) {\n\t\tstruct stat s;\n\t\t// access call checks as real UID/GID, not as effective UID/GID\n\t\tif (stat(shells[i], &s) == 0 && access(shells[i], R_OK) == 0) {\n\t\t\tshell = shells[i];\n\t\t\tbreak;\n\t\t}\n\t\ti++;\n\t}\n\n\treturn shell;\n}"
  },
  {
    "function_name": "detect_allow_debuggers",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "800-834",
    "snippet": "static void detect_allow_debuggers(int argc, char **argv) {\n\tint i;\n\t\n\t// detect --allow-debuggers\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--allow-debuggers\") == 0) {\n\t\t\t// check kernel version\n\t\t\tstruct utsname u;\n\t\t\tint rv = uname(&u);\n\t\t\tif (rv != 0)\n\t\t\t\terrExit(\"uname\");\n\t\t\tint major;\n\t\t\tint minor;\n\t\t\tif (2 != sscanf(u.release, \"%d.%d\", &major, &minor)) {\n\t\t\t\tfprintf(stderr, \"Error: cannot extract Linux kernel version: %s\\n\", u.version);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tif (major < 4 || (major == 4 && minor < 8)) {\n\t\t\t\tfprintf(stderr, \"Error: --allow-debuggers is disabled on Linux kernels prior to 4.8. \"\n\t\t\t\t\t\"A bug in ptrace call allows a full bypass of the seccomp filter. \"\n\t\t\t\t\t\"Your current kernel version is %d.%d.\\n\", major, minor);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t\n\t\t\targ_allow_debuggers = 1;\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// detect end of firejail params\n\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\tbreak;\n\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\tbreak;\n\t}\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int arg_allow_debuggers = 0;",
      "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
      "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
      "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
      "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--\"",
            "2"
          ],
          "line": 831
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--\""
          ],
          "line": 829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 821
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: --allow-debuggers is disabled on Linux kernels prior to 4.8. \"\n\t\t\t\t\t\"A bug in ptrace call allows a full bypass of the seccomp filter. \"\n\t\t\t\t\t\"Your current kernel version is %d.%d.\\n\"",
            "major",
            "minor"
          ],
          "line": 818
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot extract Linux kernel version: %s\\n\"",
            "u.version"
          ],
          "line": 814
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "u.release",
            "\"%d.%d\"",
            "&major",
            "&minor"
          ],
          "line": 813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"uname\""
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uname",
          "args": [
            "&u"
          ],
          "line": 808
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--allow-debuggers\""
          ],
          "line": 805
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_allow_debuggers = 0;\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nstatic void detect_allow_debuggers(int argc, char **argv) {\n\tint i;\n\t\n\t// detect --allow-debuggers\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--allow-debuggers\") == 0) {\n\t\t\t// check kernel version\n\t\t\tstruct utsname u;\n\t\t\tint rv = uname(&u);\n\t\t\tif (rv != 0)\n\t\t\t\terrExit(\"uname\");\n\t\t\tint major;\n\t\t\tint minor;\n\t\t\tif (2 != sscanf(u.release, \"%d.%d\", &major, &minor)) {\n\t\t\t\tfprintf(stderr, \"Error: cannot extract Linux kernel version: %s\\n\", u.version);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\tif (major < 4 || (major == 4 && minor < 8)) {\n\t\t\t\tfprintf(stderr, \"Error: --allow-debuggers is disabled on Linux kernels prior to 4.8. \"\n\t\t\t\t\t\"A bug in ptrace call allows a full bypass of the seccomp filter. \"\n\t\t\t\t\t\"Your current kernel version is %d.%d.\\n\", major, minor);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t\n\t\t\targ_allow_debuggers = 1;\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// detect end of firejail params\n\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\tbreak;\n\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "detect_quiet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "782-798",
    "snippet": "static void detect_quiet(int argc, char **argv) {\n\tint i;\n\t\n\t// detect --quiet\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--quiet\") == 0) {\n\t\t\targ_quiet = 1;\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// detect end of firejail params\n\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\tbreak;\n\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\tbreak;\n\t}\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int arg_quiet = 0;",
      "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
      "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
      "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
      "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "argv[i]",
            "\"--\"",
            "2"
          ],
          "line": 795
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--\""
          ],
          "line": 793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--quiet\""
          ],
          "line": 787
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_quiet = 0;\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nstatic void detect_quiet(int argc, char **argv) {\n\tint i;\n\t\n\t// detect --quiet\n\tfor (i = 1; i < argc; i++) {\n\t\tif (strcmp(argv[i], \"--quiet\") == 0) {\n\t\t\targ_quiet = 1;\n\t\t\tbreak;\n\t\t}\n\t\t\n\t\t// detect end of firejail params\n\t\tif (strcmp(argv[i], \"--\") == 0)\n\t\t\tbreak;\n\t\tif (strncmp(argv[i], \"--\", 2) != 0)\n\t\t\tbreak;\n\t}\n}"
  },
  {
    "function_name": "delete_x11_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "773-780",
    "snippet": "static void delete_x11_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_X11_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void set_name_file(pid_t pid);",
      "static void delete_name_file(pid_t pid);",
      "static void delete_x11_file(pid_t pid);",
      "pid_t pid;",
      "pid_t pid;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 779
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "fname"
          ],
          "line": 777
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 776
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d\"",
            "RUN_FIREJAIL_X11_DIR",
            "pid"
          ],
          "line": 775
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nstatic void delete_x11_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_X11_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}"
  },
  {
    "function_name": "set_x11_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "755-771",
    "snippet": "static void set_x11_file(pid_t pid, int display) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_X11_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\t// the file is deleted first\n\tFILE *fp = fopen(fname, \"w\");\n\tif (!fp) {\n\t\tfprintf(stderr, \"Error: cannot create %s\\n\", fname);\n\t\texit(1);\n\t}\n\tfprintf(fp, \"%d\\n\", display);\n\n\t// mode and ownership\n\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\tfclose(fp);\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void set_name_file(pid_t pid);",
      "static void delete_name_file(pid_t pid);",
      "static void set_x11_file(pid_t pid, int display);",
      "static void delete_x11_file(pid_t pid);",
      "pid_t pid;",
      "pid_t pid;",
      "int display = x11_display();"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 770
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET_PERMS_STREAM",
          "args": [
            "fp",
            "0",
            "0",
            "0644"
          ],
          "line": 769
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"%d\\n\"",
            "display"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 764
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot create %s\\n\"",
            "fname"
          ],
          "line": 763
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"w\""
          ],
          "line": 761
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d\"",
            "RUN_FIREJAIL_X11_DIR",
            "pid"
          ],
          "line": 757
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void set_x11_file(pid_t pid, int display);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\nint display = x11_display();\n\nstatic void set_x11_file(pid_t pid, int display) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_X11_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\t// the file is deleted first\n\tFILE *fp = fopen(fname, \"w\");\n\tif (!fp) {\n\t\tfprintf(stderr, \"Error: cannot create %s\\n\", fname);\n\t\texit(1);\n\t}\n\tfprintf(fp, \"%d\\n\", display);\n\n\t// mode and ownership\n\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\tfclose(fp);\n}"
  },
  {
    "function_name": "delete_name_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "746-753",
    "snippet": "static void delete_name_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_NAME_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void set_name_file(pid_t pid);",
      "static void delete_name_file(pid_t pid);",
      "static void delete_x11_file(pid_t pid);",
      "pid_t pid;",
      "pid_t pid;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "fname"
          ],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "fname"
          ],
          "line": 750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d\"",
            "RUN_FIREJAIL_NAME_DIR",
            "pid"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nstatic void delete_name_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_NAME_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}"
  },
  {
    "function_name": "set_name_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "728-744",
    "snippet": "static void set_name_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_NAME_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\t// the file is deleted first\n\tFILE *fp = fopen(fname, \"w\");\n\tif (!fp) {\n\t\tfprintf(stderr, \"Error: cannot create %s\\n\", fname);\n\t\texit(1);\n\t}\n\tfprintf(fp, \"%s\\n\", cfg.name);\n\n\t// mode and ownership\n\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\tfclose(fp);\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "Config cfg;",
      "static void set_name_file(pid_t pid);",
      "static void delete_name_file(pid_t pid);",
      "static void delete_x11_file(pid_t pid);",
      "pid_t pid;",
      "pid_t pid;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "fp"
          ],
          "line": 743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SET_PERMS_STREAM",
          "args": [
            "fp",
            "0",
            "0",
            "0644"
          ],
          "line": 742
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "fp",
            "\"%s\\n\"",
            "cfg.name"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 737
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot create %s\\n\"",
            "fname"
          ],
          "line": 736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fname",
            "\"w\""
          ],
          "line": 734
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 731
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&fname",
            "\"%s/%d\"",
            "RUN_FIREJAIL_NAME_DIR",
            "pid"
          ],
          "line": 730
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nConfig cfg;\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nstatic void set_name_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_NAME_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\n\t// the file is deleted first\n\tFILE *fp = fopen(fname, \"w\");\n\tif (!fp) {\n\t\tfprintf(stderr, \"Error: cannot create %s\\n\", fname);\n\t\texit(1);\n\t}\n\tfprintf(fp, \"%s\\n\", cfg.name);\n\n\t// mode and ownership\n\tSET_PERMS_STREAM(fp, 0, 0, 0644);\n\tfclose(fp);\n}"
  },
  {
    "function_name": "run_cmd_and_exit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "259-312",
    "snippet": "static void run_cmd_and_exit(int i, int argc, char **argv) {\n\tEUID_ASSERT();\n\t\n\t//*************************************\n\t// basic arguments\n\t//*************************************\n\tif (strcmp(argv[i], \"--help\") == 0 ||\n\t    strcmp(argv[i], \"-?\") == 0) {\n\t\tusage();\n\t\texit(0);\n\t}\n\telse if (strcmp(argv[i], \"--version\") == 0) {\n\t\tprintf(\"firejail version %s\\n\", VERSION);\n\t\tprintf(\"\\n\");\n\t\tprint_compiletime_support();\n\t\tprintf(\"\\n\");\n\t\texit(0);\n\t}\n#ifdef HAVE_OVERLAYFS\n\telse if (strcmp(argv[i], \"--overlay-clean\") == 0) {\n\t\tif (checkcfg(CFG_OVERLAYFS)) {\n\t\t\tchar *path;\n\t\t\tif (asprintf(&path, \"%s/.firejail\", cfg.homedir) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tEUID_ROOT();\n\t\t\tif (setreuid(0, 0) < 0)\n\t\t\t\terrExit(\"setreuid\");\n\t\t\tif (setregid(0, 0) < 0)\n\t\t\t\terrExit(\"setregid\");\n\t\t\terrno = 0;\n\t\t\tint rv = remove_directory(path);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Error: cannot removed overlays stored in ~/.firejail directory, errno %d\\n\", errno);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tfprintf(stderr, \"Error: overlayfs feature is disabled in Firejail configuration file\\n\");\n\t\t\texit(1);\n\t\t}\n\t\texit(0);\n\t}\n#endif\n#ifdef HAVE_X11\n\telse if (strcmp(argv[i], \"--x11\") == 0) {\n\t\tif (checkcfg(CFG_X11)) {\n\t\t\tx11_start(argc, argv);\n\t\t\texit(0);\n\t\t}\n\t\telse {\n\t\t\tfprintf(stderr, \"Error: --x11 feature is disabled in Firejail configuration file\\n\");\n\t\t\texit(1);\n\t\t}\n\t}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "Config cfg;",
      "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
      "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
      "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
      "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 310
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: --x11 feature is disabled in Firejail configuration file\\n\""
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "x11_start",
          "args": [
            "argc",
            "argv"
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "x11_start",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/x11.c",
          "lines": "584-604",
          "snippet": "void x11_start(int argc, char **argv) {\n\tEUID_ASSERT();\n\n\t// unfortunately, xpra does a number of weird things when started by root user!!!\n\tif (getuid() == 0) {\n\t\tfprintf(stderr, \"Error: X11 sandboxing is not available when running as root\\n\");\n\t\texit(1);\n\t}\n\n\t// check xpra\n\tif (x11_check_xpra() == 1)\n\t\tx11_start_xpra(argc, argv);\n\telse if (x11_check_xephyr() == 1)\n\t\tx11_start_xephyr(argc, argv);\n\telse {\n\t\tfprintf(stderr, \"\\nError: Xpra or Xephyr not found in /usr/bin directory, please install one of them:\\n\");\n\t\tfprintf(stderr, \"   Debian/Ubuntu/Mint: sudo apt-get install xpra\\n\");\n\t\tfprintf(stderr, \"   Debian/Ubuntu/Mint: sudo apt-get install xserver-xephyr\\n\");\n\t\texit(0);\n\t}\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <dirent.h>",
            "#include <stdlib.h>",
            "#include <signal.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <sys/mount.h>\n#include <dirent.h>\n#include <stdlib.h>\n#include <signal.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid x11_start(int argc, char **argv) {\n\tEUID_ASSERT();\n\n\t// unfortunately, xpra does a number of weird things when started by root user!!!\n\tif (getuid() == 0) {\n\t\tfprintf(stderr, \"Error: X11 sandboxing is not available when running as root\\n\");\n\t\texit(1);\n\t}\n\n\t// check xpra\n\tif (x11_check_xpra() == 1)\n\t\tx11_start_xpra(argc, argv);\n\telse if (x11_check_xephyr() == 1)\n\t\tx11_start_xephyr(argc, argv);\n\telse {\n\t\tfprintf(stderr, \"\\nError: Xpra or Xephyr not found in /usr/bin directory, please install one of them:\\n\");\n\t\tfprintf(stderr, \"   Debian/Ubuntu/Mint: sudo apt-get install xpra\\n\");\n\t\tfprintf(stderr, \"   Debian/Ubuntu/Mint: sudo apt-get install xserver-xephyr\\n\");\n\t\texit(0);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "x11\") == 0) {\n\t\tif",
          "args": [
            "checkcfg(CFG_X11)"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "checkcfg",
          "args": [
            "CFG_X11"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "checkcfg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/checkcfg.c",
          "lines": "32-286",
          "snippet": "int checkcfg(int val) {\n\tassert(val < CFG_MAX);\n\tint line = 0;\n\n\tif (!initialized) {\n\t\t// initialize defaults\n\t\tint i;\n\t\tfor (i = 0; i < CFG_MAX; i++)\n\t\t\tcfg_val[i] = 1; // most of them are enabled by default\n\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 0; // disabled by default\n\t\tcfg_val[CFG_FORCE_NONEWPRIVS] = 0; // disabled by default\n\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 0; // disabled by default\n\t\t\n\t\t// open configuration file\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"%s/firejail.config\", SYSCONFDIR) == -1)\n\t\t\terrExit(\"asprintf\");\n\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n#ifdef HAVE_GLOBALCFG\t\t\t\n\t\t\tfprintf(stderr, \"Error: Firejail configuration file %s not found\\n\", fname);\n\t\t\texit(1);\n#else\n\t\t\tinitialized = 1;\n\t\t\treturn\tcfg_val[val];\n#endif\t\n\t\t}\n\t\t\n\t\t// if the file exists, it should be owned by root\n\t\tstruct stat s;\n\t\tif (stat(fname, &s) == -1)\n\t\t\terrExit(\"stat\");\n\t\tif (s.st_uid != 0) {\n\t\t\tfprintf(stderr, \"Error: configuration file should be owned by root\\n\");\n\t\t\texit(1);\n\t\t}\n\n\t\t// read configuration file\n\t\tchar buf[MAX_READ];\n\t\twhile (fgets(buf,MAX_READ, fp)) {\n\t\t\tline++;\n\t\t\tif (*buf == '#' || *buf == '\\n') \n\t\t\t\tcontinue;\n\n\t\t\t// parse line\t\t\t\t\n\t\t\tchar *ptr = line_remove_spaces(buf);\n\t\t\tif (!ptr)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// file transfer\t\n\t\t\tif (strncmp(ptr, \"file-transfer \", 14) == 0) {\n\t\t\t\tif (strcmp(ptr + 14, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_FILE_TRANSFER] = 1;\n\t\t\t\telse if (strcmp(ptr + 14, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_FILE_TRANSFER] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// x11\n\t\t\telse if (strncmp(ptr, \"x11 \", 4) == 0) {\n\t\t\t\tif (strcmp(ptr + 4, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_X11] = 1;\n\t\t\t\telse if (strcmp(ptr + 4, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_X11] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// bind\n\t\t\telse if (strncmp(ptr, \"bind \", 5) == 0) {\n\t\t\t\tif (strcmp(ptr + 5, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_BIND] = 1;\n\t\t\t\telse if (strcmp(ptr + 5, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_BIND] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// user namespace\n\t\t\telse if (strncmp(ptr, \"userns \", 7) == 0) {\n\t\t\t\tif (strcmp(ptr + 7, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_USERNS] = 1;\n\t\t\t\telse if (strcmp(ptr + 7, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_USERNS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// chroot\n\t\t\telse if (strncmp(ptr, \"chroot \", 7) == 0) {\n\t\t\t\tif (strcmp(ptr + 7, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT] = 1;\n\t\t\t\telse if (strcmp(ptr + 7, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// nonewprivs\n\t\t\telse if (strncmp(ptr, \"force-nonewprivs \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 1;\n\t\t\t\telse if (strcmp(ptr + 17, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// seccomp\n\t\t\telse if (strncmp(ptr, \"seccomp \", 8) == 0) {\n\t\t\t\tif (strcmp(ptr + 8, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 1;\n\t\t\t\telse if (strcmp(ptr + 8, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// whitelist\n\t\t\telse if (strncmp(ptr, \"whitelist \", 10) == 0) {\n\t\t\t\tif (strcmp(ptr + 10, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_WHITELIST] = 1;\n\t\t\t\telse if (strcmp(ptr + 10, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_WHITELIST] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// network\n\t\t\telse if (strncmp(ptr, \"network \", 8) == 0) {\n\t\t\t\tif (strcmp(ptr + 8, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_NETWORK] = 1;\n\t\t\t\telse if (strcmp(ptr + 8, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_NETWORK] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// network\n\t\t\telse if (strncmp(ptr, \"restricted-network \", 19) == 0) {\n\t\t\t\tif (strcmp(ptr + 19, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 1;\n\t\t\t\telse if (strcmp(ptr + 19, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// netfilter\n\t\t\telse if (strncmp(ptr, \"netfilter-default \", 18) == 0) {\n\t\t\t\tchar *fname = ptr + 18;\n\t\t\t\twhile (*fname == ' ' || *fname == '\\t')\n\t\t\t\t\tptr++;\n\t\t\t\tchar *end = strchr(fname, ' ');\n\t\t\t\tif (end)\n\t\t\t\t\t*end = '\\0';\n\t\t\t\t\n\t\t\t\t// is the file present?\n\t\t\t\tstruct stat s;\n\t\t\t\tif (stat(fname, &s) == -1) {\n\t\t\t\t\tfprintf(stderr, \"Error: netfilter-default file %s not available\\n\", fname);\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tnetfilter_default = strdup(fname);\n\t\t\t\tif (!netfilter_default)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tprintf(\"netfilter default file %s\\n\", fname);\n\t\t\t}\n\t\t\t\n\t\t\t// Xephyr screen size\n\t\t\telse if (strncmp(ptr, \"xephyr-screen \", 14) == 0) {\n\t\t\t\t// expecting two numbers and an x between them\n\t\t\t\tint n1;\n\t\t\t\tint n2;\n\t\t\t\tint rv = sscanf(ptr + 14, \"%dx%d\", &n1, &n2);\n\t\t\t\tif (rv != 2)\n\t\t\t\t\tgoto errout;\n\t\t\t\tif (asprintf(&xephyr_screen, \"%dx%d\", n1, n2) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t}\n\t\n\t\t\t// xephyr window title\n\t\t\telse if (strncmp(ptr, \"xephyr-window-title \", 20) == 0) {\n\t\t\t\tif (strcmp(ptr + 20, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_XEPHYR_WINDOW_TITLE] = 1;\n\t\t\t\telse if (strcmp(ptr + 20, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_XEPHYR_WINDOW_TITLE] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t\t\n\t\t\t// Xephyr command extra parameters\n\t\t\telse if (strncmp(ptr, \"xephyr-extra-params \", 19) == 0) {\n\t\t\t\txephyr_extra_params = strdup(ptr + 19);\n\t\t\t\tif (!xephyr_extra_params)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t}\n\t\t\t\n\t\t\t// quiet by default\n\t\t\telse if (strncmp(ptr, \"quiet-by-default \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\targ_quiet = 1;\n\t\t\t}\n\t\t\t// remount /proc and /sys\n\t\t\telse if (strncmp(ptr, \"remount-proc-sys \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_REMOUNT_PROC_SYS] = 1;\n\t\t\t\telse if (strcmp(ptr + 17, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_REMOUNT_PROC_SYS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"overlayfs \", 10) == 0) {\n\t\t\t\tif (strcmp(ptr + 10, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_OVERLAYFS] = 1;\n\t\t\t\telse if (strcmp(ptr + 10, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_OVERLAYFS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"private-home \", 13) == 0) {\n\t\t\t\tif (strcmp(ptr + 13, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_HOME] = 1;\n\t\t\t\telse if (strcmp(ptr + 13, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_HOME] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"chroot-desktop \", 15) == 0) {\n\t\t\t\tif (strcmp(ptr + 15, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT_DESKTOP] = 1;\n\t\t\t\telse if (strcmp(ptr + 15, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT_DESKTOP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"private-bin-no-local \", 21) == 0) {\n\t\t\t\tif (strcmp(ptr + 21, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 1;\n\t\t\t\telse if (strcmp(ptr + 21, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse\n\t\t\t\tgoto errout;\n\n\t\t\tfree(ptr);\n\t\t}\n\n\t\tfclose(fp);\n\t\tfree(fname);\n\t\tinitialized = 1;\n\t}\n\t\n\treturn cfg_val[val];\n\t\nerrout:\n\tfprintf(stderr, \"Error: invalid line %d in firejail configuration file\\n\", line );\n\texit(1);\n}",
          "includes": [
            "#include <linux/loop.h>",
            "#include <sys/stat.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_READ 8192\t\t\t\t  // line buffer for profile files"
          ],
          "globals_used": [
            "static int initialized = 0;",
            "static int cfg_val[CFG_MAX];",
            "char *xephyr_screen = \"800x600\";",
            "char *xephyr_extra_params = \"\";",
            "char *netfilter_default = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <linux/loop.h>\n#include <sys/stat.h>\n#include \"firejail.h\"\n\n#define MAX_READ 8192\t\t\t\t  // line buffer for profile files\n\nstatic int initialized = 0;\nstatic int cfg_val[CFG_MAX];\nchar *xephyr_screen = \"800x600\";\nchar *xephyr_extra_params = \"\";\nchar *netfilter_default = NULL;\n\nint checkcfg(int val) {\n\tassert(val < CFG_MAX);\n\tint line = 0;\n\n\tif (!initialized) {\n\t\t// initialize defaults\n\t\tint i;\n\t\tfor (i = 0; i < CFG_MAX; i++)\n\t\t\tcfg_val[i] = 1; // most of them are enabled by default\n\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 0; // disabled by default\n\t\tcfg_val[CFG_FORCE_NONEWPRIVS] = 0; // disabled by default\n\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 0; // disabled by default\n\t\t\n\t\t// open configuration file\n\t\tchar *fname;\n\t\tif (asprintf(&fname, \"%s/firejail.config\", SYSCONFDIR) == -1)\n\t\t\terrExit(\"asprintf\");\n\n\t\tFILE *fp = fopen(fname, \"r\");\n\t\tif (!fp) {\n#ifdef HAVE_GLOBALCFG\t\t\t\n\t\t\tfprintf(stderr, \"Error: Firejail configuration file %s not found\\n\", fname);\n\t\t\texit(1);\n#else\n\t\t\tinitialized = 1;\n\t\t\treturn\tcfg_val[val];\n#endif\t\n\t\t}\n\t\t\n\t\t// if the file exists, it should be owned by root\n\t\tstruct stat s;\n\t\tif (stat(fname, &s) == -1)\n\t\t\terrExit(\"stat\");\n\t\tif (s.st_uid != 0) {\n\t\t\tfprintf(stderr, \"Error: configuration file should be owned by root\\n\");\n\t\t\texit(1);\n\t\t}\n\n\t\t// read configuration file\n\t\tchar buf[MAX_READ];\n\t\twhile (fgets(buf,MAX_READ, fp)) {\n\t\t\tline++;\n\t\t\tif (*buf == '#' || *buf == '\\n') \n\t\t\t\tcontinue;\n\n\t\t\t// parse line\t\t\t\t\n\t\t\tchar *ptr = line_remove_spaces(buf);\n\t\t\tif (!ptr)\n\t\t\t\tcontinue;\n\t\t\t\n\t\t\t// file transfer\t\n\t\t\tif (strncmp(ptr, \"file-transfer \", 14) == 0) {\n\t\t\t\tif (strcmp(ptr + 14, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_FILE_TRANSFER] = 1;\n\t\t\t\telse if (strcmp(ptr + 14, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_FILE_TRANSFER] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// x11\n\t\t\telse if (strncmp(ptr, \"x11 \", 4) == 0) {\n\t\t\t\tif (strcmp(ptr + 4, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_X11] = 1;\n\t\t\t\telse if (strcmp(ptr + 4, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_X11] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// bind\n\t\t\telse if (strncmp(ptr, \"bind \", 5) == 0) {\n\t\t\t\tif (strcmp(ptr + 5, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_BIND] = 1;\n\t\t\t\telse if (strcmp(ptr + 5, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_BIND] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// user namespace\n\t\t\telse if (strncmp(ptr, \"userns \", 7) == 0) {\n\t\t\t\tif (strcmp(ptr + 7, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_USERNS] = 1;\n\t\t\t\telse if (strcmp(ptr + 7, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_USERNS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// chroot\n\t\t\telse if (strncmp(ptr, \"chroot \", 7) == 0) {\n\t\t\t\tif (strcmp(ptr + 7, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT] = 1;\n\t\t\t\telse if (strcmp(ptr + 7, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// nonewprivs\n\t\t\telse if (strncmp(ptr, \"force-nonewprivs \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 1;\n\t\t\t\telse if (strcmp(ptr + 17, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// seccomp\n\t\t\telse if (strncmp(ptr, \"seccomp \", 8) == 0) {\n\t\t\t\tif (strcmp(ptr + 8, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 1;\n\t\t\t\telse if (strcmp(ptr + 8, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_SECCOMP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// whitelist\n\t\t\telse if (strncmp(ptr, \"whitelist \", 10) == 0) {\n\t\t\t\tif (strcmp(ptr + 10, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_WHITELIST] = 1;\n\t\t\t\telse if (strcmp(ptr + 10, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_WHITELIST] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// network\n\t\t\telse if (strncmp(ptr, \"network \", 8) == 0) {\n\t\t\t\tif (strcmp(ptr + 8, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_NETWORK] = 1;\n\t\t\t\telse if (strcmp(ptr + 8, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_NETWORK] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// network\n\t\t\telse if (strncmp(ptr, \"restricted-network \", 19) == 0) {\n\t\t\t\tif (strcmp(ptr + 19, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 1;\n\t\t\t\telse if (strcmp(ptr + 19, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_RESTRICTED_NETWORK] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t// netfilter\n\t\t\telse if (strncmp(ptr, \"netfilter-default \", 18) == 0) {\n\t\t\t\tchar *fname = ptr + 18;\n\t\t\t\twhile (*fname == ' ' || *fname == '\\t')\n\t\t\t\t\tptr++;\n\t\t\t\tchar *end = strchr(fname, ' ');\n\t\t\t\tif (end)\n\t\t\t\t\t*end = '\\0';\n\t\t\t\t\n\t\t\t\t// is the file present?\n\t\t\t\tstruct stat s;\n\t\t\t\tif (stat(fname, &s) == -1) {\n\t\t\t\t\tfprintf(stderr, \"Error: netfilter-default file %s not available\\n\", fname);\n\t\t\t\t\texit(1);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tnetfilter_default = strdup(fname);\n\t\t\t\tif (!netfilter_default)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tprintf(\"netfilter default file %s\\n\", fname);\n\t\t\t}\n\t\t\t\n\t\t\t// Xephyr screen size\n\t\t\telse if (strncmp(ptr, \"xephyr-screen \", 14) == 0) {\n\t\t\t\t// expecting two numbers and an x between them\n\t\t\t\tint n1;\n\t\t\t\tint n2;\n\t\t\t\tint rv = sscanf(ptr + 14, \"%dx%d\", &n1, &n2);\n\t\t\t\tif (rv != 2)\n\t\t\t\t\tgoto errout;\n\t\t\t\tif (asprintf(&xephyr_screen, \"%dx%d\", n1, n2) == -1)\n\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t}\n\t\n\t\t\t// xephyr window title\n\t\t\telse if (strncmp(ptr, \"xephyr-window-title \", 20) == 0) {\n\t\t\t\tif (strcmp(ptr + 20, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_XEPHYR_WINDOW_TITLE] = 1;\n\t\t\t\telse if (strcmp(ptr + 20, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_XEPHYR_WINDOW_TITLE] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\t\t\n\t\t\t// Xephyr command extra parameters\n\t\t\telse if (strncmp(ptr, \"xephyr-extra-params \", 19) == 0) {\n\t\t\t\txephyr_extra_params = strdup(ptr + 19);\n\t\t\t\tif (!xephyr_extra_params)\n\t\t\t\t\terrExit(\"strdup\");\n\t\t\t}\n\t\t\t\n\t\t\t// quiet by default\n\t\t\telse if (strncmp(ptr, \"quiet-by-default \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\targ_quiet = 1;\n\t\t\t}\n\t\t\t// remount /proc and /sys\n\t\t\telse if (strncmp(ptr, \"remount-proc-sys \", 17) == 0) {\n\t\t\t\tif (strcmp(ptr + 17, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_REMOUNT_PROC_SYS] = 1;\n\t\t\t\telse if (strcmp(ptr + 17, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_REMOUNT_PROC_SYS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"overlayfs \", 10) == 0) {\n\t\t\t\tif (strcmp(ptr + 10, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_OVERLAYFS] = 1;\n\t\t\t\telse if (strcmp(ptr + 10, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_OVERLAYFS] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"private-home \", 13) == 0) {\n\t\t\t\tif (strcmp(ptr + 13, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_HOME] = 1;\n\t\t\t\telse if (strcmp(ptr + 13, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_HOME] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"chroot-desktop \", 15) == 0) {\n\t\t\t\tif (strcmp(ptr + 15, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT_DESKTOP] = 1;\n\t\t\t\telse if (strcmp(ptr + 15, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_CHROOT_DESKTOP] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse if (strncmp(ptr, \"private-bin-no-local \", 21) == 0) {\n\t\t\t\tif (strcmp(ptr + 21, \"yes\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 1;\n\t\t\t\telse if (strcmp(ptr + 21, \"no\") == 0)\n\t\t\t\t\tcfg_val[CFG_PRIVATE_BIN_NO_LOCAL] = 0;\n\t\t\t\telse\n\t\t\t\t\tgoto errout;\n\t\t\t}\n\t\t\telse\n\t\t\t\tgoto errout;\n\n\t\t\tfree(ptr);\n\t\t}\n\n\t\tfclose(fp);\n\t\tfree(fname);\n\t\tinitialized = 1;\n\t}\n\t\n\treturn cfg_val[val];\n\t\nerrout:\n\tfprintf(stderr, \"Error: invalid line %d in firejail configuration file\\n\", line );\n\texit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: overlayfs feature is disabled in Firejail configuration file\\n\""
          ],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: cannot removed overlays stored in ~/.firejail directory, errno %d\\n\"",
            "errno"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove_directory",
          "args": [
            "path"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "remove_directory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "716-719",
          "snippet": "int remove_directory(const char *path) {\n\t// FTW_PHYS - do not follow symbolic links\n\treturn nftw(path, remove_callback, 64, FTW_DEPTH | FTW_PHYS);\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nint remove_directory(const char *path) {\n\t// FTW_PHYS - do not follow symbolic links\n\treturn nftw(path, remove_callback, 64, FTW_DEPTH | FTW_PHYS);\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setregid\""
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setregid",
          "args": [
            "0",
            "0"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setreuid\""
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setreuid",
          "args": [
            "0",
            "0"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&path",
            "\"%s/.firejail\"",
            "cfg.homedir"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clean\") == 0) {\n\t\tif",
          "args": [
            "checkcfg(CFG_OVERLAYFS)"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_compiletime_support",
          "args": [],
          "line": 273
        },
        "resolved": true,
        "details": {
          "function_name": "print_compiletime_support",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/checkcfg.c",
          "lines": "289-395",
          "snippet": "void print_compiletime_support(void) {\n\tprintf(\"Compile time support:\\n\");\n\tprintf(\"\\t- AppArmor support is %s\\n\",\n#ifdef HAVE_APPARMOR\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- AppImage support is %s\\n\",\n#ifdef LOOP_CTL_GET_FREE\t// test for older kernels; this definition is found in /usr/include/linux/loop.h\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\n\n\n\n\tprintf(\"\\t- bind support is %s\\n\",\n#ifdef HAVE_BIND\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- chroot support is %s\\n\",\n#ifdef HAVE_CHROOT\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- file and directory whitelisting support is %s\\n\",\n#ifdef HAVE_WHITELIST\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- file transfer support is %s\\n\",\n#ifdef HAVE_FILE_TRANSFER\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- networking support is %s\\n\",\n#ifdef HAVE_NETWORK\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\n#ifdef HAVE_NETWORK_RESTRICTED\n\tprintf(\"\\t- networking features are available only to root user\\n\");\n#endif\n\n\tprintf(\"\\t- overlayfs support is %s\\n\",\n#ifdef HAVE_OVERLAYFS\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- private-home support is %s\\n\",\n#ifdef HAVE_PRIVATE_HOME\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- seccomp-bpf support is %s\\n\",\n#ifdef HAVE_SECCOMP\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- user namespace support is %s\\n\",\n#ifdef HAVE_USERNS\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- X11 sandboxing support is %s\\n\",\n#ifdef HAVE_X11\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n}",
          "includes": [
            "#include <linux/loop.h>",
            "#include <sys/stat.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <linux/loop.h>\n#include <sys/stat.h>\n#include \"firejail.h\"\n\nvoid print_compiletime_support(void) {\n\tprintf(\"Compile time support:\\n\");\n\tprintf(\"\\t- AppArmor support is %s\\n\",\n#ifdef HAVE_APPARMOR\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- AppImage support is %s\\n\",\n#ifdef LOOP_CTL_GET_FREE\t// test for older kernels; this definition is found in /usr/include/linux/loop.h\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\n\n\n\n\tprintf(\"\\t- bind support is %s\\n\",\n#ifdef HAVE_BIND\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- chroot support is %s\\n\",\n#ifdef HAVE_CHROOT\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- file and directory whitelisting support is %s\\n\",\n#ifdef HAVE_WHITELIST\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- file transfer support is %s\\n\",\n#ifdef HAVE_FILE_TRANSFER\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- networking support is %s\\n\",\n#ifdef HAVE_NETWORK\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\n#ifdef HAVE_NETWORK_RESTRICTED\n\tprintf(\"\\t- networking features are available only to root user\\n\");\n#endif\n\n\tprintf(\"\\t- overlayfs support is %s\\n\",\n#ifdef HAVE_OVERLAYFS\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- private-home support is %s\\n\",\n#ifdef HAVE_PRIVATE_HOME\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- seccomp-bpf support is %s\\n\",\n#ifdef HAVE_SECCOMP\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- user namespace support is %s\\n\",\n#ifdef HAVE_USERNS\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n\n\tprintf(\"\\t- X11 sandboxing support is %s\\n\",\n#ifdef HAVE_X11\n\t\t\"enabled\"\n#else\n\t\t\"disabled\"\n#endif\n\t\t);\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\n\""
          ],
          "line": 272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"firejail version %s\\n\"",
            "VERSION"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--version\""
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "usage",
          "args": [],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "usage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/usage.c",
          "lines": "22-407",
          "snippet": "void usage(void) {\n\tprintf(\"firejail - version %s\\n\\n\", VERSION);\n\tprintf(\"Firejail is a SUID sandbox program that reduces the risk of security breaches by\\n\");\n\tprintf(\"restricting the running environment of untrusted applications using Linux\\n\");\n\tprintf(\"namespaces. It includes a sandbox profile for Mozilla Firefox.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Usage: firejail [options] [program and arguments]\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Without any options, the sandbox consists of a filesystem chroot build from the\\n\");\n\tprintf(\"current system directories  mounted  read-only,  and  new PID and IPC\\n\");\n\tprintf(\"namespaces. If no program is specified as an argument, /bin/bash is started by\\n\");\n\tprintf(\"default in the sandbox.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Options:\\n\\n\");\n\tprintf(\"    -- - signal the end of options and disables further option processing.\\n\\n\");\n\tprintf(\"    --allow-debuggers - allow tools such as strace and gdb inside the sandbox.\\n\\n\");\n\tprintf(\"    --allusers - all user home directories are visible inside the sandbox.\\n\\n\");\n\tprintf(\"    --apparmor - enable AppArmor confinement\\n\\n\");\n\tprintf(\"    --appimage - sandbox an AppImage application\\n\\n\");\n\tprintf(\"    --audit - audit the sandbox, see Audit section for more details\\n\\n\");\n\tprintf(\"    --audit=test-program - audit the sandbox, see Audit section for more details\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --bandwidth=name|pid - set  bandwidth  limits  for  the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID, see Traffic Shaping section fo more details.\\n\\n\");\n#endif\n#ifdef HAVE_BIND\t\t\n\tprintf(\"    --bind=dirname1,dirname2 - mount-bind dirname1 on top of dirname2.\\n\\n\");\n\tprintf(\"    --bind=filename1,filename2 - mount-bind filename1 on top of filename2.\\n\\n\");\n#endif\n\tprintf(\"    --blacklist=dirname_or_filename - blacklist directory or file.\\n\\n\");\n\tprintf(\"    -c - execute command and exit.\\n\\n\");\n\tprintf(\"    --caps - enable default Linux capabilities filter.\\n\\n\");\n\tprintf(\"    --caps.drop=all - drop all capabilities.\\n\\n\");\n\tprintf(\"    --caps.drop=capability,capability - blacklist capabilities filter.\\n\\n\");\n\tprintf(\"    --caps.keep=capability,capability - whitelist capabilities filter.\\n\\n\");\n\tprintf(\"    --caps.print=name|pid - print the caps filter for the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID.\\n\\n\");\n\tprintf(\"    --cgroup=tasks-file - place the sandbox in the specified control group.\\n\");\n\tprintf(\"\\ttasks-file is the full path of cgroup tasks file.\\n\\n\");\n#ifdef HAVE_CHROOT\t\t\n\tprintf(\"    --chroot=dirname - chroot into directory.\\n\\n\");\n#endif\n\tprintf(\"    --cpu=cpu-number,cpu-number - set cpu affinity.\\n\\n\");\n\tprintf(\"    --cpu.print=name|pid - print the cup in use by the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID.\\n\\n\");\n\tprintf(\"    --csh - use /bin/csh as default shell.\\n\\n\");\n\t\n\tprintf(\"    --debug - print sandbox debug messages.\\n\\n\");\n\tprintf(\"    --debug-blacklists - debug blacklisting.\\n\\n\");\n\tprintf(\"    --debug-caps - print all recognized capabilities in the current Firejail\\n\");\n\tprintf(\"\\tsoftware build.\\n\\n\");\n\tprintf(\"    --debug-check-filename - debug filename checking.\\n\\n\");\n\tprintf(\"    --debug-errnos - print all recognized error numbers in the current Firejail\\n\");\n\tprintf(\"\\tsoftware build.\\n\\n\");\n\tprintf(\"    --debug-protocols - print all recognized protocols in the current Firejail\\n\");\n\tprintf(\"\\tsoftware build.\\n\\n\");\n\tprintf(\"    --debug-syscalls - print all recognized system calls in the current Firejail\\n\");\n\tprintf(\"\\tsoftware build.\\n\\n\");\n#ifdef HAVE_WHITELIST\t\n\tprintf(\"    --debug-whitelists - debug whitelisting.\\n\\n\");\n#endif\n\n\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --defaultgw=address - use this address as default gateway in the new network\\n\");\n\tprintf(\"\\tnamespace.\\n\\n\");\n#endif\n\tprintf(\"    --dns=address - set a DNS server for the sandbox. Up to three DNS servers\\n\");\n\tprintf(\"\\tcan be defined.\\n\\n\");\n\tprintf(\"    --dns.print=name|pid - print DNS configuration for the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID.\\n\\n\");\n\t\n\tprintf(\"    --env=name=value - set environment variable in the new sandbox.\\n\\n\");\n\tprintf(\"    --fs.print=name|pid - print the filesystem log for the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID.\\n\\n\");\n\tprintf(\"    --get=name|pid filename - get a file from sandbox container.\\n\\n\");\n\tprintf(\"    --help, -? - this help screen.\\n\\n\");\n\tprintf(\"    --hostname=name - set sandbox hostname.\\n\\n\");\n\tprintf(\"    --ignore=command - ignore command in profile files.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --interface=name - move interface in a new network namespace. Up to four\\n\");\n\tprintf(\"\\t--interface options can be specified.\\n\\n\");\n\tprintf(\"    --ip=address - set interface IP address.\\n\\n\");\n\tprintf(\"    --ip=none - no IP address and no default gateway address are configured\\n\");\n\tprintf(\"\\tin the new network namespace. Use this option in case you intend to\\n\");\n\tprintf(\"\\tstart an external DHCP client in the sandbox.\\n\\n\");\n\tprintf(\"    --ip6=address - set interface IPv6 address.\\n\\n\");\n\tprintf(\"    --iprange=address,address - configure an IP address in this range.\\n\\n\");\n#endif\n\tprintf(\"    --ipc-namespace - enable a new IPC namespace if the sandbox was started as\\n\");\n\tprintf(\"\\tregular user. IPC namespace is enabled by default only if the sandbox\\n\");\n\tprintf(\"\\tis started as root.\\n\\n\");\n\tprintf(\"    --join=name|pid - join the sandbox identified by name or PID.\\n\\n\");\n\tprintf(\"    --join-filesystem=name|pid - join the mount namespace of the sandbox\\n\");\n\tprintf(\"\\tidentified by name or PID.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --join-network=name|pid - join the network namespace of the sandbox\\n\");\n\tprintf(\"\\tidentified by name or PID.\\n\\n\");\n#endif\n\tprintf(\"    --list - list all sandboxes.\\n\\n\");\n\tprintf(\"    --ls=name|pid dir_or_filename - list files in sandbox container.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --mac=xx:xx:xx:xx:xx:xx - set interface MAC address.\\n\\n\");\n\tprintf(\"    --mtu=number - set interface MTU.\\n\\n\");\n#endif\n\tprintf(\"    --name=name - set sandbox name.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --net=bridgename - enable network namespaces and connect to this bridge\\n\");\n\tprintf(\"\\tdevice. Up to four --net devices can be defined.\\n\\n\");\n\n\tprintf(\"    --net=ethernet_interface - enable network namespaces and connect to this\\n\");\n\tprintf(\"\\tEthernet interface using the standard Linux macvlan driver. Up to four\\n\");\n\tprintf(\"\\t--net devices can be defined.\\n\\n\");\n\t\n\tprintf(\"    --net=none - enable a new, unconnected network namespace.\\n\\n\");\n\n\tprintf(\"    --netfilter - enable the default client network filter in the new\\n\");\n\tprintf(\"\\tnetwork namespace.\\n\\n\");\n\tprintf(\"    --netfilter=filename - enable the network filter specified by\\n\");\n\tprintf(\"\\tfilename in the new network namespace. The filter file format\\n\");\n\tprintf(\"\\tis the format of iptables-save and iptable-restore commands.\\n\\n\");\n\tprintf(\"    --netfilter6=filename - enable the IPv6 network filter specified by\\n\");\n\tprintf(\"\\tfilename in the new network namespace. The filter file format\\n\");\n\tprintf(\"\\tis the format of ip6tables-save and ip6table-restore commands.\\n\\n\");\n\n\tprintf(\"    --netstats - monitor network statistics for sandboxes creating a new\\n\");\n\tprintf(\"\\tnetwork namespace.\\n\\n\");\n#endif\n\tprintf(\"    --nice=value - set nice value.\\n\\n\");\n\tprintf(\"    --no3d - disable 3D hardware acceleration.\\n\\n\");\n\tprintf(\"    --noblacklist=dirname_or_filename - disable blacklist for directory or\\n\");\n\tprintf(\"\\tfile.\\n\\n\");\n\tprintf(\"    --noexec=dirname_of_filenam - remount the file or directory noexec\\n\");\n\tprintf(\"\\tnosuid and nodev\\n\\n\");\n\tprintf(\"    --nogroups - disable supplementary groups. Without this option,\\n\");\n\tprintf(\"\\tsupplementary groups are enabled for the user starting the sandbox.\\n\");\n\tprintf(\"\\tFor root, groups are always disabled.\\n\\n\");\n\n\tprintf(\"    --noprofile - do not use a profile.  Profile priority is use the one\\n\");\n\tprintf(\"\\tspecified on the command line, next try to find one that\\n\");\n\tprintf(\"\\tmatches the command name, and lastly use %s.profile\\n\", DEFAULT_USER_PROFILE);\n\tprintf(\"\\tif running as regular user or %s.profile if running as\\n\", DEFAULT_ROOT_PROFILE);\n\tprintf(\"\\troot.\\n\\n\");\n#ifdef HAVE_USERNS\t\t \t\n\tprintf(\"    --noroot - install a user namespace with a single user - the current\\n\");\n\tprintf(\"\\tuser. root user does not exist in the new namespace. This option\\n\");\n\tprintf(\"\\tis not supported for --chroot and --overlay configurations.\\n\\n\");\n#endif\n\tprintf(\"    --nonewprivs - sets the NO_NEW_PRIVS prctl - the child processes\\n\");\n\tprintf(\"\\tcannot gain privileges using execve(2); in particular, this prevents\\n\");\n\tprintf(\"\\tgaining privileges by calling a suid binary\\n\\n\");\n\tprintf(\"    --nosound - disable sound system.\\n\\n\");\n\t\t\n\tprintf(\"    --output=logfile - stdout logging and log rotation. Copy stdout and stderr\\n\");\n\tprintf(\"\\tto logfile, and keep the size of the file under 500KB using log\\n\");\n\tprintf(\"\\trotation. Five files with prefixes .1 to .5 are used in\\n\");\n\tprintf(\"\\trotation.\\n\\n\");\n\t\n\tprintf(\"    --overlay - mount a filesystem overlay on top of the current filesystem.\\n\");\n\tprintf(\"\\tThe upper filesystem layer is persistent, and stored in\\n\");\n\tprintf(\"\\t$HOME/.firejail/<PID> directory. (OverlayFS support is required in\\n\");\n\tprintf(\"\\tLinux kernel for this option to work). \\n\\n\");\n\n\tprintf(\"    --overlay-named=name - mount a filesystem overlay on top of the current\\n\");\n\tprintf(\"\\tfilesystem. The upper filesystem layer is persistent, and stored in\\n\");\n\tprintf(\"\\t$HOME/.firejail/<NAME> directory. (OverlayFS support is required in\\n\");\n\tprintf(\"\\tLinux kernel for this option to work). \\n\\n\");\n\n\tprintf(\"    --overlay-tmpfs - mount a filesystem overlay on top of the current\\n\");\n\tprintf(\"\\tfilesystem. The upper layer is stored in a tmpfs filesystem,\\n\");\n\tprintf(\"\\tand it is discarded when the sandbox is closed. (OverlayFS\\n\");\n\tprintf(\"\\tsupport is required in Linux kernel for this option to work).\\n\\n\");   \n\t\n\tprintf(\"    --overlay-clean - clean all overlays stored in $HOME/.firejail directory.\\n\\n\");\n\n\tprintf(\"    --private - mount new /root and /home/user directories in temporary\\n\");\n\tprintf(\"\\tfilesystems. All modifications are discarded when the sandbox is\\n\");\n\tprintf(\"\\tclosed.\\n\\n\");\n\tprintf(\"    --private=directory - use directory as user home.\\n\\n\");\n\tprintf(\"    --private-home=file,directory - build a new user home in a temporary\\n\");\n\tprintf(\"\\t\\tfilesystem, and copy the files and directories in the list in\\n\");\n\tprintf(\"\\t\\tthe new home. All modifications are discarded when the sandbox\\n\");\n\tprintf(\"\\t\\tis closed.\\n\\n\");\n\n\tprintf(\"    --private-bin=file,file - build a new /bin in a temporary filesystem,\\n\");\n\tprintf(\"\\tand copy the programs in the list.\\n\\n\");\n\n\tprintf(\"    --private-dev - create a new /dev directory. Only dri, null, full, zero,\\n\");\n\tprintf(\"\\ttty, pst, ptms, random, snd, urandom, log and shm devices are available.\\n\\n\");\n\n\tprintf(\"    --private-etc=file,directory - build a new /etc in a temporary\\n\");\n\tprintf(\"\\tfilesystem, and copy the files and directories in the list.\\n\");\n\tprintf(\"\\tAll modifications are discarded when the sandbox is closed.\\n\\n\");\n\t\n\tprintf(\"    --private-tmp - mount a tmpfs on top of /tmp directory\\n\\n\");\n\t\n\tprintf(\"    --profile=filename - use a custom profile.\\n\\n\");\n\tprintf(\"    --profile-path=directory - use this directory to look for profile files.\\n\\n\");\n\t\n\tprintf(\"    --protocol=protocol,protocol,protocol - enable protocol filter.\\n\");\n\tprintf(\"\\tProtocol values: unix, inet, inet6, netlink, packet.\\n\\n\");\n\tprintf(\"    --protocol.print=name|pid - print the protocol filter for the sandbox\\n\");\n\tprintf(\"\\tidentified by name or PID.\\n\\n\");\n\t\n\tprintf(\"    --put=name|pid src-filename dest-filename - put a file in sandbox container.\\n\\n\");\n\t\n\tprintf(\"    --quiet - turn off Firejail's output.\\n\\n\");\n\tprintf(\"    --read-only=dirname_or_filename - set directory or file read-only..\\n\\n\");\n\tprintf(\"    --read-write=dirname_or_filename - set directory or file read-write..\\n\\n\");\n\tprintf(\"    --rlimit-fsize=number - set the maximum file size that can be created\\n\");\n\tprintf(\"\\tby a process.\\n\\n\");\n\tprintf(\"    --rlimit-nofile=number - set the maximum number of files that can be\\n\");\n\tprintf(\"\\topened by a process.\\n\\n\");\n\tprintf(\"    --rlimit-nproc=number - set the maximum number of processes that can be\\n\");\n\tprintf(\"\\tcreated for the real user ID of the calling process.\\n\\n\");\n\tprintf(\"    --rlimit-sigpending=number - set the maximum number of pending signals\\n\");\n\tprintf(\"\\tfor a process.\\n\\n\");\n\tprintf(\"    --rmenv=name - remove environment variable in the new sandbox.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --scan - ARP-scan all the networks from inside a network namespace.\\n\");\n\tprintf(\"\\tThis makes it possible to detect macvlan kernel device drivers\\n\");\n\tprintf(\"\\trunning on the current host.\\n\\n\");\n#endif\t\n#ifdef HAVE_SECCOMP\n\tprintf(\"    --seccomp - enable seccomp filter and apply the default blacklist.\\n\\n\");\n\t\n\tprintf(\"    --seccomp=syscall,syscall,syscall - enable seccomp filter, blacklist the\\n\");\n\tprintf(\"\\tdefault syscall list and the syscalls specified by the command.\\n\\n\");\n\t\n\tprintf(\"    --seccomp.drop=syscall,syscall,syscall - enable seccomp filter, and\\n\");\n\tprintf(\"\\tblacklist the syscalls specified by the command.\\n\\n\");\n\t\n\tprintf(\"    --seccomp.keep=syscall,syscall,syscall - enable seccomp filter, and\\n\");\n\tprintf(\"\\twhitelist the syscalls specified by the command.\\n\\n\");\n\t\n\tprintf(\"    --seccomp.<errno>=syscall,syscall,syscall - enable seccomp filter, and\\n\");\n\tprintf(\"\\treturn errno for the syscalls specified by the command.\\n\\n\");\n\t\n\tprintf(\"    --seccomp.print=name|pid - print the seccomp filter for the sandbox\\n\");\n\tprintf(\"\\tidentified by name or PID.\\n\\n\");\n#endif\n\n\tprintf(\"    --shell=none - run the program directly without a user shell.\\n\\n\");\n\tprintf(\"    --shell=program - set default user shell.\\n\\n\");\n\tprintf(\"    --shutdown=name|pid - shutdown the sandbox identified by name or PID.\\n\\n\");\n\tprintf(\"    --tmpfs=dirname - mount a tmpfs filesystem on directory dirname.\\n\");\n\tprintf(\"\\tThis option is available only when running the sandbox as root.\\n\\n\");\n\tprintf(\"    --top - monitor the most CPU-intensive sandboxes.\\n\\n\");\n\tprintf(\"    --trace - trace open, access and connect system calls.\\n\\n\");\n\tprintf(\"    --tracelog - add a syslog message for every access to files or\\n\");\n\tprintf(\"\\tdirectoires blacklisted by the security profile.\\n\\n\");\n\tprintf(\"    --tree - print a tree of all sandboxed processes.\\n\\n\");\n\tprintf(\"    --version - print program version and exit.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --veth-name=name - use this name for the interface connected to the bridge\\n\");\n\tprintf(\"\\tfor --net=bridgename commands, instead of the default one.\\n\\n\"); \n#endif\t\n#ifdef HAVE_WHITELIST\t\n\tprintf(\"    --whitelist=dirname_or_filename - whitelist directory or file.\\n\\n\");\n#endif\t\n\tprintf(\"    --writable-etc - /etc directory is mounted read-write.\\n\\n\");\n\tprintf(\"    --writable-var - /var directory is mounted read-write.\\n\\n\");\n\t\n\tprintf(\"    --x11 - enable X11 sandboxing. The software checks first if Xpra is\\n\");\n\tprintf(\"\\tinstalled, then it checks if Xephyr is installed. If all fails, it will\\n\");\n\tprintf(\"\\tattempt to use X11 security extension.\\n\\n\");\n\tprintf(\"    --x11=none - disable access to X11 sockets.\\n\\n\");\n\tprintf(\"    --x11=xephyr - enable Xephyr X11 server. The window size is 800x600.\\n\\n\");\n\tprintf(\"    --x11=xorg - enable X11 security extension.\\n\\n\");\n\tprintf(\"    --x11=xpra - enable Xpra X11 server.\\n\\n\");\n\tprintf(\"    --zsh - use /usr/bin/zsh as default shell.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"\\n\");\n\n\n#ifdef HAVE_NETWORK\t\n\tprintf(\"Traffic Shaping\\n\\n\");\n\t\n\tprintf(\"Network bandwidth is an expensive resource shared among  all  sandboxes\\n\");\n\tprintf(\"running  on a system.  Traffic shaping allows the user to increase network\\n\");\n\tprintf(\"performance by controlling the amount of data that flows into and out of the\\n\");\n\tprintf(\"sandboxes. Firejail  implements  a simple rate-limiting shaper based on Linux\\n\");\n\tprintf(\"command tc. The shaper works at sandbox level, and can be used  only  for\\n\");\n\tprintf(\"sandboxes configured with new network namespaces.\\n\\n\");\n\n\tprintf(\"Set rate-limits:\\n\");\n\tprintf(\"    firejail  --bandwidth={name|pid} set network-name down-speed up-speed\\n\\n\");\n\tprintf(\"Clear rate-limits:\\n\");\n\tprintf(\"    firejail --bandwidth={name|pid} clear network-name\\n\\n\");\n\tprintf(\"Status:\\n\");\n\tprintf(\"    firejail --bandwidth={name|pid} status\\n\\n\");\n\tprintf(\"where:\\n\");\n            printf(\"    name - sandbox name\\n\");\n            printf(\"    pid - sandbox pid\\n\");\n            printf(\"    network-name - network name as used by --net option\\n\");\n            printf(\"    down-speed - download speed in KB/s (decimal kilobyte per second)\\n\");\n            printf(\"    up-speed - upload speed in KB/s (decimal kilobyte per second)\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Example:\\n\");\n            printf(\"    $ firejail --name=mybrowser --net=eth0 firefox &\\n\");\n            printf(\"    $ firejail --bandwidth=mybrowser set eth0 80 20\\n\");\n            printf(\"    $ firejail --bandwidth=mybrowser status\\n\");\n            printf(\"    $ firejail --bandwidth=mybrowser clear eth0\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"\\n\");\n#endif\n\n\tprintf(\"Audit\\n\\n\");\n\tprintf(\"Audit feature allows the user to point out gaps in security profiles. The\\n\");\n\tprintf(\"implementation replaces the program to be sandboxed with a test program. By\\n\");\n\tprintf(\"default, we use faudit program distributed with Firejail. A custom test program\\n\");\n\tprintf(\"can also be supplied by the user. Examples:\\n\\n\");\n\tprintf(\"Running the default audit program:\\n\");\n\tprintf(\"    $ firejail --audit transmission-gtk\\n\\n\");\n\tprintf(\"Running a custom audit program:\\n\");\n\tprintf(\"    $ firejail --audit=~/sandbox-test transmission-gtk\\n\\n\");\n\tprintf(\"In the examples above, the sandbox configures transmission-gtk profile and\\n\");\n\tprintf(\"starts the test program. The real program, transmission-gtk, will not be\\n\");\n\tprintf(\"started.\\n\\n\\n\");\n\t\n\tprintf(\"Monitoring\\n\\n\");\n\n\tprintf(\"Option --list prints a list of all sandboxes. The format for each entry is as\\n\");\n\tprintf(\"follows:\\n\\n\");\n\tprintf(\"    PID:USER:Command\\n\\n\");\n\n\tprintf(\"Option --tree prints the tree of processes running in the sandbox. The format\\n\");\n\tprintf(\"for each process entry is as follows:\\n\\n\");\n\tprintf(\"    PID:USER:Command\\n\\n\");\n\n\tprintf(\"Option --top is similar to the UNIX top command, however it applies only to\\n\");\n\tprintf(\"sandboxes. Listed below are the available fields (columns) in alphabetical\\n\");\n\tprintf(\"order:\\n\\n\");\n\tprintf(\"    Command - command used to start the sandbox.\\n\");\n\tprintf(\"    CPU%% - CPU usage, the sandbox share of the elapsed CPU time since the\\n\");\n\tprintf(\"\\tlast screen update\\n\");\n\tprintf(\"    PID - Unique process ID for the task controlling the sandbox.\\n\");\n\tprintf(\"    Prcs - number of processes running in sandbox, including the controlling\\n\");\n\tprintf(\"\\tprocess.\\n\");\n\tprintf(\"    RES - Resident Memory Size (KiB), sandbox non-swapped physical memory.\\n\");\n\tprintf(\"\\tIt is a sum of the RES values for all processes running in the\\n\");\n\tprintf(\"\\tsandbox.\\n\");\n\tprintf(\"    SHR - Shared Memory Size (KiB), it reflects memory shared with other\\n\");\n\tprintf(\"\\tprocesses. It is a sum of the SHR values for all processes running\\n\");\n\tprintf(\"\\tin the sandbox, including the controlling process.\\n\");\n\tprintf(\"    Uptime - sandbox running time in hours:minutes:seconds format.\\n\");\n\tprintf(\"    User - The owner of the sandbox.\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Profile files\\n\\n\");\n\tprintf(\"Several command line configuration options can be passed to the program using\\n\");\n\tprintf(\"profile files. Default Firejail profile files are stored in /etc/firejail\\n\");\n\tprintf(\"directory, user profile files are stored in ~/.config/firejail directory. See\\n\");\n\tprintf(\"man 5 firejail-profile for more information.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Restricted shell\\n\\n\");\n\tprintf(\"To  configure a restricted shell, replace /bin/bash with /usr/bin/firejail in\\n\");\n\tprintf(\"/etc/passwd file for each user that needs to  be  restricted.\\n\");\n\tprintf(\"Alternatively, you can specify /usr/bin/firejail  in adduser command:\\n\\n\");\n\tprintf(\"   adduser --shell /usr/bin/firejail username\\n\\n\");\n\tprintf(\"Arguments to be passed to firejail executable upon login are  declared  in\\n\");\n\tprintf(\"/etc/firejail/login.users file.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Examples:\\n\\n\");\n\tprintf(\"    $ firejail\\n\");\n\tprintf(\"\\tstart a regular /bin/bash session in sandbox\\n\");\n\tprintf(\"    $ firejail firefox\\n\");\n\tprintf(\"\\tstart Mozilla Firefox\\n\");\n\tprintf(\"    $ firejail --debug firefox\\n\");\n\tprintf(\"\\tdebug Firefox sandbox\\n\");\n\tprintf(\"    $ firejail --private firefox\\n\");\n\tprintf(\"\\tstart Firefox with a new, empty home directory\\n\");\n\tprintf(\"    $ firejail --net=br0 ip=10.10.20.10\\n\");\n\tprintf(\"\\tstart a /bin/bash session in a new network namespace; the session is\\n\");\n\tprintf(\"\\tconnected to the main network using br0 bridge device, an IP address\\n\");\n\tprintf(\"\\tof 10.10.20.10 is assigned to the sandbox\\n\");\n\tprintf(\"    $ firejail --net=br0 --net=br1 --net=br2\\n\");\n\tprintf(\"\\tstart a /bin/bash session in a new network namespace and connect it\\n\");\n\tprintf(\"\\tto br0, br1, and br2 host bridge devices\\n\");\n\tprintf(\"    $ firejail --list\\n\");\n\tprintf(\"\\tlist all running sandboxes\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"License GPL version 2 or later\\n\");\n\tprintf(\"Homepage: http://firejail.wordpress.com\\n\");\n\tprintf(\"\\n\");\n}",
          "includes": [
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n\nvoid usage(void) {\n\tprintf(\"firejail - version %s\\n\\n\", VERSION);\n\tprintf(\"Firejail is a SUID sandbox program that reduces the risk of security breaches by\\n\");\n\tprintf(\"restricting the running environment of untrusted applications using Linux\\n\");\n\tprintf(\"namespaces. It includes a sandbox profile for Mozilla Firefox.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Usage: firejail [options] [program and arguments]\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Without any options, the sandbox consists of a filesystem chroot build from the\\n\");\n\tprintf(\"current system directories  mounted  read-only,  and  new PID and IPC\\n\");\n\tprintf(\"namespaces. If no program is specified as an argument, /bin/bash is started by\\n\");\n\tprintf(\"default in the sandbox.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Options:\\n\\n\");\n\tprintf(\"    -- - signal the end of options and disables further option processing.\\n\\n\");\n\tprintf(\"    --allow-debuggers - allow tools such as strace and gdb inside the sandbox.\\n\\n\");\n\tprintf(\"    --allusers - all user home directories are visible inside the sandbox.\\n\\n\");\n\tprintf(\"    --apparmor - enable AppArmor confinement\\n\\n\");\n\tprintf(\"    --appimage - sandbox an AppImage application\\n\\n\");\n\tprintf(\"    --audit - audit the sandbox, see Audit section for more details\\n\\n\");\n\tprintf(\"    --audit=test-program - audit the sandbox, see Audit section for more details\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --bandwidth=name|pid - set  bandwidth  limits  for  the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID, see Traffic Shaping section fo more details.\\n\\n\");\n#endif\n#ifdef HAVE_BIND\t\t\n\tprintf(\"    --bind=dirname1,dirname2 - mount-bind dirname1 on top of dirname2.\\n\\n\");\n\tprintf(\"    --bind=filename1,filename2 - mount-bind filename1 on top of filename2.\\n\\n\");\n#endif\n\tprintf(\"    --blacklist=dirname_or_filename - blacklist directory or file.\\n\\n\");\n\tprintf(\"    -c - execute command and exit.\\n\\n\");\n\tprintf(\"    --caps - enable default Linux capabilities filter.\\n\\n\");\n\tprintf(\"    --caps.drop=all - drop all capabilities.\\n\\n\");\n\tprintf(\"    --caps.drop=capability,capability - blacklist capabilities filter.\\n\\n\");\n\tprintf(\"    --caps.keep=capability,capability - whitelist capabilities filter.\\n\\n\");\n\tprintf(\"    --caps.print=name|pid - print the caps filter for the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID.\\n\\n\");\n\tprintf(\"    --cgroup=tasks-file - place the sandbox in the specified control group.\\n\");\n\tprintf(\"\\ttasks-file is the full path of cgroup tasks file.\\n\\n\");\n#ifdef HAVE_CHROOT\t\t\n\tprintf(\"    --chroot=dirname - chroot into directory.\\n\\n\");\n#endif\n\tprintf(\"    --cpu=cpu-number,cpu-number - set cpu affinity.\\n\\n\");\n\tprintf(\"    --cpu.print=name|pid - print the cup in use by the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID.\\n\\n\");\n\tprintf(\"    --csh - use /bin/csh as default shell.\\n\\n\");\n\t\n\tprintf(\"    --debug - print sandbox debug messages.\\n\\n\");\n\tprintf(\"    --debug-blacklists - debug blacklisting.\\n\\n\");\n\tprintf(\"    --debug-caps - print all recognized capabilities in the current Firejail\\n\");\n\tprintf(\"\\tsoftware build.\\n\\n\");\n\tprintf(\"    --debug-check-filename - debug filename checking.\\n\\n\");\n\tprintf(\"    --debug-errnos - print all recognized error numbers in the current Firejail\\n\");\n\tprintf(\"\\tsoftware build.\\n\\n\");\n\tprintf(\"    --debug-protocols - print all recognized protocols in the current Firejail\\n\");\n\tprintf(\"\\tsoftware build.\\n\\n\");\n\tprintf(\"    --debug-syscalls - print all recognized system calls in the current Firejail\\n\");\n\tprintf(\"\\tsoftware build.\\n\\n\");\n#ifdef HAVE_WHITELIST\t\n\tprintf(\"    --debug-whitelists - debug whitelisting.\\n\\n\");\n#endif\n\n\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --defaultgw=address - use this address as default gateway in the new network\\n\");\n\tprintf(\"\\tnamespace.\\n\\n\");\n#endif\n\tprintf(\"    --dns=address - set a DNS server for the sandbox. Up to three DNS servers\\n\");\n\tprintf(\"\\tcan be defined.\\n\\n\");\n\tprintf(\"    --dns.print=name|pid - print DNS configuration for the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID.\\n\\n\");\n\t\n\tprintf(\"    --env=name=value - set environment variable in the new sandbox.\\n\\n\");\n\tprintf(\"    --fs.print=name|pid - print the filesystem log for the sandbox identified\\n\");\n\tprintf(\"\\tby name or PID.\\n\\n\");\n\tprintf(\"    --get=name|pid filename - get a file from sandbox container.\\n\\n\");\n\tprintf(\"    --help, -? - this help screen.\\n\\n\");\n\tprintf(\"    --hostname=name - set sandbox hostname.\\n\\n\");\n\tprintf(\"    --ignore=command - ignore command in profile files.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --interface=name - move interface in a new network namespace. Up to four\\n\");\n\tprintf(\"\\t--interface options can be specified.\\n\\n\");\n\tprintf(\"    --ip=address - set interface IP address.\\n\\n\");\n\tprintf(\"    --ip=none - no IP address and no default gateway address are configured\\n\");\n\tprintf(\"\\tin the new network namespace. Use this option in case you intend to\\n\");\n\tprintf(\"\\tstart an external DHCP client in the sandbox.\\n\\n\");\n\tprintf(\"    --ip6=address - set interface IPv6 address.\\n\\n\");\n\tprintf(\"    --iprange=address,address - configure an IP address in this range.\\n\\n\");\n#endif\n\tprintf(\"    --ipc-namespace - enable a new IPC namespace if the sandbox was started as\\n\");\n\tprintf(\"\\tregular user. IPC namespace is enabled by default only if the sandbox\\n\");\n\tprintf(\"\\tis started as root.\\n\\n\");\n\tprintf(\"    --join=name|pid - join the sandbox identified by name or PID.\\n\\n\");\n\tprintf(\"    --join-filesystem=name|pid - join the mount namespace of the sandbox\\n\");\n\tprintf(\"\\tidentified by name or PID.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --join-network=name|pid - join the network namespace of the sandbox\\n\");\n\tprintf(\"\\tidentified by name or PID.\\n\\n\");\n#endif\n\tprintf(\"    --list - list all sandboxes.\\n\\n\");\n\tprintf(\"    --ls=name|pid dir_or_filename - list files in sandbox container.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --mac=xx:xx:xx:xx:xx:xx - set interface MAC address.\\n\\n\");\n\tprintf(\"    --mtu=number - set interface MTU.\\n\\n\");\n#endif\n\tprintf(\"    --name=name - set sandbox name.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --net=bridgename - enable network namespaces and connect to this bridge\\n\");\n\tprintf(\"\\tdevice. Up to four --net devices can be defined.\\n\\n\");\n\n\tprintf(\"    --net=ethernet_interface - enable network namespaces and connect to this\\n\");\n\tprintf(\"\\tEthernet interface using the standard Linux macvlan driver. Up to four\\n\");\n\tprintf(\"\\t--net devices can be defined.\\n\\n\");\n\t\n\tprintf(\"    --net=none - enable a new, unconnected network namespace.\\n\\n\");\n\n\tprintf(\"    --netfilter - enable the default client network filter in the new\\n\");\n\tprintf(\"\\tnetwork namespace.\\n\\n\");\n\tprintf(\"    --netfilter=filename - enable the network filter specified by\\n\");\n\tprintf(\"\\tfilename in the new network namespace. The filter file format\\n\");\n\tprintf(\"\\tis the format of iptables-save and iptable-restore commands.\\n\\n\");\n\tprintf(\"    --netfilter6=filename - enable the IPv6 network filter specified by\\n\");\n\tprintf(\"\\tfilename in the new network namespace. The filter file format\\n\");\n\tprintf(\"\\tis the format of ip6tables-save and ip6table-restore commands.\\n\\n\");\n\n\tprintf(\"    --netstats - monitor network statistics for sandboxes creating a new\\n\");\n\tprintf(\"\\tnetwork namespace.\\n\\n\");\n#endif\n\tprintf(\"    --nice=value - set nice value.\\n\\n\");\n\tprintf(\"    --no3d - disable 3D hardware acceleration.\\n\\n\");\n\tprintf(\"    --noblacklist=dirname_or_filename - disable blacklist for directory or\\n\");\n\tprintf(\"\\tfile.\\n\\n\");\n\tprintf(\"    --noexec=dirname_of_filenam - remount the file or directory noexec\\n\");\n\tprintf(\"\\tnosuid and nodev\\n\\n\");\n\tprintf(\"    --nogroups - disable supplementary groups. Without this option,\\n\");\n\tprintf(\"\\tsupplementary groups are enabled for the user starting the sandbox.\\n\");\n\tprintf(\"\\tFor root, groups are always disabled.\\n\\n\");\n\n\tprintf(\"    --noprofile - do not use a profile.  Profile priority is use the one\\n\");\n\tprintf(\"\\tspecified on the command line, next try to find one that\\n\");\n\tprintf(\"\\tmatches the command name, and lastly use %s.profile\\n\", DEFAULT_USER_PROFILE);\n\tprintf(\"\\tif running as regular user or %s.profile if running as\\n\", DEFAULT_ROOT_PROFILE);\n\tprintf(\"\\troot.\\n\\n\");\n#ifdef HAVE_USERNS\t\t \t\n\tprintf(\"    --noroot - install a user namespace with a single user - the current\\n\");\n\tprintf(\"\\tuser. root user does not exist in the new namespace. This option\\n\");\n\tprintf(\"\\tis not supported for --chroot and --overlay configurations.\\n\\n\");\n#endif\n\tprintf(\"    --nonewprivs - sets the NO_NEW_PRIVS prctl - the child processes\\n\");\n\tprintf(\"\\tcannot gain privileges using execve(2); in particular, this prevents\\n\");\n\tprintf(\"\\tgaining privileges by calling a suid binary\\n\\n\");\n\tprintf(\"    --nosound - disable sound system.\\n\\n\");\n\t\t\n\tprintf(\"    --output=logfile - stdout logging and log rotation. Copy stdout and stderr\\n\");\n\tprintf(\"\\tto logfile, and keep the size of the file under 500KB using log\\n\");\n\tprintf(\"\\trotation. Five files with prefixes .1 to .5 are used in\\n\");\n\tprintf(\"\\trotation.\\n\\n\");\n\t\n\tprintf(\"    --overlay - mount a filesystem overlay on top of the current filesystem.\\n\");\n\tprintf(\"\\tThe upper filesystem layer is persistent, and stored in\\n\");\n\tprintf(\"\\t$HOME/.firejail/<PID> directory. (OverlayFS support is required in\\n\");\n\tprintf(\"\\tLinux kernel for this option to work). \\n\\n\");\n\n\tprintf(\"    --overlay-named=name - mount a filesystem overlay on top of the current\\n\");\n\tprintf(\"\\tfilesystem. The upper filesystem layer is persistent, and stored in\\n\");\n\tprintf(\"\\t$HOME/.firejail/<NAME> directory. (OverlayFS support is required in\\n\");\n\tprintf(\"\\tLinux kernel for this option to work). \\n\\n\");\n\n\tprintf(\"    --overlay-tmpfs - mount a filesystem overlay on top of the current\\n\");\n\tprintf(\"\\tfilesystem. The upper layer is stored in a tmpfs filesystem,\\n\");\n\tprintf(\"\\tand it is discarded when the sandbox is closed. (OverlayFS\\n\");\n\tprintf(\"\\tsupport is required in Linux kernel for this option to work).\\n\\n\");   \n\t\n\tprintf(\"    --overlay-clean - clean all overlays stored in $HOME/.firejail directory.\\n\\n\");\n\n\tprintf(\"    --private - mount new /root and /home/user directories in temporary\\n\");\n\tprintf(\"\\tfilesystems. All modifications are discarded when the sandbox is\\n\");\n\tprintf(\"\\tclosed.\\n\\n\");\n\tprintf(\"    --private=directory - use directory as user home.\\n\\n\");\n\tprintf(\"    --private-home=file,directory - build a new user home in a temporary\\n\");\n\tprintf(\"\\t\\tfilesystem, and copy the files and directories in the list in\\n\");\n\tprintf(\"\\t\\tthe new home. All modifications are discarded when the sandbox\\n\");\n\tprintf(\"\\t\\tis closed.\\n\\n\");\n\n\tprintf(\"    --private-bin=file,file - build a new /bin in a temporary filesystem,\\n\");\n\tprintf(\"\\tand copy the programs in the list.\\n\\n\");\n\n\tprintf(\"    --private-dev - create a new /dev directory. Only dri, null, full, zero,\\n\");\n\tprintf(\"\\ttty, pst, ptms, random, snd, urandom, log and shm devices are available.\\n\\n\");\n\n\tprintf(\"    --private-etc=file,directory - build a new /etc in a temporary\\n\");\n\tprintf(\"\\tfilesystem, and copy the files and directories in the list.\\n\");\n\tprintf(\"\\tAll modifications are discarded when the sandbox is closed.\\n\\n\");\n\t\n\tprintf(\"    --private-tmp - mount a tmpfs on top of /tmp directory\\n\\n\");\n\t\n\tprintf(\"    --profile=filename - use a custom profile.\\n\\n\");\n\tprintf(\"    --profile-path=directory - use this directory to look for profile files.\\n\\n\");\n\t\n\tprintf(\"    --protocol=protocol,protocol,protocol - enable protocol filter.\\n\");\n\tprintf(\"\\tProtocol values: unix, inet, inet6, netlink, packet.\\n\\n\");\n\tprintf(\"    --protocol.print=name|pid - print the protocol filter for the sandbox\\n\");\n\tprintf(\"\\tidentified by name or PID.\\n\\n\");\n\t\n\tprintf(\"    --put=name|pid src-filename dest-filename - put a file in sandbox container.\\n\\n\");\n\t\n\tprintf(\"    --quiet - turn off Firejail's output.\\n\\n\");\n\tprintf(\"    --read-only=dirname_or_filename - set directory or file read-only..\\n\\n\");\n\tprintf(\"    --read-write=dirname_or_filename - set directory or file read-write..\\n\\n\");\n\tprintf(\"    --rlimit-fsize=number - set the maximum file size that can be created\\n\");\n\tprintf(\"\\tby a process.\\n\\n\");\n\tprintf(\"    --rlimit-nofile=number - set the maximum number of files that can be\\n\");\n\tprintf(\"\\topened by a process.\\n\\n\");\n\tprintf(\"    --rlimit-nproc=number - set the maximum number of processes that can be\\n\");\n\tprintf(\"\\tcreated for the real user ID of the calling process.\\n\\n\");\n\tprintf(\"    --rlimit-sigpending=number - set the maximum number of pending signals\\n\");\n\tprintf(\"\\tfor a process.\\n\\n\");\n\tprintf(\"    --rmenv=name - remove environment variable in the new sandbox.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --scan - ARP-scan all the networks from inside a network namespace.\\n\");\n\tprintf(\"\\tThis makes it possible to detect macvlan kernel device drivers\\n\");\n\tprintf(\"\\trunning on the current host.\\n\\n\");\n#endif\t\n#ifdef HAVE_SECCOMP\n\tprintf(\"    --seccomp - enable seccomp filter and apply the default blacklist.\\n\\n\");\n\t\n\tprintf(\"    --seccomp=syscall,syscall,syscall - enable seccomp filter, blacklist the\\n\");\n\tprintf(\"\\tdefault syscall list and the syscalls specified by the command.\\n\\n\");\n\t\n\tprintf(\"    --seccomp.drop=syscall,syscall,syscall - enable seccomp filter, and\\n\");\n\tprintf(\"\\tblacklist the syscalls specified by the command.\\n\\n\");\n\t\n\tprintf(\"    --seccomp.keep=syscall,syscall,syscall - enable seccomp filter, and\\n\");\n\tprintf(\"\\twhitelist the syscalls specified by the command.\\n\\n\");\n\t\n\tprintf(\"    --seccomp.<errno>=syscall,syscall,syscall - enable seccomp filter, and\\n\");\n\tprintf(\"\\treturn errno for the syscalls specified by the command.\\n\\n\");\n\t\n\tprintf(\"    --seccomp.print=name|pid - print the seccomp filter for the sandbox\\n\");\n\tprintf(\"\\tidentified by name or PID.\\n\\n\");\n#endif\n\n\tprintf(\"    --shell=none - run the program directly without a user shell.\\n\\n\");\n\tprintf(\"    --shell=program - set default user shell.\\n\\n\");\n\tprintf(\"    --shutdown=name|pid - shutdown the sandbox identified by name or PID.\\n\\n\");\n\tprintf(\"    --tmpfs=dirname - mount a tmpfs filesystem on directory dirname.\\n\");\n\tprintf(\"\\tThis option is available only when running the sandbox as root.\\n\\n\");\n\tprintf(\"    --top - monitor the most CPU-intensive sandboxes.\\n\\n\");\n\tprintf(\"    --trace - trace open, access and connect system calls.\\n\\n\");\n\tprintf(\"    --tracelog - add a syslog message for every access to files or\\n\");\n\tprintf(\"\\tdirectoires blacklisted by the security profile.\\n\\n\");\n\tprintf(\"    --tree - print a tree of all sandboxed processes.\\n\\n\");\n\tprintf(\"    --version - print program version and exit.\\n\\n\");\n#ifdef HAVE_NETWORK\t\n\tprintf(\"    --veth-name=name - use this name for the interface connected to the bridge\\n\");\n\tprintf(\"\\tfor --net=bridgename commands, instead of the default one.\\n\\n\"); \n#endif\t\n#ifdef HAVE_WHITELIST\t\n\tprintf(\"    --whitelist=dirname_or_filename - whitelist directory or file.\\n\\n\");\n#endif\t\n\tprintf(\"    --writable-etc - /etc directory is mounted read-write.\\n\\n\");\n\tprintf(\"    --writable-var - /var directory is mounted read-write.\\n\\n\");\n\t\n\tprintf(\"    --x11 - enable X11 sandboxing. The software checks first if Xpra is\\n\");\n\tprintf(\"\\tinstalled, then it checks if Xephyr is installed. If all fails, it will\\n\");\n\tprintf(\"\\tattempt to use X11 security extension.\\n\\n\");\n\tprintf(\"    --x11=none - disable access to X11 sockets.\\n\\n\");\n\tprintf(\"    --x11=xephyr - enable Xephyr X11 server. The window size is 800x600.\\n\\n\");\n\tprintf(\"    --x11=xorg - enable X11 security extension.\\n\\n\");\n\tprintf(\"    --x11=xpra - enable Xpra X11 server.\\n\\n\");\n\tprintf(\"    --zsh - use /usr/bin/zsh as default shell.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"\\n\");\n\n\n#ifdef HAVE_NETWORK\t\n\tprintf(\"Traffic Shaping\\n\\n\");\n\t\n\tprintf(\"Network bandwidth is an expensive resource shared among  all  sandboxes\\n\");\n\tprintf(\"running  on a system.  Traffic shaping allows the user to increase network\\n\");\n\tprintf(\"performance by controlling the amount of data that flows into and out of the\\n\");\n\tprintf(\"sandboxes. Firejail  implements  a simple rate-limiting shaper based on Linux\\n\");\n\tprintf(\"command tc. The shaper works at sandbox level, and can be used  only  for\\n\");\n\tprintf(\"sandboxes configured with new network namespaces.\\n\\n\");\n\n\tprintf(\"Set rate-limits:\\n\");\n\tprintf(\"    firejail  --bandwidth={name|pid} set network-name down-speed up-speed\\n\\n\");\n\tprintf(\"Clear rate-limits:\\n\");\n\tprintf(\"    firejail --bandwidth={name|pid} clear network-name\\n\\n\");\n\tprintf(\"Status:\\n\");\n\tprintf(\"    firejail --bandwidth={name|pid} status\\n\\n\");\n\tprintf(\"where:\\n\");\n            printf(\"    name - sandbox name\\n\");\n            printf(\"    pid - sandbox pid\\n\");\n            printf(\"    network-name - network name as used by --net option\\n\");\n            printf(\"    down-speed - download speed in KB/s (decimal kilobyte per second)\\n\");\n            printf(\"    up-speed - upload speed in KB/s (decimal kilobyte per second)\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Example:\\n\");\n            printf(\"    $ firejail --name=mybrowser --net=eth0 firefox &\\n\");\n            printf(\"    $ firejail --bandwidth=mybrowser set eth0 80 20\\n\");\n            printf(\"    $ firejail --bandwidth=mybrowser status\\n\");\n            printf(\"    $ firejail --bandwidth=mybrowser clear eth0\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"\\n\");\n#endif\n\n\tprintf(\"Audit\\n\\n\");\n\tprintf(\"Audit feature allows the user to point out gaps in security profiles. The\\n\");\n\tprintf(\"implementation replaces the program to be sandboxed with a test program. By\\n\");\n\tprintf(\"default, we use faudit program distributed with Firejail. A custom test program\\n\");\n\tprintf(\"can also be supplied by the user. Examples:\\n\\n\");\n\tprintf(\"Running the default audit program:\\n\");\n\tprintf(\"    $ firejail --audit transmission-gtk\\n\\n\");\n\tprintf(\"Running a custom audit program:\\n\");\n\tprintf(\"    $ firejail --audit=~/sandbox-test transmission-gtk\\n\\n\");\n\tprintf(\"In the examples above, the sandbox configures transmission-gtk profile and\\n\");\n\tprintf(\"starts the test program. The real program, transmission-gtk, will not be\\n\");\n\tprintf(\"started.\\n\\n\\n\");\n\t\n\tprintf(\"Monitoring\\n\\n\");\n\n\tprintf(\"Option --list prints a list of all sandboxes. The format for each entry is as\\n\");\n\tprintf(\"follows:\\n\\n\");\n\tprintf(\"    PID:USER:Command\\n\\n\");\n\n\tprintf(\"Option --tree prints the tree of processes running in the sandbox. The format\\n\");\n\tprintf(\"for each process entry is as follows:\\n\\n\");\n\tprintf(\"    PID:USER:Command\\n\\n\");\n\n\tprintf(\"Option --top is similar to the UNIX top command, however it applies only to\\n\");\n\tprintf(\"sandboxes. Listed below are the available fields (columns) in alphabetical\\n\");\n\tprintf(\"order:\\n\\n\");\n\tprintf(\"    Command - command used to start the sandbox.\\n\");\n\tprintf(\"    CPU%% - CPU usage, the sandbox share of the elapsed CPU time since the\\n\");\n\tprintf(\"\\tlast screen update\\n\");\n\tprintf(\"    PID - Unique process ID for the task controlling the sandbox.\\n\");\n\tprintf(\"    Prcs - number of processes running in sandbox, including the controlling\\n\");\n\tprintf(\"\\tprocess.\\n\");\n\tprintf(\"    RES - Resident Memory Size (KiB), sandbox non-swapped physical memory.\\n\");\n\tprintf(\"\\tIt is a sum of the RES values for all processes running in the\\n\");\n\tprintf(\"\\tsandbox.\\n\");\n\tprintf(\"    SHR - Shared Memory Size (KiB), it reflects memory shared with other\\n\");\n\tprintf(\"\\tprocesses. It is a sum of the SHR values for all processes running\\n\");\n\tprintf(\"\\tin the sandbox, including the controlling process.\\n\");\n\tprintf(\"    Uptime - sandbox running time in hours:minutes:seconds format.\\n\");\n\tprintf(\"    User - The owner of the sandbox.\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Profile files\\n\\n\");\n\tprintf(\"Several command line configuration options can be passed to the program using\\n\");\n\tprintf(\"profile files. Default Firejail profile files are stored in /etc/firejail\\n\");\n\tprintf(\"directory, user profile files are stored in ~/.config/firejail directory. See\\n\");\n\tprintf(\"man 5 firejail-profile for more information.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Restricted shell\\n\\n\");\n\tprintf(\"To  configure a restricted shell, replace /bin/bash with /usr/bin/firejail in\\n\");\n\tprintf(\"/etc/passwd file for each user that needs to  be  restricted.\\n\");\n\tprintf(\"Alternatively, you can specify /usr/bin/firejail  in adduser command:\\n\\n\");\n\tprintf(\"   adduser --shell /usr/bin/firejail username\\n\\n\");\n\tprintf(\"Arguments to be passed to firejail executable upon login are  declared  in\\n\");\n\tprintf(\"/etc/firejail/login.users file.\\n\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"Examples:\\n\\n\");\n\tprintf(\"    $ firejail\\n\");\n\tprintf(\"\\tstart a regular /bin/bash session in sandbox\\n\");\n\tprintf(\"    $ firejail firefox\\n\");\n\tprintf(\"\\tstart Mozilla Firefox\\n\");\n\tprintf(\"    $ firejail --debug firefox\\n\");\n\tprintf(\"\\tdebug Firefox sandbox\\n\");\n\tprintf(\"    $ firejail --private firefox\\n\");\n\tprintf(\"\\tstart Firefox with a new, empty home directory\\n\");\n\tprintf(\"    $ firejail --net=br0 ip=10.10.20.10\\n\");\n\tprintf(\"\\tstart a /bin/bash session in a new network namespace; the session is\\n\");\n\tprintf(\"\\tconnected to the main network using br0 bridge device, an IP address\\n\");\n\tprintf(\"\\tof 10.10.20.10 is assigned to the sandbox\\n\");\n\tprintf(\"    $ firejail --net=br0 --net=br1 --net=br2\\n\");\n\tprintf(\"\\tstart a /bin/bash session in a new network namespace and connect it\\n\");\n\tprintf(\"\\tto br0, br1, and br2 host bridge devices\\n\");\n\tprintf(\"    $ firejail --list\\n\");\n\tprintf(\"\\tlist all running sandboxes\\n\");\n\tprintf(\"\\n\");\n\tprintf(\"License GPL version 2 or later\\n\");\n\tprintf(\"Homepage: http://firejail.wordpress.com\\n\");\n\tprintf(\"\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"-?\""
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcmp",
          "args": [
            "argv[i]",
            "\"--help\""
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nConfig cfg;\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nstatic void run_cmd_and_exit(int i, int argc, char **argv) {\n\tEUID_ASSERT();\n\t\n\t//*************************************\n\t// basic arguments\n\t//*************************************\n\tif (strcmp(argv[i], \"--help\") == 0 ||\n\t    strcmp(argv[i], \"-?\") == 0) {\n\t\tusage();\n\t\texit(0);\n\t}\n\telse if (strcmp(argv[i], \"--version\") == 0) {\n\t\tprintf(\"firejail version %s\\n\", VERSION);\n\t\tprintf(\"\\n\");\n\t\tprint_compiletime_support();\n\t\tprintf(\"\\n\");\n\t\texit(0);\n\t}\n#ifdef HAVE_OVERLAYFS\n\telse if (strcmp(argv[i], \"--overlay-clean\") == 0) {\n\t\tif (checkcfg(CFG_OVERLAYFS)) {\n\t\t\tchar *path;\n\t\t\tif (asprintf(&path, \"%s/.firejail\", cfg.homedir) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tEUID_ROOT();\n\t\t\tif (setreuid(0, 0) < 0)\n\t\t\t\terrExit(\"setreuid\");\n\t\t\tif (setregid(0, 0) < 0)\n\t\t\t\terrExit(\"setregid\");\n\t\t\terrno = 0;\n\t\t\tint rv = remove_directory(path);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Error: cannot removed overlays stored in ~/.firejail directory, errno %d\\n\", errno);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tfprintf(stderr, \"Error: overlayfs feature is disabled in Firejail configuration file\\n\");\n\t\t\texit(1);\n\t\t}\n\t\texit(0);\n\t}\n#endif\n#ifdef HAVE_X11\n\telse if (strcmp(argv[i], \"--x11\") == 0) {\n\t\tif (checkcfg(CFG_X11)) {\n\t\t\tx11_start(argc, argv);\n\t\t\texit(0);\n\t\t}\n\t\telse {\n\t\t\tfprintf(stderr, \"Error: --x11 feature is disabled in Firejail configuration file\\n\");\n\t\t\texit(1);\n\t\t}\n\t}"
  },
  {
    "function_name": "check_user_namespace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "234-254",
    "snippet": "void check_user_namespace(void) {\n\tEUID_ASSERT();\n\tif (getuid() == 0) {\n\t\tfprintf(stderr, \"Error: --noroot option cannot be used when starting the sandbox as root.\\n\");\n\t\texit(1);\n\t}\n\t\n\t// test user namespaces available in the kernel\n\tstruct stat s1;\n\tstruct stat s2;\n\tstruct stat s3;\n\tif (stat(\"/proc/self/ns/user\", &s1) == 0 &&\n\t    stat(\"/proc/self/uid_map\", &s2) == 0 &&\n\t    stat(\"/proc/self/gid_map\", &s3) == 0)\n\t\targ_noroot = 1;\n\telse {\n\t\tif (!arg_quiet || arg_debug)\n\t\t\tfprintf(stderr, \"Warning: user namespaces not available in the current kernel.\\n\");\n\t\targ_noroot = 0;\n\t}\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int arg_debug = 0;",
      "int arg_noroot = 0;",
      "int arg_quiet = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Warning: user namespaces not available in the current kernel.\\n\""
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "\"/proc/self/gid_map\"",
            "&s3"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "\"/proc/self/uid_map\"",
            "&s2"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "\"/proc/self/ns/user\"",
            "&s1"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: --noroot option cannot be used when starting the sandbox as root.\\n\""
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_debug = 0;\nint arg_noroot = 0;\nint arg_quiet = 0;\n\nvoid check_user_namespace(void) {\n\tEUID_ASSERT();\n\tif (getuid() == 0) {\n\t\tfprintf(stderr, \"Error: --noroot option cannot be used when starting the sandbox as root.\\n\");\n\t\texit(1);\n\t}\n\t\n\t// test user namespaces available in the kernel\n\tstruct stat s1;\n\tstruct stat s2;\n\tstruct stat s3;\n\tif (stat(\"/proc/self/ns/user\", &s1) == 0 &&\n\t    stat(\"/proc/self/uid_map\", &s2) == 0 &&\n\t    stat(\"/proc/self/gid_map\", &s3) == 0)\n\t\targ_noroot = 1;\n\telse {\n\t\tif (!arg_quiet || arg_debug)\n\t\t\tfprintf(stderr, \"Warning: user namespaces not available in the current kernel.\\n\");\n\t\targ_noroot = 0;\n\t}\n}"
  },
  {
    "function_name": "check_network",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "220-231",
    "snippet": "static void check_network(Bridge *br) {\n\tassert(br);\n\tif (br->macvlan == 0) // for bridge devices check network range or arp-scan and assign address\n\t\tnet_configure_sandbox_ip(br);\n\telse if (br->ipsandbox) { // for macvlan check network range\n\t\tchar *rv = in_netrange(br->ipsandbox, br->ip, br->mask);\n\t\tif (rv) {\n\t\t\tfprintf(stderr, \"%s\", rv);\n\t\t\texit(1);\n\t\t}\n\t}\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 228
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s\"",
            "rv"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "in_netrange",
          "args": [
            "br->ipsandbox",
            "br->ip",
            "br->mask"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "net_configure_sandbox_ip",
          "args": [
            "br"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "net_configure_sandbox_ip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/network_main.c",
          "lines": "85-108",
          "snippet": "void net_configure_sandbox_ip(Bridge *br) {\n\tassert(br);\n\tif (br->configured == 0)\n\t\treturn;\n\n\tif (br->arg_ip_none)\n\t\tbr->ipsandbox = 0;\n\telse if (br->ipsandbox) {\n\t\t// check network range\n\t\tchar *rv = in_netrange(br->ipsandbox, br->ip, br->mask);\n\t\tif (rv) {\n\t\t\tfprintf(stderr, \"%s\", rv);\n\t\t\texit(1);\n\t\t}\n\t\t// send an ARP request and check if there is anybody on this IP address\n\t\tif (arp_check(br->dev, br->ipsandbox, br->ip)) {\n\t\t\tfprintf(stderr, \"Error: IP address %d.%d.%d.%d is already in use\\n\", PRINT_IP(br->ipsandbox));\n\t\t\texit(1);\n\t\t}\n\t}\n\telse\n\t\t// ip address assigned by arp-scan for a bridge device\n\t\tbr->ipsandbox = arp_assign(br->dev, br); //br->ip, br->mask);\n}",
          "includes": [
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid net_configure_sandbox_ip(Bridge *br) {\n\tassert(br);\n\tif (br->configured == 0)\n\t\treturn;\n\n\tif (br->arg_ip_none)\n\t\tbr->ipsandbox = 0;\n\telse if (br->ipsandbox) {\n\t\t// check network range\n\t\tchar *rv = in_netrange(br->ipsandbox, br->ip, br->mask);\n\t\tif (rv) {\n\t\t\tfprintf(stderr, \"%s\", rv);\n\t\t\texit(1);\n\t\t}\n\t\t// send an ARP request and check if there is anybody on this IP address\n\t\tif (arp_check(br->dev, br->ipsandbox, br->ip)) {\n\t\t\tfprintf(stderr, \"Error: IP address %d.%d.%d.%d is already in use\\n\", PRINT_IP(br->ipsandbox));\n\t\t\texit(1);\n\t\t}\n\t}\n\telse\n\t\t// ip address assigned by arp-scan for a bridge device\n\t\tbr->ipsandbox = arp_assign(br->dev, br); //br->ip, br->mask);\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "br"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void check_network(Bridge *br) {\n\tassert(br);\n\tif (br->macvlan == 0) // for bridge devices check network range or arp-scan and assign address\n\t\tnet_configure_sandbox_ip(br);\n\telse if (br->ipsandbox) { // for macvlan check network range\n\t\tchar *rv = in_netrange(br->ipsandbox, br->ip, br->mask);\n\t\tif (rv) {\n\t\t\tfprintf(stderr, \"%s\", rv);\n\t\t\texit(1);\n\t\t}\n\t}\n}"
  },
  {
    "function_name": "init_cfg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "180-218",
    "snippet": "static void init_cfg(int argc, char **argv) {\n\tEUID_ASSERT();\n\tmemset(&cfg, 0, sizeof(cfg));\n\n\tcfg.original_argv = argv;\n\tcfg.original_argc = argc;\n\tcfg.bridge0.devsandbox = \"eth0\";\n\tcfg.bridge1.devsandbox = \"eth1\";\n\tcfg.bridge2.devsandbox = \"eth2\";\n\tcfg.bridge3.devsandbox = \"eth3\";\n\t\n\t// extract user data\n\tEUID_ROOT(); // rise permissions for grsecurity\n\tstruct passwd *pw = getpwuid(getuid());\n\tif (!pw)\n\t\terrExit(\"getpwuid\");\n\tEUID_USER();\n\tcfg.username = strdup(pw->pw_name);\n\tif (!cfg.username)\n\t\terrExit(\"strdup\");\n\n\t// build home directory name\n\tcfg.homedir = NULL;\n\tif (pw->pw_dir != NULL) {\n\t\tcfg.homedir = strdup(pw->pw_dir);\n\t\tif (!cfg.homedir)\n\t\t\terrExit(\"strdup\");\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: user %s doesn't have a user directory assigned\\n\", cfg.username);\n\t\texit(1);\n\t}\n\tcfg.cwd = getcwd(NULL, 0);\n\n\t// initialize random number generator\n\tsandbox_pid = getpid();\n\ttime_t t = time(NULL);\n\tsrand(t ^ sandbox_pid);\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "Config cfg;",
      "pid_t sandbox_pid;",
      "else if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11))",
      "else if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);",
      "else if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;",
      "else if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "srand",
          "args": [
            "t ^ sandbox_pid"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "NULL"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getcwd",
          "args": [
            "NULL",
            "0"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error: user %s doesn't have a user directory assigned\\n\"",
            "cfg.username"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "pw->pw_dir"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"strdup\""
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "pw->pw_name"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_USER",
          "args": [],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"getpwuid\""
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpwuid",
          "args": [
            "getuid()"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getuid",
          "args": [],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&cfg",
            "0",
            "sizeof(cfg)"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nConfig cfg;\npid_t sandbox_pid;\nelse if (strcmp(argv[i], \"--x11=xpra\") == 0) {\n\t\tif (checkcfg(CFG_X11));\nelse if (strncmp(argv[i], \"--join=\", 7) == 0) {\n\t\tlogargs(argc, argv);\nelse if (strncmp(argv[i], \"--tmpfs=\", 8) == 0) {\n\t\t\tchar *line;\nelse if (strncmp(argv[i], \"--dns=\", 6) == 0) {\n\t\t\tuint32_t dns;\n\nstatic void init_cfg(int argc, char **argv) {\n\tEUID_ASSERT();\n\tmemset(&cfg, 0, sizeof(cfg));\n\n\tcfg.original_argv = argv;\n\tcfg.original_argc = argc;\n\tcfg.bridge0.devsandbox = \"eth0\";\n\tcfg.bridge1.devsandbox = \"eth1\";\n\tcfg.bridge2.devsandbox = \"eth2\";\n\tcfg.bridge3.devsandbox = \"eth3\";\n\t\n\t// extract user data\n\tEUID_ROOT(); // rise permissions for grsecurity\n\tstruct passwd *pw = getpwuid(getuid());\n\tif (!pw)\n\t\terrExit(\"getpwuid\");\n\tEUID_USER();\n\tcfg.username = strdup(pw->pw_name);\n\tif (!cfg.username)\n\t\terrExit(\"strdup\");\n\n\t// build home directory name\n\tcfg.homedir = NULL;\n\tif (pw->pw_dir != NULL) {\n\t\tcfg.homedir = strdup(pw->pw_dir);\n\t\tif (!cfg.homedir)\n\t\t\terrExit(\"strdup\");\n\t}\n\telse {\n\t\tfprintf(stderr, \"Error: user %s doesn't have a user directory assigned\\n\", cfg.username);\n\t\texit(1);\n\t}\n\tcfg.cwd = getcwd(NULL, 0);\n\n\t// initialize random number generator\n\tsandbox_pid = getpid();\n\ttime_t t = time(NULL);\n\tsrand(t ^ sandbox_pid);\n}"
  },
  {
    "function_name": "read_pid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "163-177",
    "snippet": "static inline int read_pid(char *str, pid_t *pid) {\n\tchar *endptr;\n\terrno = 0;\n\tlong int pidtmp = strtol(str, &endptr, 10);\n\tif ((errno == ERANGE && (pidtmp == LONG_MAX || pidtmp == LONG_MIN))\n\t\t|| (errno != 0 && pidtmp == 0)) {\n\t\treturn 1;\n\t}\n\t// endptr points to '\\0' char in str if the entire string is valid\n\tif (endptr == NULL || endptr[0]!='\\0') {\n\t\treturn 1;\n\t}\n\t*pid = (pid_t)pidtmp;\n\treturn 0;\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void set_name_file(pid_t pid);",
      "static void delete_name_file(pid_t pid);",
      "static void delete_x11_file(pid_t pid);",
      "pid_t pid;",
      "pid_t pid;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strtol",
          "args": [
            "str",
            "&endptr",
            "10"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nstatic inline int read_pid(char *str, pid_t *pid) {\n\tchar *endptr;\n\terrno = 0;\n\tlong int pidtmp = strtol(str, &endptr, 10);\n\tif ((errno == ERANGE && (pidtmp == LONG_MAX || pidtmp == LONG_MIN))\n\t\t|| (errno != 0 && pidtmp == 0)) {\n\t\treturn 1;\n\t}\n\t// endptr points to '\\0' char in str if the entire string is valid\n\tif (endptr == NULL || endptr[0]!='\\0') {\n\t\treturn 1;\n\t}\n\t*pid = (pid_t)pidtmp;\n\treturn 0;\n}"
  },
  {
    "function_name": "my_handler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "151-160",
    "snippet": "static void my_handler(int s){\n\tEUID_ROOT();\n\tif (!arg_quiet) {\n\t\tprintf(\"\\nParent received signal %d, shutting down the child process...\\n\", s);\n\t\tfflush(0);\n\t}\n\tlogsignal(s);\n\tkill(child, SIGTERM);\n\tmyexit(1);\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int arg_quiet = 0;",
      "static pid_t child = 0;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "myexit",
          "args": [
            "1"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int arg_command = 0;",
            "int arg_quiet = 0;",
            "pid_t sandbox_pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
        }
      },
      {
        "call_info": {
          "callee": "kill",
          "args": [
            "child",
            "SIGTERM"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logsignal",
          "args": [
            "s"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "logsignal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "121-128",
          "snippet": "void logsignal(int s) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"Signal %d caught\", s);\n\tcloselog();\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid logsignal(int s) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"Signal %d caught\", s);\n\tcloselog();\n}"
        }
      },
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "0"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\nParent received signal %d, shutting down the child process...\\n\"",
            "s"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_quiet = 0;\nstatic pid_t child = 0;\n\nstatic void my_handler(int s){\n\tEUID_ROOT();\n\tif (!arg_quiet) {\n\t\tprintf(\"\\nParent received signal %d, shutting down the child process...\\n\", s);\n\t\tfflush(0);\n\t}\n\tlogsignal(s);\n\tkill(child, SIGTERM);\n\tmyexit(1);\n}"
  },
  {
    "function_name": "myexit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "137-149",
    "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int arg_command = 0;",
      "int arg_quiet = 0;",
      "pid_t sandbox_pid;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "rv"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "myexit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "137-149",
          "snippet": "static void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "flush_stdin",
          "args": [],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "flush_stdin",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "721-731",
          "snippet": "void flush_stdin(void) {\n\tif (isatty(STDIN_FILENO)) {\n\t\tint cnt = 0;\n\t\tioctl(STDIN_FILENO, FIONREAD, &cnt);\n\t\tif (cnt) {\n\t\t\tif (!arg_quiet)\n\t\t\t\tprintf(\"Warning: removing %d bytes from stdin\\n\", cnt);\n\t\t\tioctl(STDIN_FILENO, TCFLSH, TCIFLUSH);\n\t\t}\n\t}\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid flush_stdin(void) {\n\tif (isatty(STDIN_FILENO)) {\n\t\tint cnt = 0;\n\t\tioctl(STDIN_FILENO, FIONREAD, &cnt);\n\t\tif (cnt) {\n\t\t\tif (!arg_quiet)\n\t\t\t\tprintf(\"Warning: removing %d bytes from stdin\\n\", cnt);\n\t\t\tioctl(STDIN_FILENO, TCFLSH, TCIFLUSH);\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "appimage_clear",
          "args": [],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "appimage_clear",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/appimage.c",
          "lines": "126-163",
          "snippet": "void appimage_clear(void) {\n\tint rv;\n\n\tEUID_ROOT();\n\tif (mntdir) {\n\t\tint i;\n\t\tint rv = 0;\n\t\tfor (i = 0; i < 5; i++) {\n\t\t\trv = umount2(mntdir, MNT_FORCE);\n\t\t\tif (rv == 0)\n\t\t\t\tbreak;\n\t\t\tif (rv == -1 && errno == EBUSY) {\n\t\t\t\tif (!arg_quiet)\n\t\t\t\t\tprintf(\"Warning: EBUSY error trying to unmount %s\\n\", mntdir);\t\t\t\n\t\t\t\tsleep(2);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\t// rv = -1\n\t\t\tif (!arg_quiet) {\n\t\t\t\tprintf(\"Warning: error trying to unmount %s\\n\", mntdir);\n\t\t\t\tperror(\"umount\");\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (rv == 0) {\n\t\t\trmdir(mntdir);\n\t\t\tfree(mntdir);\n\t\t}\n\t}\n\n\tif (devloop) {\n\t\tint lfd = open(devloop, O_RDONLY);\n\t\trv = ioctl(lfd, LOOP_CLR_FD, 0);\n\t\t(void) rv;\n\t\tclose(lfd);\n\t}\n}",
          "includes": [
            "#include <errno.h>",
            "#include <linux/loop.h>",
            "#include <fcntl.h>",
            "#include <sys/mount.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static char *devloop = NULL;",
            "static char *mntdir = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <linux/loop.h>\n#include <fcntl.h>\n#include <sys/mount.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nstatic char *devloop = NULL;\nstatic char *mntdir = NULL;\n\nvoid appimage_clear(void) {\n\tint rv;\n\n\tEUID_ROOT();\n\tif (mntdir) {\n\t\tint i;\n\t\tint rv = 0;\n\t\tfor (i = 0; i < 5; i++) {\n\t\t\trv = umount2(mntdir, MNT_FORCE);\n\t\t\tif (rv == 0)\n\t\t\t\tbreak;\n\t\t\tif (rv == -1 && errno == EBUSY) {\n\t\t\t\tif (!arg_quiet)\n\t\t\t\t\tprintf(\"Warning: EBUSY error trying to unmount %s\\n\", mntdir);\t\t\t\n\t\t\t\tsleep(2);\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t\t\n\t\t\t// rv = -1\n\t\t\tif (!arg_quiet) {\n\t\t\t\tprintf(\"Warning: error trying to unmount %s\\n\", mntdir);\n\t\t\t\tperror(\"umount\");\n\t\t\t}\n\t\t}\n\t\t\n\t\tif (rv == 0) {\n\t\t\trmdir(mntdir);\n\t\t\tfree(mntdir);\n\t\t}\n\t}\n\n\tif (devloop) {\n\t\tint lfd = open(devloop, O_RDONLY);\n\t\trv = ioctl(lfd, LOOP_CLR_FD, 0);\n\t\t(void) rv;\n\t\tclose(lfd);\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": "clear_run_files",
          "args": [
            "sandbox_pid"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "clear_run_files",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "130-135",
          "snippet": "void clear_run_files(pid_t pid) {\n\tbandwidth_del_run_file(pid);\t\t// bandwidth file\n\tnetwork_del_run_file(pid);\t\t// network map file\n\tdelete_name_file(pid);\n\tdelete_x11_file(pid);\n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void set_name_file(pid_t pid);",
            "static void delete_name_file(pid_t pid);",
            "static void delete_x11_file(pid_t pid);",
            "pid_t pid;",
            "pid_t pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nvoid clear_run_files(pid_t pid) {\n\tbandwidth_del_run_file(pid);\t\t// bandwidth file\n\tnetwork_del_run_file(pid);\t\t// network map file\n\tdelete_name_file(pid);\n\tdelete_x11_file(pid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"\\nParent is shutting down, bye...\\n\""
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "logmsg",
          "args": [
            "\"exiting...\""
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "logmsg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "131-138",
          "snippet": "void logmsg(const char *msg) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"%s\\n\", msg);\n\tcloselog();\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nvoid logmsg(const char *msg) {\n\tif (!arg_debug)\n\t\treturn;\n\n\topenlog(\"firejail\", LOG_NDELAY | LOG_PID, LOG_USER);\n\tsyslog(LOG_INFO, \"%s\\n\", msg);\n\tcloselog();\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nint arg_command = 0;\nint arg_quiet = 0;\npid_t sandbox_pid;\n\nstatic void myexit(int rv) {\n\tlogmsg(\"exiting...\");\n\tif (!arg_command && !arg_quiet)\n\t\tprintf(\"\\nParent is shutting down, bye...\\n\");\n\n\n\t// delete sandbox files in shared memory\n\tEUID_ROOT();\n\tclear_run_files(sandbox_pid);\n\tappimage_clear();\n\tflush_stdin();\n\texit(rv); \n}"
  },
  {
    "function_name": "clear_run_files",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
    "lines": "130-135",
    "snippet": "void clear_run_files(pid_t pid) {\n\tbandwidth_del_run_file(pid);\t\t// bandwidth file\n\tnetwork_del_run_file(pid);\t\t// network map file\n\tdelete_name_file(pid);\n\tdelete_x11_file(pid);\n}",
    "includes": [
      "#include <sys/times.h>",
      "#include <sys/utsname.h>",
      "#include <net/if.h>",
      "#include <time.h>",
      "#include <signal.h>",
      "#include <sys/prctl.h>",
      "#include <sys/file.h>",
      "#include <limits.h>",
      "#include <errno.h>",
      "#include <pwd.h>",
      "#include <dirent.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <sys/mount.h>",
      "#include <sched.h>",
      "#include <sys/utsname.h>",
      "#include \"../include/pid.h\"",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static void set_name_file(pid_t pid);",
      "static void delete_name_file(pid_t pid);",
      "static void delete_x11_file(pid_t pid);",
      "pid_t pid;",
      "pid_t pid;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "delete_x11_file",
          "args": [
            "pid"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "delete_x11_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "773-780",
          "snippet": "static void delete_x11_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_X11_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void set_name_file(pid_t pid);",
            "static void delete_name_file(pid_t pid);",
            "static void delete_x11_file(pid_t pid);",
            "pid_t pid;",
            "pid_t pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nstatic void delete_x11_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_X11_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "delete_name_file",
          "args": [
            "pid"
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "delete_name_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/main.c",
          "lines": "746-753",
          "snippet": "static void delete_name_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_NAME_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}",
          "includes": [
            "#include <sys/times.h>",
            "#include <sys/utsname.h>",
            "#include <net/if.h>",
            "#include <time.h>",
            "#include <signal.h>",
            "#include <sys/prctl.h>",
            "#include <sys/file.h>",
            "#include <limits.h>",
            "#include <errno.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <sys/mount.h>",
            "#include <sched.h>",
            "#include <sys/utsname.h>",
            "#include \"../include/pid.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static void set_name_file(pid_t pid);",
            "static void delete_name_file(pid_t pid);",
            "static void delete_x11_file(pid_t pid);",
            "pid_t pid;",
            "pid_t pid;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nstatic void delete_name_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d\", RUN_FIREJAIL_NAME_DIR, pid) == -1)\n\t\terrExit(\"asprintf\");\n\tint rv = unlink(fname);\n\t(void) rv;\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "network_del_run_file",
          "args": [
            "pid"
          ],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "network_del_run_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "153-159",
          "snippet": "void network_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid network_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-netmap\", RUN_FIREJAIL_NETWORK_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bandwidth_del_run_file",
          "args": [
            "pid"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "bandwidth_del_run_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/bandwidth.c",
          "lines": "145-151",
          "snippet": "void bandwidth_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}",
          "includes": [
            "#include \"firejail.h\"",
            "#include <net/if.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"firejail.h\"\n#include <net/if.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n\nvoid bandwidth_del_run_file(pid_t pid) {\n\tchar *fname;\n\tif (asprintf(&fname, \"%s/%d-bandwidth\", RUN_FIREJAIL_BANDWIDTH_DIR, (int) pid) == -1)\n\t\terrExit(\"asprintf\");\n\tunlink(fname);\n\tfree(fname);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/times.h>\n#include <sys/utsname.h>\n#include <net/if.h>\n#include <time.h>\n#include <signal.h>\n#include <sys/prctl.h>\n#include <sys/file.h>\n#include <limits.h>\n#include <errno.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <sys/mount.h>\n#include <sched.h>\n#include <sys/utsname.h>\n#include \"../include/pid.h\"\n#include \"firejail.h\"\n\nstatic void set_name_file(pid_t pid);\nstatic void delete_name_file(pid_t pid);\nstatic void delete_x11_file(pid_t pid);\npid_t pid;\npid_t pid;\n\nvoid clear_run_files(pid_t pid) {\n\tbandwidth_del_run_file(pid);\t\t// bandwidth file\n\tnetwork_del_run_file(pid);\t\t// network map file\n\tdelete_name_file(pid);\n\tdelete_x11_file(pid);\n}"
  }
]