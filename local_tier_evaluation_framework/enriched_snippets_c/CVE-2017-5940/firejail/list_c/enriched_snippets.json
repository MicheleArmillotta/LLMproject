[
  {
    "function_name": "tree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
    "lines": "89-100",
    "snippet": "void tree(void) {\n\tEUID_ASSERT();\n\tdrop_privs(1);\n\tchar *cmd = get_firemon_path(\"--tree\");\n\t\n\tchar *arg[4];\n\targ[0] = \"bash\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\texecvp(\"/bin/bash\", arg); \n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "execvp",
          "args": [
            "\"/bin/bash\"",
            "arg"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_firemon_path",
          "args": [
            "\"--tree\""
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "get_firemon_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
          "lines": "39-48",
          "snippet": "static char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nstatic char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}"
        }
      },
      {
        "call_info": {
          "callee": "drop_privs",
          "args": [
            "1"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "drop_privs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "36-81",
          "snippet": "void drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_GROUPS 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define MAX_GROUPS 1024\n\nvoid drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid tree(void) {\n\tEUID_ASSERT();\n\tdrop_privs(1);\n\tchar *cmd = get_firemon_path(\"--tree\");\n\t\n\tchar *arg[4];\n\targ[0] = \"bash\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\texecvp(\"/bin/bash\", arg); \n}"
  },
  {
    "function_name": "list",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
    "lines": "76-87",
    "snippet": "void list(void) {\n\tEUID_ASSERT();\n\tdrop_privs(1);\n\tchar *cmd = get_firemon_path(\"--list\");\n\t\n\tchar *arg[4];\n\targ[0] = \"bash\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\texecvp(\"/bin/bash\", arg); \n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "execvp",
          "args": [
            "\"/bin/bash\"",
            "arg"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_firemon_path",
          "args": [
            "\"--list\""
          ],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "get_firemon_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
          "lines": "39-48",
          "snippet": "static char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nstatic char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}"
        }
      },
      {
        "call_info": {
          "callee": "drop_privs",
          "args": [
            "1"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "drop_privs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "36-81",
          "snippet": "void drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_GROUPS 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define MAX_GROUPS 1024\n\nvoid drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid list(void) {\n\tEUID_ASSERT();\n\tdrop_privs(1);\n\tchar *cmd = get_firemon_path(\"--list\");\n\t\n\tchar *arg[4];\n\targ[0] = \"bash\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\texecvp(\"/bin/bash\", arg); \n}"
  },
  {
    "function_name": "netstats",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
    "lines": "63-74",
    "snippet": "void netstats(void) {\n\tEUID_ASSERT();\n\tset_privileges();\t\n\tchar *cmd = get_firemon_path(\"--netstats\");\n\t\n\tchar *arg[4];\n\targ[0] = \"bash\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\texecvp(\"/bin/bash\", arg); \n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "execvp",
          "args": [
            "\"/bin/bash\"",
            "arg"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_firemon_path",
          "args": [
            "\"--netstats\""
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "get_firemon_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
          "lines": "39-48",
          "snippet": "static char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nstatic char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_privileges",
          "args": [],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "set_privileges",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
          "lines": "24-37",
          "snippet": "static void set_privileges(void) {\n\tstruct stat s;\n\tif (stat(\"/proc/sys/kernel/grsecurity\", &s) == 0) {\n\t\tEUID_ROOT();\n\n\t\t// elevate privileges\n\t\tif (setreuid(0, 0))\n\t\t\terrExit(\"setreuid\");\n\t\tif (setregid(0, 0))\n\t\t\terrExit(\"setregid\");\n\t}\n\telse\n\t\tdrop_privs(1);\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nstatic void set_privileges(void) {\n\tstruct stat s;\n\tif (stat(\"/proc/sys/kernel/grsecurity\", &s) == 0) {\n\t\tEUID_ROOT();\n\n\t\t// elevate privileges\n\t\tif (setreuid(0, 0))\n\t\t\terrExit(\"setreuid\");\n\t\tif (setregid(0, 0))\n\t\t\terrExit(\"setregid\");\n\t}\n\telse\n\t\tdrop_privs(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid netstats(void) {\n\tEUID_ASSERT();\n\tset_privileges();\t\n\tchar *cmd = get_firemon_path(\"--netstats\");\n\t\n\tchar *arg[4];\n\targ[0] = \"bash\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\texecvp(\"/bin/bash\", arg); \n}"
  },
  {
    "function_name": "top",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
    "lines": "50-61",
    "snippet": "void top(void) {\n\tEUID_ASSERT();\n\tdrop_privs(1);\n\tchar *cmd = get_firemon_path(\"--top\");\n\n\tchar *arg[4];\n\targ[0] = \"bash\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\texecvp(\"/bin/bash\", arg); \n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "execvp",
          "args": [
            "\"/bin/bash\"",
            "arg"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_firemon_path",
          "args": [
            "\"--top\""
          ],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "get_firemon_path",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
          "lines": "39-48",
          "snippet": "static char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nstatic char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}"
        }
      },
      {
        "call_info": {
          "callee": "drop_privs",
          "args": [
            "1"
          ],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "drop_privs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "36-81",
          "snippet": "void drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_GROUPS 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define MAX_GROUPS 1024\n\nvoid drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "EUID_ASSERT",
          "args": [],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nvoid top(void) {\n\tEUID_ASSERT();\n\tdrop_privs(1);\n\tchar *cmd = get_firemon_path(\"--top\");\n\n\tchar *arg[4];\n\targ[0] = \"bash\";\n\targ[1] = \"-c\";\n\targ[2] = cmd;\n\targ[3] = NULL;\n\texecvp(\"/bin/bash\", arg); \n}"
  },
  {
    "function_name": "get_firemon_path",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
    "lines": "39-48",
    "snippet": "static char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"asprintf\""
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&firemon",
            "\"%s/bin/firemon %s\"",
            "PREFIX",
            "cmd"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "cmd"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nstatic char *get_firemon_path(const char *cmd) {\n\tassert(cmd);\n\t\n\t// start the argv[0] program in a new sandbox\n\tchar *firemon;\n\tif (asprintf(&firemon, \"%s/bin/firemon %s\", PREFIX, cmd) == -1)\n\t\terrExit(\"asprintf\");\n\n\treturn firemon;\n}"
  },
  {
    "function_name": "set_privileges",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/list.c",
    "lines": "24-37",
    "snippet": "static void set_privileges(void) {\n\tstruct stat s;\n\tif (stat(\"/proc/sys/kernel/grsecurity\", &s) == 0) {\n\t\tEUID_ROOT();\n\n\t\t// elevate privileges\n\t\tif (setreuid(0, 0))\n\t\t\terrExit(\"setreuid\");\n\t\tif (setregid(0, 0))\n\t\t\terrExit(\"setregid\");\n\t}\n\telse\n\t\tdrop_privs(1);\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "drop_privs",
          "args": [
            "1"
          ],
          "line": 36
        },
        "resolved": true,
        "details": {
          "function_name": "drop_privs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "36-81",
          "snippet": "void drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [
            "#define MAX_GROUPS 1024"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\n#define MAX_GROUPS 1024\n\nvoid drop_privs(int nogroups) {\n\tEUID_ROOT();\n\tgid_t gid = getgid();\n\n\t// configure supplementary groups\n\tif (gid == 0 || nogroups) {\n\t\tif (setgroups(0, NULL) < 0)\n\t\t\terrExit(\"setgroups\");\n\t\tif (arg_debug)\n\t\t\tprintf(\"Username %s, no supplementary groups\\n\", cfg.username);\n\t}\n\telse {\n\t\tassert(cfg.username);\n\t\tgid_t groups[MAX_GROUPS];\n\t\tint ngroups = MAX_GROUPS;\n\t\tint rv = getgrouplist(cfg.username, gid, groups, &ngroups);\n\n\t\tif (arg_debug && rv) {\n\t\t\tprintf(\"Username %s, groups \", cfg.username);\n\t\t\tint i;\n\t\t\tfor (i = 0; i < ngroups; i++)\n\t\t\t\tprintf(\"%u, \", groups[i]);\n\t\t\tprintf(\"\\n\");\n\t\t}\n\n\t\tif (rv == -1) {\n\t\t\tfprintf(stderr, \"Warning: cannot extract supplementary group list, dropping them\\n\");\n\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\terrExit(\"setgroups\");\n\t\t}\n\t\telse {\n\t\t\trv = setgroups(ngroups, groups);\n\t\t\tif (rv) {\n\t\t\t\tfprintf(stderr, \"Warning: cannot set supplementary group list, dropping them\\n\");\n\t\t\t\tif (setgroups(0, NULL) < 0)\n\t\t\t\t\terrExit(\"setgroups\");\n\t\t\t}\n\t\t}\n\t}\n\n\t// set uid/gid\n\tif (setgid(getgid()) < 0)\n\t\terrExit(\"setgid/getgid\");\n\tif (setuid(getuid()) < 0)\n\t\terrExit(\"setuid/getuid\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setregid\""
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setregid",
          "args": [
            "0",
            "0"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "errExit",
          "args": [
            "\"setreuid\""
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setreuid",
          "args": [
            "0",
            "0"
          ],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EUID_ROOT",
          "args": [],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "\"/proc/sys/kernel/grsecurity\"",
            "&s"
          ],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <sys/types.h>\n#include \"firejail.h\"\n\nstatic void set_privileges(void) {\n\tstruct stat s;\n\tif (stat(\"/proc/sys/kernel/grsecurity\", &s) == 0) {\n\t\tEUID_ROOT();\n\n\t\t// elevate privileges\n\t\tif (setreuid(0, 0))\n\t\t\terrExit(\"setreuid\");\n\t\tif (setregid(0, 0))\n\t\t\terrExit(\"setregid\");\n\t}\n\telse\n\t\tdrop_privs(1);\n}"
  }
]