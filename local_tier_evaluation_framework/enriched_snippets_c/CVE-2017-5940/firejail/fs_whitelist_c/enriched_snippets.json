[
  {
    "function_name": "st(void) {",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_whitelist.c",
    "lines": "314-835",
    "snippet": "itelist(void) {\n\tchar *homedir = cfg.homedir;\n\tassert(homedir);\n\tProfileEntry *entry = cfg.profile;\n\tif (!entry)\n\t\treturn;\n\n\tchar *new_name = NULL;\n\tint home_dir = 0;\t// /home/user directory flag\n\tint tmp_dir = 0;\t// /tmp directory flag\n\tint media_dir = 0;\t// /media directory flag\n\tint mnt_dir = 0;\t// /mnt directory flag\n\tint var_dir = 0;\t\t// /var directory flag\n\tint dev_dir = 0;\t\t// /dev directory flag\n\tint opt_dir = 0;\t\t// /opt directory flag\n        int srv_dir = 0;                // /srv directory flag\n\t// verify whitelist files, extract symbolic links, etc.\n\twhile (entry) {\n\t\t// handle only whitelist commands\n\t\tif (strncmp(entry->data, \"whitelist \", 10)) {\n\t\t\tentry = entry->next;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// resolve ${DOWNLOADS}\n\t\tif (strcmp(entry->data + 10, \"${DOWNLOADS}\") == 0) {\n\t\t\tchar *tmp = resolve_downloads();\n\t\t\tif (tmp)\n\t\t\t\tentry->data = tmp;\n\t\t\telse {\n\t\t\t\t*entry->data = '\\0';\n\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\tfprintf(stderr, \"*** Warning: cannot whitelist Downloads directory\\n\");\n\t\t\t\tfprintf(stderr, \"*** \\tAny file saved will be lost when the sandbox is closed.\\n\");\n\t\t\t\tfprintf(stderr, \"*** \\tPlease create a proper Downloads directory for your application.\\n\");\n\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\t// replace ~/ or ${HOME} into /home/username\n\t\tnew_name = expand_home(entry->data + 10, cfg.homedir);\n\t\tassert(new_name);\n\t\tif (arg_debug)\n\t\t\tfprintf(stderr, \"Debug %d: new_name #%s#\\n\", __LINE__, new_name);\n\n\t\t// valid path referenced to filesystem root\n\t\tif (*new_name != '/') {\n\t\t\tif (arg_debug)\n\t\t\t\tfprintf(stderr, \"Debug %d: \\n\", __LINE__);\n\t\t\tgoto errexit;\n\t\t}\n\n\n\t\t// extract the absolute path of the file\n\t\t// realpath function will fail with ENOENT if the file is not found\n\t\tchar *fname = realpath(new_name, NULL);\n\t\tif (!fname) {\n\t\t\t// file not found, blank the entry in the list and continue\n\t\t\tif (arg_debug || arg_debug_whitelists) {\n\t\t\t\tprintf(\"Removed whitelist path: %s\\n\", entry->data);\n\t\t\t\tprintf(\"\\texpanded: %s\\n\", new_name);\n\t\t\t\tprintf(\"\\treal path: (null)\\n\");\n\t\t\t\tprintf(\"\\t\");fflush(0);\n\t\t\t\tperror(\"realpath\");\n\t\t\t}\n\t\t\t*entry->data = '\\0';\n\n\t\t\t// if 1 the file was not found; mount an empty directory\n\t\t\tif (strncmp(new_name, cfg.homedir, strlen(cfg.homedir)) == 0) {\n\t\t\t\tif(!arg_private)\n\t\t\t\t\thome_dir = 1;\n\t\t\t}\n\t\t\telse if (strncmp(new_name, \"/tmp/\", 5) == 0)\n\t\t\t\ttmp_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/media/\", 7) == 0)\n\t\t\t\tmedia_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/mnt/\", 5) == 0)\n\t\t\t\tmnt_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/var/\", 5) == 0)\n\t\t\t\tvar_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/dev/\", 5) == 0)\n\t\t\t\tdev_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/opt/\", 5) == 0)\n\t\t\t\topt_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/srv/\", 5) == 0)\n\t\t\t\topt_dir = 1;\n\t\t\t\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\t// check for supported directories\n\t\tif (strncmp(new_name, cfg.homedir, strlen(cfg.homedir)) == 0) {\n\t\t\t// whitelisting home directory is disabled if --private option is present\n\t\t\tif (arg_private) {\n\t\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\t\tprintf(\"Removed whitelist path %s, --private option is present\\n\", entry->data);\n\n\t\t\t\t*entry->data = '\\0';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tentry->home_dir = 1;\n\t\t\thome_dir = 1;\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#, cfg.homedir #%s#\\n\",\n\t\t\t\t\t__LINE__, fname, cfg.homedir);\n\n\t\t\t// both path and absolute path are under /home\n\t\t\tif (strncmp(fname, cfg.homedir, strlen(cfg.homedir)) != 0) {\n\t\t\t\t// check if the file is owned by the user\n\t\t\t\tstruct stat s;\n\t\t\t\tif (stat(fname, &s) == 0 && s.st_uid != getuid())\n\t\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/tmp/\", 5) == 0) {\n\t\t\tentry->tmp_dir = 1;\n\t\t\ttmp_dir = 1;\n\t\t\t// both path and absolute path are under /tmp\n\t\t\tif (strncmp(fname, \"/tmp/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/media/\", 7) == 0) {\n\t\t\tentry->media_dir = 1;\n\t\t\tmedia_dir = 1;\n\t\t\t// both path and absolute path are under /media\n\t\t\tif (strncmp(fname, \"/media/\", 7) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/mnt/\", 5) == 0) {\n\t\t\tentry->mnt_dir = 1;\n\t\t\tmnt_dir = 1;\n\t\t\t// both path and absolute path are under /mnt\n\t\t\tif (strncmp(fname, \"/mnt/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/var/\", 5) == 0) {\n\t\t\tentry->var_dir = 1;\n\t\t\tvar_dir = 1;\n\t\t\t// both path and absolute path are under /var\n\t\t\t// exceptions: /var/run and /var/lock\n\t\t\tif (strcmp(new_name, \"/var/run\")== 0)\n\t\t\t\t;\n\t\t\telse if (strcmp(new_name, \"/var/lock\")== 0)\n\t\t\t\t;\n\t\t\telse if (strncmp(fname, \"/var/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/dev/\", 5) == 0) {\n\t\t\tentry->dev_dir = 1;\n\t\t\tdev_dir = 1;\n\t\t\t// both path and absolute path are under /dev\n\t\t\tif (strncmp(fname, \"/dev/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/opt/\", 5) == 0) {\n\t\t\tentry->opt_dir = 1;\n\t\t\topt_dir = 1;\n\t\t\t// both path and absolute path are under /dev\n\t\t\tif (strncmp(fname, \"/opt/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/srv/\", 5) == 0) {\n\t\t\tentry->srv_dir = 1;\n\t\t\tsrv_dir = 1;\n\t\t\t// both path and absolute path are under /srv\n\t\t\tif (strncmp(fname, \"/srv/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (arg_debug)\n\t\t\t\tfprintf(stderr, \"Debug %d: \\n\", __LINE__);\n\t\t\tgoto errexit;\n\t\t}\n\n\t\t// mark symbolic links\n\t\tif (is_link(new_name))\n\t\t\tentry->link = new_name;\n\t\telse {\n\t\t\tfree(new_name);\n\t\t\tnew_name = NULL;\n\t\t}\n\n\t\t// change file name in entry->data\n\t\tif (strcmp(fname, entry->data + 10) != 0) {\n\t\t\tchar *newdata;\n\t\t\tif (asprintf(&newdata, \"whitelist %s\", fname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tentry->data = newdata;\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Replaced whitelist path: %s\\n\", entry->data);\n\t\t}\n\t\tfree(fname);\n\t\tentry = entry->next;\n\t}\n\t\t\n\t// create mount points\n\tfs_build_mnt_dir();\n\t\n\n\t// /home/user\n\tif (home_dir) {\n\t\t// keep a copy of real home dir in RUN_WHITELIST_HOME_USER_DIR\n\t\tint rv = mkdir(RUN_WHITELIST_HOME_USER_DIR, 0755);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_HOME_USER_DIR, getuid(), getgid()) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_HOME_USER_DIR, 0755) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(cfg.homedir, RUN_WHITELIST_HOME_USER_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount a tmpfs and initialize /home/user\n\t\t fs_private();\n\t}\n\t\n\t// /tmp mountpoint\n\tif (tmp_dir) {\n\t\t// keep a copy of real /tmp directory in  \n\t\tint rv = mkdir(RUN_WHITELIST_TMP_DIR, 1777);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_TMP_DIR, 0, 0) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_TMP_DIR, 1777) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(\"/tmp\", RUN_WHITELIST_TMP_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount tmpfs on /tmp\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Mounting tmpfs on /tmp directory\\n\");\n\t\tif (mount(\"tmpfs\", \"/tmp\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=1777,gid=0\") < 0)\n\t\t\terrExit(\"mounting tmpfs on /tmp\");\n\t\tfs_logger(\"tmpfs /tmp\");\n\t}\n\t\n\t// /media mountpoint\n\tif (media_dir) {\n\t\t// some distros don't have a /media directory\n\t\tstruct stat s;\n\t\tif (stat(\"/media\", &s) == 0) {\n\t\t\t// keep a copy of real /media directory in RUN_WHITELIST_MEDIA_DIR\n\t\t\tint rv = mkdir(RUN_WHITELIST_MEDIA_DIR, 0755);\n\t\t\tif (rv == -1)\n\t\t\t\terrExit(\"mkdir\");\n\t\t\tif (chown(RUN_WHITELIST_MEDIA_DIR, 0, 0) < 0)\n\t\t\t\terrExit(\"chown\");\n\t\t\tif (chmod(RUN_WHITELIST_MEDIA_DIR, 0755) < 0)\n\t\t\t\terrExit(\"chmod\");\n\t\n\t\t\tif (mount(\"/media\", RUN_WHITELIST_MEDIA_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\t\terrExit(\"mount bind\");\n\t\n\t\t\t// mount tmpfs on /media\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Mounting tmpfs on /media directory\\n\");\n\t\t\tif (mount(\"tmpfs\", \"/media\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\t\terrExit(\"mounting tmpfs on /media\");\n\t\t\tfs_logger(\"tmpfs /media\");\n\t\t}\n\t\telse\n\t\t\tmedia_dir = 0;\n\t}\n\n\t// /mnt mountpoint\n\tif (mnt_dir) {\n\t\t// check if /mnt directory exists\n\t\tstruct stat s;\n\t\tif (stat(\"/mnt\", &s) == 0) {\n\t\t\t// keep a copy of real /mnt directory in RUN_WHITELIST_MNT_DIR\n\t\t\tint rv = mkdir(RUN_WHITELIST_MNT_DIR, 0755);\n\t\t\tif (rv == -1)\n\t\t\t\terrExit(\"mkdir\");\n\t\t\tif (chown(RUN_WHITELIST_MNT_DIR, 0, 0) < 0)\n\t\t\t\terrExit(\"chown\");\n\t\t\tif (chmod(RUN_WHITELIST_MNT_DIR, 0755) < 0)\n\t\t\t\terrExit(\"chmod\");\n\n\t\t\tif (mount(\"/mnt\", RUN_WHITELIST_MNT_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\t\terrExit(\"mount bind\");\n\n\t\t\t// mount tmpfs on /mnt\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Mounting tmpfs on /mnt directory\\n\");\n\t\t\tif (mount(\"tmpfs\", \"/mnt\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\t\terrExit(\"mounting tmpfs on /mnt\");\n\t\t\tfs_logger(\"tmpfs /mnt\");\n\t\t}\n\t\telse\n\t\t\tmnt_dir = 0;\n\t}\n\n\n\t// /var mountpoint\n\tif (var_dir) {\n\t\t// keep a copy of real /var directory in RUN_WHITELIST_VAR_DIR\n\t\tint rv = mkdir(RUN_WHITELIST_VAR_DIR, 0755);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_VAR_DIR, 0, 0) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_VAR_DIR, 0755) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(\"/var\", RUN_WHITELIST_VAR_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount tmpfs on /var\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Mounting tmpfs on /var directory\\n\");\n\t\tif (mount(\"tmpfs\", \"/var\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mounting tmpfs on /var\");\n\t\tfs_logger(\"tmpfs /var\");\n\t}\n\n\t// /dev mountpoint\n\tif (dev_dir) {\n\t\t// keep a copy of real /dev directory in RUN_WHITELIST_DEV_DIR\n\t\tint rv = mkdir(RUN_WHITELIST_DEV_DIR, 0755);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_DEV_DIR, 0, 0) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_DEV_DIR, 0755) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(\"/dev\", RUN_WHITELIST_DEV_DIR, NULL, MS_BIND|MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount tmpfs on /dev\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Mounting tmpfs on /dev directory\\n\");\n\t\tif (mount(\"tmpfs\", \"/dev\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mounting tmpfs on /dev\");\n\t\tfs_logger(\"tmpfs /dev\");\n\t}\n\n\t// /opt mountpoint\n\tif (opt_dir) {\n\t\t// keep a copy of real /opt directory in RUN_WHITELIST_OPT_DIR\n\t\tint rv = mkdir(RUN_WHITELIST_OPT_DIR, 0755);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_OPT_DIR, 0, 0) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_OPT_DIR, 0755) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(\"/opt\", RUN_WHITELIST_OPT_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount tmpfs on /opt\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Mounting tmpfs on /opt directory\\n\");\n\t\tif (mount(\"tmpfs\", \"/opt\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mounting tmpfs on /opt\");\n\t\tfs_logger(\"tmpfs /opt\");\n\t}\n\n\t// /srv mountpoint\n\tif (srv_dir) {\n\t\t// check if /srv directory exists\n\t\tstruct stat s;\n\t\tif (stat(\"/srv\", &s) == 0) {\n\t\t\t// keep a copy of real /srv directory in RUN_WHITELIST_SRV_DIR\n\t\t\tint rv = mkdir(RUN_WHITELIST_SRV_DIR, 0755);\n\t\t\tif (rv == -1)\n\t\t\t\terrExit(\"mkdir\");\n\t\t\tif (chown(RUN_WHITELIST_SRV_DIR, 0, 0) < 0)\n\t\t\t\terrExit(\"chown\");\n\t\t\tif (chmod(RUN_WHITELIST_SRV_DIR, 0755) < 0)\n\t\t\t\terrExit(\"chmod\");\n\n\t\t\tif (mount(\"/srv\", RUN_WHITELIST_SRV_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\t\terrExit(\"mount bind\");\n\n\t\t\t// mount tmpfs on /srv\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Mounting tmpfs on /srv directory\\n\");\n\t\t\tif (mount(\"tmpfs\", \"/srv\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\t\terrExit(\"mounting tmpfs on /srv\");\n\t\t\tfs_logger(\"tmpfs /srv\");\n\t\t}\n\t\telse\n\t\t\tsrv_dir = 0;\n\t}\n\n\n\t\n\t// go through profile rules again, and interpret whitelist commands\n\tentry = cfg.profile;\n\twhile (entry) {\n\t\t// handle only whitelist commands\n\t\tif (strncmp(entry->data, \"whitelist \", 10)) {\n\t\t\tentry = entry->next;\n\t\t\tcontinue;\n\t\t}\n\n//printf(\"here %d#%s#\\n\", __LINE__, entry->data);\n\t\t// whitelist the real file\n\t\tif (strcmp(entry->data, \"whitelist /run\") == 0 && \n\t\t    (strcmp(entry->link, \"/var/run\") == 0 || strcmp(entry->link, \"/var/lock\") == 0)) {\n\t\t\tint rv = symlink(entry->data + 10, entry->link);\n\t\t\tif (rv)\n\t\t\t\tfprintf(stderr, \"Warning cannot create symbolic link %s\\n\", entry->link);\n\t\t\telse if (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Created symbolic link %s -> %s\\n\", entry->link, entry->data + 10);\n\t\t}\n\t\telse {\n\t\t\twhitelist_path(entry);\n\t\n\t\t\t// create the link if any\n\t\t\tif (entry->link) {\n\t\t\t\t// if the link is already there, do not bother\n\t\t\t\tstruct stat s;\n\t\t\t\tif (stat(entry->link, &s) != 0) {\n\t\t\t\t\t// create the path if necessary\n\t\t\t\t\tmkpath(entry->link, s.st_mode);\n\t\n\t\t\t\t\tint rv = symlink(entry->data + 10, entry->link);\n\t\t\t\t\tif (rv)\n\t\t\t\t\t\tfprintf(stderr, \"Warning cannot create symbolic link %s\\n\", entry->link);\n\t\t\t\t\telse if (arg_debug || arg_debug_whitelists)\n\t\t\t\t\t\tprintf(\"Created symbolic link %s -> %s\\n\", entry->link, entry->data + 10);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\t// mask the real home directory, currently mounted on RUN_WHITELIST_HOME_DIR\n\tif (home_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_HOME_USER_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_HOME_USER_DIR);\n\t}\n\t\n\t// mask the real /tmp directory, currently mounted on RUN_WHITELIST_TMP_DIR\n\tif (tmp_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_TMP_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_TMP_DIR);\n\t}\n\n\t// mask the real /var directory, currently mounted on RUN_WHITELIST_VAR_DIR\n\tif (var_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_VAR_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_VAR_DIR);\n\t}\n\n\t// mask the real /opt directory, currently mounted on RUN_WHITELIST_OPT_DIR\n\tif (opt_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_OPT_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_OPT_DIR);\n\t}\n\n\t// mask the real /dev directory, currently mounted on RUN_WHITELIST_DEV_DIR\n\tif (dev_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_DEV_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_DEV_DIR);\n\t}\n\n\t// mask the real /media directory, currently mounted on RUN_WHITELIST_MEDIA_DIR\n\tif (media_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_MEDIA_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_MEDIA_DIR);\n\t}\n\n\t// mask the real /mnt directory, currently mounted on RUN_WHITELIST_MNT_DIR\n\tif (mnt_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_MNT_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_MNT_DIR);\n\t}\n\n\t// mask the real /srv directory, currently mounted on RUN_WHITELIST_SRV_DIR\n\tif (srv_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_SRV_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_SRV_DIR);\n\t}\n\n\tif (new_name)\n\t\tfree(new_name);\n\t\t\n\treturn;\n\nerrexit:\n\tfprintf(stderr, \"Error: invalid whitelist path %s\\n\", new_name);\n\texit(1);\n}",
    "includes": [
      "#include <errno.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <glob.h>",
      "#include <fnmatch.h>",
      "#include <linux/limits.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 834
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "valid whitelist path %s\\n\", new_name",
            "exit(1"
          ],
          "line": 833
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame)",
          "args": [
            "ret"
          ],
          "line": 828
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"tmpfs\",",
          "args": [
            "UN_WHIT",
            "IST_SRV_DIR);\n\t}\n\n\tif"
          ],
          "line": 824
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount tm",
          "args": [
            "fs\");\n\t\tfs_lo"
          ],
          "line": 823
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "UN_WHIT",
            "IST_SRV_DIR, \"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"tmpfs\",",
          "args": [
            "UN_WHIT",
            "IST_MNT_DIR);\n\t}\n\n\t//"
          ],
          "line": 817
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount tm",
          "args": [
            "fs\");\n\t\tfs_lo"
          ],
          "line": 816
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "UN_WHIT",
            "IST_MNT_DIR, \"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 815
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"tmpfs\",",
          "args": [
            "UN_WHIT",
            "IST_MEDIA_DIR);\n\t}\n\n\t//"
          ],
          "line": 810
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount tm",
          "args": [
            "fs\");\n\t\tfs_lo"
          ],
          "line": 809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "UN_WHIT",
            "IST_MEDIA_DIR, \"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 808
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"tmpfs\",",
          "args": [
            "UN_WHIT",
            "IST_DEV_DIR);\n\t}\n\n\t//"
          ],
          "line": 803
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount tm",
          "args": [
            "fs\");\n\t\tfs_lo"
          ],
          "line": 802
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "UN_WHIT",
            "IST_DEV_DIR, \"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 801
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"tmpfs\",",
          "args": [
            "UN_WHIT",
            "IST_OPT_DIR);\n\t}\n\n\t//"
          ],
          "line": 796
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount tm",
          "args": [
            "fs\");\n\t\tfs_lo"
          ],
          "line": 795
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "UN_WHIT",
            "IST_OPT_DIR, \"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 794
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"tmpfs\",",
          "args": [
            "UN_WHIT",
            "IST_VAR_DIR);\n\t}\n\n\t//"
          ],
          "line": 789
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount tm",
          "args": [
            "fs\");\n\t\tfs_lo"
          ],
          "line": 788
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "UN_WHIT",
            "IST_VAR_DIR, \"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 787
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"tmpfs\",",
          "args": [
            "UN_WHIT",
            "IST_TMP_DIR);\n\t}\n\n\t//"
          ],
          "line": 782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount tm",
          "args": [
            "fs\");\n\t\tfs_lo"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "UN_WHIT",
            "IST_TMP_DIR, \"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 780
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"tmpfs\",",
          "args": [
            "UN_WHIT",
            "IST_HOME_USER_DIR);\n\t}\n\t\n\t/"
          ],
          "line": 775
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount tm",
          "args": [
            "fs\");\n\t\tfs_lo"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "UN_WHIT",
            "IST_HOME_USER_DIR, \"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 773
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "eated",
          "args": [
            "ymbolic link %s -> %s\\n\", entry->l",
            "k, entry->d",
            "a + 10);\n\t\t\t\t}"
          ],
          "line": 763
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "arning",
            "annot create symbolic link %s\\n\", entry->l",
            "k);\n\t\t\t\t\tel"
          ],
          "line": 761
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "try->da",
          "args": [
            "a + 10, entry->l",
            "k);\n\t\t\t\t\tif"
          ],
          "line": 759
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ry->li",
          "args": [
            "k, s.st_mod",
            ";"
          ],
          "line": 757
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "->li",
          "args": [
            "k, &s) != 0",
            "{"
          ],
          "line": 755
        },
        "resolved": true,
        "details": {
          "function_name": "filter_add_blacklist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/seccomp.c",
          "lines": "170-195",
          "snippet": "static void filter_add_blacklist(int syscall, int arg) {\n\t(void) arg;\n\tassert(sfilter);\n\tassert(sfilter_alloc_size);\n\tassert(sfilter_index);\n//\tif (arg_debug)\n//\t\tprintf(\"Blacklisting syscall %d %s\\n\", syscall, syscall_find_nr(syscall));\n\t\n\tif ((sfilter_index + 2) > sfilter_alloc_size)\n\t\tfilter_realloc();\n\t\n\tstruct sock_filter filter[] = {\n\t\tBLACKLIST(syscall)\n\t};\n#if 0\n{\n\tint i;\n\tunsigned char *ptr = (unsigned char *) &filter[0];\n\tfor (i = 0; i < sizeof(filter); i++, ptr++)\n\t\tprintf(\"%x, \", (*ptr) & 0xff);\n\tprintf(\"\\n\");\n}\n#endif\n\tmemcpy(&sfilter[sfilter_index], filter, sizeof(filter));\n\tsfilter_index += sizeof(filter) / sizeof(struct sock_filter);\t\n}",
          "includes": [
            "#include \"seccomp.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"seccomp.h\"\n#include \"firejail.h\"\n\nstatic void filter_add_blacklist(int syscall, int arg) {\n\t(void) arg;\n\tassert(sfilter);\n\tassert(sfilter_alloc_size);\n\tassert(sfilter_index);\n//\tif (arg_debug)\n//\t\tprintf(\"Blacklisting syscall %d %s\\n\", syscall, syscall_find_nr(syscall));\n\t\n\tif ((sfilter_index + 2) > sfilter_alloc_size)\n\t\tfilter_realloc();\n\t\n\tstruct sock_filter filter[] = {\n\t\tBLACKLIST(syscall)\n\t};\n#if 0\n{\n\tint i;\n\tunsigned char *ptr = (unsigned char *) &filter[0];\n\tfor (i = 0; i < sizeof(filter); i++, ptr++)\n\t\tprintf(\"%x, \", (*ptr) & 0xff);\n\tprintf(\"\\n\");\n}\n#endif\n\tmemcpy(&sfilter[sfilter_index], filter, sizeof(filter));\n\tsfilter_index += sizeof(filter) / sizeof(struct sock_filter);\t\n}"
        }
      },
      {
        "call_info": {
          "callee": "path(entry);",
          "args": [
            "//"
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "eated",
          "args": [
            "ymbolic link %s -> %s\\n\", entry->l",
            "k, entry->d",
            "a + 10);\n\t\t}\n\t\te"
          ],
          "line": 746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "arning",
            "annot create symbolic link %s\\n\", entry->l",
            "k);\n\t\t\telse"
          ],
          "line": 744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "try->da",
          "args": [
            "a + 10, entry->l",
            "k);\n\t\t\tif ("
          ],
          "line": 742
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ry->li",
          "args": [
            "k, \"/var/lo",
            "\") == 0)) {"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ry->li",
          "args": [
            "k, \"/var/ru",
            ") == 0 ||"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ry->da",
          "args": [
            "a, \"whiteli",
            "/run\") == 0 &&"
          ],
          "line": 740
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "try->da",
          "args": [
            "a, \"whiteli",
            "\", 10)) {",
            "en"
          ],
          "line": 733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\"tmpfs /s",
          "args": [
            "v\");\n\t\t}\n\t\te"
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ounting",
          "args": [
            "tmpfs on /srv\");\n\t\t\tfs_l"
          ],
          "line": 720
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "/srv\",",
            "mpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unting",
          "args": [
            "tmpfs on /srv directory\\n\");\n\t\t\tif ("
          ],
          "line": 718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\n\t\t\t//"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "v\", R",
          "args": [
            "N_WHIT",
            "IST_SRV_DIR, NULL, MS",
            "IND|",
            "_REC, NULL) <"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if"
          ],
          "line": 711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_SRV_DIR, 0755) <"
          ],
          "line": 710
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "if ("
          ],
          "line": 709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_SRV_DIR, 0, 0) <"
          ],
          "line": 708
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdir\");",
          "args": [
            "if ("
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_SRV_DIR, 0755);",
            "if ("
          ],
          "line": 705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\", &",
          "args": [
            ") == 0",
            "{"
          ],
          "line": 703
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\"tmpfs /o",
          "args": [
            "t\");\n\t}\n\n\t//"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ounting",
          "args": [
            "tmpfs on /opt\");\n\t\tfs_lo"
          ],
          "line": 695
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "/opt\",",
            "mpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unting",
          "args": [
            "tmpfs on /opt directory\\n\");\n\t\tif (m"
          ],
          "line": 693
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\t\n\t\t//"
          ],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t\", R",
          "args": [
            "N_WHIT",
            "IST_OPT_DIR, NULL, MS",
            "IND|",
            "_REC, NULL) <"
          ],
          "line": 688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if"
          ],
          "line": 686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_OPT_DIR, 0755) <"
          ],
          "line": 685
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "if (c"
          ],
          "line": 684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_OPT_DIR, 0, 0) <"
          ],
          "line": 683
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdir\");",
          "args": [
            "if (c"
          ],
          "line": 682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_OPT_DIR, 0755);",
            "f (r"
          ],
          "line": 680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\"tmpfs /d",
          "args": [
            "v\");\n\t}\n\n\t//"
          ],
          "line": 674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ounting",
          "args": [
            "tmpfs on /dev\");\n\t\tfs_lo"
          ],
          "line": 673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "/dev\",",
            "mpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 672
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unting",
          "args": [
            "tmpfs on /dev directory\\n\");\n\t\tif (m"
          ],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\t\n\t\t//"
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "v\", R",
          "args": [
            "N_WHIT",
            "IST_DEV_DIR, NULL, MS",
            "IND|",
            "_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_DEV_DIR, 0755) <"
          ],
          "line": 663
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "if (c"
          ],
          "line": 662
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_DEV_DIR, 0, 0) <"
          ],
          "line": 661
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdir\");",
          "args": [
            "if (c"
          ],
          "line": 660
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_DEV_DIR, 0755);",
            "f (r"
          ],
          "line": 658
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\"tmpfs /v",
          "args": [
            "r\");\n\t}\n\n\t//"
          ],
          "line": 652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ounting",
          "args": [
            "tmpfs on /var\");\n\t\tfs_lo"
          ],
          "line": 651
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "/var\",",
            "mpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unting",
          "args": [
            "tmpfs on /var directory\\n\");\n\t\tif (m"
          ],
          "line": 649
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\t\n\t\t//"
          ],
          "line": 645
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r\", R",
          "args": [
            "N_WHIT",
            "IST_VAR_DIR, NULL, MS",
            "IND|",
            "_REC, NULL) <"
          ],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if"
          ],
          "line": 642
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_VAR_DIR, 0755) <"
          ],
          "line": 641
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "if (c"
          ],
          "line": 640
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_VAR_DIR, 0, 0) <"
          ],
          "line": 639
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdir\");",
          "args": [
            "if (c"
          ],
          "line": 638
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_VAR_DIR, 0755);",
            "f (r"
          ],
          "line": 636
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\"tmpfs /m",
          "args": [
            "t\");\n\t\t}\n\t\te"
          ],
          "line": 626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ounting",
          "args": [
            "tmpfs on /mnt\");\n\t\t\tfs_l"
          ],
          "line": 625
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "/mnt\",",
            "mpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unting",
          "args": [
            "tmpfs on /mnt directory\\n\");\n\t\t\tif ("
          ],
          "line": 623
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\n\t\t\t//"
          ],
          "line": 619
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "t\", R",
          "args": [
            "N_WHIT",
            "IST_MNT_DIR, NULL, MS",
            "IND|",
            "_REC, NULL) <"
          ],
          "line": 618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if"
          ],
          "line": 616
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_MNT_DIR, 0755) <"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "if ("
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_MNT_DIR, 0, 0) <"
          ],
          "line": 613
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdir\");",
          "args": [
            "if ("
          ],
          "line": 612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_MNT_DIR, 0755);",
            "if ("
          ],
          "line": 610
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\", &",
          "args": [
            ") == 0",
            "{"
          ],
          "line": 608
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\"tmpfs /m",
          "args": [
            "dia\");\n\t\t}\n\t\te"
          ],
          "line": 598
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ounting",
          "args": [
            "tmpfs on /media\");\n\t\t\tfs_l"
          ],
          "line": 597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "/media\"",
            "\"tmpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=7",
            "gid=0\") < 0)"
          ],
          "line": 596
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unting",
          "args": [
            "tmpfs on /media directory\\n\");\n\t\t\tif ("
          ],
          "line": 595
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\t\n\t\t\t//"
          ],
          "line": 591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dia\",",
          "args": [
            "RUN_WHIT",
            "IST_MEDIA_DIR, NULL, MS",
            "IND|",
            "_REC, NULL) <"
          ],
          "line": 590
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if"
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_MEDIA_DIR, 0755) <"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "if ("
          ],
          "line": 586
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_MEDIA_DIR, 0, 0) <"
          ],
          "line": 585
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdir\");",
          "args": [
            "if ("
          ],
          "line": 584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_MEDIA_DIR, 0755);",
            "if ("
          ],
          "line": 582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ia\",",
          "args": [
            "&s) == 0",
            "{"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "\"tmpfs /t",
          "args": [
            "p\");\n\t}\n\t\n\t/"
          ],
          "line": 573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ounting",
          "args": [
            "tmpfs on /tmp\");\n\t\tfs_lo"
          ],
          "line": 572
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fs\",",
          "args": [
            "/tmp\",",
            "mpfs\",",
            "S_NOSUI",
            "| MS_STRICTATIME | MS_REC,  \"mode=1",
            ",gid=0\") < 0)"
          ],
          "line": 571
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unting",
          "args": [
            "tmpfs on /tmp directory\\n\");\n\t\tif (m"
          ],
          "line": 570
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\t\n\t\t//"
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p\", R",
          "args": [
            "N_WHIT",
            "IST_TMP_DIR, NULL, MS",
            "IND|",
            "_REC, NULL) <"
          ],
          "line": 565
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if"
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_TMP_DIR, 1777) <"
          ],
          "line": 562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "if (c"
          ],
          "line": 561
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_TMP_DIR, 0, 0) <"
          ],
          "line": 560
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdir\");",
          "args": [
            "if (c"
          ],
          "line": 559
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_TMP_DIR, 1777);",
            "f (r"
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "();\n\t}",
          "args": [],
          "line": 551
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\t\n\t\t//"
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "homed",
          "args": [
            "r, RUN_WHIT",
            "IST_HOME_USER_DIR, NULL, MS",
            "IND|",
            "_REC, NULL) <"
          ],
          "line": 547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if"
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_HOME_USER_DIR, 0755) <"
          ],
          "line": 544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "if (c"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_HOME_USER_DIR, getuid()",
            "getgid()",
            "< 0)"
          ],
          "line": 542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "< 0)",
          "args": [],
          "line": 542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getgid",
          "args": [],
          "line": 542
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "kdir\");",
          "args": [
            "if (c"
          ],
          "line": 541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WHITE",
          "args": [
            "IST_HOME_USER_DIR, 0755);",
            "f (r"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nt_dir();\n\t\n\n\t//",
          "args": [],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ");",
          "args": [
            "entry"
          ],
          "line": 528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "placed",
          "args": [
            "whitelist path: %s\\n\", entry->d",
            "a);\n\t\t}\n\t\tf"
          ],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t\t\tentr"
          ],
          "line": 523
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "newdata,",
          "args": [
            "\"whiteli",
            "%s\", fname) =",
            "-1)"
          ],
          "line": 522
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "me, en",
          "args": [
            "ry->d",
            "a + 10) != 0) {"
          ],
          "line": 520
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame)",
          "args": [
            "new_"
          ],
          "line": 515
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name)",
          "args": [
            "entr"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "\\n\", __LINE__",
            "goto"
          ],
          "line": 507
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "fname #%s#\\n\", __LINE__",
            "fname);",
            "got"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame, \"/",
          "args": [
            "rv/\",",
            ") != 0)"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/srv/\",",
            ") == 0)"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "fname #%s#\\n\", __LINE__",
            "fname);",
            "got"
          ],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame, \"/",
          "args": [
            "pt/\",",
            ") != 0)"
          ],
          "line": 489
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/opt/\",",
            ") == 0)"
          ],
          "line": 485
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "fname #%s#\\n\", __LINE__",
            "fname);",
            "got"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame, \"/",
          "args": [
            "ev/\",",
            ") != 0)"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/dev/\",",
            ") == 0)"
          ],
          "line": 475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "fname #%s#\\n\", __LINE__",
            "fname);",
            "got"
          ],
          "line": 471
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame, \"/",
          "args": [
            "ar/\",",
            ") != 0)"
          ],
          "line": 469
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_name,",
          "args": [
            "\"/var/lo",
            "\")== 0)"
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_name,",
          "args": [
            "\"/var/ru",
            ")== 0)"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/var/\",",
            ") == 0)"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "fname #%s#\\n\", __LINE__",
            "fname);",
            "got"
          ],
          "line": 456
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame, \"/",
          "args": [
            "nt/\",",
            ") != 0)"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/mnt/\",",
            ") == 0)"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "fname #%s#\\n\", __LINE__",
            "fname);",
            "got"
          ],
          "line": 446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame, \"/",
          "args": [
            "edia/",
            "7) != 0)"
          ],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/media/",
            "7) == 0)"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "fname #%s#\\n\", __LINE__",
            "fname);",
            "got"
          ],
          "line": 436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame, \"/",
          "args": [
            "mp/\",",
            ") != 0)"
          ],
          "line": 434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/tmp/\",",
            ") == 0)"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g",
          "args": [],
          "line": 426
        },
        "resolved": true,
        "details": {
          "function_name": "filter_debug",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/seccomp.c",
          "lines": "31-85",
          "snippet": "void filter_debug(void) {\n\t// start filter\n\tstruct sock_filter filter[] = {\n\t\tVALIDATE_ARCHITECTURE,\n\t\tEXAMINE_SYSCALL\n\t};\n\n\t// print sizes\n\tprintf(\"SECCOMP Filter:\\n\");\n\tif (sfilter == NULL) {\n\t\tprintf(\"SECCOMP filter not allocated\\n\");\n\t\treturn;\n\t}\n\tif (sfilter_index < 4)\n\t\treturn;\n\t\n\t// test the start of the filter\n\tif (memcmp(sfilter, filter, sizeof(filter)) == 0) {\n\t\tprintf(\"  VALIDATE_ARCHITECTURE\\n\");\n\t\tprintf(\"  EXAMINE_SYSCAL\\n\");\n\t}\n\t\n\t// loop trough blacklists\n\tint i = 4;\n\twhile (i < sfilter_index) {\n\t\t// minimal parsing!\n\t\tunsigned char *ptr = (unsigned char *) &sfilter[i];\n\t\tint *nr = (int *) (ptr + 4);\n\t\tif (*ptr\t== 0x15 && *(ptr +14) == 0xff && *(ptr + 15) == 0x7f ) {\n\t\t\tprintf(\"  WHITELIST %d %s\\n\", *nr, syscall_find_nr(*nr));\n\t\t\ti += 2;\n\t\t}\n\t\telse if (*ptr\t== 0x15 && *(ptr +14) == 0 && *(ptr + 15) == 0) {\n\t\t\tprintf(\"  BLACKLIST %d %s\\n\", *nr, syscall_find_nr(*nr));\n\t\t\ti += 2;\n\t\t}\n\t\telse if (*ptr\t== 0x15 && *(ptr +14) == 0x5 && *(ptr + 15) == 0) {\n\t\t\tint err = *(ptr + 13) << 8 | *(ptr + 12);\n\t\t\tprintf(\"  ERRNO %d %s %d %s\\n\", *nr, syscall_find_nr(*nr), err, errno_find_nr(err));\n\t\t\ti += 2;\n\t\t}\n\t\telse if (*ptr == 0x06 && *(ptr +6) == 0 && *(ptr + 7) == 0 ) {\n\t\t\tprintf(\"  KILL_PROCESS\\n\");\n\t\t\ti++;\n\t\t}\n\t\telse if (*ptr == 0x06 && *(ptr +6) == 0xff && *(ptr + 7) == 0x7f ) {\n\t\t\tprintf(\"  RETURN_ALLOW\\n\");\n\t\t\ti++;\n\t\t}\n\t\telse {\n\t\t\tprintf(\"  UNKNOWN ENTRY!!!\\n\");\n\t\t\ti++;\n\t\t}\n\t}\n}",
          "includes": [
            "#include \"seccomp.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"seccomp.h\"\n#include \"firejail.h\"\n\nvoid filter_debug(void) {\n\t// start filter\n\tstruct sock_filter filter[] = {\n\t\tVALIDATE_ARCHITECTURE,\n\t\tEXAMINE_SYSCALL\n\t};\n\n\t// print sizes\n\tprintf(\"SECCOMP Filter:\\n\");\n\tif (sfilter == NULL) {\n\t\tprintf(\"SECCOMP filter not allocated\\n\");\n\t\treturn;\n\t}\n\tif (sfilter_index < 4)\n\t\treturn;\n\t\n\t// test the start of the filter\n\tif (memcmp(sfilter, filter, sizeof(filter)) == 0) {\n\t\tprintf(\"  VALIDATE_ARCHITECTURE\\n\");\n\t\tprintf(\"  EXAMINE_SYSCAL\\n\");\n\t}\n\t\n\t// loop trough blacklists\n\tint i = 4;\n\twhile (i < sfilter_index) {\n\t\t// minimal parsing!\n\t\tunsigned char *ptr = (unsigned char *) &sfilter[i];\n\t\tint *nr = (int *) (ptr + 4);\n\t\tif (*ptr\t== 0x15 && *(ptr +14) == 0xff && *(ptr + 15) == 0x7f ) {\n\t\t\tprintf(\"  WHITELIST %d %s\\n\", *nr, syscall_find_nr(*nr));\n\t\t\ti += 2;\n\t\t}\n\t\telse if (*ptr\t== 0x15 && *(ptr +14) == 0 && *(ptr + 15) == 0) {\n\t\t\tprintf(\"  BLACKLIST %d %s\\n\", *nr, syscall_find_nr(*nr));\n\t\t\ti += 2;\n\t\t}\n\t\telse if (*ptr\t== 0x15 && *(ptr +14) == 0x5 && *(ptr + 15) == 0) {\n\t\t\tint err = *(ptr + 13) << 8 | *(ptr + 12);\n\t\t\tprintf(\"  ERRNO %d %s %d %s\\n\", *nr, syscall_find_nr(*nr), err, errno_find_nr(err));\n\t\t\ti += 2;\n\t\t}\n\t\telse if (*ptr == 0x06 && *(ptr +6) == 0 && *(ptr + 7) == 0 ) {\n\t\t\tprintf(\"  KILL_PROCESS\\n\");\n\t\t\ti++;\n\t\t}\n\t\telse if (*ptr == 0x06 && *(ptr +6) == 0xff && *(ptr + 7) == 0x7f ) {\n\t\t\tprintf(\"  RETURN_ALLOW\\n\");\n\t\t\ti++;\n\t\t}\n\t\telse {\n\t\t\tprintf(\"  UNKNOWN ENTRY!!!\\n\");\n\t\t\ti++;\n\t\t}\n\t}\n}"
        }
      },
      {
        "call_info": {
          "callee": ", &s",
          "args": [
            "== 0",
            "&"
          ],
          "line": 426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ame, cf",
          "args": [
            ".home",
            "r, strlen(c",
            ".homedir)) != 0) {"
          ],
          "line": 423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ".homed",
          "args": [
            "r)) != 0) {"
          ],
          "line": 423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "fname #%s#, cfg.homedir #%s#\\n\",\n\t\t\t\t\t__L",
            "fname, c",
            ".home",
            "r);\n\n\t\t\t//"
          ],
          "line": 419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "moved",
          "args": [
            "hitelist path %s, --private option is present\\n\", entry->d",
            "a);\n\n\t\t\t\t*e"
          ],
          "line": 410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "cfg.home",
            "r, strlen(c",
            ".homedir)) == 0) {"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ".homed",
          "args": [
            "r)) == 0) {"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/srv/\",",
            ") == 0)"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/opt/\",",
            ") == 0)"
          ],
          "line": 397
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/dev/\",",
            ") == 0)"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/var/\",",
            ") == 0)"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/mnt/\",",
            ") == 0)"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/media/",
            "7) == 0)"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "\"/tmp/\",",
            ") == 0)"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "w_name,",
          "args": [
            "cfg.home",
            "r, strlen(c",
            ".homedir)) == 0) {"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ".homed",
          "args": [
            "r)) == 0) {"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alpath",
          "args": [
            ");\n\t\t\t}"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "p",
          "args": [
            "r"
          ],
          "line": 377
        },
        "resolved": true,
        "details": {
          "function_name": "path(ProfileEn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_whitelist.c",
          "lines": "176-310",
          "snippet": "d whitelist_path(ProfileEntry *entry) {\n\tassert(entry);\n\tchar *path = entry->data + 10;\n\tassert(path);\n\tconst char *fname;\n\tchar *wfile = NULL;\n\n\tif (entry->home_dir) {\n\t\tif (strncmp(path, cfg.homedir, strlen(cfg.homedir)) == 0) {\t\t\n\t\t\tfname = path + strlen(cfg.homedir);\n\t\t\tif (*fname == '\\0') {\n\t\t\t\tfprintf(stderr, \"Error: file %s is not in user home directory, exiting...\\n\", path);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tfname = path;\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_HOME_USER_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->tmp_dir) {\n\t\tfname = path + 4; // strlen(\"/tmp\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /tmp directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_TMP_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->media_dir) {\n\t\tfname = path + 6; // strlen(\"/media\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /media directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MEDIA_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->mnt_dir) {\n\t\tfname = path + 4; // strlen(\"/mnt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /mnt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MNT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->var_dir) {\n\t\tfname = path + 4; // strlen(\"/var\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /var directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_VAR_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->dev_dir) {\n\t\tfname = path + 4; // strlen(\"/dev\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /dev directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_DEV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->opt_dir) {\n\t\tfname = path + 4; // strlen(\"/opt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /opt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_OPT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->srv_dir) {\n\t\tfname = path + 4; // strlen(\"/srv\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /srv directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_SRV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\t// check if the file exists\n\tstruct stat s;\n\tif (wfile && stat(wfile, &s) == 0) {\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Whitelisting %s\\n\", path);\n\t}\n\telse {\n\t\treturn;\n\t}\n\t\n\t// create the path if necessary\n\tmkpath(path, s.st_mode);\n\tfs_logger2(\"whitelist\", path);\n\n\t// process directory\n\tif (S_ISDIR(s.st_mode)) {\t\n\t\t// create directory\n\t\tint rv = mkdir(path, 0755);\n\t\t(void) rv;\n\t}\n\t\n\t// process regular file\n\telse {\n\t\tif (access(path, R_OK)) {\n\t\t\t// create an empty file\n\t\t\tFILE *fp = fopen(path, \"w\");\n\t\t\tif (!fp) {\n\t\t\t\tfprintf(stderr, \"Error: cannot create empty file in home directory\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t// set file properties\n\t\t\tSET_PERMS_STREAM(fp, s.st_uid, s.st_gid, s.st_mode);\n\t\t\tfclose(fp);\n\t\t}\n\t\telse\n\t\t\treturn; // the file is already present\n\t}\n\t\n\t// mount\n\tif (mount(wfile, path, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\terrExit(\"mount bind\");\n\n\tfree(wfile);\n}\n\n\n// whit",
          "includes": [
            "#include <errno.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <glob.h>",
            "#include <fnmatch.h>",
            "#include <linux/limits.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <glob.h>\n#include <fnmatch.h>\n#include <linux/limits.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nd whitelist_path(ProfileEntry *entry) {\n\tassert(entry);\n\tchar *path = entry->data + 10;\n\tassert(path);\n\tconst char *fname;\n\tchar *wfile = NULL;\n\n\tif (entry->home_dir) {\n\t\tif (strncmp(path, cfg.homedir, strlen(cfg.homedir)) == 0) {\t\t\n\t\t\tfname = path + strlen(cfg.homedir);\n\t\t\tif (*fname == '\\0') {\n\t\t\t\tfprintf(stderr, \"Error: file %s is not in user home directory, exiting...\\n\", path);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tfname = path;\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_HOME_USER_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->tmp_dir) {\n\t\tfname = path + 4; // strlen(\"/tmp\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /tmp directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_TMP_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->media_dir) {\n\t\tfname = path + 6; // strlen(\"/media\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /media directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MEDIA_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->mnt_dir) {\n\t\tfname = path + 4; // strlen(\"/mnt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /mnt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MNT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->var_dir) {\n\t\tfname = path + 4; // strlen(\"/var\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /var directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_VAR_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->dev_dir) {\n\t\tfname = path + 4; // strlen(\"/dev\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /dev directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_DEV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->opt_dir) {\n\t\tfname = path + 4; // strlen(\"/opt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /opt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_OPT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->srv_dir) {\n\t\tfname = path + 4; // strlen(\"/srv\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /srv directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_SRV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\t// check if the file exists\n\tstruct stat s;\n\tif (wfile && stat(wfile, &s) == 0) {\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Whitelisting %s\\n\", path);\n\t}\n\telse {\n\t\treturn;\n\t}\n\t\n\t// create the path if necessary\n\tmkpath(path, s.st_mode);\n\tfs_logger2(\"whitelist\", path);\n\n\t// process directory\n\tif (S_ISDIR(s.st_mode)) {\t\n\t\t// create directory\n\t\tint rv = mkdir(path, 0755);\n\t\t(void) rv;\n\t}\n\t\n\t// process regular file\n\telse {\n\t\tif (access(path, R_OK)) {\n\t\t\t// create an empty file\n\t\t\tFILE *fp = fopen(path, \"w\");\n\t\t\tif (!fp) {\n\t\t\t\tfprintf(stderr, \"Error: cannot create empty file in home directory\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t// set file properties\n\t\t\tSET_PERMS_STREAM(fp, s.st_uid, s.st_gid, s.st_mode);\n\t\t\tfclose(fp);\n\t\t}\n\t\telse\n\t\t\treturn; // the file is already present\n\t}\n\t\n\t// mount\n\tif (mount(wfile, path, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\terrExit(\"mount bind\");\n\n\tfree(wfile);\n}\n\n\n// whit"
        }
      },
      {
        "call_info": {
          "callee": "\");ffl",
          "args": [
            "sh(0"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "real p",
          "args": [
            "th: (null)\\n\");\n\t\t\t\tpri"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "expand",
          "args": [
            "d: %s\\n\", new_name",
            "pri"
          ],
          "line": 375
        },
        "resolved": true,
        "details": {
          "function_name": "expand_home",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/util.c",
          "lines": "589-607",
          "snippet": "char *expand_home(const char *path, const char* homedir) {\n\tassert(path);\n\tassert(homedir);\n\n\t// Replace home macro\n\tchar *new_name = NULL;\n\tif (strncmp(path, \"${HOME}\", 7) == 0) {\n\t\tif (asprintf(&new_name, \"%s%s\", homedir, path + 7) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\treturn new_name;\n\t}\n\telse if (*path == '~') {\n\t\tif (asprintf(&new_name, \"%s%s\", homedir, path + 1) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\treturn new_name;\n\t}\n\n\treturn strdup(path);\n}",
          "includes": [
            "#include <sys/wait.h>",
            "#include <termios.h>",
            "#include <sys/ioctl.h>",
            "#include <grp.h>",
            "#include <dirent.h>",
            "#include <errno.h>",
            "#include <syslog.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <ftw.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/wait.h>\n#include <termios.h>\n#include <sys/ioctl.h>\n#include <grp.h>\n#include <dirent.h>\n#include <errno.h>\n#include <syslog.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <ftw.h>\n#include \"firejail.h\"\n\nchar *expand_home(const char *path, const char* homedir) {\n\tassert(path);\n\tassert(homedir);\n\n\t// Replace home macro\n\tchar *new_name = NULL;\n\tif (strncmp(path, \"${HOME}\", 7) == 0) {\n\t\tif (asprintf(&new_name, \"%s%s\", homedir, path + 7) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\treturn new_name;\n\t}\n\telse if (*path == '~') {\n\t\tif (asprintf(&new_name, \"%s%s\", homedir, path + 1) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\treturn new_name;\n\t}\n\n\treturn strdup(path);\n}"
        }
      },
      {
        "call_info": {
          "callee": "moved",
          "args": [
            "hitelist path: %s\\n\", entry->d",
            "a);\n\t\t\t\tpri"
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ew_name,",
          "args": [
            "NULL);",
            "f (!"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "\\n\", __LINE__",
            "goto"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "ebug %",
            "new_name #%s#\\n\", __LINE__",
            "new_name",
            "// v"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_name)",
          "args": [
            "if (a"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e(entry->da",
          "args": [
            "a + 10, cfg.home",
            "r);\n\t\tasser"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "**\\n\")",
            "con"
          ],
          "line": 349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "** \\tP",
            "ase create a proper Downloads directory for your application.\\n\");\n\t\t\t\tfpr"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "** \\tA",
            "file saved will be lost when the sandbox is closed.\\n\");\n\t\t\t\tfpr"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "** War",
            "ng: cannot whitelist Downloads directory\\n\");\n\t\t\t\tfpr"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "**\\n\")",
            "fpr"
          ],
          "line": 345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wnloads();\n\t\t\tif",
          "args": [],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ry->da",
          "args": [
            "a + 10, \"${DOWNL",
            "DS}\") == 0) {"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "try->da",
          "args": [
            "a, \"whiteli",
            "\", 10)) {",
            "en"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "edir);",
          "args": [
            "Profil"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <glob.h>\n#include <fnmatch.h>\n#include <linux/limits.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nitelist(void) {\n\tchar *homedir = cfg.homedir;\n\tassert(homedir);\n\tProfileEntry *entry = cfg.profile;\n\tif (!entry)\n\t\treturn;\n\n\tchar *new_name = NULL;\n\tint home_dir = 0;\t// /home/user directory flag\n\tint tmp_dir = 0;\t// /tmp directory flag\n\tint media_dir = 0;\t// /media directory flag\n\tint mnt_dir = 0;\t// /mnt directory flag\n\tint var_dir = 0;\t\t// /var directory flag\n\tint dev_dir = 0;\t\t// /dev directory flag\n\tint opt_dir = 0;\t\t// /opt directory flag\n        int srv_dir = 0;                // /srv directory flag\n\t// verify whitelist files, extract symbolic links, etc.\n\twhile (entry) {\n\t\t// handle only whitelist commands\n\t\tif (strncmp(entry->data, \"whitelist \", 10)) {\n\t\t\tentry = entry->next;\n\t\t\tcontinue;\n\t\t}\n\n\t\t// resolve ${DOWNLOADS}\n\t\tif (strcmp(entry->data + 10, \"${DOWNLOADS}\") == 0) {\n\t\t\tchar *tmp = resolve_downloads();\n\t\t\tif (tmp)\n\t\t\t\tentry->data = tmp;\n\t\t\telse {\n\t\t\t\t*entry->data = '\\0';\n\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\tfprintf(stderr, \"*** Warning: cannot whitelist Downloads directory\\n\");\n\t\t\t\tfprintf(stderr, \"*** \\tAny file saved will be lost when the sandbox is closed.\\n\");\n\t\t\t\tfprintf(stderr, \"*** \\tPlease create a proper Downloads directory for your application.\\n\");\n\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\tcontinue;\n\t\t\t}\n\t\t}\n\n\t\t// replace ~/ or ${HOME} into /home/username\n\t\tnew_name = expand_home(entry->data + 10, cfg.homedir);\n\t\tassert(new_name);\n\t\tif (arg_debug)\n\t\t\tfprintf(stderr, \"Debug %d: new_name #%s#\\n\", __LINE__, new_name);\n\n\t\t// valid path referenced to filesystem root\n\t\tif (*new_name != '/') {\n\t\t\tif (arg_debug)\n\t\t\t\tfprintf(stderr, \"Debug %d: \\n\", __LINE__);\n\t\t\tgoto errexit;\n\t\t}\n\n\n\t\t// extract the absolute path of the file\n\t\t// realpath function will fail with ENOENT if the file is not found\n\t\tchar *fname = realpath(new_name, NULL);\n\t\tif (!fname) {\n\t\t\t// file not found, blank the entry in the list and continue\n\t\t\tif (arg_debug || arg_debug_whitelists) {\n\t\t\t\tprintf(\"Removed whitelist path: %s\\n\", entry->data);\n\t\t\t\tprintf(\"\\texpanded: %s\\n\", new_name);\n\t\t\t\tprintf(\"\\treal path: (null)\\n\");\n\t\t\t\tprintf(\"\\t\");fflush(0);\n\t\t\t\tperror(\"realpath\");\n\t\t\t}\n\t\t\t*entry->data = '\\0';\n\n\t\t\t// if 1 the file was not found; mount an empty directory\n\t\t\tif (strncmp(new_name, cfg.homedir, strlen(cfg.homedir)) == 0) {\n\t\t\t\tif(!arg_private)\n\t\t\t\t\thome_dir = 1;\n\t\t\t}\n\t\t\telse if (strncmp(new_name, \"/tmp/\", 5) == 0)\n\t\t\t\ttmp_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/media/\", 7) == 0)\n\t\t\t\tmedia_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/mnt/\", 5) == 0)\n\t\t\t\tmnt_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/var/\", 5) == 0)\n\t\t\t\tvar_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/dev/\", 5) == 0)\n\t\t\t\tdev_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/opt/\", 5) == 0)\n\t\t\t\topt_dir = 1;\n\t\t\telse if (strncmp(new_name, \"/srv/\", 5) == 0)\n\t\t\t\topt_dir = 1;\n\t\t\t\n\t\t\tcontinue;\n\t\t}\n\t\t\n\t\t// check for supported directories\n\t\tif (strncmp(new_name, cfg.homedir, strlen(cfg.homedir)) == 0) {\n\t\t\t// whitelisting home directory is disabled if --private option is present\n\t\t\tif (arg_private) {\n\t\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\t\tprintf(\"Removed whitelist path %s, --private option is present\\n\", entry->data);\n\n\t\t\t\t*entry->data = '\\0';\n\t\t\t\tcontinue;\n\t\t\t}\n\n\t\t\tentry->home_dir = 1;\n\t\t\thome_dir = 1;\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#, cfg.homedir #%s#\\n\",\n\t\t\t\t\t__LINE__, fname, cfg.homedir);\n\n\t\t\t// both path and absolute path are under /home\n\t\t\tif (strncmp(fname, cfg.homedir, strlen(cfg.homedir)) != 0) {\n\t\t\t\t// check if the file is owned by the user\n\t\t\t\tstruct stat s;\n\t\t\t\tif (stat(fname, &s) == 0 && s.st_uid != getuid())\n\t\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/tmp/\", 5) == 0) {\n\t\t\tentry->tmp_dir = 1;\n\t\t\ttmp_dir = 1;\n\t\t\t// both path and absolute path are under /tmp\n\t\t\tif (strncmp(fname, \"/tmp/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/media/\", 7) == 0) {\n\t\t\tentry->media_dir = 1;\n\t\t\tmedia_dir = 1;\n\t\t\t// both path and absolute path are under /media\n\t\t\tif (strncmp(fname, \"/media/\", 7) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/mnt/\", 5) == 0) {\n\t\t\tentry->mnt_dir = 1;\n\t\t\tmnt_dir = 1;\n\t\t\t// both path and absolute path are under /mnt\n\t\t\tif (strncmp(fname, \"/mnt/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/var/\", 5) == 0) {\n\t\t\tentry->var_dir = 1;\n\t\t\tvar_dir = 1;\n\t\t\t// both path and absolute path are under /var\n\t\t\t// exceptions: /var/run and /var/lock\n\t\t\tif (strcmp(new_name, \"/var/run\")== 0)\n\t\t\t\t;\n\t\t\telse if (strcmp(new_name, \"/var/lock\")== 0)\n\t\t\t\t;\n\t\t\telse if (strncmp(fname, \"/var/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/dev/\", 5) == 0) {\n\t\t\tentry->dev_dir = 1;\n\t\t\tdev_dir = 1;\n\t\t\t// both path and absolute path are under /dev\n\t\t\tif (strncmp(fname, \"/dev/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/opt/\", 5) == 0) {\n\t\t\tentry->opt_dir = 1;\n\t\t\topt_dir = 1;\n\t\t\t// both path and absolute path are under /dev\n\t\t\tif (strncmp(fname, \"/opt/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse if (strncmp(new_name, \"/srv/\", 5) == 0) {\n\t\t\tentry->srv_dir = 1;\n\t\t\tsrv_dir = 1;\n\t\t\t// both path and absolute path are under /srv\n\t\t\tif (strncmp(fname, \"/srv/\", 5) != 0) {\n\t\t\t\tif (arg_debug)\n\t\t\t\t\tfprintf(stderr, \"Debug %d: fname #%s#\\n\", __LINE__, fname);\n\t\t\t\tgoto errexit;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (arg_debug)\n\t\t\t\tfprintf(stderr, \"Debug %d: \\n\", __LINE__);\n\t\t\tgoto errexit;\n\t\t}\n\n\t\t// mark symbolic links\n\t\tif (is_link(new_name))\n\t\t\tentry->link = new_name;\n\t\telse {\n\t\t\tfree(new_name);\n\t\t\tnew_name = NULL;\n\t\t}\n\n\t\t// change file name in entry->data\n\t\tif (strcmp(fname, entry->data + 10) != 0) {\n\t\t\tchar *newdata;\n\t\t\tif (asprintf(&newdata, \"whitelist %s\", fname) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tentry->data = newdata;\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Replaced whitelist path: %s\\n\", entry->data);\n\t\t}\n\t\tfree(fname);\n\t\tentry = entry->next;\n\t}\n\t\t\n\t// create mount points\n\tfs_build_mnt_dir();\n\t\n\n\t// /home/user\n\tif (home_dir) {\n\t\t// keep a copy of real home dir in RUN_WHITELIST_HOME_USER_DIR\n\t\tint rv = mkdir(RUN_WHITELIST_HOME_USER_DIR, 0755);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_HOME_USER_DIR, getuid(), getgid()) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_HOME_USER_DIR, 0755) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(cfg.homedir, RUN_WHITELIST_HOME_USER_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount a tmpfs and initialize /home/user\n\t\t fs_private();\n\t}\n\t\n\t// /tmp mountpoint\n\tif (tmp_dir) {\n\t\t// keep a copy of real /tmp directory in  \n\t\tint rv = mkdir(RUN_WHITELIST_TMP_DIR, 1777);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_TMP_DIR, 0, 0) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_TMP_DIR, 1777) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(\"/tmp\", RUN_WHITELIST_TMP_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount tmpfs on /tmp\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Mounting tmpfs on /tmp directory\\n\");\n\t\tif (mount(\"tmpfs\", \"/tmp\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=1777,gid=0\") < 0)\n\t\t\terrExit(\"mounting tmpfs on /tmp\");\n\t\tfs_logger(\"tmpfs /tmp\");\n\t}\n\t\n\t// /media mountpoint\n\tif (media_dir) {\n\t\t// some distros don't have a /media directory\n\t\tstruct stat s;\n\t\tif (stat(\"/media\", &s) == 0) {\n\t\t\t// keep a copy of real /media directory in RUN_WHITELIST_MEDIA_DIR\n\t\t\tint rv = mkdir(RUN_WHITELIST_MEDIA_DIR, 0755);\n\t\t\tif (rv == -1)\n\t\t\t\terrExit(\"mkdir\");\n\t\t\tif (chown(RUN_WHITELIST_MEDIA_DIR, 0, 0) < 0)\n\t\t\t\terrExit(\"chown\");\n\t\t\tif (chmod(RUN_WHITELIST_MEDIA_DIR, 0755) < 0)\n\t\t\t\terrExit(\"chmod\");\n\t\n\t\t\tif (mount(\"/media\", RUN_WHITELIST_MEDIA_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\t\terrExit(\"mount bind\");\n\t\n\t\t\t// mount tmpfs on /media\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Mounting tmpfs on /media directory\\n\");\n\t\t\tif (mount(\"tmpfs\", \"/media\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\t\terrExit(\"mounting tmpfs on /media\");\n\t\t\tfs_logger(\"tmpfs /media\");\n\t\t}\n\t\telse\n\t\t\tmedia_dir = 0;\n\t}\n\n\t// /mnt mountpoint\n\tif (mnt_dir) {\n\t\t// check if /mnt directory exists\n\t\tstruct stat s;\n\t\tif (stat(\"/mnt\", &s) == 0) {\n\t\t\t// keep a copy of real /mnt directory in RUN_WHITELIST_MNT_DIR\n\t\t\tint rv = mkdir(RUN_WHITELIST_MNT_DIR, 0755);\n\t\t\tif (rv == -1)\n\t\t\t\terrExit(\"mkdir\");\n\t\t\tif (chown(RUN_WHITELIST_MNT_DIR, 0, 0) < 0)\n\t\t\t\terrExit(\"chown\");\n\t\t\tif (chmod(RUN_WHITELIST_MNT_DIR, 0755) < 0)\n\t\t\t\terrExit(\"chmod\");\n\n\t\t\tif (mount(\"/mnt\", RUN_WHITELIST_MNT_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\t\terrExit(\"mount bind\");\n\n\t\t\t// mount tmpfs on /mnt\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Mounting tmpfs on /mnt directory\\n\");\n\t\t\tif (mount(\"tmpfs\", \"/mnt\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\t\terrExit(\"mounting tmpfs on /mnt\");\n\t\t\tfs_logger(\"tmpfs /mnt\");\n\t\t}\n\t\telse\n\t\t\tmnt_dir = 0;\n\t}\n\n\n\t// /var mountpoint\n\tif (var_dir) {\n\t\t// keep a copy of real /var directory in RUN_WHITELIST_VAR_DIR\n\t\tint rv = mkdir(RUN_WHITELIST_VAR_DIR, 0755);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_VAR_DIR, 0, 0) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_VAR_DIR, 0755) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(\"/var\", RUN_WHITELIST_VAR_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount tmpfs on /var\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Mounting tmpfs on /var directory\\n\");\n\t\tif (mount(\"tmpfs\", \"/var\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mounting tmpfs on /var\");\n\t\tfs_logger(\"tmpfs /var\");\n\t}\n\n\t// /dev mountpoint\n\tif (dev_dir) {\n\t\t// keep a copy of real /dev directory in RUN_WHITELIST_DEV_DIR\n\t\tint rv = mkdir(RUN_WHITELIST_DEV_DIR, 0755);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_DEV_DIR, 0, 0) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_DEV_DIR, 0755) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(\"/dev\", RUN_WHITELIST_DEV_DIR, NULL, MS_BIND|MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount tmpfs on /dev\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Mounting tmpfs on /dev directory\\n\");\n\t\tif (mount(\"tmpfs\", \"/dev\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mounting tmpfs on /dev\");\n\t\tfs_logger(\"tmpfs /dev\");\n\t}\n\n\t// /opt mountpoint\n\tif (opt_dir) {\n\t\t// keep a copy of real /opt directory in RUN_WHITELIST_OPT_DIR\n\t\tint rv = mkdir(RUN_WHITELIST_OPT_DIR, 0755);\n\t\tif (rv == -1)\n\t\t\terrExit(\"mkdir\");\n\t\tif (chown(RUN_WHITELIST_OPT_DIR, 0, 0) < 0)\n\t\t\terrExit(\"chown\");\n\t\tif (chmod(RUN_WHITELIST_OPT_DIR, 0755) < 0)\n\t\t\terrExit(\"chmod\");\n\t\n\t\tif (mount(\"/opt\", RUN_WHITELIST_OPT_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\terrExit(\"mount bind\");\n\t\n\t\t// mount tmpfs on /opt\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Mounting tmpfs on /opt directory\\n\");\n\t\tif (mount(\"tmpfs\", \"/opt\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mounting tmpfs on /opt\");\n\t\tfs_logger(\"tmpfs /opt\");\n\t}\n\n\t// /srv mountpoint\n\tif (srv_dir) {\n\t\t// check if /srv directory exists\n\t\tstruct stat s;\n\t\tif (stat(\"/srv\", &s) == 0) {\n\t\t\t// keep a copy of real /srv directory in RUN_WHITELIST_SRV_DIR\n\t\t\tint rv = mkdir(RUN_WHITELIST_SRV_DIR, 0755);\n\t\t\tif (rv == -1)\n\t\t\t\terrExit(\"mkdir\");\n\t\t\tif (chown(RUN_WHITELIST_SRV_DIR, 0, 0) < 0)\n\t\t\t\terrExit(\"chown\");\n\t\t\tif (chmod(RUN_WHITELIST_SRV_DIR, 0755) < 0)\n\t\t\t\terrExit(\"chmod\");\n\n\t\t\tif (mount(\"/srv\", RUN_WHITELIST_SRV_DIR, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\t\t\terrExit(\"mount bind\");\n\n\t\t\t// mount tmpfs on /srv\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Mounting tmpfs on /srv directory\\n\");\n\t\t\tif (mount(\"tmpfs\", \"/srv\", \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\t\terrExit(\"mounting tmpfs on /srv\");\n\t\t\tfs_logger(\"tmpfs /srv\");\n\t\t}\n\t\telse\n\t\t\tsrv_dir = 0;\n\t}\n\n\n\t\n\t// go through profile rules again, and interpret whitelist commands\n\tentry = cfg.profile;\n\twhile (entry) {\n\t\t// handle only whitelist commands\n\t\tif (strncmp(entry->data, \"whitelist \", 10)) {\n\t\t\tentry = entry->next;\n\t\t\tcontinue;\n\t\t}\n\n//printf(\"here %d#%s#\\n\", __LINE__, entry->data);\n\t\t// whitelist the real file\n\t\tif (strcmp(entry->data, \"whitelist /run\") == 0 && \n\t\t    (strcmp(entry->link, \"/var/run\") == 0 || strcmp(entry->link, \"/var/lock\") == 0)) {\n\t\t\tint rv = symlink(entry->data + 10, entry->link);\n\t\t\tif (rv)\n\t\t\t\tfprintf(stderr, \"Warning cannot create symbolic link %s\\n\", entry->link);\n\t\t\telse if (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Created symbolic link %s -> %s\\n\", entry->link, entry->data + 10);\n\t\t}\n\t\telse {\n\t\t\twhitelist_path(entry);\n\t\n\t\t\t// create the link if any\n\t\t\tif (entry->link) {\n\t\t\t\t// if the link is already there, do not bother\n\t\t\t\tstruct stat s;\n\t\t\t\tif (stat(entry->link, &s) != 0) {\n\t\t\t\t\t// create the path if necessary\n\t\t\t\t\tmkpath(entry->link, s.st_mode);\n\t\n\t\t\t\t\tint rv = symlink(entry->data + 10, entry->link);\n\t\t\t\t\tif (rv)\n\t\t\t\t\t\tfprintf(stderr, \"Warning cannot create symbolic link %s\\n\", entry->link);\n\t\t\t\t\telse if (arg_debug || arg_debug_whitelists)\n\t\t\t\t\t\tprintf(\"Created symbolic link %s -> %s\\n\", entry->link, entry->data + 10);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\tentry = entry->next;\n\t}\n\n\t// mask the real home directory, currently mounted on RUN_WHITELIST_HOME_DIR\n\tif (home_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_HOME_USER_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_HOME_USER_DIR);\n\t}\n\t\n\t// mask the real /tmp directory, currently mounted on RUN_WHITELIST_TMP_DIR\n\tif (tmp_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_TMP_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_TMP_DIR);\n\t}\n\n\t// mask the real /var directory, currently mounted on RUN_WHITELIST_VAR_DIR\n\tif (var_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_VAR_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_VAR_DIR);\n\t}\n\n\t// mask the real /opt directory, currently mounted on RUN_WHITELIST_OPT_DIR\n\tif (opt_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_OPT_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_OPT_DIR);\n\t}\n\n\t// mask the real /dev directory, currently mounted on RUN_WHITELIST_DEV_DIR\n\tif (dev_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_DEV_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_DEV_DIR);\n\t}\n\n\t// mask the real /media directory, currently mounted on RUN_WHITELIST_MEDIA_DIR\n\tif (media_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_MEDIA_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_MEDIA_DIR);\n\t}\n\n\t// mask the real /mnt directory, currently mounted on RUN_WHITELIST_MNT_DIR\n\tif (mnt_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_MNT_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_MNT_DIR);\n\t}\n\n\t// mask the real /srv directory, currently mounted on RUN_WHITELIST_SRV_DIR\n\tif (srv_dir) {\n\t\tif (mount(\"tmpfs\", RUN_WHITELIST_SRV_DIR, \"tmpfs\", MS_NOSUID | MS_STRICTATIME | MS_REC,  \"mode=755,gid=0\") < 0)\n\t\t\terrExit(\"mount tmpfs\");\n\t\tfs_logger2(\"tmpfs\", RUN_WHITELIST_SRV_DIR);\n\t}\n\n\tif (new_name)\n\t\tfree(new_name);\n\t\t\n\treturn;\n\nerrexit:\n\tfprintf(stderr, \"Error: invalid whitelist path %s\\n\", new_name);\n\texit(1);\n}"
  },
  {
    "function_name": "path(ProfileEn",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_whitelist.c",
    "lines": "176-310",
    "snippet": "d whitelist_path(ProfileEntry *entry) {\n\tassert(entry);\n\tchar *path = entry->data + 10;\n\tassert(path);\n\tconst char *fname;\n\tchar *wfile = NULL;\n\n\tif (entry->home_dir) {\n\t\tif (strncmp(path, cfg.homedir, strlen(cfg.homedir)) == 0) {\t\t\n\t\t\tfname = path + strlen(cfg.homedir);\n\t\t\tif (*fname == '\\0') {\n\t\t\t\tfprintf(stderr, \"Error: file %s is not in user home directory, exiting...\\n\", path);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tfname = path;\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_HOME_USER_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->tmp_dir) {\n\t\tfname = path + 4; // strlen(\"/tmp\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /tmp directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_TMP_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->media_dir) {\n\t\tfname = path + 6; // strlen(\"/media\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /media directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MEDIA_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->mnt_dir) {\n\t\tfname = path + 4; // strlen(\"/mnt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /mnt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MNT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->var_dir) {\n\t\tfname = path + 4; // strlen(\"/var\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /var directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_VAR_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->dev_dir) {\n\t\tfname = path + 4; // strlen(\"/dev\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /dev directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_DEV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->opt_dir) {\n\t\tfname = path + 4; // strlen(\"/opt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /opt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_OPT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->srv_dir) {\n\t\tfname = path + 4; // strlen(\"/srv\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /srv directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_SRV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\t// check if the file exists\n\tstruct stat s;\n\tif (wfile && stat(wfile, &s) == 0) {\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Whitelisting %s\\n\", path);\n\t}\n\telse {\n\t\treturn;\n\t}\n\t\n\t// create the path if necessary\n\tmkpath(path, s.st_mode);\n\tfs_logger2(\"whitelist\", path);\n\n\t// process directory\n\tif (S_ISDIR(s.st_mode)) {\t\n\t\t// create directory\n\t\tint rv = mkdir(path, 0755);\n\t\t(void) rv;\n\t}\n\t\n\t// process regular file\n\telse {\n\t\tif (access(path, R_OK)) {\n\t\t\t// create an empty file\n\t\t\tFILE *fp = fopen(path, \"w\");\n\t\t\tif (!fp) {\n\t\t\t\tfprintf(stderr, \"Error: cannot create empty file in home directory\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t// set file properties\n\t\t\tSET_PERMS_STREAM(fp, s.st_uid, s.st_gid, s.st_mode);\n\t\t\tfclose(fp);\n\t\t}\n\t\telse\n\t\t\treturn; // the file is already present\n\t}\n\t\n\t// mount\n\tif (mount(wfile, path, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\terrExit(\"mount bind\");\n\n\tfree(wfile);\n}\n\n\n// whit",
    "includes": [
      "#include <errno.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <glob.h>",
      "#include <fnmatch.h>",
      "#include <linux/limits.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": ");\n}",
          "args": [
            "//"
          ],
          "line": 309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ount bi",
          "args": [
            "d\");\n\n\tfree("
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e, pa",
          "args": [
            "h, NU",
            ", MS",
            "IND|",
            "_REC, NULL) <",
            "e"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ";\n\t\t}",
          "args": [
            "e"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREAM(fp, s.st_",
          "args": [
            "id",
            "s.st_gid",
            "s.st_mod",
            ";\n\t\t\tfclo"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "nnot create empty file in home directory\\n\");\n\t\t\t\texi"
          ],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ", \"w\"",
          "args": [
            ";",
            "f ("
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "h, R_O",
          "args": [
            ")) {",
            "//"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ", 075",
          "args": [
            ");",
            "void"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "st_mode",
          "args": [
            ") {\t\n\t\t//"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "(\"whitelis",
          "args": [
            "\", path);",
            "/ pr"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "h, s.s",
          "args": [
            "_mod",
            ";\n\tfs_log"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "itelis",
          "args": [
            "ing %s\\n\", path);",
            "els"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "filter_add_whitelist",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/seccomp.c",
          "lines": "143-168",
          "snippet": "static void filter_add_whitelist(int syscall, int arg) {\n\t(void) arg;\n\tassert(sfilter);\n\tassert(sfilter_alloc_size);\n\tassert(sfilter_index);\n//\tif (arg_debug)\n//\t\tprintf(\"Whitelisting syscall %d %s\\n\", syscall, syscall_find_nr(syscall));\n\t\n\tif ((sfilter_index + 2) > sfilter_alloc_size)\n\t\tfilter_realloc();\n\t\n\tstruct sock_filter filter[] = {\n\t\tWHITELIST(syscall)\n\t};\n#if 0\n{\n\tint i;\n\tunsigned char *ptr = (unsigned char *) &filter[0];\n\tfor (i = 0; i < sizeof(filter); i++, ptr++)\n\t\tprintf(\"%x, \", (*ptr) & 0xff);\n\tprintf(\"\\n\");\n}\n#endif\n\tmemcpy(&sfilter[sfilter_index], filter, sizeof(filter));\n\tsfilter_index += sizeof(filter) / sizeof(struct sock_filter);\t\n}",
          "includes": [
            "#include \"seccomp.h\"",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"seccomp.h\"\n#include \"firejail.h\"\n\nstatic void filter_add_whitelist(int syscall, int arg) {\n\t(void) arg;\n\tassert(sfilter);\n\tassert(sfilter_alloc_size);\n\tassert(sfilter_index);\n//\tif (arg_debug)\n//\t\tprintf(\"Whitelisting syscall %d %s\\n\", syscall, syscall_find_nr(syscall));\n\t\n\tif ((sfilter_index + 2) > sfilter_alloc_size)\n\t\tfilter_realloc();\n\t\n\tstruct sock_filter filter[] = {\n\t\tWHITELIST(syscall)\n\t};\n#if 0\n{\n\tint i;\n\tunsigned char *ptr = (unsigned char *) &filter[0];\n\tfor (i = 0; i < sizeof(filter); i++, ptr++)\n\t\tprintf(\"%x, \", (*ptr) & 0xff);\n\tprintf(\"\\n\");\n}\n#endif\n\tmemcpy(&sfilter[sfilter_index], filter, sizeof(filter));\n\tsfilter_index += sizeof(filter) / sizeof(struct sock_filter);\t\n}"
        }
      },
      {
        "call_info": {
          "callee": ", &s",
          "args": [
            "== 0",
            "{"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t}\n\t//"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wfile, \"",
          "args": [
            "s/%s\",",
            "UN_WHIT",
            "IST_SRV_DIR, fname) =",
            "-1)"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "le %s is not in /srv directory, exiting...\\n\", path);",
            "exit"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t}\n\tels"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wfile, \"",
          "args": [
            "s/%s\",",
            "UN_WHIT",
            "IST_OPT_DIR, fname) =",
            "-1)"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "le %s is not in /opt directory, exiting...\\n\", path);",
            "exit"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t}\n\tels"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wfile, \"",
          "args": [
            "s/%s\",",
            "UN_WHIT",
            "IST_DEV_DIR, fname) =",
            "-1)"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "le %s is not in /dev directory, exiting...\\n\", path);",
            "exit"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t}\n\tels"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wfile, \"",
          "args": [
            "s/%s\",",
            "UN_WHIT",
            "IST_VAR_DIR, fname) =",
            "-1)"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "le %s is not in /var directory, exiting...\\n\", path);",
            "exit"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t}\n\tels"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wfile, \"",
          "args": [
            "s/%s\",",
            "UN_WHIT",
            "IST_MNT_DIR, fname) =",
            "-1)"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "le %s is not in /mnt directory, exiting...\\n\", path);",
            "exit"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t}\n\tels"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wfile, \"",
          "args": [
            "s/%s\",",
            "UN_WHIT",
            "IST_MEDIA_DIR, fname) =",
            "-1)"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "le %s is not in /media directory, exiting...\\n\", path);",
            "exit"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t}\n\tels"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wfile, \"",
          "args": [
            "s/%s\",",
            "UN_WHIT",
            "IST_TMP_DIR, fname) =",
            "-1)"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "le %s is not in /tmp directory, exiting...\\n\", path);",
            "exit"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t}\n\tels"
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wfile, \"",
          "args": [
            "s/%s\",",
            "UN_WHIT",
            "IST_HOME_USER_DIR, fname) =",
            "-1)"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "}",
          "args": [],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "rror:",
            "le %s is not in user home directory, exiting...\\n\", path);",
            "exi"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ".homed",
          "args": [
            "r);\n\t\t\tif ("
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "th, cfg",
          "args": [
            "home",
            "r, strlen(c",
            ".homedir)) == 0) {"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ".homed",
          "args": [
            "r)) == 0) {"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "h);\n\tc",
          "args": [
            "nst"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ry);",
          "args": [
            "har *"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <glob.h>\n#include <fnmatch.h>\n#include <linux/limits.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nd whitelist_path(ProfileEntry *entry) {\n\tassert(entry);\n\tchar *path = entry->data + 10;\n\tassert(path);\n\tconst char *fname;\n\tchar *wfile = NULL;\n\n\tif (entry->home_dir) {\n\t\tif (strncmp(path, cfg.homedir, strlen(cfg.homedir)) == 0) {\t\t\n\t\t\tfname = path + strlen(cfg.homedir);\n\t\t\tif (*fname == '\\0') {\n\t\t\t\tfprintf(stderr, \"Error: file %s is not in user home directory, exiting...\\n\", path);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tfname = path;\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_HOME_USER_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->tmp_dir) {\n\t\tfname = path + 4; // strlen(\"/tmp\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /tmp directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_TMP_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->media_dir) {\n\t\tfname = path + 6; // strlen(\"/media\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /media directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MEDIA_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->mnt_dir) {\n\t\tfname = path + 4; // strlen(\"/mnt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /mnt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MNT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->var_dir) {\n\t\tfname = path + 4; // strlen(\"/var\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /var directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_VAR_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->dev_dir) {\n\t\tfname = path + 4; // strlen(\"/dev\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /dev directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_DEV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->opt_dir) {\n\t\tfname = path + 4; // strlen(\"/opt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /opt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_OPT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->srv_dir) {\n\t\tfname = path + 4; // strlen(\"/srv\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /srv directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_SRV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\t// check if the file exists\n\tstruct stat s;\n\tif (wfile && stat(wfile, &s) == 0) {\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Whitelisting %s\\n\", path);\n\t}\n\telse {\n\t\treturn;\n\t}\n\t\n\t// create the path if necessary\n\tmkpath(path, s.st_mode);\n\tfs_logger2(\"whitelist\", path);\n\n\t// process directory\n\tif (S_ISDIR(s.st_mode)) {\t\n\t\t// create directory\n\t\tint rv = mkdir(path, 0755);\n\t\t(void) rv;\n\t}\n\t\n\t// process regular file\n\telse {\n\t\tif (access(path, R_OK)) {\n\t\t\t// create an empty file\n\t\t\tFILE *fp = fopen(path, \"w\");\n\t\t\tif (!fp) {\n\t\t\t\tfprintf(stderr, \"Error: cannot create empty file in home directory\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t// set file properties\n\t\t\tSET_PERMS_STREAM(fp, s.st_uid, s.st_gid, s.st_mode);\n\t\t\tfclose(fp);\n\t\t}\n\t\telse\n\t\t\treturn; // the file is already present\n\t}\n\t\n\t// mount\n\tif (mount(wfile, path, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\terrExit(\"mount bind\");\n\n\tfree(wfile);\n}\n\n\n// whit"
  },
  {
    "function_name": "st cha",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_whitelist.c",
    "lines": "130-174",
    "snippet": "mkpath(const char* path, mode_t mode) {\n\tassert(path && *path);\n\t\n\tmode |= 0111;\n\n\t// create directories with uid/gid as root or as current user if inside home directory\n\tuid_t uid = getuid();\n\tgid_t gid = getgid();\n\tif (strncmp(path, cfg.homedir, strlen(cfg.homedir)) != 0) {\n\t\tuid = 0;\n\t\tgid = 0;\n\t}\n\n\t// work on a copy of the path\n\tchar *file_path = strdup(path);\n\tif (!file_path)\n\t\terrExit(\"strdup\");\n\n\tchar* p;\n\tint done = 0;\n\tfor (p=strchr(file_path+1, '/'); p; p=strchr(p+1, '/')) {\n\t\t*p='\\0';\n\t\tif (mkdir(file_path, mode)==-1) {\n\t\t\tif (errno != EEXIST) {\n\t\t\t\t*p='/';\n\t\t\t\tfree(file_path);\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (chmod(file_path, mode) == -1)\n\t\t\t\terrExit(\"chmod\");\n\t\t\tif (chown(file_path, uid, gid) == -1)\n\t\t\t\terrExit(\"chown\");\n\t\t\tdone = 1;\n\t\t}\t\t\t\n\n\t\t*p='/';\n\t}\n\tif (done)\n\t\tfs_logger2(\"mkpath\", path);\n\t\n\tfree(file_path);\n\treturn 0;\n}\n\nstatic v",
    "includes": [
      "#include <errno.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <glob.h>",
      "#include <fnmatch.h>",
      "#include <linux/limits.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "path",
          "args": [
            ";\n\treturn"
          ],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "path(ProfileEn",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_whitelist.c",
          "lines": "176-310",
          "snippet": "d whitelist_path(ProfileEntry *entry) {\n\tassert(entry);\n\tchar *path = entry->data + 10;\n\tassert(path);\n\tconst char *fname;\n\tchar *wfile = NULL;\n\n\tif (entry->home_dir) {\n\t\tif (strncmp(path, cfg.homedir, strlen(cfg.homedir)) == 0) {\t\t\n\t\t\tfname = path + strlen(cfg.homedir);\n\t\t\tif (*fname == '\\0') {\n\t\t\t\tfprintf(stderr, \"Error: file %s is not in user home directory, exiting...\\n\", path);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tfname = path;\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_HOME_USER_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->tmp_dir) {\n\t\tfname = path + 4; // strlen(\"/tmp\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /tmp directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_TMP_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->media_dir) {\n\t\tfname = path + 6; // strlen(\"/media\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /media directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MEDIA_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->mnt_dir) {\n\t\tfname = path + 4; // strlen(\"/mnt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /mnt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MNT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->var_dir) {\n\t\tfname = path + 4; // strlen(\"/var\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /var directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_VAR_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->dev_dir) {\n\t\tfname = path + 4; // strlen(\"/dev\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /dev directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_DEV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->opt_dir) {\n\t\tfname = path + 4; // strlen(\"/opt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /opt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_OPT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->srv_dir) {\n\t\tfname = path + 4; // strlen(\"/srv\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /srv directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_SRV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\t// check if the file exists\n\tstruct stat s;\n\tif (wfile && stat(wfile, &s) == 0) {\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Whitelisting %s\\n\", path);\n\t}\n\telse {\n\t\treturn;\n\t}\n\t\n\t// create the path if necessary\n\tmkpath(path, s.st_mode);\n\tfs_logger2(\"whitelist\", path);\n\n\t// process directory\n\tif (S_ISDIR(s.st_mode)) {\t\n\t\t// create directory\n\t\tint rv = mkdir(path, 0755);\n\t\t(void) rv;\n\t}\n\t\n\t// process regular file\n\telse {\n\t\tif (access(path, R_OK)) {\n\t\t\t// create an empty file\n\t\t\tFILE *fp = fopen(path, \"w\");\n\t\t\tif (!fp) {\n\t\t\t\tfprintf(stderr, \"Error: cannot create empty file in home directory\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t// set file properties\n\t\t\tSET_PERMS_STREAM(fp, s.st_uid, s.st_gid, s.st_mode);\n\t\t\tfclose(fp);\n\t\t}\n\t\telse\n\t\t\treturn; // the file is already present\n\t}\n\t\n\t// mount\n\tif (mount(wfile, path, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\terrExit(\"mount bind\");\n\n\tfree(wfile);\n}\n\n\n// whit",
          "includes": [
            "#include <errno.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <glob.h>",
            "#include <fnmatch.h>",
            "#include <linux/limits.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include \"firejail.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <errno.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <glob.h>\n#include <fnmatch.h>\n#include <linux/limits.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nd whitelist_path(ProfileEntry *entry) {\n\tassert(entry);\n\tchar *path = entry->data + 10;\n\tassert(path);\n\tconst char *fname;\n\tchar *wfile = NULL;\n\n\tif (entry->home_dir) {\n\t\tif (strncmp(path, cfg.homedir, strlen(cfg.homedir)) == 0) {\t\t\n\t\t\tfname = path + strlen(cfg.homedir);\n\t\t\tif (*fname == '\\0') {\n\t\t\t\tfprintf(stderr, \"Error: file %s is not in user home directory, exiting...\\n\", path);\n\t\t\t\texit(1);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t\tfname = path;\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_HOME_USER_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->tmp_dir) {\n\t\tfname = path + 4; // strlen(\"/tmp\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /tmp directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_TMP_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->media_dir) {\n\t\tfname = path + 6; // strlen(\"/media\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /media directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MEDIA_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->mnt_dir) {\n\t\tfname = path + 4; // strlen(\"/mnt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /mnt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_MNT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->var_dir) {\n\t\tfname = path + 4; // strlen(\"/var\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /var directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_VAR_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->dev_dir) {\n\t\tfname = path + 4; // strlen(\"/dev\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /dev directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_DEV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->opt_dir) {\n\t\tfname = path + 4; // strlen(\"/opt\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /opt directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\t\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_OPT_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\telse if (entry->srv_dir) {\n\t\tfname = path + 4; // strlen(\"/srv\")\n\t\tif (*fname == '\\0') {\n\t\t\tfprintf(stderr, \"Error: file %s is not in /srv directory, exiting...\\n\", path);\n\t\t\texit(1);\n\t\t}\n\n\t\tif (asprintf(&wfile, \"%s/%s\", RUN_WHITELIST_SRV_DIR, fname) == -1)\n\t\t\terrExit(\"asprintf\");\n\t}\n\t// check if the file exists\n\tstruct stat s;\n\tif (wfile && stat(wfile, &s) == 0) {\n\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\tprintf(\"Whitelisting %s\\n\", path);\n\t}\n\telse {\n\t\treturn;\n\t}\n\t\n\t// create the path if necessary\n\tmkpath(path, s.st_mode);\n\tfs_logger2(\"whitelist\", path);\n\n\t// process directory\n\tif (S_ISDIR(s.st_mode)) {\t\n\t\t// create directory\n\t\tint rv = mkdir(path, 0755);\n\t\t(void) rv;\n\t}\n\t\n\t// process regular file\n\telse {\n\t\tif (access(path, R_OK)) {\n\t\t\t// create an empty file\n\t\t\tFILE *fp = fopen(path, \"w\");\n\t\t\tif (!fp) {\n\t\t\t\tfprintf(stderr, \"Error: cannot create empty file in home directory\\n\");\n\t\t\t\texit(1);\n\t\t\t}\n\t\t\t// set file properties\n\t\t\tSET_PERMS_STREAM(fp, s.st_uid, s.st_gid, s.st_mode);\n\t\t\tfclose(fp);\n\t\t}\n\t\telse\n\t\t\treturn; // the file is already present\n\t}\n\t\n\t// mount\n\tif (mount(wfile, path, NULL, MS_BIND|MS_REC, NULL) < 0)\n\t\terrExit(\"mount bind\");\n\n\tfree(wfile);\n}\n\n\n// whit"
        }
      },
      {
        "call_info": {
          "callee": "(\"mkpath\",",
          "args": [
            "path);",
            "free"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hown\");",
          "args": [
            "done"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_path",
          "args": [
            "uid, gid",
            "==",
            ")"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hmod\");",
          "args": [
            "if ("
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_path",
          "args": [
            "mode) ==",
            "1)"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_path",
          "args": [
            "mode)==-",
            "{"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ", '/')",
          "args": [
            "{",
            "*p="
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e_path",
          "args": [
            "1, '/'); p;",
            "=st"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trdup\")",
          "args": [
            "char*"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "h);\n\ti",
          "args": [
            "(!f"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "th, cfg",
          "args": [
            "home",
            "r, strlen(c",
            ".homedir)) != 0) {"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ".homed",
          "args": [
            "r)) != 0) {"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "if (s",
          "args": [],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gid_t",
          "args": [],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "h && *",
          "args": [
            "ath);\n\t\n\tmode"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <glob.h>\n#include <fnmatch.h>\n#include <linux/limits.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nmkpath(const char* path, mode_t mode) {\n\tassert(path && *path);\n\t\n\tmode |= 0111;\n\n\t// create directories with uid/gid as root or as current user if inside home directory\n\tuid_t uid = getuid();\n\tgid_t gid = getgid();\n\tif (strncmp(path, cfg.homedir, strlen(cfg.homedir)) != 0) {\n\t\tuid = 0;\n\t\tgid = 0;\n\t}\n\n\t// work on a copy of the path\n\tchar *file_path = strdup(path);\n\tif (!file_path)\n\t\terrExit(\"strdup\");\n\n\tchar* p;\n\tint done = 0;\n\tfor (p=strchr(file_path+1, '/'); p; p=strchr(p+1, '/')) {\n\t\t*p='\\0';\n\t\tif (mkdir(file_path, mode)==-1) {\n\t\t\tif (errno != EEXIST) {\n\t\t\t\t*p='/';\n\t\t\t\tfree(file_path);\n\t\t\t\treturn -1;\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tif (chmod(file_path, mode) == -1)\n\t\t\t\terrExit(\"chmod\");\n\t\t\tif (chown(file_path, uid, gid) == -1)\n\t\t\t\terrExit(\"chown\");\n\t\t\tdone = 1;\n\t\t}\t\t\t\n\n\t\t*p='/';\n\t}\n\tif (done)\n\t\tfs_logger2(\"mkpath\", path);\n\t\n\tfree(file_path);\n\treturn 0;\n}\n\nstatic v"
  },
  {
    "function_name": "wnloads(void) {",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_whitelist.c",
    "lines": "38-128",
    "snippet": "r *resolve_downloads(void) {\n\tchar *fname;\n\tstruct stat s;\n\n\t// try a well known download directory name\n\tint i = 0;\n\twhile (dentry[i] != NULL) {\n\t\tif (asprintf(&fname, \"%s/%s\", cfg.homedir, dentry[i]) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\t\n\t\tif (stat(fname, &s) == 0) {\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Downloads directory resolved as \\\"%s\\\"\\n\", fname);\n\t\t\t\n\t\t\tchar *rv;\n\t\t\tif (asprintf(&rv, \"whitelist ~/%s\", dentry[i]) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tfree(fname);\n\t\t\treturn rv;\n\t\t}\n\t\tfree(fname);\n\t\ti++;\n\t}\n\n\t// try a name form ~/.config/user-dirs.dirs\n\tif (asprintf(&fname, \"%s/.config/user-dirs.dirs\", cfg.homedir) == -1)\n\t\terrExit(\"asprintf\");\n\tFILE *fp = fopen(fname, \"r\");\n\tif (!fp) {\n\t\tfree(fname);\n\t\treturn NULL;\n\t}\t\t\n\tfree(fname);\n\t\n\t// extract downloads directory\n\tchar buf[MAXBUF];\n\twhile (fgets(buf, MAXBUF, fp)) {\n\t\tchar *ptr = buf;\n\t\t\n\t\t// skip blanks\n\t\twhile (*ptr == ' ' || *ptr == '\\t')\n\t\t\tptr++;\n\t\tif (*ptr == '\\0' || *ptr == '\\n' || *ptr == '#')\n\t\t\tcontinue;\n\n\t\tif (strncmp(ptr, \"XDG_DOWNLOAD_DIR=\\\"$HOME/\", 24) == 0) {\n\t\t\tchar *ptr1 = ptr + 24;\n\t\t\tchar *ptr2 = strchr(ptr1, '\"');\n\t\t\tif (ptr2) {\n\t\t\t\tfclose(fp);\n\t\t\t\t*ptr2 = '\\0';\n\t\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\t\tprintf(\"extracted %s from ~/.config/user-dirs.dirs\\n\", ptr1);\n\t\t\t\tif (strlen(ptr1) != 0) {\n\t\t\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\t\t\tprintf(\"Downloads directory resolved as \\\"%s\\\"\\n\", ptr1);\n\t\t\t\t\n\t\t\t\t\tif (asprintf(&fname, \"%s/%s\", cfg.homedir, ptr1) == -1)\n\t\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\t\t\n\t\t\t\t\tif (stat(fname, &s) == -1) {\n\t\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"*** Error: directory %s not found.\\n\", fname);\n\t\t\t\t\t\tfprintf(stderr, \"*** \\tThis directory is configured in ~/.config/user-dirs.dirs.\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"*** \\tPlease create a Downloads directory.\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\t\tfree(fname);\n\t\t\t\t\t\treturn NULL;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tchar *rv;\n\t\t\t\t\tif (asprintf(&rv, \"whitelist ~/%s\", ptr + 24) == -1)\n\t\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\t\treturn rv;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\tfprintf(stderr, \"*** Error: invalid XDG_DOWNLOAD_DIR entry in ~/.config/user-dirs.dirs.\\n\");\n\t\t\t\t\tfprintf(stderr, \"*** \\tPlease specify a valid Downloads directory, example:\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\t\\tXDG_DOWNLOAD_DIR=\\\"$HOME/Downloads\\\"\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfclose(fp);\n\t\n\treturn NULL;\n}\n\nstatic i",
    "includes": [
      "#include <errno.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <glob.h>",
      "#include <fnmatch.h>",
      "#include <linux/limits.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include \"firejail.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static char *dentry[] = {\n\t\"Downloads\",\n\t\"\",\n\t\"Tlchargement\",\n\tNULL\n};\n\n#define"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": ";\n\t\n\tr",
          "args": [
            "tu"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "**\\n\")",
            "re"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "**\\t\\t",
            "G_DOWNLOAD_DIR=\\\"$HOME/Downloads\\\"\\n\");\n\t\t\t\t\tfp"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "**\\n\")",
            "fp"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "** \\tP",
            "ase specify a valid Downloads directory, example:\\n\");\n\t\t\t\t\tfp"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "** Err",
            ": invalid XDG_DOWNLOAD_DIR entry in ~/.config/user-dirs.dirs.\\n\");\n\t\t\t\t\tfp"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "**\\n\")",
            "fp"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t\t\t\t\tre"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rv, \"whi",
          "args": [
            "eli",
            "~/%s\", ptr + 24",
            "== -1)"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ");",
          "args": [
            "r"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "**\\n\")",
            "f"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "** \\tP",
            "ase create a Downloads directory.\\n\");\n\t\t\t\t\t\tf"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "** \\tT",
            "s directory is configured in ~/.config/user-dirs.dirs.\\n\");\n\t\t\t\t\t\tf"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "** Err",
            ": directory %s not found.\\n\", fname);",
            "f"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "derr, \"",
          "args": [
            "**\\n\")",
            "f"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ", &s",
          "args": [
            "== -",
            "{"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname, \"",
          "args": [
            "s/%s\",",
            "fg.home",
            "r, ptr1) ==",
            "1)"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wnload",
          "args": [
            "directory resolved as \\\"%s\\\"\\n\", ptr1);"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "wnloads(void) {",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-5940/repo/src/firejail/fs_whitelist.c",
          "lines": "38-128",
          "snippet": "r *resolve_downloads(void) {\n\tchar *fname;\n\tstruct stat s;\n\n\t// try a well known download directory name\n\tint i = 0;\n\twhile (dentry[i] != NULL) {\n\t\tif (asprintf(&fname, \"%s/%s\", cfg.homedir, dentry[i]) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\t\n\t\tif (stat(fname, &s) == 0) {\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Downloads directory resolved as \\\"%s\\\"\\n\", fname);\n\t\t\t\n\t\t\tchar *rv;\n\t\t\tif (asprintf(&rv, \"whitelist ~/%s\", dentry[i]) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tfree(fname);\n\t\t\treturn rv;\n\t\t}\n\t\tfree(fname);\n\t\ti++;\n\t}\n\n\t// try a name form ~/.config/user-dirs.dirs\n\tif (asprintf(&fname, \"%s/.config/user-dirs.dirs\", cfg.homedir) == -1)\n\t\terrExit(\"asprintf\");\n\tFILE *fp = fopen(fname, \"r\");\n\tif (!fp) {\n\t\tfree(fname);\n\t\treturn NULL;\n\t}\t\t\n\tfree(fname);\n\t\n\t// extract downloads directory\n\tchar buf[MAXBUF];\n\twhile (fgets(buf, MAXBUF, fp)) {\n\t\tchar *ptr = buf;\n\t\t\n\t\t// skip blanks\n\t\twhile (*ptr == ' ' || *ptr == '\\t')\n\t\t\tptr++;\n\t\tif (*ptr == '\\0' || *ptr == '\\n' || *ptr == '#')\n\t\t\tcontinue;\n\n\t\tif (strncmp(ptr, \"XDG_DOWNLOAD_DIR=\\\"$HOME/\", 24) == 0) {\n\t\t\tchar *ptr1 = ptr + 24;\n\t\t\tchar *ptr2 = strchr(ptr1, '\"');\n\t\t\tif (ptr2) {\n\t\t\t\tfclose(fp);\n\t\t\t\t*ptr2 = '\\0';\n\t\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\t\tprintf(\"extracted %s from ~/.config/user-dirs.dirs\\n\", ptr1);\n\t\t\t\tif (strlen(ptr1) != 0) {\n\t\t\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\t\t\tprintf(\"Downloads directory resolved as \\\"%s\\\"\\n\", ptr1);\n\t\t\t\t\n\t\t\t\t\tif (asprintf(&fname, \"%s/%s\", cfg.homedir, ptr1) == -1)\n\t\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\t\t\n\t\t\t\t\tif (stat(fname, &s) == -1) {\n\t\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"*** Error: directory %s not found.\\n\", fname);\n\t\t\t\t\t\tfprintf(stderr, \"*** \\tThis directory is configured in ~/.config/user-dirs.dirs.\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"*** \\tPlease create a Downloads directory.\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\t\tfree(fname);\n\t\t\t\t\t\treturn NULL;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tchar *rv;\n\t\t\t\t\tif (asprintf(&rv, \"whitelist ~/%s\", ptr + 24) == -1)\n\t\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\t\treturn rv;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\tfprintf(stderr, \"*** Error: invalid XDG_DOWNLOAD_DIR entry in ~/.config/user-dirs.dirs.\\n\");\n\t\t\t\t\tfprintf(stderr, \"*** \\tPlease specify a valid Downloads directory, example:\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\t\\tXDG_DOWNLOAD_DIR=\\\"$HOME/Downloads\\\"\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfclose(fp);\n\t\n\treturn NULL;\n}\n\nstatic i",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "1) !=",
          "args": [
            ") {"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tracte",
          "args": [
            "%s from ~/.config/user-dirs.dirs\\n\", ptr1);",
            "if"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ";",
          "args": [
            "pt"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "1, '\"'",
          "args": [
            ";",
            "f ("
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r, \"XDG",
          "args": [
            "DOW",
            "OAD_DIR=\\\"$HOME/\", 24) == 0",
            "{"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAXB",
          "args": [
            "F,",
            ")) {",
            "ha"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ");",
          "args": [
            "// e"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ");",
          "args": [
            "retur"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "e, \"r",
          "args": [
            ");\n\ti",
            "(!f"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\tFILE *"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname, \"",
          "args": [
            "s/.con",
            "g/user-dirs.dirs\", cfg.home",
            "r) == -1)"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ");",
          "args": [
            "i++;"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ");",
          "args": [
            "retu"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t\t\tfree"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rv, \"whi",
          "args": [
            "eli",
            "~/%s\", dentry[i",
            "== -1)"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": ", &s",
          "args": [
            "== 0",
            "{"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            ");\n\t\t\n\t\tif"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname, \"",
          "args": [
            "s/%s\",",
            "fg.home",
            "r, dentry[i",
            "== -1)"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <errno.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <glob.h>\n#include <fnmatch.h>\n#include <linux/limits.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include \"firejail.h\"\n\nstatic char *dentry[] = {\n\t\"Downloads\",\n\t\"\",\n\t\"Tlchargement\",\n\tNULL\n};\n\n#define;\n\nr *resolve_downloads(void) {\n\tchar *fname;\n\tstruct stat s;\n\n\t// try a well known download directory name\n\tint i = 0;\n\twhile (dentry[i] != NULL) {\n\t\tif (asprintf(&fname, \"%s/%s\", cfg.homedir, dentry[i]) == -1)\n\t\t\terrExit(\"asprintf\");\n\t\t\n\t\tif (stat(fname, &s) == 0) {\n\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\tprintf(\"Downloads directory resolved as \\\"%s\\\"\\n\", fname);\n\t\t\t\n\t\t\tchar *rv;\n\t\t\tif (asprintf(&rv, \"whitelist ~/%s\", dentry[i]) == -1)\n\t\t\t\terrExit(\"asprintf\");\n\t\t\tfree(fname);\n\t\t\treturn rv;\n\t\t}\n\t\tfree(fname);\n\t\ti++;\n\t}\n\n\t// try a name form ~/.config/user-dirs.dirs\n\tif (asprintf(&fname, \"%s/.config/user-dirs.dirs\", cfg.homedir) == -1)\n\t\terrExit(\"asprintf\");\n\tFILE *fp = fopen(fname, \"r\");\n\tif (!fp) {\n\t\tfree(fname);\n\t\treturn NULL;\n\t}\t\t\n\tfree(fname);\n\t\n\t// extract downloads directory\n\tchar buf[MAXBUF];\n\twhile (fgets(buf, MAXBUF, fp)) {\n\t\tchar *ptr = buf;\n\t\t\n\t\t// skip blanks\n\t\twhile (*ptr == ' ' || *ptr == '\\t')\n\t\t\tptr++;\n\t\tif (*ptr == '\\0' || *ptr == '\\n' || *ptr == '#')\n\t\t\tcontinue;\n\n\t\tif (strncmp(ptr, \"XDG_DOWNLOAD_DIR=\\\"$HOME/\", 24) == 0) {\n\t\t\tchar *ptr1 = ptr + 24;\n\t\t\tchar *ptr2 = strchr(ptr1, '\"');\n\t\t\tif (ptr2) {\n\t\t\t\tfclose(fp);\n\t\t\t\t*ptr2 = '\\0';\n\t\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\t\tprintf(\"extracted %s from ~/.config/user-dirs.dirs\\n\", ptr1);\n\t\t\t\tif (strlen(ptr1) != 0) {\n\t\t\t\t\tif (arg_debug || arg_debug_whitelists)\n\t\t\t\t\t\tprintf(\"Downloads directory resolved as \\\"%s\\\"\\n\", ptr1);\n\t\t\t\t\n\t\t\t\t\tif (asprintf(&fname, \"%s/%s\", cfg.homedir, ptr1) == -1)\n\t\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\t\t\n\t\t\t\t\tif (stat(fname, &s) == -1) {\n\t\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"*** Error: directory %s not found.\\n\", fname);\n\t\t\t\t\t\tfprintf(stderr, \"*** \\tThis directory is configured in ~/.config/user-dirs.dirs.\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"*** \\tPlease create a Downloads directory.\\n\");\n\t\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\t\tfree(fname);\n\t\t\t\t\t\treturn NULL;\n\t\t\t\t\t}\n\t\t\t\t\n\t\t\t\t\tchar *rv;\n\t\t\t\t\tif (asprintf(&rv, \"whitelist ~/%s\", ptr + 24) == -1)\n\t\t\t\t\t\terrExit(\"asprintf\");\n\t\t\t\t\treturn rv;\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\tfprintf(stderr, \"*** Error: invalid XDG_DOWNLOAD_DIR entry in ~/.config/user-dirs.dirs.\\n\");\n\t\t\t\t\tfprintf(stderr, \"*** \\tPlease specify a valid Downloads directory, example:\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\t\\tXDG_DOWNLOAD_DIR=\\\"$HOME/Downloads\\\"\\n\");\n\t\t\t\t\tfprintf(stderr, \"***\\n\");\n\t\t\t\t\treturn NULL;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\tfclose(fp);\n\t\n\treturn NULL;\n}\n\nstatic i"
  }
]