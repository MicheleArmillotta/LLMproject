[
  {
    "function_name": "rb5_kdc_set_dbinfo(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-6594/repo/kdc/set_dbinfo.c",
    "lines": "67-111",
    "snippet": "rb5_error_code\nkrb5_kdc_set_dbinfo(krb5_context context, struct krb5_kdc_configuration *c)\n{\n    struct hdb_dbinfo *info, *d;\n    krb5_error_code ret;\n    int i;\n\n    /* fetch the databases */\n    ret = hdb_get_dbinfo(context, &info);\n    if (ret)\n\treturn ret;\n\n    d = NULL;\n    while ((d = hdb_dbinfo_get_next(info, d)) != NULL) {\n\n\tret = add_db(context, c,\n\t\t     hdb_dbinfo_get_dbname(context, d),\n\t\t     hdb_dbinfo_get_mkey_file(context, d));\n\tif (ret)\n\t    goto out;\n\n\tkdc_log(context, c, 0, \"label: %s\",\n\t\thdb_dbinfo_get_label(context, d));\n\tkdc_log(context, c, 0, \"\\tdbname: %s\",\n\t\thdb_dbinfo_get_dbname(context, d));\n\tkdc_log(context, c, 0, \"\\tmkey_file: %s\",\n\t\thdb_dbinfo_get_mkey_file(context, d));\n\tkdc_log(context, c, 0, \"\\tacl_file: %s\",\n\t\thdb_dbinfo_get_acl_file(context, d));\n    }\n    hdb_free_dbinfo(context, &info);\n\n    return 0;\nout:\n    for (i = 0; i < c->num_db; i++)\n\tif (c->db[i] && c->db[i]->hdb_destroy)\n\t    (*c->db[i]->hdb_destroy)(context, c->db[i]);\n    c->num_db = 0;\n    free(c->db);\n    c->db = NULL;\n\n    hdb_free_dbinfo(context, &info);\n\n    return ret;\n}",
    "includes": [
      "include \"kdc_locl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "db_free_dbinfo(",
          "args": [
            "ontext,",
            "info)"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ree(",
          "args": [
            "->db)"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "*c->db[i]->hdb_destroy)",
          "args": [
            "ontext,",
            "->db[i])"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db_free_dbinfo(",
          "args": [
            "ontext,",
            "info)"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dc_log(",
          "args": [
            "ontext,",
            ",",
            ",",
            "\\tacl_file: %s\",",
            "db_dbinfo_get_acl_file(context, d))"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "dc_log(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-6594/repo/kdc/log.c",
          "lines": "86-97",
          "snippet": "oid\nkdc_log(krb5_context context,\n\tkrb5_kdc_configuration *config,\n\tint level, const char *fmt, ...)\n{\n    va_list ap;\n    char *s;\n    va_start(ap, fmt);\n    s = kdc_log_msg_va(context, config, level, fmt, ap);\n    if(s) free(s);\n    va_end(ap);\n}",
          "includes": [
            "include \"kdc_locl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"kdc_locl.h\"\n\noid\nkdc_log(krb5_context context,\n\tkrb5_kdc_configuration *config,\n\tint level, const char *fmt, ...)\n{\n    va_list ap;\n    char *s;\n    va_start(ap, fmt);\n    s = kdc_log_msg_va(context, config, level, fmt, ap);\n    if(s) free(s);\n    va_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "db_dbinfo_get_acl_file(",
          "args": [
            "ontext,",
            ")"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db_dbinfo_get_mkey_file(",
          "args": [
            "ontext,",
            ")"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db_dbinfo_get_dbname(",
          "args": [
            "ontext,",
            ")"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db_dbinfo_get_label(",
          "args": [
            "ontext,",
            ")"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dd_db(",
          "args": [
            "ontext,",
            ",",
            "db_dbinfo_get_dbname(context, d),",
            "db_dbinfo_get_mkey_file(context, d))"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "dd_db(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-6594/repo/kdc/set_dbinfo.c",
          "lines": "38-65",
          "snippet": "tatic krb5_error_code\nadd_db(krb5_context context, struct krb5_kdc_configuration *c,\n       const char *conf, const char *master_key)\n{\n    krb5_error_code ret;\n    void *ptr;\n\n    ptr = realloc(c->db, (c->num_db + 1) * sizeof(*c->db));\n    if (ptr == NULL) {\n\tkrb5_set_error_message(context, ENOMEM, \"malloc: out of memory\");\n\treturn ENOMEM;\n    }\n    c->db = ptr;\n\n    ret = hdb_create(context, &c->db[c->num_db], conf);\n    if(ret)\n\treturn ret;\n\n    c->num_db++;\n\n    if (master_key) {\n\tret = hdb_set_master_keyfile(context, c->db[c->num_db - 1], master_key);\n\tif (ret)\n\t    return ret;\n    }\n\n    return 0;\n}",
          "includes": [
            "include \"kdc_locl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"kdc_locl.h\"\n\ntatic krb5_error_code\nadd_db(krb5_context context, struct krb5_kdc_configuration *c,\n       const char *conf, const char *master_key)\n{\n    krb5_error_code ret;\n    void *ptr;\n\n    ptr = realloc(c->db, (c->num_db + 1) * sizeof(*c->db));\n    if (ptr == NULL) {\n\tkrb5_set_error_message(context, ENOMEM, \"malloc: out of memory\");\n\treturn ENOMEM;\n    }\n    c->db = ptr;\n\n    ret = hdb_create(context, &c->db[c->num_db], conf);\n    if(ret)\n\treturn ret;\n\n    c->num_db++;\n\n    if (master_key) {\n\tret = hdb_set_master_keyfile(context, c->db[c->num_db - 1], master_key);\n\tif (ret)\n\t    return ret;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "db_dbinfo_get_mkey_file(",
          "args": [
            "ontext,",
            ")"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db_dbinfo_get_dbname(",
          "args": [
            "ontext,",
            ")"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db_dbinfo_get_next(",
          "args": [
            "nfo,",
            ")"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db_get_dbinfo(",
          "args": [
            "ontext,",
            "info)"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"kdc_locl.h\"\n\nrb5_error_code\nkrb5_kdc_set_dbinfo(krb5_context context, struct krb5_kdc_configuration *c)\n{\n    struct hdb_dbinfo *info, *d;\n    krb5_error_code ret;\n    int i;\n\n    /* fetch the databases */\n    ret = hdb_get_dbinfo(context, &info);\n    if (ret)\n\treturn ret;\n\n    d = NULL;\n    while ((d = hdb_dbinfo_get_next(info, d)) != NULL) {\n\n\tret = add_db(context, c,\n\t\t     hdb_dbinfo_get_dbname(context, d),\n\t\t     hdb_dbinfo_get_mkey_file(context, d));\n\tif (ret)\n\t    goto out;\n\n\tkdc_log(context, c, 0, \"label: %s\",\n\t\thdb_dbinfo_get_label(context, d));\n\tkdc_log(context, c, 0, \"\\tdbname: %s\",\n\t\thdb_dbinfo_get_dbname(context, d));\n\tkdc_log(context, c, 0, \"\\tmkey_file: %s\",\n\t\thdb_dbinfo_get_mkey_file(context, d));\n\tkdc_log(context, c, 0, \"\\tacl_file: %s\",\n\t\thdb_dbinfo_get_acl_file(context, d));\n    }\n    hdb_free_dbinfo(context, &info);\n\n    return 0;\nout:\n    for (i = 0; i < c->num_db; i++)\n\tif (c->db[i] && c->db[i]->hdb_destroy)\n\t    (*c->db[i]->hdb_destroy)(context, c->db[i]);\n    c->num_db = 0;\n    free(c->db);\n    c->db = NULL;\n\n    hdb_free_dbinfo(context, &info);\n\n    return ret;\n}"
  },
  {
    "function_name": "dd_db(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-6594/repo/kdc/set_dbinfo.c",
    "lines": "38-65",
    "snippet": "tatic krb5_error_code\nadd_db(krb5_context context, struct krb5_kdc_configuration *c,\n       const char *conf, const char *master_key)\n{\n    krb5_error_code ret;\n    void *ptr;\n\n    ptr = realloc(c->db, (c->num_db + 1) * sizeof(*c->db));\n    if (ptr == NULL) {\n\tkrb5_set_error_message(context, ENOMEM, \"malloc: out of memory\");\n\treturn ENOMEM;\n    }\n    c->db = ptr;\n\n    ret = hdb_create(context, &c->db[c->num_db], conf);\n    if(ret)\n\treturn ret;\n\n    c->num_db++;\n\n    if (master_key) {\n\tret = hdb_set_master_keyfile(context, c->db[c->num_db - 1], master_key);\n\tif (ret)\n\t    return ret;\n    }\n\n    return 0;\n}",
    "includes": [
      "include \"kdc_locl.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "db_set_master_keyfile(",
          "args": [
            "ontext,",
            "->db[c->num_db - 1],",
            "aster_key)"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db_create(",
          "args": [
            "ontext,",
            "c->db[c->num_db],",
            "onf)"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_set_error_message(",
          "args": [
            "ontext,",
            "NOMEM,",
            "malloc: out of memory\")"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ealloc(",
          "args": [
            "->db,",
            "c->num_db + 1) * sizeof(*c->db))"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include \"kdc_locl.h\"\n\ntatic krb5_error_code\nadd_db(krb5_context context, struct krb5_kdc_configuration *c,\n       const char *conf, const char *master_key)\n{\n    krb5_error_code ret;\n    void *ptr;\n\n    ptr = realloc(c->db, (c->num_db + 1) * sizeof(*c->db));\n    if (ptr == NULL) {\n\tkrb5_set_error_message(context, ENOMEM, \"malloc: out of memory\");\n\treturn ENOMEM;\n    }\n    c->db = ptr;\n\n    ret = hdb_create(context, &c->db[c->num_db], conf);\n    if(ret)\n\treturn ret;\n\n    c->num_db++;\n\n    if (master_key) {\n\tret = hdb_set_master_keyfile(context, c->db[c->num_db - 1], master_key);\n\tif (ret)\n\t    return ret;\n    }\n\n    return 0;\n}"
  }
]