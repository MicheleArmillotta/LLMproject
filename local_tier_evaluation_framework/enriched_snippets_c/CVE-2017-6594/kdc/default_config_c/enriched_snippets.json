[
  {
    "function_name": "rb5_kdc_pkinit_config(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-6594/repo/kdc/default_config.c",
    "lines": "264-299",
    "snippet": "rb5_error_code\nkrb5_kdc_pkinit_config(krb5_context context, krb5_kdc_configuration *config)\n{\n#ifdef PKINIT\n#ifdef __APPLE__\n    config->enable_pkinit = 1;\n\n    if (config->pkinit_kdc_identity == NULL) {\n\tif (config->pkinit_kdc_friendly_name == NULL)\n\t    config->pkinit_kdc_friendly_name =\n\t\tstrdup(\"O=System Identity,CN=com.apple.kerberos.kdc\");\n\tconfig->pkinit_kdc_identity = strdup(\"KEYCHAIN:\");\n    }\n    if (config->pkinit_kdc_anchors == NULL)\n\tconfig->pkinit_kdc_anchors = strdup(\"KEYCHAIN:\");\n\n#endif /* __APPLE__ */\n\n    if (config->enable_pkinit) {\n\tif (config->pkinit_kdc_identity == NULL)\n\t    krb5_errx(context, 1, \"pkinit enabled but no identity\");\n\n\tif (config->pkinit_kdc_anchors == NULL)\n\t    krb5_errx(context, 1, \"pkinit enabled but no X509 anchors\");\n\n\tkrb5_kdc_pk_initialize(context, config,\n\t\t\t       config->pkinit_kdc_identity,\n\t\t\t       config->pkinit_kdc_anchors,\n\t\t\t       config->pkinit_kdc_cert_pool,\n\t\t\t       config->pkinit_kdc_revoke);\n\n    }\n\n    return 0;\n#endif /* PKINIT */\n}",
    "includes": [
      "include <parse_bytes.h>",
      "include <getarg.h>\n#",
      "include \"kdc_locl.h\"\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rb5_kdc_pk_initialize(",
          "args": [
            "ontext,",
            "onfig,",
            "onfig->pkinit_kdc_identity,",
            "onfig->pkinit_kdc_anchors,",
            "onfig->pkinit_kdc_cert_pool,",
            "onfig->pkinit_kdc_revoke)"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "rb5_kdc_pk_initialize(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-6594/repo/kdc/pkinit.c",
          "lines": "1909-2016",
          "snippet": "rb5_error_code\nkrb5_kdc_pk_initialize(krb5_context context,\n\t\t       krb5_kdc_configuration *config,\n\t\t       const char *user_id,\n\t\t       const char *anchors,\n\t\t       char **pool,\n\t\t       char **revoke_list)\n{\n    const char *file;\n    char *fn = NULL;\n    krb5_error_code ret;\n\n    file = krb5_config_get_string(context, NULL,\n\t\t\t\t  \"libdefaults\", \"moduli\", NULL);\n\n    ret = _krb5_parse_moduli(context, file, &moduli);\n    if (ret)\n\tkrb5_err(context, 1, ret, \"PKINIT: failed to load modidi file\");\n\n    principal_mappings.len = 0;\n    principal_mappings.val = NULL;\n\n    ret = _krb5_pk_load_id(context,\n\t\t\t   &kdc_identity,\n\t\t\t   user_id,\n\t\t\t   anchors,\n\t\t\t   pool,\n\t\t\t   revoke_list,\n\t\t\t   NULL,\n\t\t\t   NULL,\n\t\t\t   NULL);\n    if (ret) {\n\tkrb5_warn(context, ret, \"PKINIT: \");\n\tconfig->enable_pkinit = 0;\n\treturn ret;\n    }\n\n    {\n\thx509_query *q;\n\thx509_cert cert;\n\n\tret = hx509_query_alloc(context->hx509ctx, &q);\n\tif (ret) {\n\t    krb5_warnx(context, \"PKINIT: out of memory\");\n\t    return ENOMEM;\n\t}\n\n\thx509_query_match_option(q, HX509_QUERY_OPTION_PRIVATE_KEY);\n\tif (config->pkinit_kdc_friendly_name)\n\t    hx509_query_match_friendly_name(q, config->pkinit_kdc_friendly_name);\n\n\tret = hx509_certs_find(context->hx509ctx,\n\t\t\t       kdc_identity->certs,\n\t\t\t       q,\n\t\t\t       &cert);\n\thx509_query_free(context->hx509ctx, q);\n\tif (ret == 0) {\n\t    if (hx509_cert_check_eku(context->hx509ctx, cert,\n\t\t\t\t     &asn1_oid_id_pkkdcekuoid, 0)) {\n\t\thx509_name name;\n\t\tchar *str;\n\t\tret = hx509_cert_get_subject(cert, &name);\n\t\tif (ret == 0) {\n\t\t    hx509_name_to_string(name, &str);\n\t\t    krb5_warnx(context, \"WARNING Found KDC certificate (%s)\"\n\t\t\t       \"is missing the PK-INIT KDC EKU, this is bad for \"\n\t\t\t       \"interoperability.\", str);\n\t\t    hx509_name_free(&name);\n\t\t    free(str);\n\t\t}\n\t    }\n\t    hx509_cert_free(cert);\n\t} else\n\t    krb5_warnx(context, \"PKINIT: failed to find a signing \"\n\t\t       \"certifiate with a public key\");\n    }\n\n    if (krb5_config_get_bool_default(context,\n\t\t\t\t     NULL,\n\t\t\t\t     FALSE,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"pkinit_allow_proxy_certificate\",\n\t\t\t\t     NULL))\n\tconfig->pkinit_allow_proxy_certs = 1;\n\n    file = krb5_config_get_string(context,\n\t\t\t\t  NULL,\n\t\t\t\t  \"kdc\",\n\t\t\t\t  \"pkinit_mappings_file\",\n\t\t\t\t  NULL);\n    if (file == NULL) {\n\tint aret;\n\n\taret = asprintf(&fn, \"%s/pki-mapping\", hdb_db_dir(context));\n\tif (aret == -1) {\n\t    krb5_warnx(context, \"PKINIT: out of memory\");\n\t    return ENOMEM;\n\t}\n\n\tfile = fn;\n    }\n\n    load_mappings(context, file);\n    if (fn)\n\tfree(fn);\n\n    return 0;\n}",
          "includes": [
            "include \"crypto-headers.h\"",
            "include <hx509.h>\n#",
            "include <pkinit_asn1.h>",
            "include <cms_asn1.h>\n#",
            "include <rfc2459_asn1.h>\n#",
            "include <heim_asn1.h>\n#",
            "include \"kdc_locl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"crypto-headers.h\"\ninclude <hx509.h>\n#\ninclude <pkinit_asn1.h>\ninclude <cms_asn1.h>\n#\ninclude <rfc2459_asn1.h>\n#\ninclude <heim_asn1.h>\n#\ninclude \"kdc_locl.h\"\n\nrb5_error_code\nkrb5_kdc_pk_initialize(krb5_context context,\n\t\t       krb5_kdc_configuration *config,\n\t\t       const char *user_id,\n\t\t       const char *anchors,\n\t\t       char **pool,\n\t\t       char **revoke_list)\n{\n    const char *file;\n    char *fn = NULL;\n    krb5_error_code ret;\n\n    file = krb5_config_get_string(context, NULL,\n\t\t\t\t  \"libdefaults\", \"moduli\", NULL);\n\n    ret = _krb5_parse_moduli(context, file, &moduli);\n    if (ret)\n\tkrb5_err(context, 1, ret, \"PKINIT: failed to load modidi file\");\n\n    principal_mappings.len = 0;\n    principal_mappings.val = NULL;\n\n    ret = _krb5_pk_load_id(context,\n\t\t\t   &kdc_identity,\n\t\t\t   user_id,\n\t\t\t   anchors,\n\t\t\t   pool,\n\t\t\t   revoke_list,\n\t\t\t   NULL,\n\t\t\t   NULL,\n\t\t\t   NULL);\n    if (ret) {\n\tkrb5_warn(context, ret, \"PKINIT: \");\n\tconfig->enable_pkinit = 0;\n\treturn ret;\n    }\n\n    {\n\thx509_query *q;\n\thx509_cert cert;\n\n\tret = hx509_query_alloc(context->hx509ctx, &q);\n\tif (ret) {\n\t    krb5_warnx(context, \"PKINIT: out of memory\");\n\t    return ENOMEM;\n\t}\n\n\thx509_query_match_option(q, HX509_QUERY_OPTION_PRIVATE_KEY);\n\tif (config->pkinit_kdc_friendly_name)\n\t    hx509_query_match_friendly_name(q, config->pkinit_kdc_friendly_name);\n\n\tret = hx509_certs_find(context->hx509ctx,\n\t\t\t       kdc_identity->certs,\n\t\t\t       q,\n\t\t\t       &cert);\n\thx509_query_free(context->hx509ctx, q);\n\tif (ret == 0) {\n\t    if (hx509_cert_check_eku(context->hx509ctx, cert,\n\t\t\t\t     &asn1_oid_id_pkkdcekuoid, 0)) {\n\t\thx509_name name;\n\t\tchar *str;\n\t\tret = hx509_cert_get_subject(cert, &name);\n\t\tif (ret == 0) {\n\t\t    hx509_name_to_string(name, &str);\n\t\t    krb5_warnx(context, \"WARNING Found KDC certificate (%s)\"\n\t\t\t       \"is missing the PK-INIT KDC EKU, this is bad for \"\n\t\t\t       \"interoperability.\", str);\n\t\t    hx509_name_free(&name);\n\t\t    free(str);\n\t\t}\n\t    }\n\t    hx509_cert_free(cert);\n\t} else\n\t    krb5_warnx(context, \"PKINIT: failed to find a signing \"\n\t\t       \"certifiate with a public key\");\n    }\n\n    if (krb5_config_get_bool_default(context,\n\t\t\t\t     NULL,\n\t\t\t\t     FALSE,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"pkinit_allow_proxy_certificate\",\n\t\t\t\t     NULL))\n\tconfig->pkinit_allow_proxy_certs = 1;\n\n    file = krb5_config_get_string(context,\n\t\t\t\t  NULL,\n\t\t\t\t  \"kdc\",\n\t\t\t\t  \"pkinit_mappings_file\",\n\t\t\t\t  NULL);\n    if (file == NULL) {\n\tint aret;\n\n\taret = asprintf(&fn, \"%s/pki-mapping\", hdb_db_dir(context));\n\tif (aret == -1) {\n\t    krb5_warnx(context, \"PKINIT: out of memory\");\n\t    return ENOMEM;\n\t}\n\n\tfile = fn;\n    }\n\n    load_mappings(context, file);\n    if (fn)\n\tfree(fn);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rb5_errx(",
          "args": [
            "ontext,",
            ",",
            "pkinit enabled but no X509 anchors\")"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_errx(",
          "args": [
            "ontext,",
            ",",
            "pkinit enabled but no identity\")"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trdup(",
          "args": [
            "KEYCHAIN:\")"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trdup(",
          "args": [
            "KEYCHAIN:\")"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trdup(",
          "args": [
            "O=System Identity,CN=com.apple.kerberos.kdc\")"
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include <parse_bytes.h>\ninclude <getarg.h>\n#\ninclude \"kdc_locl.h\"\n#\n\nrb5_error_code\nkrb5_kdc_pkinit_config(krb5_context context, krb5_kdc_configuration *config)\n{\n#ifdef PKINIT\n#ifdef __APPLE__\n    config->enable_pkinit = 1;\n\n    if (config->pkinit_kdc_identity == NULL) {\n\tif (config->pkinit_kdc_friendly_name == NULL)\n\t    config->pkinit_kdc_friendly_name =\n\t\tstrdup(\"O=System Identity,CN=com.apple.kerberos.kdc\");\n\tconfig->pkinit_kdc_identity = strdup(\"KEYCHAIN:\");\n    }\n    if (config->pkinit_kdc_anchors == NULL)\n\tconfig->pkinit_kdc_anchors = strdup(\"KEYCHAIN:\");\n\n#endif /* __APPLE__ */\n\n    if (config->enable_pkinit) {\n\tif (config->pkinit_kdc_identity == NULL)\n\t    krb5_errx(context, 1, \"pkinit enabled but no identity\");\n\n\tif (config->pkinit_kdc_anchors == NULL)\n\t    krb5_errx(context, 1, \"pkinit enabled but no X509 anchors\");\n\n\tkrb5_kdc_pk_initialize(context, config,\n\t\t\t       config->pkinit_kdc_identity,\n\t\t\t       config->pkinit_kdc_anchors,\n\t\t\t       config->pkinit_kdc_cert_pool,\n\t\t\t       config->pkinit_kdc_revoke);\n\n    }\n\n    return 0;\n#endif /* PKINIT */\n}"
  },
  {
    "function_name": "rb5_kdc_get_config(",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-6594/repo/kdc/default_config.c",
    "lines": "40-262",
    "snippet": "rb5_error_code\nkrb5_kdc_get_config(krb5_context context, krb5_kdc_configuration **config)\n{\n    krb5_kdc_configuration *c;\n\n    c = calloc(1, sizeof(*c));\n    if (c == NULL) {\n\tkrb5_set_error_message(context, ENOMEM, \"malloc: out of memory\");\n\treturn ENOMEM;\n    }\n\n    c->num_kdc_processes = -1;\n    c->require_preauth = TRUE;\n    c->kdc_warn_pwexpire = 0;\n    c->encode_as_rep_as_tgs_rep = FALSE;\n    c->tgt_use_strongest_session_key = FALSE;\n    c->preauth_use_strongest_session_key = FALSE;\n    c->svc_use_strongest_session_key = FALSE;\n    c->use_strongest_server_key = TRUE;\n    c->check_ticket_addresses = TRUE;\n    c->allow_null_ticket_addresses = TRUE;\n    c->allow_anonymous = FALSE;\n    c->strict_nametypes = FALSE;\n    c->trpolicy = TRPOLICY_ALWAYS_CHECK;\n    c->enable_pkinit = FALSE;\n    c->pkinit_princ_in_cert = TRUE;\n    c->pkinit_require_binding = TRUE;\n    c->db = NULL;\n    c->num_db = 0;\n    c->logf = NULL;\n\n    c->num_kdc_processes =\n        krb5_config_get_int_default(context, NULL, c->num_kdc_processes,\n\t\t\t\t    \"kdc\", \"num-kdc-processes\", NULL);\n\n    c->require_preauth =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->require_preauth,\n\t\t\t\t     \"kdc\", \"require-preauth\", NULL);\n#ifdef DIGEST\n    c->enable_digest =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     FALSE,\n\t\t\t\t     \"kdc\", \"enable-digest\", NULL);\n\n    {\n\tconst char *digests;\n\n\tdigests = krb5_config_get_string(context, NULL,\n\t\t\t\t\t \"kdc\",\n\t\t\t\t\t \"digests_allowed\", NULL);\n\tif (digests == NULL)\n\t    digests = \"ntlm-v2\";\n\tc->digests_allowed = parse_flags(digests,_kdc_digestunits, 0);\n\tif (c->digests_allowed == -1) {\n\t    kdc_log(context, c, 0,\n\t\t    \"unparsable digest units (%s), turning off digest\",\n\t\t    digests);\n\t    c->enable_digest = 0;\n\t} else if (c->digests_allowed == 0) {\n\t    kdc_log(context, c, 0,\n\t\t    \"no digest enable, turning digest off\",\n\t\t    digests);\n\t    c->enable_digest = 0;\n\t}\n    }\n#endif\n\n#ifdef KX509\n    c->enable_kx509 =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     FALSE,\n\t\t\t\t     \"kdc\", \"enable-kx509\", NULL);\n\n    if (c->enable_kx509) {\n\tc->kx509_template =\n\t    krb5_config_get_string(context, NULL,\n\t\t\t\t   \"kdc\", \"kx509_template\", NULL);\n\tc->kx509_ca =\n\t    krb5_config_get_string(context, NULL,\n\t\t\t\t   \"kdc\", \"kx509_ca\", NULL);\n\tif (c->kx509_ca == NULL || c->kx509_template == NULL) {\n\t    kdc_log(context, c, 0,\n\t\t    \"missing kx509 configuration, turning off\");\n\t    c->enable_kx509 = FALSE;\n\t}\n    }\n#endif\n\n    c->tgt_use_strongest_session_key =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->tgt_use_strongest_session_key,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"tgt-use-strongest-session-key\", NULL);\n    c->preauth_use_strongest_session_key =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->preauth_use_strongest_session_key,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"preauth-use-strongest-session-key\", NULL);\n    c->svc_use_strongest_session_key =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->svc_use_strongest_session_key,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"svc-use-strongest-session-key\", NULL);\n    c->use_strongest_server_key =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->use_strongest_server_key,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"use-strongest-server-key\", NULL);\n\n    c->check_ticket_addresses =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->check_ticket_addresses,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"check-ticket-addresses\", NULL);\n    c->allow_null_ticket_addresses =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->allow_null_ticket_addresses,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"allow-null-ticket-addresses\", NULL);\n\n    c->allow_anonymous =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->allow_anonymous,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"allow-anonymous\", NULL);\n\n    c->strict_nametypes =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->strict_nametypes,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"strict-nametypes\", NULL);\n\n    c->max_datagram_reply_length =\n\tkrb5_config_get_int_default(context,\n\t\t\t\t    NULL,\n\t\t\t\t    1400,\n\t\t\t\t    \"kdc\",\n\t\t\t\t    \"max-kdc-datagram-reply-length\",\n\t\t\t\t    NULL);\n\n    {\n\tconst char *trpolicy_str;\n\n\ttrpolicy_str =\n\t    krb5_config_get_string_default(context, NULL, \"DEFAULT\", \"kdc\",\n\t\t\t\t\t   \"transited-policy\", NULL);\n\tif(strcasecmp(trpolicy_str, \"always-check\") == 0) {\n\t    c->trpolicy = TRPOLICY_ALWAYS_CHECK;\n\t} else if(strcasecmp(trpolicy_str, \"allow-per-principal\") == 0) {\n\t    c->trpolicy = TRPOLICY_ALLOW_PER_PRINCIPAL;\n\t} else if(strcasecmp(trpolicy_str, \"always-honour-request\") == 0) {\n\t    c->trpolicy = TRPOLICY_ALWAYS_HONOUR_REQUEST;\n\t} else if(strcasecmp(trpolicy_str, \"DEFAULT\") == 0) {\n\t    /* default */\n\t} else {\n\t    kdc_log(context, c, 0,\n\t\t    \"unknown transited-policy: %s, \"\n\t\t    \"reverting to default (always-check)\",\n\t\t    trpolicy_str);\n\t}\n    }\n\n    c->encode_as_rep_as_tgs_rep =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->encode_as_rep_as_tgs_rep,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"encode_as_rep_as_tgs_rep\", NULL);\n\n    c->kdc_warn_pwexpire =\n\tkrb5_config_get_time_default (context, NULL,\n\t\t\t\t      c->kdc_warn_pwexpire,\n\t\t\t\t      \"kdc\", \"kdc_warn_pwexpire\", NULL);\n\n\n    c->enable_pkinit =\n\tkrb5_config_get_bool_default(context,\n\t\t\t\t     NULL,\n\t\t\t\t     c->enable_pkinit,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"enable-pkinit\",\n\t\t\t\t     NULL);\n\n\n    c->pkinit_kdc_identity =\n\tkrb5_config_get_string(context, NULL,\n\t\t\t       \"kdc\", \"pkinit_identity\", NULL);\n    c->pkinit_kdc_anchors =\n\tkrb5_config_get_string(context, NULL,\n\t\t\t       \"kdc\", \"pkinit_anchors\", NULL);\n    c->pkinit_kdc_cert_pool =\n\tkrb5_config_get_strings(context, NULL,\n\t\t\t\t\"kdc\", \"pkinit_pool\", NULL);\n    c->pkinit_kdc_revoke =\n\tkrb5_config_get_strings(context, NULL,\n\t\t\t\t\"kdc\", \"pkinit_revoke\", NULL);\n    c->pkinit_kdc_ocsp_file =\n\tkrb5_config_get_string(context, NULL,\n\t\t\t       \"kdc\", \"pkinit_kdc_ocsp\", NULL);\n    c->pkinit_kdc_friendly_name =\n\tkrb5_config_get_string(context, NULL,\n\t\t\t       \"kdc\", \"pkinit_kdc_friendly_name\", NULL);\n    c->pkinit_princ_in_cert =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->pkinit_princ_in_cert,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"pkinit_principal_in_certificate\",\n\t\t\t\t     NULL);\n    c->pkinit_require_binding =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->pkinit_require_binding,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"pkinit_win2k_require_binding\",\n\t\t\t\t     NULL);\n    c->pkinit_dh_min_bits =\n\tkrb5_config_get_int_default(context, NULL,\n\t\t\t\t    0,\n\t\t\t\t    \"kdc\", \"pkinit_dh_min_bits\", NULL);\n\n    *config = c;\n\n    return 0;\n}",
    "includes": [
      "include <parse_bytes.h>",
      "include <getarg.h>\n#",
      "include \"kdc_locl.h\"\n#"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rb5_config_get_int_default(",
          "args": [
            "ontext,",
            "ULL,",
            ",",
            "kdc\",",
            "pkinit_dh_min_bits\",",
            "ULL)"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->pkinit_require_binding,",
            "kdc\",",
            "pkinit_win2k_require_binding\",",
            "ULL)"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->pkinit_princ_in_cert,",
            "kdc\",",
            "pkinit_principal_in_certificate\",",
            "ULL)"
          ],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_string(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "pkinit_kdc_friendly_name\",",
            "ULL)"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_string(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "pkinit_kdc_ocsp\",",
            "ULL)"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_strings(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "pkinit_revoke\",",
            "ULL)"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_strings(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "pkinit_pool\",",
            "ULL)"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_string(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "pkinit_anchors\",",
            "ULL)"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_string(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "pkinit_identity\",",
            "ULL)"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->enable_pkinit,",
            "kdc\",",
            "enable-pkinit\",",
            "ULL)"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_time_default",
          "args": [
            "ontext,",
            "ULL,",
            "->kdc_warn_pwexpire,",
            "kdc\",",
            "kdc_warn_pwexpire\",",
            "ULL)"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->encode_as_rep_as_tgs_rep,",
            "kdc\",",
            "encode_as_rep_as_tgs_rep\",",
            "ULL)"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dc_log(",
          "args": [
            "ontext,",
            ",",
            ",",
            "unknown transited-policy: %s, \"\n\t\t    \"reverting to default (always-check)\",",
            "rpolicy_str)"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "dc_log(",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2017-6594/repo/kdc/log.c",
          "lines": "86-97",
          "snippet": "oid\nkdc_log(krb5_context context,\n\tkrb5_kdc_configuration *config,\n\tint level, const char *fmt, ...)\n{\n    va_list ap;\n    char *s;\n    va_start(ap, fmt);\n    s = kdc_log_msg_va(context, config, level, fmt, ap);\n    if(s) free(s);\n    va_end(ap);\n}",
          "includes": [
            "include \"kdc_locl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "include \"kdc_locl.h\"\n\noid\nkdc_log(krb5_context context,\n\tkrb5_kdc_configuration *config,\n\tint level, const char *fmt, ...)\n{\n    va_list ap;\n    char *s;\n    va_start(ap, fmt);\n    s = kdc_log_msg_va(context, config, level, fmt, ap);\n    if(s) free(s);\n    va_end(ap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "trcasecmp(",
          "args": [
            "rpolicy_str,",
            "DEFAULT\")"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trcasecmp(",
          "args": [
            "rpolicy_str,",
            "always-honour-request\")"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trcasecmp(",
          "args": [
            "rpolicy_str,",
            "allow-per-principal\")"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "trcasecmp(",
          "args": [
            "rpolicy_str,",
            "always-check\")"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_string_default(",
          "args": [
            "ontext,",
            "ULL,",
            "DEFAULT\",",
            "kdc\",",
            "transited-policy\",",
            "ULL)"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_int_default(",
          "args": [
            "ontext,",
            "ULL,",
            "400,",
            "kdc\",",
            "max-kdc-datagram-reply-length\",",
            "ULL)"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->strict_nametypes,",
            "kdc\",",
            "strict-nametypes\",",
            "ULL)"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->allow_anonymous,",
            "kdc\",",
            "allow-anonymous\",",
            "ULL)"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->allow_null_ticket_addresses,",
            "kdc\",",
            "allow-null-ticket-addresses\",",
            "ULL)"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->check_ticket_addresses,",
            "kdc\",",
            "check-ticket-addresses\",",
            "ULL)"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->use_strongest_server_key,",
            "kdc\",",
            "use-strongest-server-key\",",
            "ULL)"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->svc_use_strongest_session_key,",
            "kdc\",",
            "svc-use-strongest-session-key\",",
            "ULL)"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->preauth_use_strongest_session_key,",
            "kdc\",",
            "preauth-use-strongest-session-key\",",
            "ULL)"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->tgt_use_strongest_session_key,",
            "kdc\",",
            "tgt-use-strongest-session-key\",",
            "ULL)"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_string(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "kx509_ca\",",
            "ULL)"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_string(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "kx509_template\",",
            "ULL)"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "ALSE,",
            "kdc\",",
            "enable-kx509\",",
            "ULL)"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "arse_flags(",
          "args": [
            "igests,",
            "kdc_digestunits,",
            ")"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_string(",
          "args": [
            "ontext,",
            "ULL,",
            "kdc\",",
            "digests_allowed\",",
            "ULL)"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "ALSE,",
            "kdc\",",
            "enable-digest\",",
            "ULL)"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_bool_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->require_preauth,",
            "kdc\",",
            "require-preauth\",",
            "ULL)"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_config_get_int_default(",
          "args": [
            "ontext,",
            "ULL,",
            "->num_kdc_processes,",
            "kdc\",",
            "num-kdc-processes\",",
            "ULL)"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rb5_set_error_message(",
          "args": [
            "ontext,",
            "NOMEM,",
            "malloc: out of memory\")"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alloc(",
          "args": [
            ",",
            "izeof(*c))"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "include <parse_bytes.h>\ninclude <getarg.h>\n#\ninclude \"kdc_locl.h\"\n#\n\nrb5_error_code\nkrb5_kdc_get_config(krb5_context context, krb5_kdc_configuration **config)\n{\n    krb5_kdc_configuration *c;\n\n    c = calloc(1, sizeof(*c));\n    if (c == NULL) {\n\tkrb5_set_error_message(context, ENOMEM, \"malloc: out of memory\");\n\treturn ENOMEM;\n    }\n\n    c->num_kdc_processes = -1;\n    c->require_preauth = TRUE;\n    c->kdc_warn_pwexpire = 0;\n    c->encode_as_rep_as_tgs_rep = FALSE;\n    c->tgt_use_strongest_session_key = FALSE;\n    c->preauth_use_strongest_session_key = FALSE;\n    c->svc_use_strongest_session_key = FALSE;\n    c->use_strongest_server_key = TRUE;\n    c->check_ticket_addresses = TRUE;\n    c->allow_null_ticket_addresses = TRUE;\n    c->allow_anonymous = FALSE;\n    c->strict_nametypes = FALSE;\n    c->trpolicy = TRPOLICY_ALWAYS_CHECK;\n    c->enable_pkinit = FALSE;\n    c->pkinit_princ_in_cert = TRUE;\n    c->pkinit_require_binding = TRUE;\n    c->db = NULL;\n    c->num_db = 0;\n    c->logf = NULL;\n\n    c->num_kdc_processes =\n        krb5_config_get_int_default(context, NULL, c->num_kdc_processes,\n\t\t\t\t    \"kdc\", \"num-kdc-processes\", NULL);\n\n    c->require_preauth =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->require_preauth,\n\t\t\t\t     \"kdc\", \"require-preauth\", NULL);\n#ifdef DIGEST\n    c->enable_digest =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     FALSE,\n\t\t\t\t     \"kdc\", \"enable-digest\", NULL);\n\n    {\n\tconst char *digests;\n\n\tdigests = krb5_config_get_string(context, NULL,\n\t\t\t\t\t \"kdc\",\n\t\t\t\t\t \"digests_allowed\", NULL);\n\tif (digests == NULL)\n\t    digests = \"ntlm-v2\";\n\tc->digests_allowed = parse_flags(digests,_kdc_digestunits, 0);\n\tif (c->digests_allowed == -1) {\n\t    kdc_log(context, c, 0,\n\t\t    \"unparsable digest units (%s), turning off digest\",\n\t\t    digests);\n\t    c->enable_digest = 0;\n\t} else if (c->digests_allowed == 0) {\n\t    kdc_log(context, c, 0,\n\t\t    \"no digest enable, turning digest off\",\n\t\t    digests);\n\t    c->enable_digest = 0;\n\t}\n    }\n#endif\n\n#ifdef KX509\n    c->enable_kx509 =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     FALSE,\n\t\t\t\t     \"kdc\", \"enable-kx509\", NULL);\n\n    if (c->enable_kx509) {\n\tc->kx509_template =\n\t    krb5_config_get_string(context, NULL,\n\t\t\t\t   \"kdc\", \"kx509_template\", NULL);\n\tc->kx509_ca =\n\t    krb5_config_get_string(context, NULL,\n\t\t\t\t   \"kdc\", \"kx509_ca\", NULL);\n\tif (c->kx509_ca == NULL || c->kx509_template == NULL) {\n\t    kdc_log(context, c, 0,\n\t\t    \"missing kx509 configuration, turning off\");\n\t    c->enable_kx509 = FALSE;\n\t}\n    }\n#endif\n\n    c->tgt_use_strongest_session_key =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->tgt_use_strongest_session_key,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"tgt-use-strongest-session-key\", NULL);\n    c->preauth_use_strongest_session_key =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->preauth_use_strongest_session_key,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"preauth-use-strongest-session-key\", NULL);\n    c->svc_use_strongest_session_key =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->svc_use_strongest_session_key,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"svc-use-strongest-session-key\", NULL);\n    c->use_strongest_server_key =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->use_strongest_server_key,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"use-strongest-server-key\", NULL);\n\n    c->check_ticket_addresses =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->check_ticket_addresses,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"check-ticket-addresses\", NULL);\n    c->allow_null_ticket_addresses =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->allow_null_ticket_addresses,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"allow-null-ticket-addresses\", NULL);\n\n    c->allow_anonymous =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->allow_anonymous,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"allow-anonymous\", NULL);\n\n    c->strict_nametypes =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->strict_nametypes,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"strict-nametypes\", NULL);\n\n    c->max_datagram_reply_length =\n\tkrb5_config_get_int_default(context,\n\t\t\t\t    NULL,\n\t\t\t\t    1400,\n\t\t\t\t    \"kdc\",\n\t\t\t\t    \"max-kdc-datagram-reply-length\",\n\t\t\t\t    NULL);\n\n    {\n\tconst char *trpolicy_str;\n\n\ttrpolicy_str =\n\t    krb5_config_get_string_default(context, NULL, \"DEFAULT\", \"kdc\",\n\t\t\t\t\t   \"transited-policy\", NULL);\n\tif(strcasecmp(trpolicy_str, \"always-check\") == 0) {\n\t    c->trpolicy = TRPOLICY_ALWAYS_CHECK;\n\t} else if(strcasecmp(trpolicy_str, \"allow-per-principal\") == 0) {\n\t    c->trpolicy = TRPOLICY_ALLOW_PER_PRINCIPAL;\n\t} else if(strcasecmp(trpolicy_str, \"always-honour-request\") == 0) {\n\t    c->trpolicy = TRPOLICY_ALWAYS_HONOUR_REQUEST;\n\t} else if(strcasecmp(trpolicy_str, \"DEFAULT\") == 0) {\n\t    /* default */\n\t} else {\n\t    kdc_log(context, c, 0,\n\t\t    \"unknown transited-policy: %s, \"\n\t\t    \"reverting to default (always-check)\",\n\t\t    trpolicy_str);\n\t}\n    }\n\n    c->encode_as_rep_as_tgs_rep =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->encode_as_rep_as_tgs_rep,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"encode_as_rep_as_tgs_rep\", NULL);\n\n    c->kdc_warn_pwexpire =\n\tkrb5_config_get_time_default (context, NULL,\n\t\t\t\t      c->kdc_warn_pwexpire,\n\t\t\t\t      \"kdc\", \"kdc_warn_pwexpire\", NULL);\n\n\n    c->enable_pkinit =\n\tkrb5_config_get_bool_default(context,\n\t\t\t\t     NULL,\n\t\t\t\t     c->enable_pkinit,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"enable-pkinit\",\n\t\t\t\t     NULL);\n\n\n    c->pkinit_kdc_identity =\n\tkrb5_config_get_string(context, NULL,\n\t\t\t       \"kdc\", \"pkinit_identity\", NULL);\n    c->pkinit_kdc_anchors =\n\tkrb5_config_get_string(context, NULL,\n\t\t\t       \"kdc\", \"pkinit_anchors\", NULL);\n    c->pkinit_kdc_cert_pool =\n\tkrb5_config_get_strings(context, NULL,\n\t\t\t\t\"kdc\", \"pkinit_pool\", NULL);\n    c->pkinit_kdc_revoke =\n\tkrb5_config_get_strings(context, NULL,\n\t\t\t\t\"kdc\", \"pkinit_revoke\", NULL);\n    c->pkinit_kdc_ocsp_file =\n\tkrb5_config_get_string(context, NULL,\n\t\t\t       \"kdc\", \"pkinit_kdc_ocsp\", NULL);\n    c->pkinit_kdc_friendly_name =\n\tkrb5_config_get_string(context, NULL,\n\t\t\t       \"kdc\", \"pkinit_kdc_friendly_name\", NULL);\n    c->pkinit_princ_in_cert =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->pkinit_princ_in_cert,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"pkinit_principal_in_certificate\",\n\t\t\t\t     NULL);\n    c->pkinit_require_binding =\n\tkrb5_config_get_bool_default(context, NULL,\n\t\t\t\t     c->pkinit_require_binding,\n\t\t\t\t     \"kdc\",\n\t\t\t\t     \"pkinit_win2k_require_binding\",\n\t\t\t\t     NULL);\n    c->pkinit_dh_min_bits =\n\tkrb5_config_get_int_default(context, NULL,\n\t\t\t\t    0,\n\t\t\t\t    \"kdc\", \"pkinit_dh_min_bits\", NULL);\n\n    *config = c;\n\n    return 0;\n}"
  }
]