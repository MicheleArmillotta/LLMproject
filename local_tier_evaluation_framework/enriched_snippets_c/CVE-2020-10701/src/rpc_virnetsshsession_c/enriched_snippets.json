[
  {
    "function_name": "virNetSSHSessionHasCachedData",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1482-1496",
    "snippet": "bool\nvirNetSSHSessionHasCachedData(virNetSSHSessionPtr sess)\n{\n    bool ret;\n\n    if (!sess)\n        return false;\n\n    virObjectLock(sess);\n\n    ret = sess->bufUsed > 0;\n\n    virObjectUnlock(sess);\n    return ret;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1494
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1490
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nbool\nvirNetSSHSessionHasCachedData(virNetSSHSessionPtr sess)\n{\n    bool ret;\n\n    if (!sess)\n        return false;\n\n    virObjectLock(sess);\n\n    ret = sess->bufUsed > 0;\n\n    virObjectUnlock(sess);\n    return ret;\n}"
  },
  {
    "function_name": "virNetSSHChannelWrite",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1425-1480",
    "snippet": "ssize_t\nvirNetSSHChannelWrite(virNetSSHSessionPtr sess,\n                      const char *buf,\n                      size_t len)\n{\n    ssize_t ret;\n\n    virObjectLock(sess);\n\n    if (sess->state != VIR_NET_SSH_STATE_HANDSHAKE_COMPLETE) {\n        if (sess->state == VIR_NET_SSH_STATE_ERROR_REMOTE)\n            virReportError(VIR_ERR_SSH,\n                           _(\"Remote program terminated with non-zero code: %d\"),\n                           sess->channelCommandReturnValue);\n        else\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Tried to write socket in error state\"));\n        ret = -1;\n        goto cleanup;\n    }\n\n    if (libssh2_channel_eof(sess->channel)) {\n        if (libssh2_channel_get_exit_status(sess->channel)) {\n            virReportError(VIR_ERR_SSH,\n                           _(\"Remote program terminated with non-zero code: %d\"),\n                           libssh2_channel_get_exit_status(sess->channel));\n            sess->state = VIR_NET_SSH_STATE_ERROR_REMOTE;\n            sess->channelCommandReturnValue = libssh2_channel_get_exit_status(sess->channel);\n\n            ret = -1;\n            goto cleanup;\n        }\n\n        sess->state = VIR_NET_SSH_STATE_CLOSED;\n        ret = -1;\n        goto cleanup;\n    }\n\n    ret = libssh2_channel_write(sess->channel, buf, len);\n    if (ret == LIBSSH2_ERROR_EAGAIN) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (ret < 0) {\n        char *msg;\n        sess->state = VIR_NET_SSH_STATE_ERROR;\n        libssh2_session_last_error(sess->session, &msg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"write failed: %s\"), msg);\n    }\n\n cleanup:\n    virObjectUnlock(sess);\n    return ret;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1478
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"write failed: %s\")",
            "msg"
          ],
          "line": 1473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"write failed: %s\""
          ],
          "line": 1474
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&msg",
            "NULL",
            "0"
          ],
          "line": 1472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_write",
          "args": [
            "sess->channel",
            "buf",
            "len"
          ],
          "line": 1463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_get_exit_status",
          "args": [
            "sess->channel"
          ],
          "line": 1452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"Remote program terminated with non-zero code: %d\")",
            "libssh2_channel_get_exit_status(sess->channel)"
          ],
          "line": 1448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_get_exit_status",
          "args": [
            "sess->channel"
          ],
          "line": 1450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_get_exit_status",
          "args": [
            "sess->channel"
          ],
          "line": 1447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_eof",
          "args": [
            "sess->channel"
          ],
          "line": 1446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Tried to write socket in error state\")"
          ],
          "line": 1440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"Remote program terminated with non-zero code: %d\")",
            "sess->channelCommandReturnValue"
          ],
          "line": 1436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1432
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nssize_t\nvirNetSSHChannelWrite(virNetSSHSessionPtr sess,\n                      const char *buf,\n                      size_t len)\n{\n    ssize_t ret;\n\n    virObjectLock(sess);\n\n    if (sess->state != VIR_NET_SSH_STATE_HANDSHAKE_COMPLETE) {\n        if (sess->state == VIR_NET_SSH_STATE_ERROR_REMOTE)\n            virReportError(VIR_ERR_SSH,\n                           _(\"Remote program terminated with non-zero code: %d\"),\n                           sess->channelCommandReturnValue);\n        else\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Tried to write socket in error state\"));\n        ret = -1;\n        goto cleanup;\n    }\n\n    if (libssh2_channel_eof(sess->channel)) {\n        if (libssh2_channel_get_exit_status(sess->channel)) {\n            virReportError(VIR_ERR_SSH,\n                           _(\"Remote program terminated with non-zero code: %d\"),\n                           libssh2_channel_get_exit_status(sess->channel));\n            sess->state = VIR_NET_SSH_STATE_ERROR_REMOTE;\n            sess->channelCommandReturnValue = libssh2_channel_get_exit_status(sess->channel);\n\n            ret = -1;\n            goto cleanup;\n        }\n\n        sess->state = VIR_NET_SSH_STATE_CLOSED;\n        ret = -1;\n        goto cleanup;\n    }\n\n    ret = libssh2_channel_write(sess->channel, buf, len);\n    if (ret == LIBSSH2_ERROR_EAGAIN) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (ret < 0) {\n        char *msg;\n        sess->state = VIR_NET_SSH_STATE_ERROR;\n        libssh2_session_last_error(sess->session, &msg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"write failed: %s\"), msg);\n    }\n\n cleanup:\n    virObjectUnlock(sess);\n    return ret;\n}"
  },
  {
    "function_name": "virNetSSHChannelRead",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1313-1423",
    "snippet": "ssize_t\nvirNetSSHChannelRead(virNetSSHSessionPtr sess,\n                     char *buf,\n                     size_t len)\n{\n    ssize_t ret = -1;\n    ssize_t read_n = 0;\n\n    virObjectLock(sess);\n\n    if (sess->state != VIR_NET_SSH_STATE_HANDSHAKE_COMPLETE) {\n        if (sess->state == VIR_NET_SSH_STATE_ERROR_REMOTE)\n            virReportError(VIR_ERR_SSH,\n                           _(\"Remote program terminated \"\n                             \"with non-zero code: %d\"),\n                           sess->channelCommandReturnValue);\n        else\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Tried to write socket in error state\"));\n\n        virObjectUnlock(sess);\n        return -1;\n    }\n\n    if (sess->bufUsed > 0) {\n        /* copy the rest (or complete) internal buffer to the output buffer */\n        memcpy(buf,\n               sess->rbuf + sess->bufStart,\n               len > sess->bufUsed ? sess->bufUsed : len);\n\n        if (len >= sess->bufUsed) {\n            read_n = sess->bufUsed;\n\n            sess->bufStart = 0;\n            sess->bufUsed = 0;\n        } else {\n            read_n = len;\n            sess->bufUsed -= len;\n            sess->bufStart += len;\n\n            goto success;\n        }\n    }\n\n    /* continue reading into the buffer supplied */\n    if (read_n < len) {\n        ret = libssh2_channel_read(sess->channel,\n                                   buf + read_n,\n                                   len - read_n);\n\n        if (ret == LIBSSH2_ERROR_EAGAIN)\n            goto success;\n\n        if (ret < 0)\n            goto error;\n\n        read_n += ret;\n    }\n\n    /* try to read something into the internal buffer */\n    if (sess->bufUsed == 0) {\n        ret = libssh2_channel_read(sess->channel,\n                                   sess->rbuf,\n                                   VIR_NET_SSH_BUFFER_SIZE);\n\n        if (ret == LIBSSH2_ERROR_EAGAIN)\n            goto success;\n\n        if (ret < 0)\n            goto error;\n\n        sess->bufUsed = ret;\n        sess->bufStart = 0;\n    }\n\n    if (read_n == 0) {\n        /* get rid of data in stderr stream */\n        ret = libssh2_channel_read_stderr(sess->channel,\n                                          sess->rbuf,\n                                          VIR_NET_SSH_BUFFER_SIZE - 1);\n        if (ret > 0) {\n            sess->rbuf[ret] = '\\0';\n            VIR_DEBUG(\"flushing stderr, data='%s'\",  sess->rbuf);\n        }\n    }\n\n    if (libssh2_channel_eof(sess->channel)) {\n        if (libssh2_channel_get_exit_status(sess->channel)) {\n            virReportError(VIR_ERR_SSH,\n                           _(\"Remote command terminated with non-zero code: %d\"),\n                           libssh2_channel_get_exit_status(sess->channel));\n            sess->channelCommandReturnValue = libssh2_channel_get_exit_status(sess->channel);\n            sess->state = VIR_NET_SSH_STATE_ERROR_REMOTE;\n            virObjectUnlock(sess);\n            return -1;\n        }\n\n        sess->state = VIR_NET_SSH_STATE_CLOSED;\n        virObjectUnlock(sess);\n        return -1;\n    }\n\n success:\n    virObjectUnlock(sess);\n    return read_n;\n\n error:\n    sess->state = VIR_NET_SSH_STATE_ERROR;\n    virObjectUnlock(sess);\n    return ret;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIR_NET_SSH_BUFFER_SIZE  1024"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1421
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_channel_get_exit_status",
          "args": [
            "sess->channel"
          ],
          "line": 1404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"Remote command terminated with non-zero code: %d\")",
            "libssh2_channel_get_exit_status(sess->channel)"
          ],
          "line": 1401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_get_exit_status",
          "args": [
            "sess->channel"
          ],
          "line": 1403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Remote command terminated with non-zero code: %d\""
          ],
          "line": 1402
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_channel_get_exit_status",
          "args": [
            "sess->channel"
          ],
          "line": 1400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_eof",
          "args": [
            "sess->channel"
          ],
          "line": 1399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"flushing stderr, data='%s'\"",
            "sess->rbuf"
          ],
          "line": 1395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_read_stderr",
          "args": [
            "sess->channel",
            "sess->rbuf",
            "VIR_NET_SSH_BUFFER_SIZE - 1"
          ],
          "line": 1390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_read",
          "args": [
            "sess->channel",
            "sess->rbuf",
            "VIR_NET_SSH_BUFFER_SIZE"
          ],
          "line": 1374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_read",
          "args": [
            "sess->channel",
            "buf + read_n",
            "len - read_n"
          ],
          "line": 1359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "buf",
            "sess->rbuf + sess->bufStart",
            "len > sess->bufUsed ? sess->bufUsed : len"
          ],
          "line": 1339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Tried to write socket in error state\")"
          ],
          "line": 1330
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"Remote program terminated \"\n                             \"with non-zero code: %d\")",
            "sess->channelCommandReturnValue"
          ],
          "line": 1325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1321
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\n#define VIR_NET_SSH_BUFFER_SIZE  1024\n\nssize_t\nvirNetSSHChannelRead(virNetSSHSessionPtr sess,\n                     char *buf,\n                     size_t len)\n{\n    ssize_t ret = -1;\n    ssize_t read_n = 0;\n\n    virObjectLock(sess);\n\n    if (sess->state != VIR_NET_SSH_STATE_HANDSHAKE_COMPLETE) {\n        if (sess->state == VIR_NET_SSH_STATE_ERROR_REMOTE)\n            virReportError(VIR_ERR_SSH,\n                           _(\"Remote program terminated \"\n                             \"with non-zero code: %d\"),\n                           sess->channelCommandReturnValue);\n        else\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Tried to write socket in error state\"));\n\n        virObjectUnlock(sess);\n        return -1;\n    }\n\n    if (sess->bufUsed > 0) {\n        /* copy the rest (or complete) internal buffer to the output buffer */\n        memcpy(buf,\n               sess->rbuf + sess->bufStart,\n               len > sess->bufUsed ? sess->bufUsed : len);\n\n        if (len >= sess->bufUsed) {\n            read_n = sess->bufUsed;\n\n            sess->bufStart = 0;\n            sess->bufUsed = 0;\n        } else {\n            read_n = len;\n            sess->bufUsed -= len;\n            sess->bufStart += len;\n\n            goto success;\n        }\n    }\n\n    /* continue reading into the buffer supplied */\n    if (read_n < len) {\n        ret = libssh2_channel_read(sess->channel,\n                                   buf + read_n,\n                                   len - read_n);\n\n        if (ret == LIBSSH2_ERROR_EAGAIN)\n            goto success;\n\n        if (ret < 0)\n            goto error;\n\n        read_n += ret;\n    }\n\n    /* try to read something into the internal buffer */\n    if (sess->bufUsed == 0) {\n        ret = libssh2_channel_read(sess->channel,\n                                   sess->rbuf,\n                                   VIR_NET_SSH_BUFFER_SIZE);\n\n        if (ret == LIBSSH2_ERROR_EAGAIN)\n            goto success;\n\n        if (ret < 0)\n            goto error;\n\n        sess->bufUsed = ret;\n        sess->bufStart = 0;\n    }\n\n    if (read_n == 0) {\n        /* get rid of data in stderr stream */\n        ret = libssh2_channel_read_stderr(sess->channel,\n                                          sess->rbuf,\n                                          VIR_NET_SSH_BUFFER_SIZE - 1);\n        if (ret > 0) {\n            sess->rbuf[ret] = '\\0';\n            VIR_DEBUG(\"flushing stderr, data='%s'\",  sess->rbuf);\n        }\n    }\n\n    if (libssh2_channel_eof(sess->channel)) {\n        if (libssh2_channel_get_exit_status(sess->channel)) {\n            virReportError(VIR_ERR_SSH,\n                           _(\"Remote command terminated with non-zero code: %d\"),\n                           libssh2_channel_get_exit_status(sess->channel));\n            sess->channelCommandReturnValue = libssh2_channel_get_exit_status(sess->channel);\n            sess->state = VIR_NET_SSH_STATE_ERROR_REMOTE;\n            virObjectUnlock(sess);\n            return -1;\n        }\n\n        sess->state = VIR_NET_SSH_STATE_CLOSED;\n        virObjectUnlock(sess);\n        return -1;\n    }\n\n success:\n    virObjectUnlock(sess);\n    return read_n;\n\n error:\n    sess->state = VIR_NET_SSH_STATE_ERROR;\n    virObjectUnlock(sess);\n    return ret;\n}"
  },
  {
    "function_name": "virNetSSHSessionConnect",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1254-1310",
    "snippet": "int\nvirNetSSHSessionConnect(virNetSSHSessionPtr sess,\n                        int sock)\n{\n    int ret;\n    char *errmsg;\n\n    VIR_DEBUG(\"sess=%p, sock=%d\", sess, sock);\n\n    if (!sess || sess->state != VIR_NET_SSH_STATE_NEW) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Invalid virNetSSHSessionPtr\"));\n        return -1;\n    }\n\n    virObjectLock(sess);\n\n    /* check if configuration is valid */\n    if ((ret = virNetSSHValidateConfig(sess)) < 0)\n        goto error;\n\n    /* open session */\n    ret = libssh2_session_handshake(sess->session, sock);\n    /* libssh2 is in blocking mode, so EAGAIN will never happen */\n    if (ret < 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_NO_CONNECT,\n                       _(\"SSH session handshake failed: %s\"),\n                       errmsg);\n        goto error;\n    }\n\n    /* verify the SSH host key */\n    if ((ret = virNetSSHCheckHostKey(sess)) != 0)\n        goto error;\n\n    /* authenticate */\n    if ((ret = virNetSSHAuthenticate(sess)) != 0)\n        goto error;\n\n    /* open channel */\n    if ((ret = virNetSSHOpenChannel(sess)) != 0)\n        goto error;\n\n    /* all set */\n    /* switch to nonblocking mode and return */\n    libssh2_session_set_blocking(sess->session, 0);\n    sess->state = VIR_NET_SSH_STATE_HANDSHAKE_COMPLETE;\n\n    virObjectUnlock(sess);\n    return ret;\n\n error:\n    sess->state = VIR_NET_SSH_STATE_ERROR;\n    virObjectUnlock(sess);\n    return ret;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1308
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_set_blocking",
          "args": [
            "sess->session",
            "0"
          ],
          "line": 1300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHOpenChannel",
          "args": [
            "sess"
          ],
          "line": 1295
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHOpenChannel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "904-932",
          "snippet": "static int\nvirNetSSHOpenChannel(virNetSSHSessionPtr sess)\n{\n    char *errmsg;\n\n    sess->channel = libssh2_channel_open_session(sess->session);\n    if (!sess->channel) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to open ssh channel: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    if (libssh2_channel_exec(sess->channel, sess->channelCommand) != 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to execute command '%s': %s\"),\n                       sess->channelCommand,\n                       errmsg);\n        return -1;\n    }\n\n    /* nonblocking mode - currently does nothing */\n    libssh2_channel_set_blocking(sess->channel, 0);\n\n    /* channel open */\n    return 0;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHOpenChannel(virNetSSHSessionPtr sess)\n{\n    char *errmsg;\n\n    sess->channel = libssh2_channel_open_session(sess->session);\n    if (!sess->channel) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to open ssh channel: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    if (libssh2_channel_exec(sess->channel, sess->channelCommand) != 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to execute command '%s': %s\"),\n                       sess->channelCommand,\n                       errmsg);\n        return -1;\n    }\n\n    /* nonblocking mode - currently does nothing */\n    libssh2_channel_set_blocking(sess->channel, 0);\n\n    /* channel open */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetSSHAuthenticate",
          "args": [
            "sess"
          ],
          "line": 1291
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHAuthenticate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "811-901",
          "snippet": "static int\nvirNetSSHAuthenticate(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n    bool no_method = false;\n    bool auth_failed = false;\n    char *auth_list;\n    char *errmsg;\n    size_t i;\n    int ret;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (!sess->nauths) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No authentication methods and credentials \"\n                         \"provided\"));\n        return -1;\n    }\n\n    /* obtain list of supported auth methods */\n    auth_list = libssh2_userauth_list(sess->session,\n                                      sess->auths[0]->username,\n                                      strlen(sess->auths[0]->username));\n    if (!auth_list) {\n        /* unlikely event, authentication succeeded with NONE as method */\n        if (libssh2_userauth_authenticated(sess->session) == 1)\n            return 0;\n\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"couldn't retrieve authentication methods list: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    for (i = 0; i < sess->nauths; i++) {\n        auth = sess->auths[i];\n\n        ret = 2;\n        virResetLastError();\n\n        switch (auth->method) {\n        case VIR_NET_SSH_AUTH_KEYBOARD_INTERACTIVE:\n            if (strstr(auth_list, \"keyboard-interactive\"))\n                ret = virNetSSHAuthenticateKeyboardInteractive(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_AGENT:\n            if (strstr(auth_list, \"publickey\"))\n                ret = virNetSSHAuthenticateAgent(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_PRIVKEY:\n            if (strstr(auth_list, \"publickey\"))\n                ret = virNetSSHAuthenticatePrivkey(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_PASSWORD:\n            if (strstr(auth_list, \"password\"))\n                ret = virNetSSHAuthenticatePassword(sess, auth);\n            break;\n        }\n\n        /* return on success or error */\n        if (ret <= 0)\n            return ret;\n\n        /* the authentication method is not supported */\n        if (ret == 2)\n            no_method = true;\n\n        /* authentication with this method has failed */\n        if (ret == 1)\n            auth_failed = true;\n    }\n\n    if (sess->nauths == 0) {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"No authentication methods supplied\"));\n    } else if (sess->nauths == 1) {\n        /* pass through the error */\n    } else if (no_method && !auth_failed) {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"None of the requested authentication methods \"\n                         \"are supported by the server\"));\n    } else {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"All provided authentication methods with credentials \"\n                         \"were rejected by the server\"));\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticate(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n    bool no_method = false;\n    bool auth_failed = false;\n    char *auth_list;\n    char *errmsg;\n    size_t i;\n    int ret;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (!sess->nauths) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No authentication methods and credentials \"\n                         \"provided\"));\n        return -1;\n    }\n\n    /* obtain list of supported auth methods */\n    auth_list = libssh2_userauth_list(sess->session,\n                                      sess->auths[0]->username,\n                                      strlen(sess->auths[0]->username));\n    if (!auth_list) {\n        /* unlikely event, authentication succeeded with NONE as method */\n        if (libssh2_userauth_authenticated(sess->session) == 1)\n            return 0;\n\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"couldn't retrieve authentication methods list: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    for (i = 0; i < sess->nauths; i++) {\n        auth = sess->auths[i];\n\n        ret = 2;\n        virResetLastError();\n\n        switch (auth->method) {\n        case VIR_NET_SSH_AUTH_KEYBOARD_INTERACTIVE:\n            if (strstr(auth_list, \"keyboard-interactive\"))\n                ret = virNetSSHAuthenticateKeyboardInteractive(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_AGENT:\n            if (strstr(auth_list, \"publickey\"))\n                ret = virNetSSHAuthenticateAgent(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_PRIVKEY:\n            if (strstr(auth_list, \"publickey\"))\n                ret = virNetSSHAuthenticatePrivkey(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_PASSWORD:\n            if (strstr(auth_list, \"password\"))\n                ret = virNetSSHAuthenticatePassword(sess, auth);\n            break;\n        }\n\n        /* return on success or error */\n        if (ret <= 0)\n            return ret;\n\n        /* the authentication method is not supported */\n        if (ret == 2)\n            no_method = true;\n\n        /* authentication with this method has failed */\n        if (ret == 1)\n            auth_failed = true;\n    }\n\n    if (sess->nauths == 0) {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"No authentication methods supplied\"));\n    } else if (sess->nauths == 1) {\n        /* pass through the error */\n    } else if (no_method && !auth_failed) {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"None of the requested authentication methods \"\n                         \"are supported by the server\"));\n    } else {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"All provided authentication methods with credentials \"\n                         \"were rejected by the server\"));\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetSSHCheckHostKey",
          "args": [
            "sess"
          ],
          "line": 1287
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHCheckHostKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "279-483",
          "snippet": "static int\nvirNetSSHCheckHostKey(virNetSSHSessionPtr sess)\n{\n    int ret;\n    const char *key;\n    const char *keyhash;\n    char *keyhashstr;\n    char *tmp;\n    int keyType;\n    size_t keyLength;\n    char *errmsg;\n    virBuffer buff = VIR_BUFFER_INITIALIZER;\n    virConnectCredential askKey;\n    struct libssh2_knownhost *knownHostEntry = NULL;\n    size_t i;\n    char *hostnameStr = NULL;\n\n    if (sess->hostKeyVerify == VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE)\n        return 0;\n\n    /* get the key */\n    key = libssh2_session_hostkey(sess->session, &keyLength, &keyType);\n    if (!key) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"Failed to retrieve ssh host key: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    /* verify it */\n    ret = libssh2_knownhost_checkp(sess->knownHosts,\n                                   sess->hostname,\n                                   sess->port,\n                                   key,\n                                   keyLength,\n                                   LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW,\n                                   &knownHostEntry);\n\n    switch (ret) {\n    case LIBSSH2_KNOWNHOST_CHECK_NOTFOUND:\n        /* key was not found, query to add it to database */\n        if (sess->hostKeyVerify == VIR_NET_SSH_HOSTKEY_VERIFY_NORMAL) {\n            /* ask to add the key */\n            if (!sess->cred || !sess->cred->cb) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"No user interaction callback provided: \"\n                                 \"Can't verify the session host key\"));\n                return -1;\n            }\n\n            /* prepare data for the callback */\n            memset(&askKey, 0, sizeof(virConnectCredential));\n\n            for (i = 0; i < sess->cred->ncredtype; i++) {\n                if (sess->cred->credtype[i] == VIR_CRED_ECHOPROMPT)\n                    break;\n            }\n\n            if (i == sess->cred->ncredtype) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"no suitable callback for host key \"\n                                 \"verification\"));\n                return -1;\n            }\n\n            /* calculate remote key hash, using MD5 algorithm that is\n             * usual in OpenSSH. The returned value should *NOT* be freed */\n            if (!(keyhash = libssh2_hostkey_hash(sess->session,\n                                                 LIBSSH2_HOSTKEY_HASH_MD5))) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"failed to calculate ssh host key hash\"));\n                return -1;\n            }\n            /* format the host key into a nice userfriendly string.\n             * Sadly, there's no constant to describe the hash length, so\n             * we have to use a *MAGIC* constant. */\n            for (i = 0; i < 16; i++)\n                virBufferAsprintf(&buff, \"%02hhX:\", keyhash[i]);\n            virBufferTrim(&buff, \":\");\n\n            keyhashstr = virBufferContentAndReset(&buff);\n\n            askKey.type = VIR_CRED_ECHOPROMPT;\n            askKey.prompt = g_strdup_printf(_(\"Accept SSH host key with hash '%s' for \" \"host '%s:%d' (%s/%s)?\"),\n                                            keyhashstr, sess->hostname, sess->port, \"y\", \"n\");\n\n            if (sess->cred->cb(&askKey, 1, sess->cred->cbdata)) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"failed to retrieve decision to accept \"\n                                 \"host key\"));\n                tmp = (char*)askKey.prompt;\n                VIR_FREE(tmp);\n                VIR_FREE(keyhashstr);\n                return -1;\n            }\n\n            tmp = (char*)askKey.prompt;\n            VIR_FREE(tmp);\n\n            if (!askKey.result ||\n                STRCASENEQ(askKey.result, \"y\")) {\n                virReportError(VIR_ERR_SSH,\n                               _(\"SSH host key for '%s' (%s) was not accepted\"),\n                               sess->hostname, keyhashstr);\n                VIR_FREE(keyhashstr);\n                VIR_FREE(askKey.result);\n                return -1;\n            }\n            VIR_FREE(keyhashstr);\n            VIR_FREE(askKey.result);\n        }\n\n        /* VIR_NET_SSH_HOSTKEY_VERIFY_AUTO_ADD */\n        /* convert key type, as libssh is using different enums type for\n         * getting the key and different for adding ... */\n        switch (keyType) {\n        case LIBSSH2_HOSTKEY_TYPE_RSA:\n            keyType = LIBSSH2_KNOWNHOST_KEY_SSHRSA;\n            break;\n        case LIBSSH2_HOSTKEY_TYPE_DSS:\n            keyType = LIBSSH2_KNOWNHOST_KEY_SSHDSS;\n            break;\n\n        case LIBSSH2_HOSTKEY_TYPE_UNKNOWN:\n        default:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"unsupported SSH key type\"));\n            return -1;\n        }\n\n        /* add the key to the DB and save it, if applicable */\n        /* construct a \"[hostname]:port\" string to have the hostkey bound\n         * to port number */\n        virBufferAsprintf(&buff, \"[%s]:%d\", sess->hostname, sess->port);\n\n        hostnameStr = virBufferContentAndReset(&buff);\n\n        if (libssh2_knownhost_addc(sess->knownHosts,\n                                   hostnameStr,\n                                   NULL,\n                                   key,\n                                   keyLength,\n                                   vir_libssh2_key_comment,\n                                   strlen(vir_libssh2_key_comment),\n                                   LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW |\n                                   keyType,\n                                   NULL) < 0) {\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_SSH,\n                           _(\"unable to add SSH host key for host '%s': %s\"),\n                           hostnameStr, errmsg);\n            VIR_FREE(hostnameStr);\n            return -1;\n        }\n\n        VIR_FREE(hostnameStr);\n\n        /* write the host key file - if applicable */\n        if (sess->knownHostsFile) {\n            if (libssh2_knownhost_writefile(sess->knownHosts,\n                                            sess->knownHostsFile,\n                                         LIBSSH2_KNOWNHOST_FILE_OPENSSH) < 0) {\n                libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n                virReportError(VIR_ERR_SSH,\n                               _(\"failed to write known_host file '%s': %s\"),\n                               sess->knownHostsFile,\n                               errmsg);\n                return -1;\n            }\n        }\n        /* key was accepted and added */\n        return 0;\n\n    case LIBSSH2_KNOWNHOST_CHECK_MATCH:\n        /* host key matches */\n        return 0;\n\n    case LIBSSH2_KNOWNHOST_CHECK_MISMATCH:\n        /* host key verification failed */\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"!!! SSH HOST KEY VERIFICATION FAILED !!!: \"\n                         \"Identity of host '%s:%d' differs from stored identity. \"\n                         \"Please verify the new host key '%s' to avoid possible \"\n                         \"man in the middle attack. The key is stored in '%s'.\"),\n                       sess->hostname, sess->port,\n                       knownHostEntry->key, sess->knownHostsFile);\n        return -1;\n\n    case LIBSSH2_KNOWNHOST_CHECK_FAILURE:\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to validate SSH host key: %s\"),\n                       errmsg);\n        return -1;\n\n    default: /* should never happen (tm) */\n        virReportError(VIR_ERR_SSH, \"%s\", _(\"Unknown error value\"));\n        return -1;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const char\nvir_libssh2_key_comment[] = \"added by libvirt ssh transport\";"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic const char\nvir_libssh2_key_comment[] = \"added by libvirt ssh transport\";\n\nstatic int\nvirNetSSHCheckHostKey(virNetSSHSessionPtr sess)\n{\n    int ret;\n    const char *key;\n    const char *keyhash;\n    char *keyhashstr;\n    char *tmp;\n    int keyType;\n    size_t keyLength;\n    char *errmsg;\n    virBuffer buff = VIR_BUFFER_INITIALIZER;\n    virConnectCredential askKey;\n    struct libssh2_knownhost *knownHostEntry = NULL;\n    size_t i;\n    char *hostnameStr = NULL;\n\n    if (sess->hostKeyVerify == VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE)\n        return 0;\n\n    /* get the key */\n    key = libssh2_session_hostkey(sess->session, &keyLength, &keyType);\n    if (!key) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"Failed to retrieve ssh host key: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    /* verify it */\n    ret = libssh2_knownhost_checkp(sess->knownHosts,\n                                   sess->hostname,\n                                   sess->port,\n                                   key,\n                                   keyLength,\n                                   LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW,\n                                   &knownHostEntry);\n\n    switch (ret) {\n    case LIBSSH2_KNOWNHOST_CHECK_NOTFOUND:\n        /* key was not found, query to add it to database */\n        if (sess->hostKeyVerify == VIR_NET_SSH_HOSTKEY_VERIFY_NORMAL) {\n            /* ask to add the key */\n            if (!sess->cred || !sess->cred->cb) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"No user interaction callback provided: \"\n                                 \"Can't verify the session host key\"));\n                return -1;\n            }\n\n            /* prepare data for the callback */\n            memset(&askKey, 0, sizeof(virConnectCredential));\n\n            for (i = 0; i < sess->cred->ncredtype; i++) {\n                if (sess->cred->credtype[i] == VIR_CRED_ECHOPROMPT)\n                    break;\n            }\n\n            if (i == sess->cred->ncredtype) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"no suitable callback for host key \"\n                                 \"verification\"));\n                return -1;\n            }\n\n            /* calculate remote key hash, using MD5 algorithm that is\n             * usual in OpenSSH. The returned value should *NOT* be freed */\n            if (!(keyhash = libssh2_hostkey_hash(sess->session,\n                                                 LIBSSH2_HOSTKEY_HASH_MD5))) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"failed to calculate ssh host key hash\"));\n                return -1;\n            }\n            /* format the host key into a nice userfriendly string.\n             * Sadly, there's no constant to describe the hash length, so\n             * we have to use a *MAGIC* constant. */\n            for (i = 0; i < 16; i++)\n                virBufferAsprintf(&buff, \"%02hhX:\", keyhash[i]);\n            virBufferTrim(&buff, \":\");\n\n            keyhashstr = virBufferContentAndReset(&buff);\n\n            askKey.type = VIR_CRED_ECHOPROMPT;\n            askKey.prompt = g_strdup_printf(_(\"Accept SSH host key with hash '%s' for \" \"host '%s:%d' (%s/%s)?\"),\n                                            keyhashstr, sess->hostname, sess->port, \"y\", \"n\");\n\n            if (sess->cred->cb(&askKey, 1, sess->cred->cbdata)) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"failed to retrieve decision to accept \"\n                                 \"host key\"));\n                tmp = (char*)askKey.prompt;\n                VIR_FREE(tmp);\n                VIR_FREE(keyhashstr);\n                return -1;\n            }\n\n            tmp = (char*)askKey.prompt;\n            VIR_FREE(tmp);\n\n            if (!askKey.result ||\n                STRCASENEQ(askKey.result, \"y\")) {\n                virReportError(VIR_ERR_SSH,\n                               _(\"SSH host key for '%s' (%s) was not accepted\"),\n                               sess->hostname, keyhashstr);\n                VIR_FREE(keyhashstr);\n                VIR_FREE(askKey.result);\n                return -1;\n            }\n            VIR_FREE(keyhashstr);\n            VIR_FREE(askKey.result);\n        }\n\n        /* VIR_NET_SSH_HOSTKEY_VERIFY_AUTO_ADD */\n        /* convert key type, as libssh is using different enums type for\n         * getting the key and different for adding ... */\n        switch (keyType) {\n        case LIBSSH2_HOSTKEY_TYPE_RSA:\n            keyType = LIBSSH2_KNOWNHOST_KEY_SSHRSA;\n            break;\n        case LIBSSH2_HOSTKEY_TYPE_DSS:\n            keyType = LIBSSH2_KNOWNHOST_KEY_SSHDSS;\n            break;\n\n        case LIBSSH2_HOSTKEY_TYPE_UNKNOWN:\n        default:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"unsupported SSH key type\"));\n            return -1;\n        }\n\n        /* add the key to the DB and save it, if applicable */\n        /* construct a \"[hostname]:port\" string to have the hostkey bound\n         * to port number */\n        virBufferAsprintf(&buff, \"[%s]:%d\", sess->hostname, sess->port);\n\n        hostnameStr = virBufferContentAndReset(&buff);\n\n        if (libssh2_knownhost_addc(sess->knownHosts,\n                                   hostnameStr,\n                                   NULL,\n                                   key,\n                                   keyLength,\n                                   vir_libssh2_key_comment,\n                                   strlen(vir_libssh2_key_comment),\n                                   LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW |\n                                   keyType,\n                                   NULL) < 0) {\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_SSH,\n                           _(\"unable to add SSH host key for host '%s': %s\"),\n                           hostnameStr, errmsg);\n            VIR_FREE(hostnameStr);\n            return -1;\n        }\n\n        VIR_FREE(hostnameStr);\n\n        /* write the host key file - if applicable */\n        if (sess->knownHostsFile) {\n            if (libssh2_knownhost_writefile(sess->knownHosts,\n                                            sess->knownHostsFile,\n                                         LIBSSH2_KNOWNHOST_FILE_OPENSSH) < 0) {\n                libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n                virReportError(VIR_ERR_SSH,\n                               _(\"failed to write known_host file '%s': %s\"),\n                               sess->knownHostsFile,\n                               errmsg);\n                return -1;\n            }\n        }\n        /* key was accepted and added */\n        return 0;\n\n    case LIBSSH2_KNOWNHOST_CHECK_MATCH:\n        /* host key matches */\n        return 0;\n\n    case LIBSSH2_KNOWNHOST_CHECK_MISMATCH:\n        /* host key verification failed */\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"!!! SSH HOST KEY VERIFICATION FAILED !!!: \"\n                         \"Identity of host '%s:%d' differs from stored identity. \"\n                         \"Please verify the new host key '%s' to avoid possible \"\n                         \"man in the middle attack. The key is stored in '%s'.\"),\n                       sess->hostname, sess->port,\n                       knownHostEntry->key, sess->knownHostsFile);\n        return -1;\n\n    case LIBSSH2_KNOWNHOST_CHECK_FAILURE:\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to validate SSH host key: %s\"),\n                       errmsg);\n        return -1;\n\n    default: /* should never happen (tm) */\n        virReportError(VIR_ERR_SSH, \"%s\", _(\"Unknown error value\"));\n        return -1;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_CONNECT",
            "_(\"SSH session handshake failed: %s\")",
            "errmsg"
          ],
          "line": 1280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"SSH session handshake failed: %s\""
          ],
          "line": 1281
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 1279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_handshake",
          "args": [
            "sess->session",
            "sock"
          ],
          "line": 1276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHValidateConfig",
          "args": [
            "sess"
          ],
          "line": 1272
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHValidateConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "935-961",
          "snippet": "static int\nvirNetSSHValidateConfig(virNetSSHSessionPtr sess)\n{\n    if (sess->nauths == 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No authentication methods and credentials \"\n                         \"provided\"));\n        return -1;\n    }\n\n    if (!sess->channelCommand) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No channel command provided\"));\n        return -1;\n    }\n\n    if (sess->hostKeyVerify != VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE) {\n        if (!sess->hostname) {\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Hostname is needed for host key verification\"));\n            return -1;\n        }\n    }\n\n    /* everything ok */\n    return 0;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHValidateConfig(virNetSSHSessionPtr sess)\n{\n    if (sess->nauths == 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No authentication methods and credentials \"\n                         \"provided\"));\n        return -1;\n    }\n\n    if (!sess->channelCommand) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No channel command provided\"));\n        return -1;\n    }\n\n    if (sess->hostKeyVerify != VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE) {\n        if (!sess->hostname) {\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Hostname is needed for host key verification\"));\n            return -1;\n        }\n    }\n\n    /* everything ok */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1269
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Invalid virNetSSHSessionPtr\")"
          ],
          "line": 1264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"sess=%p, sock=%d\"",
            "sess",
            "sock"
          ],
          "line": 1261
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nint\nvirNetSSHSessionConnect(virNetSSHSessionPtr sess,\n                        int sock)\n{\n    int ret;\n    char *errmsg;\n\n    VIR_DEBUG(\"sess=%p, sock=%d\", sess, sock);\n\n    if (!sess || sess->state != VIR_NET_SSH_STATE_NEW) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Invalid virNetSSHSessionPtr\"));\n        return -1;\n    }\n\n    virObjectLock(sess);\n\n    /* check if configuration is valid */\n    if ((ret = virNetSSHValidateConfig(sess)) < 0)\n        goto error;\n\n    /* open session */\n    ret = libssh2_session_handshake(sess->session, sock);\n    /* libssh2 is in blocking mode, so EAGAIN will never happen */\n    if (ret < 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_NO_CONNECT,\n                       _(\"SSH session handshake failed: %s\"),\n                       errmsg);\n        goto error;\n    }\n\n    /* verify the SSH host key */\n    if ((ret = virNetSSHCheckHostKey(sess)) != 0)\n        goto error;\n\n    /* authenticate */\n    if ((ret = virNetSSHAuthenticate(sess)) != 0)\n        goto error;\n\n    /* open channel */\n    if ((ret = virNetSSHOpenChannel(sess)) != 0)\n        goto error;\n\n    /* all set */\n    /* switch to nonblocking mode and return */\n    libssh2_session_set_blocking(sess->session, 0);\n    sess->state = VIR_NET_SSH_STATE_HANDSHAKE_COMPLETE;\n\n    virObjectUnlock(sess);\n    return ret;\n\n error:\n    sess->state = VIR_NET_SSH_STATE_ERROR;\n    virObjectUnlock(sess);\n    return ret;\n}"
  },
  {
    "function_name": "virNetSSHSessionNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1204-1252",
    "snippet": "virNetSSHSessionPtr virNetSSHSessionNew(void)\n{\n    virNetSSHSessionPtr sess = NULL;\n\n    if (virNetSSHSessionInitialize() < 0)\n        goto error;\n\n    if (!(sess = virObjectLockableNew(virNetSSHSessionClass)))\n        goto error;\n\n    /* initialize session data, use the internal data for callbacks\n     * and stick to default memory management functions */\n    if (!(sess->session = libssh2_session_init_ex(NULL,\n                                                  NULL,\n                                                  NULL,\n                                                  (void *)sess))) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to initialize libssh2 session\"));\n        goto error;\n    }\n\n    if (!(sess->knownHosts = libssh2_knownhost_init(sess->session))) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to initialize libssh2 known hosts table\"));\n        goto error;\n    }\n\n    if (!(sess->agent = libssh2_agent_init(sess->session))) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to initialize libssh2 agent handle\"));\n        goto error;\n    }\n\n    VIR_DEBUG(\"virNetSSHSessionPtr: %p, LIBSSH2_SESSION: %p\",\n              sess, sess->session);\n\n    /* set blocking mode for libssh2 until handshake is complete */\n    libssh2_session_set_blocking(sess->session, 1);\n\n    /* default states for config variables */\n    sess->state = VIR_NET_SSH_STATE_NEW;\n    sess->hostKeyVerify = VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE;\n\n    return sess;\n\n error:\n    virObjectUnref(sess);\n    return NULL;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virNetSSHSessionClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "sess"
          ],
          "line": 1250
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_set_blocking",
          "args": [
            "sess->session",
            "1"
          ],
          "line": 1241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"virNetSSHSessionPtr: %p, LIBSSH2_SESSION: %p\"",
            "sess",
            "sess->session"
          ],
          "line": 1237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Failed to initialize libssh2 agent handle\")"
          ],
          "line": 1232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to initialize libssh2 agent handle\""
          ],
          "line": 1233
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_agent_init",
          "args": [
            "sess->session"
          ],
          "line": 1231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Failed to initialize libssh2 known hosts table\")"
          ],
          "line": 1226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_knownhost_init",
          "args": [
            "sess->session"
          ],
          "line": 1225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Failed to initialize libssh2 session\")"
          ],
          "line": 1220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_init_ex",
          "args": [
            "NULL",
            "NULL",
            "NULL",
            "(void *)sess"
          ],
          "line": 1216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLockableNew",
          "args": [
            "virNetSSHSessionClass"
          ],
          "line": 1211
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLockableNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "256-279",
          "snippet": "void *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nvoid *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetSSHSessionInitialize",
          "args": [],
          "line": 1208
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic virClassPtr virNetSSHSessionClass;\n\nvirNetSSHSessionPtr virNetSSHSessionNew(void)\n{\n    virNetSSHSessionPtr sess = NULL;\n\n    if (virNetSSHSessionInitialize() < 0)\n        goto error;\n\n    if (!(sess = virObjectLockableNew(virNetSSHSessionClass)))\n        goto error;\n\n    /* initialize session data, use the internal data for callbacks\n     * and stick to default memory management functions */\n    if (!(sess->session = libssh2_session_init_ex(NULL,\n                                                  NULL,\n                                                  NULL,\n                                                  (void *)sess))) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to initialize libssh2 session\"));\n        goto error;\n    }\n\n    if (!(sess->knownHosts = libssh2_knownhost_init(sess->session))) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to initialize libssh2 known hosts table\"));\n        goto error;\n    }\n\n    if (!(sess->agent = libssh2_agent_init(sess->session))) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to initialize libssh2 agent handle\"));\n        goto error;\n    }\n\n    VIR_DEBUG(\"virNetSSHSessionPtr: %p, LIBSSH2_SESSION: %p\",\n              sess, sess->session);\n\n    /* set blocking mode for libssh2 until handshake is complete */\n    libssh2_session_set_blocking(sess->session, 1);\n\n    /* default states for config variables */\n    sess->state = VIR_NET_SSH_STATE_NEW;\n    sess->hostKeyVerify = VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE;\n\n    return sess;\n\n error:\n    virObjectUnref(sess);\n    return NULL;\n}"
  },
  {
    "function_name": "virNetSSHSessionSetHostKeyVerification",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1150-1201",
    "snippet": "int\nvirNetSSHSessionSetHostKeyVerification(virNetSSHSessionPtr sess,\n                                       const char *hostname,\n                                       int port,\n                                       const char *hostsfile,\n                                       virNetSSHHostkeyVerify opt,\n                                       unsigned int flags)\n{\n    char *errmsg;\n\n    virObjectLock(sess);\n\n    sess->port = port;\n    sess->hostKeyVerify = opt;\n\n    VIR_FREE(sess->hostname);\n\n    sess->hostname = g_strdup(hostname);\n\n    /* load the known hosts file */\n    if (hostsfile) {\n        if (virFileExists(hostsfile)) {\n            if (libssh2_knownhost_readfile(sess->knownHosts,\n                                           hostsfile,\n                                           LIBSSH2_KNOWNHOST_FILE_OPENSSH) < 0) {\n                libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n                virReportError(VIR_ERR_SSH,\n                               _(\"unable to load knownhosts file '%s': %s\"),\n                               hostsfile, errmsg);\n                goto error;\n            }\n        } else if (!(flags & VIR_NET_SSH_HOSTKEY_FILE_CREATE)) {\n            virReportError(VIR_ERR_SSH,\n                           _(\"known hosts file '%s' does not exist\"),\n                           hostsfile);\n            goto error;\n        }\n\n        /* set filename only if writing to the known hosts file is requested */\n        if (!(flags & VIR_NET_SSH_HOSTKEY_FILE_READONLY)) {\n            VIR_FREE(sess->knownHostsFile);\n            sess->knownHostsFile = g_strdup(hostsfile);\n        }\n    }\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    virObjectUnlock(sess);\n    return -1;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1199
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "hostsfile"
          ],
          "line": 1191
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->knownHostsFile"
          ],
          "line": 1190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"known hosts file '%s' does not exist\")",
            "hostsfile"
          ],
          "line": 1182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"unable to load knownhosts file '%s': %s\")",
            "hostsfile",
            "errmsg"
          ],
          "line": 1176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_knownhost_readfile",
          "args": [
            "sess->knownHosts",
            "hostsfile",
            "LIBSSH2_KNOWNHOST_FILE_OPENSSH"
          ],
          "line": 1172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "hostsfile"
          ],
          "line": 1171
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->hostname"
          ],
          "line": 1165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1160
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nint\nvirNetSSHSessionSetHostKeyVerification(virNetSSHSessionPtr sess,\n                                       const char *hostname,\n                                       int port,\n                                       const char *hostsfile,\n                                       virNetSSHHostkeyVerify opt,\n                                       unsigned int flags)\n{\n    char *errmsg;\n\n    virObjectLock(sess);\n\n    sess->port = port;\n    sess->hostKeyVerify = opt;\n\n    VIR_FREE(sess->hostname);\n\n    sess->hostname = g_strdup(hostname);\n\n    /* load the known hosts file */\n    if (hostsfile) {\n        if (virFileExists(hostsfile)) {\n            if (libssh2_knownhost_readfile(sess->knownHosts,\n                                           hostsfile,\n                                           LIBSSH2_KNOWNHOST_FILE_OPENSSH) < 0) {\n                libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n                virReportError(VIR_ERR_SSH,\n                               _(\"unable to load knownhosts file '%s': %s\"),\n                               hostsfile, errmsg);\n                goto error;\n            }\n        } else if (!(flags & VIR_NET_SSH_HOSTKEY_FILE_CREATE)) {\n            virReportError(VIR_ERR_SSH,\n                           _(\"known hosts file '%s' does not exist\"),\n                           hostsfile);\n            goto error;\n        }\n\n        /* set filename only if writing to the known hosts file is requested */\n        if (!(flags & VIR_NET_SSH_HOSTKEY_FILE_READONLY)) {\n            VIR_FREE(sess->knownHostsFile);\n            sess->knownHostsFile = g_strdup(hostsfile);\n        }\n    }\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    virObjectUnlock(sess);\n    return -1;\n}"
  },
  {
    "function_name": "virNetSSHSessionSetChannelCommand",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1135-1148",
    "snippet": "int\nvirNetSSHSessionSetChannelCommand(virNetSSHSessionPtr sess,\n                                  const char *command)\n{\n    int ret = 0;\n    virObjectLock(sess);\n\n    VIR_FREE(sess->channelCommand);\n\n    sess->channelCommand = g_strdup(command);\n\n    virObjectUnlock(sess);\n    return ret;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1146
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "command"
          ],
          "line": 1144
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->channelCommand"
          ],
          "line": 1142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1140
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nint\nvirNetSSHSessionSetChannelCommand(virNetSSHSessionPtr sess,\n                                  const char *command)\n{\n    int ret = 0;\n    virObjectLock(sess);\n\n    VIR_FREE(sess->channelCommand);\n\n    sess->channelCommand = g_strdup(command);\n\n    virObjectUnlock(sess);\n    return ret;\n}"
  },
  {
    "function_name": "virNetSSHSessionAuthAddKeyboardAuth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1099-1133",
    "snippet": "int\nvirNetSSHSessionAuthAddKeyboardAuth(virNetSSHSessionPtr sess,\n                                    const char *username,\n                                    int tries)\n{\n    virNetSSHAuthMethodPtr auth;\n    char *user = NULL;\n\n    if (!username) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Username must be provided \"\n                         \"for ssh agent authentication\"));\n        return -1;\n    }\n\n    virObjectLock(sess);\n\n    user = g_strdup(username);\n\n    if (!(auth = virNetSSHSessionAuthMethodNew(sess)))\n        goto error;\n\n    auth->username = user;\n    auth->tries = tries;\n    auth->method = VIR_NET_SSH_AUTH_KEYBOARD_INTERACTIVE;\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    VIR_FREE(user);\n    virObjectUnlock(sess);\n    return -1;\n\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1130
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "user"
          ],
          "line": 1129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHSessionAuthMethodNew",
          "args": [
            "sess"
          ],
          "line": 1118
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHSessionAuthMethodNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "171-189",
          "snippet": "static virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "username"
          ],
          "line": 1116
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1114
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Username must be provided \"\n                         \"for ssh agent authentication\")"
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nint\nvirNetSSHSessionAuthAddKeyboardAuth(virNetSSHSessionPtr sess,\n                                    const char *username,\n                                    int tries)\n{\n    virNetSSHAuthMethodPtr auth;\n    char *user = NULL;\n\n    if (!username) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Username must be provided \"\n                         \"for ssh agent authentication\"));\n        return -1;\n    }\n\n    virObjectLock(sess);\n\n    user = g_strdup(username);\n\n    if (!(auth = virNetSSHSessionAuthMethodNew(sess)))\n        goto error;\n\n    auth->username = user;\n    auth->tries = tries;\n    auth->method = VIR_NET_SSH_AUTH_KEYBOARD_INTERACTIVE;\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    VIR_FREE(user);\n    virObjectUnlock(sess);\n    return -1;\n\n}"
  },
  {
    "function_name": "virNetSSHSessionAuthAddPrivKeyAuth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1055-1097",
    "snippet": "int\nvirNetSSHSessionAuthAddPrivKeyAuth(virNetSSHSessionPtr sess,\n                                   const char *username,\n                                   const char *keyfile,\n                                   const char *password)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    char *user = NULL;\n    char *pass = NULL;\n    char *file = NULL;\n\n    if (!username || !keyfile) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Username and key file path must be provided \"\n                         \"for private key authentication\"));\n        return -1;\n    }\n\n    virObjectLock(sess);\n\n    user = g_strdup(username);\n    file = g_strdup(keyfile);\n    pass = g_strdup(password);\n\n    if (!(auth = virNetSSHSessionAuthMethodNew(sess)))\n        goto error;\n\n    auth->username = user;\n    auth->password = pass;\n    auth->filename = file;\n    auth->method = VIR_NET_SSH_AUTH_PRIVKEY;\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    VIR_FREE(user);\n    VIR_FREE(pass);\n    VIR_FREE(file);\n    virObjectUnlock(sess);\n    return -1;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1095
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "file"
          ],
          "line": 1094
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pass"
          ],
          "line": 1093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "user"
          ],
          "line": 1092
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHSessionAuthMethodNew",
          "args": [
            "sess"
          ],
          "line": 1080
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHSessionAuthMethodNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "171-189",
          "snippet": "static virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "password"
          ],
          "line": 1078
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1074
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Username and key file path must be provided \"\n                         \"for private key authentication\")"
          ],
          "line": 1068
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nint\nvirNetSSHSessionAuthAddPrivKeyAuth(virNetSSHSessionPtr sess,\n                                   const char *username,\n                                   const char *keyfile,\n                                   const char *password)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    char *user = NULL;\n    char *pass = NULL;\n    char *file = NULL;\n\n    if (!username || !keyfile) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Username and key file path must be provided \"\n                         \"for private key authentication\"));\n        return -1;\n    }\n\n    virObjectLock(sess);\n\n    user = g_strdup(username);\n    file = g_strdup(keyfile);\n    pass = g_strdup(password);\n\n    if (!(auth = virNetSSHSessionAuthMethodNew(sess)))\n        goto error;\n\n    auth->username = user;\n    auth->password = pass;\n    auth->filename = file;\n    auth->method = VIR_NET_SSH_AUTH_PRIVKEY;\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    VIR_FREE(user);\n    VIR_FREE(pass);\n    VIR_FREE(file);\n    virObjectUnlock(sess);\n    return -1;\n}"
  },
  {
    "function_name": "virNetSSHSessionAuthAddAgentAuth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "1022-1053",
    "snippet": "int\nvirNetSSHSessionAuthAddAgentAuth(virNetSSHSessionPtr sess,\n                                 const char *username)\n{\n    virNetSSHAuthMethodPtr auth;\n    char *user = NULL;\n\n    if (!username) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Username must be provided \"\n                         \"for ssh agent authentication\"));\n        return -1;\n    }\n\n    virObjectLock(sess);\n\n    user = g_strdup(username);\n\n    if (!(auth = virNetSSHSessionAuthMethodNew(sess)))\n        goto error;\n\n    auth->username = user;\n    auth->method = VIR_NET_SSH_AUTH_AGENT;\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    VIR_FREE(user);\n    virObjectUnlock(sess);\n    return -1;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1051
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "user"
          ],
          "line": 1050
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHSessionAuthMethodNew",
          "args": [
            "sess"
          ],
          "line": 1040
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHSessionAuthMethodNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "171-189",
          "snippet": "static virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "username"
          ],
          "line": 1038
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1036
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Username must be provided \"\n                         \"for ssh agent authentication\")"
          ],
          "line": 1030
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nint\nvirNetSSHSessionAuthAddAgentAuth(virNetSSHSessionPtr sess,\n                                 const char *username)\n{\n    virNetSSHAuthMethodPtr auth;\n    char *user = NULL;\n\n    if (!username) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Username must be provided \"\n                         \"for ssh agent authentication\"));\n        return -1;\n    }\n\n    virObjectLock(sess);\n\n    user = g_strdup(username);\n\n    if (!(auth = virNetSSHSessionAuthMethodNew(sess)))\n        goto error;\n\n    auth->username = user;\n    auth->method = VIR_NET_SSH_AUTH_AGENT;\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    VIR_FREE(user);\n    virObjectUnlock(sess);\n    return -1;\n}"
  },
  {
    "function_name": "virNetSSHSessionAuthAddPasswordAuth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "982-1020",
    "snippet": "int\nvirNetSSHSessionAuthAddPasswordAuth(virNetSSHSessionPtr sess,\n                                    virURIPtr uri,\n                                    const char *username)\n{\n    virNetSSHAuthMethodPtr auth;\n    char *user = NULL;\n\n    if (uri) {\n        VIR_FREE(sess->authPath);\n\n        if (virAuthGetConfigFilePathURI(uri, &sess->authPath) < 0)\n            goto error;\n    }\n\n    if (!username) {\n        if (!(user = virAuthGetUsernamePath(sess->authPath, sess->cred,\n                                            \"ssh\", NULL, sess->hostname)))\n            goto error;\n    } else {\n        user = g_strdup(username);\n    }\n\n    virObjectLock(sess);\n\n    if (!(auth = virNetSSHSessionAuthMethodNew(sess)))\n        goto error;\n\n    auth->username = user;\n    auth->method = VIR_NET_SSH_AUTH_PASSWORD;\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    VIR_FREE(user);\n    virObjectUnlock(sess);\n    return -1;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 1018
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "user"
          ],
          "line": 1017
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHSessionAuthMethodNew",
          "args": [
            "sess"
          ],
          "line": 1007
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHSessionAuthMethodNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "171-189",
          "snippet": "static virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 1005
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "username"
          ],
          "line": 1002
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virAuthGetUsernamePath",
          "args": [
            "sess->authPath",
            "sess->cred",
            "\"ssh\"",
            "NULL",
            "sess->hostname"
          ],
          "line": 998
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetUsernamePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "133-194",
          "snippet": "char *\nvirAuthGetUsernamePath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *defaultUsername,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"username\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    if (defaultUsername != NULL) {\n        prompt = g_strdup_printf(_(\"Enter username for %s [%s]\"), hostname,\n                                 defaultUsername);\n    } else {\n        prompt = g_strdup_printf(_(\"Enter username for %s\"), hostname);\n    }\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_AUTHNAME)\n            continue;\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = VIR_CRED_AUTHNAME;\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = defaultUsername;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Username request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_AUTHNAME credential type\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nchar *\nvirAuthGetUsernamePath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *defaultUsername,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"username\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    if (defaultUsername != NULL) {\n        prompt = g_strdup_printf(_(\"Enter username for %s [%s]\"), hostname,\n                                 defaultUsername);\n    } else {\n        prompt = g_strdup_printf(_(\"Enter username for %s\"), hostname);\n    }\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_AUTHNAME)\n            continue;\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = VIR_CRED_AUTHNAME;\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = defaultUsername;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Username request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_AUTHNAME credential type\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virAuthGetConfigFilePathURI",
          "args": [
            "uri",
            "&sess->authPath"
          ],
          "line": 993
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetConfigFilePathURI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "40-91",
          "snippet": "int\nvirAuthGetConfigFilePathURI(virURIPtr uri,\n                            char **path)\n{\n    size_t i;\n    const char *authenv = getenv(\"LIBVIRT_AUTH_FILE\");\n    g_autofree char *userdir = NULL;\n\n    *path = NULL;\n\n    VIR_DEBUG(\"Determining auth config file path\");\n\n    if (authenv) {\n        VIR_DEBUG(\"Using path from env '%s'\", authenv);\n        *path = g_strdup(authenv);\n        return 0;\n    }\n\n    if (uri) {\n        for (i = 0; i < uri->paramsCount; i++) {\n            if (STREQ_NULLABLE(uri->params[i].name, \"authfile\") &&\n                uri->params[i].value) {\n                VIR_DEBUG(\"Using path from URI '%s'\", uri->params[i].value);\n                *path = g_strdup(uri->params[i].value);\n                return 0;\n            }\n        }\n    }\n\n    userdir = virGetUserConfigDirectory();\n\n    *path = g_strdup_printf(\"%s/auth.conf\", userdir);\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n    *path = g_strdup(SYSCONFDIR \"/libvirt/auth.conf\");\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n done:\n    VIR_DEBUG(\"Using auth file '%s'\", NULLSTR(*path));\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nint\nvirAuthGetConfigFilePathURI(virURIPtr uri,\n                            char **path)\n{\n    size_t i;\n    const char *authenv = getenv(\"LIBVIRT_AUTH_FILE\");\n    g_autofree char *userdir = NULL;\n\n    *path = NULL;\n\n    VIR_DEBUG(\"Determining auth config file path\");\n\n    if (authenv) {\n        VIR_DEBUG(\"Using path from env '%s'\", authenv);\n        *path = g_strdup(authenv);\n        return 0;\n    }\n\n    if (uri) {\n        for (i = 0; i < uri->paramsCount; i++) {\n            if (STREQ_NULLABLE(uri->params[i].name, \"authfile\") &&\n                uri->params[i].value) {\n                VIR_DEBUG(\"Using path from URI '%s'\", uri->params[i].value);\n                *path = g_strdup(uri->params[i].value);\n                return 0;\n            }\n        }\n    }\n\n    userdir = virGetUserConfigDirectory();\n\n    *path = g_strdup_printf(\"%s/auth.conf\", userdir);\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n    *path = g_strdup(SYSCONFDIR \"/libvirt/auth.conf\");\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n done:\n    VIR_DEBUG(\"Using auth file '%s'\", NULLSTR(*path));\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->authPath"
          ],
          "line": 991
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nint\nvirNetSSHSessionAuthAddPasswordAuth(virNetSSHSessionPtr sess,\n                                    virURIPtr uri,\n                                    const char *username)\n{\n    virNetSSHAuthMethodPtr auth;\n    char *user = NULL;\n\n    if (uri) {\n        VIR_FREE(sess->authPath);\n\n        if (virAuthGetConfigFilePathURI(uri, &sess->authPath) < 0)\n            goto error;\n    }\n\n    if (!username) {\n        if (!(user = virAuthGetUsernamePath(sess->authPath, sess->cred,\n                                            \"ssh\", NULL, sess->hostname)))\n            goto error;\n    } else {\n        user = g_strdup(username);\n    }\n\n    virObjectLock(sess);\n\n    if (!(auth = virNetSSHSessionAuthMethodNew(sess)))\n        goto error;\n\n    auth->username = user;\n    auth->method = VIR_NET_SSH_AUTH_PASSWORD;\n\n    virObjectUnlock(sess);\n    return 0;\n\n error:\n    VIR_FREE(user);\n    virObjectUnlock(sess);\n    return -1;\n}"
  },
  {
    "function_name": "virNetSSHSessionAuthReset",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "974-980",
    "snippet": "void\nvirNetSSHSessionAuthReset(virNetSSHSessionPtr sess)\n{\n    virObjectLock(sess);\n    virNetSSHSessionAuthMethodsFree(sess);\n    virObjectUnlock(sess);\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 979
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetSSHSessionAuthMethodsFree",
          "args": [
            "sess"
          ],
          "line": 978
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHSessionAuthMethodsFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "115-129",
          "snippet": "static void\nvirNetSSHSessionAuthMethodsFree(virNetSSHSessionPtr sess)\n{\n    size_t i;\n\n    for (i = 0; i < sess->nauths; i++) {\n        VIR_FREE(sess->auths[i]->username);\n        VIR_FREE(sess->auths[i]->password);\n        VIR_FREE(sess->auths[i]->filename);\n        VIR_FREE(sess->auths[i]);\n    }\n\n    VIR_FREE(sess->auths);\n    sess->nauths = 0;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic void\nvirNetSSHSessionAuthMethodsFree(virNetSSHSessionPtr sess)\n{\n    size_t i;\n\n    for (i = 0; i < sess->nauths; i++) {\n        VIR_FREE(sess->auths[i]->username);\n        VIR_FREE(sess->auths[i]->password);\n        VIR_FREE(sess->auths[i]->filename);\n        VIR_FREE(sess->auths[i]);\n    }\n\n    VIR_FREE(sess->auths);\n    sess->nauths = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 977
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nvoid\nvirNetSSHSessionAuthReset(virNetSSHSessionPtr sess)\n{\n    virObjectLock(sess);\n    virNetSSHSessionAuthMethodsFree(sess);\n    virObjectUnlock(sess);\n}"
  },
  {
    "function_name": "virNetSSHSessionAuthSetCallback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "964-972",
    "snippet": "int\nvirNetSSHSessionAuthSetCallback(virNetSSHSessionPtr sess,\n                                virConnectAuthPtr auth)\n{\n    virObjectLock(sess);\n    sess->cred = auth;\n    virObjectUnlock(sess);\n    return 0;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "sess"
          ],
          "line": 970
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "sess"
          ],
          "line": 968
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nint\nvirNetSSHSessionAuthSetCallback(virNetSSHSessionPtr sess,\n                                virConnectAuthPtr auth)\n{\n    virObjectLock(sess);\n    sess->cred = auth;\n    virObjectUnlock(sess);\n    return 0;\n}"
  },
  {
    "function_name": "virNetSSHValidateConfig",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "935-961",
    "snippet": "static int\nvirNetSSHValidateConfig(virNetSSHSessionPtr sess)\n{\n    if (sess->nauths == 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No authentication methods and credentials \"\n                         \"provided\"));\n        return -1;\n    }\n\n    if (!sess->channelCommand) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No channel command provided\"));\n        return -1;\n    }\n\n    if (sess->hostKeyVerify != VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE) {\n        if (!sess->hostname) {\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Hostname is needed for host key verification\"));\n            return -1;\n        }\n    }\n\n    /* everything ok */\n    return 0;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Hostname is needed for host key verification\")"
          ],
          "line": 953
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Hostname is needed for host key verification\""
          ],
          "line": 954
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"No channel command provided\")"
          ],
          "line": 946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"No authentication methods and credentials \"\n                         \"provided\")"
          ],
          "line": 939
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHValidateConfig(virNetSSHSessionPtr sess)\n{\n    if (sess->nauths == 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No authentication methods and credentials \"\n                         \"provided\"));\n        return -1;\n    }\n\n    if (!sess->channelCommand) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No channel command provided\"));\n        return -1;\n    }\n\n    if (sess->hostKeyVerify != VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE) {\n        if (!sess->hostname) {\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Hostname is needed for host key verification\"));\n            return -1;\n        }\n    }\n\n    /* everything ok */\n    return 0;\n}"
  },
  {
    "function_name": "virNetSSHOpenChannel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "904-932",
    "snippet": "static int\nvirNetSSHOpenChannel(virNetSSHSessionPtr sess)\n{\n    char *errmsg;\n\n    sess->channel = libssh2_channel_open_session(sess->session);\n    if (!sess->channel) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to open ssh channel: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    if (libssh2_channel_exec(sess->channel, sess->channelCommand) != 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to execute command '%s': %s\"),\n                       sess->channelCommand,\n                       errmsg);\n        return -1;\n    }\n\n    /* nonblocking mode - currently does nothing */\n    libssh2_channel_set_blocking(sess->channel, 0);\n\n    /* channel open */\n    return 0;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "libssh2_channel_set_blocking",
          "args": [
            "sess->channel",
            "0"
          ],
          "line": 928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"failed to execute command '%s': %s\")",
            "sess->channelCommand",
            "errmsg"
          ],
          "line": 920
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to execute command '%s': %s\""
          ],
          "line": 921
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 919
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_exec",
          "args": [
            "sess->channel",
            "sess->channelCommand"
          ],
          "line": 918
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"failed to open ssh channel: %s\")",
            "errmsg"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 911
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_open_session",
          "args": [
            "sess->session"
          ],
          "line": 909
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHOpenChannel(virNetSSHSessionPtr sess)\n{\n    char *errmsg;\n\n    sess->channel = libssh2_channel_open_session(sess->session);\n    if (!sess->channel) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to open ssh channel: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    if (libssh2_channel_exec(sess->channel, sess->channelCommand) != 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to execute command '%s': %s\"),\n                       sess->channelCommand,\n                       errmsg);\n        return -1;\n    }\n\n    /* nonblocking mode - currently does nothing */\n    libssh2_channel_set_blocking(sess->channel, 0);\n\n    /* channel open */\n    return 0;\n}"
  },
  {
    "function_name": "virNetSSHAuthenticate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "811-901",
    "snippet": "static int\nvirNetSSHAuthenticate(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n    bool no_method = false;\n    bool auth_failed = false;\n    char *auth_list;\n    char *errmsg;\n    size_t i;\n    int ret;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (!sess->nauths) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No authentication methods and credentials \"\n                         \"provided\"));\n        return -1;\n    }\n\n    /* obtain list of supported auth methods */\n    auth_list = libssh2_userauth_list(sess->session,\n                                      sess->auths[0]->username,\n                                      strlen(sess->auths[0]->username));\n    if (!auth_list) {\n        /* unlikely event, authentication succeeded with NONE as method */\n        if (libssh2_userauth_authenticated(sess->session) == 1)\n            return 0;\n\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"couldn't retrieve authentication methods list: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    for (i = 0; i < sess->nauths; i++) {\n        auth = sess->auths[i];\n\n        ret = 2;\n        virResetLastError();\n\n        switch (auth->method) {\n        case VIR_NET_SSH_AUTH_KEYBOARD_INTERACTIVE:\n            if (strstr(auth_list, \"keyboard-interactive\"))\n                ret = virNetSSHAuthenticateKeyboardInteractive(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_AGENT:\n            if (strstr(auth_list, \"publickey\"))\n                ret = virNetSSHAuthenticateAgent(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_PRIVKEY:\n            if (strstr(auth_list, \"publickey\"))\n                ret = virNetSSHAuthenticatePrivkey(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_PASSWORD:\n            if (strstr(auth_list, \"password\"))\n                ret = virNetSSHAuthenticatePassword(sess, auth);\n            break;\n        }\n\n        /* return on success or error */\n        if (ret <= 0)\n            return ret;\n\n        /* the authentication method is not supported */\n        if (ret == 2)\n            no_method = true;\n\n        /* authentication with this method has failed */\n        if (ret == 1)\n            auth_failed = true;\n    }\n\n    if (sess->nauths == 0) {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"No authentication methods supplied\"));\n    } else if (sess->nauths == 1) {\n        /* pass through the error */\n    } else if (no_method && !auth_failed) {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"None of the requested authentication methods \"\n                         \"are supported by the server\"));\n    } else {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"All provided authentication methods with credentials \"\n                         \"were rejected by the server\"));\n    }\n\n    return -1;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"All provided authentication methods with credentials \"\n                         \"were rejected by the server\")"
          ],
          "line": 895
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"All provided authentication methods with credentials \"\n                         \"were rejected by the server\""
          ],
          "line": 896
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"None of the requested authentication methods \"\n                         \"are supported by the server\")"
          ],
          "line": 891
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"No authentication methods supplied\")"
          ],
          "line": 886
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHAuthenticatePassword",
          "args": [
            "sess",
            "auth"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHAuthenticatePassword",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "672-737",
          "snippet": "static int\nvirNetSSHAuthenticatePassword(virNetSSHSessionPtr sess,\n                              virNetSSHAuthMethodPtr priv)\n{\n    char *password = NULL;\n    char *errmsg;\n    int ret = -1;\n    int rc;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (priv->password) {\n        /* tunelled password authentication */\n        if ((rc = libssh2_userauth_password(sess->session,\n                                            priv->username,\n                                            priv->password)) == 0) {\n            ret = 0;\n            goto cleanup;\n        }\n    } else {\n        /* password authentication with interactive password request */\n        if (!sess->cred || !sess->cred->cb) {\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Can't perform authentication: \"\n                             \"Authentication callback not provided\"));\n            goto cleanup;\n        }\n\n        /* Try the authenticating the set amount of times. The server breaks the\n         * connection if maximum number of bad auth tries is exceeded */\n        while (true) {\n            if (!(password = virAuthGetPasswordPath(sess->authPath, sess->cred,\n                                                    \"ssh\", priv->username,\n                                                    sess->hostname)))\n                goto cleanup;\n\n            /* tunelled password authentication */\n            if ((rc = libssh2_userauth_password(sess->session,\n                                                priv->username,\n                                                password)) == 0) {\n                ret = 0;\n                goto cleanup;\n            }\n\n            if (rc != LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n                break;\n\n            VIR_FREE(password);\n        }\n    }\n\n    /* error path */\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"authentication failed: %s\"), errmsg);\n\n    /* determine exist status */\n    if (rc == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n        ret = 1;\n    else\n        ret = -1;\n\n cleanup:\n    VIR_FREE(password);\n    return ret;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticatePassword(virNetSSHSessionPtr sess,\n                              virNetSSHAuthMethodPtr priv)\n{\n    char *password = NULL;\n    char *errmsg;\n    int ret = -1;\n    int rc;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (priv->password) {\n        /* tunelled password authentication */\n        if ((rc = libssh2_userauth_password(sess->session,\n                                            priv->username,\n                                            priv->password)) == 0) {\n            ret = 0;\n            goto cleanup;\n        }\n    } else {\n        /* password authentication with interactive password request */\n        if (!sess->cred || !sess->cred->cb) {\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Can't perform authentication: \"\n                             \"Authentication callback not provided\"));\n            goto cleanup;\n        }\n\n        /* Try the authenticating the set amount of times. The server breaks the\n         * connection if maximum number of bad auth tries is exceeded */\n        while (true) {\n            if (!(password = virAuthGetPasswordPath(sess->authPath, sess->cred,\n                                                    \"ssh\", priv->username,\n                                                    sess->hostname)))\n                goto cleanup;\n\n            /* tunelled password authentication */\n            if ((rc = libssh2_userauth_password(sess->session,\n                                                priv->username,\n                                                password)) == 0) {\n                ret = 0;\n                goto cleanup;\n            }\n\n            if (rc != LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n                break;\n\n            VIR_FREE(password);\n        }\n    }\n\n    /* error path */\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"authentication failed: %s\"), errmsg);\n\n    /* determine exist status */\n    if (rc == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n        ret = 1;\n    else\n        ret = -1;\n\n cleanup:\n    VIR_FREE(password);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "auth_list",
            "\"password\""
          ],
          "line": 867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHAuthenticatePrivkey",
          "args": [
            "sess",
            "auth"
          ],
          "line": 864
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHAuthenticatePrivkey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "565-663",
          "snippet": "static int\nvirNetSSHAuthenticatePrivkey(virNetSSHSessionPtr sess,\n                             virNetSSHAuthMethodPtr priv)\n{\n    virConnectCredential retr_passphrase;\n    size_t i;\n    char *errmsg;\n    int ret;\n    char *tmp;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    /* try open the key with no password */\n    if ((ret = libssh2_userauth_publickey_fromfile(sess->session,\n                                                   priv->username,\n                                                   NULL,\n                                                   priv->filename,\n                                                   priv->password)) == 0)\n        return 0; /* success */\n\n    VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n    if (priv->password ||\n        ret == LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED ||\n        ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED) {\n    VIR_WARNINGS_RESET\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"authentication with private key '%s' \"\n                         \"has failed: %s\"),\n                       priv->filename, errmsg);\n        return 1; /* auth failed */\n    }\n\n    /* request user's key password */\n    if (!sess->cred || !sess->cred->cb) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No user interaction callback provided: \"\n                         \"Can't retrieve private key passphrase\"));\n        return -1;\n    }\n\n    memset(&retr_passphrase, 0, sizeof(virConnectCredential));\n    retr_passphrase.type = -1;\n\n    for (i = 0; i < sess->cred->ncredtype; i++) {\n        if (sess->cred->credtype[i] == VIR_CRED_PASSPHRASE ||\n            sess->cred->credtype[i] == VIR_CRED_NOECHOPROMPT) {\n            retr_passphrase.type = sess->cred->credtype[i];\n            break;\n        }\n    }\n\n    if (retr_passphrase.type < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"no suitable method to retrieve key passphrase\"));\n        return -1;\n    }\n\n    retr_passphrase.prompt = g_strdup_printf(_(\"Passphrase for key '%s'\"),\n                                             priv->filename);\n\n    if (sess->cred->cb(&retr_passphrase, 1, sess->cred->cbdata)) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"failed to retrieve private key passphrase: \"\n                         \"callback has failed\"));\n        tmp = (char *)retr_passphrase.prompt;\n        VIR_FREE(tmp);\n        return -1;\n    }\n\n    tmp = (char *)retr_passphrase.prompt;\n    VIR_FREE(tmp);\n\n    ret = libssh2_userauth_publickey_fromfile(sess->session,\n                                              priv->username,\n                                              NULL,\n                                              priv->filename,\n                                              retr_passphrase.result);\n\n    VIR_FREE(retr_passphrase.result);\n\n    if (ret < 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"authentication with private key '%s' \"\n                         \"has failed: %s\"),\n                       priv->filename, errmsg);\n\n        VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n        if (ret == LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED ||\n            ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n            return 1;\n        else\n            return -1;\n        VIR_WARNINGS_RESET\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticatePrivkey(virNetSSHSessionPtr sess,\n                             virNetSSHAuthMethodPtr priv)\n{\n    virConnectCredential retr_passphrase;\n    size_t i;\n    char *errmsg;\n    int ret;\n    char *tmp;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    /* try open the key with no password */\n    if ((ret = libssh2_userauth_publickey_fromfile(sess->session,\n                                                   priv->username,\n                                                   NULL,\n                                                   priv->filename,\n                                                   priv->password)) == 0)\n        return 0; /* success */\n\n    VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n    if (priv->password ||\n        ret == LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED ||\n        ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED) {\n    VIR_WARNINGS_RESET\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"authentication with private key '%s' \"\n                         \"has failed: %s\"),\n                       priv->filename, errmsg);\n        return 1; /* auth failed */\n    }\n\n    /* request user's key password */\n    if (!sess->cred || !sess->cred->cb) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No user interaction callback provided: \"\n                         \"Can't retrieve private key passphrase\"));\n        return -1;\n    }\n\n    memset(&retr_passphrase, 0, sizeof(virConnectCredential));\n    retr_passphrase.type = -1;\n\n    for (i = 0; i < sess->cred->ncredtype; i++) {\n        if (sess->cred->credtype[i] == VIR_CRED_PASSPHRASE ||\n            sess->cred->credtype[i] == VIR_CRED_NOECHOPROMPT) {\n            retr_passphrase.type = sess->cred->credtype[i];\n            break;\n        }\n    }\n\n    if (retr_passphrase.type < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"no suitable method to retrieve key passphrase\"));\n        return -1;\n    }\n\n    retr_passphrase.prompt = g_strdup_printf(_(\"Passphrase for key '%s'\"),\n                                             priv->filename);\n\n    if (sess->cred->cb(&retr_passphrase, 1, sess->cred->cbdata)) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"failed to retrieve private key passphrase: \"\n                         \"callback has failed\"));\n        tmp = (char *)retr_passphrase.prompt;\n        VIR_FREE(tmp);\n        return -1;\n    }\n\n    tmp = (char *)retr_passphrase.prompt;\n    VIR_FREE(tmp);\n\n    ret = libssh2_userauth_publickey_fromfile(sess->session,\n                                              priv->username,\n                                              NULL,\n                                              priv->filename,\n                                              retr_passphrase.result);\n\n    VIR_FREE(retr_passphrase.result);\n\n    if (ret < 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"authentication with private key '%s' \"\n                         \"has failed: %s\"),\n                       priv->filename, errmsg);\n\n        VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n        if (ret == LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED ||\n            ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n            return 1;\n        else\n            return -1;\n        VIR_WARNINGS_RESET\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "auth_list",
            "\"publickey\""
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHAuthenticateAgent",
          "args": [
            "sess",
            "auth"
          ],
          "line": 860
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHAuthenticateAgent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "491-557",
          "snippet": "static int\nvirNetSSHAuthenticateAgent(virNetSSHSessionPtr sess,\n                           virNetSSHAuthMethodPtr priv)\n{\n    struct libssh2_agent_publickey *agent_identity = NULL;\n    bool no_identity = true;\n    int ret;\n    char *errmsg;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (libssh2_agent_connect(sess->agent) < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to connect to ssh agent\"));\n        return 1;\n    }\n\n    if (libssh2_agent_list_identities(sess->agent) < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to list ssh agent identities\"));\n        return 1;\n    }\n\n    while (!(ret = libssh2_agent_get_identity(sess->agent,\n                                              &agent_identity,\n                                              agent_identity))) {\n        no_identity = false;\n        if (!(ret = libssh2_agent_userauth(sess->agent,\n                                           priv->username,\n                                           agent_identity)))\n            return 0; /* key accepted */\n\n        VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n        if (ret != LIBSSH2_ERROR_AUTHENTICATION_FAILED &&\n            ret != LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED &&\n            ret != LIBSSH2_ERROR_PUBLICKEY_UNVERIFIED) {\n        VIR_WARNINGS_RESET\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_AUTH_FAILED,\n                           _(\"failed to authenticate using SSH agent: %s\"),\n                           errmsg);\n            return -1;\n        }\n        /* authentication has failed, try next key */\n    }\n\n    /* if there are no more keys in the agent, the identity retrieval\n     * function returns 1 */\n    if (ret == 1) {\n        if (no_identity) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"SSH Agent did not provide any \"\n                             \"authentication identity\"));\n        } else {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"All identities provided by the SSH Agent \"\n                             \"were rejected\"));\n        }\n        return 1;\n    }\n\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"failed to authenticate using SSH agent: %s\"),\n                   errmsg);\n    return -1;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticateAgent(virNetSSHSessionPtr sess,\n                           virNetSSHAuthMethodPtr priv)\n{\n    struct libssh2_agent_publickey *agent_identity = NULL;\n    bool no_identity = true;\n    int ret;\n    char *errmsg;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (libssh2_agent_connect(sess->agent) < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to connect to ssh agent\"));\n        return 1;\n    }\n\n    if (libssh2_agent_list_identities(sess->agent) < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to list ssh agent identities\"));\n        return 1;\n    }\n\n    while (!(ret = libssh2_agent_get_identity(sess->agent,\n                                              &agent_identity,\n                                              agent_identity))) {\n        no_identity = false;\n        if (!(ret = libssh2_agent_userauth(sess->agent,\n                                           priv->username,\n                                           agent_identity)))\n            return 0; /* key accepted */\n\n        VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n        if (ret != LIBSSH2_ERROR_AUTHENTICATION_FAILED &&\n            ret != LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED &&\n            ret != LIBSSH2_ERROR_PUBLICKEY_UNVERIFIED) {\n        VIR_WARNINGS_RESET\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_AUTH_FAILED,\n                           _(\"failed to authenticate using SSH agent: %s\"),\n                           errmsg);\n            return -1;\n        }\n        /* authentication has failed, try next key */\n    }\n\n    /* if there are no more keys in the agent, the identity retrieval\n     * function returns 1 */\n    if (ret == 1) {\n        if (no_identity) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"SSH Agent did not provide any \"\n                             \"authentication identity\"));\n        } else {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"All identities provided by the SSH Agent \"\n                             \"were rejected\"));\n        }\n        return 1;\n    }\n\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"failed to authenticate using SSH agent: %s\"),\n                   errmsg);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "auth_list",
            "\"publickey\""
          ],
          "line": 859
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHAuthenticateKeyboardInteractive",
          "args": [
            "sess",
            "auth"
          ],
          "line": 856
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHAuthenticateKeyboardInteractive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "746-808",
          "snippet": "static int\nvirNetSSHAuthenticateKeyboardInteractive(virNetSSHSessionPtr sess,\n                                         virNetSSHAuthMethodPtr priv)\n{\n    char *errmsg;\n    int ret;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (!sess->cred || !sess->cred->cb) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Can't perform keyboard-interactive authentication: \"\n                         \"Authentication callback not provided \"));\n        return -1;\n    }\n\n    /* Try the authenticating the set amount of times. The server breaks the\n     * connection if maximum number of bad auth tries is exceeded */\n    while (priv->tries < 0 || priv->tries-- > 0) {\n        ret = libssh2_userauth_keyboard_interactive(sess->session,\n                                                    priv->username,\n                                                    virNetSSHKbIntCb);\n\n        /* check for errors while calling the callback */\n        switch (sess->authCbErr) {\n        case VIR_NET_SSH_AUTHCB_NO_METHOD:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"no suitable method to retrieve \"\n                             \"authentication credentials\"));\n            return -1;\n        case VIR_NET_SSH_AUTHCB_OOM:\n            /* OOM error already reported */\n            return -1;\n        case VIR_NET_SSH_AUTHCB_RETR_ERR:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"failed to retrieve credentials\"));\n            return -1;\n        case VIR_NET_SSH_AUTHCB_OK:\n            /* everything went fine, let's continue */\n            break;\n        }\n\n        if (ret == 0)\n            /* authentication succeeded */\n            return 0;\n\n        if (ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n            continue; /* try again */\n\n        if (ret < 0) {\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_AUTH_FAILED,\n                           _(\"keyboard interactive authentication failed: %s\"),\n                           errmsg);\n            return -1;\n        }\n    }\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"keyboard interactive authentication failed: %s\"),\n                   errmsg);\n    return 1;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticateKeyboardInteractive(virNetSSHSessionPtr sess,\n                                         virNetSSHAuthMethodPtr priv)\n{\n    char *errmsg;\n    int ret;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (!sess->cred || !sess->cred->cb) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Can't perform keyboard-interactive authentication: \"\n                         \"Authentication callback not provided \"));\n        return -1;\n    }\n\n    /* Try the authenticating the set amount of times. The server breaks the\n     * connection if maximum number of bad auth tries is exceeded */\n    while (priv->tries < 0 || priv->tries-- > 0) {\n        ret = libssh2_userauth_keyboard_interactive(sess->session,\n                                                    priv->username,\n                                                    virNetSSHKbIntCb);\n\n        /* check for errors while calling the callback */\n        switch (sess->authCbErr) {\n        case VIR_NET_SSH_AUTHCB_NO_METHOD:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"no suitable method to retrieve \"\n                             \"authentication credentials\"));\n            return -1;\n        case VIR_NET_SSH_AUTHCB_OOM:\n            /* OOM error already reported */\n            return -1;\n        case VIR_NET_SSH_AUTHCB_RETR_ERR:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"failed to retrieve credentials\"));\n            return -1;\n        case VIR_NET_SSH_AUTHCB_OK:\n            /* everything went fine, let's continue */\n            break;\n        }\n\n        if (ret == 0)\n            /* authentication succeeded */\n            return 0;\n\n        if (ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n            continue; /* try again */\n\n        if (ret < 0) {\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_AUTH_FAILED,\n                           _(\"keyboard interactive authentication failed: %s\"),\n                           errmsg);\n            return -1;\n        }\n    }\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"keyboard interactive authentication failed: %s\"),\n                   errmsg);\n    return 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "auth_list",
            "\"keyboard-interactive\""
          ],
          "line": 855
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 851
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"couldn't retrieve authentication methods list: %s\")",
            "errmsg"
          ],
          "line": 841
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 840
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_userauth_authenticated",
          "args": [
            "sess->session"
          ],
          "line": 837
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_userauth_list",
          "args": [
            "sess->session",
            "sess->auths[0]->username",
            "strlen(sess->auths[0]->username)"
          ],
          "line": 832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "sess->auths[0]->username"
          ],
          "line": 834
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"No authentication methods and credentials \"\n                         \"provided\")"
          ],
          "line": 825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"sess=%p\"",
            "sess"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticate(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n    bool no_method = false;\n    bool auth_failed = false;\n    char *auth_list;\n    char *errmsg;\n    size_t i;\n    int ret;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (!sess->nauths) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No authentication methods and credentials \"\n                         \"provided\"));\n        return -1;\n    }\n\n    /* obtain list of supported auth methods */\n    auth_list = libssh2_userauth_list(sess->session,\n                                      sess->auths[0]->username,\n                                      strlen(sess->auths[0]->username));\n    if (!auth_list) {\n        /* unlikely event, authentication succeeded with NONE as method */\n        if (libssh2_userauth_authenticated(sess->session) == 1)\n            return 0;\n\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"couldn't retrieve authentication methods list: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    for (i = 0; i < sess->nauths; i++) {\n        auth = sess->auths[i];\n\n        ret = 2;\n        virResetLastError();\n\n        switch (auth->method) {\n        case VIR_NET_SSH_AUTH_KEYBOARD_INTERACTIVE:\n            if (strstr(auth_list, \"keyboard-interactive\"))\n                ret = virNetSSHAuthenticateKeyboardInteractive(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_AGENT:\n            if (strstr(auth_list, \"publickey\"))\n                ret = virNetSSHAuthenticateAgent(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_PRIVKEY:\n            if (strstr(auth_list, \"publickey\"))\n                ret = virNetSSHAuthenticatePrivkey(sess, auth);\n            break;\n        case VIR_NET_SSH_AUTH_PASSWORD:\n            if (strstr(auth_list, \"password\"))\n                ret = virNetSSHAuthenticatePassword(sess, auth);\n            break;\n        }\n\n        /* return on success or error */\n        if (ret <= 0)\n            return ret;\n\n        /* the authentication method is not supported */\n        if (ret == 2)\n            no_method = true;\n\n        /* authentication with this method has failed */\n        if (ret == 1)\n            auth_failed = true;\n    }\n\n    if (sess->nauths == 0) {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"No authentication methods supplied\"));\n    } else if (sess->nauths == 1) {\n        /* pass through the error */\n    } else if (no_method && !auth_failed) {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"None of the requested authentication methods \"\n                         \"are supported by the server\"));\n    } else {\n        virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                       _(\"All provided authentication methods with credentials \"\n                         \"were rejected by the server\"));\n    }\n\n    return -1;\n}"
  },
  {
    "function_name": "virNetSSHAuthenticateKeyboardInteractive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "746-808",
    "snippet": "static int\nvirNetSSHAuthenticateKeyboardInteractive(virNetSSHSessionPtr sess,\n                                         virNetSSHAuthMethodPtr priv)\n{\n    char *errmsg;\n    int ret;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (!sess->cred || !sess->cred->cb) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Can't perform keyboard-interactive authentication: \"\n                         \"Authentication callback not provided \"));\n        return -1;\n    }\n\n    /* Try the authenticating the set amount of times. The server breaks the\n     * connection if maximum number of bad auth tries is exceeded */\n    while (priv->tries < 0 || priv->tries-- > 0) {\n        ret = libssh2_userauth_keyboard_interactive(sess->session,\n                                                    priv->username,\n                                                    virNetSSHKbIntCb);\n\n        /* check for errors while calling the callback */\n        switch (sess->authCbErr) {\n        case VIR_NET_SSH_AUTHCB_NO_METHOD:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"no suitable method to retrieve \"\n                             \"authentication credentials\"));\n            return -1;\n        case VIR_NET_SSH_AUTHCB_OOM:\n            /* OOM error already reported */\n            return -1;\n        case VIR_NET_SSH_AUTHCB_RETR_ERR:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"failed to retrieve credentials\"));\n            return -1;\n        case VIR_NET_SSH_AUTHCB_OK:\n            /* everything went fine, let's continue */\n            break;\n        }\n\n        if (ret == 0)\n            /* authentication succeeded */\n            return 0;\n\n        if (ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n            continue; /* try again */\n\n        if (ret < 0) {\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_AUTH_FAILED,\n                           _(\"keyboard interactive authentication failed: %s\"),\n                           errmsg);\n            return -1;\n        }\n    }\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"keyboard interactive authentication failed: %s\"),\n                   errmsg);\n    return 1;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "_(\"keyboard interactive authentication failed: %s\")",
            "errmsg"
          ],
          "line": 804
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"keyboard interactive authentication failed: %s\""
          ],
          "line": 805
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 803
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "_(\"keyboard interactive authentication failed: %s\")",
            "errmsg"
          ],
          "line": 797
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 796
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"failed to retrieve credentials\")"
          ],
          "line": 780
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"no suitable method to retrieve \"\n                             \"authentication credentials\")"
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_userauth_keyboard_interactive",
          "args": [
            "sess->session",
            "priv->username",
            "virNetSSHKbIntCb"
          ],
          "line": 765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Can't perform keyboard-interactive authentication: \"\n                         \"Authentication callback not provided \")"
          ],
          "line": 756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"sess=%p\"",
            "sess"
          ],
          "line": 753
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticateKeyboardInteractive(virNetSSHSessionPtr sess,\n                                         virNetSSHAuthMethodPtr priv)\n{\n    char *errmsg;\n    int ret;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (!sess->cred || !sess->cred->cb) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Can't perform keyboard-interactive authentication: \"\n                         \"Authentication callback not provided \"));\n        return -1;\n    }\n\n    /* Try the authenticating the set amount of times. The server breaks the\n     * connection if maximum number of bad auth tries is exceeded */\n    while (priv->tries < 0 || priv->tries-- > 0) {\n        ret = libssh2_userauth_keyboard_interactive(sess->session,\n                                                    priv->username,\n                                                    virNetSSHKbIntCb);\n\n        /* check for errors while calling the callback */\n        switch (sess->authCbErr) {\n        case VIR_NET_SSH_AUTHCB_NO_METHOD:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"no suitable method to retrieve \"\n                             \"authentication credentials\"));\n            return -1;\n        case VIR_NET_SSH_AUTHCB_OOM:\n            /* OOM error already reported */\n            return -1;\n        case VIR_NET_SSH_AUTHCB_RETR_ERR:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"failed to retrieve credentials\"));\n            return -1;\n        case VIR_NET_SSH_AUTHCB_OK:\n            /* everything went fine, let's continue */\n            break;\n        }\n\n        if (ret == 0)\n            /* authentication succeeded */\n            return 0;\n\n        if (ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n            continue; /* try again */\n\n        if (ret < 0) {\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_AUTH_FAILED,\n                           _(\"keyboard interactive authentication failed: %s\"),\n                           errmsg);\n            return -1;\n        }\n    }\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"keyboard interactive authentication failed: %s\"),\n                   errmsg);\n    return 1;\n}"
  },
  {
    "function_name": "virNetSSHAuthenticatePassword",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "672-737",
    "snippet": "static int\nvirNetSSHAuthenticatePassword(virNetSSHSessionPtr sess,\n                              virNetSSHAuthMethodPtr priv)\n{\n    char *password = NULL;\n    char *errmsg;\n    int ret = -1;\n    int rc;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (priv->password) {\n        /* tunelled password authentication */\n        if ((rc = libssh2_userauth_password(sess->session,\n                                            priv->username,\n                                            priv->password)) == 0) {\n            ret = 0;\n            goto cleanup;\n        }\n    } else {\n        /* password authentication with interactive password request */\n        if (!sess->cred || !sess->cred->cb) {\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Can't perform authentication: \"\n                             \"Authentication callback not provided\"));\n            goto cleanup;\n        }\n\n        /* Try the authenticating the set amount of times. The server breaks the\n         * connection if maximum number of bad auth tries is exceeded */\n        while (true) {\n            if (!(password = virAuthGetPasswordPath(sess->authPath, sess->cred,\n                                                    \"ssh\", priv->username,\n                                                    sess->hostname)))\n                goto cleanup;\n\n            /* tunelled password authentication */\n            if ((rc = libssh2_userauth_password(sess->session,\n                                                priv->username,\n                                                password)) == 0) {\n                ret = 0;\n                goto cleanup;\n            }\n\n            if (rc != LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n                break;\n\n            VIR_FREE(password);\n        }\n    }\n\n    /* error path */\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"authentication failed: %s\"), errmsg);\n\n    /* determine exist status */\n    if (rc == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n        ret = 1;\n    else\n        ret = -1;\n\n cleanup:\n    VIR_FREE(password);\n    return ret;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "password"
          ],
          "line": 735
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "_(\"authentication failed: %s\")",
            "errmsg"
          ],
          "line": 725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"authentication failed: %s\""
          ],
          "line": 726
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "password"
          ],
          "line": 719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_userauth_password",
          "args": [
            "sess->session",
            "priv->username",
            "password"
          ],
          "line": 709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virAuthGetPasswordPath",
          "args": [
            "sess->authPath",
            "sess->cred",
            "\"ssh\"",
            "priv->username",
            "sess->hostname"
          ],
          "line": 703
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetPasswordPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "214-273",
          "snippet": "char *\nvirAuthGetPasswordPath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *username,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"password\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    prompt = g_strdup_printf(_(\"Enter %s's password for %s\"), username, hostname);\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_PASSPHRASE &&\n            auth->credtype[ncred] != VIR_CRED_NOECHOPROMPT) {\n            continue;\n        }\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = auth->credtype[ncred];\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = NULL;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Password request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_PASSPHRASE or VIR_CRED_NOECHOPROMPT \"\n                     \"credential type\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nchar *\nvirAuthGetPasswordPath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *username,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"password\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    prompt = g_strdup_printf(_(\"Enter %s's password for %s\"), username, hostname);\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_PASSPHRASE &&\n            auth->credtype[ncred] != VIR_CRED_NOECHOPROMPT) {\n            continue;\n        }\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = auth->credtype[ncred];\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = NULL;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Password request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_PASSPHRASE or VIR_CRED_NOECHOPROMPT \"\n                     \"credential type\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Can't perform authentication: \"\n                             \"Authentication callback not provided\")"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_userauth_password",
          "args": [
            "sess->session",
            "priv->username",
            "priv->password"
          ],
          "line": 685
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"sess=%p\"",
            "sess"
          ],
          "line": 681
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticatePassword(virNetSSHSessionPtr sess,\n                              virNetSSHAuthMethodPtr priv)\n{\n    char *password = NULL;\n    char *errmsg;\n    int ret = -1;\n    int rc;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (priv->password) {\n        /* tunelled password authentication */\n        if ((rc = libssh2_userauth_password(sess->session,\n                                            priv->username,\n                                            priv->password)) == 0) {\n            ret = 0;\n            goto cleanup;\n        }\n    } else {\n        /* password authentication with interactive password request */\n        if (!sess->cred || !sess->cred->cb) {\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"Can't perform authentication: \"\n                             \"Authentication callback not provided\"));\n            goto cleanup;\n        }\n\n        /* Try the authenticating the set amount of times. The server breaks the\n         * connection if maximum number of bad auth tries is exceeded */\n        while (true) {\n            if (!(password = virAuthGetPasswordPath(sess->authPath, sess->cred,\n                                                    \"ssh\", priv->username,\n                                                    sess->hostname)))\n                goto cleanup;\n\n            /* tunelled password authentication */\n            if ((rc = libssh2_userauth_password(sess->session,\n                                                priv->username,\n                                                password)) == 0) {\n                ret = 0;\n                goto cleanup;\n            }\n\n            if (rc != LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n                break;\n\n            VIR_FREE(password);\n        }\n    }\n\n    /* error path */\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"authentication failed: %s\"), errmsg);\n\n    /* determine exist status */\n    if (rc == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n        ret = 1;\n    else\n        ret = -1;\n\n cleanup:\n    VIR_FREE(password);\n    return ret;\n}"
  },
  {
    "function_name": "virNetSSHAuthenticatePrivkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "565-663",
    "snippet": "static int\nvirNetSSHAuthenticatePrivkey(virNetSSHSessionPtr sess,\n                             virNetSSHAuthMethodPtr priv)\n{\n    virConnectCredential retr_passphrase;\n    size_t i;\n    char *errmsg;\n    int ret;\n    char *tmp;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    /* try open the key with no password */\n    if ((ret = libssh2_userauth_publickey_fromfile(sess->session,\n                                                   priv->username,\n                                                   NULL,\n                                                   priv->filename,\n                                                   priv->password)) == 0)\n        return 0; /* success */\n\n    VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n    if (priv->password ||\n        ret == LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED ||\n        ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED) {\n    VIR_WARNINGS_RESET\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"authentication with private key '%s' \"\n                         \"has failed: %s\"),\n                       priv->filename, errmsg);\n        return 1; /* auth failed */\n    }\n\n    /* request user's key password */\n    if (!sess->cred || !sess->cred->cb) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No user interaction callback provided: \"\n                         \"Can't retrieve private key passphrase\"));\n        return -1;\n    }\n\n    memset(&retr_passphrase, 0, sizeof(virConnectCredential));\n    retr_passphrase.type = -1;\n\n    for (i = 0; i < sess->cred->ncredtype; i++) {\n        if (sess->cred->credtype[i] == VIR_CRED_PASSPHRASE ||\n            sess->cred->credtype[i] == VIR_CRED_NOECHOPROMPT) {\n            retr_passphrase.type = sess->cred->credtype[i];\n            break;\n        }\n    }\n\n    if (retr_passphrase.type < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"no suitable method to retrieve key passphrase\"));\n        return -1;\n    }\n\n    retr_passphrase.prompt = g_strdup_printf(_(\"Passphrase for key '%s'\"),\n                                             priv->filename);\n\n    if (sess->cred->cb(&retr_passphrase, 1, sess->cred->cbdata)) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"failed to retrieve private key passphrase: \"\n                         \"callback has failed\"));\n        tmp = (char *)retr_passphrase.prompt;\n        VIR_FREE(tmp);\n        return -1;\n    }\n\n    tmp = (char *)retr_passphrase.prompt;\n    VIR_FREE(tmp);\n\n    ret = libssh2_userauth_publickey_fromfile(sess->session,\n                                              priv->username,\n                                              NULL,\n                                              priv->filename,\n                                              retr_passphrase.result);\n\n    VIR_FREE(retr_passphrase.result);\n\n    if (ret < 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"authentication with private key '%s' \"\n                         \"has failed: %s\"),\n                       priv->filename, errmsg);\n\n        VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n        if (ret == LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED ||\n            ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n            return 1;\n        else\n            return -1;\n        VIR_WARNINGS_RESET\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "_(\"authentication with private key '%s' \"\n                         \"has failed: %s\")",
            "priv->filename",
            "errmsg"
          ],
          "line": 648
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"authentication with private key '%s' \"\n                         \"has failed: %s\""
          ],
          "line": 649
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 647
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "retr_passphrase.result"
          ],
          "line": 644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_userauth_publickey_fromfile",
          "args": [
            "sess->session",
            "priv->username",
            "NULL",
            "priv->filename",
            "retr_passphrase.result"
          ],
          "line": 638
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 636
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 631
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"failed to retrieve private key passphrase: \"\n                         \"callback has failed\")"
          ],
          "line": 627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sess->cred->cb",
          "args": [
            "&retr_passphrase",
            "1",
            "sess->cred->cbdata"
          ],
          "line": 626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"no suitable method to retrieve key passphrase\")"
          ],
          "line": 618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&retr_passphrase",
            "0",
            "sizeof(virConnectCredential)"
          ],
          "line": 606
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"No user interaction callback provided: \"\n                         \"Can't retrieve private key passphrase\")"
          ],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "_(\"authentication with private key '%s' \"\n                         \"has failed: %s\")",
            "priv->filename",
            "errmsg"
          ],
          "line": 591
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_userauth_publickey_fromfile",
          "args": [
            "sess->session",
            "priv->username",
            "NULL",
            "priv->filename",
            "priv->password"
          ],
          "line": 578
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"sess=%p\"",
            "sess"
          ],
          "line": 575
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticatePrivkey(virNetSSHSessionPtr sess,\n                             virNetSSHAuthMethodPtr priv)\n{\n    virConnectCredential retr_passphrase;\n    size_t i;\n    char *errmsg;\n    int ret;\n    char *tmp;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    /* try open the key with no password */\n    if ((ret = libssh2_userauth_publickey_fromfile(sess->session,\n                                                   priv->username,\n                                                   NULL,\n                                                   priv->filename,\n                                                   priv->password)) == 0)\n        return 0; /* success */\n\n    VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n    if (priv->password ||\n        ret == LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED ||\n        ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED) {\n    VIR_WARNINGS_RESET\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"authentication with private key '%s' \"\n                         \"has failed: %s\"),\n                       priv->filename, errmsg);\n        return 1; /* auth failed */\n    }\n\n    /* request user's key password */\n    if (!sess->cred || !sess->cred->cb) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"No user interaction callback provided: \"\n                         \"Can't retrieve private key passphrase\"));\n        return -1;\n    }\n\n    memset(&retr_passphrase, 0, sizeof(virConnectCredential));\n    retr_passphrase.type = -1;\n\n    for (i = 0; i < sess->cred->ncredtype; i++) {\n        if (sess->cred->credtype[i] == VIR_CRED_PASSPHRASE ||\n            sess->cred->credtype[i] == VIR_CRED_NOECHOPROMPT) {\n            retr_passphrase.type = sess->cred->credtype[i];\n            break;\n        }\n    }\n\n    if (retr_passphrase.type < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"no suitable method to retrieve key passphrase\"));\n        return -1;\n    }\n\n    retr_passphrase.prompt = g_strdup_printf(_(\"Passphrase for key '%s'\"),\n                                             priv->filename);\n\n    if (sess->cred->cb(&retr_passphrase, 1, sess->cred->cbdata)) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"failed to retrieve private key passphrase: \"\n                         \"callback has failed\"));\n        tmp = (char *)retr_passphrase.prompt;\n        VIR_FREE(tmp);\n        return -1;\n    }\n\n    tmp = (char *)retr_passphrase.prompt;\n    VIR_FREE(tmp);\n\n    ret = libssh2_userauth_publickey_fromfile(sess->session,\n                                              priv->username,\n                                              NULL,\n                                              priv->filename,\n                                              retr_passphrase.result);\n\n    VIR_FREE(retr_passphrase.result);\n\n    if (ret < 0) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"authentication with private key '%s' \"\n                         \"has failed: %s\"),\n                       priv->filename, errmsg);\n\n        VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n        if (ret == LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED ||\n            ret == LIBSSH2_ERROR_AUTHENTICATION_FAILED)\n            return 1;\n        else\n            return -1;\n        VIR_WARNINGS_RESET\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virNetSSHAuthenticateAgent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "491-557",
    "snippet": "static int\nvirNetSSHAuthenticateAgent(virNetSSHSessionPtr sess,\n                           virNetSSHAuthMethodPtr priv)\n{\n    struct libssh2_agent_publickey *agent_identity = NULL;\n    bool no_identity = true;\n    int ret;\n    char *errmsg;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (libssh2_agent_connect(sess->agent) < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to connect to ssh agent\"));\n        return 1;\n    }\n\n    if (libssh2_agent_list_identities(sess->agent) < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to list ssh agent identities\"));\n        return 1;\n    }\n\n    while (!(ret = libssh2_agent_get_identity(sess->agent,\n                                              &agent_identity,\n                                              agent_identity))) {\n        no_identity = false;\n        if (!(ret = libssh2_agent_userauth(sess->agent,\n                                           priv->username,\n                                           agent_identity)))\n            return 0; /* key accepted */\n\n        VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n        if (ret != LIBSSH2_ERROR_AUTHENTICATION_FAILED &&\n            ret != LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED &&\n            ret != LIBSSH2_ERROR_PUBLICKEY_UNVERIFIED) {\n        VIR_WARNINGS_RESET\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_AUTH_FAILED,\n                           _(\"failed to authenticate using SSH agent: %s\"),\n                           errmsg);\n            return -1;\n        }\n        /* authentication has failed, try next key */\n    }\n\n    /* if there are no more keys in the agent, the identity retrieval\n     * function returns 1 */\n    if (ret == 1) {\n        if (no_identity) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"SSH Agent did not provide any \"\n                             \"authentication identity\"));\n        } else {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"All identities provided by the SSH Agent \"\n                             \"were rejected\"));\n        }\n        return 1;\n    }\n\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"failed to authenticate using SSH agent: %s\"),\n                   errmsg);\n    return -1;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "_(\"failed to authenticate using SSH agent: %s\")",
            "errmsg"
          ],
          "line": 553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to authenticate using SSH agent: %s\""
          ],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 552
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"All identities provided by the SSH Agent \"\n                             \"were rejected\")"
          ],
          "line": 545
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"SSH Agent did not provide any \"\n                             \"authentication identity\")"
          ],
          "line": 541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "_(\"failed to authenticate using SSH agent: %s\")",
            "errmsg"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_agent_userauth",
          "args": [
            "sess->agent",
            "priv->username",
            "agent_identity"
          ],
          "line": 518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_agent_get_identity",
          "args": [
            "sess->agent",
            "&agent_identity",
            "agent_identity"
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Failed to list ssh agent identities\")"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_agent_list_identities",
          "args": [
            "sess->agent"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Failed to connect to ssh agent\")"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_agent_connect",
          "args": [
            "sess->agent"
          ],
          "line": 502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"sess=%p\"",
            "sess"
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHAuthenticateAgent(virNetSSHSessionPtr sess,\n                           virNetSSHAuthMethodPtr priv)\n{\n    struct libssh2_agent_publickey *agent_identity = NULL;\n    bool no_identity = true;\n    int ret;\n    char *errmsg;\n\n    VIR_DEBUG(\"sess=%p\", sess);\n\n    if (libssh2_agent_connect(sess->agent) < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to connect to ssh agent\"));\n        return 1;\n    }\n\n    if (libssh2_agent_list_identities(sess->agent) < 0) {\n        virReportError(VIR_ERR_SSH, \"%s\",\n                       _(\"Failed to list ssh agent identities\"));\n        return 1;\n    }\n\n    while (!(ret = libssh2_agent_get_identity(sess->agent,\n                                              &agent_identity,\n                                              agent_identity))) {\n        no_identity = false;\n        if (!(ret = libssh2_agent_userauth(sess->agent,\n                                           priv->username,\n                                           agent_identity)))\n            return 0; /* key accepted */\n\n        VIR_WARNINGS_NO_WLOGICALOP_EQUAL_EXPR\n        if (ret != LIBSSH2_ERROR_AUTHENTICATION_FAILED &&\n            ret != LIBSSH2_ERROR_PUBLICKEY_UNRECOGNIZED &&\n            ret != LIBSSH2_ERROR_PUBLICKEY_UNVERIFIED) {\n        VIR_WARNINGS_RESET\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_AUTH_FAILED,\n                           _(\"failed to authenticate using SSH agent: %s\"),\n                           errmsg);\n            return -1;\n        }\n        /* authentication has failed, try next key */\n    }\n\n    /* if there are no more keys in the agent, the identity retrieval\n     * function returns 1 */\n    if (ret == 1) {\n        if (no_identity) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"SSH Agent did not provide any \"\n                             \"authentication identity\"));\n        } else {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"All identities provided by the SSH Agent \"\n                             \"were rejected\"));\n        }\n        return 1;\n    }\n\n    libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n    virReportError(VIR_ERR_AUTH_FAILED,\n                   _(\"failed to authenticate using SSH agent: %s\"),\n                   errmsg);\n    return -1;\n}"
  },
  {
    "function_name": "virNetSSHCheckHostKey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "279-483",
    "snippet": "static int\nvirNetSSHCheckHostKey(virNetSSHSessionPtr sess)\n{\n    int ret;\n    const char *key;\n    const char *keyhash;\n    char *keyhashstr;\n    char *tmp;\n    int keyType;\n    size_t keyLength;\n    char *errmsg;\n    virBuffer buff = VIR_BUFFER_INITIALIZER;\n    virConnectCredential askKey;\n    struct libssh2_knownhost *knownHostEntry = NULL;\n    size_t i;\n    char *hostnameStr = NULL;\n\n    if (sess->hostKeyVerify == VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE)\n        return 0;\n\n    /* get the key */\n    key = libssh2_session_hostkey(sess->session, &keyLength, &keyType);\n    if (!key) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"Failed to retrieve ssh host key: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    /* verify it */\n    ret = libssh2_knownhost_checkp(sess->knownHosts,\n                                   sess->hostname,\n                                   sess->port,\n                                   key,\n                                   keyLength,\n                                   LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW,\n                                   &knownHostEntry);\n\n    switch (ret) {\n    case LIBSSH2_KNOWNHOST_CHECK_NOTFOUND:\n        /* key was not found, query to add it to database */\n        if (sess->hostKeyVerify == VIR_NET_SSH_HOSTKEY_VERIFY_NORMAL) {\n            /* ask to add the key */\n            if (!sess->cred || !sess->cred->cb) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"No user interaction callback provided: \"\n                                 \"Can't verify the session host key\"));\n                return -1;\n            }\n\n            /* prepare data for the callback */\n            memset(&askKey, 0, sizeof(virConnectCredential));\n\n            for (i = 0; i < sess->cred->ncredtype; i++) {\n                if (sess->cred->credtype[i] == VIR_CRED_ECHOPROMPT)\n                    break;\n            }\n\n            if (i == sess->cred->ncredtype) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"no suitable callback for host key \"\n                                 \"verification\"));\n                return -1;\n            }\n\n            /* calculate remote key hash, using MD5 algorithm that is\n             * usual in OpenSSH. The returned value should *NOT* be freed */\n            if (!(keyhash = libssh2_hostkey_hash(sess->session,\n                                                 LIBSSH2_HOSTKEY_HASH_MD5))) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"failed to calculate ssh host key hash\"));\n                return -1;\n            }\n            /* format the host key into a nice userfriendly string.\n             * Sadly, there's no constant to describe the hash length, so\n             * we have to use a *MAGIC* constant. */\n            for (i = 0; i < 16; i++)\n                virBufferAsprintf(&buff, \"%02hhX:\", keyhash[i]);\n            virBufferTrim(&buff, \":\");\n\n            keyhashstr = virBufferContentAndReset(&buff);\n\n            askKey.type = VIR_CRED_ECHOPROMPT;\n            askKey.prompt = g_strdup_printf(_(\"Accept SSH host key with hash '%s' for \" \"host '%s:%d' (%s/%s)?\"),\n                                            keyhashstr, sess->hostname, sess->port, \"y\", \"n\");\n\n            if (sess->cred->cb(&askKey, 1, sess->cred->cbdata)) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"failed to retrieve decision to accept \"\n                                 \"host key\"));\n                tmp = (char*)askKey.prompt;\n                VIR_FREE(tmp);\n                VIR_FREE(keyhashstr);\n                return -1;\n            }\n\n            tmp = (char*)askKey.prompt;\n            VIR_FREE(tmp);\n\n            if (!askKey.result ||\n                STRCASENEQ(askKey.result, \"y\")) {\n                virReportError(VIR_ERR_SSH,\n                               _(\"SSH host key for '%s' (%s) was not accepted\"),\n                               sess->hostname, keyhashstr);\n                VIR_FREE(keyhashstr);\n                VIR_FREE(askKey.result);\n                return -1;\n            }\n            VIR_FREE(keyhashstr);\n            VIR_FREE(askKey.result);\n        }\n\n        /* VIR_NET_SSH_HOSTKEY_VERIFY_AUTO_ADD */\n        /* convert key type, as libssh is using different enums type for\n         * getting the key and different for adding ... */\n        switch (keyType) {\n        case LIBSSH2_HOSTKEY_TYPE_RSA:\n            keyType = LIBSSH2_KNOWNHOST_KEY_SSHRSA;\n            break;\n        case LIBSSH2_HOSTKEY_TYPE_DSS:\n            keyType = LIBSSH2_KNOWNHOST_KEY_SSHDSS;\n            break;\n\n        case LIBSSH2_HOSTKEY_TYPE_UNKNOWN:\n        default:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"unsupported SSH key type\"));\n            return -1;\n        }\n\n        /* add the key to the DB and save it, if applicable */\n        /* construct a \"[hostname]:port\" string to have the hostkey bound\n         * to port number */\n        virBufferAsprintf(&buff, \"[%s]:%d\", sess->hostname, sess->port);\n\n        hostnameStr = virBufferContentAndReset(&buff);\n\n        if (libssh2_knownhost_addc(sess->knownHosts,\n                                   hostnameStr,\n                                   NULL,\n                                   key,\n                                   keyLength,\n                                   vir_libssh2_key_comment,\n                                   strlen(vir_libssh2_key_comment),\n                                   LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW |\n                                   keyType,\n                                   NULL) < 0) {\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_SSH,\n                           _(\"unable to add SSH host key for host '%s': %s\"),\n                           hostnameStr, errmsg);\n            VIR_FREE(hostnameStr);\n            return -1;\n        }\n\n        VIR_FREE(hostnameStr);\n\n        /* write the host key file - if applicable */\n        if (sess->knownHostsFile) {\n            if (libssh2_knownhost_writefile(sess->knownHosts,\n                                            sess->knownHostsFile,\n                                         LIBSSH2_KNOWNHOST_FILE_OPENSSH) < 0) {\n                libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n                virReportError(VIR_ERR_SSH,\n                               _(\"failed to write known_host file '%s': %s\"),\n                               sess->knownHostsFile,\n                               errmsg);\n                return -1;\n            }\n        }\n        /* key was accepted and added */\n        return 0;\n\n    case LIBSSH2_KNOWNHOST_CHECK_MATCH:\n        /* host key matches */\n        return 0;\n\n    case LIBSSH2_KNOWNHOST_CHECK_MISMATCH:\n        /* host key verification failed */\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"!!! SSH HOST KEY VERIFICATION FAILED !!!: \"\n                         \"Identity of host '%s:%d' differs from stored identity. \"\n                         \"Please verify the new host key '%s' to avoid possible \"\n                         \"man in the middle attack. The key is stored in '%s'.\"),\n                       sess->hostname, sess->port,\n                       knownHostEntry->key, sess->knownHostsFile);\n        return -1;\n\n    case LIBSSH2_KNOWNHOST_CHECK_FAILURE:\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to validate SSH host key: %s\"),\n                       errmsg);\n        return -1;\n\n    default: /* should never happen (tm) */\n        virReportError(VIR_ERR_SSH, \"%s\", _(\"Unknown error value\"));\n        return -1;\n    }\n\n    return -1;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const char\nvir_libssh2_key_comment[] = \"added by libvirt ssh transport\";"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"Unknown error value\")"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unknown error value\""
          ],
          "line": 478
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"failed to validate SSH host key: %s\")",
            "errmsg"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 471
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "_(\"!!! SSH HOST KEY VERIFICATION FAILED !!!: \"\n                         \"Identity of host '%s:%d' differs from stored identity. \"\n                         \"Please verify the new host key '%s' to avoid possible \"\n                         \"man in the middle attack. The key is stored in '%s'.\")",
            "sess->hostname",
            "sess->port",
            "knownHostEntry->key",
            "sess->knownHostsFile"
          ],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "virReportErrorHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "1282-1308",
          "snippet": "void virReportErrorHelper(int domcode,\n                          int errorcode,\n                          const char *filename,\n                          const char *funcname,\n                          size_t linenr,\n                          const char *fmt, ...)\n{\n    int save_errno = errno;\n    va_list args;\n    char errorMessage[VIR_ERROR_MAX_LENGTH];\n    const char *virerr;\n\n    if (fmt) {\n        va_start(args, fmt);\n        g_vsnprintf(errorMessage, sizeof(errorMessage)-1, fmt, args);\n        va_end(args);\n    } else {\n        errorMessage[0] = '\\0';\n    }\n\n    virerr = virErrorMsg(errorcode, (errorMessage[0] ? errorMessage : NULL));\n    virRaiseErrorFull(filename, funcname, linenr,\n                      domcode, errorcode, VIR_ERR_ERROR,\n                      virerr, errorMessage, NULL,\n                      -1, -1, virerr, errorMessage);\n    errno = save_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid virReportErrorHelper(int domcode,\n                          int errorcode,\n                          const char *filename,\n                          const char *funcname,\n                          size_t linenr,\n                          const char *fmt, ...)\n{\n    int save_errno = errno;\n    va_list args;\n    char errorMessage[VIR_ERROR_MAX_LENGTH];\n    const char *virerr;\n\n    if (fmt) {\n        va_start(args, fmt);\n        g_vsnprintf(errorMessage, sizeof(errorMessage)-1, fmt, args);\n        va_end(args);\n    } else {\n        errorMessage[0] = '\\0';\n    }\n\n    virerr = virErrorMsg(errorcode, (errorMessage[0] ? errorMessage : NULL));\n    virRaiseErrorFull(filename, funcname, linenr,\n                      domcode, errorcode, VIR_ERR_ERROR,\n                      virerr, errorMessage, NULL,\n                      -1, -1, virerr, errorMessage);\n    errno = save_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"failed to write known_host file '%s': %s\")",
            "sess->knownHostsFile",
            "errmsg"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_knownhost_writefile",
          "args": [
            "sess->knownHosts",
            "sess->knownHostsFile",
            "LIBSSH2_KNOWNHOST_FILE_OPENSSH"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "hostnameStr"
          ],
          "line": 437
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "hostnameStr"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"unable to add SSH host key for host '%s': %s\")",
            "hostnameStr",
            "errmsg"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_knownhost_addc",
          "args": [
            "sess->knownHosts",
            "hostnameStr",
            "NULL",
            "key",
            "keyLength",
            "vir_libssh2_key_comment",
            "strlen(vir_libssh2_key_comment)",
            "LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW |\n                                   keyType",
            "NULL"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "vir_libssh2_key_comment"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferContentAndReset",
          "args": [
            "&buff"
          ],
          "line": 416
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferContentAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "247-260",
          "snippet": "char *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAsprintf",
          "args": [
            "&buff",
            "\"[%s]:%d\"",
            "sess->hostname",
            "sess->port"
          ],
          "line": 414
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAsprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "302-309",
          "snippet": "void\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"unsupported SSH key type\")"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "askKey.result"
          ],
          "line": 390
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "keyhashstr"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "askKey.result"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "keyhashstr"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"SSH host key for '%s' (%s) was not accepted\")",
            "sess->hostname",
            "keyhashstr"
          ],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRCASENEQ",
          "args": [
            "askKey.result",
            "\"y\""
          ],
          "line": 381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "keyhashstr"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"failed to retrieve decision to accept \"\n                                 \"host key\")"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sess->cred->cb",
          "args": [
            "&askKey",
            "1",
            "sess->cred->cbdata"
          ],
          "line": 367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferTrim",
          "args": [
            "&buff",
            "\":\""
          ],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferTrimLen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "698-708",
          "snippet": "void\nvirBufferTrimLen(virBufferPtr buf, int len)\n{\n    if (!buf || !buf->str)\n        return;\n\n    if (len > buf->str->len)\n        return;\n\n    g_string_truncate(buf->str, buf->str->len - len);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferTrimLen(virBufferPtr buf, int len)\n{\n    if (!buf || !buf->str)\n        return;\n\n    if (len > buf->str->len)\n        return;\n\n    g_string_truncate(buf->str, buf->str->len - len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"failed to calculate ssh host key hash\")"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_hostkey_hash",
          "args": [
            "sess->session",
            "LIBSSH2_HOSTKEY_HASH_MD5"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"no suitable callback for host key \"\n                                 \"verification\")"
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&askKey",
            "0",
            "sizeof(virConnectCredential)"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "\"%s\"",
            "_(\"No user interaction callback provided: \"\n                                 \"Can't verify the session host key\")"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_knownhost_checkp",
          "args": [
            "sess->knownHosts",
            "sess->hostname",
            "sess->port",
            "key",
            "keyLength",
            "LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW",
            "&knownHostEntry"
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SSH",
            "_(\"Failed to retrieve ssh host key: %s\")",
            "errmsg"
          ],
          "line": 303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_last_error",
          "args": [
            "sess->session",
            "&errmsg",
            "NULL",
            "0"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_hostkey",
          "args": [
            "sess->session",
            "&keyLength",
            "&keyType"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic const char\nvir_libssh2_key_comment[] = \"added by libvirt ssh transport\";\n\nstatic int\nvirNetSSHCheckHostKey(virNetSSHSessionPtr sess)\n{\n    int ret;\n    const char *key;\n    const char *keyhash;\n    char *keyhashstr;\n    char *tmp;\n    int keyType;\n    size_t keyLength;\n    char *errmsg;\n    virBuffer buff = VIR_BUFFER_INITIALIZER;\n    virConnectCredential askKey;\n    struct libssh2_knownhost *knownHostEntry = NULL;\n    size_t i;\n    char *hostnameStr = NULL;\n\n    if (sess->hostKeyVerify == VIR_NET_SSH_HOSTKEY_VERIFY_IGNORE)\n        return 0;\n\n    /* get the key */\n    key = libssh2_session_hostkey(sess->session, &keyLength, &keyType);\n    if (!key) {\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"Failed to retrieve ssh host key: %s\"),\n                       errmsg);\n        return -1;\n    }\n\n    /* verify it */\n    ret = libssh2_knownhost_checkp(sess->knownHosts,\n                                   sess->hostname,\n                                   sess->port,\n                                   key,\n                                   keyLength,\n                                   LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW,\n                                   &knownHostEntry);\n\n    switch (ret) {\n    case LIBSSH2_KNOWNHOST_CHECK_NOTFOUND:\n        /* key was not found, query to add it to database */\n        if (sess->hostKeyVerify == VIR_NET_SSH_HOSTKEY_VERIFY_NORMAL) {\n            /* ask to add the key */\n            if (!sess->cred || !sess->cred->cb) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"No user interaction callback provided: \"\n                                 \"Can't verify the session host key\"));\n                return -1;\n            }\n\n            /* prepare data for the callback */\n            memset(&askKey, 0, sizeof(virConnectCredential));\n\n            for (i = 0; i < sess->cred->ncredtype; i++) {\n                if (sess->cred->credtype[i] == VIR_CRED_ECHOPROMPT)\n                    break;\n            }\n\n            if (i == sess->cred->ncredtype) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"no suitable callback for host key \"\n                                 \"verification\"));\n                return -1;\n            }\n\n            /* calculate remote key hash, using MD5 algorithm that is\n             * usual in OpenSSH. The returned value should *NOT* be freed */\n            if (!(keyhash = libssh2_hostkey_hash(sess->session,\n                                                 LIBSSH2_HOSTKEY_HASH_MD5))) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"failed to calculate ssh host key hash\"));\n                return -1;\n            }\n            /* format the host key into a nice userfriendly string.\n             * Sadly, there's no constant to describe the hash length, so\n             * we have to use a *MAGIC* constant. */\n            for (i = 0; i < 16; i++)\n                virBufferAsprintf(&buff, \"%02hhX:\", keyhash[i]);\n            virBufferTrim(&buff, \":\");\n\n            keyhashstr = virBufferContentAndReset(&buff);\n\n            askKey.type = VIR_CRED_ECHOPROMPT;\n            askKey.prompt = g_strdup_printf(_(\"Accept SSH host key with hash '%s' for \" \"host '%s:%d' (%s/%s)?\"),\n                                            keyhashstr, sess->hostname, sess->port, \"y\", \"n\");\n\n            if (sess->cred->cb(&askKey, 1, sess->cred->cbdata)) {\n                virReportError(VIR_ERR_SSH, \"%s\",\n                               _(\"failed to retrieve decision to accept \"\n                                 \"host key\"));\n                tmp = (char*)askKey.prompt;\n                VIR_FREE(tmp);\n                VIR_FREE(keyhashstr);\n                return -1;\n            }\n\n            tmp = (char*)askKey.prompt;\n            VIR_FREE(tmp);\n\n            if (!askKey.result ||\n                STRCASENEQ(askKey.result, \"y\")) {\n                virReportError(VIR_ERR_SSH,\n                               _(\"SSH host key for '%s' (%s) was not accepted\"),\n                               sess->hostname, keyhashstr);\n                VIR_FREE(keyhashstr);\n                VIR_FREE(askKey.result);\n                return -1;\n            }\n            VIR_FREE(keyhashstr);\n            VIR_FREE(askKey.result);\n        }\n\n        /* VIR_NET_SSH_HOSTKEY_VERIFY_AUTO_ADD */\n        /* convert key type, as libssh is using different enums type for\n         * getting the key and different for adding ... */\n        switch (keyType) {\n        case LIBSSH2_HOSTKEY_TYPE_RSA:\n            keyType = LIBSSH2_KNOWNHOST_KEY_SSHRSA;\n            break;\n        case LIBSSH2_HOSTKEY_TYPE_DSS:\n            keyType = LIBSSH2_KNOWNHOST_KEY_SSHDSS;\n            break;\n\n        case LIBSSH2_HOSTKEY_TYPE_UNKNOWN:\n        default:\n            virReportError(VIR_ERR_SSH, \"%s\",\n                           _(\"unsupported SSH key type\"));\n            return -1;\n        }\n\n        /* add the key to the DB and save it, if applicable */\n        /* construct a \"[hostname]:port\" string to have the hostkey bound\n         * to port number */\n        virBufferAsprintf(&buff, \"[%s]:%d\", sess->hostname, sess->port);\n\n        hostnameStr = virBufferContentAndReset(&buff);\n\n        if (libssh2_knownhost_addc(sess->knownHosts,\n                                   hostnameStr,\n                                   NULL,\n                                   key,\n                                   keyLength,\n                                   vir_libssh2_key_comment,\n                                   strlen(vir_libssh2_key_comment),\n                                   LIBSSH2_KNOWNHOST_TYPE_PLAIN |\n                                   LIBSSH2_KNOWNHOST_KEYENC_RAW |\n                                   keyType,\n                                   NULL) < 0) {\n            libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n            virReportError(VIR_ERR_SSH,\n                           _(\"unable to add SSH host key for host '%s': %s\"),\n                           hostnameStr, errmsg);\n            VIR_FREE(hostnameStr);\n            return -1;\n        }\n\n        VIR_FREE(hostnameStr);\n\n        /* write the host key file - if applicable */\n        if (sess->knownHostsFile) {\n            if (libssh2_knownhost_writefile(sess->knownHosts,\n                                            sess->knownHostsFile,\n                                         LIBSSH2_KNOWNHOST_FILE_OPENSSH) < 0) {\n                libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n                virReportError(VIR_ERR_SSH,\n                               _(\"failed to write known_host file '%s': %s\"),\n                               sess->knownHostsFile,\n                               errmsg);\n                return -1;\n            }\n        }\n        /* key was accepted and added */\n        return 0;\n\n    case LIBSSH2_KNOWNHOST_CHECK_MATCH:\n        /* host key matches */\n        return 0;\n\n    case LIBSSH2_KNOWNHOST_CHECK_MISMATCH:\n        /* host key verification failed */\n        virReportError(VIR_ERR_AUTH_FAILED,\n                       _(\"!!! SSH HOST KEY VERIFICATION FAILED !!!: \"\n                         \"Identity of host '%s:%d' differs from stored identity. \"\n                         \"Please verify the new host key '%s' to avoid possible \"\n                         \"man in the middle attack. The key is stored in '%s'.\"),\n                       sess->hostname, sess->port,\n                       knownHostEntry->key, sess->knownHostsFile);\n        return -1;\n\n    case LIBSSH2_KNOWNHOST_CHECK_FAILURE:\n        libssh2_session_last_error(sess->session, &errmsg, NULL, 0);\n        virReportError(VIR_ERR_SSH,\n                       _(\"failed to validate SSH host key: %s\"),\n                       errmsg);\n        return -1;\n\n    default: /* should never happen (tm) */\n        virReportError(VIR_ERR_SSH, \"%s\", _(\"Unknown error value\"));\n        return -1;\n    }\n\n    return -1;\n}"
  },
  {
    "function_name": "virNetSSHKbIntCb",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "192-270",
    "snippet": "static void\nvirNetSSHKbIntCb(const char *name G_GNUC_UNUSED,\n                 int name_len G_GNUC_UNUSED,\n                 const char *instruction G_GNUC_UNUSED,\n                 int instruction_len G_GNUC_UNUSED,\n                 int num_prompts,\n                 const LIBSSH2_USERAUTH_KBDINT_PROMPT *prompts,\n                 LIBSSH2_USERAUTH_KBDINT_RESPONSE *responses,\n                 void **opaque)\n{\n    virNetSSHSessionPtr priv = *opaque;\n    virConnectCredentialPtr askcred = NULL;\n    size_t i;\n    int credtype_echo = -1;\n    int credtype_noecho = -1;\n    char *tmp;\n\n    priv->authCbErr = VIR_NET_SSH_AUTHCB_OK;\n\n    /* find credential type for asking passwords */\n    for (i = 0; i < priv->cred->ncredtype; i++) {\n        if (priv->cred->credtype[i] == VIR_CRED_PASSPHRASE ||\n            priv->cred->credtype[i] == VIR_CRED_NOECHOPROMPT)\n            credtype_noecho = priv->cred->credtype[i];\n\n        if (priv->cred->credtype[i] == VIR_CRED_ECHOPROMPT)\n            credtype_echo = priv->cred->credtype[i];\n    }\n\n    if (credtype_echo < 0 || credtype_noecho < 0) {\n        priv->authCbErr = VIR_NET_SSH_AUTHCB_NO_METHOD;\n        return;\n    }\n\n    if (VIR_ALLOC_N(askcred, num_prompts) < 0) {\n        priv->authCbErr = VIR_NET_SSH_AUTHCB_OOM;\n        return;\n    }\n\n    /* fill data structures for auth callback */\n    for (i = 0; i < num_prompts; i++) {\n        char *prompt;\n        prompt = g_strdup(prompts[i].text);\n        askcred[i].prompt = prompt;\n\n        /* remove colon and trailing spaces from prompts, as default behavior\n         * of libvirt's auth callback is to add them */\n        if ((tmp = strrchr(askcred[i].prompt, ':')))\n            *tmp = '\\0';\n\n        askcred[i].type = prompts[i].echo ? credtype_echo : credtype_noecho;\n    }\n\n    /* retrieve responses using the auth callback */\n    if (priv->cred->cb(askcred, num_prompts, priv->cred->cbdata)) {\n        priv->authCbErr = VIR_NET_SSH_AUTHCB_RETR_ERR;\n        goto cleanup;\n    }\n\n    /* copy retrieved data back */\n    for (i = 0; i < num_prompts; i++) {\n        responses[i].text = askcred[i].result;\n        askcred[i].result = NULL; /* steal the pointer */\n        responses[i].length = askcred[i].resultlen;\n    }\n\n cleanup:\n    if (askcred) {\n        for (i = 0; i < num_prompts; i++) {\n            char *prompt = (char *)askcred[i].prompt;\n            VIR_FREE(askcred[i].result);\n            VIR_FREE(prompt);\n        }\n    }\n\n    VIR_FREE(askcred);\n\n    return;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "askcred"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "prompt"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "askcred[i].result"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "priv->cred->cb",
          "args": [
            "askcred",
            "num_prompts",
            "priv->cred->cbdata"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "askcred[i].prompt",
            "':'"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "prompts[i].text"
          ],
          "line": 234
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "askcred",
            "num_prompts"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic void\nvirNetSSHKbIntCb(const char *name G_GNUC_UNUSED,\n                 int name_len G_GNUC_UNUSED,\n                 const char *instruction G_GNUC_UNUSED,\n                 int instruction_len G_GNUC_UNUSED,\n                 int num_prompts,\n                 const LIBSSH2_USERAUTH_KBDINT_PROMPT *prompts,\n                 LIBSSH2_USERAUTH_KBDINT_RESPONSE *responses,\n                 void **opaque)\n{\n    virNetSSHSessionPtr priv = *opaque;\n    virConnectCredentialPtr askcred = NULL;\n    size_t i;\n    int credtype_echo = -1;\n    int credtype_noecho = -1;\n    char *tmp;\n\n    priv->authCbErr = VIR_NET_SSH_AUTHCB_OK;\n\n    /* find credential type for asking passwords */\n    for (i = 0; i < priv->cred->ncredtype; i++) {\n        if (priv->cred->credtype[i] == VIR_CRED_PASSPHRASE ||\n            priv->cred->credtype[i] == VIR_CRED_NOECHOPROMPT)\n            credtype_noecho = priv->cred->credtype[i];\n\n        if (priv->cred->credtype[i] == VIR_CRED_ECHOPROMPT)\n            credtype_echo = priv->cred->credtype[i];\n    }\n\n    if (credtype_echo < 0 || credtype_noecho < 0) {\n        priv->authCbErr = VIR_NET_SSH_AUTHCB_NO_METHOD;\n        return;\n    }\n\n    if (VIR_ALLOC_N(askcred, num_prompts) < 0) {\n        priv->authCbErr = VIR_NET_SSH_AUTHCB_OOM;\n        return;\n    }\n\n    /* fill data structures for auth callback */\n    for (i = 0; i < num_prompts; i++) {\n        char *prompt;\n        prompt = g_strdup(prompts[i].text);\n        askcred[i].prompt = prompt;\n\n        /* remove colon and trailing spaces from prompts, as default behavior\n         * of libvirt's auth callback is to add them */\n        if ((tmp = strrchr(askcred[i].prompt, ':')))\n            *tmp = '\\0';\n\n        askcred[i].type = prompts[i].echo ? credtype_echo : credtype_noecho;\n    }\n\n    /* retrieve responses using the auth callback */\n    if (priv->cred->cb(askcred, num_prompts, priv->cred->cbdata)) {\n        priv->authCbErr = VIR_NET_SSH_AUTHCB_RETR_ERR;\n        goto cleanup;\n    }\n\n    /* copy retrieved data back */\n    for (i = 0; i < num_prompts; i++) {\n        responses[i].text = askcred[i].result;\n        askcred[i].result = NULL; /* steal the pointer */\n        responses[i].length = askcred[i].resultlen;\n    }\n\n cleanup:\n    if (askcred) {\n        for (i = 0; i < num_prompts; i++) {\n            char *prompt = (char *)askcred[i].prompt;\n            VIR_FREE(askcred[i].result);\n            VIR_FREE(prompt);\n        }\n    }\n\n    VIR_FREE(askcred);\n\n    return;\n}"
  },
  {
    "function_name": "virNetSSHSessionAuthMethodNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "171-189",
    "snippet": "static virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "auth"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "sess->auths",
            "sess->nauths",
            "1"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "auth"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic virNetSSHAuthMethodPtr\nvirNetSSHSessionAuthMethodNew(virNetSSHSessionPtr sess)\n{\n    virNetSSHAuthMethodPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    if (VIR_EXPAND_N(sess->auths, sess->nauths, 1) < 0)\n        goto error;\n\n    sess->auths[sess->nauths - 1] = auth;\n\n    return auth;\n\n error:\n    VIR_FREE(auth);\n    return NULL;\n}"
  },
  {
    "function_name": "virNetSSHSessionOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "161-168",
    "snippet": "static int\nvirNetSSHSessionOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virNetSSHSession, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virNetSSHSession",
            "virClassForObjectLockable()"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virClassForObjectLockable",
          "args": [],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "virClassForObjectLockable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "116-123",
          "snippet": "virClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectLockableClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectLockableClass;\n\nvirClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic int\nvirNetSSHSessionOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virNetSSHSession, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virNetSSHSessionDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "131-158",
    "snippet": "static void\nvirNetSSHSessionDispose(void *obj)\n{\n    virNetSSHSessionPtr sess = obj;\n    VIR_DEBUG(\"sess=0x%p\", sess);\n\n    if (sess->channel) {\n        libssh2_channel_send_eof(sess->channel);\n        libssh2_channel_close(sess->channel);\n        libssh2_channel_free(sess->channel);\n    }\n\n    libssh2_knownhost_free(sess->knownHosts);\n    libssh2_agent_free(sess->agent);\n\n    if (sess->session) {\n        libssh2_session_disconnect(sess->session,\n                                   \"libvirt: virNetSSHSessionFree()\");\n        libssh2_session_free(sess->session);\n    }\n\n    virNetSSHSessionAuthMethodsFree(sess);\n\n    VIR_FREE(sess->channelCommand);\n    VIR_FREE(sess->hostname);\n    VIR_FREE(sess->knownHostsFile);\n    VIR_FREE(sess->authPath);\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->authPath"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->knownHostsFile"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->hostname"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->channelCommand"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetSSHSessionAuthMethodsFree",
          "args": [
            "sess"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "virNetSSHSessionAuthMethodsFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
          "lines": "115-129",
          "snippet": "static void\nvirNetSSHSessionAuthMethodsFree(virNetSSHSessionPtr sess)\n{\n    size_t i;\n\n    for (i = 0; i < sess->nauths; i++) {\n        VIR_FREE(sess->auths[i]->username);\n        VIR_FREE(sess->auths[i]->password);\n        VIR_FREE(sess->auths[i]->filename);\n        VIR_FREE(sess->auths[i]);\n    }\n\n    VIR_FREE(sess->auths);\n    sess->nauths = 0;\n}",
          "includes": [
            "#include \"virauth.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"configmake.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include \"virnetsshsession.h\"",
            "#include <libssh2_publickey.h>",
            "#include <libssh2.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic void\nvirNetSSHSessionAuthMethodsFree(virNetSSHSessionPtr sess)\n{\n    size_t i;\n\n    for (i = 0; i < sess->nauths; i++) {\n        VIR_FREE(sess->auths[i]->username);\n        VIR_FREE(sess->auths[i]->password);\n        VIR_FREE(sess->auths[i]->filename);\n        VIR_FREE(sess->auths[i]);\n    }\n\n    VIR_FREE(sess->auths);\n    sess->nauths = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "libssh2_session_free",
          "args": [
            "sess->session"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_session_disconnect",
          "args": [
            "sess->session",
            "\"libvirt: virNetSSHSessionFree()\""
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_agent_free",
          "args": [
            "sess->agent"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_knownhost_free",
          "args": [
            "sess->knownHosts"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_free",
          "args": [
            "sess->channel"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_close",
          "args": [
            "sess->channel"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "libssh2_channel_send_eof",
          "args": [
            "sess->channel"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"sess=0x%p\"",
            "sess"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic void\nvirNetSSHSessionDispose(void *obj)\n{\n    virNetSSHSessionPtr sess = obj;\n    VIR_DEBUG(\"sess=0x%p\", sess);\n\n    if (sess->channel) {\n        libssh2_channel_send_eof(sess->channel);\n        libssh2_channel_close(sess->channel);\n        libssh2_channel_free(sess->channel);\n    }\n\n    libssh2_knownhost_free(sess->knownHosts);\n    libssh2_agent_free(sess->agent);\n\n    if (sess->session) {\n        libssh2_session_disconnect(sess->session,\n                                   \"libvirt: virNetSSHSessionFree()\");\n        libssh2_session_free(sess->session);\n    }\n\n    virNetSSHSessionAuthMethodsFree(sess);\n\n    VIR_FREE(sess->channelCommand);\n    VIR_FREE(sess->hostname);\n    VIR_FREE(sess->knownHostsFile);\n    VIR_FREE(sess->authPath);\n}"
  },
  {
    "function_name": "virNetSSHSessionAuthMethodsFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetsshsession.c",
    "lines": "115-129",
    "snippet": "static void\nvirNetSSHSessionAuthMethodsFree(virNetSSHSessionPtr sess)\n{\n    size_t i;\n\n    for (i = 0; i < sess->nauths; i++) {\n        VIR_FREE(sess->auths[i]->username);\n        VIR_FREE(sess->auths[i]->password);\n        VIR_FREE(sess->auths[i]->filename);\n        VIR_FREE(sess->auths[i]);\n    }\n\n    VIR_FREE(sess->auths);\n    sess->nauths = 0;\n}",
    "includes": [
      "#include \"virauth.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virthread.h\"",
      "#include \"configmake.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virbuffer.h\"",
      "#include \"internal.h\"",
      "#include \"virnetsshsession.h\"",
      "#include <libssh2_publickey.h>",
      "#include <libssh2.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->auths"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->auths[i]"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->auths[i]->filename"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->auths[i]->password"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sess->auths[i]->username"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virauth.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"configmake.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include \"virnetsshsession.h\"\n#include <libssh2_publickey.h>\n#include <libssh2.h>\n#include <config.h>\n\nstatic void\nvirNetSSHSessionAuthMethodsFree(virNetSSHSessionPtr sess)\n{\n    size_t i;\n\n    for (i = 0; i < sess->nauths; i++) {\n        VIR_FREE(sess->auths[i]->username);\n        VIR_FREE(sess->auths[i]->password);\n        VIR_FREE(sess->auths[i]->filename);\n        VIR_FREE(sess->auths[i]);\n    }\n\n    VIR_FREE(sess->auths);\n    sess->nauths = 0;\n}"
  }
]