[
  {
    "function_name": "virNodeDeviceEventUpdateNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "265-280",
    "snippet": "virObjectEventPtr\nvirNodeDeviceEventUpdateNew(const char *name)\n{\n    virNodeDeviceEventUpdatePtr event;\n\n    if (virNodeDeviceEventsInitialize() < 0)\n        return NULL;\n\n    if (!(event = virObjectEventNew(virNodeDeviceEventUpdateClass,\n                                    virNodeDeviceEventDispatchDefaultFunc,\n                                    VIR_NODE_DEVICE_EVENT_ID_UPDATE,\n                                    0, name, NULL, name)))\n        return NULL;\n\n    return (virObjectEventPtr)event;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virNodeDeviceEventUpdateClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventNew",
          "args": [
            "virNodeDeviceEventUpdateClass",
            "virNodeDeviceEventDispatchDefaultFunc",
            "VIR_NODE_DEVICE_EVENT_ID_UPDATE",
            "0",
            "name",
            "NULL",
            "name"
          ],
          "line": 273
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "597-633",
          "snippet": "void *\nvirObjectEventNew(virClassPtr klass,\n                  virObjectEventDispatchFunc dispatcher,\n                  int eventID,\n                  int id,\n                  const char *name,\n                  const unsigned char *uuid,\n                  const char *key)\n{\n    virObjectEventPtr event;\n\n    if (virObjectEventInitialize() < 0)\n        return NULL;\n\n    if (!virClassIsDerivedFrom(klass, virObjectEventClass)) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectEvent\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(event = virObjectNew(klass)))\n        return NULL;\n\n    event->dispatch = dispatcher;\n    event->eventID = eventID;\n    event->remoteID = -1;\n\n    event->meta.name = g_strdup(name);\n    event->meta.key = g_strdup(key);\n    event->meta.id = id;\n    if (uuid)\n        memcpy(event->meta.uuid, uuid, VIR_UUID_BUFLEN);\n\n    VIR_DEBUG(\"obj=%p\", event);\n    return event;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectEventClass;",
            "static void virObjectEventDispose(void *obj);",
            "static void virObjectEventStateDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectEventClass;\nstatic void virObjectEventDispose(void *obj);\nstatic void virObjectEventStateDispose(void *obj);\n\nvoid *\nvirObjectEventNew(virClassPtr klass,\n                  virObjectEventDispatchFunc dispatcher,\n                  int eventID,\n                  int id,\n                  const char *name,\n                  const unsigned char *uuid,\n                  const char *key)\n{\n    virObjectEventPtr event;\n\n    if (virObjectEventInitialize() < 0)\n        return NULL;\n\n    if (!virClassIsDerivedFrom(klass, virObjectEventClass)) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectEvent\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(event = virObjectNew(klass)))\n        return NULL;\n\n    event->dispatch = dispatcher;\n    event->eventID = eventID;\n    event->remoteID = -1;\n\n    event->meta.name = g_strdup(name);\n    event->meta.key = g_strdup(key);\n    event->meta.id = id;\n    if (uuid)\n        memcpy(event->meta.uuid, uuid, VIR_UUID_BUFLEN);\n\n    VIR_DEBUG(\"obj=%p\", event);\n    return event;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceEventsInitialize",
          "args": [],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic virClassPtr virNodeDeviceEventUpdateClass;\n\nvirObjectEventPtr\nvirNodeDeviceEventUpdateNew(const char *name)\n{\n    virNodeDeviceEventUpdatePtr event;\n\n    if (virNodeDeviceEventsInitialize() < 0)\n        return NULL;\n\n    if (!(event = virObjectEventNew(virNodeDeviceEventUpdateClass,\n                                    virNodeDeviceEventDispatchDefaultFunc,\n                                    VIR_NODE_DEVICE_EVENT_ID_UPDATE,\n                                    0, name, NULL, name)))\n        return NULL;\n\n    return (virObjectEventPtr)event;\n}"
  },
  {
    "function_name": "virNodeDeviceEventLifecycleNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "236-256",
    "snippet": "virObjectEventPtr\nvirNodeDeviceEventLifecycleNew(const char *name,\n                               int type,\n                               int detail)\n{\n    virNodeDeviceEventLifecyclePtr event;\n\n    if (virNodeDeviceEventsInitialize() < 0)\n        return NULL;\n\n    if (!(event = virObjectEventNew(virNodeDeviceEventLifecycleClass,\n                                    virNodeDeviceEventDispatchDefaultFunc,\n                                    VIR_NODE_DEVICE_EVENT_ID_LIFECYCLE,\n                                    0, name, NULL, name)))\n        return NULL;\n\n    event->type = type;\n    event->detail = detail;\n\n    return (virObjectEventPtr)event;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virNodeDeviceEventLifecycleClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventNew",
          "args": [
            "virNodeDeviceEventLifecycleClass",
            "virNodeDeviceEventDispatchDefaultFunc",
            "VIR_NODE_DEVICE_EVENT_ID_LIFECYCLE",
            "0",
            "name",
            "NULL",
            "name"
          ],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "597-633",
          "snippet": "void *\nvirObjectEventNew(virClassPtr klass,\n                  virObjectEventDispatchFunc dispatcher,\n                  int eventID,\n                  int id,\n                  const char *name,\n                  const unsigned char *uuid,\n                  const char *key)\n{\n    virObjectEventPtr event;\n\n    if (virObjectEventInitialize() < 0)\n        return NULL;\n\n    if (!virClassIsDerivedFrom(klass, virObjectEventClass)) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectEvent\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(event = virObjectNew(klass)))\n        return NULL;\n\n    event->dispatch = dispatcher;\n    event->eventID = eventID;\n    event->remoteID = -1;\n\n    event->meta.name = g_strdup(name);\n    event->meta.key = g_strdup(key);\n    event->meta.id = id;\n    if (uuid)\n        memcpy(event->meta.uuid, uuid, VIR_UUID_BUFLEN);\n\n    VIR_DEBUG(\"obj=%p\", event);\n    return event;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectEventClass;",
            "static void virObjectEventDispose(void *obj);",
            "static void virObjectEventStateDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectEventClass;\nstatic void virObjectEventDispose(void *obj);\nstatic void virObjectEventStateDispose(void *obj);\n\nvoid *\nvirObjectEventNew(virClassPtr klass,\n                  virObjectEventDispatchFunc dispatcher,\n                  int eventID,\n                  int id,\n                  const char *name,\n                  const unsigned char *uuid,\n                  const char *key)\n{\n    virObjectEventPtr event;\n\n    if (virObjectEventInitialize() < 0)\n        return NULL;\n\n    if (!virClassIsDerivedFrom(klass, virObjectEventClass)) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectEvent\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(event = virObjectNew(klass)))\n        return NULL;\n\n    event->dispatch = dispatcher;\n    event->eventID = eventID;\n    event->remoteID = -1;\n\n    event->meta.name = g_strdup(name);\n    event->meta.key = g_strdup(key);\n    event->meta.id = id;\n    if (uuid)\n        memcpy(event->meta.uuid, uuid, VIR_UUID_BUFLEN);\n\n    VIR_DEBUG(\"obj=%p\", event);\n    return event;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceEventsInitialize",
          "args": [],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic virClassPtr virNodeDeviceEventLifecycleClass;\n\nvirObjectEventPtr\nvirNodeDeviceEventLifecycleNew(const char *name,\n                               int type,\n                               int detail)\n{\n    virNodeDeviceEventLifecyclePtr event;\n\n    if (virNodeDeviceEventsInitialize() < 0)\n        return NULL;\n\n    if (!(event = virObjectEventNew(virNodeDeviceEventLifecycleClass,\n                                    virNodeDeviceEventDispatchDefaultFunc,\n                                    VIR_NODE_DEVICE_EVENT_ID_LIFECYCLE,\n                                    0, name, NULL, name)))\n        return NULL;\n\n    event->type = type;\n    event->detail = detail;\n\n    return (virObjectEventPtr)event;\n}"
  },
  {
    "function_name": "virNodeDeviceEventStateRegisterClient",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "206-225",
    "snippet": "int\nvirNodeDeviceEventStateRegisterClient(virConnectPtr conn,\n                                      virObjectEventStatePtr state,\n                                      virNodeDevicePtr dev,\n                                      int eventID,\n                                      virConnectNodeDeviceEventGenericCallback cb,\n                                      void *opaque,\n                                      virFreeCallback freecb,\n                                      int *callbackID)\n{\n    if (virNodeDeviceEventsInitialize() < 0)\n        return -1;\n\n    return virObjectEventStateRegisterID(conn, state,  dev ? dev->name : NULL,\n                                         NULL, NULL,\n                                         virNodeDeviceEventClass, eventID,\n                                         VIR_OBJECT_EVENT_CALLBACK(cb),\n                                         opaque, freecb,\n                                         false, callbackID, true);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virNodeDeviceEventClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventStateRegisterID",
          "args": [
            "conn",
            "state",
            "dev ? dev->name : NULL",
            "NULL",
            "NULL",
            "virNodeDeviceEventClass",
            "eventID",
            "VIR_OBJECT_EVENT_CALLBACK(cb)",
            "opaque",
            "freecb",
            "false",
            "callbackID",
            "true"
          ],
          "line": 219
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventStateRegisterID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "870-917",
          "snippet": "int\nvirObjectEventStateRegisterID(virConnectPtr conn,\n                              virObjectEventStatePtr state,\n                              const char *key,\n                              virObjectEventCallbackFilter filter,\n                              void *filter_opaque,\n                              virClassPtr klass,\n                              int eventID,\n                              virConnectObjectEventGenericCallback cb,\n                              void *opaque,\n                              virFreeCallback freecb,\n                              bool legacy,\n                              int *callbackID,\n                              bool serverFilter)\n{\n    int ret = -1;\n\n    virObjectLock(state);\n\n    if ((state->callbacks->count == 0) &&\n        (state->timer == -1)) {\n        if ((state->timer = virEventAddTimeout(-1,\n                                               virObjectEventTimer,\n                                               state,\n                                               virObjectFreeCallback)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"could not initialize domain event timer\"));\n            goto cleanup;\n        }\n\n        /* event loop has one reference, but we need one more for the\n         * timer's opaque argument */\n        virObjectRef(state);\n    }\n\n    ret = virObjectEventCallbackListAddID(conn, state->callbacks,\n                                          key, filter, filter_opaque,\n                                          klass, eventID,\n                                          cb, opaque, freecb,\n                                          legacy, callbackID, serverFilter);\n\n    if (ret < 0)\n        virObjectEventStateCleanupTimer(state, false);\n\n cleanup:\n    virObjectUnlock(state);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectEventStateFlush(virObjectEventStatePtr state);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic void virObjectEventStateFlush(virObjectEventStatePtr state);\n\nint\nvirObjectEventStateRegisterID(virConnectPtr conn,\n                              virObjectEventStatePtr state,\n                              const char *key,\n                              virObjectEventCallbackFilter filter,\n                              void *filter_opaque,\n                              virClassPtr klass,\n                              int eventID,\n                              virConnectObjectEventGenericCallback cb,\n                              void *opaque,\n                              virFreeCallback freecb,\n                              bool legacy,\n                              int *callbackID,\n                              bool serverFilter)\n{\n    int ret = -1;\n\n    virObjectLock(state);\n\n    if ((state->callbacks->count == 0) &&\n        (state->timer == -1)) {\n        if ((state->timer = virEventAddTimeout(-1,\n                                               virObjectEventTimer,\n                                               state,\n                                               virObjectFreeCallback)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"could not initialize domain event timer\"));\n            goto cleanup;\n        }\n\n        /* event loop has one reference, but we need one more for the\n         * timer's opaque argument */\n        virObjectRef(state);\n    }\n\n    ret = virObjectEventCallbackListAddID(conn, state->callbacks,\n                                          key, filter, filter_opaque,\n                                          klass, eventID,\n                                          cb, opaque, freecb,\n                                          legacy, callbackID, serverFilter);\n\n    if (ret < 0)\n        virObjectEventStateCleanupTimer(state, false);\n\n cleanup:\n    virObjectUnlock(state);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_OBJECT_EVENT_CALLBACK",
          "args": [
            "cb"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceEventsInitialize",
          "args": [],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic virClassPtr virNodeDeviceEventClass;\n\nint\nvirNodeDeviceEventStateRegisterClient(virConnectPtr conn,\n                                      virObjectEventStatePtr state,\n                                      virNodeDevicePtr dev,\n                                      int eventID,\n                                      virConnectNodeDeviceEventGenericCallback cb,\n                                      void *opaque,\n                                      virFreeCallback freecb,\n                                      int *callbackID)\n{\n    if (virNodeDeviceEventsInitialize() < 0)\n        return -1;\n\n    return virObjectEventStateRegisterID(conn, state,  dev ? dev->name : NULL,\n                                         NULL, NULL,\n                                         virNodeDeviceEventClass, eventID,\n                                         VIR_OBJECT_EVENT_CALLBACK(cb),\n                                         opaque, freecb,\n                                         false, callbackID, true);\n}"
  },
  {
    "function_name": "virNodeDeviceEventStateRegisterID",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "166-185",
    "snippet": "int\nvirNodeDeviceEventStateRegisterID(virConnectPtr conn,\n                                  virObjectEventStatePtr state,\n                                  virNodeDevicePtr dev,\n                                  int eventID,\n                                  virConnectNodeDeviceEventGenericCallback cb,\n                                  void *opaque,\n                                  virFreeCallback freecb,\n                                  int *callbackID)\n{\n    if (virNodeDeviceEventsInitialize() < 0)\n        return -1;\n\n    return virObjectEventStateRegisterID(conn, state, dev ? dev->name : NULL,\n                                         NULL, NULL,\n                                         virNodeDeviceEventClass, eventID,\n                                         VIR_OBJECT_EVENT_CALLBACK(cb),\n                                         opaque, freecb,\n                                         false, callbackID, false);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virNodeDeviceEventClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventStateRegisterID",
          "args": [
            "conn",
            "state",
            "dev ? dev->name : NULL",
            "NULL",
            "NULL",
            "virNodeDeviceEventClass",
            "eventID",
            "VIR_OBJECT_EVENT_CALLBACK(cb)",
            "opaque",
            "freecb",
            "false",
            "callbackID",
            "false"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventStateRegisterID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "870-917",
          "snippet": "int\nvirObjectEventStateRegisterID(virConnectPtr conn,\n                              virObjectEventStatePtr state,\n                              const char *key,\n                              virObjectEventCallbackFilter filter,\n                              void *filter_opaque,\n                              virClassPtr klass,\n                              int eventID,\n                              virConnectObjectEventGenericCallback cb,\n                              void *opaque,\n                              virFreeCallback freecb,\n                              bool legacy,\n                              int *callbackID,\n                              bool serverFilter)\n{\n    int ret = -1;\n\n    virObjectLock(state);\n\n    if ((state->callbacks->count == 0) &&\n        (state->timer == -1)) {\n        if ((state->timer = virEventAddTimeout(-1,\n                                               virObjectEventTimer,\n                                               state,\n                                               virObjectFreeCallback)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"could not initialize domain event timer\"));\n            goto cleanup;\n        }\n\n        /* event loop has one reference, but we need one more for the\n         * timer's opaque argument */\n        virObjectRef(state);\n    }\n\n    ret = virObjectEventCallbackListAddID(conn, state->callbacks,\n                                          key, filter, filter_opaque,\n                                          klass, eventID,\n                                          cb, opaque, freecb,\n                                          legacy, callbackID, serverFilter);\n\n    if (ret < 0)\n        virObjectEventStateCleanupTimer(state, false);\n\n cleanup:\n    virObjectUnlock(state);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectEventStateFlush(virObjectEventStatePtr state);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic void virObjectEventStateFlush(virObjectEventStatePtr state);\n\nint\nvirObjectEventStateRegisterID(virConnectPtr conn,\n                              virObjectEventStatePtr state,\n                              const char *key,\n                              virObjectEventCallbackFilter filter,\n                              void *filter_opaque,\n                              virClassPtr klass,\n                              int eventID,\n                              virConnectObjectEventGenericCallback cb,\n                              void *opaque,\n                              virFreeCallback freecb,\n                              bool legacy,\n                              int *callbackID,\n                              bool serverFilter)\n{\n    int ret = -1;\n\n    virObjectLock(state);\n\n    if ((state->callbacks->count == 0) &&\n        (state->timer == -1)) {\n        if ((state->timer = virEventAddTimeout(-1,\n                                               virObjectEventTimer,\n                                               state,\n                                               virObjectFreeCallback)) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"could not initialize domain event timer\"));\n            goto cleanup;\n        }\n\n        /* event loop has one reference, but we need one more for the\n         * timer's opaque argument */\n        virObjectRef(state);\n    }\n\n    ret = virObjectEventCallbackListAddID(conn, state->callbacks,\n                                          key, filter, filter_opaque,\n                                          klass, eventID,\n                                          cb, opaque, freecb,\n                                          legacy, callbackID, serverFilter);\n\n    if (ret < 0)\n        virObjectEventStateCleanupTimer(state, false);\n\n cleanup:\n    virObjectUnlock(state);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_OBJECT_EVENT_CALLBACK",
          "args": [
            "cb"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceEventsInitialize",
          "args": [],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic virClassPtr virNodeDeviceEventClass;\n\nint\nvirNodeDeviceEventStateRegisterID(virConnectPtr conn,\n                                  virObjectEventStatePtr state,\n                                  virNodeDevicePtr dev,\n                                  int eventID,\n                                  virConnectNodeDeviceEventGenericCallback cb,\n                                  void *opaque,\n                                  virFreeCallback freecb,\n                                  int *callbackID)\n{\n    if (virNodeDeviceEventsInitialize() < 0)\n        return -1;\n\n    return virObjectEventStateRegisterID(conn, state, dev ? dev->name : NULL,\n                                         NULL, NULL,\n                                         virNodeDeviceEventClass, eventID,\n                                         VIR_OBJECT_EVENT_CALLBACK(cb),\n                                         opaque, freecb,\n                                         false, callbackID, false);\n}"
  },
  {
    "function_name": "virNodeDeviceEventDispatchDefaultFunc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "107-146",
    "snippet": "static void\nvirNodeDeviceEventDispatchDefaultFunc(virConnectPtr conn,\n                                      virObjectEventPtr event,\n                                      virConnectObjectEventGenericCallback cb,\n                                      void *cbopaque)\n{\n    virNodeDevicePtr dev = virGetNodeDevice(conn,\n                                            event->meta.name);\n\n    if (!dev)\n        return;\n\n    switch ((virNodeDeviceEventID)event->eventID) {\n    case VIR_NODE_DEVICE_EVENT_ID_LIFECYCLE:\n        {\n            virNodeDeviceEventLifecyclePtr nodeDeviceLifecycleEvent;\n\n            nodeDeviceLifecycleEvent = (virNodeDeviceEventLifecyclePtr)event;\n            ((virConnectNodeDeviceEventLifecycleCallback)cb)(conn, dev,\n                                                             nodeDeviceLifecycleEvent->type,\n                                                             nodeDeviceLifecycleEvent->detail,\n                                                             cbopaque);\n            goto cleanup;\n        }\n\n    case VIR_NODE_DEVICE_EVENT_ID_UPDATE:\n        {\n            ((virConnectNodeDeviceEventGenericCallback)cb)(conn, dev,\n                                                           cbopaque);\n            goto cleanup;\n        }\n\n    case VIR_NODE_DEVICE_EVENT_ID_LAST:\n        break;\n    }\n    VIR_WARN(\"Unexpected event ID %d\", event->eventID);\n\n cleanup:\n    virObjectUnref(dev);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "dev"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Unexpected event ID %d\"",
            "event->eventID"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "conn",
            "dev",
            "cbopaque"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "conn",
            "dev",
            "nodeDeviceLifecycleEvent->type",
            "nodeDeviceLifecycleEvent->detail",
            "cbopaque"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetNodeDevice",
          "args": [
            "conn",
            "event->meta.name"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "virGetNodeDevice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/datatypes.c",
          "lines": "671-693",
          "snippet": "virNodeDevicePtr\nvirGetNodeDevice(virConnectPtr conn, const char *name)\n{\n    virNodeDevicePtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(name, error);\n\n    if (!(ret = virObjectNew(virNodeDeviceClass)))\n        goto error;\n\n    ret->name = g_strdup(name);\n\n    ret->conn = virObjectRef(conn);\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virClassPtr virNodeDeviceClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirClassPtr virNodeDeviceClass;\n\nvirNodeDevicePtr\nvirGetNodeDevice(virConnectPtr conn, const char *name)\n{\n    virNodeDevicePtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(name, error);\n\n    if (!(ret = virObjectNew(virNodeDeviceClass)))\n        goto error;\n\n    ret->name = g_strdup(name);\n\n    ret->conn = virObjectRef(conn);\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic void\nvirNodeDeviceEventDispatchDefaultFunc(virConnectPtr conn,\n                                      virObjectEventPtr event,\n                                      virConnectObjectEventGenericCallback cb,\n                                      void *cbopaque)\n{\n    virNodeDevicePtr dev = virGetNodeDevice(conn,\n                                            event->meta.name);\n\n    if (!dev)\n        return;\n\n    switch ((virNodeDeviceEventID)event->eventID) {\n    case VIR_NODE_DEVICE_EVENT_ID_LIFECYCLE:\n        {\n            virNodeDeviceEventLifecyclePtr nodeDeviceLifecycleEvent;\n\n            nodeDeviceLifecycleEvent = (virNodeDeviceEventLifecyclePtr)event;\n            ((virConnectNodeDeviceEventLifecycleCallback)cb)(conn, dev,\n                                                             nodeDeviceLifecycleEvent->type,\n                                                             nodeDeviceLifecycleEvent->detail,\n                                                             cbopaque);\n            goto cleanup;\n        }\n\n    case VIR_NODE_DEVICE_EVENT_ID_UPDATE:\n        {\n            ((virConnectNodeDeviceEventGenericCallback)cb)(conn, dev,\n                                                           cbopaque);\n            goto cleanup;\n        }\n\n    case VIR_NODE_DEVICE_EVENT_ID_LAST:\n        break;\n    }\n    VIR_WARN(\"Unexpected event ID %d\", event->eventID);\n\n cleanup:\n    virObjectUnref(dev);\n}"
  },
  {
    "function_name": "virNodeDeviceEventUpdateDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "99-104",
    "snippet": "static void\nvirNodeDeviceEventUpdateDispose(void *obj)\n{\n    virNodeDeviceEventUpdatePtr event = obj;\n    VIR_DEBUG(\"obj=%p\", event);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virNodeDeviceEventDispose(void *obj);",
      "static void virNodeDeviceEventLifecycleDispose(void *obj);",
      "static void virNodeDeviceEventUpdateDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"obj=%p\"",
            "event"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic void virNodeDeviceEventDispose(void *obj);\nstatic void virNodeDeviceEventLifecycleDispose(void *obj);\nstatic void virNodeDeviceEventUpdateDispose(void *obj);\n\nstatic void\nvirNodeDeviceEventUpdateDispose(void *obj)\n{\n    virNodeDeviceEventUpdatePtr event = obj;\n    VIR_DEBUG(\"obj=%p\", event);\n}"
  },
  {
    "function_name": "virNodeDeviceEventLifecycleDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "91-96",
    "snippet": "static void\nvirNodeDeviceEventLifecycleDispose(void *obj)\n{\n    virNodeDeviceEventLifecyclePtr event = obj;\n    VIR_DEBUG(\"obj=%p\", event);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virNodeDeviceEventDispose(void *obj);",
      "static void virNodeDeviceEventLifecycleDispose(void *obj);",
      "static void virNodeDeviceEventUpdateDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"obj=%p\"",
            "event"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic void virNodeDeviceEventDispose(void *obj);\nstatic void virNodeDeviceEventLifecycleDispose(void *obj);\nstatic void virNodeDeviceEventUpdateDispose(void *obj);\n\nstatic void\nvirNodeDeviceEventLifecycleDispose(void *obj)\n{\n    virNodeDeviceEventLifecyclePtr event = obj;\n    VIR_DEBUG(\"obj=%p\", event);\n}"
  },
  {
    "function_name": "virNodeDeviceEventDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "83-88",
    "snippet": "static void\nvirNodeDeviceEventDispose(void *obj)\n{\n    virNodeDeviceEventPtr event = obj;\n    VIR_DEBUG(\"obj=%p\", event);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virNodeDeviceEventDispose(void *obj);",
      "static void virNodeDeviceEventLifecycleDispose(void *obj);",
      "static void virNodeDeviceEventUpdateDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"obj=%p\"",
            "event"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic void virNodeDeviceEventDispose(void *obj);\nstatic void virNodeDeviceEventLifecycleDispose(void *obj);\nstatic void virNodeDeviceEventUpdateDispose(void *obj);\n\nstatic void\nvirNodeDeviceEventDispose(void *obj)\n{\n    virNodeDeviceEventPtr event = obj;\n    VIR_DEBUG(\"obj=%p\", event);\n}"
  },
  {
    "function_name": "virNodeDeviceEventsOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
    "lines": "66-79",
    "snippet": "static int\nvirNodeDeviceEventsOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virNodeDeviceEvent, virClassForObjectEvent()))\n        return -1;\n\n    if (!VIR_CLASS_NEW(virNodeDeviceEventLifecycle, virNodeDeviceEventClass))\n        return -1;\n\n    if (!VIR_CLASS_NEW(virNodeDeviceEventUpdate, virNodeDeviceEventClass))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"datatypes.h\"",
      "#include \"object_event_private.h\"",
      "#include \"object_event.h\"",
      "#include \"node_device_event.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virNodeDeviceEventClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virNodeDeviceEventUpdate",
            "virNodeDeviceEventClass"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virNodeDeviceEventLifecycle",
            "virNodeDeviceEventClass"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virNodeDeviceEvent",
            "virClassForObjectEvent()"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virClassForObjectEvent",
          "args": [],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "virClassForObjectEvent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "110-116",
          "snippet": "virClassPtr\nvirClassForObjectEvent(void)\n{\n    if (virObjectEventInitialize() < 0)\n        return NULL;\n    return virObjectEventClass;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectEventClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectEventClass;\n\nvirClassPtr\nvirClassForObjectEvent(void)\n{\n    if (virObjectEventInitialize() < 0)\n        return NULL;\n    return virObjectEventClass;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic virClassPtr virNodeDeviceEventClass;\n\nstatic int\nvirNodeDeviceEventsOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virNodeDeviceEvent, virClassForObjectEvent()))\n        return -1;\n\n    if (!VIR_CLASS_NEW(virNodeDeviceEventLifecycle, virNodeDeviceEventClass))\n        return -1;\n\n    if (!VIR_CLASS_NEW(virNodeDeviceEventUpdate, virNodeDeviceEventClass))\n        return -1;\n\n    return 0;\n}"
  }
]