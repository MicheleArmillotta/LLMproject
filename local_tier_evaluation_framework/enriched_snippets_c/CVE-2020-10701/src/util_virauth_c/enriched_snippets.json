[
  {
    "function_name": "virAuthGetPassword",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
    "lines": "276-289",
    "snippet": "char *\nvirAuthGetPassword(virConnectPtr conn,\n                   virConnectAuthPtr auth,\n                   const char *servicename,\n                   const char *username,\n                   const char *hostname)\n{\n    g_autofree char *path = NULL;\n\n    if (virAuthGetConfigFilePath(conn, &path) < 0)\n        return NULL;\n\n    return virAuthGetPasswordPath(path, auth, servicename, username, hostname);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virauthconfig.h\"",
      "#include \"configmake.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virauth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virAuthGetPasswordPath",
          "args": [
            "path",
            "auth",
            "servicename",
            "username",
            "hostname"
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetPasswordPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "214-273",
          "snippet": "char *\nvirAuthGetPasswordPath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *username,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"password\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    prompt = g_strdup_printf(_(\"Enter %s's password for %s\"), username, hostname);\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_PASSPHRASE &&\n            auth->credtype[ncred] != VIR_CRED_NOECHOPROMPT) {\n            continue;\n        }\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = auth->credtype[ncred];\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = NULL;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Password request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_PASSPHRASE or VIR_CRED_NOECHOPROMPT \"\n                     \"credential type\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nchar *\nvirAuthGetPasswordPath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *username,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"password\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    prompt = g_strdup_printf(_(\"Enter %s's password for %s\"), username, hostname);\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_PASSPHRASE &&\n            auth->credtype[ncred] != VIR_CRED_NOECHOPROMPT) {\n            continue;\n        }\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = auth->credtype[ncred];\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = NULL;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Password request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_PASSPHRASE or VIR_CRED_NOECHOPROMPT \"\n                     \"credential type\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virAuthGetConfigFilePath",
          "args": [
            "conn",
            "&path"
          ],
          "line": 285
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetConfigFilePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "94-99",
          "snippet": "int\nvirAuthGetConfigFilePath(virConnectPtr conn,\n                         char **path)\n{\n    return virAuthGetConfigFilePathURI(conn ? conn->uri : NULL, path);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nint\nvirAuthGetConfigFilePath(virConnectPtr conn,\n                         char **path)\n{\n    return virAuthGetConfigFilePathURI(conn ? conn->uri : NULL, path);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nchar *\nvirAuthGetPassword(virConnectPtr conn,\n                   virConnectAuthPtr auth,\n                   const char *servicename,\n                   const char *username,\n                   const char *hostname)\n{\n    g_autofree char *path = NULL;\n\n    if (virAuthGetConfigFilePath(conn, &path) < 0)\n        return NULL;\n\n    return virAuthGetPasswordPath(path, auth, servicename, username, hostname);\n}"
  },
  {
    "function_name": "virAuthGetPasswordPath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
    "lines": "214-273",
    "snippet": "char *\nvirAuthGetPasswordPath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *username,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"password\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    prompt = g_strdup_printf(_(\"Enter %s's password for %s\"), username, hostname);\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_PASSPHRASE &&\n            auth->credtype[ncred] != VIR_CRED_NOECHOPROMPT) {\n            continue;\n        }\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = auth->credtype[ncred];\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = NULL;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Password request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_PASSPHRASE or VIR_CRED_NOECHOPROMPT \"\n                     \"credential type\"));\n    return NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virauthconfig.h\"",
      "#include \"configmake.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virauth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"Missing VIR_CRED_PASSPHRASE or VIR_CRED_NOECHOPROMPT \"\n                     \"credential type\")"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Missing VIR_CRED_PASSPHRASE or VIR_CRED_NOECHOPROMPT \"\n                     \"credential type\""
          ],
          "line": 270
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cred.result"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"Password request failed\")"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "&cred",
            "1",
            "auth->cbdata"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "\"%s\"",
            "_(\"Missing authentication callback\")"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&cred",
            "0",
            "sizeof(virConnectCredential)"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "\"%s\"",
            "_(\"Missing authentication credentials\")"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virAuthGetCredential",
          "args": [
            "servicename",
            "hostname",
            "\"password\"",
            "path",
            "&ret"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetCredential",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "102-130",
          "snippet": "static int\nvirAuthGetCredential(const char *servicename,\n                     const char *hostname,\n                     const char *credname,\n                     const char *path,\n                     char **value)\n{\n    g_autoptr(virAuthConfig) config = NULL;\n    const char *tmp;\n\n    *value = NULL;\n\n    if (path == NULL)\n        return 0;\n\n    if (!(config = virAuthConfigNew(path)))\n        return -1;\n\n    if (virAuthConfigLookup(config,\n                            servicename,\n                            hostname,\n                            credname,\n                            &tmp) < 0)\n        return -1;\n\n    *value = g_strdup(tmp);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nstatic int\nvirAuthGetCredential(const char *servicename,\n                     const char *hostname,\n                     const char *credname,\n                     const char *path,\n                     char **value)\n{\n    g_autoptr(virAuthConfig) config = NULL;\n    const char *tmp;\n\n    *value = NULL;\n\n    if (path == NULL)\n        return 0;\n\n    if (!(config = virAuthConfigNew(path)))\n        return -1;\n\n    if (virAuthConfigLookup(config,\n                            servicename,\n                            hostname,\n                            credname,\n                            &tmp) < 0)\n        return -1;\n\n    *value = g_strdup(tmp);\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nchar *\nvirAuthGetPasswordPath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *username,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"password\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    prompt = g_strdup_printf(_(\"Enter %s's password for %s\"), username, hostname);\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_PASSPHRASE &&\n            auth->credtype[ncred] != VIR_CRED_NOECHOPROMPT) {\n            continue;\n        }\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = auth->credtype[ncred];\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = NULL;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Password request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_PASSPHRASE or VIR_CRED_NOECHOPROMPT \"\n                     \"credential type\"));\n    return NULL;\n}"
  },
  {
    "function_name": "virAuthGetUsername",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
    "lines": "197-211",
    "snippet": "char *\nvirAuthGetUsername(virConnectPtr conn,\n                   virConnectAuthPtr auth,\n                   const char *servicename,\n                   const char *defaultUsername,\n                   const char *hostname)\n{\n    g_autofree char *path = NULL;\n\n    if (virAuthGetConfigFilePath(conn, &path) < 0)\n        return NULL;\n\n    return virAuthGetUsernamePath(path, auth, servicename,\n                                  defaultUsername, hostname);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virauthconfig.h\"",
      "#include \"configmake.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virauth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virAuthGetUsernamePath",
          "args": [
            "path",
            "auth",
            "servicename",
            "defaultUsername",
            "hostname"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetUsernamePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "133-194",
          "snippet": "char *\nvirAuthGetUsernamePath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *defaultUsername,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"username\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    if (defaultUsername != NULL) {\n        prompt = g_strdup_printf(_(\"Enter username for %s [%s]\"), hostname,\n                                 defaultUsername);\n    } else {\n        prompt = g_strdup_printf(_(\"Enter username for %s\"), hostname);\n    }\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_AUTHNAME)\n            continue;\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = VIR_CRED_AUTHNAME;\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = defaultUsername;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Username request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_AUTHNAME credential type\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nchar *\nvirAuthGetUsernamePath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *defaultUsername,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"username\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    if (defaultUsername != NULL) {\n        prompt = g_strdup_printf(_(\"Enter username for %s [%s]\"), hostname,\n                                 defaultUsername);\n    } else {\n        prompt = g_strdup_printf(_(\"Enter username for %s\"), hostname);\n    }\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_AUTHNAME)\n            continue;\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = VIR_CRED_AUTHNAME;\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = defaultUsername;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Username request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_AUTHNAME credential type\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virAuthGetConfigFilePath",
          "args": [
            "conn",
            "&path"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetConfigFilePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "94-99",
          "snippet": "int\nvirAuthGetConfigFilePath(virConnectPtr conn,\n                         char **path)\n{\n    return virAuthGetConfigFilePathURI(conn ? conn->uri : NULL, path);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nint\nvirAuthGetConfigFilePath(virConnectPtr conn,\n                         char **path)\n{\n    return virAuthGetConfigFilePathURI(conn ? conn->uri : NULL, path);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nchar *\nvirAuthGetUsername(virConnectPtr conn,\n                   virConnectAuthPtr auth,\n                   const char *servicename,\n                   const char *defaultUsername,\n                   const char *hostname)\n{\n    g_autofree char *path = NULL;\n\n    if (virAuthGetConfigFilePath(conn, &path) < 0)\n        return NULL;\n\n    return virAuthGetUsernamePath(path, auth, servicename,\n                                  defaultUsername, hostname);\n}"
  },
  {
    "function_name": "virAuthGetUsernamePath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
    "lines": "133-194",
    "snippet": "char *\nvirAuthGetUsernamePath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *defaultUsername,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"username\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    if (defaultUsername != NULL) {\n        prompt = g_strdup_printf(_(\"Enter username for %s [%s]\"), hostname,\n                                 defaultUsername);\n    } else {\n        prompt = g_strdup_printf(_(\"Enter username for %s\"), hostname);\n    }\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_AUTHNAME)\n            continue;\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = VIR_CRED_AUTHNAME;\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = defaultUsername;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Username request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_AUTHNAME credential type\"));\n    return NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virauthconfig.h\"",
      "#include \"configmake.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virauth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"Missing VIR_CRED_AUTHNAME credential type\")"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Missing VIR_CRED_AUTHNAME credential type\""
          ],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cred.result"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"Username request failed\")"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "&cred",
            "1",
            "auth->cbdata"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "\"%s\"",
            "_(\"Missing authentication callback\")"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&cred",
            "0",
            "sizeof(virConnectCredential)"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "\"%s\"",
            "_(\"Missing authentication credentials\")"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virAuthGetCredential",
          "args": [
            "servicename",
            "hostname",
            "\"username\"",
            "path",
            "&ret"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetCredential",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "102-130",
          "snippet": "static int\nvirAuthGetCredential(const char *servicename,\n                     const char *hostname,\n                     const char *credname,\n                     const char *path,\n                     char **value)\n{\n    g_autoptr(virAuthConfig) config = NULL;\n    const char *tmp;\n\n    *value = NULL;\n\n    if (path == NULL)\n        return 0;\n\n    if (!(config = virAuthConfigNew(path)))\n        return -1;\n\n    if (virAuthConfigLookup(config,\n                            servicename,\n                            hostname,\n                            credname,\n                            &tmp) < 0)\n        return -1;\n\n    *value = g_strdup(tmp);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nstatic int\nvirAuthGetCredential(const char *servicename,\n                     const char *hostname,\n                     const char *credname,\n                     const char *path,\n                     char **value)\n{\n    g_autoptr(virAuthConfig) config = NULL;\n    const char *tmp;\n\n    *value = NULL;\n\n    if (path == NULL)\n        return 0;\n\n    if (!(config = virAuthConfigNew(path)))\n        return -1;\n\n    if (virAuthConfigLookup(config,\n                            servicename,\n                            hostname,\n                            credname,\n                            &tmp) < 0)\n        return -1;\n\n    *value = g_strdup(tmp);\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nchar *\nvirAuthGetUsernamePath(const char *path,\n                       virConnectAuthPtr auth,\n                       const char *servicename,\n                       const char *defaultUsername,\n                       const char *hostname)\n{\n    unsigned int ncred;\n    virConnectCredential cred;\n    g_autofree char *prompt = NULL;\n    char *ret = NULL;\n\n    if (virAuthGetCredential(servicename, hostname, \"username\", path, &ret) < 0)\n        return NULL;\n    if (ret != NULL)\n        return ret;\n\n    if (!auth) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Missing authentication credentials\"));\n        return NULL;\n    }\n\n    memset(&cred, 0, sizeof(virConnectCredential));\n\n    if (defaultUsername != NULL) {\n        prompt = g_strdup_printf(_(\"Enter username for %s [%s]\"), hostname,\n                                 defaultUsername);\n    } else {\n        prompt = g_strdup_printf(_(\"Enter username for %s\"), hostname);\n    }\n\n    for (ncred = 0; ncred < auth->ncredtype; ncred++) {\n        if (auth->credtype[ncred] != VIR_CRED_AUTHNAME)\n            continue;\n\n        if (!auth->cb) {\n            virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                           _(\"Missing authentication callback\"));\n            return NULL;\n        }\n\n        cred.type = VIR_CRED_AUTHNAME;\n        cred.prompt = prompt;\n        cred.challenge = hostname;\n        cred.defresult = defaultUsername;\n        cred.result = NULL;\n        cred.resultlen = 0;\n\n        if ((*(auth->cb))(&cred, 1, auth->cbdata) < 0) {\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"Username request failed\"));\n            VIR_FREE(cred.result);\n        }\n\n        return cred.result;\n    }\n\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"Missing VIR_CRED_AUTHNAME credential type\"));\n    return NULL;\n}"
  },
  {
    "function_name": "virAuthGetCredential",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
    "lines": "102-130",
    "snippet": "static int\nvirAuthGetCredential(const char *servicename,\n                     const char *hostname,\n                     const char *credname,\n                     const char *path,\n                     char **value)\n{\n    g_autoptr(virAuthConfig) config = NULL;\n    const char *tmp;\n\n    *value = NULL;\n\n    if (path == NULL)\n        return 0;\n\n    if (!(config = virAuthConfigNew(path)))\n        return -1;\n\n    if (virAuthConfigLookup(config,\n                            servicename,\n                            hostname,\n                            credname,\n                            &tmp) < 0)\n        return -1;\n\n    *value = g_strdup(tmp);\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virauthconfig.h\"",
      "#include \"configmake.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virauth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "tmp"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virAuthConfigLookup",
          "args": [
            "config",
            "servicename",
            "hostname",
            "credname",
            "&tmp"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthConfigLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauthconfig.c",
          "lines": "99-148",
          "snippet": "int virAuthConfigLookup(virAuthConfigPtr auth,\n                        const char *service,\n                        const char *hostname,\n                        const char *credname,\n                        const char **value)\n{\n    g_autofree char *authgroup = NULL;\n    g_autofree char *credgroup = NULL;\n    const char *authcred;\n\n    *value = NULL;\n\n    VIR_DEBUG(\"Lookup '%s' '%s' '%s'\", service, NULLSTR(hostname), credname);\n\n    if (!hostname)\n        hostname = \"localhost\";\n\n    authgroup = g_strdup_printf(\"auth-%s-%s\", service, hostname);\n\n    if (!virKeyFileHasGroup(auth->keyfile, authgroup)) {\n       VIR_FREE(authgroup);\n       authgroup = g_strdup_printf(\"auth-%s-%s\", service, \"default\");\n    }\n\n    if (!virKeyFileHasGroup(auth->keyfile, authgroup))\n        return 0;\n\n    if (!(authcred = virKeyFileGetValueString(auth->keyfile, authgroup, \"credentials\"))) {\n        virReportError(VIR_ERR_CONF_SYNTAX,\n                       _(\"Missing item 'credentials' in group '%s' in '%s'\"),\n                       authgroup, auth->path);\n        return -1;\n    }\n\n    credgroup = g_strdup_printf(\"credentials-%s\", authcred);\n\n    if (!virKeyFileHasGroup(auth->keyfile, credgroup)) {\n        virReportError(VIR_ERR_CONF_SYNTAX,\n                       _(\"Missing group 'credentials-%s' referenced from group '%s' in '%s'\"),\n                       authcred, authgroup, auth->path);\n        return -1;\n    }\n\n    if (!virKeyFileHasValue(auth->keyfile, credgroup, credname))\n        return 0;\n\n    *value = virKeyFileGetValueString(auth->keyfile, credgroup, credname);\n\n    return 0;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virkeyfile.h\"",
            "#include \"virauthconfig.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virkeyfile.h\"\n#include \"virauthconfig.h\"\n#include <config.h>\n\nint virAuthConfigLookup(virAuthConfigPtr auth,\n                        const char *service,\n                        const char *hostname,\n                        const char *credname,\n                        const char **value)\n{\n    g_autofree char *authgroup = NULL;\n    g_autofree char *credgroup = NULL;\n    const char *authcred;\n\n    *value = NULL;\n\n    VIR_DEBUG(\"Lookup '%s' '%s' '%s'\", service, NULLSTR(hostname), credname);\n\n    if (!hostname)\n        hostname = \"localhost\";\n\n    authgroup = g_strdup_printf(\"auth-%s-%s\", service, hostname);\n\n    if (!virKeyFileHasGroup(auth->keyfile, authgroup)) {\n       VIR_FREE(authgroup);\n       authgroup = g_strdup_printf(\"auth-%s-%s\", service, \"default\");\n    }\n\n    if (!virKeyFileHasGroup(auth->keyfile, authgroup))\n        return 0;\n\n    if (!(authcred = virKeyFileGetValueString(auth->keyfile, authgroup, \"credentials\"))) {\n        virReportError(VIR_ERR_CONF_SYNTAX,\n                       _(\"Missing item 'credentials' in group '%s' in '%s'\"),\n                       authgroup, auth->path);\n        return -1;\n    }\n\n    credgroup = g_strdup_printf(\"credentials-%s\", authcred);\n\n    if (!virKeyFileHasGroup(auth->keyfile, credgroup)) {\n        virReportError(VIR_ERR_CONF_SYNTAX,\n                       _(\"Missing group 'credentials-%s' referenced from group '%s' in '%s'\"),\n                       authcred, authgroup, auth->path);\n        return -1;\n    }\n\n    if (!virKeyFileHasValue(auth->keyfile, credgroup, credname))\n        return 0;\n\n    *value = virKeyFileGetValueString(auth->keyfile, credgroup, credname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virAuthConfigNew",
          "args": [
            "path"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthConfigNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauthconfig.c",
          "lines": "40-60",
          "snippet": "virAuthConfigPtr virAuthConfigNew(const char *path)\n{\n    virAuthConfigPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    auth->path = g_strdup(path);\n\n    if (!(auth->keyfile = virKeyFileNew()))\n        goto error;\n\n    if (virKeyFileLoadFile(auth->keyfile, path) < 0)\n        goto error;\n\n    return auth;\n\n error:\n    virAuthConfigFree(auth);\n    return NULL;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virkeyfile.h\"",
            "#include \"virauthconfig.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virkeyfile.h\"\n#include \"virauthconfig.h\"\n#include <config.h>\n\nvirAuthConfigPtr virAuthConfigNew(const char *path)\n{\n    virAuthConfigPtr auth;\n\n    if (VIR_ALLOC(auth) < 0)\n        goto error;\n\n    auth->path = g_strdup(path);\n\n    if (!(auth->keyfile = virKeyFileNew()))\n        goto error;\n\n    if (virKeyFileLoadFile(auth->keyfile, path) < 0)\n        goto error;\n\n    return auth;\n\n error:\n    virAuthConfigFree(auth);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nstatic int\nvirAuthGetCredential(const char *servicename,\n                     const char *hostname,\n                     const char *credname,\n                     const char *path,\n                     char **value)\n{\n    g_autoptr(virAuthConfig) config = NULL;\n    const char *tmp;\n\n    *value = NULL;\n\n    if (path == NULL)\n        return 0;\n\n    if (!(config = virAuthConfigNew(path)))\n        return -1;\n\n    if (virAuthConfigLookup(config,\n                            servicename,\n                            hostname,\n                            credname,\n                            &tmp) < 0)\n        return -1;\n\n    *value = g_strdup(tmp);\n\n    return 0;\n}"
  },
  {
    "function_name": "virAuthGetConfigFilePath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
    "lines": "94-99",
    "snippet": "int\nvirAuthGetConfigFilePath(virConnectPtr conn,\n                         char **path)\n{\n    return virAuthGetConfigFilePathURI(conn ? conn->uri : NULL, path);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virauthconfig.h\"",
      "#include \"configmake.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virauth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virAuthGetConfigFilePathURI",
          "args": [
            "conn ? conn->uri : NULL",
            "path"
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "virAuthGetConfigFilePathURI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
          "lines": "40-91",
          "snippet": "int\nvirAuthGetConfigFilePathURI(virURIPtr uri,\n                            char **path)\n{\n    size_t i;\n    const char *authenv = getenv(\"LIBVIRT_AUTH_FILE\");\n    g_autofree char *userdir = NULL;\n\n    *path = NULL;\n\n    VIR_DEBUG(\"Determining auth config file path\");\n\n    if (authenv) {\n        VIR_DEBUG(\"Using path from env '%s'\", authenv);\n        *path = g_strdup(authenv);\n        return 0;\n    }\n\n    if (uri) {\n        for (i = 0; i < uri->paramsCount; i++) {\n            if (STREQ_NULLABLE(uri->params[i].name, \"authfile\") &&\n                uri->params[i].value) {\n                VIR_DEBUG(\"Using path from URI '%s'\", uri->params[i].value);\n                *path = g_strdup(uri->params[i].value);\n                return 0;\n            }\n        }\n    }\n\n    userdir = virGetUserConfigDirectory();\n\n    *path = g_strdup_printf(\"%s/auth.conf\", userdir);\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n    *path = g_strdup(SYSCONFDIR \"/libvirt/auth.conf\");\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n done:\n    VIR_DEBUG(\"Using auth file '%s'\", NULLSTR(*path));\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virauthconfig.h\"",
            "#include \"configmake.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virauth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nint\nvirAuthGetConfigFilePathURI(virURIPtr uri,\n                            char **path)\n{\n    size_t i;\n    const char *authenv = getenv(\"LIBVIRT_AUTH_FILE\");\n    g_autofree char *userdir = NULL;\n\n    *path = NULL;\n\n    VIR_DEBUG(\"Determining auth config file path\");\n\n    if (authenv) {\n        VIR_DEBUG(\"Using path from env '%s'\", authenv);\n        *path = g_strdup(authenv);\n        return 0;\n    }\n\n    if (uri) {\n        for (i = 0; i < uri->paramsCount; i++) {\n            if (STREQ_NULLABLE(uri->params[i].name, \"authfile\") &&\n                uri->params[i].value) {\n                VIR_DEBUG(\"Using path from URI '%s'\", uri->params[i].value);\n                *path = g_strdup(uri->params[i].value);\n                return 0;\n            }\n        }\n    }\n\n    userdir = virGetUserConfigDirectory();\n\n    *path = g_strdup_printf(\"%s/auth.conf\", userdir);\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n    *path = g_strdup(SYSCONFDIR \"/libvirt/auth.conf\");\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n done:\n    VIR_DEBUG(\"Using auth file '%s'\", NULLSTR(*path));\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nint\nvirAuthGetConfigFilePath(virConnectPtr conn,\n                         char **path)\n{\n    return virAuthGetConfigFilePathURI(conn ? conn->uri : NULL, path);\n}"
  },
  {
    "function_name": "virAuthGetConfigFilePathURI",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virauth.c",
    "lines": "40-91",
    "snippet": "int\nvirAuthGetConfigFilePathURI(virURIPtr uri,\n                            char **path)\n{\n    size_t i;\n    const char *authenv = getenv(\"LIBVIRT_AUTH_FILE\");\n    g_autofree char *userdir = NULL;\n\n    *path = NULL;\n\n    VIR_DEBUG(\"Determining auth config file path\");\n\n    if (authenv) {\n        VIR_DEBUG(\"Using path from env '%s'\", authenv);\n        *path = g_strdup(authenv);\n        return 0;\n    }\n\n    if (uri) {\n        for (i = 0; i < uri->paramsCount; i++) {\n            if (STREQ_NULLABLE(uri->params[i].name, \"authfile\") &&\n                uri->params[i].value) {\n                VIR_DEBUG(\"Using path from URI '%s'\", uri->params[i].value);\n                *path = g_strdup(uri->params[i].value);\n                return 0;\n            }\n        }\n    }\n\n    userdir = virGetUserConfigDirectory();\n\n    *path = g_strdup_printf(\"%s/auth.conf\", userdir);\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n    *path = g_strdup(SYSCONFDIR \"/libvirt/auth.conf\");\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n done:\n    VIR_DEBUG(\"Using auth file '%s'\", NULLSTR(*path));\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virauthconfig.h\"",
      "#include \"configmake.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virauth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Using auth file '%s'\"",
            "NULLSTR(*path)"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "*path"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*path"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "*path",
            "R_OK"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Checking for readability of '%s'\"",
            "*path"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "SYSCONFDIR \"/libvirt/auth.conf\""
          ],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*path"
          ],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "*path",
            "R_OK"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Checking for readability of '%s'\"",
            "*path"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetUserConfigDirectory",
          "args": [],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "virGetUserConfigDirectory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "574-581",
          "snippet": "char *virGetUserConfigDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_config_dir());\n#else\n    return g_build_filename(g_get_user_config_dir(), \"libvirt\", NULL);\n#endif\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *virGetUserConfigDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_config_dir());\n#else\n    return g_build_filename(g_get_user_config_dir(), \"libvirt\", NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Using path from URI '%s'\"",
            "uri->params[i].value"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "uri->params[i].name",
            "\"authfile\""
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Using path from env '%s'\"",
            "authenv"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Determining auth config file path\""
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"LIBVIRT_AUTH_FILE\""
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virauthconfig.h\"\n#include \"configmake.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virauth.h\"\n#include <config.h>\n\nint\nvirAuthGetConfigFilePathURI(virURIPtr uri,\n                            char **path)\n{\n    size_t i;\n    const char *authenv = getenv(\"LIBVIRT_AUTH_FILE\");\n    g_autofree char *userdir = NULL;\n\n    *path = NULL;\n\n    VIR_DEBUG(\"Determining auth config file path\");\n\n    if (authenv) {\n        VIR_DEBUG(\"Using path from env '%s'\", authenv);\n        *path = g_strdup(authenv);\n        return 0;\n    }\n\n    if (uri) {\n        for (i = 0; i < uri->paramsCount; i++) {\n            if (STREQ_NULLABLE(uri->params[i].name, \"authfile\") &&\n                uri->params[i].value) {\n                VIR_DEBUG(\"Using path from URI '%s'\", uri->params[i].value);\n                *path = g_strdup(uri->params[i].value);\n                return 0;\n            }\n        }\n    }\n\n    userdir = virGetUserConfigDirectory();\n\n    *path = g_strdup_printf(\"%s/auth.conf\", userdir);\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n    *path = g_strdup(SYSCONFDIR \"/libvirt/auth.conf\");\n\n    VIR_DEBUG(\"Checking for readability of '%s'\", *path);\n    if (access(*path, R_OK) == 0)\n        goto done;\n\n    VIR_FREE(*path);\n\n done:\n    VIR_DEBUG(\"Using auth file '%s'\", NULLSTR(*path));\n\n    return 0;\n}"
  }
]