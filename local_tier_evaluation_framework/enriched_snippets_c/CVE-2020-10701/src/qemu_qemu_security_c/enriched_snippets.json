[
  {
    "function_name": "qemuSecurityCommandRun",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "688-714",
    "snippet": "int\nqemuSecurityCommandRun(virQEMUDriverPtr driver,\n                       virDomainObjPtr vm,\n                       virCommandPtr cmd,\n                       uid_t uid,\n                       gid_t gid,\n                       int *exitstatus,\n                       int *cmdret)\n{\n    if (virSecurityManagerSetChildProcessLabel(driver->securityManager,\n                                               vm->def, cmd) < 0)\n        return -1;\n\n    if (uid != (uid_t) -1)\n        virCommandSetUID(cmd, uid);\n    if (gid != (gid_t) -1)\n        virCommandSetGID(cmd, gid);\n\n    if (virSecurityManagerPreFork(driver->securityManager) < 0)\n        return -1;\n\n    *cmdret = virCommandRun(cmd, exitstatus);\n\n    virSecurityManagerPostFork(driver->securityManager);\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerPostFork",
          "args": [
            "driver->securityManager"
          ],
          "line": 711
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerPostFork",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "238-242",
          "snippet": "void\nvirSecurityManagerPostFork(virSecurityManagerPtr mgr)\n{\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerPostFork(virSecurityManagerPtr mgr)\n{\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "exitstatus"
          ],
          "line": 709
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerPreFork",
          "args": [
            "driver->securityManager"
          ],
          "line": 706
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerPreFork",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "218-231",
          "snippet": "int\nvirSecurityManagerPreFork(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->preFork) {\n        ret = mgr->drv->preFork(mgr);\n        if (ret < 0)\n            virObjectUnlock(mgr);\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerPreFork(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->preFork) {\n        ret = mgr->drv->preFork(mgr);\n        if (ret < 0)\n            virObjectUnlock(mgr);\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetGID",
          "args": [
            "cmd",
            "gid"
          ],
          "line": 704
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetGID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1111-1118",
          "snippet": "void\nvirCommandSetGID(virCommandPtr cmd, gid_t gid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->gid = gid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetGID(virCommandPtr cmd, gid_t gid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->gid = gid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetUID",
          "args": [
            "cmd",
            "uid"
          ],
          "line": 702
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetUID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1120-1127",
          "snippet": "void\nvirCommandSetUID(virCommandPtr cmd, uid_t uid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->uid = uid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetUID(virCommandPtr cmd, uid_t uid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->uid = uid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetChildProcessLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "cmd"
          ],
          "line": 697
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetChildProcessLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "935-945",
          "snippet": "int\nvirSecurityManagerSetChildProcessLabel(virSecurityManagerPtr mgr,\n                                       virDomainDefPtr vm,\n                                       virCommandPtr cmd)\n{\n    if (mgr->drv->domainSetSecurityChildProcessLabel)\n       return mgr->drv->domainSetSecurityChildProcessLabel(mgr, vm, cmd);\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetChildProcessLabel(virSecurityManagerPtr mgr,\n                                       virDomainDefPtr vm,\n                                       virCommandPtr cmd)\n{\n    if (mgr->drv->domainSetSecurityChildProcessLabel)\n       return mgr->drv->domainSetSecurityChildProcessLabel(mgr, vm, cmd);\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityCommandRun(virQEMUDriverPtr driver,\n                       virDomainObjPtr vm,\n                       virCommandPtr cmd,\n                       uid_t uid,\n                       gid_t gid,\n                       int *exitstatus,\n                       int *cmdret)\n{\n    if (virSecurityManagerSetChildProcessLabel(driver->securityManager,\n                                               vm->def, cmd) < 0)\n        return -1;\n\n    if (uid != (uid_t) -1)\n        virCommandSetUID(cmd, uid);\n    if (gid != (gid_t) -1)\n        virCommandSetGID(cmd, gid);\n\n    if (virSecurityManagerPreFork(driver->securityManager) < 0)\n        return -1;\n\n    *cmdret = virCommandRun(cmd, exitstatus);\n\n    virSecurityManagerPostFork(driver->securityManager);\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuSecurityRestoreSavedStateLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "641-669",
    "snippet": "int\nqemuSecurityRestoreSavedStateLabel(virQEMUDriverPtr driver,\n                                       virDomainObjPtr vm,\n                                       const char *savefile)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreSavedStateLabel(driver->securityManager,\n                                                 vm->def,\n                                                 savefile) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 667
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 661
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreSavedStateLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "savefile"
          ],
          "line": 656
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreSavedStateLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "617-632",
          "snippet": "int\nvirSecurityManagerRestoreSavedStateLabel(virSecurityManagerPtr mgr,\n                                         virDomainDefPtr vm,\n                                         const char *savefile)\n{\n    if (mgr->drv->domainRestoreSavedStateLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSavedStateLabel(mgr, vm, savefile);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreSavedStateLabel(virSecurityManagerPtr mgr,\n                                         virDomainDefPtr vm,\n                                         const char *savefile)\n{\n    if (mgr->drv->domainRestoreSavedStateLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSavedStateLabel(mgr, vm, savefile);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 653
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 650
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityRestoreSavedStateLabel(virQEMUDriverPtr driver,\n                                       virDomainObjPtr vm,\n                                       const char *savefile)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreSavedStateLabel(driver->securityManager,\n                                                 vm->def,\n                                                 savefile) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecuritySetSavedStateLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "610-638",
    "snippet": "int\nqemuSecuritySetSavedStateLabel(virQEMUDriverPtr driver,\n                                   virDomainObjPtr vm,\n                                   const char *savefile)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetSavedStateLabel(driver->securityManager,\n                                             vm->def,\n                                             savefile) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 636
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 630
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetSavedStateLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "savefile"
          ],
          "line": 625
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetSavedStateLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "600-615",
          "snippet": "int\nvirSecurityManagerSetSavedStateLabel(virSecurityManagerPtr mgr,\n                                     virDomainDefPtr vm,\n                                     const char *savefile)\n{\n    if (mgr->drv->domainSetSavedStateLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSavedStateLabel(mgr, vm, savefile);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetSavedStateLabel(virSecurityManagerPtr mgr,\n                                     virDomainDefPtr vm,\n                                     const char *savefile)\n{\n    if (mgr->drv->domainSetSavedStateLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSavedStateLabel(mgr, vm, savefile);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 622
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 619
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecuritySetSavedStateLabel(virQEMUDriverPtr driver,\n                                   virDomainObjPtr vm,\n                                   const char *savefile)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetSavedStateLabel(driver->securityManager,\n                                             vm->def,\n                                             savefile) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecurityDomainSetPathLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "577-607",
    "snippet": "int\nqemuSecurityDomainSetPathLabel(virQEMUDriverPtr driver,\n                               virDomainObjPtr vm,\n                               const char *path,\n                               bool allowSubtree)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerDomainSetPathLabel(driver->securityManager,\n                                             vm->def,\n                                             path,\n                                             allowSubtree) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 605
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 599
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerDomainSetPathLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "path",
            "allowSubtree"
          ],
          "line": 593
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerDomainSetPathLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1062-1077",
          "snippet": "int\nvirSecurityManagerDomainSetPathLabel(virSecurityManagerPtr mgr,\n                                     virDomainDefPtr vm,\n                                     const char *path,\n                                     bool allowSubtree)\n{\n    if (mgr->drv->domainSetPathLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetPathLabel(mgr, vm, path, allowSubtree);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerDomainSetPathLabel(virSecurityManagerPtr mgr,\n                                     virDomainDefPtr vm,\n                                     const char *path,\n                                     bool allowSubtree)\n{\n    if (mgr->drv->domainSetPathLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetPathLabel(mgr, vm, path, allowSubtree);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 590
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 587
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityDomainSetPathLabel(virQEMUDriverPtr driver,\n                               virDomainObjPtr vm,\n                               const char *path,\n                               bool allowSubtree)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerDomainSetPathLabel(driver->securityManager,\n                                             vm->def,\n                                             path,\n                                             allowSubtree) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecurityCleanupTPMEmulator",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "556-574",
    "snippet": "void\nqemuSecurityCleanupTPMEmulator(virQEMUDriverPtr driver,\n                               virDomainObjPtr vm)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    bool transactionStarted = false;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreTPMLabels(driver->securityManager, vm->def);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n    virSecurityManagerTransactionAbort(driver->securityManager);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 573
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Unable to run security manager transaction\""
          ],
          "line": 571
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "-1",
            "priv->rememberOwner"
          ],
          "line": 569
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreTPMLabels",
          "args": [
            "driver->securityManager",
            "vm->def"
          ],
          "line": 566
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreTPMLabels",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1230-1245",
          "snippet": "int\nvirSecurityManagerRestoreTPMLabels(virSecurityManagerPtr mgr,\n                                   virDomainDefPtr vm)\n{\n    int ret;\n\n    if (mgr->drv->domainRestoreSecurityTPMLabels) {\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityTPMLabels(mgr, vm);\n        virObjectUnlock(mgr);\n\n        return ret;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreTPMLabels(virSecurityManagerPtr mgr,\n                                   virDomainDefPtr vm)\n{\n    int ret;\n\n    if (mgr->drv->domainRestoreSecurityTPMLabels) {\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityTPMLabels(mgr, vm);\n        virObjectUnlock(mgr);\n\n        return ret;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 563
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nvoid\nqemuSecurityCleanupTPMEmulator(virQEMUDriverPtr driver,\n                               virDomainObjPtr vm)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    bool transactionStarted = false;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreTPMLabels(driver->securityManager, vm->def);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n    virSecurityManagerTransactionAbort(driver->securityManager);\n}"
  },
  {
    "function_name": "qemuSecurityStartTPMEmulator",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "500-553",
    "snippet": "int\nqemuSecurityStartTPMEmulator(virQEMUDriverPtr driver,\n                             virDomainObjPtr vm,\n                             virCommandPtr cmd,\n                             uid_t uid,\n                             gid_t gid,\n                             int *exitstatus,\n                             int *cmdret)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    int ret = -1;\n    bool transactionStarted = false;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        return -1;\n    transactionStarted = true;\n\n    if (virSecurityManagerSetTPMLabels(driver->securityManager,\n                                       vm->def) < 0) {\n        virSecurityManagerTransactionAbort(driver->securityManager);\n        return -1;\n    }\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        goto cleanup_abort;\n    transactionStarted = false;\n\n    if (qemuSecurityCommandRun(driver, vm, cmd, uid, gid, exitstatus, cmdret) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n    if (*cmdret < 0)\n        goto cleanup;\n\n    return 0;\n\n cleanup:\n    if (!transactionStarted &&\n        virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreTPMLabels(driver->securityManager, vm->def);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n cleanup_abort:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 551
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Unable to run security manager transaction\""
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "-1",
            "priv->rememberOwner"
          ],
          "line": 546
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreTPMLabels",
          "args": [
            "driver->securityManager",
            "vm->def"
          ],
          "line": 543
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreTPMLabels",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1230-1245",
          "snippet": "int\nvirSecurityManagerRestoreTPMLabels(virSecurityManagerPtr mgr,\n                                   virDomainDefPtr vm)\n{\n    int ret;\n\n    if (mgr->drv->domainRestoreSecurityTPMLabels) {\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityTPMLabels(mgr, vm);\n        virObjectUnlock(mgr);\n\n        return ret;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreTPMLabels(virSecurityManagerPtr mgr,\n                                   virDomainDefPtr vm)\n{\n    int ret;\n\n    if (mgr->drv->domainRestoreSecurityTPMLabels) {\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityTPMLabels(mgr, vm);\n        virObjectUnlock(mgr);\n\n        return ret;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuSecurityCommandRun",
          "args": [
            "driver",
            "vm",
            "cmd",
            "uid",
            "gid",
            "exitstatus",
            "cmdret"
          ],
          "line": 528
        },
        "resolved": true,
        "details": {
          "function_name": "qemuSecurityCommandRun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
          "lines": "688-714",
          "snippet": "int\nqemuSecurityCommandRun(virQEMUDriverPtr driver,\n                       virDomainObjPtr vm,\n                       virCommandPtr cmd,\n                       uid_t uid,\n                       gid_t gid,\n                       int *exitstatus,\n                       int *cmdret)\n{\n    if (virSecurityManagerSetChildProcessLabel(driver->securityManager,\n                                               vm->def, cmd) < 0)\n        return -1;\n\n    if (uid != (uid_t) -1)\n        virCommandSetUID(cmd, uid);\n    if (gid != (gid_t) -1)\n        virCommandSetGID(cmd, gid);\n\n    if (virSecurityManagerPreFork(driver->securityManager) < 0)\n        return -1;\n\n    *cmdret = virCommandRun(cmd, exitstatus);\n\n    virSecurityManagerPostFork(driver->securityManager);\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityCommandRun(virQEMUDriverPtr driver,\n                       virDomainObjPtr vm,\n                       virCommandPtr cmd,\n                       uid_t uid,\n                       gid_t gid,\n                       int *exitstatus,\n                       int *cmdret)\n{\n    if (virSecurityManagerSetChildProcessLabel(driver->securityManager,\n                                               vm->def, cmd) < 0)\n        return -1;\n\n    if (uid != (uid_t) -1)\n        virCommandSetUID(cmd, uid);\n    if (gid != (gid_t) -1)\n        virCommandSetGID(cmd, gid);\n\n    if (virSecurityManagerPreFork(driver->securityManager) < 0)\n        return -1;\n\n    *cmdret = virCommandRun(cmd, exitstatus);\n\n    virSecurityManagerPostFork(driver->securityManager);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetTPMLabels",
          "args": [
            "driver->securityManager",
            "vm->def"
          ],
          "line": 517
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetTPMLabels",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1212-1227",
          "snippet": "int\nvirSecurityManagerSetTPMLabels(virSecurityManagerPtr mgr,\n                               virDomainDefPtr vm)\n{\n    int ret;\n\n    if (mgr->drv->domainSetSecurityTPMLabels) {\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityTPMLabels(mgr, vm);\n        virObjectUnlock(mgr);\n\n        return ret;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetTPMLabels(virSecurityManagerPtr mgr,\n                               virDomainDefPtr vm)\n{\n    int ret;\n\n    if (mgr->drv->domainSetSecurityTPMLabels) {\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityTPMLabels(mgr, vm);\n        virObjectUnlock(mgr);\n\n        return ret;\n    }\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityStartTPMEmulator(virQEMUDriverPtr driver,\n                             virDomainObjPtr vm,\n                             virCommandPtr cmd,\n                             uid_t uid,\n                             gid_t gid,\n                             int *exitstatus,\n                             int *cmdret)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    int ret = -1;\n    bool transactionStarted = false;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        return -1;\n    transactionStarted = true;\n\n    if (virSecurityManagerSetTPMLabels(driver->securityManager,\n                                       vm->def) < 0) {\n        virSecurityManagerTransactionAbort(driver->securityManager);\n        return -1;\n    }\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        goto cleanup_abort;\n    transactionStarted = false;\n\n    if (qemuSecurityCommandRun(driver, vm, cmd, uid, gid, exitstatus, cmdret) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n    if (*cmdret < 0)\n        goto cleanup;\n\n    return 0;\n\n cleanup:\n    if (!transactionStarted &&\n        virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreTPMLabels(driver->securityManager, vm->def);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n cleanup_abort:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecurityStartVhostUserGPU",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "457-479",
    "snippet": "int\nqemuSecurityStartVhostUserGPU(virQEMUDriverPtr driver,\n                              virDomainObjPtr vm,\n                              virCommandPtr cmd,\n                              int *exitstatus,\n                              int *cmdret)\n{\n    if (virSecurityManagerSetChildProcessLabel(driver->securityManager,\n                                               vm->def, cmd) < 0)\n        return -1;\n\n    if (virSecurityManagerPreFork(driver->securityManager) < 0)\n        return -1;\n\n    *cmdret = virCommandRun(cmd, exitstatus);\n\n    virSecurityManagerPostFork(driver->securityManager);\n\n    if (*cmdret < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerPostFork",
          "args": [
            "driver->securityManager"
          ],
          "line": 473
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerPostFork",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "238-242",
          "snippet": "void\nvirSecurityManagerPostFork(virSecurityManagerPtr mgr)\n{\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerPostFork(virSecurityManagerPtr mgr)\n{\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "exitstatus"
          ],
          "line": 471
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerPreFork",
          "args": [
            "driver->securityManager"
          ],
          "line": 468
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerPreFork",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "218-231",
          "snippet": "int\nvirSecurityManagerPreFork(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->preFork) {\n        ret = mgr->drv->preFork(mgr);\n        if (ret < 0)\n            virObjectUnlock(mgr);\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerPreFork(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->preFork) {\n        ret = mgr->drv->preFork(mgr);\n        if (ret < 0)\n            virObjectUnlock(mgr);\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetChildProcessLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "cmd"
          ],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetChildProcessLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "935-945",
          "snippet": "int\nvirSecurityManagerSetChildProcessLabel(virSecurityManagerPtr mgr,\n                                       virDomainDefPtr vm,\n                                       virCommandPtr cmd)\n{\n    if (mgr->drv->domainSetSecurityChildProcessLabel)\n       return mgr->drv->domainSetSecurityChildProcessLabel(mgr, vm, cmd);\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetChildProcessLabel(virSecurityManagerPtr mgr,\n                                       virDomainDefPtr vm,\n                                       virCommandPtr cmd)\n{\n    if (mgr->drv->domainSetSecurityChildProcessLabel)\n       return mgr->drv->domainSetSecurityChildProcessLabel(mgr, vm, cmd);\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityStartVhostUserGPU(virQEMUDriverPtr driver,\n                              virDomainObjPtr vm,\n                              virCommandPtr cmd,\n                              int *exitstatus,\n                              int *cmdret)\n{\n    if (virSecurityManagerSetChildProcessLabel(driver->securityManager,\n                                               vm->def, cmd) < 0)\n        return -1;\n\n    if (virSecurityManagerPreFork(driver->securityManager) < 0)\n        return -1;\n\n    *cmdret = virCommandRun(cmd, exitstatus);\n\n    virSecurityManagerPostFork(driver->securityManager);\n\n    if (*cmdret < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuSecurityRestoreChardevLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "410-439",
    "snippet": "int\nqemuSecurityRestoreChardevLabel(virQEMUDriverPtr driver,\n                                virDomainObjPtr vm,\n                                virDomainChrDefPtr chr)\n{\n    int ret = -1;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreChardevLabel(driver->securityManager,\n                                              vm->def,\n                                              chr->source,\n                                              priv->chardevStdioLogd) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 437
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreChardevLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "chr->source",
            "priv->chardevStdioLogd"
          ],
          "line": 425
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreChardevLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1192-1209",
          "snippet": "int\nvirSecurityManagerRestoreChardevLabel(virSecurityManagerPtr mgr,\n                                      virDomainDefPtr def,\n                                      virDomainChrSourceDefPtr dev_source,\n                                      bool chardevStdioLogd)\n{\n    if (mgr->drv->domainRestoreSecurityChardevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityChardevLabel(mgr, def, dev_source,\n                                                          chardevStdioLogd);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreChardevLabel(virSecurityManagerPtr mgr,\n                                      virDomainDefPtr def,\n                                      virDomainChrSourceDefPtr dev_source,\n                                      bool chardevStdioLogd)\n{\n    if (mgr->drv->domainRestoreSecurityChardevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityChardevLabel(mgr, def, dev_source,\n                                                          chardevStdioLogd);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 422
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 419
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityRestoreChardevLabel(virQEMUDriverPtr driver,\n                                virDomainObjPtr vm,\n                                virDomainChrDefPtr chr)\n{\n    int ret = -1;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreChardevLabel(driver->securityManager,\n                                              vm->def,\n                                              chr->source,\n                                              priv->chardevStdioLogd) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecuritySetChardevLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "378-407",
    "snippet": "int\nqemuSecuritySetChardevLabel(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            virDomainChrDefPtr chr)\n{\n    int ret = -1;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetChardevLabel(driver->securityManager,\n                                          vm->def,\n                                          chr->source,\n                                          priv->chardevStdioLogd) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 405
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 399
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetChardevLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "chr->source",
            "priv->chardevStdioLogd"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetChardevLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1172-1189",
          "snippet": "int\nvirSecurityManagerSetChardevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr def,\n                                  virDomainChrSourceDefPtr dev_source,\n                                  bool chardevStdioLogd)\n{\n    if (mgr->drv->domainSetSecurityChardevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityChardevLabel(mgr, def, dev_source,\n                                                      chardevStdioLogd);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetChardevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr def,\n                                  virDomainChrSourceDefPtr dev_source,\n                                  bool chardevStdioLogd)\n{\n    if (mgr->drv->domainSetSecurityChardevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityChardevLabel(mgr, def, dev_source,\n                                                      chardevStdioLogd);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 390
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecuritySetChardevLabel(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            virDomainChrDefPtr chr)\n{\n    int ret = -1;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetChardevLabel(driver->securityManager,\n                                          vm->def,\n                                          chr->source,\n                                          priv->chardevStdioLogd) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecurityRestoreInputLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "347-375",
    "snippet": "int\nqemuSecurityRestoreInputLabel(virDomainObjPtr vm,\n                              virDomainInputDefPtr input)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreInputLabel(driver->securityManager,\n                                            vm->def,\n                                            input) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 373
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 367
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreInputLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "input"
          ],
          "line": 362
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreInputLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1154-1169",
          "snippet": "int\nvirSecurityManagerRestoreInputLabel(virSecurityManagerPtr mgr,\n                                    virDomainDefPtr vm,\n                                    virDomainInputDefPtr input)\n{\n    if (mgr->drv->domainRestoreSecurityInputLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityInputLabel(mgr, vm, input);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreInputLabel(virSecurityManagerPtr mgr,\n                                    virDomainDefPtr vm,\n                                    virDomainInputDefPtr input)\n{\n    if (mgr->drv->domainRestoreSecurityInputLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityInputLabel(mgr, vm, input);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 356
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityRestoreInputLabel(virDomainObjPtr vm,\n                              virDomainInputDefPtr input)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreInputLabel(driver->securityManager,\n                                            vm->def,\n                                            input) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecuritySetInputLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "316-344",
    "snippet": "int\nqemuSecuritySetInputLabel(virDomainObjPtr vm,\n                          virDomainInputDefPtr input)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetInputLabel(driver->securityManager,\n                                        vm->def,\n                                        input) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 336
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetInputLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "input"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetInputLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1136-1151",
          "snippet": "int\nvirSecurityManagerSetInputLabel(virSecurityManagerPtr mgr,\n                                virDomainDefPtr vm,\n                                virDomainInputDefPtr input)\n{\n    if (mgr->drv->domainSetSecurityInputLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityInputLabel(mgr, vm, input);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetInputLabel(virSecurityManagerPtr mgr,\n                                virDomainDefPtr vm,\n                                virDomainInputDefPtr input)\n{\n    if (mgr->drv->domainSetSecurityInputLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityInputLabel(mgr, vm, input);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecuritySetInputLabel(virDomainObjPtr vm,\n                          virDomainInputDefPtr input)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetInputLabel(driver->securityManager,\n                                        vm->def,\n                                        input) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecurityRestoreMemoryLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "285-313",
    "snippet": "int\nqemuSecurityRestoreMemoryLabel(virQEMUDriverPtr driver,\n                               virDomainObjPtr vm,\n                               virDomainMemoryDefPtr mem)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreMemoryLabel(driver->securityManager,\n                                             vm->def,\n                                             mem) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreMemoryLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "mem"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreMemoryLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1118-1133",
          "snippet": "int\nvirSecurityManagerRestoreMemoryLabel(virSecurityManagerPtr mgr,\n                                        virDomainDefPtr vm,\n                                        virDomainMemoryDefPtr mem)\n{\n    if (mgr->drv->domainRestoreSecurityMemoryLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityMemoryLabel(mgr, vm, mem);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreMemoryLabel(virSecurityManagerPtr mgr,\n                                        virDomainDefPtr vm,\n                                        virDomainMemoryDefPtr mem)\n{\n    if (mgr->drv->domainRestoreSecurityMemoryLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityMemoryLabel(mgr, vm, mem);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityRestoreMemoryLabel(virQEMUDriverPtr driver,\n                               virDomainObjPtr vm,\n                               virDomainMemoryDefPtr mem)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreMemoryLabel(driver->securityManager,\n                                             vm->def,\n                                             mem) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecuritySetMemoryLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "254-282",
    "snippet": "int\nqemuSecuritySetMemoryLabel(virQEMUDriverPtr driver,\n                           virDomainObjPtr vm,\n                           virDomainMemoryDefPtr mem)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetMemoryLabel(driver->securityManager,\n                                         vm->def,\n                                         mem) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 280
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 274
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetMemoryLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "mem"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetMemoryLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1090-1105",
          "snippet": "int\nvirSecurityManagerSetMemoryLabel(virSecurityManagerPtr mgr,\n                                     virDomainDefPtr vm,\n                                     virDomainMemoryDefPtr mem)\n{\n    if (mgr->drv->domainSetSecurityMemoryLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityMemoryLabel(mgr, vm, mem);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetMemoryLabel(virSecurityManagerPtr mgr,\n                                     virDomainDefPtr vm,\n                                     virDomainMemoryDefPtr mem)\n{\n    if (mgr->drv->domainSetSecurityMemoryLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityMemoryLabel(mgr, vm, mem);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 263
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecuritySetMemoryLabel(virQEMUDriverPtr driver,\n                           virDomainObjPtr vm,\n                           virDomainMemoryDefPtr mem)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetMemoryLabel(driver->securityManager,\n                                         vm->def,\n                                         mem) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecurityRestoreHostdevLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "222-251",
    "snippet": "int\nqemuSecurityRestoreHostdevLabel(virQEMUDriverPtr driver,\n                                virDomainObjPtr vm,\n                                virDomainHostdevDefPtr hostdev)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreHostdevLabel(driver->securityManager,\n                                              vm->def,\n                                              hostdev,\n                                              NULL) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 243
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreHostdevLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "hostdev",
            "NULL"
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreHostdevLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "562-578",
          "snippet": "int\nvirSecurityManagerRestoreHostdevLabel(virSecurityManagerPtr mgr,\n                                      virDomainDefPtr vm,\n                                      virDomainHostdevDefPtr dev,\n                                      const char *vroot)\n{\n    if (mgr->drv->domainRestoreSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreHostdevLabel(virSecurityManagerPtr mgr,\n                                      virDomainDefPtr vm,\n                                      virDomainHostdevDefPtr dev,\n                                      const char *vroot)\n{\n    if (mgr->drv->domainRestoreSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 234
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityRestoreHostdevLabel(virQEMUDriverPtr driver,\n                                virDomainObjPtr vm,\n                                virDomainHostdevDefPtr hostdev)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreHostdevLabel(driver->securityManager,\n                                              vm->def,\n                                              hostdev,\n                                              NULL) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecuritySetHostdevLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "190-219",
    "snippet": "int\nqemuSecuritySetHostdevLabel(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            virDomainHostdevDefPtr hostdev)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetHostdevLabel(driver->securityManager,\n                                          vm->def,\n                                          hostdev,\n                                          NULL) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetHostdevLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "hostdev",
            "NULL"
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetHostdevLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "581-597",
          "snippet": "int\nvirSecurityManagerSetHostdevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  virDomainHostdevDefPtr dev,\n                                  const char *vroot)\n{\n    if (mgr->drv->domainSetSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetHostdevLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  virDomainHostdevDefPtr dev,\n                                  const char *vroot)\n{\n    if (mgr->drv->domainSetSecurityHostdevLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityHostdevLabel(mgr, vm, dev, vroot);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecuritySetHostdevLabel(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            virDomainHostdevDefPtr hostdev)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetHostdevLabel(driver->securityManager,\n                                          vm->def,\n                                          hostdev,\n                                          NULL) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecurityMoveImageMetadata",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "171-187",
    "snippet": "int\nqemuSecurityMoveImageMetadata(virQEMUDriverPtr driver,\n                              virDomainObjPtr vm,\n                              virStorageSourcePtr src,\n                              virStorageSourcePtr dst)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n\n    if (!priv->rememberOwner)\n        return 0;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    return virSecurityManagerMoveImageMetadata(driver->securityManager, pid, src, dst);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerMoveImageMetadata",
          "args": [
            "driver->securityManager",
            "pid",
            "src",
            "dst"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerMoveImageMetadata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "462-478",
          "snippet": "int\nvirSecurityManagerMoveImageMetadata(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    virStorageSourcePtr src,\n                                    virStorageSourcePtr dst)\n{\n    if (mgr->drv->domainMoveImageMetadata) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainMoveImageMetadata(mgr, pid, src, dst);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerMoveImageMetadata(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    virStorageSourcePtr src,\n                                    virStorageSourcePtr dst)\n{\n    if (mgr->drv->domainMoveImageMetadata) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainMoveImageMetadata(mgr, pid, src, dst);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityMoveImageMetadata(virQEMUDriverPtr driver,\n                              virDomainObjPtr vm,\n                              virStorageSourcePtr src,\n                              virStorageSourcePtr dst)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n\n    if (!priv->rememberOwner)\n        return 0;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    return virSecurityManagerMoveImageMetadata(driver->securityManager, pid, src, dst);\n}"
  },
  {
    "function_name": "qemuSecurityRestoreImageLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "136-168",
    "snippet": "int\nqemuSecurityRestoreImageLabel(virQEMUDriverPtr driver,\n                              virDomainObjPtr vm,\n                              virStorageSourcePtr src,\n                              bool backingChain)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n    virSecurityDomainImageLabelFlags labelFlags = 0;\n\n    if (backingChain)\n        labelFlags |= VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreImageLabel(driver->securityManager,\n                                            vm->def, src, labelFlags) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreImageLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "src",
            "labelFlags"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreImageLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "423-439",
          "snippet": "int\nvirSecurityManagerRestoreImageLabel(virSecurityManagerPtr mgr,\n                                   virDomainDefPtr vm,\n                                   virStorageSourcePtr src,\n                                   virSecurityDomainImageLabelFlags flags)\n{\n    if (mgr->drv->domainRestoreSecurityImageLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityImageLabel(mgr, vm, src, flags);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreImageLabel(virSecurityManagerPtr mgr,\n                                   virDomainDefPtr vm,\n                                   virStorageSourcePtr src,\n                                   virSecurityDomainImageLabelFlags flags)\n{\n    if (mgr->drv->domainRestoreSecurityImageLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityImageLabel(mgr, vm, src, flags);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityRestoreImageLabel(virQEMUDriverPtr driver,\n                              virDomainObjPtr vm,\n                              virStorageSourcePtr src,\n                              bool backingChain)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n    virSecurityDomainImageLabelFlags labelFlags = 0;\n\n    if (backingChain)\n        labelFlags |= VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerRestoreImageLabel(driver->securityManager,\n                                            vm->def, src, labelFlags) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecuritySetImageLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "97-133",
    "snippet": "int\nqemuSecuritySetImageLabel(virQEMUDriverPtr driver,\n                          virDomainObjPtr vm,\n                          virStorageSourcePtr src,\n                          bool backingChain,\n                          bool chainTop)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n    virSecurityDomainImageLabelFlags labelFlags = 0;\n\n    if (backingChain)\n        labelFlags |= VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN;\n\n    if (chainTop)\n        labelFlags |= VIR_SECURITY_DOMAIN_IMAGE_PARENT_CHAIN_TOP;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetImageLabel(driver->securityManager,\n                                        vm->def, src, labelFlags) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetImageLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "src",
            "labelFlags"
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetImageLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "543-559",
          "snippet": "int\nvirSecurityManagerSetImageLabel(virSecurityManagerPtr mgr,\n                                virDomainDefPtr vm,\n                                virStorageSourcePtr src,\n                                virSecurityDomainImageLabelFlags flags)\n{\n    if (mgr->drv->domainSetSecurityImageLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityImageLabel(mgr, vm, src, flags);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetImageLabel(virSecurityManagerPtr mgr,\n                                virDomainDefPtr vm,\n                                virStorageSourcePtr src,\n                                virSecurityDomainImageLabelFlags flags)\n{\n    if (mgr->drv->domainSetSecurityImageLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityImageLabel(mgr, vm, src, flags);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 115
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecuritySetImageLabel(virQEMUDriverPtr driver,\n                          virDomainObjPtr vm,\n                          virStorageSourcePtr src,\n                          bool backingChain,\n                          bool chainTop)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n    int ret = -1;\n    virSecurityDomainImageLabelFlags labelFlags = 0;\n\n    if (backingChain)\n        labelFlags |= VIR_SECURITY_DOMAIN_IMAGE_LABEL_BACKING_CHAIN;\n\n    if (chainTop)\n        labelFlags |= VIR_SECURITY_DOMAIN_IMAGE_PARENT_CHAIN_TOP;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetImageLabel(driver->securityManager,\n                                        vm->def, src, labelFlags) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  },
  {
    "function_name": "qemuSecurityRestoreAllLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "66-94",
    "snippet": "void\nqemuSecurityRestoreAllLabel(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            bool migrated)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    bool transactionStarted = false;\n\n    /* In contrast to qemuSecuritySetAllLabel, do not use vm->pid\n     * here. This function is called from qemuProcessStop() which\n     * is meant to do cleanup after qemu process died. The\n     * domain's namespace is gone as qemu was the only process\n     * running there. We would not succeed in entering the\n     * namespace then. */\n    if (virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreAllLabel(driver->securityManager,\n                                      vm->def,\n                                      migrated,\n                                      priv->chardevStdioLogd);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n    virSecurityManagerTransactionAbort(driver->securityManager);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Unable to run security manager transaction\""
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "-1",
            "priv->rememberOwner"
          ],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerRestoreAllLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "migrated",
            "priv->chardevStdioLogd"
          ],
          "line": 83
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerRestoreAllLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "880-897",
          "snippet": "int\nvirSecurityManagerRestoreAllLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  bool migrated,\n                                  bool chardevStdioLogd)\n{\n    if (mgr->drv->domainRestoreSecurityAllLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityAllLabel(mgr, vm, migrated,\n                                                      chardevStdioLogd);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerRestoreAllLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm,\n                                  bool migrated,\n                                  bool chardevStdioLogd)\n{\n    if (mgr->drv->domainRestoreSecurityAllLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainRestoreSecurityAllLabel(mgr, vm, migrated,\n                                                      chardevStdioLogd);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nvoid\nqemuSecurityRestoreAllLabel(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            bool migrated)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    bool transactionStarted = false;\n\n    /* In contrast to qemuSecuritySetAllLabel, do not use vm->pid\n     * here. This function is called from qemuProcessStop() which\n     * is meant to do cleanup after qemu process died. The\n     * domain's namespace is gone as qemu was the only process\n     * running there. We would not succeed in entering the\n     * namespace then. */\n    if (virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreAllLabel(driver->securityManager,\n                                      vm->def,\n                                      migrated,\n                                      priv->chardevStdioLogd);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n    virSecurityManagerTransactionAbort(driver->securityManager);\n}"
  },
  {
    "function_name": "qemuSecuritySetAllLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
    "lines": "32-63",
    "snippet": "int\nqemuSecuritySetAllLabel(virQEMUDriverPtr driver,\n                        virDomainObjPtr vm,\n                        const char *stdin_path,\n                        bool migrated)\n{\n    int ret = -1;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetAllLabel(driver->securityManager,\n                                      vm->def,\n                                      stdin_path,\n                                      priv->chardevStdioLogd,\n                                      migrated) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionAbort",
          "args": [
            "driver->securityManager"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "311-318",
          "snippet": "void\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirSecurityManagerTransactionAbort(virSecurityManagerPtr mgr)\n{\n    virObjectLock(mgr);\n    if (mgr->drv->transactionAbort)\n        mgr->drv->transactionAbort(mgr);\n    virObjectUnlock(mgr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionCommit",
          "args": [
            "driver->securityManager",
            "pid",
            "priv->rememberOwner"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "290-302",
          "snippet": "int\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionCommit(virSecurityManagerPtr mgr,\n                                    pid_t pid,\n                                    bool lock)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionCommit)\n        ret = mgr->drv->transactionCommit(mgr, pid, lock);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetAllLabel",
          "args": [
            "driver->securityManager",
            "vm->def",
            "stdin_path",
            "priv->chardevStdioLogd",
            "migrated"
          ],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetAllLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "858-877",
          "snippet": "int\nvirSecurityManagerSetAllLabel(virSecurityManagerPtr mgr,\n                              virDomainDefPtr vm,\n                              const char *stdin_path,\n                              bool chardevStdioLogd,\n                              bool migrated)\n{\n    if (mgr->drv->domainSetSecurityAllLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityAllLabel(mgr, vm, stdin_path,\n                                                  chardevStdioLogd,\n                                                  migrated);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetAllLabel(virSecurityManagerPtr mgr,\n                              virDomainDefPtr vm,\n                              const char *stdin_path,\n                              bool chardevStdioLogd,\n                              bool migrated)\n{\n    if (mgr->drv->domainSetSecurityAllLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityAllLabel(mgr, vm, stdin_path,\n                                                  chardevStdioLogd,\n                                                  migrated);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerTransactionStart",
          "args": [
            "driver->securityManager"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerTransactionStart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "255-265",
          "snippet": "int\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerTransactionStart(virSecurityManagerPtr mgr)\n{\n    int ret = 0;\n\n    virObjectLock(mgr);\n    if (mgr->drv->transactionStart)\n        ret = mgr->drv->transactionStart(mgr);\n    virObjectUnlock(mgr);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainNamespaceEnabled",
          "args": [
            "vm",
            "QEMU_DOMAIN_NS_MOUNT"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainNamespaceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "259-267",
          "snippet": "bool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nbool\nqemuDomainNamespaceEnabled(virDomainObjPtr vm,\n                           qemuDomainNamespace ns)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    return priv->namespaces &&\n        virBitmapIsBitSet(priv->namespaces, ns);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecuritySetAllLabel(virQEMUDriverPtr driver,\n                        virDomainObjPtr vm,\n                        const char *stdin_path,\n                        bool migrated)\n{\n    int ret = -1;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    pid_t pid = -1;\n\n    if (qemuDomainNamespaceEnabled(vm, QEMU_DOMAIN_NS_MOUNT))\n        pid = vm->pid;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerSetAllLabel(driver->securityManager,\n                                      vm->def,\n                                      stdin_path,\n                                      priv->chardevStdioLogd,\n                                      migrated) < 0)\n        goto cleanup;\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            pid, priv->rememberOwner) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
  }
]