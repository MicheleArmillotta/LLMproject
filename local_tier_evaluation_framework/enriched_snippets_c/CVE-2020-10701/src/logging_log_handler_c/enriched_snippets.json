[
  {
    "function_name": "virLogHandlerPreExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "610-665",
    "snippet": "virJSONValuePtr\nvirLogHandlerPreExecRestart(virLogHandlerPtr handler)\n{\n    virJSONValuePtr ret = virJSONValueNewObject();\n    virJSONValuePtr files;\n    size_t i;\n    char domuuid[VIR_UUID_STRING_BUFLEN];\n\n    files = virJSONValueNewArray();\n\n    if (virJSONValueObjectAppend(ret, \"files\", files) < 0) {\n        virJSONValueFree(files);\n        goto error;\n    }\n\n    for (i = 0; i < handler->nfiles; i++) {\n        virJSONValuePtr file = virJSONValueNewObject();\n\n        if (virJSONValueArrayAppend(files, file) < 0) {\n            virJSONValueFree(file);\n            goto error;\n        }\n\n        if (virJSONValueObjectAppendNumberInt(file, \"pipefd\",\n                                              handler->files[i]->pipefd) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"path\",\n                                           virRotatingFileWriterGetPath(handler->files[i]->file)) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"driver\",\n                                           handler->files[i]->driver) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"domname\",\n                                           handler->files[i]->domname) < 0)\n            goto error;\n\n        virUUIDFormat(handler->files[i]->domuuid, domuuid);\n        if (virJSONValueObjectAppendString(file, \"domuuid\", domuuid) < 0)\n            goto error;\n\n        if (virSetInherit(handler->files[i]->pipefd, true) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Cannot disable close-on-exec flag\"));\n            goto error;\n        }\n    }\n\n    return ret;\n\n error:\n    virJSONValueFree(ret);\n    return NULL;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "ret"
          ],
          "line": 663
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Cannot disable close-on-exec flag\")"
          ],
          "line": 654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot disable close-on-exec flag\""
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetInherit",
          "args": [
            "handler->files[i]->pipefd",
            "true"
          ],
          "line": 653
        },
        "resolved": true,
        "details": {
          "function_name": "virSetInherit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "104-111",
          "snippet": "int virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendString",
          "args": [
            "file",
            "\"domuuid\"",
            "domuuid"
          ],
          "line": 650
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "643-649",
          "snippet": "int\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "handler->files[i]->domuuid",
            "domuuid"
          ],
          "line": 649
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterGetPath",
          "args": [
            "handler->files[i]->file"
          ],
          "line": 638
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterGetPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "332-336",
          "snippet": "const char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendNumberInt",
          "args": [
            "file",
            "\"pipefd\"",
            "handler->files[i]->pipefd"
          ],
          "line": 633
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "661-674",
          "snippet": "int\nvirJSONValueObjectAppendNumberInt(virJSONValuePtr object,\n                                  const char *key,\n                                  int number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberInt(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendNumberInt(virJSONValuePtr object,\n                                  const char *key,\n                                  int number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberInt(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayAppend",
          "args": [
            "files",
            "file"
          ],
          "line": 628
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "792-804",
          "snippet": "int\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewObject",
          "args": [],
          "line": 626
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "571-579",
          "snippet": "virJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppend",
          "args": [
            "ret",
            "\"files\"",
            "files"
          ],
          "line": 620
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendBoolean",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "741-754",
          "snippet": "int\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewArray",
          "args": [],
          "line": 618
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "560-568",
          "snippet": "virJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirLogHandlerPreExecRestart(virLogHandlerPtr handler)\n{\n    virJSONValuePtr ret = virJSONValueNewObject();\n    virJSONValuePtr files;\n    size_t i;\n    char domuuid[VIR_UUID_STRING_BUFLEN];\n\n    files = virJSONValueNewArray();\n\n    if (virJSONValueObjectAppend(ret, \"files\", files) < 0) {\n        virJSONValueFree(files);\n        goto error;\n    }\n\n    for (i = 0; i < handler->nfiles; i++) {\n        virJSONValuePtr file = virJSONValueNewObject();\n\n        if (virJSONValueArrayAppend(files, file) < 0) {\n            virJSONValueFree(file);\n            goto error;\n        }\n\n        if (virJSONValueObjectAppendNumberInt(file, \"pipefd\",\n                                              handler->files[i]->pipefd) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"path\",\n                                           virRotatingFileWriterGetPath(handler->files[i]->file)) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"driver\",\n                                           handler->files[i]->driver) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"domname\",\n                                           handler->files[i]->domname) < 0)\n            goto error;\n\n        virUUIDFormat(handler->files[i]->domuuid, domuuid);\n        if (virJSONValueObjectAppendString(file, \"domuuid\", domuuid) < 0)\n            goto error;\n\n        if (virSetInherit(handler->files[i]->pipefd, true) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Cannot disable close-on-exec flag\"));\n            goto error;\n        }\n    }\n\n    return ret;\n\n error:\n    virJSONValueFree(ret);\n    return NULL;\n}"
  },
  {
    "function_name": "virLogHandlerDomainAppendLogFile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "560-607",
    "snippet": "int\nvirLogHandlerDomainAppendLogFile(virLogHandlerPtr handler,\n                                 const char *driver G_GNUC_UNUSED,\n                                 const unsigned char *domuuid G_GNUC_UNUSED,\n                                 const char *domname G_GNUC_UNUSED,\n                                 const char *path,\n                                 const char *message,\n                                 unsigned int flags)\n{\n    size_t i;\n    virRotatingFileWriterPtr writer = NULL;\n    virRotatingFileWriterPtr newwriter = NULL;\n    int ret = -1;\n\n    virCheckFlags(0, -1);\n\n    VIR_DEBUG(\"Appending to log '%s' message: '%s'\", path, message);\n\n    virObjectLock(handler);\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (STREQ(virRotatingFileWriterGetPath(handler->files[i]->file), path)) {\n            writer = handler->files[i]->file;\n            break;\n        }\n    }\n\n    if (!writer) {\n        if (!(newwriter = virRotatingFileWriterNew(path,\n                                                   handler->max_size,\n                                                   handler->max_backups,\n                                                   false,\n                                                   DEFAULT_MODE)))\n            goto cleanup;\n\n        writer = newwriter;\n    }\n\n    if (virRotatingFileWriterAppend(writer, message, strlen(message)) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virRotatingFileWriterFree(newwriter);\n    virObjectUnlock(handler);\n    return ret;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DEFAULT_MODE 0600"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "handler"
          ],
          "line": 605
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterFree",
          "args": [
            "newwriter"
          ],
          "line": 604
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "607-616",
          "snippet": "void\nvirRotatingFileWriterFree(virRotatingFileWriterPtr file)\n{\n    if (!file)\n        return;\n\n    virRotatingFileWriterEntryFree(file->entry);\n    VIR_FREE(file->basepath);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirRotatingFileWriterFree(virRotatingFileWriterPtr file)\n{\n    if (!file)\n        return;\n\n    virRotatingFileWriterEntryFree(file->entry);\n    VIR_FREE(file->basepath);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterAppend",
          "args": [
            "writer",
            "message",
            "strlen(message)"
          ],
          "line": 598
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterAppend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "427-495",
          "snippet": "ssize_t\nvirRotatingFileWriterAppend(virRotatingFileWriterPtr file,\n                            const char *buf,\n                            size_t len)\n{\n    ssize_t ret = 0;\n    size_t i;\n    while (len) {\n        size_t towrite = len;\n        bool forceRollover = false;\n\n        if (file->entry->pos > file->maxlen) {\n            /* If existing file is for some reason larger then max length we\n             * won't write to this file anymore, but we rollover this file.*/\n            forceRollover = true;\n            towrite = 0;\n        } else if ((file->entry->pos + towrite) > file->maxlen) {\n            towrite = file->maxlen - file->entry->pos;\n\n            /*\n             * If there's a newline in the last 80 chars\n             * we're about to write, then break at that\n             * point to avoid splitting lines across\n             * separate files\n             */\n            for (i = 0; i < towrite && i < 80; i++) {\n                if (buf[towrite - i - 1] == '\\n') {\n                    towrite -= i;\n                    forceRollover = true;\n                    break;\n                }\n            }\n        }\n\n        if (towrite) {\n            if (safewrite(file->entry->fd, buf, towrite) != towrite) {\n                virReportSystemError(errno,\n                                     _(\"Unable to write to file %s\"),\n                                     file->basepath);\n                return -1;\n            }\n\n            len -= towrite;\n            buf += towrite;\n            ret += towrite;\n            file->entry->pos += towrite;\n            file->entry->len += towrite;\n        }\n\n        if ((file->entry->pos == file->maxlen && len) ||\n            forceRollover) {\n            virRotatingFileWriterEntryPtr tmp;\n            VIR_DEBUG(\"Hit max size %zu on %s (force=%d)\",\n                      file->maxlen, file->basepath, forceRollover);\n\n            if (virRotatingFileWriterRollover(file) < 0)\n                return -1;\n\n            if (!(tmp = virRotatingFileWriterEntryNew(file->basepath,\n                                                      file->mode)))\n                return -1;\n\n            virRotatingFileWriterEntryFree(file->entry);\n            file->entry = tmp;\n        }\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nssize_t\nvirRotatingFileWriterAppend(virRotatingFileWriterPtr file,\n                            const char *buf,\n                            size_t len)\n{\n    ssize_t ret = 0;\n    size_t i;\n    while (len) {\n        size_t towrite = len;\n        bool forceRollover = false;\n\n        if (file->entry->pos > file->maxlen) {\n            /* If existing file is for some reason larger then max length we\n             * won't write to this file anymore, but we rollover this file.*/\n            forceRollover = true;\n            towrite = 0;\n        } else if ((file->entry->pos + towrite) > file->maxlen) {\n            towrite = file->maxlen - file->entry->pos;\n\n            /*\n             * If there's a newline in the last 80 chars\n             * we're about to write, then break at that\n             * point to avoid splitting lines across\n             * separate files\n             */\n            for (i = 0; i < towrite && i < 80; i++) {\n                if (buf[towrite - i - 1] == '\\n') {\n                    towrite -= i;\n                    forceRollover = true;\n                    break;\n                }\n            }\n        }\n\n        if (towrite) {\n            if (safewrite(file->entry->fd, buf, towrite) != towrite) {\n                virReportSystemError(errno,\n                                     _(\"Unable to write to file %s\"),\n                                     file->basepath);\n                return -1;\n            }\n\n            len -= towrite;\n            buf += towrite;\n            ret += towrite;\n            file->entry->pos += towrite;\n            file->entry->len += towrite;\n        }\n\n        if ((file->entry->pos == file->maxlen && len) ||\n            forceRollover) {\n            virRotatingFileWriterEntryPtr tmp;\n            VIR_DEBUG(\"Hit max size %zu on %s (force=%d)\",\n                      file->maxlen, file->basepath, forceRollover);\n\n            if (virRotatingFileWriterRollover(file) < 0)\n                return -1;\n\n            if (!(tmp = virRotatingFileWriterEntryNew(file->basepath,\n                                                      file->mode)))\n                return -1;\n\n            virRotatingFileWriterEntryFree(file->entry);\n            file->entry = tmp;\n        }\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "message"
          ],
          "line": 598
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterNew",
          "args": [
            "path",
            "handler->max_size",
            "handler->max_backups",
            "false",
            "DEFAULT_MODE"
          ],
          "line": 588
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "232-270",
          "snippet": "virRotatingFileWriterPtr\nvirRotatingFileWriterNew(const char *path,\n                         off_t maxlen,\n                         size_t maxbackup,\n                         bool trunc,\n                         mode_t mode)\n{\n    virRotatingFileWriterPtr file;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->basepath = g_strdup(path);\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->mode = mode;\n    file->maxbackup = maxbackup;\n    file->maxlen = maxlen;\n\n    if (trunc &&\n        virRotatingFileWriterDelete(file) < 0)\n        goto error;\n\n    if (!(file->entry = virRotatingFileWriterEntryNew(file->basepath,\n                                                      mode)))\n        goto error;\n\n    return file;\n\n error:\n    virRotatingFileWriterFree(file);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_MAX_MAX_BACKUP 32"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_MAX_MAX_BACKUP 32\n\nvirRotatingFileWriterPtr\nvirRotatingFileWriterNew(const char *path,\n                         off_t maxlen,\n                         size_t maxbackup,\n                         bool trunc,\n                         mode_t mode)\n{\n    virRotatingFileWriterPtr file;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->basepath = g_strdup(path);\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->mode = mode;\n    file->maxbackup = maxbackup;\n    file->maxlen = maxlen;\n\n    if (trunc &&\n        virRotatingFileWriterDelete(file) < 0)\n        goto error;\n\n    if (!(file->entry = virRotatingFileWriterEntryNew(file->basepath,\n                                                      mode)))\n        goto error;\n\n    return file;\n\n error:\n    virRotatingFileWriterFree(file);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "virRotatingFileWriterGetPath(handler->files[i]->file)",
            "path"
          ],
          "line": 581
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterGetPath",
          "args": [
            "handler->files[i]->file"
          ],
          "line": 581
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterGetPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "332-336",
          "snippet": "const char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "handler"
          ],
          "line": 578
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Appending to log '%s' message: '%s'\"",
            "path",
            "message"
          ],
          "line": 576
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 574
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\n#define DEFAULT_MODE 0600\n\nint\nvirLogHandlerDomainAppendLogFile(virLogHandlerPtr handler,\n                                 const char *driver G_GNUC_UNUSED,\n                                 const unsigned char *domuuid G_GNUC_UNUSED,\n                                 const char *domname G_GNUC_UNUSED,\n                                 const char *path,\n                                 const char *message,\n                                 unsigned int flags)\n{\n    size_t i;\n    virRotatingFileWriterPtr writer = NULL;\n    virRotatingFileWriterPtr newwriter = NULL;\n    int ret = -1;\n\n    virCheckFlags(0, -1);\n\n    VIR_DEBUG(\"Appending to log '%s' message: '%s'\", path, message);\n\n    virObjectLock(handler);\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (STREQ(virRotatingFileWriterGetPath(handler->files[i]->file), path)) {\n            writer = handler->files[i]->file;\n            break;\n        }\n    }\n\n    if (!writer) {\n        if (!(newwriter = virRotatingFileWriterNew(path,\n                                                   handler->max_size,\n                                                   handler->max_backups,\n                                                   false,\n                                                   DEFAULT_MODE)))\n            goto cleanup;\n\n        writer = newwriter;\n    }\n\n    if (virRotatingFileWriterAppend(writer, message, strlen(message)) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virRotatingFileWriterFree(newwriter);\n    virObjectUnlock(handler);\n    return ret;\n}"
  },
  {
    "function_name": "virLogHandlerDomainReadLogFile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "518-557",
    "snippet": "char *\nvirLogHandlerDomainReadLogFile(virLogHandlerPtr handler,\n                               const char *path,\n                               ino_t inode,\n                               off_t offset,\n                               size_t maxlen,\n                               unsigned int flags)\n{\n    virRotatingFileReaderPtr file = NULL;\n    char *data = NULL;\n    ssize_t got;\n\n    virCheckFlags(0, NULL);\n\n    virObjectLock(handler);\n\n    if (!(file = virRotatingFileReaderNew(path, handler->max_backups)))\n        goto error;\n\n    if (virRotatingFileReaderSeek(file, inode, offset) < 0)\n        goto error;\n\n    if (VIR_ALLOC_N(data, maxlen + 1) < 0)\n        goto error;\n\n    got = virRotatingFileReaderConsume(file, data, maxlen);\n    if (got < 0)\n        goto error;\n    data[got] = '\\0';\n\n    virRotatingFileReaderFree(file);\n    virObjectUnlock(handler);\n    return data;\n\n error:\n    VIR_FREE(data);\n    virRotatingFileReaderFree(file);\n    virObjectUnlock(handler);\n    return NULL;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "handler"
          ],
          "line": 555
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileReaderFree",
          "args": [
            "file"
          ],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileReaderFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "625-637",
          "snippet": "void\nvirRotatingFileReaderFree(virRotatingFileReaderPtr file)\n{\n    size_t i;\n\n    if (!file)\n        return;\n\n    for (i = 0; i < file->nentries; i++)\n        virRotatingFileReaderEntryFree(file->entries[i]);\n    VIR_FREE(file->entries);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirRotatingFileReaderFree(virRotatingFileReaderPtr file)\n{\n    size_t i;\n\n    if (!file)\n        return;\n\n    for (i = 0; i < file->nentries; i++)\n        virRotatingFileReaderEntryFree(file->entries[i]);\n    VIR_FREE(file->entries);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "data"
          ],
          "line": 553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileReaderConsume",
          "args": [
            "file",
            "data",
            "maxlen"
          ],
          "line": 543
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileReaderConsume",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "559-598",
          "snippet": "ssize_t\nvirRotatingFileReaderConsume(virRotatingFileReaderPtr file,\n                             char *buf,\n                             size_t len)\n{\n    ssize_t ret = 0;\n\n    VIR_DEBUG(\"Consume %p %zu\", buf, len);\n    while (len) {\n        virRotatingFileReaderEntryPtr entry;\n        ssize_t got;\n\n        if (file->current >= file->nentries)\n            break;\n\n        entry = file->entries[file->current];\n        if (entry->fd == -1) {\n            file->current++;\n            continue;\n        }\n\n        got = saferead(entry->fd, buf + ret, len);\n        if (got < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to read from file %s\"),\n                                 entry->path);\n            return -1;\n        }\n\n        if (got == 0) {\n            file->current++;\n            continue;\n        }\n\n        ret += got;\n        len -= got;\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nssize_t\nvirRotatingFileReaderConsume(virRotatingFileReaderPtr file,\n                             char *buf,\n                             size_t len)\n{\n    ssize_t ret = 0;\n\n    VIR_DEBUG(\"Consume %p %zu\", buf, len);\n    while (len) {\n        virRotatingFileReaderEntryPtr entry;\n        ssize_t got;\n\n        if (file->current >= file->nentries)\n            break;\n\n        entry = file->entries[file->current];\n        if (entry->fd == -1) {\n            file->current++;\n            continue;\n        }\n\n        got = saferead(entry->fd, buf + ret, len);\n        if (got < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to read from file %s\"),\n                                 entry->path);\n            return -1;\n        }\n\n        if (got == 0) {\n            file->current++;\n            continue;\n        }\n\n        ret += got;\n        len -= got;\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "data",
            "maxlen + 1"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileReaderSeek",
          "args": [
            "file",
            "inode",
            "offset"
          ],
          "line": 537
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileReaderSeek",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "510-545",
          "snippet": "int\nvirRotatingFileReaderSeek(virRotatingFileReaderPtr file,\n                          ino_t inode,\n                          off_t offset)\n{\n    size_t i;\n    off_t ret;\n\n    for (i = 0; i < file->nentries; i++) {\n        virRotatingFileReaderEntryPtr entry = file->entries[i];\n        if (entry->inode != inode ||\n            entry->fd == -1)\n            continue;\n\n        ret = lseek(entry->fd, offset, SEEK_SET);\n        if (ret == (off_t)-1) {\n            virReportSystemError(errno,\n                                 _(\"Unable to seek to inode %llu offset %llu\"),\n                                 (unsigned long long)inode, (unsigned long long)offset);\n            return -1;\n        }\n\n        file->current = i;\n        return 0;\n    }\n\n    file->current = 0;\n    ret = lseek(file->entries[0]->fd, offset, SEEK_SET);\n    if (ret == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to seek to inode %llu offset %llu\"),\n                             (unsigned long long)inode, (unsigned long long)offset);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirRotatingFileReaderSeek(virRotatingFileReaderPtr file,\n                          ino_t inode,\n                          off_t offset)\n{\n    size_t i;\n    off_t ret;\n\n    for (i = 0; i < file->nentries; i++) {\n        virRotatingFileReaderEntryPtr entry = file->entries[i];\n        if (entry->inode != inode ||\n            entry->fd == -1)\n            continue;\n\n        ret = lseek(entry->fd, offset, SEEK_SET);\n        if (ret == (off_t)-1) {\n            virReportSystemError(errno,\n                                 _(\"Unable to seek to inode %llu offset %llu\"),\n                                 (unsigned long long)inode, (unsigned long long)offset);\n            return -1;\n        }\n\n        file->current = i;\n        return 0;\n    }\n\n    file->current = 0;\n    ret = lseek(file->entries[0]->fd, offset, SEEK_SET);\n    if (ret == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to seek to inode %llu offset %llu\"),\n                             (unsigned long long)inode, (unsigned long long)offset);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileReaderNew",
          "args": [
            "path",
            "handler->max_backups"
          ],
          "line": 534
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileReaderNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "284-323",
          "snippet": "virRotatingFileReaderPtr\nvirRotatingFileReaderNew(const char *path,\n                         size_t maxbackup)\n{\n    virRotatingFileReaderPtr file;\n    size_t i;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->nentries = maxbackup + 1;\n    if (VIR_ALLOC_N(file->entries, file->nentries) < 0)\n        goto error;\n\n    if (!(file->entries[file->nentries - 1] = virRotatingFileReaderEntryNew(path)))\n        goto error;\n\n    for (i = 0; i < maxbackup; i++) {\n        char *tmppath;\n        tmppath = g_strdup_printf(\"%s.%zu\", path, i);\n\n        file->entries[file->nentries - (i + 2)] = virRotatingFileReaderEntryNew(tmppath);\n        VIR_FREE(tmppath);\n        if (!file->entries[file->nentries - (i + 2)])\n            goto error;\n    }\n\n    return file;\n\n error:\n    virRotatingFileReaderFree(file);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_MAX_MAX_BACKUP 32"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_MAX_MAX_BACKUP 32\n\nvirRotatingFileReaderPtr\nvirRotatingFileReaderNew(const char *path,\n                         size_t maxbackup)\n{\n    virRotatingFileReaderPtr file;\n    size_t i;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->nentries = maxbackup + 1;\n    if (VIR_ALLOC_N(file->entries, file->nentries) < 0)\n        goto error;\n\n    if (!(file->entries[file->nentries - 1] = virRotatingFileReaderEntryNew(path)))\n        goto error;\n\n    for (i = 0; i < maxbackup; i++) {\n        char *tmppath;\n        tmppath = g_strdup_printf(\"%s.%zu\", path, i);\n\n        file->entries[file->nentries - (i + 2)] = virRotatingFileReaderEntryNew(tmppath);\n        VIR_FREE(tmppath);\n        if (!file->entries[file->nentries - (i + 2)])\n            goto error;\n    }\n\n    return file;\n\n error:\n    virRotatingFileReaderFree(file);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "handler"
          ],
          "line": 532
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "NULL"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nchar *\nvirLogHandlerDomainReadLogFile(virLogHandlerPtr handler,\n                               const char *path,\n                               ino_t inode,\n                               off_t offset,\n                               size_t maxlen,\n                               unsigned int flags)\n{\n    virRotatingFileReaderPtr file = NULL;\n    char *data = NULL;\n    ssize_t got;\n\n    virCheckFlags(0, NULL);\n\n    virObjectLock(handler);\n\n    if (!(file = virRotatingFileReaderNew(path, handler->max_backups)))\n        goto error;\n\n    if (virRotatingFileReaderSeek(file, inode, offset) < 0)\n        goto error;\n\n    if (VIR_ALLOC_N(data, maxlen + 1) < 0)\n        goto error;\n\n    got = virRotatingFileReaderConsume(file, data, maxlen);\n    if (got < 0)\n        goto error;\n    data[got] = '\\0';\n\n    virRotatingFileReaderFree(file);\n    virObjectUnlock(handler);\n    return data;\n\n error:\n    VIR_FREE(data);\n    virRotatingFileReaderFree(file);\n    virObjectUnlock(handler);\n    return NULL;\n}"
  },
  {
    "function_name": "virLogHandlerDomainGetLogFilePosition",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "475-515",
    "snippet": "int\nvirLogHandlerDomainGetLogFilePosition(virLogHandlerPtr handler,\n                                      const char *path,\n                                      unsigned int flags,\n                                      ino_t *inode,\n                                      off_t *offset)\n{\n    virLogHandlerLogFilePtr file = NULL;\n    int ret = -1;\n    size_t i;\n\n    virCheckFlags(0, -1);\n\n    virObjectLock(handler);\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (STREQ(virRotatingFileWriterGetPath(handler->files[i]->file),\n                  path)) {\n            file = handler->files[i];\n            break;\n        }\n    }\n\n    if (!file) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"No open log file %s\"),\n                       path);\n        goto cleanup;\n    }\n\n    virLogHandlerDomainLogFileDrain(file);\n\n    *inode = virRotatingFileWriterGetINode(file->file);\n    *offset = virRotatingFileWriterGetOffset(file->file);\n\n    ret = 0;\n\n cleanup:\n    virObjectUnlock(handler);\n    return ret;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "handler"
          ],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterGetOffset",
          "args": [
            "file->file"
          ],
          "line": 508
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterGetOffset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "358-362",
          "snippet": "off_t\nvirRotatingFileWriterGetOffset(virRotatingFileWriterPtr file)\n{\n    return file->entry->pos;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\noff_t\nvirRotatingFileWriterGetOffset(virRotatingFileWriterPtr file)\n{\n    return file->entry->pos;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterGetINode",
          "args": [
            "file->file"
          ],
          "line": 507
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterGetINode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "345-349",
          "snippet": "ino_t\nvirRotatingFileWriterGetINode(virRotatingFileWriterPtr file)\n{\n    return file->entry->inode;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nino_t\nvirRotatingFileWriterGetINode(virRotatingFileWriterPtr file)\n{\n    return file->entry->inode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerDomainLogFileDrain",
          "args": [
            "file"
          ],
          "line": 505
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerDomainLogFileDrain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "437-472",
          "snippet": "static void\nvirLogHandlerDomainLogFileDrain(virLogHandlerLogFilePtr file)\n{\n    char buf[1024];\n    ssize_t len;\n    struct pollfd pfd;\n    int ret;\n\n    for (;;) {\n        pfd.fd = file->pipefd;\n        pfd.events = POLLIN;\n        pfd.revents = 0;\n\n        ret = poll(&pfd, 1, 0);\n        if (ret < 0) {\n            if (errno == EINTR)\n                continue;\n\n            return;\n        }\n\n        if (ret == 0)\n            return;\n\n        len = read(file->pipefd, buf, sizeof(buf));\n        file->drained = true;\n        if (len < 0) {\n            if (errno == EINTR)\n                continue;\n            return;\n        }\n\n        if (virRotatingFileWriterAppend(file->file, buf, len) != len)\n            return;\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerDomainLogFileDrain(virLogHandlerLogFilePtr file)\n{\n    char buf[1024];\n    ssize_t len;\n    struct pollfd pfd;\n    int ret;\n\n    for (;;) {\n        pfd.fd = file->pipefd;\n        pfd.events = POLLIN;\n        pfd.revents = 0;\n\n        ret = poll(&pfd, 1, 0);\n        if (ret < 0) {\n            if (errno == EINTR)\n                continue;\n\n            return;\n        }\n\n        if (ret == 0)\n            return;\n\n        len = read(file->pipefd, buf, sizeof(buf));\n        file->drained = true;\n        if (len < 0) {\n            if (errno == EINTR)\n                continue;\n            return;\n        }\n\n        if (virRotatingFileWriterAppend(file->file, buf, len) != len)\n            return;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"No open log file %s\")",
            "path"
          ],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"No open log file %s\""
          ],
          "line": 500
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "virRotatingFileWriterGetPath(handler->files[i]->file)",
            "path"
          ],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterGetPath",
          "args": [
            "handler->files[i]->file"
          ],
          "line": 491
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterGetPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "332-336",
          "snippet": "const char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "handler"
          ],
          "line": 488
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 486
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nint\nvirLogHandlerDomainGetLogFilePosition(virLogHandlerPtr handler,\n                                      const char *path,\n                                      unsigned int flags,\n                                      ino_t *inode,\n                                      off_t *offset)\n{\n    virLogHandlerLogFilePtr file = NULL;\n    int ret = -1;\n    size_t i;\n\n    virCheckFlags(0, -1);\n\n    virObjectLock(handler);\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (STREQ(virRotatingFileWriterGetPath(handler->files[i]->file),\n                  path)) {\n            file = handler->files[i];\n            break;\n        }\n    }\n\n    if (!file) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"No open log file %s\"),\n                       path);\n        goto cleanup;\n    }\n\n    virLogHandlerDomainLogFileDrain(file);\n\n    *inode = virRotatingFileWriterGetINode(file->file);\n    *offset = virRotatingFileWriterGetOffset(file->file);\n\n    ret = 0;\n\n cleanup:\n    virObjectUnlock(handler);\n    return ret;\n}"
  },
  {
    "function_name": "virLogHandlerDomainLogFileDrain",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "437-472",
    "snippet": "static void\nvirLogHandlerDomainLogFileDrain(virLogHandlerLogFilePtr file)\n{\n    char buf[1024];\n    ssize_t len;\n    struct pollfd pfd;\n    int ret;\n\n    for (;;) {\n        pfd.fd = file->pipefd;\n        pfd.events = POLLIN;\n        pfd.revents = 0;\n\n        ret = poll(&pfd, 1, 0);\n        if (ret < 0) {\n            if (errno == EINTR)\n                continue;\n\n            return;\n        }\n\n        if (ret == 0)\n            return;\n\n        len = read(file->pipefd, buf, sizeof(buf));\n        file->drained = true;\n        if (len < 0) {\n            if (errno == EINTR)\n                continue;\n            return;\n        }\n\n        if (virRotatingFileWriterAppend(file->file, buf, len) != len)\n            return;\n    }\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virRotatingFileWriterAppend",
          "args": [
            "file->file",
            "buf",
            "len"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterAppend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "427-495",
          "snippet": "ssize_t\nvirRotatingFileWriterAppend(virRotatingFileWriterPtr file,\n                            const char *buf,\n                            size_t len)\n{\n    ssize_t ret = 0;\n    size_t i;\n    while (len) {\n        size_t towrite = len;\n        bool forceRollover = false;\n\n        if (file->entry->pos > file->maxlen) {\n            /* If existing file is for some reason larger then max length we\n             * won't write to this file anymore, but we rollover this file.*/\n            forceRollover = true;\n            towrite = 0;\n        } else if ((file->entry->pos + towrite) > file->maxlen) {\n            towrite = file->maxlen - file->entry->pos;\n\n            /*\n             * If there's a newline in the last 80 chars\n             * we're about to write, then break at that\n             * point to avoid splitting lines across\n             * separate files\n             */\n            for (i = 0; i < towrite && i < 80; i++) {\n                if (buf[towrite - i - 1] == '\\n') {\n                    towrite -= i;\n                    forceRollover = true;\n                    break;\n                }\n            }\n        }\n\n        if (towrite) {\n            if (safewrite(file->entry->fd, buf, towrite) != towrite) {\n                virReportSystemError(errno,\n                                     _(\"Unable to write to file %s\"),\n                                     file->basepath);\n                return -1;\n            }\n\n            len -= towrite;\n            buf += towrite;\n            ret += towrite;\n            file->entry->pos += towrite;\n            file->entry->len += towrite;\n        }\n\n        if ((file->entry->pos == file->maxlen && len) ||\n            forceRollover) {\n            virRotatingFileWriterEntryPtr tmp;\n            VIR_DEBUG(\"Hit max size %zu on %s (force=%d)\",\n                      file->maxlen, file->basepath, forceRollover);\n\n            if (virRotatingFileWriterRollover(file) < 0)\n                return -1;\n\n            if (!(tmp = virRotatingFileWriterEntryNew(file->basepath,\n                                                      file->mode)))\n                return -1;\n\n            virRotatingFileWriterEntryFree(file->entry);\n            file->entry = tmp;\n        }\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nssize_t\nvirRotatingFileWriterAppend(virRotatingFileWriterPtr file,\n                            const char *buf,\n                            size_t len)\n{\n    ssize_t ret = 0;\n    size_t i;\n    while (len) {\n        size_t towrite = len;\n        bool forceRollover = false;\n\n        if (file->entry->pos > file->maxlen) {\n            /* If existing file is for some reason larger then max length we\n             * won't write to this file anymore, but we rollover this file.*/\n            forceRollover = true;\n            towrite = 0;\n        } else if ((file->entry->pos + towrite) > file->maxlen) {\n            towrite = file->maxlen - file->entry->pos;\n\n            /*\n             * If there's a newline in the last 80 chars\n             * we're about to write, then break at that\n             * point to avoid splitting lines across\n             * separate files\n             */\n            for (i = 0; i < towrite && i < 80; i++) {\n                if (buf[towrite - i - 1] == '\\n') {\n                    towrite -= i;\n                    forceRollover = true;\n                    break;\n                }\n            }\n        }\n\n        if (towrite) {\n            if (safewrite(file->entry->fd, buf, towrite) != towrite) {\n                virReportSystemError(errno,\n                                     _(\"Unable to write to file %s\"),\n                                     file->basepath);\n                return -1;\n            }\n\n            len -= towrite;\n            buf += towrite;\n            ret += towrite;\n            file->entry->pos += towrite;\n            file->entry->len += towrite;\n        }\n\n        if ((file->entry->pos == file->maxlen && len) ||\n            forceRollover) {\n            virRotatingFileWriterEntryPtr tmp;\n            VIR_DEBUG(\"Hit max size %zu on %s (force=%d)\",\n                      file->maxlen, file->basepath, forceRollover);\n\n            if (virRotatingFileWriterRollover(file) < 0)\n                return -1;\n\n            if (!(tmp = virRotatingFileWriterEntryNew(file->basepath,\n                                                      file->mode)))\n                return -1;\n\n            virRotatingFileWriterEntryFree(file->entry);\n            file->entry = tmp;\n        }\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "file->pipefd",
            "buf",
            "sizeof(buf)"
          ],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDelIOThread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "7811-7841",
          "snippet": "int\nvirDomainDelIOThread(virDomainPtr domain,\n                     unsigned int iothread_id,\n                     unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"iothread_id=%u, flags=0x%x\", iothread_id, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    virCheckReadOnlyGoto(domain->conn->flags, error);\n    virCheckNonZeroArgGoto(iothread_id, error);\n\n    conn = domain->conn;\n\n    if (conn->driver->domainDelIOThread) {\n        int ret;\n        ret = conn->driver->domainDelIOThread(domain, iothread_id, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nint\nvirDomainDelIOThread(virDomainPtr domain,\n                     unsigned int iothread_id,\n                     unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"iothread_id=%u, flags=0x%x\", iothread_id, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    virCheckReadOnlyGoto(domain->conn->flags, error);\n    virCheckNonZeroArgGoto(iothread_id, error);\n\n    conn = domain->conn;\n\n    if (conn->driver->domainDelIOThread) {\n        int ret;\n        ret = conn->driver->domainDelIOThread(domain, iothread_id, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "poll",
          "args": [
            "&pfd",
            "1",
            "0"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerDomainLogFileDrain(virLogHandlerLogFilePtr file)\n{\n    char buf[1024];\n    ssize_t len;\n    struct pollfd pfd;\n    int ret;\n\n    for (;;) {\n        pfd.fd = file->pipefd;\n        pfd.events = POLLIN;\n        pfd.revents = 0;\n\n        ret = poll(&pfd, 1, 0);\n        if (ret < 0) {\n            if (errno == EINTR)\n                continue;\n\n            return;\n        }\n\n        if (ret == 0)\n            return;\n\n        len = read(file->pipefd, buf, sizeof(buf));\n        file->drained = true;\n        if (len < 0) {\n            if (errno == EINTR)\n                continue;\n            return;\n        }\n\n        if (virRotatingFileWriterAppend(file->file, buf, len) != len)\n            return;\n    }\n}"
  },
  {
    "function_name": "virLogHandlerDomainOpenLogFile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "361-434",
    "snippet": "int\nvirLogHandlerDomainOpenLogFile(virLogHandlerPtr handler,\n                               const char *driver,\n                               const unsigned char *domuuid,\n                               const char *domname,\n                               const char *path,\n                               bool trunc,\n                               ino_t *inode,\n                               off_t *offset)\n{\n    size_t i;\n    virLogHandlerLogFilePtr file = NULL;\n    int pipefd[2] = { -1, -1 };\n\n    virObjectLock(handler);\n\n    handler->inhibitor(true, handler->opaque);\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (STREQ(virRotatingFileWriterGetPath(handler->files[i]->file),\n                  path)) {\n            virReportSystemError(EBUSY,\n                                 _(\"Cannot open log file: '%s'\"),\n                                 path);\n            goto error;\n        }\n    }\n\n    if (virPipe(pipefd) < 0)\n        goto error;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->watch = -1;\n    file->pipefd = pipefd[0];\n    pipefd[0] = -1;\n    memcpy(file->domuuid, domuuid, VIR_UUID_BUFLEN);\n    file->driver = g_strdup(driver);\n    file->domname = g_strdup(domname);\n\n    if ((file->file = virRotatingFileWriterNew(path,\n                                               handler->max_size,\n                                               handler->max_backups,\n                                               trunc,\n                                               DEFAULT_MODE)) == NULL)\n        goto error;\n\n    if (VIR_APPEND_ELEMENT_COPY(handler->files, handler->nfiles, file) < 0)\n        goto error;\n\n    if ((file->watch = virEventAddHandle(file->pipefd,\n                                         VIR_EVENT_HANDLE_READABLE,\n                                         virLogHandlerDomainLogFileEvent,\n                                         handler,\n                                         NULL)) < 0) {\n        VIR_DELETE_ELEMENT(handler->files, handler->nfiles - 1, handler->nfiles);\n        goto error;\n    }\n\n    *inode = virRotatingFileWriterGetINode(file->file);\n    *offset = virRotatingFileWriterGetOffset(file->file);\n\n    virObjectUnlock(handler);\n    return pipefd[1];\n\n error:\n    VIR_FORCE_CLOSE(pipefd[0]);\n    VIR_FORCE_CLOSE(pipefd[1]);\n    handler->inhibitor(false, handler->opaque);\n    virLogHandlerLogFileFree(file);\n    virObjectUnlock(handler);\n    return -1;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DEFAULT_MODE 0600"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "handler"
          ],
          "line": 432
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerLogFileFree",
          "args": [
            "file"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerLogFileFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "89-104",
          "snippet": "static void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "handler->inhibitor",
          "args": [
            "false",
            "handler->opaque"
          ],
          "line": 430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "pipefd[1]"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "pipefd[0]"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterGetOffset",
          "args": [
            "file->file"
          ],
          "line": 422
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterGetOffset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "358-362",
          "snippet": "off_t\nvirRotatingFileWriterGetOffset(virRotatingFileWriterPtr file)\n{\n    return file->entry->pos;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\noff_t\nvirRotatingFileWriterGetOffset(virRotatingFileWriterPtr file)\n{\n    return file->entry->pos;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterGetINode",
          "args": [
            "file->file"
          ],
          "line": 421
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterGetINode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "345-349",
          "snippet": "ino_t\nvirRotatingFileWriterGetINode(virRotatingFileWriterPtr file)\n{\n    return file->entry->inode;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nino_t\nvirRotatingFileWriterGetINode(virRotatingFileWriterPtr file)\n{\n    return file->entry->inode;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "handler->files",
            "handler->nfiles - 1",
            "handler->nfiles"
          ],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virEventAddHandle",
          "args": [
            "file->pipefd",
            "VIR_EVENT_HANDLE_READABLE",
            "virLogHandlerDomainLogFileEvent",
            "handler",
            "NULL"
          ],
          "line": 412
        },
        "resolved": true,
        "details": {
          "function_name": "virEventAddHandle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "73-84",
          "snippet": "int\nvirEventAddHandle(int fd,\n                  int events,\n                  virEventHandleCallback cb,\n                  void *opaque,\n                  virFreeCallback ff)\n{\n    if (!addHandleImpl)\n        return -1;\n\n    return addHandleImpl(fd, events, cb, opaque, ff);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventAddHandleFunc addHandleImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventAddHandleFunc addHandleImpl;\n\nint\nvirEventAddHandle(int fd,\n                  int events,\n                  virEventHandleCallback cb,\n                  void *opaque,\n                  virFreeCallback ff)\n{\n    if (!addHandleImpl)\n        return -1;\n\n    return addHandleImpl(fd, events, cb, opaque, ff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT_COPY",
          "args": [
            "handler->files",
            "handler->nfiles",
            "file"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterNew",
          "args": [
            "path",
            "handler->max_size",
            "handler->max_backups",
            "trunc",
            "DEFAULT_MODE"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "232-270",
          "snippet": "virRotatingFileWriterPtr\nvirRotatingFileWriterNew(const char *path,\n                         off_t maxlen,\n                         size_t maxbackup,\n                         bool trunc,\n                         mode_t mode)\n{\n    virRotatingFileWriterPtr file;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->basepath = g_strdup(path);\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->mode = mode;\n    file->maxbackup = maxbackup;\n    file->maxlen = maxlen;\n\n    if (trunc &&\n        virRotatingFileWriterDelete(file) < 0)\n        goto error;\n\n    if (!(file->entry = virRotatingFileWriterEntryNew(file->basepath,\n                                                      mode)))\n        goto error;\n\n    return file;\n\n error:\n    virRotatingFileWriterFree(file);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_MAX_MAX_BACKUP 32"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_MAX_MAX_BACKUP 32\n\nvirRotatingFileWriterPtr\nvirRotatingFileWriterNew(const char *path,\n                         off_t maxlen,\n                         size_t maxbackup,\n                         bool trunc,\n                         mode_t mode)\n{\n    virRotatingFileWriterPtr file;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->basepath = g_strdup(path);\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->mode = mode;\n    file->maxbackup = maxbackup;\n    file->maxlen = maxlen;\n\n    if (trunc &&\n        virRotatingFileWriterDelete(file) < 0)\n        goto error;\n\n    if (!(file->entry = virRotatingFileWriterEntryNew(file->basepath,\n                                                      mode)))\n        goto error;\n\n    return file;\n\n error:\n    virRotatingFileWriterFree(file);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "domname"
          ],
          "line": 400
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "file->domuuid",
            "domuuid",
            "VIR_UUID_BUFLEN"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "file"
          ],
          "line": 392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPipe",
          "args": [
            "pipefd"
          ],
          "line": 389
        },
        "resolved": true,
        "details": {
          "function_name": "virPipeNonBlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1813-1817",
          "snippet": "int\nvirPipeNonBlock(int fds[2])\n{\n    return virPipeImpl(fds, true, true);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPipeNonBlock(int fds[2])\n{\n    return virPipeImpl(fds, true, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "EBUSY",
            "_(\"Cannot open log file: '%s'\")",
            "path"
          ],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "virRotatingFileWriterGetPath(handler->files[i]->file)",
            "path"
          ],
          "line": 380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterGetPath",
          "args": [
            "handler->files[i]->file"
          ],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterGetPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "332-336",
          "snippet": "const char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}"
        }
      },
      {
        "call_info": {
          "callee": "handler->inhibitor",
          "args": [
            "true",
            "handler->opaque"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "handler"
          ],
          "line": 375
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\n#define DEFAULT_MODE 0600\n\nint\nvirLogHandlerDomainOpenLogFile(virLogHandlerPtr handler,\n                               const char *driver,\n                               const unsigned char *domuuid,\n                               const char *domname,\n                               const char *path,\n                               bool trunc,\n                               ino_t *inode,\n                               off_t *offset)\n{\n    size_t i;\n    virLogHandlerLogFilePtr file = NULL;\n    int pipefd[2] = { -1, -1 };\n\n    virObjectLock(handler);\n\n    handler->inhibitor(true, handler->opaque);\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (STREQ(virRotatingFileWriterGetPath(handler->files[i]->file),\n                  path)) {\n            virReportSystemError(EBUSY,\n                                 _(\"Cannot open log file: '%s'\"),\n                                 path);\n            goto error;\n        }\n    }\n\n    if (virPipe(pipefd) < 0)\n        goto error;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->watch = -1;\n    file->pipefd = pipefd[0];\n    pipefd[0] = -1;\n    memcpy(file->domuuid, domuuid, VIR_UUID_BUFLEN);\n    file->driver = g_strdup(driver);\n    file->domname = g_strdup(domname);\n\n    if ((file->file = virRotatingFileWriterNew(path,\n                                               handler->max_size,\n                                               handler->max_backups,\n                                               trunc,\n                                               DEFAULT_MODE)) == NULL)\n        goto error;\n\n    if (VIR_APPEND_ELEMENT_COPY(handler->files, handler->nfiles, file) < 0)\n        goto error;\n\n    if ((file->watch = virEventAddHandle(file->pipefd,\n                                         VIR_EVENT_HANDLE_READABLE,\n                                         virLogHandlerDomainLogFileEvent,\n                                         handler,\n                                         NULL)) < 0) {\n        VIR_DELETE_ELEMENT(handler->files, handler->nfiles - 1, handler->nfiles);\n        goto error;\n    }\n\n    *inode = virRotatingFileWriterGetINode(file->file);\n    *offset = virRotatingFileWriterGetOffset(file->file);\n\n    virObjectUnlock(handler);\n    return pipefd[1];\n\n error:\n    VIR_FORCE_CLOSE(pipefd[0]);\n    VIR_FORCE_CLOSE(pipefd[1]);\n    handler->inhibitor(false, handler->opaque);\n    virLogHandlerLogFileFree(file);\n    virObjectUnlock(handler);\n    return -1;\n}"
  },
  {
    "function_name": "virLogHandlerDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "347-358",
    "snippet": "static void\nvirLogHandlerDispose(void *obj)\n{\n    virLogHandlerPtr handler = obj;\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        handler->inhibitor(false, handler->opaque);\n        virLogHandlerLogFileFree(handler->files[i]);\n    }\n    VIR_FREE(handler->files);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virLogHandlerDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "handler->files"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogHandlerLogFileFree",
          "args": [
            "handler->files[i]"
          ],
          "line": 355
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerLogFileFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "89-104",
          "snippet": "static void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "handler->inhibitor",
          "args": [
            "false",
            "handler->opaque"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void virLogHandlerDispose(void *obj);\n\nstatic void\nvirLogHandlerDispose(void *obj)\n{\n    virLogHandlerPtr handler = obj;\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        handler->inhibitor(false, handler->opaque);\n        virLogHandlerLogFileFree(handler->files[i]);\n    }\n    VIR_FREE(handler->files);\n}"
  },
  {
    "function_name": "virLogHandlerNewPostExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "287-344",
    "snippet": "virLogHandlerPtr\nvirLogHandlerNewPostExecRestart(virJSONValuePtr object,\n                                bool privileged,\n                                size_t max_size,\n                                size_t max_backups,\n                                virLogHandlerShutdownInhibitor inhibitor,\n                                void *opaque)\n{\n    virLogHandlerPtr handler;\n    virJSONValuePtr files;\n    size_t i;\n\n    if (!(handler = virLogHandlerNew(privileged,\n                                     max_size,\n                                     max_backups,\n                                     inhibitor,\n                                     opaque)))\n        return NULL;\n\n    if (!(files = virJSONValueObjectGet(object, \"files\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing files data from JSON file\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(files)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed files array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(files); i++) {\n        virLogHandlerLogFilePtr file;\n        virJSONValuePtr child = virJSONValueArrayGet(files, i);\n\n        if (!(file = virLogHandlerLogFilePostExecRestart(handler, child)))\n            goto error;\n\n        if (VIR_APPEND_ELEMENT_COPY(handler->files, handler->nfiles, file) < 0)\n            goto error;\n\n        if ((file->watch = virEventAddHandle(file->pipefd,\n                                             VIR_EVENT_HANDLE_READABLE,\n                                             virLogHandlerDomainLogFileEvent,\n                                             handler,\n                                             NULL)) < 0) {\n            VIR_DELETE_ELEMENT(handler->files, handler->nfiles - 1, handler->nfiles);\n            goto error;\n        }\n    }\n\n\n    return handler;\n\n error:\n    virObjectUnref(handler);\n    return NULL;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "handler"
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "handler->files",
            "handler->nfiles - 1",
            "handler->nfiles"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virEventAddHandle",
          "args": [
            "file->pipefd",
            "VIR_EVENT_HANDLE_READABLE",
            "virLogHandlerDomainLogFileEvent",
            "handler",
            "NULL"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "virEventAddHandle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "73-84",
          "snippet": "int\nvirEventAddHandle(int fd,\n                  int events,\n                  virEventHandleCallback cb,\n                  void *opaque,\n                  virFreeCallback ff)\n{\n    if (!addHandleImpl)\n        return -1;\n\n    return addHandleImpl(fd, events, cb, opaque, ff);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventAddHandleFunc addHandleImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventAddHandleFunc addHandleImpl;\n\nint\nvirEventAddHandle(int fd,\n                  int events,\n                  virEventHandleCallback cb,\n                  void *opaque,\n                  virFreeCallback ff)\n{\n    if (!addHandleImpl)\n        return -1;\n\n    return addHandleImpl(fd, events, cb, opaque, ff);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT_COPY",
          "args": [
            "handler->files",
            "handler->nfiles",
            "file"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogHandlerLogFilePostExecRestart",
          "args": [
            "handler",
            "child"
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerLogFilePostExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "215-284",
          "snippet": "static virLogHandlerLogFilePtr\nvirLogHandlerLogFilePostExecRestart(virLogHandlerPtr handler,\n                                    virJSONValuePtr object)\n{\n    virLogHandlerLogFilePtr file;\n    const char *path;\n    const char *domuuid;\n    const char *tmp;\n\n    if (VIR_ALLOC(file) < 0)\n        return NULL;\n\n    handler->inhibitor(true, handler->opaque);\n\n    if ((path = virJSONValueObjectGetString(object, \"path\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'path' field in JSON document\"));\n        goto error;\n    }\n\n    if ((tmp = virJSONValueObjectGetString(object, \"driver\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'driver' in JSON document\"));\n        goto error;\n    }\n    file->driver = g_strdup(tmp);\n\n    if ((tmp = virJSONValueObjectGetString(object, \"domname\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'domname' in JSON document\"));\n        goto error;\n    }\n    file->domname = g_strdup(tmp);\n\n    if ((domuuid = virJSONValueObjectGetString(object, \"domuuid\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'domuuid' in JSON document\"));\n        goto error;\n    }\n    if (virUUIDParse(domuuid, file->domuuid) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed 'domuuid' in JSON document\"));\n        goto error;\n    }\n\n    if ((file->file = virRotatingFileWriterNew(path,\n                                               handler->max_size,\n                                               handler->max_backups,\n                                               false,\n                                               DEFAULT_MODE)) == NULL)\n        goto error;\n\n    if (virJSONValueObjectGetNumberInt(object, \"pipefd\", &file->pipefd) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'pipefd' in JSON document\"));\n        goto error;\n    }\n    if (virSetInherit(file->pipefd, false) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot enable close-on-exec flag\"));\n        goto error;\n    }\n\n    return file;\n\n error:\n    handler->inhibitor(false, handler->opaque);\n    virLogHandlerLogFileFree(file);\n    return NULL;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define DEFAULT_MODE 0600"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\n#define DEFAULT_MODE 0600\n\nstatic virLogHandlerLogFilePtr\nvirLogHandlerLogFilePostExecRestart(virLogHandlerPtr handler,\n                                    virJSONValuePtr object)\n{\n    virLogHandlerLogFilePtr file;\n    const char *path;\n    const char *domuuid;\n    const char *tmp;\n\n    if (VIR_ALLOC(file) < 0)\n        return NULL;\n\n    handler->inhibitor(true, handler->opaque);\n\n    if ((path = virJSONValueObjectGetString(object, \"path\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'path' field in JSON document\"));\n        goto error;\n    }\n\n    if ((tmp = virJSONValueObjectGetString(object, \"driver\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'driver' in JSON document\"));\n        goto error;\n    }\n    file->driver = g_strdup(tmp);\n\n    if ((tmp = virJSONValueObjectGetString(object, \"domname\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'domname' in JSON document\"));\n        goto error;\n    }\n    file->domname = g_strdup(tmp);\n\n    if ((domuuid = virJSONValueObjectGetString(object, \"domuuid\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'domuuid' in JSON document\"));\n        goto error;\n    }\n    if (virUUIDParse(domuuid, file->domuuid) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed 'domuuid' in JSON document\"));\n        goto error;\n    }\n\n    if ((file->file = virRotatingFileWriterNew(path,\n                                               handler->max_size,\n                                               handler->max_backups,\n                                               false,\n                                               DEFAULT_MODE)) == NULL)\n        goto error;\n\n    if (virJSONValueObjectGetNumberInt(object, \"pipefd\", &file->pipefd) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'pipefd' in JSON document\"));\n        goto error;\n    }\n    if (virSetInherit(file->pipefd, false) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot enable close-on-exec flag\"));\n        goto error;\n    }\n\n    return file;\n\n error:\n    handler->inhibitor(false, handler->opaque);\n    virLogHandlerLogFileFree(file);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "files",
            "i"
          ],
          "line": 320
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "files"
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed files array\")"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Malformed files array\""
          ],
          "line": 314
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueIsArray",
          "args": [
            "files"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueIsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1010-1014",
          "snippet": "bool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nbool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing files data from JSON file\")"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "object",
            "\"files\""
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerNew",
          "args": [
            "privileged",
            "max_size",
            "max_backups",
            "inhibitor",
            "opaque"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "190-212",
          "snippet": "virLogHandlerPtr\nvirLogHandlerNew(bool privileged,\n                 size_t max_size,\n                 size_t max_backups,\n                 virLogHandlerShutdownInhibitor inhibitor,\n                 void *opaque)\n{\n    virLogHandlerPtr handler;\n\n    if (virLogHandlerInitialize() < 0)\n        return NULL;\n\n    if (!(handler = virObjectLockableNew(virLogHandlerClass)))\n        return NULL;\n\n    handler->privileged = privileged;\n    handler->max_size = max_size;\n    handler->max_backups = max_backups;\n    handler->inhibitor = inhibitor;\n    handler->opaque = opaque;\n\n    return handler;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virLogHandlerClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic virClassPtr virLogHandlerClass;\n\nvirLogHandlerPtr\nvirLogHandlerNew(bool privileged,\n                 size_t max_size,\n                 size_t max_backups,\n                 virLogHandlerShutdownInhibitor inhibitor,\n                 void *opaque)\n{\n    virLogHandlerPtr handler;\n\n    if (virLogHandlerInitialize() < 0)\n        return NULL;\n\n    if (!(handler = virObjectLockableNew(virLogHandlerClass)))\n        return NULL;\n\n    handler->privileged = privileged;\n    handler->max_size = max_size;\n    handler->max_backups = max_backups;\n    handler->inhibitor = inhibitor;\n    handler->opaque = opaque;\n\n    return handler;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nvirLogHandlerPtr\nvirLogHandlerNewPostExecRestart(virJSONValuePtr object,\n                                bool privileged,\n                                size_t max_size,\n                                size_t max_backups,\n                                virLogHandlerShutdownInhibitor inhibitor,\n                                void *opaque)\n{\n    virLogHandlerPtr handler;\n    virJSONValuePtr files;\n    size_t i;\n\n    if (!(handler = virLogHandlerNew(privileged,\n                                     max_size,\n                                     max_backups,\n                                     inhibitor,\n                                     opaque)))\n        return NULL;\n\n    if (!(files = virJSONValueObjectGet(object, \"files\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing files data from JSON file\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(files)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed files array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(files); i++) {\n        virLogHandlerLogFilePtr file;\n        virJSONValuePtr child = virJSONValueArrayGet(files, i);\n\n        if (!(file = virLogHandlerLogFilePostExecRestart(handler, child)))\n            goto error;\n\n        if (VIR_APPEND_ELEMENT_COPY(handler->files, handler->nfiles, file) < 0)\n            goto error;\n\n        if ((file->watch = virEventAddHandle(file->pipefd,\n                                             VIR_EVENT_HANDLE_READABLE,\n                                             virLogHandlerDomainLogFileEvent,\n                                             handler,\n                                             NULL)) < 0) {\n            VIR_DELETE_ELEMENT(handler->files, handler->nfiles - 1, handler->nfiles);\n            goto error;\n        }\n    }\n\n\n    return handler;\n\n error:\n    virObjectUnref(handler);\n    return NULL;\n}"
  },
  {
    "function_name": "virLogHandlerLogFilePostExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "215-284",
    "snippet": "static virLogHandlerLogFilePtr\nvirLogHandlerLogFilePostExecRestart(virLogHandlerPtr handler,\n                                    virJSONValuePtr object)\n{\n    virLogHandlerLogFilePtr file;\n    const char *path;\n    const char *domuuid;\n    const char *tmp;\n\n    if (VIR_ALLOC(file) < 0)\n        return NULL;\n\n    handler->inhibitor(true, handler->opaque);\n\n    if ((path = virJSONValueObjectGetString(object, \"path\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'path' field in JSON document\"));\n        goto error;\n    }\n\n    if ((tmp = virJSONValueObjectGetString(object, \"driver\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'driver' in JSON document\"));\n        goto error;\n    }\n    file->driver = g_strdup(tmp);\n\n    if ((tmp = virJSONValueObjectGetString(object, \"domname\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'domname' in JSON document\"));\n        goto error;\n    }\n    file->domname = g_strdup(tmp);\n\n    if ((domuuid = virJSONValueObjectGetString(object, \"domuuid\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'domuuid' in JSON document\"));\n        goto error;\n    }\n    if (virUUIDParse(domuuid, file->domuuid) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed 'domuuid' in JSON document\"));\n        goto error;\n    }\n\n    if ((file->file = virRotatingFileWriterNew(path,\n                                               handler->max_size,\n                                               handler->max_backups,\n                                               false,\n                                               DEFAULT_MODE)) == NULL)\n        goto error;\n\n    if (virJSONValueObjectGetNumberInt(object, \"pipefd\", &file->pipefd) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'pipefd' in JSON document\"));\n        goto error;\n    }\n    if (virSetInherit(file->pipefd, false) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot enable close-on-exec flag\"));\n        goto error;\n    }\n\n    return file;\n\n error:\n    handler->inhibitor(false, handler->opaque);\n    virLogHandlerLogFileFree(file);\n    return NULL;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DEFAULT_MODE 0600"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLogHandlerLogFileFree",
          "args": [
            "file"
          ],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerLogFileFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "89-104",
          "snippet": "static void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "handler->inhibitor",
          "args": [
            "false",
            "handler->opaque"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Cannot enable close-on-exec flag\")"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot enable close-on-exec flag\""
          ],
          "line": 274
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetInherit",
          "args": [
            "file->pipefd",
            "false"
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "virSetInherit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "104-111",
          "snippet": "int virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing 'pipefd' in JSON document\")"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberInt",
          "args": [
            "object",
            "\"pipefd\"",
            "&file->pipefd"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1331-1342",
          "snippet": "int\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterNew",
          "args": [
            "path",
            "handler->max_size",
            "handler->max_backups",
            "false",
            "DEFAULT_MODE"
          ],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "232-270",
          "snippet": "virRotatingFileWriterPtr\nvirRotatingFileWriterNew(const char *path,\n                         off_t maxlen,\n                         size_t maxbackup,\n                         bool trunc,\n                         mode_t mode)\n{\n    virRotatingFileWriterPtr file;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->basepath = g_strdup(path);\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->mode = mode;\n    file->maxbackup = maxbackup;\n    file->maxlen = maxlen;\n\n    if (trunc &&\n        virRotatingFileWriterDelete(file) < 0)\n        goto error;\n\n    if (!(file->entry = virRotatingFileWriterEntryNew(file->basepath,\n                                                      mode)))\n        goto error;\n\n    return file;\n\n error:\n    virRotatingFileWriterFree(file);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_MAX_MAX_BACKUP 32"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_MAX_MAX_BACKUP 32\n\nvirRotatingFileWriterPtr\nvirRotatingFileWriterNew(const char *path,\n                         off_t maxlen,\n                         size_t maxbackup,\n                         bool trunc,\n                         mode_t mode)\n{\n    virRotatingFileWriterPtr file;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->basepath = g_strdup(path);\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->mode = mode;\n    file->maxbackup = maxbackup;\n    file->maxlen = maxlen;\n\n    if (trunc &&\n        virRotatingFileWriterDelete(file) < 0)\n        goto error;\n\n    if (!(file->entry = virRotatingFileWriterEntryNew(file->basepath,\n                                                      mode)))\n        goto error;\n\n    return file;\n\n error:\n    virRotatingFileWriterFree(file);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed 'domuuid' in JSON document\")"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virUUIDParse",
          "args": [
            "domuuid",
            "file->domuuid"
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDParse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "91-135",
          "snippet": "int\nvirUUIDParse(const char *uuidstr, unsigned char *uuid)\n{\n    const char *cur;\n    size_t i;\n\n    /*\n     * do a liberal scan allowing '-' and ' ' anywhere between character\n     * pairs, and surrounding whitespace, as long as there are exactly\n     * 32 hexadecimal digits the end.\n     */\n    cur = uuidstr;\n    while (g_ascii_isspace(*cur))\n        cur++;\n\n    for (i = 0; i < VIR_UUID_BUFLEN;) {\n        int val;\n        uuid[i] = 0;\n        if (*cur == 0)\n            return -1;\n        if ((*cur == '-') || (*cur == ' ')) {\n            cur++;\n            continue;\n        }\n        if ((val = g_ascii_xdigit_value(*cur)) < 0)\n            return -1;\n        uuid[i] = 16 * val;\n        cur++;\n        if (*cur == 0)\n            return -1;\n        if ((val = g_ascii_xdigit_value(*cur)) < 0)\n            return -1;\n        uuid[i] += val;\n        i++;\n        cur++;\n    }\n\n    while (*cur) {\n        if (!g_ascii_isspace(*cur))\n            return -1;\n        cur++;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nint\nvirUUIDParse(const char *uuidstr, unsigned char *uuid)\n{\n    const char *cur;\n    size_t i;\n\n    /*\n     * do a liberal scan allowing '-' and ' ' anywhere between character\n     * pairs, and surrounding whitespace, as long as there are exactly\n     * 32 hexadecimal digits the end.\n     */\n    cur = uuidstr;\n    while (g_ascii_isspace(*cur))\n        cur++;\n\n    for (i = 0; i < VIR_UUID_BUFLEN;) {\n        int val;\n        uuid[i] = 0;\n        if (*cur == 0)\n            return -1;\n        if ((*cur == '-') || (*cur == ' ')) {\n            cur++;\n            continue;\n        }\n        if ((val = g_ascii_xdigit_value(*cur)) < 0)\n            return -1;\n        uuid[i] = 16 * val;\n        cur++;\n        if (*cur == 0)\n            return -1;\n        if ((val = g_ascii_xdigit_value(*cur)) < 0)\n            return -1;\n        uuid[i] += val;\n        i++;\n        cur++;\n    }\n\n    while (*cur) {\n        if (!g_ascii_isspace(*cur))\n            return -1;\n        cur++;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing 'domuuid' in JSON document\")"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "object",
            "\"domuuid\""
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing 'domname' in JSON document\")"
          ],
          "line": 243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing 'driver' in JSON document\")"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing 'path' field in JSON document\")"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "handler->inhibitor",
          "args": [
            "true",
            "handler->opaque"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "file"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\n#define DEFAULT_MODE 0600\n\nstatic virLogHandlerLogFilePtr\nvirLogHandlerLogFilePostExecRestart(virLogHandlerPtr handler,\n                                    virJSONValuePtr object)\n{\n    virLogHandlerLogFilePtr file;\n    const char *path;\n    const char *domuuid;\n    const char *tmp;\n\n    if (VIR_ALLOC(file) < 0)\n        return NULL;\n\n    handler->inhibitor(true, handler->opaque);\n\n    if ((path = virJSONValueObjectGetString(object, \"path\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'path' field in JSON document\"));\n        goto error;\n    }\n\n    if ((tmp = virJSONValueObjectGetString(object, \"driver\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'driver' in JSON document\"));\n        goto error;\n    }\n    file->driver = g_strdup(tmp);\n\n    if ((tmp = virJSONValueObjectGetString(object, \"domname\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'domname' in JSON document\"));\n        goto error;\n    }\n    file->domname = g_strdup(tmp);\n\n    if ((domuuid = virJSONValueObjectGetString(object, \"domuuid\")) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'domuuid' in JSON document\"));\n        goto error;\n    }\n    if (virUUIDParse(domuuid, file->domuuid) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed 'domuuid' in JSON document\"));\n        goto error;\n    }\n\n    if ((file->file = virRotatingFileWriterNew(path,\n                                               handler->max_size,\n                                               handler->max_backups,\n                                               false,\n                                               DEFAULT_MODE)) == NULL)\n        goto error;\n\n    if (virJSONValueObjectGetNumberInt(object, \"pipefd\", &file->pipefd) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing 'pipefd' in JSON document\"));\n        goto error;\n    }\n    if (virSetInherit(file->pipefd, false) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot enable close-on-exec flag\"));\n        goto error;\n    }\n\n    return file;\n\n error:\n    handler->inhibitor(false, handler->opaque);\n    virLogHandlerLogFileFree(file);\n    return NULL;\n}"
  },
  {
    "function_name": "virLogHandlerNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "190-212",
    "snippet": "virLogHandlerPtr\nvirLogHandlerNew(bool privileged,\n                 size_t max_size,\n                 size_t max_backups,\n                 virLogHandlerShutdownInhibitor inhibitor,\n                 void *opaque)\n{\n    virLogHandlerPtr handler;\n\n    if (virLogHandlerInitialize() < 0)\n        return NULL;\n\n    if (!(handler = virObjectLockableNew(virLogHandlerClass)))\n        return NULL;\n\n    handler->privileged = privileged;\n    handler->max_size = max_size;\n    handler->max_backups = max_backups;\n    handler->inhibitor = inhibitor;\n    handler->opaque = opaque;\n\n    return handler;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virLogHandlerClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectLockableNew",
          "args": [
            "virLogHandlerClass"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLockableNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "256-279",
          "snippet": "void *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nvoid *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerInitialize",
          "args": [],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic virClassPtr virLogHandlerClass;\n\nvirLogHandlerPtr\nvirLogHandlerNew(bool privileged,\n                 size_t max_size,\n                 size_t max_backups,\n                 virLogHandlerShutdownInhibitor inhibitor,\n                 void *opaque)\n{\n    virLogHandlerPtr handler;\n\n    if (virLogHandlerInitialize() < 0)\n        return NULL;\n\n    if (!(handler = virObjectLockableNew(virLogHandlerClass)))\n        return NULL;\n\n    handler->privileged = privileged;\n    handler->max_size = max_size;\n    handler->max_backups = max_backups;\n    handler->inhibitor = inhibitor;\n    handler->opaque = opaque;\n\n    return handler;\n}"
  },
  {
    "function_name": "virLogHandlerDomainLogFileEvent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "138-187",
    "snippet": "static void\nvirLogHandlerDomainLogFileEvent(int watch,\n                                int fd,\n                                int events,\n                                void *opaque)\n{\n    virLogHandlerPtr handler = opaque;\n    virLogHandlerLogFilePtr logfile;\n    char buf[1024];\n    ssize_t len;\n\n    virObjectLock(handler);\n    logfile = virLogHandlerGetLogFileFromWatch(handler, watch);\n    if (!logfile || logfile->pipefd != fd) {\n        virEventRemoveHandle(watch);\n        virObjectUnlock(handler);\n        return;\n    }\n\n    if (logfile->drained) {\n        logfile->drained = false;\n        goto cleanup;\n    }\n\n reread:\n    len = read(fd, buf, sizeof(buf));\n    if (len < 0) {\n        if (errno == EINTR)\n            goto reread;\n\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to read from log pipe\"));\n        goto error;\n    }\n\n    if (virRotatingFileWriterAppend(logfile->file, buf, len) != len)\n        goto error;\n\n    if (events & VIR_EVENT_HANDLE_HANGUP)\n        goto error;\n\n cleanup:\n    virObjectUnlock(handler);\n    return;\n\n error:\n    handler->inhibitor(false, handler->opaque);\n    virLogHandlerLogFileClose(handler, logfile);\n    virObjectUnlock(handler);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "handler"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerLogFileClose",
          "args": [
            "handler",
            "logfile"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerLogFileClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "107-120",
          "snippet": "static void\nvirLogHandlerLogFileClose(virLogHandlerPtr handler,\n                          virLogHandlerLogFilePtr file)\n{\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (handler->files[i] == file) {\n            VIR_DELETE_ELEMENT(handler->files, i, handler->nfiles);\n            virLogHandlerLogFileFree(file);\n            break;\n        }\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerLogFileClose(virLogHandlerPtr handler,\n                          virLogHandlerLogFilePtr file)\n{\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (handler->files[i] == file) {\n            VIR_DELETE_ELEMENT(handler->files, i, handler->nfiles);\n            virLogHandlerLogFileFree(file);\n            break;\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "handler->inhibitor",
          "args": [
            "false",
            "handler->opaque"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterAppend",
          "args": [
            "logfile->file",
            "buf",
            "len"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterAppend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "427-495",
          "snippet": "ssize_t\nvirRotatingFileWriterAppend(virRotatingFileWriterPtr file,\n                            const char *buf,\n                            size_t len)\n{\n    ssize_t ret = 0;\n    size_t i;\n    while (len) {\n        size_t towrite = len;\n        bool forceRollover = false;\n\n        if (file->entry->pos > file->maxlen) {\n            /* If existing file is for some reason larger then max length we\n             * won't write to this file anymore, but we rollover this file.*/\n            forceRollover = true;\n            towrite = 0;\n        } else if ((file->entry->pos + towrite) > file->maxlen) {\n            towrite = file->maxlen - file->entry->pos;\n\n            /*\n             * If there's a newline in the last 80 chars\n             * we're about to write, then break at that\n             * point to avoid splitting lines across\n             * separate files\n             */\n            for (i = 0; i < towrite && i < 80; i++) {\n                if (buf[towrite - i - 1] == '\\n') {\n                    towrite -= i;\n                    forceRollover = true;\n                    break;\n                }\n            }\n        }\n\n        if (towrite) {\n            if (safewrite(file->entry->fd, buf, towrite) != towrite) {\n                virReportSystemError(errno,\n                                     _(\"Unable to write to file %s\"),\n                                     file->basepath);\n                return -1;\n            }\n\n            len -= towrite;\n            buf += towrite;\n            ret += towrite;\n            file->entry->pos += towrite;\n            file->entry->len += towrite;\n        }\n\n        if ((file->entry->pos == file->maxlen && len) ||\n            forceRollover) {\n            virRotatingFileWriterEntryPtr tmp;\n            VIR_DEBUG(\"Hit max size %zu on %s (force=%d)\",\n                      file->maxlen, file->basepath, forceRollover);\n\n            if (virRotatingFileWriterRollover(file) < 0)\n                return -1;\n\n            if (!(tmp = virRotatingFileWriterEntryNew(file->basepath,\n                                                      file->mode)))\n                return -1;\n\n            virRotatingFileWriterEntryFree(file->entry);\n            file->entry = tmp;\n        }\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nssize_t\nvirRotatingFileWriterAppend(virRotatingFileWriterPtr file,\n                            const char *buf,\n                            size_t len)\n{\n    ssize_t ret = 0;\n    size_t i;\n    while (len) {\n        size_t towrite = len;\n        bool forceRollover = false;\n\n        if (file->entry->pos > file->maxlen) {\n            /* If existing file is for some reason larger then max length we\n             * won't write to this file anymore, but we rollover this file.*/\n            forceRollover = true;\n            towrite = 0;\n        } else if ((file->entry->pos + towrite) > file->maxlen) {\n            towrite = file->maxlen - file->entry->pos;\n\n            /*\n             * If there's a newline in the last 80 chars\n             * we're about to write, then break at that\n             * point to avoid splitting lines across\n             * separate files\n             */\n            for (i = 0; i < towrite && i < 80; i++) {\n                if (buf[towrite - i - 1] == '\\n') {\n                    towrite -= i;\n                    forceRollover = true;\n                    break;\n                }\n            }\n        }\n\n        if (towrite) {\n            if (safewrite(file->entry->fd, buf, towrite) != towrite) {\n                virReportSystemError(errno,\n                                     _(\"Unable to write to file %s\"),\n                                     file->basepath);\n                return -1;\n            }\n\n            len -= towrite;\n            buf += towrite;\n            ret += towrite;\n            file->entry->pos += towrite;\n            file->entry->len += towrite;\n        }\n\n        if ((file->entry->pos == file->maxlen && len) ||\n            forceRollover) {\n            virRotatingFileWriterEntryPtr tmp;\n            VIR_DEBUG(\"Hit max size %zu on %s (force=%d)\",\n                      file->maxlen, file->basepath, forceRollover);\n\n            if (virRotatingFileWriterRollover(file) < 0)\n                return -1;\n\n            if (!(tmp = virRotatingFileWriterEntryNew(file->basepath,\n                                                      file->mode)))\n                return -1;\n\n            virRotatingFileWriterEntryFree(file->entry);\n            file->entry = tmp;\n        }\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to read from log pipe\")"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to read from log pipe\""
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "fd",
            "buf",
            "sizeof(buf)"
          ],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDelIOThread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "7811-7841",
          "snippet": "int\nvirDomainDelIOThread(virDomainPtr domain,\n                     unsigned int iothread_id,\n                     unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"iothread_id=%u, flags=0x%x\", iothread_id, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    virCheckReadOnlyGoto(domain->conn->flags, error);\n    virCheckNonZeroArgGoto(iothread_id, error);\n\n    conn = domain->conn;\n\n    if (conn->driver->domainDelIOThread) {\n        int ret;\n        ret = conn->driver->domainDelIOThread(domain, iothread_id, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nint\nvirDomainDelIOThread(virDomainPtr domain,\n                     unsigned int iothread_id,\n                     unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"iothread_id=%u, flags=0x%x\", iothread_id, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    virCheckReadOnlyGoto(domain->conn->flags, error);\n    virCheckNonZeroArgGoto(iothread_id, error);\n\n    conn = domain->conn;\n\n    if (conn->driver->domainDelIOThread) {\n        int ret;\n        ret = conn->driver->domainDelIOThread(domain, iothread_id, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virEventRemoveHandle",
          "args": [
            "watch"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "virEventRemoveHandle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "116-123",
          "snippet": "int\nvirEventRemoveHandle(int watch)\n{\n    if (!removeHandleImpl)\n        return -1;\n\n    return removeHandleImpl(watch);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventRemoveHandleFunc removeHandleImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventRemoveHandleFunc removeHandleImpl;\n\nint\nvirEventRemoveHandle(int watch)\n{\n    if (!removeHandleImpl)\n        return -1;\n\n    return removeHandleImpl(watch);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerGetLogFileFromWatch",
          "args": [
            "handler",
            "watch"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerGetLogFileFromWatch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "123-135",
          "snippet": "static virLogHandlerLogFilePtr\nvirLogHandlerGetLogFileFromWatch(virLogHandlerPtr handler,\n                                 int watch)\n{\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (handler->files[i]->watch == watch)\n            return handler->files[i];\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic virLogHandlerLogFilePtr\nvirLogHandlerGetLogFileFromWatch(virLogHandlerPtr handler,\n                                 int watch)\n{\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (handler->files[i]->watch == watch)\n            return handler->files[i];\n    }\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "handler"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerDomainLogFileEvent(int watch,\n                                int fd,\n                                int events,\n                                void *opaque)\n{\n    virLogHandlerPtr handler = opaque;\n    virLogHandlerLogFilePtr logfile;\n    char buf[1024];\n    ssize_t len;\n\n    virObjectLock(handler);\n    logfile = virLogHandlerGetLogFileFromWatch(handler, watch);\n    if (!logfile || logfile->pipefd != fd) {\n        virEventRemoveHandle(watch);\n        virObjectUnlock(handler);\n        return;\n    }\n\n    if (logfile->drained) {\n        logfile->drained = false;\n        goto cleanup;\n    }\n\n reread:\n    len = read(fd, buf, sizeof(buf));\n    if (len < 0) {\n        if (errno == EINTR)\n            goto reread;\n\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to read from log pipe\"));\n        goto error;\n    }\n\n    if (virRotatingFileWriterAppend(logfile->file, buf, len) != len)\n        goto error;\n\n    if (events & VIR_EVENT_HANDLE_HANGUP)\n        goto error;\n\n cleanup:\n    virObjectUnlock(handler);\n    return;\n\n error:\n    handler->inhibitor(false, handler->opaque);\n    virLogHandlerLogFileClose(handler, logfile);\n    virObjectUnlock(handler);\n}"
  },
  {
    "function_name": "virLogHandlerGetLogFileFromWatch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "123-135",
    "snippet": "static virLogHandlerLogFilePtr\nvirLogHandlerGetLogFileFromWatch(virLogHandlerPtr handler,\n                                 int watch)\n{\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (handler->files[i]->watch == watch)\n            return handler->files[i];\n    }\n\n    return NULL;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic virLogHandlerLogFilePtr\nvirLogHandlerGetLogFileFromWatch(virLogHandlerPtr handler,\n                                 int watch)\n{\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (handler->files[i]->watch == watch)\n            return handler->files[i];\n    }\n\n    return NULL;\n}"
  },
  {
    "function_name": "virLogHandlerLogFileClose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "107-120",
    "snippet": "static void\nvirLogHandlerLogFileClose(virLogHandlerPtr handler,\n                          virLogHandlerLogFilePtr file)\n{\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (handler->files[i] == file) {\n            VIR_DELETE_ELEMENT(handler->files, i, handler->nfiles);\n            virLogHandlerLogFileFree(file);\n            break;\n        }\n    }\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLogHandlerLogFileFree",
          "args": [
            "file"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerLogFileFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "89-104",
          "snippet": "static void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "handler->files",
            "i",
            "handler->nfiles"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerLogFileClose(virLogHandlerPtr handler,\n                          virLogHandlerLogFilePtr file)\n{\n    size_t i;\n\n    for (i = 0; i < handler->nfiles; i++) {\n        if (handler->files[i] == file) {\n            VIR_DELETE_ELEMENT(handler->files, i, handler->nfiles);\n            virLogHandlerLogFileFree(file);\n            break;\n        }\n    }\n}"
  },
  {
    "function_name": "virLogHandlerLogFileFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "89-104",
    "snippet": "static void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "file"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "file->domname"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "file->driver"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virEventRemoveHandle",
          "args": [
            "file->watch"
          ],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "virEventRemoveHandle",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virevent.c",
          "lines": "116-123",
          "snippet": "int\nvirEventRemoveHandle(int watch)\n{\n    if (!removeHandleImpl)\n        return -1;\n\n    return removeHandleImpl(watch);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vireventglib.h\"",
            "#include \"virevent.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virEventRemoveHandleFunc removeHandleImpl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vireventglib.h\"\n#include \"virevent.h\"\n#include <config.h>\n\nstatic virEventRemoveHandleFunc removeHandleImpl;\n\nint\nvirEventRemoveHandle(int watch)\n{\n    if (!removeHandleImpl)\n        return -1;\n\n    return removeHandleImpl(watch);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterFree",
          "args": [
            "file->file"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "607-616",
          "snippet": "void\nvirRotatingFileWriterFree(virRotatingFileWriterPtr file)\n{\n    if (!file)\n        return;\n\n    virRotatingFileWriterEntryFree(file->entry);\n    VIR_FREE(file->basepath);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirRotatingFileWriterFree(virRotatingFileWriterPtr file)\n{\n    if (!file)\n        return;\n\n    virRotatingFileWriterEntryFree(file->entry);\n    VIR_FREE(file->basepath);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "file->pipefd"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic void\nvirLogHandlerLogFileFree(virLogHandlerLogFilePtr file)\n{\n    if (!file)\n        return;\n\n    VIR_FORCE_CLOSE(file->pipefd);\n    virRotatingFileWriterFree(file->file);\n\n    if (file->watch != -1)\n        virEventRemoveHandle(file->watch);\n\n    VIR_FREE(file->driver);\n    VIR_FREE(file->domname);\n    VIR_FREE(file);\n}"
  },
  {
    "function_name": "virLogHandlerOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
    "lines": "77-84",
    "snippet": "static int\nvirLogHandlerOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virLogHandler, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include \"virutil.h\"",
      "#include \"viruuid.h\"",
      "#include \"virrotatingfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"virfile.h\"",
      "#include \"virobject.h\"",
      "#include \"virerror.h\"",
      "#include \"log_handler.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virLogHandler",
            "virClassForObjectLockable()"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virClassForObjectLockable",
          "args": [],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "virClassForObjectLockable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "116-123",
          "snippet": "virClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectLockableClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectLockableClass;\n\nvirClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic int\nvirLogHandlerOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virLogHandler, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}"
  }
]