[
  {
    "function_name": "virVsockAcquireGuestCid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvsock.c",
    "lines": "91-107",
    "snippet": "int\nvirVsockAcquireGuestCid(int fd,\n                        unsigned int *guest_cid)\n{\n    unsigned int cid = VIR_VSOCK_GUEST_CID_MIN;\n\n    for (; virVsockSetGuestCidQuiet(fd, cid) < 0; cid++) {\n        if (errno != EADDRINUSE) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to acquire guest cid\"));\n            return -1;\n        }\n    }\n    *guest_cid = cid;\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virvsock.h\"",
      "# include <linux/vhost.h>",
      "# include <sys/ioctl.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIR_VSOCK_GUEST_CID_MIN 3"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to acquire guest cid\")"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to acquire guest cid\""
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virVsockSetGuestCidQuiet",
          "args": [
            "fd",
            "cid"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "virVsockSetGuestCidQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvsock.c",
          "lines": "49-55",
          "snippet": "static int\nvirVsockSetGuestCidQuiet(int fd G_GNUC_UNUSED,\n                         unsigned int guest_cid G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virvsock.h\"",
            "# include <linux/vhost.h>",
            "# include <sys/ioctl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virvsock.h\"\n# include <linux/vhost.h>\n# include <sys/ioctl.h>\n#include <config.h>\n\nstatic int\nvirVsockSetGuestCidQuiet(int fd G_GNUC_UNUSED,\n                         unsigned int guest_cid G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virvsock.h\"\n# include <linux/vhost.h>\n# include <sys/ioctl.h>\n#include <config.h>\n\n#define VIR_VSOCK_GUEST_CID_MIN 3\n\nint\nvirVsockAcquireGuestCid(int fd,\n                        unsigned int *guest_cid)\n{\n    unsigned int cid = VIR_VSOCK_GUEST_CID_MIN;\n\n    for (; virVsockSetGuestCidQuiet(fd, cid) < 0; cid++) {\n        if (errno != EADDRINUSE) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to acquire guest cid\"));\n            return -1;\n        }\n    }\n    *guest_cid = cid;\n\n    return 0;\n}"
  },
  {
    "function_name": "virVsockSetGuestCid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvsock.c",
    "lines": "67-78",
    "snippet": "int\nvirVsockSetGuestCid(int fd,\n                    unsigned int guest_cid)\n{\n    if (virVsockSetGuestCidQuiet(fd, guest_cid) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to set guest cid\"));\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virvsock.h\"",
      "# include <linux/vhost.h>",
      "# include <sys/ioctl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to set guest cid\")"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to set guest cid\""
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virVsockSetGuestCidQuiet",
          "args": [
            "fd",
            "guest_cid"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "virVsockSetGuestCidQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvsock.c",
          "lines": "49-55",
          "snippet": "static int\nvirVsockSetGuestCidQuiet(int fd G_GNUC_UNUSED,\n                         unsigned int guest_cid G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virvsock.h\"",
            "# include <linux/vhost.h>",
            "# include <sys/ioctl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virvsock.h\"\n# include <linux/vhost.h>\n# include <sys/ioctl.h>\n#include <config.h>\n\nstatic int\nvirVsockSetGuestCidQuiet(int fd G_GNUC_UNUSED,\n                         unsigned int guest_cid G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virvsock.h\"\n# include <linux/vhost.h>\n# include <sys/ioctl.h>\n#include <config.h>\n\nint\nvirVsockSetGuestCid(int fd,\n                    unsigned int guest_cid)\n{\n    if (virVsockSetGuestCidQuiet(fd, guest_cid) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to set guest cid\"));\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virVsockSetGuestCidQuiet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvsock.c",
    "lines": "49-55",
    "snippet": "static int\nvirVsockSetGuestCidQuiet(int fd G_GNUC_UNUSED,\n                         unsigned int guest_cid G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virvsock.h\"",
      "# include <linux/vhost.h>",
      "# include <sys/ioctl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virvsock.h\"\n# include <linux/vhost.h>\n# include <sys/ioctl.h>\n#include <config.h>\n\nstatic int\nvirVsockSetGuestCidQuiet(int fd G_GNUC_UNUSED,\n                         unsigned int guest_cid G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
  },
  {
    "function_name": "virVsockSetGuestCidQuiet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvsock.c",
    "lines": "39-46",
    "snippet": "static int\nvirVsockSetGuestCidQuiet(int fd,\n                         unsigned int guest_cid)\n{\n    uint64_t val = guest_cid;\n\n    return ioctl(fd, VHOST_VSOCK_SET_GUEST_CID, &val);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virvsock.h\"",
      "# include <linux/vhost.h>",
      "# include <sys/ioctl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "fd",
            "VHOST_VSOCK_SET_GUEST_CID",
            "&val"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "vir_ioctlsocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "292-308",
          "snippet": "int\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_ioctlsocket(int fd, int cmd, void *arg)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (ioctlsocket(sk, cmd, arg) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virvsock.h\"\n# include <linux/vhost.h>\n# include <sys/ioctl.h>\n#include <config.h>\n\nstatic int\nvirVsockSetGuestCidQuiet(int fd,\n                         unsigned int guest_cid)\n{\n    uint64_t val = guest_cid;\n\n    return ioctl(fd, VHOST_VSOCK_SET_GUEST_CID, &val);\n}"
  }
]