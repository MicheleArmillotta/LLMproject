[
  {
    "function_name": "virStorageBackendMpathRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
    "lines": "272-276",
    "snippet": "int\nvirStorageBackendMpathRegister(void)\n{\n    return virStorageBackendRegister(&virStorageBackendMpath);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_mpath.h\"",
      "#include \"storage_backend.h\"",
      "#include \"storage_conf.h\"",
      "#include \"virerror.h\"",
      "#include <libdevmapper.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virStorageBackend virStorageBackendMpath = {\n    .type = VIR_STORAGE_POOL_MPATH,\n\n    .checkPool = virStorageBackendMpathCheckPool,\n    .refreshPool = virStorageBackendMpathRefreshPool,\n    .uploadVol = virStorageBackendVolUploadLocal,\n    .downloadVol = virStorageBackendVolDownloadLocal,\n    .wipeVol = virStorageBackendVolWipeLocal,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRegister",
          "args": [
            "&virStorageBackendMpath"
          ],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend.c",
          "lines": "153-169",
          "snippet": "int\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}",
          "includes": [
            "# include \"storage_backend_vstorage.h\"",
            "# include \"storage_backend_zfs.h\"",
            "# include \"storage_backend_gluster.h\"",
            "# include \"storage_backend_sheepdog.h\"",
            "# include \"storage_backend_rbd.h\"",
            "# include \"storage_backend_fs.h\"",
            "# include \"storage_backend_disk.h\"",
            "# include \"storage_backend_mpath.h\"",
            "# include \"storage_backend_scsi.h\"",
            "# include \"storage_backend_iscsi_direct.h\"",
            "# include \"storage_backend_iscsi.h\"",
            "# include \"storage_backend_logical.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_STORAGE_BACKENDS_MAX 20"
          ],
          "globals_used": [
            "static virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];",
            "static size_t virStorageBackendsCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include \"storage_backend_vstorage.h\"\n# include \"storage_backend_zfs.h\"\n# include \"storage_backend_gluster.h\"\n# include \"storage_backend_sheepdog.h\"\n# include \"storage_backend_rbd.h\"\n# include \"storage_backend_fs.h\"\n# include \"storage_backend_disk.h\"\n# include \"storage_backend_mpath.h\"\n# include \"storage_backend_scsi.h\"\n# include \"storage_backend_iscsi_direct.h\"\n# include \"storage_backend_iscsi.h\"\n# include \"storage_backend_logical.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"storage_backend.h\"\n#include \"virstoragefile.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\n#define VIR_STORAGE_BACKENDS_MAX 20\n\nstatic virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];\nstatic size_t virStorageBackendsCount;\n\nint\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirStorageBackend virStorageBackendMpath = {\n    .type = VIR_STORAGE_POOL_MPATH,\n\n    .checkPool = virStorageBackendMpathCheckPool,\n    .refreshPool = virStorageBackendMpathRefreshPool,\n    .uploadVol = virStorageBackendVolUploadLocal,\n    .downloadVol = virStorageBackendVolDownloadLocal,\n    .wipeVol = virStorageBackendVolWipeLocal,\n};\n\nint\nvirStorageBackendMpathRegister(void)\n{\n    return virStorageBackendRegister(&virStorageBackendMpath);\n}"
  },
  {
    "function_name": "virStorageBackendMpathRefreshPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
    "lines": "243-258",
    "snippet": "static int\nvirStorageBackendMpathRefreshPool(virStoragePoolObjPtr pool)\n{\n    int retval = 0;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    VIR_DEBUG(\"pool=%p\", pool);\n\n    def->allocation = def->capacity = def->available = 0;\n\n    virWaitForDevices();\n\n    virStorageBackendGetMaps(pool);\n\n    return retval;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_mpath.h\"",
      "#include \"storage_backend.h\"",
      "#include \"storage_conf.h\"",
      "#include \"virerror.h\"",
      "#include <libdevmapper.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendGetMaps",
          "args": [
            "pool"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendGetMaps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
          "lines": "195-230",
          "snippet": "static int\nvirStorageBackendGetMaps(virStoragePoolObjPtr pool)\n{\n    int retval = 0;\n    struct dm_task *dmt = NULL;\n    struct dm_names *names = NULL;\n\n    if (!(dmt = dm_task_create(DM_DEVICE_LIST))) {\n        retval = 1;\n        goto out;\n    }\n\n    dm_task_no_open_count(dmt);\n\n    if (!dm_task_run(dmt)) {\n        retval = 1;\n        goto out;\n    }\n\n    if (!(names = dm_task_get_names(dmt))) {\n        retval = 1;\n        goto out;\n    }\n\n    if (!names->dev) {\n        /* No devices found */\n        goto out;\n    }\n\n    virStorageBackendCreateVols(pool, names);\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n    return retval;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_mpath.h\"",
            "#include \"storage_backend.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virerror.h\"",
            "#include <libdevmapper.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendGetMaps(virStoragePoolObjPtr pool)\n{\n    int retval = 0;\n    struct dm_task *dmt = NULL;\n    struct dm_names *names = NULL;\n\n    if (!(dmt = dm_task_create(DM_DEVICE_LIST))) {\n        retval = 1;\n        goto out;\n    }\n\n    dm_task_no_open_count(dmt);\n\n    if (!dm_task_run(dmt)) {\n        retval = 1;\n        goto out;\n    }\n\n    if (!(names = dm_task_get_names(dmt))) {\n        retval = 1;\n        goto out;\n    }\n\n    if (!names->dev) {\n        /* No devices found */\n        goto out;\n    }\n\n    virStorageBackendCreateVols(pool, names);\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virWaitForDevices",
          "args": [],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "virWaitForDevices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1324-1341",
          "snippet": "void virWaitForDevices(void)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *udev = NULL;\n    int exitstatus;\n\n    if (!(udev = virFindFileInPath(UDEVADM)))\n        return;\n\n    if (!(cmd = virCommandNewArgList(udev, \"settle\", NULL)))\n        return;\n\n    /*\n     * NOTE: we ignore errors here; this is just to make sure that any device\n     * nodes that are being created finish before we try to scan them.\n     */\n    ignore_value(virCommandRun(cmd, &exitstatus));\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid virWaitForDevices(void)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *udev = NULL;\n    int exitstatus;\n\n    if (!(udev = virFindFileInPath(UDEVADM)))\n        return;\n\n    if (!(cmd = virCommandNewArgList(udev, \"settle\", NULL)))\n        return;\n\n    /*\n     * NOTE: we ignore errors here; this is just to make sure that any device\n     * nodes that are being created finish before we try to scan them.\n     */\n    ignore_value(virCommandRun(cmd, &exitstatus));\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"pool=%p\"",
            "pool"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 247
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendMpathRefreshPool(virStoragePoolObjPtr pool)\n{\n    int retval = 0;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    VIR_DEBUG(\"pool=%p\", pool);\n\n    def->allocation = def->capacity = def->available = 0;\n\n    virWaitForDevices();\n\n    virStorageBackendGetMaps(pool);\n\n    return retval;\n}"
  },
  {
    "function_name": "virStorageBackendMpathCheckPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
    "lines": "232-239",
    "snippet": "static int\nvirStorageBackendMpathCheckPool(virStoragePoolObjPtr pool G_GNUC_UNUSED,\n                                bool *isActive)\n{\n    *isActive = virFileExists(\"/dev/mapper\") ||\n                virFileExists(\"/dev/mpath\");\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_mpath.h\"",
      "#include \"storage_backend.h\"",
      "#include \"storage_conf.h\"",
      "#include \"virerror.h\"",
      "#include <libdevmapper.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "\"/dev/mpath\""
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendMpathCheckPool(virStoragePoolObjPtr pool G_GNUC_UNUSED,\n                                bool *isActive)\n{\n    *isActive = virFileExists(\"/dev/mapper\") ||\n                virFileExists(\"/dev/mpath\");\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendGetMaps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
    "lines": "195-230",
    "snippet": "static int\nvirStorageBackendGetMaps(virStoragePoolObjPtr pool)\n{\n    int retval = 0;\n    struct dm_task *dmt = NULL;\n    struct dm_names *names = NULL;\n\n    if (!(dmt = dm_task_create(DM_DEVICE_LIST))) {\n        retval = 1;\n        goto out;\n    }\n\n    dm_task_no_open_count(dmt);\n\n    if (!dm_task_run(dmt)) {\n        retval = 1;\n        goto out;\n    }\n\n    if (!(names = dm_task_get_names(dmt))) {\n        retval = 1;\n        goto out;\n    }\n\n    if (!names->dev) {\n        /* No devices found */\n        goto out;\n    }\n\n    virStorageBackendCreateVols(pool, names);\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n    return retval;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_mpath.h\"",
      "#include \"storage_backend.h\"",
      "#include \"storage_conf.h\"",
      "#include \"virerror.h\"",
      "#include <libdevmapper.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dm_task_destroy",
          "args": [
            "dmt"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendCreateVols",
          "args": [
            "pool",
            "names"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendCreateVols",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
          "lines": "150-192",
          "snippet": "static int\nvirStorageBackendCreateVols(virStoragePoolObjPtr pool,\n                            struct dm_names *names)\n{\n    int is_mpath = 0;\n    uint32_t minor = -1;\n    uint32_t next;\n    g_autofree char *map_device = NULL;\n\n    do {\n        is_mpath = virStorageBackendIsMultipath(names->name);\n\n        if (is_mpath < 0)\n            return -1;\n\n        if (is_mpath == 1) {\n\n            map_device = g_strdup_printf(\"mapper/%s\", names->name);\n\n            if (virStorageBackendGetMinorNumber(names->name, &minor) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to get %s minor number\"),\n                               names->name);\n                return -1;\n            }\n\n            if (virStorageBackendMpathNewVol(pool, minor, map_device) < 0)\n                return -1;\n\n            VIR_FREE(map_device);\n        }\n\n        /* Given the way libdevmapper returns its data, I don't see\n         * any way to avoid this series of casts. */\n        VIR_WARNINGS_NO_CAST_ALIGN\n        next = names->next;\n        names = (struct dm_names *)(((char *)names) + next);\n        VIR_WARNINGS_RESET\n\n    } while (next);\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_mpath.h\"",
            "#include \"storage_backend.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virerror.h\"",
            "#include <libdevmapper.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendCreateVols(virStoragePoolObjPtr pool,\n                            struct dm_names *names)\n{\n    int is_mpath = 0;\n    uint32_t minor = -1;\n    uint32_t next;\n    g_autofree char *map_device = NULL;\n\n    do {\n        is_mpath = virStorageBackendIsMultipath(names->name);\n\n        if (is_mpath < 0)\n            return -1;\n\n        if (is_mpath == 1) {\n\n            map_device = g_strdup_printf(\"mapper/%s\", names->name);\n\n            if (virStorageBackendGetMinorNumber(names->name, &minor) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to get %s minor number\"),\n                               names->name);\n                return -1;\n            }\n\n            if (virStorageBackendMpathNewVol(pool, minor, map_device) < 0)\n                return -1;\n\n            VIR_FREE(map_device);\n        }\n\n        /* Given the way libdevmapper returns its data, I don't see\n         * any way to avoid this series of casts. */\n        VIR_WARNINGS_NO_CAST_ALIGN\n        next = names->next;\n        names = (struct dm_names *)(((char *)names) + next);\n        VIR_WARNINGS_RESET\n\n    } while (next);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dm_task_get_names",
          "args": [
            "dmt"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_run",
          "args": [
            "dmt"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_no_open_count",
          "args": [
            "dmt"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_create",
          "args": [
            "DM_DEVICE_LIST"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendGetMaps(virStoragePoolObjPtr pool)\n{\n    int retval = 0;\n    struct dm_task *dmt = NULL;\n    struct dm_names *names = NULL;\n\n    if (!(dmt = dm_task_create(DM_DEVICE_LIST))) {\n        retval = 1;\n        goto out;\n    }\n\n    dm_task_no_open_count(dmt);\n\n    if (!dm_task_run(dmt)) {\n        retval = 1;\n        goto out;\n    }\n\n    if (!(names = dm_task_get_names(dmt))) {\n        retval = 1;\n        goto out;\n    }\n\n    if (!names->dev) {\n        /* No devices found */\n        goto out;\n    }\n\n    virStorageBackendCreateVols(pool, names);\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n    return retval;\n}"
  },
  {
    "function_name": "virStorageBackendCreateVols",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
    "lines": "150-192",
    "snippet": "static int\nvirStorageBackendCreateVols(virStoragePoolObjPtr pool,\n                            struct dm_names *names)\n{\n    int is_mpath = 0;\n    uint32_t minor = -1;\n    uint32_t next;\n    g_autofree char *map_device = NULL;\n\n    do {\n        is_mpath = virStorageBackendIsMultipath(names->name);\n\n        if (is_mpath < 0)\n            return -1;\n\n        if (is_mpath == 1) {\n\n            map_device = g_strdup_printf(\"mapper/%s\", names->name);\n\n            if (virStorageBackendGetMinorNumber(names->name, &minor) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to get %s minor number\"),\n                               names->name);\n                return -1;\n            }\n\n            if (virStorageBackendMpathNewVol(pool, minor, map_device) < 0)\n                return -1;\n\n            VIR_FREE(map_device);\n        }\n\n        /* Given the way libdevmapper returns its data, I don't see\n         * any way to avoid this series of casts. */\n        VIR_WARNINGS_NO_CAST_ALIGN\n        next = names->next;\n        names = (struct dm_names *)(((char *)names) + next);\n        VIR_WARNINGS_RESET\n\n    } while (next);\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_mpath.h\"",
      "#include \"storage_backend.h\"",
      "#include \"storage_conf.h\"",
      "#include \"virerror.h\"",
      "#include <libdevmapper.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "map_device"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendMpathNewVol",
          "args": [
            "pool",
            "minor",
            "map_device"
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendMpathNewVol",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
          "lines": "44-77",
          "snippet": "static int\nvirStorageBackendMpathNewVol(virStoragePoolObjPtr pool,\n                             const int devnum,\n                             const char *dev)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autoptr(virStorageVolDef) vol = NULL;\n\n    if (VIR_ALLOC(vol) < 0)\n        return -1;\n\n    vol->type = VIR_STORAGE_VOL_BLOCK;\n\n    (vol->name) = g_strdup_printf(\"dm-%u\", devnum);\n\n    vol->target.path = g_strdup_printf(\"/dev/%s\", dev);\n\n    if (virStorageBackendUpdateVolInfo(vol, true,\n                                       VIR_STORAGE_VOL_OPEN_DEFAULT, 0) < 0) {\n        return -1;\n    }\n\n    /* XXX should use logical unit's UUID instead */\n    vol->key = g_strdup(vol->target.path);\n\n    if (virStoragePoolObjAddVol(pool, vol) < 0)\n        return -1;\n\n    def->capacity += vol->target.capacity;\n    def->allocation += vol->target.allocation;\n    vol = NULL;\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_mpath.h\"",
            "#include \"storage_backend.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virerror.h\"",
            "#include <libdevmapper.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendMpathNewVol(virStoragePoolObjPtr pool,\n                             const int devnum,\n                             const char *dev)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autoptr(virStorageVolDef) vol = NULL;\n\n    if (VIR_ALLOC(vol) < 0)\n        return -1;\n\n    vol->type = VIR_STORAGE_VOL_BLOCK;\n\n    (vol->name) = g_strdup_printf(\"dm-%u\", devnum);\n\n    vol->target.path = g_strdup_printf(\"/dev/%s\", dev);\n\n    if (virStorageBackendUpdateVolInfo(vol, true,\n                                       VIR_STORAGE_VOL_OPEN_DEFAULT, 0) < 0) {\n        return -1;\n    }\n\n    /* XXX should use logical unit's UUID instead */\n    vol->key = g_strdup(vol->target.path);\n\n    if (virStoragePoolObjAddVol(pool, vol) < 0)\n        return -1;\n\n    def->capacity += vol->target.capacity;\n    def->allocation += vol->target.allocation;\n    vol = NULL;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to get %s minor number\")",
            "names->name"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to get %s minor number\""
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendGetMinorNumber",
          "args": [
            "names->name",
            "&minor"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendGetMinorNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
          "lines": "120-147",
          "snippet": "static int\nvirStorageBackendGetMinorNumber(const char *dev_name, uint32_t *minor)\n{\n    int ret = -1;\n    struct dm_task *dmt;\n    struct dm_info info;\n\n    if (!(dmt = dm_task_create(DM_DEVICE_INFO)))\n        goto out;\n\n    if (!dm_task_set_name(dmt, dev_name))\n        goto out;\n\n    if (!dm_task_run(dmt))\n        goto out;\n\n    if (!dm_task_get_info(dmt, &info))\n        goto out;\n\n    *minor = info.minor;\n    ret = 0;\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_mpath.h\"",
            "#include \"storage_backend.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virerror.h\"",
            "#include <libdevmapper.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendGetMinorNumber(const char *dev_name, uint32_t *minor)\n{\n    int ret = -1;\n    struct dm_task *dmt;\n    struct dm_info info;\n\n    if (!(dmt = dm_task_create(DM_DEVICE_INFO)))\n        goto out;\n\n    if (!dm_task_set_name(dmt, dev_name))\n        goto out;\n\n    if (!dm_task_run(dmt))\n        goto out;\n\n    if (!dm_task_get_info(dmt, &info))\n        goto out;\n\n    *minor = info.minor;\n    ret = 0;\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendIsMultipath",
          "args": [
            "names->name"
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendIsMultipath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
          "lines": "80-117",
          "snippet": "static int\nvirStorageBackendIsMultipath(const char *dev_name)\n{\n    int ret = 0;\n    struct dm_task *dmt = NULL;\n    void *next = NULL;\n    uint64_t start, length;\n    char *target_type = NULL;\n    char *params = NULL;\n\n    dmt = dm_task_create(DM_DEVICE_TABLE);\n    if (dmt == NULL) {\n        ret = -1;\n        goto out;\n    }\n\n    if (dm_task_set_name(dmt, dev_name) == 0) {\n        ret = -1;\n        goto out;\n    }\n\n    dm_task_no_open_count(dmt);\n\n    if (!dm_task_run(dmt)) {\n        ret = -1;\n        goto out;\n    }\n\n    dm_get_next_target(dmt, next, &start, &length, &target_type, &params);\n\n    if (STREQ_NULLABLE(target_type, \"multipath\"))\n        ret = 1;\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_mpath.h\"",
            "#include \"storage_backend.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virerror.h\"",
            "#include <libdevmapper.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendIsMultipath(const char *dev_name)\n{\n    int ret = 0;\n    struct dm_task *dmt = NULL;\n    void *next = NULL;\n    uint64_t start, length;\n    char *target_type = NULL;\n    char *params = NULL;\n\n    dmt = dm_task_create(DM_DEVICE_TABLE);\n    if (dmt == NULL) {\n        ret = -1;\n        goto out;\n    }\n\n    if (dm_task_set_name(dmt, dev_name) == 0) {\n        ret = -1;\n        goto out;\n    }\n\n    dm_task_no_open_count(dmt);\n\n    if (!dm_task_run(dmt)) {\n        ret = -1;\n        goto out;\n    }\n\n    dm_get_next_target(dmt, next, &start, &length, &target_type, &params);\n\n    if (STREQ_NULLABLE(target_type, \"multipath\"))\n        ret = 1;\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendCreateVols(virStoragePoolObjPtr pool,\n                            struct dm_names *names)\n{\n    int is_mpath = 0;\n    uint32_t minor = -1;\n    uint32_t next;\n    g_autofree char *map_device = NULL;\n\n    do {\n        is_mpath = virStorageBackendIsMultipath(names->name);\n\n        if (is_mpath < 0)\n            return -1;\n\n        if (is_mpath == 1) {\n\n            map_device = g_strdup_printf(\"mapper/%s\", names->name);\n\n            if (virStorageBackendGetMinorNumber(names->name, &minor) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to get %s minor number\"),\n                               names->name);\n                return -1;\n            }\n\n            if (virStorageBackendMpathNewVol(pool, minor, map_device) < 0)\n                return -1;\n\n            VIR_FREE(map_device);\n        }\n\n        /* Given the way libdevmapper returns its data, I don't see\n         * any way to avoid this series of casts. */\n        VIR_WARNINGS_NO_CAST_ALIGN\n        next = names->next;\n        names = (struct dm_names *)(((char *)names) + next);\n        VIR_WARNINGS_RESET\n\n    } while (next);\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendGetMinorNumber",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
    "lines": "120-147",
    "snippet": "static int\nvirStorageBackendGetMinorNumber(const char *dev_name, uint32_t *minor)\n{\n    int ret = -1;\n    struct dm_task *dmt;\n    struct dm_info info;\n\n    if (!(dmt = dm_task_create(DM_DEVICE_INFO)))\n        goto out;\n\n    if (!dm_task_set_name(dmt, dev_name))\n        goto out;\n\n    if (!dm_task_run(dmt))\n        goto out;\n\n    if (!dm_task_get_info(dmt, &info))\n        goto out;\n\n    *minor = info.minor;\n    ret = 0;\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_mpath.h\"",
      "#include \"storage_backend.h\"",
      "#include \"storage_conf.h\"",
      "#include \"virerror.h\"",
      "#include <libdevmapper.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dm_task_destroy",
          "args": [
            "dmt"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_get_info",
          "args": [
            "dmt",
            "&info"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_run",
          "args": [
            "dmt"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_set_name",
          "args": [
            "dmt",
            "dev_name"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_create",
          "args": [
            "DM_DEVICE_INFO"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendGetMinorNumber(const char *dev_name, uint32_t *minor)\n{\n    int ret = -1;\n    struct dm_task *dmt;\n    struct dm_info info;\n\n    if (!(dmt = dm_task_create(DM_DEVICE_INFO)))\n        goto out;\n\n    if (!dm_task_set_name(dmt, dev_name))\n        goto out;\n\n    if (!dm_task_run(dmt))\n        goto out;\n\n    if (!dm_task_get_info(dmt, &info))\n        goto out;\n\n    *minor = info.minor;\n    ret = 0;\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendIsMultipath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
    "lines": "80-117",
    "snippet": "static int\nvirStorageBackendIsMultipath(const char *dev_name)\n{\n    int ret = 0;\n    struct dm_task *dmt = NULL;\n    void *next = NULL;\n    uint64_t start, length;\n    char *target_type = NULL;\n    char *params = NULL;\n\n    dmt = dm_task_create(DM_DEVICE_TABLE);\n    if (dmt == NULL) {\n        ret = -1;\n        goto out;\n    }\n\n    if (dm_task_set_name(dmt, dev_name) == 0) {\n        ret = -1;\n        goto out;\n    }\n\n    dm_task_no_open_count(dmt);\n\n    if (!dm_task_run(dmt)) {\n        ret = -1;\n        goto out;\n    }\n\n    dm_get_next_target(dmt, next, &start, &length, &target_type, &params);\n\n    if (STREQ_NULLABLE(target_type, \"multipath\"))\n        ret = 1;\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_mpath.h\"",
      "#include \"storage_backend.h\"",
      "#include \"storage_conf.h\"",
      "#include \"virerror.h\"",
      "#include <libdevmapper.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dm_task_destroy",
          "args": [
            "dmt"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "target_type",
            "\"multipath\""
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_get_next_target",
          "args": [
            "dmt",
            "next",
            "&start",
            "&length",
            "&target_type",
            "&params"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_run",
          "args": [
            "dmt"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_no_open_count",
          "args": [
            "dmt"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_set_name",
          "args": [
            "dmt",
            "dev_name"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dm_task_create",
          "args": [
            "DM_DEVICE_TABLE"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendIsMultipath(const char *dev_name)\n{\n    int ret = 0;\n    struct dm_task *dmt = NULL;\n    void *next = NULL;\n    uint64_t start, length;\n    char *target_type = NULL;\n    char *params = NULL;\n\n    dmt = dm_task_create(DM_DEVICE_TABLE);\n    if (dmt == NULL) {\n        ret = -1;\n        goto out;\n    }\n\n    if (dm_task_set_name(dmt, dev_name) == 0) {\n        ret = -1;\n        goto out;\n    }\n\n    dm_task_no_open_count(dmt);\n\n    if (!dm_task_run(dmt)) {\n        ret = -1;\n        goto out;\n    }\n\n    dm_get_next_target(dmt, next, &start, &length, &target_type, &params);\n\n    if (STREQ_NULLABLE(target_type, \"multipath\"))\n        ret = 1;\n\n out:\n    if (dmt != NULL)\n        dm_task_destroy(dmt);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendMpathNewVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_mpath.c",
    "lines": "44-77",
    "snippet": "static int\nvirStorageBackendMpathNewVol(virStoragePoolObjPtr pool,\n                             const int devnum,\n                             const char *dev)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autoptr(virStorageVolDef) vol = NULL;\n\n    if (VIR_ALLOC(vol) < 0)\n        return -1;\n\n    vol->type = VIR_STORAGE_VOL_BLOCK;\n\n    (vol->name) = g_strdup_printf(\"dm-%u\", devnum);\n\n    vol->target.path = g_strdup_printf(\"/dev/%s\", dev);\n\n    if (virStorageBackendUpdateVolInfo(vol, true,\n                                       VIR_STORAGE_VOL_OPEN_DEFAULT, 0) < 0) {\n        return -1;\n    }\n\n    /* XXX should use logical unit's UUID instead */\n    vol->key = g_strdup(vol->target.path);\n\n    if (virStoragePoolObjAddVol(pool, vol) < 0)\n        return -1;\n\n    def->capacity += vol->target.capacity;\n    def->allocation += vol->target.allocation;\n    vol = NULL;\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_mpath.h\"",
      "#include \"storage_backend.h\"",
      "#include \"storage_conf.h\"",
      "#include \"virerror.h\"",
      "#include <libdevmapper.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStoragePoolObjAddVol",
          "args": [
            "pool",
            "vol"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjAddVol",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "641-679",
          "snippet": "int\nvirStoragePoolObjAddVol(virStoragePoolObjPtr obj,\n                        virStorageVolDefPtr voldef)\n{\n    virStorageVolObjPtr volobj = NULL;\n    virStorageVolObjListPtr volumes = obj->volumes;\n\n    virObjectRWLockWrite(volumes);\n\n    if (!(volobj = virStorageVolObjNew()))\n        goto error;\n\n    if (virHashAddEntry(volumes->objsKey, voldef->key, volobj) < 0)\n        goto error;\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsName, voldef->name, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsPath, voldef->target.path, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        virHashRemoveEntry(volumes->objsName, voldef->name);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    volobj->voldef = voldef;\n    virObjectRWUnlock(volumes);\n    virStorageVolObjEndAPI(&volobj);\n    return 0;\n\n error:\n    virStorageVolObjEndAPI(&volobj);\n    virObjectRWUnlock(volumes);\n    return -1;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirStoragePoolObjAddVol(virStoragePoolObjPtr obj,\n                        virStorageVolDefPtr voldef)\n{\n    virStorageVolObjPtr volobj = NULL;\n    virStorageVolObjListPtr volumes = obj->volumes;\n\n    virObjectRWLockWrite(volumes);\n\n    if (!(volobj = virStorageVolObjNew()))\n        goto error;\n\n    if (virHashAddEntry(volumes->objsKey, voldef->key, volobj) < 0)\n        goto error;\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsName, voldef->name, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsPath, voldef->target.path, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        virHashRemoveEntry(volumes->objsName, voldef->name);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    volobj->voldef = voldef;\n    virObjectRWUnlock(volumes);\n    virStorageVolObjEndAPI(&volobj);\n    return 0;\n\n error:\n    virStorageVolObjEndAPI(&volobj);\n    virObjectRWUnlock(volumes);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "vol->target.path"
          ],
          "line": 67
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendUpdateVolInfo",
          "args": [
            "vol",
            "true",
            "VIR_STORAGE_VOL_OPEN_DEFAULT",
            "0"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendUpdateVolInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "1781-1805",
          "snippet": "int\nvirStorageBackendUpdateVolInfo(virStorageVolDefPtr vol,\n                               bool withBlockVolFormat,\n                               unsigned int openflags,\n                               unsigned int readflags)\n{\n    int ret;\n\n    if ((ret = storageBackendUpdateVolTargetInfo(vol->type,\n                                                 &vol->target,\n                                                 withBlockVolFormat,\n                                                 openflags, readflags)) < 0)\n        return ret;\n\n    if (virStorageSourceHasBacking(&vol->target) &&\n        (ret = storageBackendUpdateVolTargetInfo(VIR_STORAGE_VOL_FILE,\n                                                 vol->target.backingStore,\n                                                 withBlockVolFormat,\n                                                 VIR_STORAGE_VOL_OPEN_DEFAULT |\n                                                 VIR_STORAGE_VOL_OPEN_NOERROR,\n                                                 readflags)) == -1)\n        return ret;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStorageBackendUpdateVolInfo(virStorageVolDefPtr vol,\n                               bool withBlockVolFormat,\n                               unsigned int openflags,\n                               unsigned int readflags)\n{\n    int ret;\n\n    if ((ret = storageBackendUpdateVolTargetInfo(vol->type,\n                                                 &vol->target,\n                                                 withBlockVolFormat,\n                                                 openflags, readflags)) < 0)\n        return ret;\n\n    if (virStorageSourceHasBacking(&vol->target) &&\n        (ret = storageBackendUpdateVolTargetInfo(VIR_STORAGE_VOL_FILE,\n                                                 vol->target.backingStore,\n                                                 withBlockVolFormat,\n                                                 VIR_STORAGE_VOL_OPEN_DEFAULT |\n                                                 VIR_STORAGE_VOL_OPEN_NOERROR,\n                                                 readflags)) == -1)\n        return ret;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "vol"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_mpath.h\"\n#include \"storage_backend.h\"\n#include \"storage_conf.h\"\n#include \"virerror.h\"\n#include <libdevmapper.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendMpathNewVol(virStoragePoolObjPtr pool,\n                             const int devnum,\n                             const char *dev)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autoptr(virStorageVolDef) vol = NULL;\n\n    if (VIR_ALLOC(vol) < 0)\n        return -1;\n\n    vol->type = VIR_STORAGE_VOL_BLOCK;\n\n    (vol->name) = g_strdup_printf(\"dm-%u\", devnum);\n\n    vol->target.path = g_strdup_printf(\"/dev/%s\", dev);\n\n    if (virStorageBackendUpdateVolInfo(vol, true,\n                                       VIR_STORAGE_VOL_OPEN_DEFAULT, 0) < 0) {\n        return -1;\n    }\n\n    /* XXX should use logical unit's UUID instead */\n    vol->key = g_strdup(vol->target.path);\n\n    if (virStoragePoolObjAddVol(pool, vol) < 0)\n        return -1;\n\n    def->capacity += vol->target.capacity;\n    def->allocation += vol->target.allocation;\n    vol = NULL;\n\n    return 0;\n}"
  }
]