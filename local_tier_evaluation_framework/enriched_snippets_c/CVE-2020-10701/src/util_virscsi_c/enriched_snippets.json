[
  {
    "function_name": "virSCSIDeviceListFind",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "438-453",
    "snippet": "virSCSIDevicePtr\nvirSCSIDeviceListFind(virSCSIDeviceListPtr list,\n                      virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->adapter == dev->adapter &&\n            list->devs[i]->bus == dev->bus &&\n            list->devs[i]->target == dev->target &&\n            list->devs[i]->unit == dev->unit)\n            return list->devs[i];\n    }\n\n    return NULL;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirSCSIDevicePtr\nvirSCSIDeviceListFind(virSCSIDeviceListPtr list,\n                      virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->adapter == dev->adapter &&\n            list->devs[i]->bus == dev->bus &&\n            list->devs[i]->target == dev->target &&\n            list->devs[i]->unit == dev->unit)\n            return list->devs[i];\n    }\n\n    return NULL;\n}"
  },
  {
    "function_name": "virSCSIDeviceListDel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "415-436",
    "snippet": "void\nvirSCSIDeviceListDel(virSCSIDeviceListPtr list,\n                     virSCSIDevicePtr dev,\n                     const char *drvname,\n                     const char *domname)\n{\n    size_t i;\n\n    for (i = 0; i < dev->n_used_by; i++) {\n        if (STREQ_NULLABLE(dev->used_by[i]->drvname, drvname) &&\n            STREQ_NULLABLE(dev->used_by[i]->domname, domname)) {\n            if (dev->n_used_by > 1) {\n                virSCSIDeviceUsedByInfoFree(dev->used_by[i]);\n                VIR_DELETE_ELEMENT(dev->used_by, i, dev->n_used_by);\n            } else {\n                g_autoptr(virSCSIDevice) tmp = NULL;\n                tmp = virSCSIDeviceListSteal(list, dev);\n            }\n            break;\n        }\n    }\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSCSIDeviceListSteal",
          "args": [
            "list",
            "dev"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceListSteal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "394-413",
          "snippet": "virSCSIDevicePtr\nvirSCSIDeviceListSteal(virSCSIDeviceListPtr list,\n                       virSCSIDevicePtr dev)\n{\n    virSCSIDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->adapter == dev->adapter &&\n            list->devs[i]->bus == dev->bus &&\n            list->devs[i]->target == dev->target &&\n            list->devs[i]->unit == dev->unit) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirSCSIDevicePtr\nvirSCSIDeviceListSteal(virSCSIDeviceListPtr list,\n                       virSCSIDevicePtr dev)\n{\n    virSCSIDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->adapter == dev->adapter &&\n            list->devs[i]->bus == dev->bus &&\n            list->devs[i]->target == dev->target &&\n            list->devs[i]->unit == dev->unit) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "dev->used_by",
            "i",
            "dev->n_used_by"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceUsedByInfoFree",
          "args": [
            "dev->used_by[i]"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceUsedByInfoFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "233-239",
          "snippet": "static void\nvirSCSIDeviceUsedByInfoFree(virUsedByInfoPtr used_by)\n{\n    VIR_FREE(used_by->drvname);\n    VIR_FREE(used_by->domname);\n    VIR_FREE(used_by);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void\nvirSCSIDeviceUsedByInfoFree(virUsedByInfoPtr used_by)\n{\n    VIR_FREE(used_by->drvname);\n    VIR_FREE(used_by->domname);\n    VIR_FREE(used_by);\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "dev->used_by[i]->domname",
            "domname"
          ],
          "line": 425
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "dev->used_by[i]->drvname",
            "drvname"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirSCSIDeviceListDel(virSCSIDeviceListPtr list,\n                     virSCSIDevicePtr dev,\n                     const char *drvname,\n                     const char *domname)\n{\n    size_t i;\n\n    for (i = 0; i < dev->n_used_by; i++) {\n        if (STREQ_NULLABLE(dev->used_by[i]->drvname, drvname) &&\n            STREQ_NULLABLE(dev->used_by[i]->domname, domname)) {\n            if (dev->n_used_by > 1) {\n                virSCSIDeviceUsedByInfoFree(dev->used_by[i]);\n                VIR_DELETE_ELEMENT(dev->used_by, i, dev->n_used_by);\n            } else {\n                g_autoptr(virSCSIDevice) tmp = NULL;\n                tmp = virSCSIDeviceListSteal(list, dev);\n            }\n            break;\n        }\n    }\n}"
  },
  {
    "function_name": "virSCSIDeviceListSteal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "394-413",
    "snippet": "virSCSIDevicePtr\nvirSCSIDeviceListSteal(virSCSIDeviceListPtr list,\n                       virSCSIDevicePtr dev)\n{\n    virSCSIDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->adapter == dev->adapter &&\n            list->devs[i]->bus == dev->bus &&\n            list->devs[i]->target == dev->target &&\n            list->devs[i]->unit == dev->unit) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "list->devs",
            "i",
            "list->count"
          ],
          "line": 407
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirSCSIDevicePtr\nvirSCSIDeviceListSteal(virSCSIDeviceListPtr list,\n                       virSCSIDevicePtr dev)\n{\n    virSCSIDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->adapter == dev->adapter &&\n            list->devs[i]->bus == dev->bus &&\n            list->devs[i]->target == dev->target &&\n            list->devs[i]->unit == dev->unit) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virSCSIDeviceListCount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "388-392",
    "snippet": "size_t\nvirSCSIDeviceListCount(virSCSIDeviceListPtr list)\n{\n    return list->count;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nsize_t\nvirSCSIDeviceListCount(virSCSIDeviceListPtr list)\n{\n    return list->count;\n}"
  },
  {
    "function_name": "virSCSIDeviceListGet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "379-386",
    "snippet": "virSCSIDevicePtr\nvirSCSIDeviceListGet(virSCSIDeviceListPtr list, int idx)\n{\n    if (idx >= list->count || idx < 0)\n        return NULL;\n\n    return list->devs[idx];\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirSCSIDevicePtr\nvirSCSIDeviceListGet(virSCSIDeviceListPtr list, int idx)\n{\n    if (idx >= list->count || idx < 0)\n        return NULL;\n\n    return list->devs[idx];\n}"
  },
  {
    "function_name": "virSCSIDeviceListAdd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "365-377",
    "snippet": "int\nvirSCSIDeviceListAdd(virSCSIDeviceListPtr list,\n                     virSCSIDevicePtr dev)\n{\n    if (virSCSIDeviceListFind(list, dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Device %s already exists\"),\n                       dev->name);\n        return -1;\n    }\n\n    return VIR_APPEND_ELEMENT(list->devs, list->count, dev);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT",
          "args": [
            "list->devs",
            "list->count",
            "dev"
          ],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Device %s already exists\")",
            "dev->name"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Device %s already exists\""
          ],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceListFind",
          "args": [
            "list",
            "dev"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceListFind",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "438-453",
          "snippet": "virSCSIDevicePtr\nvirSCSIDeviceListFind(virSCSIDeviceListPtr list,\n                      virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->adapter == dev->adapter &&\n            list->devs[i]->bus == dev->bus &&\n            list->devs[i]->target == dev->target &&\n            list->devs[i]->unit == dev->unit)\n            return list->devs[i];\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirSCSIDevicePtr\nvirSCSIDeviceListFind(virSCSIDeviceListPtr list,\n                      virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->adapter == dev->adapter &&\n            list->devs[i]->bus == dev->bus &&\n            list->devs[i]->target == dev->target &&\n            list->devs[i]->unit == dev->unit)\n            return list->devs[i];\n    }\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIDeviceListAdd(virSCSIDeviceListPtr list,\n                     virSCSIDevicePtr dev)\n{\n    if (virSCSIDeviceListFind(list, dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Device %s already exists\"),\n                       dev->name);\n        return -1;\n    }\n\n    return VIR_APPEND_ELEMENT(list->devs, list->count, dev);\n}"
  },
  {
    "function_name": "virSCSIDeviceListDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "353-363",
    "snippet": "static void\nvirSCSIDeviceListDispose(void *obj)\n{\n    virSCSIDeviceListPtr list = obj;\n    size_t i;\n\n    for (i = 0; i < list->count; i++)\n        virSCSIDeviceFree(list->devs[i]);\n\n    VIR_FREE(list->devs);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virSCSIDeviceListDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "list->devs"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceFree",
          "args": [
            "list->devs[i]"
          ],
          "line": 360
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "242-257",
          "snippet": "void\nvirSCSIDeviceFree(virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    if (!dev)\n        return;\n\n    VIR_FREE(dev->id);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->sg_path);\n    for (i = 0; i < dev->n_used_by; i++)\n        virSCSIDeviceUsedByInfoFree(dev->used_by[i]);\n    VIR_FREE(dev->used_by);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirSCSIDeviceFree(virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    if (!dev)\n        return;\n\n    VIR_FREE(dev->id);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->sg_path);\n    for (i = 0; i < dev->n_used_by; i++)\n        virSCSIDeviceUsedByInfoFree(dev->used_by[i]);\n    VIR_FREE(dev->used_by);\n    VIR_FREE(dev);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSCSIDeviceListDispose(void *obj);\n\nstatic void\nvirSCSIDeviceListDispose(void *obj)\n{\n    virSCSIDeviceListPtr list = obj;\n    size_t i;\n\n    for (i = 0; i < list->count; i++)\n        virSCSIDeviceFree(list->devs[i]);\n\n    VIR_FREE(list->devs);\n}"
  },
  {
    "function_name": "virSCSIDeviceListNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "339-351",
    "snippet": "virSCSIDeviceListPtr\nvirSCSIDeviceListNew(void)\n{\n    virSCSIDeviceListPtr list;\n\n    if (virSCSIInitialize() < 0)\n        return NULL;\n\n    if (!(list = virObjectLockableNew(virSCSIDeviceListClass)))\n        return NULL;\n\n    return list;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virSCSIDeviceListClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectLockableNew",
          "args": [
            "virSCSIDeviceListClass"
          ],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLockableNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "256-279",
          "snippet": "void *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nvoid *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIInitialize",
          "args": [],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic virClassPtr virSCSIDeviceListClass;\n\nvirSCSIDeviceListPtr\nvirSCSIDeviceListNew(void)\n{\n    virSCSIDeviceListPtr list;\n\n    if (virSCSIInitialize() < 0)\n        return NULL;\n\n    if (!(list = virObjectLockableNew(virSCSIDeviceListClass)))\n        return NULL;\n\n    return list;\n}"
  },
  {
    "function_name": "virSCSIDeviceFileIterate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "331-337",
    "snippet": "int\nvirSCSIDeviceFileIterate(virSCSIDevicePtr dev,\n                         virSCSIDeviceFileActor actor,\n                         void *opaque)\n{\n    return (actor)(dev, dev->sg_path, opaque);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "dev",
            "dev->sg_path",
            "opaque"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIDeviceFileIterate(virSCSIDevicePtr dev,\n                         virSCSIDeviceFileActor actor,\n                         void *opaque)\n{\n    return (actor)(dev, dev->sg_path, opaque);\n}"
  },
  {
    "function_name": "virSCSIDeviceGetShareable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "325-329",
    "snippet": "bool\nvirSCSIDeviceGetShareable(virSCSIDevicePtr dev)\n{\n    return dev->shareable;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nbool\nvirSCSIDeviceGetShareable(virSCSIDevicePtr dev)\n{\n    return dev->shareable;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetReadonly",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "319-323",
    "snippet": "bool\nvirSCSIDeviceGetReadonly(virSCSIDevicePtr dev)\n{\n    return dev->readonly;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nbool\nvirSCSIDeviceGetReadonly(virSCSIDevicePtr dev)\n{\n    return dev->readonly;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetUnit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "313-317",
    "snippet": "unsigned long long\nvirSCSIDeviceGetUnit(virSCSIDevicePtr dev)\n{\n    return dev->unit;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nunsigned long long\nvirSCSIDeviceGetUnit(virSCSIDevicePtr dev)\n{\n    return dev->unit;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetTarget",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "307-311",
    "snippet": "unsigned int\nvirSCSIDeviceGetTarget(virSCSIDevicePtr dev)\n{\n    return dev->target;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nunsigned int\nvirSCSIDeviceGetTarget(virSCSIDevicePtr dev)\n{\n    return dev->target;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetBus",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "301-305",
    "snippet": "unsigned int\nvirSCSIDeviceGetBus(virSCSIDevicePtr dev)\n{\n    return dev->bus;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nunsigned int\nvirSCSIDeviceGetBus(virSCSIDevicePtr dev)\n{\n    return dev->bus;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetAdapter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "295-299",
    "snippet": "unsigned int\nvirSCSIDeviceGetAdapter(virSCSIDevicePtr dev)\n{\n    return dev->adapter;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nunsigned int\nvirSCSIDeviceGetAdapter(virSCSIDevicePtr dev)\n{\n    return dev->adapter;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetPath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "289-293",
    "snippet": "const char *\nvirSCSIDeviceGetPath(virSCSIDevicePtr dev)\n{\n    return dev->sg_path;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nconst char *\nvirSCSIDeviceGetPath(virSCSIDevicePtr dev)\n{\n    return dev->sg_path;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "283-287",
    "snippet": "const char *\nvirSCSIDeviceGetName(virSCSIDevicePtr dev)\n{\n    return dev->name;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nconst char *\nvirSCSIDeviceGetName(virSCSIDevicePtr dev)\n{\n    return dev->name;\n}"
  },
  {
    "function_name": "virSCSIDeviceIsAvailable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "277-281",
    "snippet": "bool\nvirSCSIDeviceIsAvailable(virSCSIDevicePtr dev)\n{\n    return dev->n_used_by == 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nbool\nvirSCSIDeviceIsAvailable(virSCSIDevicePtr dev)\n{\n    return dev->n_used_by == 0;\n}"
  },
  {
    "function_name": "virSCSIDeviceSetUsedBy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "259-275",
    "snippet": "int\nvirSCSIDeviceSetUsedBy(virSCSIDevicePtr dev,\n                       const char *drvname,\n                       const char *domname)\n{\n    g_autoptr(virUsedByInfo) copy = NULL;\n\n    if (VIR_ALLOC(copy) < 0)\n        return -1;\n    copy->drvname = g_strdup(drvname);\n    copy->domname = g_strdup(domname);\n\n    if (VIR_APPEND_ELEMENT(dev->used_by, dev->n_used_by, copy) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT",
          "args": [
            "dev->used_by",
            "dev->n_used_by",
            "copy"
          ],
          "line": 271
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "domname"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "copy"
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIDeviceSetUsedBy(virSCSIDevicePtr dev,\n                       const char *drvname,\n                       const char *domname)\n{\n    g_autoptr(virUsedByInfo) copy = NULL;\n\n    if (VIR_ALLOC(copy) < 0)\n        return -1;\n    copy->drvname = g_strdup(drvname);\n    copy->domname = g_strdup(domname);\n\n    if (VIR_APPEND_ELEMENT(dev->used_by, dev->n_used_by, copy) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virSCSIDeviceFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "242-257",
    "snippet": "void\nvirSCSIDeviceFree(virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    if (!dev)\n        return;\n\n    VIR_FREE(dev->id);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->sg_path);\n    for (i = 0; i < dev->n_used_by; i++)\n        virSCSIDeviceUsedByInfoFree(dev->used_by[i]);\n    VIR_FREE(dev->used_by);\n    VIR_FREE(dev);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by"
          ],
          "line": 255
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceUsedByInfoFree",
          "args": [
            "dev->used_by[i]"
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceUsedByInfoFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "233-239",
          "snippet": "static void\nvirSCSIDeviceUsedByInfoFree(virUsedByInfoPtr used_by)\n{\n    VIR_FREE(used_by->drvname);\n    VIR_FREE(used_by->domname);\n    VIR_FREE(used_by);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void\nvirSCSIDeviceUsedByInfoFree(virUsedByInfoPtr used_by)\n{\n    VIR_FREE(used_by->drvname);\n    VIR_FREE(used_by->domname);\n    VIR_FREE(used_by);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->sg_path"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->name"
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->id"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirSCSIDeviceFree(virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    if (!dev)\n        return;\n\n    VIR_FREE(dev->id);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->sg_path);\n    for (i = 0; i < dev->n_used_by; i++)\n        virSCSIDeviceUsedByInfoFree(dev->used_by[i]);\n    VIR_FREE(dev->used_by);\n    VIR_FREE(dev);\n}"
  },
  {
    "function_name": "virSCSIDeviceUsedByInfoFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "233-239",
    "snippet": "static void\nvirSCSIDeviceUsedByInfoFree(virUsedByInfoPtr used_by)\n{\n    VIR_FREE(used_by->drvname);\n    VIR_FREE(used_by->domname);\n    VIR_FREE(used_by);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "used_by"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "used_by->domname"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "used_by->drvname"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void\nvirSCSIDeviceUsedByInfoFree(virUsedByInfoPtr used_by)\n{\n    VIR_FREE(used_by->drvname);\n    VIR_FREE(used_by->domname);\n    VIR_FREE(used_by);\n}"
  },
  {
    "function_name": "virSCSIDeviceNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "172-231",
    "snippet": "virSCSIDevicePtr\nvirSCSIDeviceNew(const char *sysfs_prefix,\n                 const char *adapter,\n                 unsigned int bus,\n                 unsigned int target,\n                 unsigned long long unit,\n                 bool readonly,\n                 bool shareable)\n{\n    g_autoptr(virSCSIDevice) dev = NULL;\n    g_autofree char *sg = NULL;\n    g_autofree char *vendor_path = NULL;\n    g_autofree char *model_path = NULL;\n    g_autofree char *vendor = NULL;\n    g_autofree char *model = NULL;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus = bus;\n    dev->target = target;\n    dev->unit = unit;\n    dev->readonly = readonly;\n    dev->shareable = shareable;\n\n    if (!(sg = virSCSIDeviceGetSgName(prefix, adapter, bus, target, unit)))\n        return NULL;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &dev->adapter) < 0)\n        return NULL;\n\n    dev->name = g_strdup_printf(\"%d:%u:%u:%llu\", dev->adapter,\n                                dev->bus, dev->target, dev->unit);\n    dev->sg_path = g_strdup_printf(\"%s/%s\",\n                                   sysfs_prefix ? sysfs_prefix : \"/dev\", sg);\n\n    if (!virFileExists(dev->sg_path)) {\n        virReportSystemError(errno,\n                             _(\"SCSI device '%s': could not access %s\"),\n                             dev->name, dev->sg_path);\n        return NULL;\n    }\n\n    vendor_path = g_strdup_printf(\"%s/%s/vendor\", prefix, dev->name);\n    model_path = g_strdup_printf(\"%s/%s/model\", prefix, dev->name);\n\n    if (virFileReadAll(vendor_path, 1024, &vendor) < 0)\n        return NULL;\n\n    if (virFileReadAll(model_path, 1024, &model) < 0)\n        return NULL;\n\n    virTrimSpaces(vendor, NULL);\n    virTrimSpaces(model, NULL);\n\n    dev->id = g_strdup_printf(\"%s:%s\", vendor, model);\n\n    return g_steal_pointer(&dev);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&dev"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s:%s\"",
            "vendor",
            "model"
          ],
          "line": 228
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTrimSpaces",
          "args": [
            "model",
            "NULL"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "virTrimSpaces",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "835-853",
          "snippet": "void\nvirTrimSpaces(char *str, char **endp)\n{\n    char *end;\n\n    if (!endp || !*endp)\n        end = str + strlen(str);\n    else\n        end = *endp;\n    while (end > str && g_ascii_isspace(end[-1]))\n        end--;\n    if (endp) {\n        if (!*endp)\n            *end = '\\0';\n        *endp = end;\n    } else {\n        *end = '\\0';\n    }\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid\nvirTrimSpaces(char *str, char **endp)\n{\n    char *end;\n\n    if (!endp || !*endp)\n        end = str + strlen(str);\n    else\n        end = *endp;\n    while (end > str && g_ascii_isspace(end[-1]))\n        end--;\n    if (endp) {\n        if (!*endp)\n            *end = '\\0';\n        *endp = end;\n    } else {\n        *end = '\\0';\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "model_path",
            "1024",
            "&model"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"SCSI device '%s': could not access %s\")",
            "dev->name",
            "dev->sg_path"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "dev->sg_path"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceGetAdapterId",
          "args": [
            "adapter",
            "&dev->adapter"
          ],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceGetAdapterId",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "89-100",
          "snippet": "static int\nvirSCSIDeviceGetAdapterId(const char *adapter,\n                          unsigned int *adapter_id)\n{\n    if (STRPREFIX(adapter, \"scsi_host\") &&\n        virStrToLong_ui(adapter + strlen(\"scsi_host\"),\n                        NULL, 0, adapter_id) == 0)\n        return 0;\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Cannot parse adapter '%s'\"), adapter);\n    return -1;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic int\nvirSCSIDeviceGetAdapterId(const char *adapter,\n                          unsigned int *adapter_id)\n{\n    if (STRPREFIX(adapter, \"scsi_host\") &&\n        virStrToLong_ui(adapter + strlen(\"scsi_host\"),\n                        NULL, 0, adapter_id) == 0)\n        return 0;\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Cannot parse adapter '%s'\"), adapter);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceGetSgName",
          "args": [
            "prefix",
            "adapter",
            "bus",
            "target",
            "unit"
          ],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceGetSgName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "102-134",
          "snippet": "char *\nvirSCSIDeviceGetSgName(const char *sysfs_prefix,\n                       const char *adapter,\n                       unsigned int bus,\n                       unsigned int target,\n                       unsigned long long unit)\n{\n    DIR *dir = NULL;\n    struct dirent *entry;\n    g_autofree char *path = NULL;\n    char *sg = NULL;\n    unsigned int adapter_id;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &adapter_id) < 0)\n        return NULL;\n\n    path = g_strdup_printf(\"%s/%d:%u:%u:%llu/scsi_generic\", prefix, adapter_id,\n                           bus, target, unit);\n\n    if (virDirOpen(&dir, path) < 0)\n        goto cleanup;\n\n    while (virDirRead(dir, &entry, path) > 0) {\n        /* Assume a single directory entry */\n        sg = g_strdup(entry->d_name);\n        break;\n    }\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    return sg;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\"\n\nchar *\nvirSCSIDeviceGetSgName(const char *sysfs_prefix,\n                       const char *adapter,\n                       unsigned int bus,\n                       unsigned int target,\n                       unsigned long long unit)\n{\n    DIR *dir = NULL;\n    struct dirent *entry;\n    g_autofree char *path = NULL;\n    char *sg = NULL;\n    unsigned int adapter_id;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &adapter_id) < 0)\n        return NULL;\n\n    path = g_strdup_printf(\"%s/%d:%u:%u:%llu/scsi_generic\", prefix, adapter_id,\n                           bus, target, unit);\n\n    if (virDirOpen(&dir, path) < 0)\n        goto cleanup;\n\n    while (virDirRead(dir, &entry, path) > 0) {\n        /* Assume a single directory entry */\n        sg = g_strdup(entry->d_name);\n        break;\n    }\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    return sg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "dev"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\"\n\nvirSCSIDevicePtr\nvirSCSIDeviceNew(const char *sysfs_prefix,\n                 const char *adapter,\n                 unsigned int bus,\n                 unsigned int target,\n                 unsigned long long unit,\n                 bool readonly,\n                 bool shareable)\n{\n    g_autoptr(virSCSIDevice) dev = NULL;\n    g_autofree char *sg = NULL;\n    g_autofree char *vendor_path = NULL;\n    g_autofree char *model_path = NULL;\n    g_autofree char *vendor = NULL;\n    g_autofree char *model = NULL;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus = bus;\n    dev->target = target;\n    dev->unit = unit;\n    dev->readonly = readonly;\n    dev->shareable = shareable;\n\n    if (!(sg = virSCSIDeviceGetSgName(prefix, adapter, bus, target, unit)))\n        return NULL;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &dev->adapter) < 0)\n        return NULL;\n\n    dev->name = g_strdup_printf(\"%d:%u:%u:%llu\", dev->adapter,\n                                dev->bus, dev->target, dev->unit);\n    dev->sg_path = g_strdup_printf(\"%s/%s\",\n                                   sysfs_prefix ? sysfs_prefix : \"/dev\", sg);\n\n    if (!virFileExists(dev->sg_path)) {\n        virReportSystemError(errno,\n                             _(\"SCSI device '%s': could not access %s\"),\n                             dev->name, dev->sg_path);\n        return NULL;\n    }\n\n    vendor_path = g_strdup_printf(\"%s/%s/vendor\", prefix, dev->name);\n    model_path = g_strdup_printf(\"%s/%s/model\", prefix, dev->name);\n\n    if (virFileReadAll(vendor_path, 1024, &vendor) < 0)\n        return NULL;\n\n    if (virFileReadAll(model_path, 1024, &model) < 0)\n        return NULL;\n\n    virTrimSpaces(vendor, NULL);\n    virTrimSpaces(model, NULL);\n\n    dev->id = g_strdup_printf(\"%s:%s\", vendor, model);\n\n    return g_steal_pointer(&dev);\n}"
  },
  {
    "function_name": "virSCSIDeviceGetDevName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "139-170",
    "snippet": "char *\nvirSCSIDeviceGetDevName(const char *sysfs_prefix,\n                        const char *adapter,\n                        unsigned int bus,\n                        unsigned int target,\n                        unsigned long long unit)\n{\n    DIR *dir = NULL;\n    struct dirent *entry;\n    g_autofree char *path = NULL;\n    char *name = NULL;\n    unsigned int adapter_id;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &adapter_id) < 0)\n        return NULL;\n\n    path = g_strdup_printf(\"%s/%d:%u:%u:%llu/block\", prefix, adapter_id, bus,\n                           target, unit);\n\n    if (virDirOpen(&dir, path) < 0)\n        goto cleanup;\n\n    while (virDirRead(dir, &entry, path) > 0) {\n        name = g_strdup(entry->d_name);\n        break;\n    }\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    return name;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DIR_CLOSE",
          "args": [
            "dir"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "entry->d_name"
          ],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDirRead",
          "args": [
            "dir",
            "&entry",
            "path"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "virDirRead",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2940-2954",
          "snippet": "int virDirRead(DIR *dirp, struct dirent **ent, const char *name)\n{\n    do {\n        errno = 0;\n        *ent = readdir(dirp); /* exempt from syntax-check */\n        if (!*ent && errno) {\n            if (name)\n                virReportSystemError(errno, _(\"Unable to read directory '%s'\"),\n                                     name);\n            return -1;\n        }\n    } while (*ent && (STREQ((*ent)->d_name, \".\") ||\n                      STREQ((*ent)->d_name, \"..\")));\n    return !!*ent;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virDirRead(DIR *dirp, struct dirent **ent, const char *name)\n{\n    do {\n        errno = 0;\n        *ent = readdir(dirp); /* exempt from syntax-check */\n        if (!*ent && errno) {\n            if (name)\n                virReportSystemError(errno, _(\"Unable to read directory '%s'\"),\n                                     name);\n            return -1;\n        }\n    } while (*ent && (STREQ((*ent)->d_name, \".\") ||\n                      STREQ((*ent)->d_name, \"..\")));\n    return !!*ent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDirOpen",
          "args": [
            "&dir",
            "path"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "virDirOpenQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2914-2918",
          "snippet": "int\nvirDirOpenQuiet(DIR **dirp, const char *name)\n{\n    return virDirOpenInternal(dirp, name, false, true);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDirOpenQuiet(DIR **dirp, const char *name)\n{\n    return virDirOpenInternal(dirp, name, false, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceGetAdapterId",
          "args": [
            "adapter",
            "&adapter_id"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceGetAdapterId",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "89-100",
          "snippet": "static int\nvirSCSIDeviceGetAdapterId(const char *adapter,\n                          unsigned int *adapter_id)\n{\n    if (STRPREFIX(adapter, \"scsi_host\") &&\n        virStrToLong_ui(adapter + strlen(\"scsi_host\"),\n                        NULL, 0, adapter_id) == 0)\n        return 0;\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Cannot parse adapter '%s'\"), adapter);\n    return -1;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic int\nvirSCSIDeviceGetAdapterId(const char *adapter,\n                          unsigned int *adapter_id)\n{\n    if (STRPREFIX(adapter, \"scsi_host\") &&\n        virStrToLong_ui(adapter + strlen(\"scsi_host\"),\n                        NULL, 0, adapter_id) == 0)\n        return 0;\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Cannot parse adapter '%s'\"), adapter);\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\"\n\nchar *\nvirSCSIDeviceGetDevName(const char *sysfs_prefix,\n                        const char *adapter,\n                        unsigned int bus,\n                        unsigned int target,\n                        unsigned long long unit)\n{\n    DIR *dir = NULL;\n    struct dirent *entry;\n    g_autofree char *path = NULL;\n    char *name = NULL;\n    unsigned int adapter_id;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &adapter_id) < 0)\n        return NULL;\n\n    path = g_strdup_printf(\"%s/%d:%u:%u:%llu/block\", prefix, adapter_id, bus,\n                           target, unit);\n\n    if (virDirOpen(&dir, path) < 0)\n        goto cleanup;\n\n    while (virDirRead(dir, &entry, path) > 0) {\n        name = g_strdup(entry->d_name);\n        break;\n    }\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    return name;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetSgName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "102-134",
    "snippet": "char *\nvirSCSIDeviceGetSgName(const char *sysfs_prefix,\n                       const char *adapter,\n                       unsigned int bus,\n                       unsigned int target,\n                       unsigned long long unit)\n{\n    DIR *dir = NULL;\n    struct dirent *entry;\n    g_autofree char *path = NULL;\n    char *sg = NULL;\n    unsigned int adapter_id;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &adapter_id) < 0)\n        return NULL;\n\n    path = g_strdup_printf(\"%s/%d:%u:%u:%llu/scsi_generic\", prefix, adapter_id,\n                           bus, target, unit);\n\n    if (virDirOpen(&dir, path) < 0)\n        goto cleanup;\n\n    while (virDirRead(dir, &entry, path) > 0) {\n        /* Assume a single directory entry */\n        sg = g_strdup(entry->d_name);\n        break;\n    }\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    return sg;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DIR_CLOSE",
          "args": [
            "dir"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "entry->d_name"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDirRead",
          "args": [
            "dir",
            "&entry",
            "path"
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "virDirRead",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2940-2954",
          "snippet": "int virDirRead(DIR *dirp, struct dirent **ent, const char *name)\n{\n    do {\n        errno = 0;\n        *ent = readdir(dirp); /* exempt from syntax-check */\n        if (!*ent && errno) {\n            if (name)\n                virReportSystemError(errno, _(\"Unable to read directory '%s'\"),\n                                     name);\n            return -1;\n        }\n    } while (*ent && (STREQ((*ent)->d_name, \".\") ||\n                      STREQ((*ent)->d_name, \"..\")));\n    return !!*ent;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virDirRead(DIR *dirp, struct dirent **ent, const char *name)\n{\n    do {\n        errno = 0;\n        *ent = readdir(dirp); /* exempt from syntax-check */\n        if (!*ent && errno) {\n            if (name)\n                virReportSystemError(errno, _(\"Unable to read directory '%s'\"),\n                                     name);\n            return -1;\n        }\n    } while (*ent && (STREQ((*ent)->d_name, \".\") ||\n                      STREQ((*ent)->d_name, \"..\")));\n    return !!*ent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDirOpen",
          "args": [
            "&dir",
            "path"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "virDirOpenQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2914-2918",
          "snippet": "int\nvirDirOpenQuiet(DIR **dirp, const char *name)\n{\n    return virDirOpenInternal(dirp, name, false, true);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDirOpenQuiet(DIR **dirp, const char *name)\n{\n    return virDirOpenInternal(dirp, name, false, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceGetAdapterId",
          "args": [
            "adapter",
            "&adapter_id"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceGetAdapterId",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "89-100",
          "snippet": "static int\nvirSCSIDeviceGetAdapterId(const char *adapter,\n                          unsigned int *adapter_id)\n{\n    if (STRPREFIX(adapter, \"scsi_host\") &&\n        virStrToLong_ui(adapter + strlen(\"scsi_host\"),\n                        NULL, 0, adapter_id) == 0)\n        return 0;\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Cannot parse adapter '%s'\"), adapter);\n    return -1;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic int\nvirSCSIDeviceGetAdapterId(const char *adapter,\n                          unsigned int *adapter_id)\n{\n    if (STRPREFIX(adapter, \"scsi_host\") &&\n        virStrToLong_ui(adapter + strlen(\"scsi_host\"),\n                        NULL, 0, adapter_id) == 0)\n        return 0;\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Cannot parse adapter '%s'\"), adapter);\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\"\n\nchar *\nvirSCSIDeviceGetSgName(const char *sysfs_prefix,\n                       const char *adapter,\n                       unsigned int bus,\n                       unsigned int target,\n                       unsigned long long unit)\n{\n    DIR *dir = NULL;\n    struct dirent *entry;\n    g_autofree char *path = NULL;\n    char *sg = NULL;\n    unsigned int adapter_id;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &adapter_id) < 0)\n        return NULL;\n\n    path = g_strdup_printf(\"%s/%d:%u:%u:%llu/scsi_generic\", prefix, adapter_id,\n                           bus, target, unit);\n\n    if (virDirOpen(&dir, path) < 0)\n        goto cleanup;\n\n    while (virDirRead(dir, &entry, path) > 0) {\n        /* Assume a single directory entry */\n        sg = g_strdup(entry->d_name);\n        break;\n    }\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    return sg;\n}"
  },
  {
    "function_name": "virSCSIDeviceGetAdapterId",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "89-100",
    "snippet": "static int\nvirSCSIDeviceGetAdapterId(const char *adapter,\n                          unsigned int *adapter_id)\n{\n    if (STRPREFIX(adapter, \"scsi_host\") &&\n        virStrToLong_ui(adapter + strlen(\"scsi_host\"),\n                        NULL, 0, adapter_id) == 0)\n        return 0;\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Cannot parse adapter '%s'\"), adapter);\n    return -1;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Cannot parse adapter '%s'\")",
            "adapter"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot parse adapter '%s'\""
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrToLong_ui",
          "args": [
            "adapter + strlen(\"scsi_host\")",
            "NULL",
            "0",
            "adapter_id"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_uip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "444-461",
          "snippet": "int\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "\"scsi_host\""
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "adapter",
            "\"scsi_host\""
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic int\nvirSCSIDeviceGetAdapterId(const char *adapter,\n                          unsigned int *adapter_id)\n{\n    if (STRPREFIX(adapter, \"scsi_host\") &&\n        virStrToLong_ui(adapter + strlen(\"scsi_host\"),\n                        NULL, 0, adapter_id) == 0)\n        return 0;\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Cannot parse adapter '%s'\"), adapter);\n    return -1;\n}"
  },
  {
    "function_name": "virSCSIOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
    "lines": "78-85",
    "snippet": "static int\nvirSCSIOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virSCSIDeviceList, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virerror.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsi.h\"",
      "#include \"virlog.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virSCSIDeviceList",
            "virClassForObjectLockable()"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virClassForObjectLockable",
          "args": [],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "virClassForObjectLockable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "116-123",
          "snippet": "virClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectLockableClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectLockableClass;\n\nvirClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic int\nvirSCSIOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virSCSIDeviceList, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}"
  }
]