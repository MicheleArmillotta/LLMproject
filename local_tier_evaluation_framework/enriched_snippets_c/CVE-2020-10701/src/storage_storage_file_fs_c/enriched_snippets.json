[
  {
    "function_name": "virStorageFileFsRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "230-243",
    "snippet": "int\nvirStorageFileFsRegister(void)\n{\n    if (virStorageFileBackendRegister(&virStorageFileBackendFile) < 0)\n        return -1;\n\n    if (virStorageFileBackendRegister(&virStorageFileBackendBlock) < 0)\n        return -1;\n\n    if (virStorageFileBackendRegister(&virStorageFileBackendDir) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virStorageFileBackend virStorageFileBackendFile = {\n    .type = VIR_STORAGE_TYPE_FILE,\n\n    .backendInit = virStorageFileBackendFileInit,\n    .backendDeinit = virStorageFileBackendFileDeinit,\n\n    .storageFileCreate = virStorageFileBackendFileCreate,\n    .storageFileUnlink = virStorageFileBackendFileUnlink,\n    .storageFileStat = virStorageFileBackendFileStat,\n    .storageFileRead = virStorageFileBackendFileRead,\n    .storageFileAccess = virStorageFileBackendFileAccess,\n    .storageFileChown = virStorageFileBackendFileChown,\n\n    .storageFileGetUniqueIdentifier = virStorageFileBackendFileGetUniqueIdentifier,\n};",
      "virStorageFileBackend virStorageFileBackendBlock = {\n    .type = VIR_STORAGE_TYPE_BLOCK,\n\n    .backendInit = virStorageFileBackendFileInit,\n    .backendDeinit = virStorageFileBackendFileDeinit,\n\n    .storageFileStat = virStorageFileBackendFileStat,\n    .storageFileRead = virStorageFileBackendFileRead,\n    .storageFileAccess = virStorageFileBackendFileAccess,\n    .storageFileChown = virStorageFileBackendFileChown,\n\n    .storageFileGetUniqueIdentifier = virStorageFileBackendFileGetUniqueIdentifier,\n};",
      "virStorageFileBackend virStorageFileBackendDir = {\n    .type = VIR_STORAGE_TYPE_DIR,\n\n    .backendInit = virStorageFileBackendFileInit,\n    .backendDeinit = virStorageFileBackendFileDeinit,\n\n    .storageFileAccess = virStorageFileBackendFileAccess,\n    .storageFileChown = virStorageFileBackendFileChown,\n\n    .storageFileGetUniqueIdentifier = virStorageFileBackendFileGetUniqueIdentifier,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageFileBackendRegister",
          "args": [
            "&virStorageFileBackendDir"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageFileBackendRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstoragefilebackend.c",
          "lines": "88-106",
          "snippet": "int\nvirStorageFileBackendRegister(virStorageFileBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage file backend '%s' protocol '%s'\",\n              virStorageTypeToString(backend->type),\n              virStorageNetProtocolTypeToString(backend->protocol));\n\n    if (virStorageFileBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage file \"\n                         \"backend '%s'\"),\n                       virStorageTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageFileBackends[virStorageFileBackendsCount] = backend;\n    virStorageFileBackendsCount++;\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virstoragefilebackend.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_STORAGE_BACKENDS_MAX 20"
          ],
          "globals_used": [
            "static virStorageFileBackendPtr virStorageFileBackends[VIR_STORAGE_BACKENDS_MAX];",
            "static size_t virStorageFileBackendsCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virstoragefilebackend.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\n#define VIR_STORAGE_BACKENDS_MAX 20\n\nstatic virStorageFileBackendPtr virStorageFileBackends[VIR_STORAGE_BACKENDS_MAX];\nstatic size_t virStorageFileBackendsCount;\n\nint\nvirStorageFileBackendRegister(virStorageFileBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage file backend '%s' protocol '%s'\",\n              virStorageTypeToString(backend->type),\n              virStorageNetProtocolTypeToString(backend->protocol));\n\n    if (virStorageFileBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage file \"\n                         \"backend '%s'\"),\n                       virStorageTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageFileBackends[virStorageFileBackendsCount] = backend;\n    virStorageFileBackendsCount++;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirStorageFileBackend virStorageFileBackendFile = {\n    .type = VIR_STORAGE_TYPE_FILE,\n\n    .backendInit = virStorageFileBackendFileInit,\n    .backendDeinit = virStorageFileBackendFileDeinit,\n\n    .storageFileCreate = virStorageFileBackendFileCreate,\n    .storageFileUnlink = virStorageFileBackendFileUnlink,\n    .storageFileStat = virStorageFileBackendFileStat,\n    .storageFileRead = virStorageFileBackendFileRead,\n    .storageFileAccess = virStorageFileBackendFileAccess,\n    .storageFileChown = virStorageFileBackendFileChown,\n\n    .storageFileGetUniqueIdentifier = virStorageFileBackendFileGetUniqueIdentifier,\n};\nvirStorageFileBackend virStorageFileBackendBlock = {\n    .type = VIR_STORAGE_TYPE_BLOCK,\n\n    .backendInit = virStorageFileBackendFileInit,\n    .backendDeinit = virStorageFileBackendFileDeinit,\n\n    .storageFileStat = virStorageFileBackendFileStat,\n    .storageFileRead = virStorageFileBackendFileRead,\n    .storageFileAccess = virStorageFileBackendFileAccess,\n    .storageFileChown = virStorageFileBackendFileChown,\n\n    .storageFileGetUniqueIdentifier = virStorageFileBackendFileGetUniqueIdentifier,\n};\nvirStorageFileBackend virStorageFileBackendDir = {\n    .type = VIR_STORAGE_TYPE_DIR,\n\n    .backendInit = virStorageFileBackendFileInit,\n    .backendDeinit = virStorageFileBackendFileDeinit,\n\n    .storageFileAccess = virStorageFileBackendFileAccess,\n    .storageFileChown = virStorageFileBackendFileChown,\n\n    .storageFileGetUniqueIdentifier = virStorageFileBackendFileGetUniqueIdentifier,\n};\n\nint\nvirStorageFileFsRegister(void)\n{\n    if (virStorageFileBackendRegister(&virStorageFileBackendFile) < 0)\n        return -1;\n\n    if (virStorageFileBackendRegister(&virStorageFileBackendBlock) < 0)\n        return -1;\n\n    if (virStorageFileBackendRegister(&virStorageFileBackendDir) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageFileBackendFileChown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "176-182",
    "snippet": "static int\nvirStorageFileBackendFileChown(const virStorageSource *src,\n                               uid_t uid,\n                               gid_t gid)\n{\n    return chown(src->path, uid, gid);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "chown",
          "args": [
            "src->path",
            "uid",
            "gid"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendFileChown(const virStorageSource *src,\n                               uid_t uid,\n                               gid_t gid)\n{\n    return chown(src->path, uid, gid);\n}"
  },
  {
    "function_name": "virStorageFileBackendFileAccess",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "167-173",
    "snippet": "static int\nvirStorageFileBackendFileAccess(virStorageSourcePtr src,\n                                int mode)\n{\n    return virFileAccessibleAs(src->path, mode,\n                               src->drv->uid, src->drv->gid);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virFileAccessibleAs",
          "args": [
            "src->path",
            "mode",
            "src->drv->uid",
            "src->drv->gid"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "virFileAccessibleAs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2805-2814",
          "snippet": "int\nvirFileAccessibleAs(const char *path,\n                    int mode,\n                    uid_t uid G_GNUC_UNUSED,\n                    gid_t gid G_GNUC_UNUSED)\n{\n    VIR_WARN(\"Ignoring uid/gid due to WIN32\");\n\n    return access(path, mode);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileAccessibleAs(const char *path,\n                    int mode,\n                    uid_t uid G_GNUC_UNUSED,\n                    gid_t gid G_GNUC_UNUSED)\n{\n    VIR_WARN(\"Ignoring uid/gid due to WIN32\");\n\n    return access(path, mode);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendFileAccess(virStorageSourcePtr src,\n                                int mode)\n{\n    return virFileAccessibleAs(src->path, mode,\n                               src->drv->uid, src->drv->gid);\n}"
  },
  {
    "function_name": "virStorageFileBackendFileGetUniqueIdentifier",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "150-164",
    "snippet": "static const char *\nvirStorageFileBackendFileGetUniqueIdentifier(virStorageSourcePtr src)\n{\n    virStorageFileBackendFsPrivPtr priv = src->drv->priv;\n\n    if (!priv->canonpath) {\n        if (!(priv->canonpath = virFileCanonicalizePath(src->path))) {\n            virReportSystemError(errno, _(\"can't canonicalize path '%s'\"),\n                                 src->path);\n            return NULL;\n        }\n    }\n\n    return priv->canonpath;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"can't canonicalize path '%s'\")",
            "src->path"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"can't canonicalize path '%s'\""
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileCanonicalizePath",
          "args": [
            "src->path"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "virFileCanonicalizePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3299-3310",
          "snippet": "char *\nvirFileCanonicalizePath(const char *path)\n{\n#ifdef WIN32\n    /* Does not resolve symlinks, only expands . & .. & repeated /.\n     * It will never fail, so sanitize errno to indicate success */\n    errno = 0;\n    return g_canonicalize_filename(path, NULL);\n#else\n    return realpath(path, NULL); /* exempt from syntax-check */\n#endif\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirFileCanonicalizePath(const char *path)\n{\n#ifdef WIN32\n    /* Does not resolve symlinks, only expands . & .. & repeated /.\n     * It will never fail, so sanitize errno to indicate success */\n    errno = 0;\n    return g_canonicalize_filename(path, NULL);\n#else\n    return realpath(path, NULL); /* exempt from syntax-check */\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic const char *\nvirStorageFileBackendFileGetUniqueIdentifier(virStorageSourcePtr src)\n{\n    virStorageFileBackendFsPrivPtr priv = src->drv->priv;\n\n    if (!priv->canonpath) {\n        if (!(priv->canonpath = virFileCanonicalizePath(src->path))) {\n            virReportSystemError(errno, _(\"can't canonicalize path '%s'\"),\n                                 src->path);\n            return NULL;\n        }\n    }\n\n    return priv->canonpath;\n}"
  },
  {
    "function_name": "virStorageFileBackendFileRead",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "118-147",
    "snippet": "static ssize_t\nvirStorageFileBackendFileRead(virStorageSourcePtr src,\n                              size_t offset,\n                              size_t len,\n                              char **buf)\n{\n    ssize_t ret = -1;\n    VIR_AUTOCLOSE fd = -1;\n\n    if ((fd = virFileOpenAs(src->path, O_RDONLY, 0,\n                            src->drv->uid, src->drv->gid, 0)) < 0) {\n        virReportSystemError(-fd, _(\"Failed to open file '%s'\"),\n                             src->path);\n        return -1;\n    }\n\n    if (offset > 0) {\n        if (lseek(fd, offset, SEEK_SET) == (off_t) -1) {\n            virReportSystemError(errno, _(\"cannot seek into '%s'\"), src->path);\n            return -1;\n        }\n    }\n\n    if ((ret = virFileReadHeaderFD(fd, len, buf)) < 0) {\n        virReportSystemError(errno, _(\"cannot read header '%s'\"), src->path);\n        return -1;\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot read header '%s'\")",
            "src->path"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot read header '%s'\""
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileReadHeaderFD",
          "args": [
            "fd",
            "len",
            "buf"
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadHeaderFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1377-1392",
          "snippet": "int\nvirFileReadHeaderFD(int fd, int maxlen, char **buf)\n{\n    size_t len;\n    char *s;\n\n    if (maxlen <= 0) {\n        errno = EINVAL;\n        return -1;\n    }\n    s = saferead_lim(fd, maxlen, &len);\n    if (s == NULL)\n        return -1;\n    *buf = s;\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadHeaderFD(int fd, int maxlen, char **buf)\n{\n    size_t len;\n    char *s;\n\n    if (maxlen <= 0) {\n        errno = EINVAL;\n        return -1;\n    }\n    s = saferead_lim(fd, maxlen, &len);\n    if (s == NULL)\n        return -1;\n    *buf = s;\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot seek into '%s'\")",
            "src->path"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "fd",
            "offset",
            "SEEK_SET"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "-fd",
            "_(\"Failed to open file '%s'\")",
            "src->path"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileOpenAs",
          "args": [
            "src->path",
            "O_RDONLY",
            "0",
            "src->drv->uid",
            "src->drv->gid",
            "0"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "virFileOpenAs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2817-2829",
          "snippet": "int\nvirFileOpenAs(const char *path G_GNUC_UNUSED,\n              int openflags G_GNUC_UNUSED,\n              mode_t mode G_GNUC_UNUSED,\n              uid_t uid G_GNUC_UNUSED,\n              gid_t gid G_GNUC_UNUSED,\n              unsigned int flags_unused G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virFileOpenAs is not implemented for WIN32\"));\n\n    return -ENOSYS;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileOpenAs(const char *path G_GNUC_UNUSED,\n              int openflags G_GNUC_UNUSED,\n              mode_t mode G_GNUC_UNUSED,\n              uid_t uid G_GNUC_UNUSED,\n              gid_t gid G_GNUC_UNUSED,\n              unsigned int flags_unused G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virFileOpenAs is not implemented for WIN32\"));\n\n    return -ENOSYS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic ssize_t\nvirStorageFileBackendFileRead(virStorageSourcePtr src,\n                              size_t offset,\n                              size_t len,\n                              char **buf)\n{\n    ssize_t ret = -1;\n    VIR_AUTOCLOSE fd = -1;\n\n    if ((fd = virFileOpenAs(src->path, O_RDONLY, 0,\n                            src->drv->uid, src->drv->gid, 0)) < 0) {\n        virReportSystemError(-fd, _(\"Failed to open file '%s'\"),\n                             src->path);\n        return -1;\n    }\n\n    if (offset > 0) {\n        if (lseek(fd, offset, SEEK_SET) == (off_t) -1) {\n            virReportSystemError(errno, _(\"cannot seek into '%s'\"), src->path);\n            return -1;\n        }\n    }\n\n    if ((ret = virFileReadHeaderFD(fd, len, buf)) < 0) {\n        virReportSystemError(errno, _(\"cannot read header '%s'\"), src->path);\n        return -1;\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virStorageFileBackendFileStat",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "110-115",
    "snippet": "static int\nvirStorageFileBackendFileStat(virStorageSourcePtr src,\n                              struct stat *st)\n{\n    return stat(src->path, st);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "src->path",
            "st"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendFileStat(virStorageSourcePtr src,\n                              struct stat *st)\n{\n    return stat(src->path, st);\n}"
  },
  {
    "function_name": "virStorageFileBackendFileUnlink",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "103-107",
    "snippet": "static int\nvirStorageFileBackendFileUnlink(virStorageSourcePtr src)\n{\n    return unlink(src->path);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "src->path"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendFileUnlink(virStorageSourcePtr src)\n{\n    return unlink(src->path);\n}"
  },
  {
    "function_name": "virStorageFileBackendFileCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "84-100",
    "snippet": "static int\nvirStorageFileBackendFileCreate(virStorageSourcePtr src)\n{\n    mode_t mode = S_IRUSR;\n    VIR_AUTOCLOSE fd = -1;\n\n    if (!src->readonly)\n        mode |= S_IWUSR;\n\n    if ((fd = virFileOpenAs(src->path, O_WRONLY | O_TRUNC | O_CREAT, mode,\n                            src->drv->uid, src->drv->gid, 0)) < 0) {\n        errno = -fd;\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virFileOpenAs",
          "args": [
            "src->path",
            "O_WRONLY | O_TRUNC | O_CREAT",
            "mode",
            "src->drv->uid",
            "src->drv->gid",
            "0"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "virFileOpenAs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2817-2829",
          "snippet": "int\nvirFileOpenAs(const char *path G_GNUC_UNUSED,\n              int openflags G_GNUC_UNUSED,\n              mode_t mode G_GNUC_UNUSED,\n              uid_t uid G_GNUC_UNUSED,\n              gid_t gid G_GNUC_UNUSED,\n              unsigned int flags_unused G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virFileOpenAs is not implemented for WIN32\"));\n\n    return -ENOSYS;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileOpenAs(const char *path G_GNUC_UNUSED,\n              int openflags G_GNUC_UNUSED,\n              mode_t mode G_GNUC_UNUSED,\n              uid_t uid G_GNUC_UNUSED,\n              gid_t gid G_GNUC_UNUSED,\n              unsigned int flags_unused G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virFileOpenAs is not implemented for WIN32\"));\n\n    return -ENOSYS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendFileCreate(virStorageSourcePtr src)\n{\n    mode_t mode = S_IRUSR;\n    VIR_AUTOCLOSE fd = -1;\n\n    if (!src->readonly)\n        mode |= S_IWUSR;\n\n    if ((fd = virFileOpenAs(src->path, O_WRONLY | O_TRUNC | O_CREAT, mode,\n                            src->drv->uid, src->drv->gid, 0)) < 0) {\n        errno = -fd;\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageFileBackendFileInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "65-81",
    "snippet": "static int\nvirStorageFileBackendFileInit(virStorageSourcePtr src)\n{\n    virStorageFileBackendFsPrivPtr priv = NULL;\n\n    VIR_DEBUG(\"initializing FS storage file %p (%s:%s)[%u:%u]\", src,\n              virStorageTypeToString(virStorageSourceGetActualType(src)),\n              src->path,\n              (unsigned int)src->drv->uid, (unsigned int)src->drv->gid);\n\n    if (VIR_ALLOC(priv) < 0)\n        return -1;\n\n    src->drv->priv = priv;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "priv"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"initializing FS storage file %p (%s:%s)[%u:%u]\"",
            "src",
            "virStorageTypeToString(virStorageSourceGetActualType(src))",
            "src->path",
            "(unsigned int)src->drv->uid",
            "(unsigned int)src->drv->gid"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageTypeToString",
          "args": [
            "virStorageSourceGetActualType(src)"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageSourceGetActualType",
          "args": [
            "src"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageSourceGetActualType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstoragefile.c",
          "lines": "2574-2583",
          "snippet": "int\nvirStorageSourceGetActualType(const virStorageSource *def)\n{\n    if (def->type == VIR_STORAGE_TYPE_VOLUME &&\n        def->srcpool &&\n        def->srcpool->actualtype != VIR_STORAGE_TYPE_NONE)\n        return def->srcpool->actualtype;\n\n    return def->type;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsecret.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"virjson.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruri.h\"",
            "#include \"virstring.h\"",
            "#include \"virendian.h\"",
            "#include \"virhash.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virstoragefilebackend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsecret.h\"\n#include \"virstorageencryption.h\"\n#include \"virjson.h\"\n#include \"virbuffer.h\"\n#include \"viruri.h\"\n#include \"virstring.h\"\n#include \"virendian.h\"\n#include \"virhash.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virstoragefilebackend.h\"\n#include <config.h>\n\nint\nvirStorageSourceGetActualType(const virStorageSource *def)\n{\n    if (def->type == VIR_STORAGE_TYPE_VOLUME &&\n        def->srcpool &&\n        def->srcpool->actualtype != VIR_STORAGE_TYPE_NONE)\n        return def->srcpool->actualtype;\n\n    return def->type;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageFileBackendFileInit(virStorageSourcePtr src)\n{\n    virStorageFileBackendFsPrivPtr priv = NULL;\n\n    VIR_DEBUG(\"initializing FS storage file %p (%s:%s)[%u:%u]\", src,\n              virStorageTypeToString(virStorageSourceGetActualType(src)),\n              src->path,\n              (unsigned int)src->drv->uid, (unsigned int)src->drv->gid);\n\n    if (VIR_ALLOC(priv) < 0)\n        return -1;\n\n    src->drv->priv = priv;\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageFileBackendFileDeinit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_file_fs.c",
    "lines": "51-62",
    "snippet": "static void\nvirStorageFileBackendFileDeinit(virStorageSourcePtr src)\n{\n    VIR_DEBUG(\"deinitializing FS storage file %p (%s:%s)\", src,\n              virStorageTypeToString(virStorageSourceGetActualType(src)),\n              src->path);\n\n    virStorageFileBackendFsPrivPtr priv = src->drv->priv;\n\n    VIR_FREE(priv->canonpath);\n    VIR_FREE(priv);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"virstoragefilebackend.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_file_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv->canonpath"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"deinitializing FS storage file %p (%s:%s)\"",
            "src",
            "virStorageTypeToString(virStorageSourceGetActualType(src))",
            "src->path"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageTypeToString",
          "args": [
            "virStorageSourceGetActualType(src)"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageSourceGetActualType",
          "args": [
            "src"
          ],
          "line": 55
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageSourceGetActualType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstoragefile.c",
          "lines": "2574-2583",
          "snippet": "int\nvirStorageSourceGetActualType(const virStorageSource *def)\n{\n    if (def->type == VIR_STORAGE_TYPE_VOLUME &&\n        def->srcpool &&\n        def->srcpool->actualtype != VIR_STORAGE_TYPE_NONE)\n        return def->srcpool->actualtype;\n\n    return def->type;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsecret.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"virjson.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruri.h\"",
            "#include \"virstring.h\"",
            "#include \"virendian.h\"",
            "#include \"virhash.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virstoragefilebackend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsecret.h\"\n#include \"virstorageencryption.h\"\n#include \"virjson.h\"\n#include \"virbuffer.h\"\n#include \"viruri.h\"\n#include \"virstring.h\"\n#include \"virendian.h\"\n#include \"virhash.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virstoragefilebackend.h\"\n#include <config.h>\n\nint\nvirStorageSourceGetActualType(const virStorageSource *def)\n{\n    if (def->type == VIR_STORAGE_TYPE_VOLUME &&\n        def->srcpool &&\n        def->srcpool->actualtype != VIR_STORAGE_TYPE_NONE)\n        return def->srcpool->actualtype;\n\n    return def->type;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstoragefilebackend.h\"\n#include \"storage_util.h\"\n#include \"storage_file_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic void\nvirStorageFileBackendFileDeinit(virStorageSourcePtr src)\n{\n    VIR_DEBUG(\"deinitializing FS storage file %p (%s:%s)\", src,\n              virStorageTypeToString(virStorageSourceGetActualType(src)),\n              src->path);\n\n    virStorageFileBackendFsPrivPtr priv = src->drv->priv;\n\n    VIR_FREE(priv->canonpath);\n    VIR_FREE(priv);\n}"
  }
]