[
  {
    "function_name": "virNWFilterDHCPSnoopReq",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "2180-2190",
    "snippet": "int\nvirNWFilterDHCPSnoopReq(virNWFilterTechDriverPtr techdriver G_GNUC_UNUSED,\n                        virNWFilterBindingDefPtr binding G_GNUC_UNUSED,\n                        virNWFilterDriverStatePtr driver G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"libvirt was not compiled with libpcap and \\\"\"\n                     NWFILTER_VARNAME_CTRL_IP_LEARNING\n                     \"='dhcp'\\\" requires it.\"));\n    return -1;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"libvirt was not compiled with libpcap and \\\"\"\n                     NWFILTER_VARNAME_CTRL_IP_LEARNING\n                     \"='dhcp'\\\" requires it.\")"
          ],
          "line": 2185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"libvirt was not compiled with libpcap and \\\"\"\n                     NWFILTER_VARNAME_CTRL_IP_LEARNING\n                     \"='dhcp'\\\" requires it.\""
          ],
          "line": 2186
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nint\nvirNWFilterDHCPSnoopReq(virNWFilterTechDriverPtr techdriver G_GNUC_UNUSED,\n                        virNWFilterBindingDefPtr binding G_GNUC_UNUSED,\n                        virNWFilterDriverStatePtr driver G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"libvirt was not compiled with libpcap and \\\"\"\n                     NWFILTER_VARNAME_CTRL_IP_LEARNING\n                     \"='dhcp'\\\" requires it.\"));\n    return -1;\n}"
  },
  {
    "function_name": "virNWFilterDHCPSnoopShutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "2174-2178",
    "snippet": "void\nvirNWFilterDHCPSnoopShutdown(void)\n{\n    return;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nvoid\nvirNWFilterDHCPSnoopShutdown(void)\n{\n    return;\n}"
  },
  {
    "function_name": "virNWFilterDHCPSnoopEnd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "2168-2172",
    "snippet": "void\nvirNWFilterDHCPSnoopEnd(const char *ifname G_GNUC_UNUSED)\n{\n    return;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nvoid\nvirNWFilterDHCPSnoopEnd(const char *ifname G_GNUC_UNUSED)\n{\n    return;\n}"
  },
  {
    "function_name": "virNWFilterDHCPSnoopInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "2161-2166",
    "snippet": "int\nvirNWFilterDHCPSnoopInit(void)\n{\n    VIR_DEBUG(\"No DHCP snooping support available\");\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No DHCP snooping support available\""
          ],
          "line": 2164
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nint\nvirNWFilterDHCPSnoopInit(void)\n{\n    VIR_DEBUG(\"No DHCP snooping support available\");\n    return 0;\n}"
  },
  {
    "function_name": "virNWFilterDHCPSnoopShutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "2140-2157",
    "snippet": "void\nvirNWFilterDHCPSnoopShutdown(void)\n{\n    virNWFilterSnoopEndThreads();\n    virNWFilterSnoopJoinThreads();\n\n    virNWFilterSnoopLock();\n\n    virNWFilterSnoopLeaseFileClose();\n    virHashFree(virNWFilterSnoopState.ifnameToKey);\n    virHashFree(virNWFilterSnoopState.snoopReqs);\n\n    virNWFilterSnoopUnlock();\n\n    virNWFilterSnoopActiveLock();\n    virHashFree(virNWFilterSnoopState.active);\n    virNWFilterSnoopActiveUnlock();\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopActiveUnlock",
          "args": [],
          "line": 2156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashFree",
          "args": [
            "virNWFilterSnoopState.active"
          ],
          "line": 2155
        },
        "resolved": true,
        "details": {
          "function_name": "virHashFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "313-337",
          "snippet": "void\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopActiveLock",
          "args": [],
          "line": 2154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 2152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileClose",
          "args": [],
          "line": 2148
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1704-1708",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileClose(void)\n{\n    VIR_FORCE_CLOSE(virNWFilterSnoopState.leaseFD);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileClose(void)\n{\n    VIR_FORCE_CLOSE(virNWFilterSnoopState.leaseFD);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 2146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopJoinThreads",
          "args": [],
          "line": 2144
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopJoinThreads",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1973-1981",
          "snippet": "static void\nvirNWFilterSnoopJoinThreads(void)\n{\n    while (g_atomic_int_get(&virNWFilterSnoopState.nThreads) != 0) {\n        VIR_WARN(\"Waiting for snooping threads to terminate: %u\",\n                 g_atomic_int_get(&virNWFilterSnoopState.nThreads));\n        g_usleep(1000 * 1000);\n    }\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopJoinThreads(void)\n{\n    while (g_atomic_int_get(&virNWFilterSnoopState.nThreads) != 0) {\n        VIR_WARN(\"Waiting for snooping threads to terminate: %u\",\n                 g_atomic_int_get(&virNWFilterSnoopState.nThreads));\n        g_usleep(1000 * 1000);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopEndThreads",
          "args": [],
          "line": 2143
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopEndThreads",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "2024-2032",
          "snippet": "static void\nvirNWFilterSnoopEndThreads(void)\n{\n    virNWFilterSnoopLock();\n    virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                     virNWFilterSnoopRemAllReqIter,\n                     NULL);\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopEndThreads(void)\n{\n    virNWFilterSnoopLock();\n    virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                     virNWFilterSnoopRemAllReqIter,\n                     NULL);\n    virNWFilterSnoopUnlock();\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nvoid\nvirNWFilterDHCPSnoopShutdown(void)\n{\n    virNWFilterSnoopEndThreads();\n    virNWFilterSnoopJoinThreads();\n\n    virNWFilterSnoopLock();\n\n    virNWFilterSnoopLeaseFileClose();\n    virHashFree(virNWFilterSnoopState.ifnameToKey);\n    virHashFree(virNWFilterSnoopState.snoopReqs);\n\n    virNWFilterSnoopUnlock();\n\n    virNWFilterSnoopActiveLock();\n    virHashFree(virNWFilterSnoopState.active);\n    virNWFilterSnoopActiveUnlock();\n}"
  },
  {
    "function_name": "virNWFilterDHCPSnoopEnd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "2084-2138",
    "snippet": "void\nvirNWFilterDHCPSnoopEnd(const char *ifname)\n{\n    char *ifkey = NULL;\n\n    virNWFilterSnoopLock();\n\n    if (!virNWFilterSnoopState.snoopReqs)\n        goto cleanup;\n\n    if (ifname) {\n        ifkey = (char *)virHashLookup(virNWFilterSnoopState.ifnameToKey,\n                                      ifname);\n        if (!ifkey)\n            goto cleanup;\n\n        ignore_value(virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                        ifname));\n    }\n\n    if (ifkey) {\n        virNWFilterSnoopReqPtr req;\n\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"ifkey \\\"%s\\\" has no req\"), ifkey);\n            goto cleanup;\n        }\n\n        /* protect req->binding->portdevname & req->threadkey */\n        virNWFilterSnoopReqLock(req);\n\n        /* keep valid lease req; drop interface association */\n        virNWFilterSnoopCancel(&req->threadkey);\n\n        VIR_FREE(req->binding->portdevname);\n\n        virNWFilterSnoopReqUnlock(req);\n\n        virNWFilterSnoopReqPut(req);\n    } else {                      /* free all of them */\n        virNWFilterSnoopLeaseFileClose();\n\n        virHashRemoveAll(virNWFilterSnoopState.ifnameToKey);\n\n        /* tell the threads to terminate */\n        virNWFilterSnoopEndThreads();\n\n        virNWFilterSnoopLeaseFileLoad();\n    }\n\n cleanup:\n    virNWFilterSnoopUnlock();\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 2137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileLoad",
          "args": [],
          "line": 2133
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileLoad",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1894-1968",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileLoad(void)\n{\n    char line[256], ifkey[VIR_IFKEY_LEN];\n    char ipstr[INET_ADDRSTRLEN], srvstr[INET_ADDRSTRLEN];\n    virNWFilterSnoopIPLease ipl;\n    virNWFilterSnoopReqPtr req;\n    time_t now;\n    FILE *fp;\n    int ln = 0, tmp;\n\n    /* protect the lease file */\n    virNWFilterSnoopLock();\n\n    fp = fopen(LEASEFILE, \"r\");\n    time(&now);\n    while (fp && fgets(line, sizeof(line), fp)) {\n        if (line[strlen(line)-1] != '\\n') {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        ln++;\n        /* key len 54 = \"VMUUID\"+'-'+\"MAC\" */\n        if (sscanf(line, \"%u %54s %15s %15s\", &ipl.timeout,\n                   ifkey, ipstr, srvstr) < 4) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        if (ipl.timeout && ipl.timeout < now)\n            continue;\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            req = virNWFilterSnoopReqNew(ifkey);\n            if (!req)\n               break;\n\n            tmp = virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req);\n\n            if (tmp < 0) {\n                virNWFilterSnoopReqPut(req);\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\"), ifkey);\n                continue;\n            }\n        }\n\n        if (virSocketAddrParseIPv4(&ipl.ipAddress, ipstr) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"line %d corrupt ipaddr \\\"%s\\\"\"),\n                           ln, ipstr);\n            virNWFilterSnoopReqPut(req);\n            continue;\n        }\n        ignore_value(virSocketAddrParseIPv4(&ipl.ipServer, srvstr));\n        ipl.snoopReq = req;\n\n        if (ipl.timeout)\n            virNWFilterSnoopReqLeaseAdd(req, &ipl, false);\n        else\n            virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, false, false);\n\n        virNWFilterSnoopReqPut(req);\n    }\n\n    VIR_FORCE_FCLOSE(fp);\n\n    virNWFilterSnoopLeaseFileRefresh();\n\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileLoad(void)\n{\n    char line[256], ifkey[VIR_IFKEY_LEN];\n    char ipstr[INET_ADDRSTRLEN], srvstr[INET_ADDRSTRLEN];\n    virNWFilterSnoopIPLease ipl;\n    virNWFilterSnoopReqPtr req;\n    time_t now;\n    FILE *fp;\n    int ln = 0, tmp;\n\n    /* protect the lease file */\n    virNWFilterSnoopLock();\n\n    fp = fopen(LEASEFILE, \"r\");\n    time(&now);\n    while (fp && fgets(line, sizeof(line), fp)) {\n        if (line[strlen(line)-1] != '\\n') {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        ln++;\n        /* key len 54 = \"VMUUID\"+'-'+\"MAC\" */\n        if (sscanf(line, \"%u %54s %15s %15s\", &ipl.timeout,\n                   ifkey, ipstr, srvstr) < 4) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        if (ipl.timeout && ipl.timeout < now)\n            continue;\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            req = virNWFilterSnoopReqNew(ifkey);\n            if (!req)\n               break;\n\n            tmp = virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req);\n\n            if (tmp < 0) {\n                virNWFilterSnoopReqPut(req);\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\"), ifkey);\n                continue;\n            }\n        }\n\n        if (virSocketAddrParseIPv4(&ipl.ipAddress, ipstr) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"line %d corrupt ipaddr \\\"%s\\\"\"),\n                           ln, ipstr);\n            virNWFilterSnoopReqPut(req);\n            continue;\n        }\n        ignore_value(virSocketAddrParseIPv4(&ipl.ipServer, srvstr));\n        ipl.snoopReq = req;\n\n        if (ipl.timeout)\n            virNWFilterSnoopReqLeaseAdd(req, &ipl, false);\n        else\n            virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, false, false);\n\n        virNWFilterSnoopReqPut(req);\n    }\n\n    VIR_FORCE_FCLOSE(fp);\n\n    virNWFilterSnoopLeaseFileRefresh();\n\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopEndThreads",
          "args": [],
          "line": 2131
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopEndThreads",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "2024-2032",
          "snippet": "static void\nvirNWFilterSnoopEndThreads(void)\n{\n    virNWFilterSnoopLock();\n    virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                     virNWFilterSnoopRemAllReqIter,\n                     NULL);\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopEndThreads(void)\n{\n    virNWFilterSnoopLock();\n    virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                     virNWFilterSnoopRemAllReqIter,\n                     NULL);\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashRemoveAll",
          "args": [
            "virNWFilterSnoopState.ifnameToKey"
          ],
          "line": 2128
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveAll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "715-721",
          "snippet": "ssize_t\nvirHashRemoveAll(virHashTablePtr table)\n{\n    return virHashRemoveSet(table,\n                            _virHashRemoveAllIter,\n                            NULL);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nssize_t\nvirHashRemoveAll(virHashTablePtr table)\n{\n    return virHashRemoveSet(table,\n                            _virHashRemoveAllIter,\n                            NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileClose",
          "args": [],
          "line": 2126
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1704-1708",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileClose(void)\n{\n    VIR_FORCE_CLOSE(virNWFilterSnoopState.leaseFD);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileClose(void)\n{\n    VIR_FORCE_CLOSE(virNWFilterSnoopState.leaseFD);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqPut",
          "args": [
            "req"
          ],
          "line": 2124
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqPut",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "686-711",
          "snippet": "static void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 2122
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "req->binding->portdevname"
          ],
          "line": 2120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopCancel",
          "args": [
            "&req->threadkey"
          ],
          "line": 2118
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopCancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "309-321",
          "snippet": "static void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 2115
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"ifkey \\\"%s\\\" has no req\")",
            "ifkey"
          ],
          "line": 2109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"ifkey \\\"%s\\\" has no req\""
          ],
          "line": 2110
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqGetByIFKey",
          "args": [
            "ifkey"
          ],
          "line": 2107
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqGetByIFKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "666-680",
          "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                        ifname)"
          ],
          "line": 2100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "virNWFilterSnoopState.ifnameToKey",
            "ifname"
          ],
          "line": 2100
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "virNWFilterSnoopState.ifnameToKey",
            "ifname"
          ],
          "line": 2095
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 2089
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nvoid\nvirNWFilterDHCPSnoopEnd(const char *ifname)\n{\n    char *ifkey = NULL;\n\n    virNWFilterSnoopLock();\n\n    if (!virNWFilterSnoopState.snoopReqs)\n        goto cleanup;\n\n    if (ifname) {\n        ifkey = (char *)virHashLookup(virNWFilterSnoopState.ifnameToKey,\n                                      ifname);\n        if (!ifkey)\n            goto cleanup;\n\n        ignore_value(virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                        ifname));\n    }\n\n    if (ifkey) {\n        virNWFilterSnoopReqPtr req;\n\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"ifkey \\\"%s\\\" has no req\"), ifkey);\n            goto cleanup;\n        }\n\n        /* protect req->binding->portdevname & req->threadkey */\n        virNWFilterSnoopReqLock(req);\n\n        /* keep valid lease req; drop interface association */\n        virNWFilterSnoopCancel(&req->threadkey);\n\n        VIR_FREE(req->binding->portdevname);\n\n        virNWFilterSnoopReqUnlock(req);\n\n        virNWFilterSnoopReqPut(req);\n    } else {                      /* free all of them */\n        virNWFilterSnoopLeaseFileClose();\n\n        virHashRemoveAll(virNWFilterSnoopState.ifnameToKey);\n\n        /* tell the threads to terminate */\n        virNWFilterSnoopEndThreads();\n\n        virNWFilterSnoopLeaseFileLoad();\n    }\n\n cleanup:\n    virNWFilterSnoopUnlock();\n}"
  },
  {
    "function_name": "virNWFilterDHCPSnoopInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "2034-2072",
    "snippet": "int\nvirNWFilterDHCPSnoopInit(void)\n{\n    if (virNWFilterSnoopState.snoopReqs)\n        return 0;\n\n    VIR_DEBUG(\"Initializing DHCP snooping\");\n\n    if (virMutexInitRecursive(&virNWFilterSnoopState.snoopLock) < 0 ||\n        virMutexInit(&virNWFilterSnoopState.activeLock) < 0)\n        return -1;\n\n    virNWFilterSnoopState.ifnameToKey = virHashCreate(0, NULL);\n    virNWFilterSnoopState.active = virHashCreate(0, NULL);\n    virNWFilterSnoopState.snoopReqs =\n        virHashCreate(0, virNWFilterSnoopReqRelease);\n\n    if (!virNWFilterSnoopState.ifnameToKey ||\n        !virNWFilterSnoopState.snoopReqs ||\n        !virNWFilterSnoopState.active)\n        goto err_exit;\n\n    virNWFilterSnoopLeaseFileLoad();\n    virNWFilterSnoopLeaseFileOpen();\n\n    return 0;\n\n err_exit:\n    virHashFree(virNWFilterSnoopState.ifnameToKey);\n    virNWFilterSnoopState.ifnameToKey = NULL;\n\n    virHashFree(virNWFilterSnoopState.snoopReqs);\n    virNWFilterSnoopState.snoopReqs = NULL;\n\n    virHashFree(virNWFilterSnoopState.active);\n    virNWFilterSnoopState.active = NULL;\n\n    return -1;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virHashFree",
          "args": [
            "virNWFilterSnoopState.active"
          ],
          "line": 2068
        },
        "resolved": true,
        "details": {
          "function_name": "virHashFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "313-337",
          "snippet": "void\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileOpen",
          "args": [],
          "line": 2057
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileOpen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1710-1717",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileOpen(void)\n{\n    virNWFilterSnoopLeaseFileClose();\n\n    virNWFilterSnoopState.leaseFD = open(LEASEFILE, O_CREAT|O_RDWR|O_APPEND,\n                                         0644);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileOpen(void)\n{\n    virNWFilterSnoopLeaseFileClose();\n\n    virNWFilterSnoopState.leaseFD = open(LEASEFILE, O_CREAT|O_RDWR|O_APPEND,\n                                         0644);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileLoad",
          "args": [],
          "line": 2056
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileLoad",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1894-1968",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileLoad(void)\n{\n    char line[256], ifkey[VIR_IFKEY_LEN];\n    char ipstr[INET_ADDRSTRLEN], srvstr[INET_ADDRSTRLEN];\n    virNWFilterSnoopIPLease ipl;\n    virNWFilterSnoopReqPtr req;\n    time_t now;\n    FILE *fp;\n    int ln = 0, tmp;\n\n    /* protect the lease file */\n    virNWFilterSnoopLock();\n\n    fp = fopen(LEASEFILE, \"r\");\n    time(&now);\n    while (fp && fgets(line, sizeof(line), fp)) {\n        if (line[strlen(line)-1] != '\\n') {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        ln++;\n        /* key len 54 = \"VMUUID\"+'-'+\"MAC\" */\n        if (sscanf(line, \"%u %54s %15s %15s\", &ipl.timeout,\n                   ifkey, ipstr, srvstr) < 4) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        if (ipl.timeout && ipl.timeout < now)\n            continue;\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            req = virNWFilterSnoopReqNew(ifkey);\n            if (!req)\n               break;\n\n            tmp = virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req);\n\n            if (tmp < 0) {\n                virNWFilterSnoopReqPut(req);\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\"), ifkey);\n                continue;\n            }\n        }\n\n        if (virSocketAddrParseIPv4(&ipl.ipAddress, ipstr) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"line %d corrupt ipaddr \\\"%s\\\"\"),\n                           ln, ipstr);\n            virNWFilterSnoopReqPut(req);\n            continue;\n        }\n        ignore_value(virSocketAddrParseIPv4(&ipl.ipServer, srvstr));\n        ipl.snoopReq = req;\n\n        if (ipl.timeout)\n            virNWFilterSnoopReqLeaseAdd(req, &ipl, false);\n        else\n            virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, false, false);\n\n        virNWFilterSnoopReqPut(req);\n    }\n\n    VIR_FORCE_FCLOSE(fp);\n\n    virNWFilterSnoopLeaseFileRefresh();\n\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileLoad(void)\n{\n    char line[256], ifkey[VIR_IFKEY_LEN];\n    char ipstr[INET_ADDRSTRLEN], srvstr[INET_ADDRSTRLEN];\n    virNWFilterSnoopIPLease ipl;\n    virNWFilterSnoopReqPtr req;\n    time_t now;\n    FILE *fp;\n    int ln = 0, tmp;\n\n    /* protect the lease file */\n    virNWFilterSnoopLock();\n\n    fp = fopen(LEASEFILE, \"r\");\n    time(&now);\n    while (fp && fgets(line, sizeof(line), fp)) {\n        if (line[strlen(line)-1] != '\\n') {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        ln++;\n        /* key len 54 = \"VMUUID\"+'-'+\"MAC\" */\n        if (sscanf(line, \"%u %54s %15s %15s\", &ipl.timeout,\n                   ifkey, ipstr, srvstr) < 4) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        if (ipl.timeout && ipl.timeout < now)\n            continue;\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            req = virNWFilterSnoopReqNew(ifkey);\n            if (!req)\n               break;\n\n            tmp = virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req);\n\n            if (tmp < 0) {\n                virNWFilterSnoopReqPut(req);\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\"), ifkey);\n                continue;\n            }\n        }\n\n        if (virSocketAddrParseIPv4(&ipl.ipAddress, ipstr) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"line %d corrupt ipaddr \\\"%s\\\"\"),\n                           ln, ipstr);\n            virNWFilterSnoopReqPut(req);\n            continue;\n        }\n        ignore_value(virSocketAddrParseIPv4(&ipl.ipServer, srvstr));\n        ipl.snoopReq = req;\n\n        if (ipl.timeout)\n            virNWFilterSnoopReqLeaseAdd(req, &ipl, false);\n        else\n            virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, false, false);\n\n        virNWFilterSnoopReqPut(req);\n    }\n\n    VIR_FORCE_FCLOSE(fp);\n\n    virNWFilterSnoopLeaseFileRefresh();\n\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashCreate",
          "args": [
            "0",
            "virNWFilterSnoopReqRelease"
          ],
          "line": 2049
        },
        "resolved": true,
        "details": {
          "function_name": "virHashCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "202-211",
          "snippet": "virHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexInit",
          "args": [
            "&virNWFilterSnoopState.activeLock"
          ],
          "line": 2043
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Initializing DHCP snooping\""
          ],
          "line": 2040
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nint\nvirNWFilterDHCPSnoopInit(void)\n{\n    if (virNWFilterSnoopState.snoopReqs)\n        return 0;\n\n    VIR_DEBUG(\"Initializing DHCP snooping\");\n\n    if (virMutexInitRecursive(&virNWFilterSnoopState.snoopLock) < 0 ||\n        virMutexInit(&virNWFilterSnoopState.activeLock) < 0)\n        return -1;\n\n    virNWFilterSnoopState.ifnameToKey = virHashCreate(0, NULL);\n    virNWFilterSnoopState.active = virHashCreate(0, NULL);\n    virNWFilterSnoopState.snoopReqs =\n        virHashCreate(0, virNWFilterSnoopReqRelease);\n\n    if (!virNWFilterSnoopState.ifnameToKey ||\n        !virNWFilterSnoopState.snoopReqs ||\n        !virNWFilterSnoopState.active)\n        goto err_exit;\n\n    virNWFilterSnoopLeaseFileLoad();\n    virNWFilterSnoopLeaseFileOpen();\n\n    return 0;\n\n err_exit:\n    virHashFree(virNWFilterSnoopState.ifnameToKey);\n    virNWFilterSnoopState.ifnameToKey = NULL;\n\n    virHashFree(virNWFilterSnoopState.snoopReqs);\n    virNWFilterSnoopState.snoopReqs = NULL;\n\n    virHashFree(virNWFilterSnoopState.active);\n    virNWFilterSnoopState.active = NULL;\n\n    return -1;\n}"
  },
  {
    "function_name": "virNWFilterSnoopEndThreads",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "2024-2032",
    "snippet": "static void\nvirNWFilterSnoopEndThreads(void)\n{\n    virNWFilterSnoopLock();\n    virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                     virNWFilterSnoopRemAllReqIter,\n                     NULL);\n    virNWFilterSnoopUnlock();\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 2031
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashRemoveSet",
          "args": [
            "virNWFilterSnoopState.snoopReqs",
            "virNWFilterSnoopRemAllReqIter",
            "NULL"
          ],
          "line": 2028
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "665-696",
          "snippet": "ssize_t\nvirHashRemoveSet(virHashTablePtr table,\n                 virHashSearcher iter,\n                 const void *data)\n{\n    size_t i, count = 0;\n\n    if (table == NULL || iter == NULL)\n        return -1;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr *nextptr = table->table + i;\n\n        while (*nextptr) {\n            virHashEntryPtr entry = *nextptr;\n            if (!iter(entry->payload, entry->name, data)) {\n                nextptr = &entry->next;\n            } else {\n                count++;\n                if (table->dataFree)\n                    table->dataFree(entry->payload);\n                if (table->keyFree)\n                    table->keyFree(entry->name);\n                *nextptr = entry->next;\n                VIR_FREE(entry);\n                table->nbElems--;\n            }\n        }\n    }\n\n    return count;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nssize_t\nvirHashRemoveSet(virHashTablePtr table,\n                 virHashSearcher iter,\n                 const void *data)\n{\n    size_t i, count = 0;\n\n    if (table == NULL || iter == NULL)\n        return -1;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr *nextptr = table->table + i;\n\n        while (*nextptr) {\n            virHashEntryPtr entry = *nextptr;\n            if (!iter(entry->payload, entry->name, data)) {\n                nextptr = &entry->next;\n            } else {\n                count++;\n                if (table->dataFree)\n                    table->dataFree(entry->payload);\n                if (table->keyFree)\n                    table->keyFree(entry->name);\n                *nextptr = entry->next;\n                VIR_FREE(entry);\n                table->nbElems--;\n            }\n        }\n    }\n\n    return count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 2027
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopEndThreads(void)\n{\n    virNWFilterSnoopLock();\n    virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                     virNWFilterSnoopRemAllReqIter,\n                     NULL);\n    virNWFilterSnoopUnlock();\n}"
  },
  {
    "function_name": "virNWFilterSnoopRemAllReqIter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1990-2018",
    "snippet": "static int\nvirNWFilterSnoopRemAllReqIter(const void *payload,\n                              const void *name G_GNUC_UNUSED,\n                              const void *data G_GNUC_UNUSED)\n{\n    virNWFilterSnoopReqPtr req = (virNWFilterSnoopReqPtr)payload;\n\n    /* protect req->binding->portdevname */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->binding && req->binding->portdevname) {\n        ignore_value(virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                        req->binding->portdevname));\n\n        /*\n         * Remove all IP addresses known to be associated with this\n         * interface so that a new thread will be started on this\n         * interface\n         */\n        virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, NULL);\n\n        VIR_FREE(req->binding->portdevname);\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    /* removal will call virNWFilterSnoopCancel() */\n    return 1;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 2014
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "req->binding->portdevname"
          ],
          "line": 2011
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterIPAddrMapDelIPAddr",
          "args": [
            "req->binding->portdevname",
            "NULL"
          ],
          "line": 2009
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterIPAddrMapDelIPAddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_ipaddrmap.c",
          "lines": "99-127",
          "snippet": "int\nvirNWFilterIPAddrMapDelIPAddr(const char *ifname, const char *ipaddr)\n{\n    int ret = -1;\n    virNWFilterVarValuePtr val = NULL;\n\n    virMutexLock(&ipAddressMapLock);\n\n    if (ipaddr != NULL) {\n        val = virHashLookup(ipAddressMap, ifname);\n        if (val) {\n            if (virNWFilterVarValueGetCardinality(val) == 1 &&\n                STREQ(ipaddr,\n                      virNWFilterVarValueGetNthValue(val, 0)))\n                goto remove_entry;\n            virNWFilterVarValueDelValue(val, ipaddr);\n            ret = virNWFilterVarValueGetCardinality(val);\n        }\n    } else {\n remove_entry:\n        /* remove whole entry */\n        virHashRemoveEntry(ipAddressMap, ifname);\n        ret = 0;\n    }\n\n    virMutexUnlock(&ipAddressMapLock);\n\n    return ret;\n}",
          "includes": [
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;",
            "static virHashTablePtr ipAddressMap;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;\nstatic virHashTablePtr ipAddressMap;\n\nint\nvirNWFilterIPAddrMapDelIPAddr(const char *ifname, const char *ipaddr)\n{\n    int ret = -1;\n    virNWFilterVarValuePtr val = NULL;\n\n    virMutexLock(&ipAddressMapLock);\n\n    if (ipaddr != NULL) {\n        val = virHashLookup(ipAddressMap, ifname);\n        if (val) {\n            if (virNWFilterVarValueGetCardinality(val) == 1 &&\n                STREQ(ipaddr,\n                      virNWFilterVarValueGetNthValue(val, 0)))\n                goto remove_entry;\n            virNWFilterVarValueDelValue(val, ipaddr);\n            ret = virNWFilterVarValueGetCardinality(val);\n        }\n    } else {\n remove_entry:\n        /* remove whole entry */\n        virHashRemoveEntry(ipAddressMap, ifname);\n        ret = 0;\n    }\n\n    virMutexUnlock(&ipAddressMapLock);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                        req->binding->portdevname)"
          ],
          "line": 2001
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "virNWFilterSnoopState.ifnameToKey",
            "req->binding->portdevname"
          ],
          "line": 2001
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 1998
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopRemAllReqIter(const void *payload,\n                              const void *name G_GNUC_UNUSED,\n                              const void *data G_GNUC_UNUSED)\n{\n    virNWFilterSnoopReqPtr req = (virNWFilterSnoopReqPtr)payload;\n\n    /* protect req->binding->portdevname */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->binding && req->binding->portdevname) {\n        ignore_value(virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                        req->binding->portdevname));\n\n        /*\n         * Remove all IP addresses known to be associated with this\n         * interface so that a new thread will be started on this\n         * interface\n         */\n        virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, NULL);\n\n        VIR_FREE(req->binding->portdevname);\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    /* removal will call virNWFilterSnoopCancel() */\n    return 1;\n}"
  },
  {
    "function_name": "virNWFilterSnoopJoinThreads",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1973-1981",
    "snippet": "static void\nvirNWFilterSnoopJoinThreads(void)\n{\n    while (g_atomic_int_get(&virNWFilterSnoopState.nThreads) != 0) {\n        VIR_WARN(\"Waiting for snooping threads to terminate: %u\",\n                 g_atomic_int_get(&virNWFilterSnoopState.nThreads));\n        g_usleep(1000 * 1000);\n    }\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_usleep",
          "args": [
            "1000 * 1000"
          ],
          "line": 1979
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Waiting for snooping threads to terminate: %u\"",
            "g_atomic_int_get(&virNWFilterSnoopState.nThreads)"
          ],
          "line": 1977
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&virNWFilterSnoopState.nThreads"
          ],
          "line": 1978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&virNWFilterSnoopState.nThreads"
          ],
          "line": 1976
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopJoinThreads(void)\n{\n    while (g_atomic_int_get(&virNWFilterSnoopState.nThreads) != 0) {\n        VIR_WARN(\"Waiting for snooping threads to terminate: %u\",\n                 g_atomic_int_get(&virNWFilterSnoopState.nThreads));\n        g_usleep(1000 * 1000);\n    }\n}"
  },
  {
    "function_name": "virNWFilterSnoopLeaseFileLoad",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1894-1968",
    "snippet": "static void\nvirNWFilterSnoopLeaseFileLoad(void)\n{\n    char line[256], ifkey[VIR_IFKEY_LEN];\n    char ipstr[INET_ADDRSTRLEN], srvstr[INET_ADDRSTRLEN];\n    virNWFilterSnoopIPLease ipl;\n    virNWFilterSnoopReqPtr req;\n    time_t now;\n    FILE *fp;\n    int ln = 0, tmp;\n\n    /* protect the lease file */\n    virNWFilterSnoopLock();\n\n    fp = fopen(LEASEFILE, \"r\");\n    time(&now);\n    while (fp && fgets(line, sizeof(line), fp)) {\n        if (line[strlen(line)-1] != '\\n') {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        ln++;\n        /* key len 54 = \"VMUUID\"+'-'+\"MAC\" */\n        if (sscanf(line, \"%u %54s %15s %15s\", &ipl.timeout,\n                   ifkey, ipstr, srvstr) < 4) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        if (ipl.timeout && ipl.timeout < now)\n            continue;\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            req = virNWFilterSnoopReqNew(ifkey);\n            if (!req)\n               break;\n\n            tmp = virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req);\n\n            if (tmp < 0) {\n                virNWFilterSnoopReqPut(req);\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\"), ifkey);\n                continue;\n            }\n        }\n\n        if (virSocketAddrParseIPv4(&ipl.ipAddress, ipstr) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"line %d corrupt ipaddr \\\"%s\\\"\"),\n                           ln, ipstr);\n            virNWFilterSnoopReqPut(req);\n            continue;\n        }\n        ignore_value(virSocketAddrParseIPv4(&ipl.ipServer, srvstr));\n        ipl.snoopReq = req;\n\n        if (ipl.timeout)\n            virNWFilterSnoopReqLeaseAdd(req, &ipl, false);\n        else\n            virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, false, false);\n\n        virNWFilterSnoopReqPut(req);\n    }\n\n    VIR_FORCE_FCLOSE(fp);\n\n    virNWFilterSnoopLeaseFileRefresh();\n\n    virNWFilterSnoopUnlock();\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 1967
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileRefresh",
          "args": [],
          "line": 1965
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileRefresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1847-1891",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileRefresh(void)\n{\n    int tfd;\n\n    if (virFileMakePathWithMode(LEASEFILE_DIR, 0700) < 0) {\n        virReportError(errno, _(\"mkdir(\\\"%s\\\")\"), LEASEFILE_DIR);\n        return;\n    }\n\n    if (unlink(TMPLEASEFILE) < 0 && errno != ENOENT)\n        virReportSystemError(errno, _(\"unlink(\\\"%s\\\")\"), TMPLEASEFILE);\n\n    /* lease file loaded, delete old one */\n    tfd = open(TMPLEASEFILE, O_CREAT|O_RDWR|O_TRUNC|O_EXCL, 0644);\n    if (tfd < 0) {\n        virReportSystemError(errno, _(\"open(\\\"%s\\\")\"), TMPLEASEFILE);\n        return;\n    }\n\n    if (virNWFilterSnoopState.snoopReqs) {\n        /* clean up the requests */\n        virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                         virNWFilterSnoopPruneIter, NULL);\n        /* now save them */\n        virHashForEach(virNWFilterSnoopState.snoopReqs,\n                       virNWFilterSnoopSaveIter, (void *)&tfd);\n    }\n\n    if (VIR_CLOSE(tfd) < 0) {\n        virReportSystemError(errno, _(\"unable to close %s\"), TMPLEASEFILE);\n        /* assuming the old lease file is still better, skip the renaming */\n        goto skip_rename;\n    }\n\n    if (rename(TMPLEASEFILE, LEASEFILE) < 0) {\n        virReportSystemError(errno, _(\"rename(\\\"%s\\\", \\\"%s\\\")\"),\n                             TMPLEASEFILE, LEASEFILE);\n        unlink(TMPLEASEFILE);\n    }\n    g_atomic_int_set(&virNWFilterSnoopState.wLeases, 0);\n\n skip_rename:\n    virNWFilterSnoopLeaseFileOpen();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileRefresh(void)\n{\n    int tfd;\n\n    if (virFileMakePathWithMode(LEASEFILE_DIR, 0700) < 0) {\n        virReportError(errno, _(\"mkdir(\\\"%s\\\")\"), LEASEFILE_DIR);\n        return;\n    }\n\n    if (unlink(TMPLEASEFILE) < 0 && errno != ENOENT)\n        virReportSystemError(errno, _(\"unlink(\\\"%s\\\")\"), TMPLEASEFILE);\n\n    /* lease file loaded, delete old one */\n    tfd = open(TMPLEASEFILE, O_CREAT|O_RDWR|O_TRUNC|O_EXCL, 0644);\n    if (tfd < 0) {\n        virReportSystemError(errno, _(\"open(\\\"%s\\\")\"), TMPLEASEFILE);\n        return;\n    }\n\n    if (virNWFilterSnoopState.snoopReqs) {\n        /* clean up the requests */\n        virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                         virNWFilterSnoopPruneIter, NULL);\n        /* now save them */\n        virHashForEach(virNWFilterSnoopState.snoopReqs,\n                       virNWFilterSnoopSaveIter, (void *)&tfd);\n    }\n\n    if (VIR_CLOSE(tfd) < 0) {\n        virReportSystemError(errno, _(\"unable to close %s\"), TMPLEASEFILE);\n        /* assuming the old lease file is still better, skip the renaming */\n        goto skip_rename;\n    }\n\n    if (rename(TMPLEASEFILE, LEASEFILE) < 0) {\n        virReportSystemError(errno, _(\"rename(\\\"%s\\\", \\\"%s\\\")\"),\n                             TMPLEASEFILE, LEASEFILE);\n        unlink(TMPLEASEFILE);\n    }\n    g_atomic_int_set(&virNWFilterSnoopState.wLeases, 0);\n\n skip_rename:\n    virNWFilterSnoopLeaseFileOpen();\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "fp"
          ],
          "line": 1963
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqPut",
          "args": [
            "req"
          ],
          "line": 1960
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqPut",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "686-711",
          "snippet": "static void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLeaseDel",
          "args": [
            "req",
            "&ipl.ipAddress",
            "false",
            "false"
          ],
          "line": 1958
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLeaseDel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "813-878",
          "snippet": "static int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLeaseAdd",
          "args": [
            "req",
            "&ipl",
            "false"
          ],
          "line": 1956
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLeaseAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "716-765",
          "snippet": "static int\nvirNWFilterSnoopReqLeaseAdd(virNWFilterSnoopReqPtr req,\n                            virNWFilterSnoopIPLeasePtr plnew,\n                            bool update_leasefile)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->snoopReq = req;\n\n    /* protect req->start and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    pl = virNWFilterSnoopIPLeaseGetByIP(req->start, &plnew->ipAddress);\n\n    if (pl) {\n        virNWFilterSnoopIPLeaseUpdate(pl, plnew->timeout);\n\n        virNWFilterSnoopReqUnlock(req);\n\n        goto exit;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    if (VIR_ALLOC(pl) < 0)\n        return -1;\n    *pl = *plnew;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey && virNWFilterSnoopIPLeaseInstallRule(pl, true) < 0) {\n        virNWFilterSnoopReqUnlock(req);\n        VIR_FREE(pl);\n        return -1;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    /* put the lease on the req's list */\n    virNWFilterSnoopIPLeaseTimerAdd(pl);\n\n    g_atomic_int_add(&virNWFilterSnoopState.nLeases, 1);\n\n exit:\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(pl);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqLeaseAdd(virNWFilterSnoopReqPtr req,\n                            virNWFilterSnoopIPLeasePtr plnew,\n                            bool update_leasefile)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->snoopReq = req;\n\n    /* protect req->start and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    pl = virNWFilterSnoopIPLeaseGetByIP(req->start, &plnew->ipAddress);\n\n    if (pl) {\n        virNWFilterSnoopIPLeaseUpdate(pl, plnew->timeout);\n\n        virNWFilterSnoopReqUnlock(req);\n\n        goto exit;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    if (VIR_ALLOC(pl) < 0)\n        return -1;\n    *pl = *plnew;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey && virNWFilterSnoopIPLeaseInstallRule(pl, true) < 0) {\n        virNWFilterSnoopReqUnlock(req);\n        VIR_FREE(pl);\n        return -1;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    /* put the lease on the req's list */\n    virNWFilterSnoopIPLeaseTimerAdd(pl);\n\n    g_atomic_int_add(&virNWFilterSnoopState.nLeases, 1);\n\n exit:\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(pl);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virSocketAddrParseIPv4(&ipl.ipServer, srvstr)"
          ],
          "line": 1952
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSocketAddrParseIPv4",
          "args": [
            "&ipl.ipServer",
            "srvstr"
          ],
          "line": 1952
        },
        "resolved": true,
        "details": {
          "function_name": "virSocketAddrParseIPv4",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocketaddr.c",
          "lines": "215-219",
          "snippet": "int\nvirSocketAddrParseIPv4(virSocketAddrPtr addr, const char *val)\n{\n    return virSocketAddrParse(addr, val, AF_INET);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virsocketaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virsocketaddr.h\"\n#include <config.h>\n\nint\nvirSocketAddrParseIPv4(virSocketAddrPtr addr, const char *val)\n{\n    return virSocketAddrParse(addr, val, AF_INET);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"line %d corrupt ipaddr \\\"%s\\\"\")",
            "ln",
            "ipstr"
          ],
          "line": 1946
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"line %d corrupt ipaddr \\\"%s\\\"\""
          ],
          "line": 1947
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\")",
            "ifkey"
          ],
          "line": 1938
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "virNWFilterSnoopState.snoopReqs",
            "ifkey",
            "req"
          ],
          "line": 1934
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqNew",
          "args": [
            "ifkey"
          ],
          "line": 1930
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "551-588",
          "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqNew(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    if (ifkey == NULL || strlen(ifkey) != VIR_IFKEY_LEN - 1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterSnoopReqNew called with invalid \"\n                         \"key \\\"%s\\\" (%zu)\"),\n                       NULLSTR_EMPTY(ifkey),\n                       ifkey ? strlen(ifkey) : 0);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(req) < 0)\n        return NULL;\n\n    req->threadStatus = THREAD_STATUS_NONE;\n\n    if (virStrcpyStatic(req->ifkey, ifkey) < 0||\n        virMutexInitRecursive(&req->lock) < 0)\n        goto err_free_req;\n\n    if (virCondInit(&req->threadStatusCond) < 0)\n        goto err_destroy_mutex;\n\n    virNWFilterSnoopReqGet(req);\n\n    return req;\n\n err_destroy_mutex:\n    virMutexDestroy(&req->lock);\n\n err_free_req:\n    VIR_FREE(req);\n\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqNew(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    if (ifkey == NULL || strlen(ifkey) != VIR_IFKEY_LEN - 1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterSnoopReqNew called with invalid \"\n                         \"key \\\"%s\\\" (%zu)\"),\n                       NULLSTR_EMPTY(ifkey),\n                       ifkey ? strlen(ifkey) : 0);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(req) < 0)\n        return NULL;\n\n    req->threadStatus = THREAD_STATUS_NONE;\n\n    if (virStrcpyStatic(req->ifkey, ifkey) < 0||\n        virMutexInitRecursive(&req->lock) < 0)\n        goto err_free_req;\n\n    if (virCondInit(&req->threadStatusCond) < 0)\n        goto err_destroy_mutex;\n\n    virNWFilterSnoopReqGet(req);\n\n    return req;\n\n err_destroy_mutex:\n    virMutexDestroy(&req->lock);\n\n err_free_req:\n    VIR_FREE(req);\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqGetByIFKey",
          "args": [
            "ifkey"
          ],
          "line": 1928
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqGetByIFKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "666-680",
          "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\")",
            "ln"
          ],
          "line": 1921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sscanf",
          "args": [
            "line",
            "\"%u %54s %15s %15s\"",
            "&ipl.timeout",
            "ifkey",
            "ipstr",
            "srvstr"
          ],
          "line": 1919
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\")",
            "ln"
          ],
          "line": 1912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "line"
          ],
          "line": 1911
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fgets",
          "args": [
            "line",
            "sizeof(line)",
            "fp"
          ],
          "line": 1910
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "&now"
          ],
          "line": 1909
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "LEASEFILE",
            "\"r\""
          ],
          "line": 1908
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 1906
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileLoad(void)\n{\n    char line[256], ifkey[VIR_IFKEY_LEN];\n    char ipstr[INET_ADDRSTRLEN], srvstr[INET_ADDRSTRLEN];\n    virNWFilterSnoopIPLease ipl;\n    virNWFilterSnoopReqPtr req;\n    time_t now;\n    FILE *fp;\n    int ln = 0, tmp;\n\n    /* protect the lease file */\n    virNWFilterSnoopLock();\n\n    fp = fopen(LEASEFILE, \"r\");\n    time(&now);\n    while (fp && fgets(line, sizeof(line), fp)) {\n        if (line[strlen(line)-1] != '\\n') {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        ln++;\n        /* key len 54 = \"VMUUID\"+'-'+\"MAC\" */\n        if (sscanf(line, \"%u %54s %15s %15s\", &ipl.timeout,\n                   ifkey, ipstr, srvstr) < 4) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        if (ipl.timeout && ipl.timeout < now)\n            continue;\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            req = virNWFilterSnoopReqNew(ifkey);\n            if (!req)\n               break;\n\n            tmp = virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req);\n\n            if (tmp < 0) {\n                virNWFilterSnoopReqPut(req);\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\"), ifkey);\n                continue;\n            }\n        }\n\n        if (virSocketAddrParseIPv4(&ipl.ipAddress, ipstr) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"line %d corrupt ipaddr \\\"%s\\\"\"),\n                           ln, ipstr);\n            virNWFilterSnoopReqPut(req);\n            continue;\n        }\n        ignore_value(virSocketAddrParseIPv4(&ipl.ipServer, srvstr));\n        ipl.snoopReq = req;\n\n        if (ipl.timeout)\n            virNWFilterSnoopReqLeaseAdd(req, &ipl, false);\n        else\n            virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, false, false);\n\n        virNWFilterSnoopReqPut(req);\n    }\n\n    VIR_FORCE_FCLOSE(fp);\n\n    virNWFilterSnoopLeaseFileRefresh();\n\n    virNWFilterSnoopUnlock();\n}"
  },
  {
    "function_name": "virNWFilterSnoopLeaseFileRefresh",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1847-1891",
    "snippet": "static void\nvirNWFilterSnoopLeaseFileRefresh(void)\n{\n    int tfd;\n\n    if (virFileMakePathWithMode(LEASEFILE_DIR, 0700) < 0) {\n        virReportError(errno, _(\"mkdir(\\\"%s\\\")\"), LEASEFILE_DIR);\n        return;\n    }\n\n    if (unlink(TMPLEASEFILE) < 0 && errno != ENOENT)\n        virReportSystemError(errno, _(\"unlink(\\\"%s\\\")\"), TMPLEASEFILE);\n\n    /* lease file loaded, delete old one */\n    tfd = open(TMPLEASEFILE, O_CREAT|O_RDWR|O_TRUNC|O_EXCL, 0644);\n    if (tfd < 0) {\n        virReportSystemError(errno, _(\"open(\\\"%s\\\")\"), TMPLEASEFILE);\n        return;\n    }\n\n    if (virNWFilterSnoopState.snoopReqs) {\n        /* clean up the requests */\n        virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                         virNWFilterSnoopPruneIter, NULL);\n        /* now save them */\n        virHashForEach(virNWFilterSnoopState.snoopReqs,\n                       virNWFilterSnoopSaveIter, (void *)&tfd);\n    }\n\n    if (VIR_CLOSE(tfd) < 0) {\n        virReportSystemError(errno, _(\"unable to close %s\"), TMPLEASEFILE);\n        /* assuming the old lease file is still better, skip the renaming */\n        goto skip_rename;\n    }\n\n    if (rename(TMPLEASEFILE, LEASEFILE) < 0) {\n        virReportSystemError(errno, _(\"rename(\\\"%s\\\", \\\"%s\\\")\"),\n                             TMPLEASEFILE, LEASEFILE);\n        unlink(TMPLEASEFILE);\n    }\n    g_atomic_int_set(&virNWFilterSnoopState.wLeases, 0);\n\n skip_rename:\n    virNWFilterSnoopLeaseFileOpen();\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileOpen",
          "args": [],
          "line": 1890
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileOpen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1710-1717",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileOpen(void)\n{\n    virNWFilterSnoopLeaseFileClose();\n\n    virNWFilterSnoopState.leaseFD = open(LEASEFILE, O_CREAT|O_RDWR|O_APPEND,\n                                         0644);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileOpen(void)\n{\n    virNWFilterSnoopLeaseFileClose();\n\n    virNWFilterSnoopState.leaseFD = open(LEASEFILE, O_CREAT|O_RDWR|O_APPEND,\n                                         0644);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_set",
          "args": [
            "&virNWFilterSnoopState.wLeases",
            "0"
          ],
          "line": 1887
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "TMPLEASEFILE"
          ],
          "line": 1885
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"rename(\\\"%s\\\", \\\"%s\\\")\")",
            "TMPLEASEFILE",
            "LEASEFILE"
          ],
          "line": 1883
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"rename(\\\"%s\\\", \\\"%s\\\")\""
          ],
          "line": 1883
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "TMPLEASEFILE",
            "LEASEFILE"
          ],
          "line": 1882
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unable to close %s\")",
            "TMPLEASEFILE"
          ],
          "line": 1877
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_CLOSE",
          "args": [
            "tfd"
          ],
          "line": 1876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashForEach",
          "args": [
            "virNWFilterSnoopState.snoopReqs",
            "virNWFilterSnoopSaveIter",
            "(void *)&tfd"
          ],
          "line": 1872
        },
        "resolved": true,
        "details": {
          "function_name": "virHashForEach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "626-649",
          "snippet": "int\nvirHashForEach(virHashTablePtr table, virHashIterator iter, void *data)\n{\n    size_t i;\n    int ret = -1;\n\n    if (table == NULL || iter == NULL)\n        return -1;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr entry = table->table[i];\n        while (entry) {\n            virHashEntryPtr next = entry->next;\n            ret = iter(entry->payload, entry->name, data);\n\n            if (ret < 0)\n                return ret;\n\n            entry = next;\n        }\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashForEach(virHashTablePtr table, virHashIterator iter, void *data)\n{\n    size_t i;\n    int ret = -1;\n\n    if (table == NULL || iter == NULL)\n        return -1;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr entry = table->table[i];\n        while (entry) {\n            virHashEntryPtr next = entry->next;\n            ret = iter(entry->payload, entry->name, data);\n\n            if (ret < 0)\n                return ret;\n\n            entry = next;\n        }\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashRemoveSet",
          "args": [
            "virNWFilterSnoopState.snoopReqs",
            "virNWFilterSnoopPruneIter",
            "NULL"
          ],
          "line": 1869
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "665-696",
          "snippet": "ssize_t\nvirHashRemoveSet(virHashTablePtr table,\n                 virHashSearcher iter,\n                 const void *data)\n{\n    size_t i, count = 0;\n\n    if (table == NULL || iter == NULL)\n        return -1;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr *nextptr = table->table + i;\n\n        while (*nextptr) {\n            virHashEntryPtr entry = *nextptr;\n            if (!iter(entry->payload, entry->name, data)) {\n                nextptr = &entry->next;\n            } else {\n                count++;\n                if (table->dataFree)\n                    table->dataFree(entry->payload);\n                if (table->keyFree)\n                    table->keyFree(entry->name);\n                *nextptr = entry->next;\n                VIR_FREE(entry);\n                table->nbElems--;\n            }\n        }\n    }\n\n    return count;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nssize_t\nvirHashRemoveSet(virHashTablePtr table,\n                 virHashSearcher iter,\n                 const void *data)\n{\n    size_t i, count = 0;\n\n    if (table == NULL || iter == NULL)\n        return -1;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr *nextptr = table->table + i;\n\n        while (*nextptr) {\n            virHashEntryPtr entry = *nextptr;\n            if (!iter(entry->payload, entry->name, data)) {\n                nextptr = &entry->next;\n            } else {\n                count++;\n                if (table->dataFree)\n                    table->dataFree(entry->payload);\n                if (table->keyFree)\n                    table->keyFree(entry->name);\n                *nextptr = entry->next;\n                VIR_FREE(entry);\n                table->nbElems--;\n            }\n        }\n    }\n\n    return count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"open(\\\"%s\\\")\")",
            "TMPLEASEFILE"
          ],
          "line": 1863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "TMPLEASEFILE",
            "O_CREAT|O_RDWR|O_TRUNC|O_EXCL",
            "0644"
          ],
          "line": 1861
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockReopenReadOnly",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "3308-3323",
          "snippet": "int\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nint\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unlink(\\\"%s\\\")\")",
            "TMPLEASEFILE"
          ],
          "line": 1858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "TMPLEASEFILE"
          ],
          "line": 1857
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "errno",
            "_(\"mkdir(\\\"%s\\\")\")",
            "LEASEFILE_DIR"
          ],
          "line": 1853
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePathWithMode",
          "args": [
            "LEASEFILE_DIR",
            "0700"
          ],
          "line": 1852
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePathWithMode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3082-3091",
          "snippet": "int\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileRefresh(void)\n{\n    int tfd;\n\n    if (virFileMakePathWithMode(LEASEFILE_DIR, 0700) < 0) {\n        virReportError(errno, _(\"mkdir(\\\"%s\\\")\"), LEASEFILE_DIR);\n        return;\n    }\n\n    if (unlink(TMPLEASEFILE) < 0 && errno != ENOENT)\n        virReportSystemError(errno, _(\"unlink(\\\"%s\\\")\"), TMPLEASEFILE);\n\n    /* lease file loaded, delete old one */\n    tfd = open(TMPLEASEFILE, O_CREAT|O_RDWR|O_TRUNC|O_EXCL, 0644);\n    if (tfd < 0) {\n        virReportSystemError(errno, _(\"open(\\\"%s\\\")\"), TMPLEASEFILE);\n        return;\n    }\n\n    if (virNWFilterSnoopState.snoopReqs) {\n        /* clean up the requests */\n        virHashRemoveSet(virNWFilterSnoopState.snoopReqs,\n                         virNWFilterSnoopPruneIter, NULL);\n        /* now save them */\n        virHashForEach(virNWFilterSnoopState.snoopReqs,\n                       virNWFilterSnoopSaveIter, (void *)&tfd);\n    }\n\n    if (VIR_CLOSE(tfd) < 0) {\n        virReportSystemError(errno, _(\"unable to close %s\"), TMPLEASEFILE);\n        /* assuming the old lease file is still better, skip the renaming */\n        goto skip_rename;\n    }\n\n    if (rename(TMPLEASEFILE, LEASEFILE) < 0) {\n        virReportSystemError(errno, _(\"rename(\\\"%s\\\", \\\"%s\\\")\"),\n                             TMPLEASEFILE, LEASEFILE);\n        unlink(TMPLEASEFILE);\n    }\n    g_atomic_int_set(&virNWFilterSnoopState.wLeases, 0);\n\n skip_rename:\n    virNWFilterSnoopLeaseFileOpen();\n}"
  },
  {
    "function_name": "virNWFilterSnoopSaveIter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1823-1840",
    "snippet": "static int\nvirNWFilterSnoopSaveIter(void *payload,\n                         const void *name G_GNUC_UNUSED,\n                         void *data)\n{\n    virNWFilterSnoopReqPtr req = payload;\n    int tfd = *(int *)data;\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    for (ipl = req->start; ipl; ipl = ipl->next)\n        ignore_value(virNWFilterSnoopLeaseFileWrite(tfd, req->ifkey, ipl));\n\n    virNWFilterSnoopReqUnlock(req);\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 1838
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virNWFilterSnoopLeaseFileWrite(tfd, req->ifkey, ipl)"
          ],
          "line": 1836
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileWrite",
          "args": [
            "tfd",
            "req->ifkey",
            "ipl"
          ],
          "line": 1836
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileWrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1723-1758",
          "snippet": "static int\nvirNWFilterSnoopLeaseFileWrite(int lfd, const char *ifkey,\n                               virNWFilterSnoopIPLeasePtr ipl)\n{\n    char *lbuf = NULL;\n    char *ipstr, *dhcpstr;\n    int len;\n    int ret = 0;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    dhcpstr = virSocketAddrFormat(&ipl->ipServer);\n\n    if (!dhcpstr || !ipstr) {\n        ret = -1;\n        goto cleanup;\n    }\n\n    /* time intf ip dhcpserver */\n    lbuf = g_strdup_printf(\"%u %s %s %s\\n\", ipl->timeout, ifkey, ipstr, dhcpstr);\n    len = strlen(lbuf);\n\n    if (safewrite(lfd, lbuf, len) != len) {\n        virReportSystemError(errno, \"%s\", _(\"lease file write failed\"));\n        ret = -1;\n        goto cleanup;\n    }\n\n    ignore_value(g_fsync(lfd));\n\n cleanup:\n    VIR_FREE(lbuf);\n    VIR_FREE(dhcpstr);\n    VIR_FREE(ipstr);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopLeaseFileWrite(int lfd, const char *ifkey,\n                               virNWFilterSnoopIPLeasePtr ipl)\n{\n    char *lbuf = NULL;\n    char *ipstr, *dhcpstr;\n    int len;\n    int ret = 0;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    dhcpstr = virSocketAddrFormat(&ipl->ipServer);\n\n    if (!dhcpstr || !ipstr) {\n        ret = -1;\n        goto cleanup;\n    }\n\n    /* time intf ip dhcpserver */\n    lbuf = g_strdup_printf(\"%u %s %s %s\\n\", ipl->timeout, ifkey, ipstr, dhcpstr);\n    len = strlen(lbuf);\n\n    if (safewrite(lfd, lbuf, len) != len) {\n        virReportSystemError(errno, \"%s\", _(\"lease file write failed\"));\n        ret = -1;\n        goto cleanup;\n    }\n\n    ignore_value(g_fsync(lfd));\n\n cleanup:\n    VIR_FREE(lbuf);\n    VIR_FREE(dhcpstr);\n    VIR_FREE(ipstr);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 1833
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopSaveIter(void *payload,\n                         const void *name G_GNUC_UNUSED,\n                         void *data)\n{\n    virNWFilterSnoopReqPtr req = payload;\n    int tfd = *(int *)data;\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    for (ipl = req->start; ipl; ipl = ipl->next)\n        ignore_value(virNWFilterSnoopLeaseFileWrite(tfd, req->ifkey, ipl));\n\n    virNWFilterSnoopReqUnlock(req);\n    return 0;\n}"
  },
  {
    "function_name": "virNWFilterSnoopPruneIter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1793-1817",
    "snippet": "static int\nvirNWFilterSnoopPruneIter(const void *payload,\n                          const void *name G_GNUC_UNUSED,\n                          const void *data G_GNUC_UNUSED)\n{\n    virNWFilterSnoopReqPtr req = (virNWFilterSnoopReqPtr)payload;\n    bool del_req;\n\n    /* clean up orphaned, expired leases */\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (!req->threadkey)\n        virNWFilterSnoopReqLeaseTimerRun(req);\n\n    /*\n     * have the entry removed if it has no leases and no one holds a ref\n     */\n    del_req = ((req->start == NULL) && (g_atomic_int_get(&req->refctr) == 0));\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return del_req;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 1814
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&req->refctr"
          ],
          "line": 1812
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLeaseTimerRun",
          "args": [
            "req"
          ],
          "line": 1807
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLeaseTimerRun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "515-535",
          "snippet": "static unsigned int\nvirNWFilterSnoopReqLeaseTimerRun(virNWFilterSnoopReqPtr req)\n{\n    time_t now = time(0);\n    bool is_last = false;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    while (req->start && req->start->timeout <= now) {\n        if (req->start->next == NULL ||\n            req->start->next->timeout > now)\n            is_last = true;\n        virNWFilterSnoopReqLeaseDel(req, &req->start->ipAddress, true,\n                                    is_last);\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic unsigned int\nvirNWFilterSnoopReqLeaseTimerRun(virNWFilterSnoopReqPtr req)\n{\n    time_t now = time(0);\n    bool is_last = false;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    while (req->start && req->start->timeout <= now) {\n        if (req->start->next == NULL ||\n            req->start->next->timeout > now)\n            is_last = true;\n        virNWFilterSnoopReqLeaseDel(req, &req->start->ipAddress, true,\n                                    is_last);\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 1804
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopPruneIter(const void *payload,\n                          const void *name G_GNUC_UNUSED,\n                          const void *data G_GNUC_UNUSED)\n{\n    virNWFilterSnoopReqPtr req = (virNWFilterSnoopReqPtr)payload;\n    bool del_req;\n\n    /* clean up orphaned, expired leases */\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (!req->threadkey)\n        virNWFilterSnoopReqLeaseTimerRun(req);\n\n    /*\n     * have the entry removed if it has no leases and no one holds a ref\n     */\n    del_req = ((req->start == NULL) && (g_atomic_int_get(&req->refctr) == 0));\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return del_req;\n}"
  },
  {
    "function_name": "virNWFilterSnoopLeaseFileSave",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1766-1786",
    "snippet": "static void\nvirNWFilterSnoopLeaseFileSave(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    virNWFilterSnoopLock();\n\n    if (virNWFilterSnoopState.leaseFD < 0)\n        virNWFilterSnoopLeaseFileOpen();\n    if (virNWFilterSnoopLeaseFileWrite(virNWFilterSnoopState.leaseFD,\n                                       req->ifkey, ipl) < 0)\n        goto err_exit;\n\n    /* keep dead leases at < ~95% of file size */\n    if (g_atomic_int_add(&virNWFilterSnoopState.wLeases, 1) >=\n        g_atomic_int_get(&virNWFilterSnoopState.nLeases) * 20)\n        virNWFilterSnoopLeaseFileLoad();   /* load & refresh lease file */\n\n err_exit:\n    virNWFilterSnoopUnlock();\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 1785
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileLoad",
          "args": [],
          "line": 1782
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileLoad",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1894-1968",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileLoad(void)\n{\n    char line[256], ifkey[VIR_IFKEY_LEN];\n    char ipstr[INET_ADDRSTRLEN], srvstr[INET_ADDRSTRLEN];\n    virNWFilterSnoopIPLease ipl;\n    virNWFilterSnoopReqPtr req;\n    time_t now;\n    FILE *fp;\n    int ln = 0, tmp;\n\n    /* protect the lease file */\n    virNWFilterSnoopLock();\n\n    fp = fopen(LEASEFILE, \"r\");\n    time(&now);\n    while (fp && fgets(line, sizeof(line), fp)) {\n        if (line[strlen(line)-1] != '\\n') {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        ln++;\n        /* key len 54 = \"VMUUID\"+'-'+\"MAC\" */\n        if (sscanf(line, \"%u %54s %15s %15s\", &ipl.timeout,\n                   ifkey, ipstr, srvstr) < 4) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        if (ipl.timeout && ipl.timeout < now)\n            continue;\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            req = virNWFilterSnoopReqNew(ifkey);\n            if (!req)\n               break;\n\n            tmp = virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req);\n\n            if (tmp < 0) {\n                virNWFilterSnoopReqPut(req);\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\"), ifkey);\n                continue;\n            }\n        }\n\n        if (virSocketAddrParseIPv4(&ipl.ipAddress, ipstr) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"line %d corrupt ipaddr \\\"%s\\\"\"),\n                           ln, ipstr);\n            virNWFilterSnoopReqPut(req);\n            continue;\n        }\n        ignore_value(virSocketAddrParseIPv4(&ipl.ipServer, srvstr));\n        ipl.snoopReq = req;\n\n        if (ipl.timeout)\n            virNWFilterSnoopReqLeaseAdd(req, &ipl, false);\n        else\n            virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, false, false);\n\n        virNWFilterSnoopReqPut(req);\n    }\n\n    VIR_FORCE_FCLOSE(fp);\n\n    virNWFilterSnoopLeaseFileRefresh();\n\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileLoad(void)\n{\n    char line[256], ifkey[VIR_IFKEY_LEN];\n    char ipstr[INET_ADDRSTRLEN], srvstr[INET_ADDRSTRLEN];\n    virNWFilterSnoopIPLease ipl;\n    virNWFilterSnoopReqPtr req;\n    time_t now;\n    FILE *fp;\n    int ln = 0, tmp;\n\n    /* protect the lease file */\n    virNWFilterSnoopLock();\n\n    fp = fopen(LEASEFILE, \"r\");\n    time(&now);\n    while (fp && fgets(line, sizeof(line), fp)) {\n        if (line[strlen(line)-1] != '\\n') {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        ln++;\n        /* key len 54 = \"VMUUID\"+'-'+\"MAC\" */\n        if (sscanf(line, \"%u %54s %15s %15s\", &ipl.timeout,\n                   ifkey, ipstr, srvstr) < 4) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"virNWFilterSnoopLeaseFileLoad lease file \"\n                             \"line %d corrupt\"), ln);\n            break;\n        }\n        if (ipl.timeout && ipl.timeout < now)\n            continue;\n        req = virNWFilterSnoopReqGetByIFKey(ifkey);\n        if (!req) {\n            req = virNWFilterSnoopReqNew(ifkey);\n            if (!req)\n               break;\n\n            tmp = virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req);\n\n            if (tmp < 0) {\n                virNWFilterSnoopReqPut(req);\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"virNWFilterSnoopLeaseFileLoad req add\"\n                                 \" failed on interface \\\"%s\\\"\"), ifkey);\n                continue;\n            }\n        }\n\n        if (virSocketAddrParseIPv4(&ipl.ipAddress, ipstr) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"line %d corrupt ipaddr \\\"%s\\\"\"),\n                           ln, ipstr);\n            virNWFilterSnoopReqPut(req);\n            continue;\n        }\n        ignore_value(virSocketAddrParseIPv4(&ipl.ipServer, srvstr));\n        ipl.snoopReq = req;\n\n        if (ipl.timeout)\n            virNWFilterSnoopReqLeaseAdd(req, &ipl, false);\n        else\n            virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, false, false);\n\n        virNWFilterSnoopReqPut(req);\n    }\n\n    VIR_FORCE_FCLOSE(fp);\n\n    virNWFilterSnoopLeaseFileRefresh();\n\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&virNWFilterSnoopState.nLeases"
          ],
          "line": 1781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_add",
          "args": [
            "&virNWFilterSnoopState.wLeases",
            "1"
          ],
          "line": 1780
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileWrite",
          "args": [
            "virNWFilterSnoopState.leaseFD",
            "req->ifkey",
            "ipl"
          ],
          "line": 1775
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileWrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1723-1758",
          "snippet": "static int\nvirNWFilterSnoopLeaseFileWrite(int lfd, const char *ifkey,\n                               virNWFilterSnoopIPLeasePtr ipl)\n{\n    char *lbuf = NULL;\n    char *ipstr, *dhcpstr;\n    int len;\n    int ret = 0;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    dhcpstr = virSocketAddrFormat(&ipl->ipServer);\n\n    if (!dhcpstr || !ipstr) {\n        ret = -1;\n        goto cleanup;\n    }\n\n    /* time intf ip dhcpserver */\n    lbuf = g_strdup_printf(\"%u %s %s %s\\n\", ipl->timeout, ifkey, ipstr, dhcpstr);\n    len = strlen(lbuf);\n\n    if (safewrite(lfd, lbuf, len) != len) {\n        virReportSystemError(errno, \"%s\", _(\"lease file write failed\"));\n        ret = -1;\n        goto cleanup;\n    }\n\n    ignore_value(g_fsync(lfd));\n\n cleanup:\n    VIR_FREE(lbuf);\n    VIR_FREE(dhcpstr);\n    VIR_FREE(ipstr);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopLeaseFileWrite(int lfd, const char *ifkey,\n                               virNWFilterSnoopIPLeasePtr ipl)\n{\n    char *lbuf = NULL;\n    char *ipstr, *dhcpstr;\n    int len;\n    int ret = 0;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    dhcpstr = virSocketAddrFormat(&ipl->ipServer);\n\n    if (!dhcpstr || !ipstr) {\n        ret = -1;\n        goto cleanup;\n    }\n\n    /* time intf ip dhcpserver */\n    lbuf = g_strdup_printf(\"%u %s %s %s\\n\", ipl->timeout, ifkey, ipstr, dhcpstr);\n    len = strlen(lbuf);\n\n    if (safewrite(lfd, lbuf, len) != len) {\n        virReportSystemError(errno, \"%s\", _(\"lease file write failed\"));\n        ret = -1;\n        goto cleanup;\n    }\n\n    ignore_value(g_fsync(lfd));\n\n cleanup:\n    VIR_FREE(lbuf);\n    VIR_FREE(dhcpstr);\n    VIR_FREE(ipstr);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileOpen",
          "args": [],
          "line": 1774
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileOpen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1710-1717",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileOpen(void)\n{\n    virNWFilterSnoopLeaseFileClose();\n\n    virNWFilterSnoopState.leaseFD = open(LEASEFILE, O_CREAT|O_RDWR|O_APPEND,\n                                         0644);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileOpen(void)\n{\n    virNWFilterSnoopLeaseFileClose();\n\n    virNWFilterSnoopState.leaseFD = open(LEASEFILE, O_CREAT|O_RDWR|O_APPEND,\n                                         0644);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 1771
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileSave(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    virNWFilterSnoopLock();\n\n    if (virNWFilterSnoopState.leaseFD < 0)\n        virNWFilterSnoopLeaseFileOpen();\n    if (virNWFilterSnoopLeaseFileWrite(virNWFilterSnoopState.leaseFD,\n                                       req->ifkey, ipl) < 0)\n        goto err_exit;\n\n    /* keep dead leases at < ~95% of file size */\n    if (g_atomic_int_add(&virNWFilterSnoopState.wLeases, 1) >=\n        g_atomic_int_get(&virNWFilterSnoopState.nLeases) * 20)\n        virNWFilterSnoopLeaseFileLoad();   /* load & refresh lease file */\n\n err_exit:\n    virNWFilterSnoopUnlock();\n}"
  },
  {
    "function_name": "virNWFilterSnoopLeaseFileWrite",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1723-1758",
    "snippet": "static int\nvirNWFilterSnoopLeaseFileWrite(int lfd, const char *ifkey,\n                               virNWFilterSnoopIPLeasePtr ipl)\n{\n    char *lbuf = NULL;\n    char *ipstr, *dhcpstr;\n    int len;\n    int ret = 0;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    dhcpstr = virSocketAddrFormat(&ipl->ipServer);\n\n    if (!dhcpstr || !ipstr) {\n        ret = -1;\n        goto cleanup;\n    }\n\n    /* time intf ip dhcpserver */\n    lbuf = g_strdup_printf(\"%u %s %s %s\\n\", ipl->timeout, ifkey, ipstr, dhcpstr);\n    len = strlen(lbuf);\n\n    if (safewrite(lfd, lbuf, len) != len) {\n        virReportSystemError(errno, \"%s\", _(\"lease file write failed\"));\n        ret = -1;\n        goto cleanup;\n    }\n\n    ignore_value(g_fsync(lfd));\n\n cleanup:\n    VIR_FREE(lbuf);\n    VIR_FREE(dhcpstr);\n    VIR_FREE(ipstr);\n\n    return ret;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ipstr"
          ],
          "line": 1755
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dhcpstr"
          ],
          "line": 1754
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "lbuf"
          ],
          "line": 1753
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "g_fsync(lfd)"
          ],
          "line": 1750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_fsync",
          "args": [
            "lfd"
          ],
          "line": 1750
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_fsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "177-185",
          "snippet": "gint\nvir_g_fsync(gint fd)\n{\n#ifdef G_OS_WIN32\n    return _commit(fd);\n#else\n    return fsync(fd);\n#endif\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\ngint\nvir_g_fsync(gint fd)\n{\n#ifdef G_OS_WIN32\n    return _commit(fd);\n#else\n    return fsync(fd);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"lease file write failed\")"
          ],
          "line": 1745
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"lease file write failed\""
          ],
          "line": 1745
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "safewrite",
          "args": [
            "lfd",
            "lbuf",
            "len"
          ],
          "line": 1744
        },
        "resolved": true,
        "details": {
          "function_name": "safewrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1093-1111",
          "snippet": "ssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "lbuf"
          ],
          "line": 1742
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%u %s %s %s\\n\"",
            "ipl->timeout",
            "ifkey",
            "ipstr",
            "dhcpstr"
          ],
          "line": 1741
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSocketAddrFormat",
          "args": [
            "&ipl->ipServer"
          ],
          "line": 1733
        },
        "resolved": true,
        "details": {
          "function_name": "virSocketAddrFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocketaddr.c",
          "lines": "441-445",
          "snippet": "char *\nvirSocketAddrFormat(const virSocketAddr *addr)\n{\n    return virSocketAddrFormatFull(addr, false, NULL);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virsocketaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virsocketaddr.h\"\n#include <config.h>\n\nchar *\nvirSocketAddrFormat(const virSocketAddr *addr)\n{\n    return virSocketAddrFormatFull(addr, false, NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopLeaseFileWrite(int lfd, const char *ifkey,\n                               virNWFilterSnoopIPLeasePtr ipl)\n{\n    char *lbuf = NULL;\n    char *ipstr, *dhcpstr;\n    int len;\n    int ret = 0;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    dhcpstr = virSocketAddrFormat(&ipl->ipServer);\n\n    if (!dhcpstr || !ipstr) {\n        ret = -1;\n        goto cleanup;\n    }\n\n    /* time intf ip dhcpserver */\n    lbuf = g_strdup_printf(\"%u %s %s %s\\n\", ipl->timeout, ifkey, ipstr, dhcpstr);\n    len = strlen(lbuf);\n\n    if (safewrite(lfd, lbuf, len) != len) {\n        virReportSystemError(errno, \"%s\", _(\"lease file write failed\"));\n        ret = -1;\n        goto cleanup;\n    }\n\n    ignore_value(g_fsync(lfd));\n\n cleanup:\n    VIR_FREE(lbuf);\n    VIR_FREE(dhcpstr);\n    VIR_FREE(ipstr);\n\n    return ret;\n}"
  },
  {
    "function_name": "virNWFilterSnoopLeaseFileOpen",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1710-1717",
    "snippet": "static void\nvirNWFilterSnoopLeaseFileOpen(void)\n{\n    virNWFilterSnoopLeaseFileClose();\n\n    virNWFilterSnoopState.leaseFD = open(LEASEFILE, O_CREAT|O_RDWR|O_APPEND,\n                                         0644);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "open",
          "args": [
            "LEASEFILE",
            "O_CREAT|O_RDWR|O_APPEND",
            "0644"
          ],
          "line": 1715
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockReopenReadOnly",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "3308-3323",
          "snippet": "int\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nint\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileClose",
          "args": [],
          "line": 1713
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1704-1708",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileClose(void)\n{\n    VIR_FORCE_CLOSE(virNWFilterSnoopState.leaseFD);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileClose(void)\n{\n    VIR_FORCE_CLOSE(virNWFilterSnoopState.leaseFD);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileOpen(void)\n{\n    virNWFilterSnoopLeaseFileClose();\n\n    virNWFilterSnoopState.leaseFD = open(LEASEFILE, O_CREAT|O_RDWR|O_APPEND,\n                                         0644);\n}"
  },
  {
    "function_name": "virNWFilterSnoopLeaseFileClose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1704-1708",
    "snippet": "static void\nvirNWFilterSnoopLeaseFileClose(void)\n{\n    VIR_FORCE_CLOSE(virNWFilterSnoopState.leaseFD);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "virNWFilterSnoopState.leaseFD"
          ],
          "line": 1707
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileClose(void)\n{\n    VIR_FORCE_CLOSE(virNWFilterSnoopState.leaseFD);\n}"
  },
  {
    "function_name": "virNWFilterDHCPSnoopReq",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1560-1702",
    "snippet": "int\nvirNWFilterDHCPSnoopReq(virNWFilterTechDriverPtr techdriver,\n                        virNWFilterBindingDefPtr binding,\n                        virNWFilterDriverStatePtr driver)\n{\n    virNWFilterSnoopReqPtr req;\n    bool isnewreq;\n    char ifkey[VIR_IFKEY_LEN];\n    int tmp;\n    virThread thread;\n    virNWFilterVarValuePtr dhcpsrvrs;\n    bool threadPuts = false;\n\n    virNWFilterSnoopIFKeyFMT(ifkey, binding->owneruuid, &binding->mac);\n\n    req = virNWFilterSnoopReqGetByIFKey(ifkey);\n    isnewreq = (req == NULL);\n    if (!isnewreq) {\n        if (req->threadkey) {\n            virNWFilterSnoopReqPut(req);\n            return 0;\n        }\n        virNWFilterBindingDefFree(req->binding);\n        req->binding = NULL;\n    } else {\n        req = virNWFilterSnoopReqNew(ifkey);\n        if (!req)\n            return -1;\n    }\n\n    req->driver = driver;\n    req->techdriver = techdriver;\n    if ((tmp = virNetDevGetIndex(binding->portdevname, &req->ifindex)) < 0)\n        goto exit_snoopreqput;\n    if (!(req->binding = virNWFilterBindingDefCopy(binding)))\n        goto exit_snoopreqput;\n\n    /* check that all tools are available for applying the filters (late) */\n    if (!techdriver->canApplyBasicRules()) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"IP parameter must be provided since \"\n                         \"snooping the IP address does not work \"\n                         \"possibly due to missing tools\"));\n        goto exit_snoopreqput;\n    }\n\n    dhcpsrvrs = virHashLookup(binding->filterparams,\n                              NWFILTER_VARNAME_DHCPSERVER);\n\n    if (techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                       &req->binding->mac,\n                                       dhcpsrvrs, false) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"applyDHCPOnlyRules \"\n                         \"failed - spoofing not protected!\"));\n        goto exit_snoopreqput;\n    }\n\n    virNWFilterSnoopLock();\n\n    if (virHashAddEntry(virNWFilterSnoopState.ifnameToKey,\n                        req->binding->portdevname,\n                        req->ifkey) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterDHCPSnoopReq ifname map failed\"\n                         \" on interface \\\"%s\\\" key \\\"%s\\\"\"), binding->portdevname,\n                       ifkey);\n        goto exit_snoopunlock;\n    }\n\n    if (isnewreq &&\n        virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterDHCPSnoopReq req add failed on\"\n                         \" interface \\\"%s\\\" ifkey \\\"%s\\\"\"), binding->portdevname,\n                       ifkey);\n        goto exit_rem_ifnametokey;\n    }\n\n    /* prevent thread from holding req */\n    virNWFilterSnoopReqLock(req);\n\n    if (virThreadCreateFull(&thread, false, virNWFilterDHCPSnoopThread,\n                            \"dhcp-snoop\", false, req) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterDHCPSnoopReq virThreadCreate \"\n                         \"failed on interface '%s'\"), binding->portdevname);\n        goto exit_snoopreq_unlock;\n    }\n\n    threadPuts = true;\n\n    g_atomic_int_add(&virNWFilterSnoopState.nThreads, 1);\n\n    req->threadkey = virNWFilterSnoopActivate(req);\n    if (!req->threadkey) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Activation of snoop request failed on \"\n                         \"interface '%s'\"), req->binding->portdevname);\n        goto exit_snoopreq_unlock;\n    }\n\n    if (virNWFilterSnoopReqRestore(req) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Restoring of leases failed on \"\n                         \"interface '%s'\"), req->binding->portdevname);\n        goto exit_snoop_cancel;\n    }\n\n    /* sync with thread */\n    if (virCondWait(&req->threadStatusCond, &req->lock) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"unable to wait on dhcp snoop thread\"));\n        goto exit_snoop_cancel;\n    }\n\n    if (req->threadStatus != THREAD_STATUS_OK) {\n        virErrorRestore(&req->threadError);\n        goto exit_snoop_cancel;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    virNWFilterSnoopUnlock();\n\n    /* do not 'put' the req -- the thread will do this */\n\n    return 0;\n\n exit_snoop_cancel:\n    virNWFilterSnoopCancel(&req->threadkey);\n exit_snoopreq_unlock:\n    virNWFilterSnoopReqUnlock(req);\n exit_rem_ifnametokey:\n    virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey, binding->portdevname);\n exit_snoopunlock:\n    virNWFilterSnoopUnlock();\n exit_snoopreqput:\n    if (!threadPuts)\n        virNWFilterSnoopReqPut(req);\n\n    return -1;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqPut",
          "args": [
            "req"
          ],
          "line": 1699
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqPut",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "686-711",
          "snippet": "static void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 1696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "virNWFilterSnoopState.ifnameToKey",
            "binding->portdevname"
          ],
          "line": 1694
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 1692
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopCancel",
          "args": [
            "&req->threadkey"
          ],
          "line": 1690
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopCancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "309-321",
          "snippet": "static void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 1683
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virErrorRestore",
          "args": [
            "&req->threadError"
          ],
          "line": 1677
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorRestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "445-457",
          "snippet": "void\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"unable to wait on dhcp snoop thread\")"
          ],
          "line": 1671
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unable to wait on dhcp snoop thread\""
          ],
          "line": 1672
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCondWait",
          "args": [
            "&req->threadStatusCond",
            "&req->lock"
          ],
          "line": 1670
        },
        "resolved": true,
        "details": {
          "function_name": "virCondWait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "145-153",
          "snippet": "int virCondWait(virCondPtr c, virMutexPtr m)\n{\n    int ret;\n    if ((ret = pthread_cond_wait(&c->cond, &m->lock)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondWait(virCondPtr c, virMutexPtr m)\n{\n    int ret;\n    if ((ret = pthread_cond_wait(&c->cond, &m->lock)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Restoring of leases failed on \"\n                         \"interface '%s'\")",
            "req->binding->portdevname"
          ],
          "line": 1663
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqRestore",
          "args": [
            "req"
          ],
          "line": 1662
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqRestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "771-792",
          "snippet": "static int\nvirNWFilterSnoopReqRestore(virNWFilterSnoopReqPtr req)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    for (ipl = req->start; ipl; ipl = ipl->next) {\n        /* instantiate the rules at the last lease */\n        bool is_last = (ipl->next == NULL);\n        if (virNWFilterSnoopIPLeaseInstallRule(ipl, is_last) < 0) {\n            ret = -1;\n            break;\n        }\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqRestore(virNWFilterSnoopReqPtr req)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    for (ipl = req->start; ipl; ipl = ipl->next) {\n        /* instantiate the rules at the last lease */\n        bool is_last = (ipl->next == NULL);\n        if (virNWFilterSnoopIPLeaseInstallRule(ipl, is_last) < 0) {\n            ret = -1;\n            break;\n        }\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Activation of snoop request failed on \"\n                         \"interface '%s'\")",
            "req->binding->portdevname"
          ],
          "line": 1656
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopActivate",
          "args": [
            "req"
          ],
          "line": 1654
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopActivate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "292-307",
          "snippet": "static char *\nvirNWFilterSnoopActivate(virNWFilterSnoopReqPtr req)\n{\n    char *key;\n\n    key = g_strdup_printf(\"%p-%d\", req, req->ifindex);\n\n    virNWFilterSnoopActiveLock();\n\n    if (virHashAddEntry(virNWFilterSnoopState.active, key, (void *)0x1) < 0)\n        VIR_FREE(key);\n\n    virNWFilterSnoopActiveUnlock();\n\n    return key;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic char *\nvirNWFilterSnoopActivate(virNWFilterSnoopReqPtr req)\n{\n    char *key;\n\n    key = g_strdup_printf(\"%p-%d\", req, req->ifindex);\n\n    virNWFilterSnoopActiveLock();\n\n    if (virHashAddEntry(virNWFilterSnoopState.active, key, (void *)0x1) < 0)\n        VIR_FREE(key);\n\n    virNWFilterSnoopActiveUnlock();\n\n    return key;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_add",
          "args": [
            "&virNWFilterSnoopState.nThreads",
            "1"
          ],
          "line": 1652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"virNWFilterDHCPSnoopReq virThreadCreate \"\n                         \"failed on interface '%s'\")",
            "binding->portdevname"
          ],
          "line": 1644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virThreadCreateFull",
          "args": [
            "&thread",
            "false",
            "virNWFilterDHCPSnoopThread",
            "\"dhcp-snoop\"",
            "false",
            "req"
          ],
          "line": 1642
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadCreateFull",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "242-283",
          "snippet": "int virThreadCreateFull(virThreadPtr thread,\n                        bool joinable,\n                        virThreadFunc func,\n                        const char *name,\n                        bool worker,\n                        void *opaque)\n{\n    struct virThreadArgs *args;\n    pthread_attr_t attr;\n    int ret = -1;\n    int err;\n\n    if ((err = pthread_attr_init(&attr)) != 0)\n        goto cleanup;\n    if (VIR_ALLOC_QUIET(args) < 0) {\n        err = ENOMEM;\n        goto cleanup;\n    }\n\n    args->func = func;\n    args->name = g_strdup(name);\n    args->worker = worker;\n    args->opaque = opaque;\n\n    if (!joinable)\n        pthread_attr_setdetachstate(&attr, 1);\n\n    err = pthread_create(&thread->thread, &attr, virThreadHelper, args);\n    if (err != 0) {\n        g_free(args->name);\n        g_free(args);\n        goto cleanup;\n    }\n    /* New thread owns 'args' in success case, so don't free */\n\n    ret = 0;\n cleanup:\n    pthread_attr_destroy(&attr);\n    if (ret < 0)\n        errno = err;\n    return ret;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadCreateFull(virThreadPtr thread,\n                        bool joinable,\n                        virThreadFunc func,\n                        const char *name,\n                        bool worker,\n                        void *opaque)\n{\n    struct virThreadArgs *args;\n    pthread_attr_t attr;\n    int ret = -1;\n    int err;\n\n    if ((err = pthread_attr_init(&attr)) != 0)\n        goto cleanup;\n    if (VIR_ALLOC_QUIET(args) < 0) {\n        err = ENOMEM;\n        goto cleanup;\n    }\n\n    args->func = func;\n    args->name = g_strdup(name);\n    args->worker = worker;\n    args->opaque = opaque;\n\n    if (!joinable)\n        pthread_attr_setdetachstate(&attr, 1);\n\n    err = pthread_create(&thread->thread, &attr, virThreadHelper, args);\n    if (err != 0) {\n        g_free(args->name);\n        g_free(args);\n        goto cleanup;\n    }\n    /* New thread owns 'args' in success case, so don't free */\n\n    ret = 0;\n cleanup:\n    pthread_attr_destroy(&attr);\n    if (ret < 0)\n        errno = err;\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 1640
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"virNWFilterDHCPSnoopReq req add failed on\"\n                         \" interface \\\"%s\\\" ifkey \\\"%s\\\"\")",
            "binding->portdevname",
            "ifkey"
          ],
          "line": 1632
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "virNWFilterSnoopState.snoopReqs",
            "ifkey",
            "req"
          ],
          "line": 1631
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"virNWFilterDHCPSnoopReq ifname map failed\"\n                         \" on interface \\\"%s\\\" key \\\"%s\\\"\")",
            "binding->portdevname",
            "ifkey"
          ],
          "line": 1623
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 1618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"applyDHCPOnlyRules \"\n                         \"failed - spoofing not protected!\")"
          ],
          "line": 1612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "techdriver->applyDHCPOnlyRules",
          "args": [
            "req->binding->portdevname",
            "&req->binding->mac",
            "dhcpsrvrs",
            "false"
          ],
          "line": 1609
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "binding->filterparams",
            "NWFILTER_VARNAME_DHCPSERVER"
          ],
          "line": 1606
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"IP parameter must be provided since \"\n                         \"snooping the IP address does not work \"\n                         \"possibly due to missing tools\")"
          ],
          "line": 1599
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "techdriver->canApplyBasicRules",
          "args": [],
          "line": 1598
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterBindingDefCopy",
          "args": [
            "binding"
          ],
          "line": 1594
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterBindingDefCopy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnwfilterbindingdef.c",
          "lines": "49-80",
          "snippet": "virNWFilterBindingDefPtr\nvirNWFilterBindingDefCopy(virNWFilterBindingDefPtr src)\n{\n    virNWFilterBindingDefPtr ret;\n\n    if (VIR_ALLOC(ret) < 0)\n        return NULL;\n\n    ret->ownername = g_strdup(src->ownername);\n\n    memcpy(ret->owneruuid, src->owneruuid, sizeof(ret->owneruuid));\n\n    ret->portdevname = g_strdup(src->portdevname);\n\n    ret->linkdevname = g_strdup(src->linkdevname);\n\n    ret->mac = src->mac;\n\n    ret->filter = g_strdup(src->filter);\n\n    if (!(ret->filterparams = virNWFilterHashTableCreate(0)))\n        goto error;\n\n    if (virNWFilterHashTablePutAll(src->filterparams, ret->filterparams) < 0)\n        goto error;\n\n    return ret;\n\n error:\n    virNWFilterBindingDefFree(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virnwfilterbindingdef.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virnwfilterbindingdef.h\"\n#include \"nwfilter_params.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nvirNWFilterBindingDefPtr\nvirNWFilterBindingDefCopy(virNWFilterBindingDefPtr src)\n{\n    virNWFilterBindingDefPtr ret;\n\n    if (VIR_ALLOC(ret) < 0)\n        return NULL;\n\n    ret->ownername = g_strdup(src->ownername);\n\n    memcpy(ret->owneruuid, src->owneruuid, sizeof(ret->owneruuid));\n\n    ret->portdevname = g_strdup(src->portdevname);\n\n    ret->linkdevname = g_strdup(src->linkdevname);\n\n    ret->mac = src->mac;\n\n    ret->filter = g_strdup(src->filter);\n\n    if (!(ret->filterparams = virNWFilterHashTableCreate(0)))\n        goto error;\n\n    if (virNWFilterHashTablePutAll(src->filterparams, ret->filterparams) < 0)\n        goto error;\n\n    return ret;\n\n error:\n    virNWFilterBindingDefFree(ret);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevGetIndex",
          "args": [
            "binding->portdevname",
            "&req->ifindex"
          ],
          "line": 1592
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevGetIndex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "893-899",
          "snippet": "int virNetDevGetIndex(const char *ifname G_GNUC_UNUSED,\n                      int *ifindex G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to get interface index on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevGetIndex(const char *ifname G_GNUC_UNUSED,\n                      int *ifindex G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to get interface index on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqNew",
          "args": [
            "ifkey"
          ],
          "line": 1585
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "551-588",
          "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqNew(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    if (ifkey == NULL || strlen(ifkey) != VIR_IFKEY_LEN - 1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterSnoopReqNew called with invalid \"\n                         \"key \\\"%s\\\" (%zu)\"),\n                       NULLSTR_EMPTY(ifkey),\n                       ifkey ? strlen(ifkey) : 0);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(req) < 0)\n        return NULL;\n\n    req->threadStatus = THREAD_STATUS_NONE;\n\n    if (virStrcpyStatic(req->ifkey, ifkey) < 0||\n        virMutexInitRecursive(&req->lock) < 0)\n        goto err_free_req;\n\n    if (virCondInit(&req->threadStatusCond) < 0)\n        goto err_destroy_mutex;\n\n    virNWFilterSnoopReqGet(req);\n\n    return req;\n\n err_destroy_mutex:\n    virMutexDestroy(&req->lock);\n\n err_free_req:\n    VIR_FREE(req);\n\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqNew(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    if (ifkey == NULL || strlen(ifkey) != VIR_IFKEY_LEN - 1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterSnoopReqNew called with invalid \"\n                         \"key \\\"%s\\\" (%zu)\"),\n                       NULLSTR_EMPTY(ifkey),\n                       ifkey ? strlen(ifkey) : 0);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(req) < 0)\n        return NULL;\n\n    req->threadStatus = THREAD_STATUS_NONE;\n\n    if (virStrcpyStatic(req->ifkey, ifkey) < 0||\n        virMutexInitRecursive(&req->lock) < 0)\n        goto err_free_req;\n\n    if (virCondInit(&req->threadStatusCond) < 0)\n        goto err_destroy_mutex;\n\n    virNWFilterSnoopReqGet(req);\n\n    return req;\n\n err_destroy_mutex:\n    virMutexDestroy(&req->lock);\n\n err_free_req:\n    VIR_FREE(req);\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterBindingDefFree",
          "args": [
            "req->binding"
          ],
          "line": 1582
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterBindingDefFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnwfilterbindingdef.c",
          "lines": "33-46",
          "snippet": "void\nvirNWFilterBindingDefFree(virNWFilterBindingDefPtr def)\n{\n    if (!def)\n        return;\n\n    VIR_FREE(def->ownername);\n    VIR_FREE(def->portdevname);\n    VIR_FREE(def->linkdevname);\n    VIR_FREE(def->filter);\n    virHashFree(def->filterparams);\n\n    VIR_FREE(def);\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virnwfilterbindingdef.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virnwfilterbindingdef.h\"\n#include \"nwfilter_params.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nvoid\nvirNWFilterBindingDefFree(virNWFilterBindingDefPtr def)\n{\n    if (!def)\n        return;\n\n    VIR_FREE(def->ownername);\n    VIR_FREE(def->portdevname);\n    VIR_FREE(def->linkdevname);\n    VIR_FREE(def->filter);\n    virHashFree(def->filterparams);\n\n    VIR_FREE(def);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqGetByIFKey",
          "args": [
            "ifkey"
          ],
          "line": 1575
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqGetByIFKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "666-680",
          "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIFKeyFMT",
          "args": [
            "ifkey",
            "binding->owneruuid",
            "&binding->mac"
          ],
          "line": 1573
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIFKeyFMT",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1551-1558",
          "snippet": "static void\nvirNWFilterSnoopIFKeyFMT(char *ifkey, const unsigned char *vmuuid,\n                         const virMacAddr *macaddr)\n{\n    virUUIDFormat(vmuuid, ifkey);\n    ifkey[VIR_UUID_STRING_BUFLEN - 1] = '-';\n    virMacAddrFormat(macaddr, ifkey + VIR_UUID_STRING_BUFLEN);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIFKeyFMT(char *ifkey, const unsigned char *vmuuid,\n                         const virMacAddr *macaddr)\n{\n    virUUIDFormat(vmuuid, ifkey);\n    ifkey[VIR_UUID_STRING_BUFLEN - 1] = '-';\n    virMacAddrFormat(macaddr, ifkey + VIR_UUID_STRING_BUFLEN);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nint\nvirNWFilterDHCPSnoopReq(virNWFilterTechDriverPtr techdriver,\n                        virNWFilterBindingDefPtr binding,\n                        virNWFilterDriverStatePtr driver)\n{\n    virNWFilterSnoopReqPtr req;\n    bool isnewreq;\n    char ifkey[VIR_IFKEY_LEN];\n    int tmp;\n    virThread thread;\n    virNWFilterVarValuePtr dhcpsrvrs;\n    bool threadPuts = false;\n\n    virNWFilterSnoopIFKeyFMT(ifkey, binding->owneruuid, &binding->mac);\n\n    req = virNWFilterSnoopReqGetByIFKey(ifkey);\n    isnewreq = (req == NULL);\n    if (!isnewreq) {\n        if (req->threadkey) {\n            virNWFilterSnoopReqPut(req);\n            return 0;\n        }\n        virNWFilterBindingDefFree(req->binding);\n        req->binding = NULL;\n    } else {\n        req = virNWFilterSnoopReqNew(ifkey);\n        if (!req)\n            return -1;\n    }\n\n    req->driver = driver;\n    req->techdriver = techdriver;\n    if ((tmp = virNetDevGetIndex(binding->portdevname, &req->ifindex)) < 0)\n        goto exit_snoopreqput;\n    if (!(req->binding = virNWFilterBindingDefCopy(binding)))\n        goto exit_snoopreqput;\n\n    /* check that all tools are available for applying the filters (late) */\n    if (!techdriver->canApplyBasicRules()) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"IP parameter must be provided since \"\n                         \"snooping the IP address does not work \"\n                         \"possibly due to missing tools\"));\n        goto exit_snoopreqput;\n    }\n\n    dhcpsrvrs = virHashLookup(binding->filterparams,\n                              NWFILTER_VARNAME_DHCPSERVER);\n\n    if (techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                       &req->binding->mac,\n                                       dhcpsrvrs, false) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"applyDHCPOnlyRules \"\n                         \"failed - spoofing not protected!\"));\n        goto exit_snoopreqput;\n    }\n\n    virNWFilterSnoopLock();\n\n    if (virHashAddEntry(virNWFilterSnoopState.ifnameToKey,\n                        req->binding->portdevname,\n                        req->ifkey) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterDHCPSnoopReq ifname map failed\"\n                         \" on interface \\\"%s\\\" key \\\"%s\\\"\"), binding->portdevname,\n                       ifkey);\n        goto exit_snoopunlock;\n    }\n\n    if (isnewreq &&\n        virHashAddEntry(virNWFilterSnoopState.snoopReqs, ifkey, req) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterDHCPSnoopReq req add failed on\"\n                         \" interface \\\"%s\\\" ifkey \\\"%s\\\"\"), binding->portdevname,\n                       ifkey);\n        goto exit_rem_ifnametokey;\n    }\n\n    /* prevent thread from holding req */\n    virNWFilterSnoopReqLock(req);\n\n    if (virThreadCreateFull(&thread, false, virNWFilterDHCPSnoopThread,\n                            \"dhcp-snoop\", false, req) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterDHCPSnoopReq virThreadCreate \"\n                         \"failed on interface '%s'\"), binding->portdevname);\n        goto exit_snoopreq_unlock;\n    }\n\n    threadPuts = true;\n\n    g_atomic_int_add(&virNWFilterSnoopState.nThreads, 1);\n\n    req->threadkey = virNWFilterSnoopActivate(req);\n    if (!req->threadkey) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Activation of snoop request failed on \"\n                         \"interface '%s'\"), req->binding->portdevname);\n        goto exit_snoopreq_unlock;\n    }\n\n    if (virNWFilterSnoopReqRestore(req) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Restoring of leases failed on \"\n                         \"interface '%s'\"), req->binding->portdevname);\n        goto exit_snoop_cancel;\n    }\n\n    /* sync with thread */\n    if (virCondWait(&req->threadStatusCond, &req->lock) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"unable to wait on dhcp snoop thread\"));\n        goto exit_snoop_cancel;\n    }\n\n    if (req->threadStatus != THREAD_STATUS_OK) {\n        virErrorRestore(&req->threadError);\n        goto exit_snoop_cancel;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    virNWFilterSnoopUnlock();\n\n    /* do not 'put' the req -- the thread will do this */\n\n    return 0;\n\n exit_snoop_cancel:\n    virNWFilterSnoopCancel(&req->threadkey);\n exit_snoopreq_unlock:\n    virNWFilterSnoopReqUnlock(req);\n exit_rem_ifnametokey:\n    virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey, binding->portdevname);\n exit_snoopunlock:\n    virNWFilterSnoopUnlock();\n exit_snoopreqput:\n    if (!threadPuts)\n        virNWFilterSnoopReqPut(req);\n\n    return -1;\n}"
  },
  {
    "function_name": "virNWFilterSnoopIFKeyFMT",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1551-1558",
    "snippet": "static void\nvirNWFilterSnoopIFKeyFMT(char *ifkey, const unsigned char *vmuuid,\n                         const virMacAddr *macaddr)\n{\n    virUUIDFormat(vmuuid, ifkey);\n    ifkey[VIR_UUID_STRING_BUFLEN - 1] = '-';\n    virMacAddrFormat(macaddr, ifkey + VIR_UUID_STRING_BUFLEN);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMacAddrFormat",
          "args": [
            "macaddr",
            "ifkey + VIR_UUID_STRING_BUFLEN"
          ],
          "line": 1557
        },
        "resolved": true,
        "details": {
          "function_name": "virMacAddrFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmacaddr.c",
          "lines": "184-194",
          "snippet": "const char *\nvirMacAddrFormat(const virMacAddr *addr,\n                 char *str)\n{\n    g_snprintf(str, VIR_MAC_STRING_BUFLEN,\n               \"%02x:%02x:%02x:%02x:%02x:%02x\",\n               addr->addr[0], addr->addr[1], addr->addr[2],\n               addr->addr[3], addr->addr[4], addr->addr[5]);\n    str[VIR_MAC_STRING_BUFLEN-1] = '\\0';\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virrandom.h\"",
            "#include \"virmacaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virrandom.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nconst char *\nvirMacAddrFormat(const virMacAddr *addr,\n                 char *str)\n{\n    g_snprintf(str, VIR_MAC_STRING_BUFLEN,\n               \"%02x:%02x:%02x:%02x:%02x:%02x\",\n               addr->addr[0], addr->addr[1], addr->addr[2],\n               addr->addr[3], addr->addr[4], addr->addr[5]);\n    str[VIR_MAC_STRING_BUFLEN-1] = '\\0';\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "vmuuid",
            "ifkey"
          ],
          "line": 1555
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIFKeyFMT(char *ifkey, const unsigned char *vmuuid,\n                         const virMacAddr *macaddr)\n{\n    virUUIDFormat(vmuuid, ifkey);\n    ifkey[VIR_UUID_STRING_BUFLEN - 1] = '-';\n    virMacAddrFormat(macaddr, ifkey + VIR_UUID_STRING_BUFLEN);\n}"
  },
  {
    "function_name": "virNWFilterDHCPSnoopThread",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1303-1549",
    "snippet": "static void\nvirNWFilterDHCPSnoopThread(void *req0)\n{\n    virNWFilterSnoopReqPtr req = req0;\n    struct pcap_pkthdr *hdr;\n    virNWFilterSnoopEthHdrPtr packet;\n    int ifindex = 0;\n    int errcount = 0;\n    int tmp = -1, rv, n, pollTo;\n    size_t i;\n    char *threadkey = NULL;\n    virThreadPoolPtr worker = NULL;\n    time_t last_displayed = 0, last_displayed_queue = 0;\n    virNWFilterSnoopPcapConf pcapConf[] = {\n        {\n            .dir = PCAP_D_IN, /* from VM */\n            .filter = \"dst port 67 and src port 68\",\n            .rateLimit = {\n                .prev = time(0),\n                .rate = DHCP_PKT_RATE,\n                .burstRate = DHCP_PKT_BURST,\n                .burstInterval = DHCP_BURST_INTERVAL_S,\n            },\n            .maxQSize = MAX_QUEUED_JOBS,\n        }, {\n            .dir = PCAP_D_OUT, /* to VM */\n            .filter = \"src port 67 and dst port 68\",\n            .rateLimit = {\n                .prev = time(0),\n                .rate = DHCP_PKT_RATE,\n                .burstRate = DHCP_PKT_BURST,\n                .burstInterval = DHCP_BURST_INTERVAL_S,\n            },\n            .maxQSize = MAX_QUEUED_JOBS,\n        },\n    };\n    struct pollfd fds[] = {\n        {\n            /* get a POLLERR if interface goes down or disappears */\n            .events = POLLIN | POLLERR,\n        }, {\n            .events = POLLIN | POLLERR,\n        },\n    };\n    bool error = false;\n\n    /* whoever started us increased the reference counter for the req for us */\n\n    /* protect req->binding->portdevname & req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->binding->portdevname && req->threadkey) {\n        for (i = 0; i < G_N_ELEMENTS(pcapConf); i++) {\n            pcapConf[i].handle =\n                virNWFilterSnoopDHCPOpen(req->binding->portdevname,\n                                         &req->binding->mac,\n                                         pcapConf[i].filter,\n                                         pcapConf[i].dir);\n            if (!pcapConf[i].handle) {\n                error = true;\n                break;\n            }\n            fds[i].fd = pcap_fileno(pcapConf[i].handle);\n        }\n        tmp = virNetDevGetIndex(req->binding->portdevname, &ifindex);\n        threadkey = g_strdup(req->threadkey);\n        worker = virThreadPoolNewFull(1, 1, 0,\n                                      virNWFilterDHCPDecodeWorker,\n                                      \"dhcp-decode\",\n                                      req);\n    }\n\n    /* let creator know how well we initialized */\n    if (error || !threadkey || tmp < 0 || !worker ||\n        ifindex != req->ifindex) {\n        virErrorPreserveLast(&req->threadError);\n        req->threadStatus = THREAD_STATUS_FAIL;\n    } else {\n        req->threadStatus = THREAD_STATUS_OK;\n    }\n\n    virCondSignal(&req->threadStatusCond);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    if (req->threadStatus != THREAD_STATUS_OK)\n        goto exit;\n\n    while (!error) {\n        if (virNWFilterSnoopAdjustPoll(pcapConf,\n                                       G_N_ELEMENTS(pcapConf),\n                                       fds, &pollTo) < 0) {\n            break;\n        }\n\n        /* cap pollTo so we don't hold up the join for too long */\n        if (pollTo < 0 || pollTo > SNOOP_POLL_MAX_TIMEOUT_MS)\n            pollTo = SNOOP_POLL_MAX_TIMEOUT_MS;\n\n        n = poll(fds, G_N_ELEMENTS(fds), pollTo);\n\n        if (n < 0) {\n            if (errno != EAGAIN && errno != EINTR)\n                error = true;\n        }\n\n        virNWFilterSnoopReqLeaseTimerRun(req);\n\n        /*\n         * Check whether we were cancelled or whether\n         * a previously submitted job failed.\n         */\n        if (!virNWFilterSnoopIsActive(threadkey) ||\n            req->jobCompletionStatus != 0)\n            goto exit;\n\n        for (i = 0; n > 0 && i < G_N_ELEMENTS(fds); i++) {\n            if (!fds[i].revents)\n                continue;\n\n            fds[i].revents = 0;\n            n--;\n\n            rv = pcap_next_ex(pcapConf[i].handle, &hdr,\n                              (const u_char **)&packet);\n\n            if (rv < 0) {\n                /* error reading from socket */\n                tmp = -1;\n\n                /* protect req->binding->portdevname */\n                virNWFilterSnoopReqLock(req);\n\n                if (req->binding->portdevname)\n                    tmp = virNetDevValidateConfig(req->binding->portdevname, NULL, ifindex);\n\n                virNWFilterSnoopReqUnlock(req);\n\n                if (tmp <= 0) {\n                    error = true;\n                    break;\n                }\n\n                if (++errcount > PCAP_READ_MAXERRS) {\n                    pcap_close(pcapConf[i].handle);\n                    pcapConf[i].handle = NULL;\n\n                    /* protect req->binding->portdevname */\n                    virNWFilterSnoopReqLock(req);\n\n                    virReportError(VIR_ERR_INTERNAL_ERROR,\n                                   _(\"interface '%s' failing; \"\n                                     \"reopening\"),\n                                   req->binding->portdevname);\n                    if (req->binding->portdevname)\n                        pcapConf[i].handle =\n                            virNWFilterSnoopDHCPOpen(req->binding->portdevname,\n                                                     &req->binding->mac,\n                                                     pcapConf[i].filter,\n                                                     pcapConf[i].dir);\n\n                    virNWFilterSnoopReqUnlock(req);\n\n                    if (!pcapConf[i].handle) {\n                        error = true;\n                        break;\n                    }\n                }\n                continue;\n            }\n\n            errcount = 0;\n\n            if (rv) {\n                unsigned int diff;\n\n                /* submit packet to worker thread */\n                if (g_atomic_int_get(&pcapConf[i].qCtr) >\n                    pcapConf[i].maxQSize) {\n                    if (last_displayed_queue - time(0) > 10) {\n                        last_displayed_queue = time(0);\n                        VIR_WARN(\"Worker thread for interface '%s' has a \"\n                                 \"job queue that is too long\",\n                                 req->binding->portdevname);\n                    }\n                    continue;\n                }\n\n                diff = virNWFilterSnoopRateLimit(&pcapConf[i].rateLimit);\n                if (diff > 0) {\n                    virNWFilterSnoopRatePenalty(&pcapConf[i], diff,\n                                                DHCP_PKT_RATE);\n                    /* rate-limited warnings */\n                    if (time(0) - last_displayed > 10) {\n                         last_displayed = time(0);\n                         VIR_WARN(\"Too many DHCP packets on interface '%s'\",\n                                  req->binding->portdevname);\n                    }\n                    continue;\n                }\n\n                if (virNWFilterSnoopDHCPDecodeJobSubmit(worker, packet,\n                                                      hdr->caplen,\n                                                      pcapConf[i].dir,\n                                                      &pcapConf[i].qCtr) < 0) {\n                    virReportError(VIR_ERR_INTERNAL_ERROR,\n                                   _(\"Job submission failed on \"\n                                     \"interface '%s'\"), req->binding->portdevname);\n                    error = true;\n                    break;\n                }\n            }\n        } /* for all fds */\n    } /* while (!error) */\n\n    /* protect IfNameToKey */\n    virNWFilterSnoopLock();\n\n    /* protect req->binding->portdevname & req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopCancel(&req->threadkey);\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                    req->binding->portdevname));\n\n    VIR_FREE(req->binding->portdevname);\n\n    virNWFilterSnoopReqUnlock(req);\n    virNWFilterSnoopUnlock();\n\n exit:\n    virThreadPoolFree(worker);\n\n    virNWFilterSnoopReqPut(req);\n\n    VIR_FREE(threadkey);\n\n    for (i = 0; i < G_N_ELEMENTS(pcapConf); i++) {\n        if (pcapConf[i].handle)\n            pcap_close(pcapConf[i].handle);\n    }\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nThreads));\n\n    return;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nThreads)"
          ],
          "line": 1546
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_dec_and_test",
          "args": [
            "&virNWFilterSnoopState.nThreads"
          ],
          "line": 1546
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_close",
          "args": [
            "pcapConf[i].handle"
          ],
          "line": 1543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "pcapConf"
          ],
          "line": 1541
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "threadkey"
          ],
          "line": 1539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqPut",
          "args": [
            "req"
          ],
          "line": 1537
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqPut",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "686-711",
          "snippet": "static void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virThreadPoolFree",
          "args": [
            "worker"
          ],
          "line": 1535
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadPoolFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthreadpool.c",
          "lines": "274-309",
          "snippet": "void virThreadPoolFree(virThreadPoolPtr pool)\n{\n    virThreadPoolJobPtr job;\n    bool priority = false;\n\n    if (!pool)\n        return;\n\n    virMutexLock(&pool->mutex);\n    pool->quit = true;\n    if (pool->nWorkers > 0)\n        virCondBroadcast(&pool->cond);\n    if (pool->nPrioWorkers > 0) {\n        priority = true;\n        virCondBroadcast(&pool->prioCond);\n    }\n\n    while (pool->nWorkers > 0 || pool->nPrioWorkers > 0)\n        ignore_value(virCondWait(&pool->quit_cond, &pool->mutex));\n\n    while ((job = pool->jobList.head)) {\n        pool->jobList.head = pool->jobList.head->next;\n        VIR_FREE(job);\n    }\n\n    VIR_FREE(pool->workers);\n    virMutexUnlock(&pool->mutex);\n    virMutexDestroy(&pool->mutex);\n    virCondDestroy(&pool->quit_cond);\n    virCondDestroy(&pool->cond);\n    if (priority) {\n        VIR_FREE(pool->prioWorkers);\n        virCondDestroy(&pool->prioCond);\n    }\n    VIR_FREE(pool);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthreadpool.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virthreadpool.h\"\n#include <config.h>\n\nvoid virThreadPoolFree(virThreadPoolPtr pool)\n{\n    virThreadPoolJobPtr job;\n    bool priority = false;\n\n    if (!pool)\n        return;\n\n    virMutexLock(&pool->mutex);\n    pool->quit = true;\n    if (pool->nWorkers > 0)\n        virCondBroadcast(&pool->cond);\n    if (pool->nPrioWorkers > 0) {\n        priority = true;\n        virCondBroadcast(&pool->prioCond);\n    }\n\n    while (pool->nWorkers > 0 || pool->nPrioWorkers > 0)\n        ignore_value(virCondWait(&pool->quit_cond, &pool->mutex));\n\n    while ((job = pool->jobList.head)) {\n        pool->jobList.head = pool->jobList.head->next;\n        VIR_FREE(job);\n    }\n\n    VIR_FREE(pool->workers);\n    virMutexUnlock(&pool->mutex);\n    virMutexDestroy(&pool->mutex);\n    virCondDestroy(&pool->quit_cond);\n    virCondDestroy(&pool->cond);\n    if (priority) {\n        VIR_FREE(pool->prioWorkers);\n        virCondDestroy(&pool->prioCond);\n    }\n    VIR_FREE(pool);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 1532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 1531
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "req->binding->portdevname"
          ],
          "line": 1529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                    req->binding->portdevname)"
          ],
          "line": 1526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "virNWFilterSnoopState.ifnameToKey",
            "req->binding->portdevname"
          ],
          "line": 1526
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopCancel",
          "args": [
            "&req->threadkey"
          ],
          "line": 1524
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopCancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "309-321",
          "snippet": "static void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 1522
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 1519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Job submission failed on \"\n                                     \"interface '%s'\")",
            "req->binding->portdevname"
          ],
          "line": 1508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Job submission failed on \"\n                                     \"interface '%s'\""
          ],
          "line": 1509
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopDHCPDecodeJobSubmit",
          "args": [
            "worker",
            "packet",
            "hdr->caplen",
            "pcapConf[i].dir",
            "&pcapConf[i].qCtr"
          ],
          "line": 1504
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopDHCPDecodeJobSubmit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1151-1179",
          "snippet": "static int\nvirNWFilterSnoopDHCPDecodeJobSubmit(virThreadPoolPtr pool,\n                                    virNWFilterSnoopEthHdrPtr pep,\n                                    int len, pcap_direction_t dir,\n                                    int *qCtr)\n{\n    virNWFilterDHCPDecodeJobPtr job;\n    int ret;\n\n    if (len <= MIN_VALID_DHCP_PKT_SIZE || len > sizeof(job->packet))\n        return 0;\n\n    if (VIR_ALLOC(job) < 0)\n        return -1;\n\n    memcpy(job->packet, pep, len);\n    job->caplen = len;\n    job->fromVM = (dir == PCAP_D_IN);\n    job->qCtr = qCtr;\n\n    ret = virThreadPoolSendJob(pool, 0, job);\n\n    if (ret == 0)\n        g_atomic_int_add(qCtr, 1);\n    else\n        VIR_FREE(job);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopDHCPDecodeJobSubmit(virThreadPoolPtr pool,\n                                    virNWFilterSnoopEthHdrPtr pep,\n                                    int len, pcap_direction_t dir,\n                                    int *qCtr)\n{\n    virNWFilterDHCPDecodeJobPtr job;\n    int ret;\n\n    if (len <= MIN_VALID_DHCP_PKT_SIZE || len > sizeof(job->packet))\n        return 0;\n\n    if (VIR_ALLOC(job) < 0)\n        return -1;\n\n    memcpy(job->packet, pep, len);\n    job->caplen = len;\n    job->fromVM = (dir == PCAP_D_IN);\n    job->qCtr = qCtr;\n\n    ret = virThreadPoolSendJob(pool, 0, job);\n\n    if (ret == 0)\n        g_atomic_int_add(qCtr, 1);\n    else\n        VIR_FREE(job);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Too many DHCP packets on interface '%s'\"",
            "req->binding->portdevname"
          ],
          "line": 1498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "0"
          ],
          "line": 1497
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopRatePenalty",
          "args": [
            "&pcapConf[i]",
            "diff",
            "DHCP_PKT_RATE"
          ],
          "line": 1493
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopRatePenalty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1238-1253",
          "snippet": "static void\nvirNWFilterSnoopRatePenalty(virNWFilterSnoopPcapConfPtr pc,\n                            unsigned int diff, unsigned int limit)\n{\n    if (diff > limit) {\n        unsigned long long now;\n\n        if (virTimeMillisNowRaw(&now) < 0) {\n            g_usleep(PCAP_FLOOD_TIMEOUT_MS); /* 1 ms */\n            pc->penaltyTimeoutAbs = 0;\n        } else {\n            /* don't listen to the fd for 1 ms */\n            pc->penaltyTimeoutAbs = now + PCAP_FLOOD_TIMEOUT_MS;\n        }\n    }\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopRatePenalty(virNWFilterSnoopPcapConfPtr pc,\n                            unsigned int diff, unsigned int limit)\n{\n    if (diff > limit) {\n        unsigned long long now;\n\n        if (virTimeMillisNowRaw(&now) < 0) {\n            g_usleep(PCAP_FLOOD_TIMEOUT_MS); /* 1 ms */\n            pc->penaltyTimeoutAbs = 0;\n        } else {\n            /* don't listen to the fd for 1 ms */\n            pc->penaltyTimeoutAbs = now + PCAP_FLOOD_TIMEOUT_MS;\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopRateLimit",
          "args": [
            "&pcapConf[i].rateLimit"
          ],
          "line": 1491
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopRateLimit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1194-1225",
          "snippet": "static unsigned int\nvirNWFilterSnoopRateLimit(virNWFilterSnoopRateLimitConfPtr rl)\n{\n    time_t now = time(0);\n    int diff;\n# define IN_BURST(n, b) ((n)-(b) <= 1) /* bursts span 2 discrete seconds */\n\n    if (rl->prev != now && !IN_BURST(now, rl->burst)) {\n        rl->prev = now;\n        rl->pkt_ctr = 1;\n    } else {\n        rl->pkt_ctr++;\n        if (rl->pkt_ctr >= rl->rate) {\n            if (IN_BURST(now, rl->burst)) {\n                /* in a burst */\n                diff = rl->pkt_ctr - rl->burstRate;\n                if (diff > 0)\n                    return diff;\n                return 0;\n            }\n            if (rl->prev - rl->burst > rl->burstInterval) {\n                /* this second will start a new burst */\n                rl->burst = rl->prev;\n                return 0;\n            }\n            /* previous burst is too close */\n            return rl->pkt_ctr - rl->rate;\n        }\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic unsigned int\nvirNWFilterSnoopRateLimit(virNWFilterSnoopRateLimitConfPtr rl)\n{\n    time_t now = time(0);\n    int diff;\n# define IN_BURST(n, b) ((n)-(b) <= 1) /* bursts span 2 discrete seconds */\n\n    if (rl->prev != now && !IN_BURST(now, rl->burst)) {\n        rl->prev = now;\n        rl->pkt_ctr = 1;\n    } else {\n        rl->pkt_ctr++;\n        if (rl->pkt_ctr >= rl->rate) {\n            if (IN_BURST(now, rl->burst)) {\n                /* in a burst */\n                diff = rl->pkt_ctr - rl->burstRate;\n                if (diff > 0)\n                    return diff;\n                return 0;\n            }\n            if (rl->prev - rl->burst > rl->burstInterval) {\n                /* this second will start a new burst */\n                rl->burst = rl->prev;\n                return 0;\n            }\n            /* previous burst is too close */\n            return rl->pkt_ctr - rl->rate;\n        }\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Worker thread for interface '%s' has a \"\n                                 \"job queue that is too long\"",
            "req->binding->portdevname"
          ],
          "line": 1484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&pcapConf[i].qCtr"
          ],
          "line": 1480
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopDHCPOpen",
          "args": [
            "req->binding->portdevname",
            "&req->binding->mac",
            "pcapConf[i].filter",
            "pcapConf[i].dir"
          ],
          "line": 1459
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopDHCPOpen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1043-1124",
          "snippet": "static pcap_t *\nvirNWFilterSnoopDHCPOpen(const char *ifname, virMacAddr *mac,\n                         const char *filter, pcap_direction_t dir)\n{\n    pcap_t *handle = NULL;\n    struct bpf_program fp;\n    char pcap_errbuf[PCAP_ERRBUF_SIZE];\n    char *ext_filter = NULL;\n    char macaddr[VIR_MAC_STRING_BUFLEN];\n\n    virMacAddrFormat(mac, macaddr);\n\n    if (dir == PCAP_D_IN /* from VM */) {\n        /*\n         * don't want to hear about another VM's DHCP requests\n         *\n         * extend the filter with the macaddr of the VM; filter the\n         * more unlikely parameters first, then go for the MAC\n         */\n        ext_filter = g_strdup_printf(\"%s and ether src %s\", filter, macaddr);\n    } else {\n        /*\n         * Some DHCP servers respond via MAC broadcast; we rely on later\n         * filtering of responses by comparing the MAC address inside the\n         * DHCP response against the one of the VM. Assuming that the\n         * bridge learns the VM's MAC address quickly this should not\n         * generate much more traffic than if we filtered by VM and\n         * braodcast MAC as well\n         */\n        ext_filter = g_strdup(filter);\n    }\n\n    handle = pcap_create(ifname, pcap_errbuf);\n\n    if (handle == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"pcap_create failed\"));\n        goto cleanup_nohandle;\n    }\n\n    if (pcap_set_snaplen(handle, PCAP_PBUFSIZE) < 0 ||\n        pcap_set_immediate_mode(handle, 1) < 0 ||\n        pcap_activate(handle) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"setup of pcap handle failed: %s\"),\n                       pcap_geterr(handle));\n        goto cleanup;\n    }\n\n    if (pcap_compile(handle, &fp, ext_filter, 1, PCAP_NETMASK_UNKNOWN) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_compile: %s\"), pcap_geterr(handle));\n        goto cleanup;\n    }\n\n    if (pcap_setfilter(handle, &fp) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_setfilter: %s\"), pcap_geterr(handle));\n        goto cleanup_freecode;\n    }\n\n    if (pcap_setdirection(handle, dir) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_setdirection: %s\"),\n                       pcap_geterr(handle));\n        goto cleanup_freecode;\n    }\n\n    pcap_freecode(&fp);\n    VIR_FREE(ext_filter);\n\n    return handle;\n\n cleanup_freecode:\n    pcap_freecode(&fp);\n cleanup:\n    pcap_close(handle);\n cleanup_nohandle:\n    VIR_FREE(ext_filter);\n\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic pcap_t *\nvirNWFilterSnoopDHCPOpen(const char *ifname, virMacAddr *mac,\n                         const char *filter, pcap_direction_t dir)\n{\n    pcap_t *handle = NULL;\n    struct bpf_program fp;\n    char pcap_errbuf[PCAP_ERRBUF_SIZE];\n    char *ext_filter = NULL;\n    char macaddr[VIR_MAC_STRING_BUFLEN];\n\n    virMacAddrFormat(mac, macaddr);\n\n    if (dir == PCAP_D_IN /* from VM */) {\n        /*\n         * don't want to hear about another VM's DHCP requests\n         *\n         * extend the filter with the macaddr of the VM; filter the\n         * more unlikely parameters first, then go for the MAC\n         */\n        ext_filter = g_strdup_printf(\"%s and ether src %s\", filter, macaddr);\n    } else {\n        /*\n         * Some DHCP servers respond via MAC broadcast; we rely on later\n         * filtering of responses by comparing the MAC address inside the\n         * DHCP response against the one of the VM. Assuming that the\n         * bridge learns the VM's MAC address quickly this should not\n         * generate much more traffic than if we filtered by VM and\n         * braodcast MAC as well\n         */\n        ext_filter = g_strdup(filter);\n    }\n\n    handle = pcap_create(ifname, pcap_errbuf);\n\n    if (handle == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"pcap_create failed\"));\n        goto cleanup_nohandle;\n    }\n\n    if (pcap_set_snaplen(handle, PCAP_PBUFSIZE) < 0 ||\n        pcap_set_immediate_mode(handle, 1) < 0 ||\n        pcap_activate(handle) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"setup of pcap handle failed: %s\"),\n                       pcap_geterr(handle));\n        goto cleanup;\n    }\n\n    if (pcap_compile(handle, &fp, ext_filter, 1, PCAP_NETMASK_UNKNOWN) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_compile: %s\"), pcap_geterr(handle));\n        goto cleanup;\n    }\n\n    if (pcap_setfilter(handle, &fp) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_setfilter: %s\"), pcap_geterr(handle));\n        goto cleanup_freecode;\n    }\n\n    if (pcap_setdirection(handle, dir) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_setdirection: %s\"),\n                       pcap_geterr(handle));\n        goto cleanup_freecode;\n    }\n\n    pcap_freecode(&fp);\n    VIR_FREE(ext_filter);\n\n    return handle;\n\n cleanup_freecode:\n    pcap_freecode(&fp);\n cleanup:\n    pcap_close(handle);\n cleanup_nohandle:\n    VIR_FREE(ext_filter);\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"interface '%s' failing; \"\n                                     \"reopening\")",
            "req->binding->portdevname"
          ],
          "line": 1453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_close",
          "args": [
            "pcapConf[i].handle"
          ],
          "line": 1447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevValidateConfig",
          "args": [
            "req->binding->portdevname",
            "NULL",
            "ifindex"
          ],
          "line": 1437
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevValidateConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "1050-1057",
          "snippet": "int virNetDevValidateConfig(const char *ifname G_GNUC_UNUSED,\n                            const virMacAddr *macaddr G_GNUC_UNUSED,\n                            int ifindex G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to check interface config on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevValidateConfig(const char *ifname G_GNUC_UNUSED,\n                            const virMacAddr *macaddr G_GNUC_UNUSED,\n                            int ifindex G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to check interface config on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pcap_next_ex",
          "args": [
            "pcapConf[i].handle",
            "&hdr",
            "(const u_char **)&packet"
          ],
          "line": 1426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "fds"
          ],
          "line": 1419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIsActive",
          "args": [
            "threadkey"
          ],
          "line": 1415
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIsActive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "323-338",
          "snippet": "static bool\nvirNWFilterSnoopIsActive(char *threadKey)\n{\n    void *entry;\n\n    if (threadKey == NULL)\n        return 0;\n\n    virNWFilterSnoopActiveLock();\n\n    entry = virHashLookup(virNWFilterSnoopState.active, threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n\n    return entry != NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic bool\nvirNWFilterSnoopIsActive(char *threadKey)\n{\n    void *entry;\n\n    if (threadKey == NULL)\n        return 0;\n\n    virNWFilterSnoopActiveLock();\n\n    entry = virHashLookup(virNWFilterSnoopState.active, threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n\n    return entry != NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLeaseTimerRun",
          "args": [
            "req"
          ],
          "line": 1409
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLeaseTimerRun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "515-535",
          "snippet": "static unsigned int\nvirNWFilterSnoopReqLeaseTimerRun(virNWFilterSnoopReqPtr req)\n{\n    time_t now = time(0);\n    bool is_last = false;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    while (req->start && req->start->timeout <= now) {\n        if (req->start->next == NULL ||\n            req->start->next->timeout > now)\n            is_last = true;\n        virNWFilterSnoopReqLeaseDel(req, &req->start->ipAddress, true,\n                                    is_last);\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic unsigned int\nvirNWFilterSnoopReqLeaseTimerRun(virNWFilterSnoopReqPtr req)\n{\n    time_t now = time(0);\n    bool is_last = false;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    while (req->start && req->start->timeout <= now) {\n        if (req->start->next == NULL ||\n            req->start->next->timeout > now)\n            is_last = true;\n        virNWFilterSnoopReqLeaseDel(req, &req->start->ipAddress, true,\n                                    is_last);\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "poll",
          "args": [
            "fds",
            "G_N_ELEMENTS(fds)",
            "pollTo"
          ],
          "line": 1402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "fds"
          ],
          "line": 1402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopAdjustPoll",
          "args": [
            "pcapConf",
            "G_N_ELEMENTS(pcapConf)",
            "fds",
            "&pollTo"
          ],
          "line": 1392
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopAdjustPoll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1255-1296",
          "snippet": "static int\nvirNWFilterSnoopAdjustPoll(virNWFilterSnoopPcapConfPtr pc,\n                           size_t nPc, struct pollfd *pfd,\n                           int *pollTo)\n{\n    int ret = 0;\n    size_t i;\n    int tmp;\n    unsigned long long now = 0;\n\n    *pollTo = -1;\n\n    for (i = 0; i < nPc; i++) {\n        if (pc[i].penaltyTimeoutAbs != 0) {\n            if (now == 0) {\n                if (virTimeMillisNow(&now) < 0) {\n                    ret = -1;\n                    break;\n                }\n            }\n\n            if (now < pc[i].penaltyTimeoutAbs) {\n                /* don't listen to incoming data on the fd for some time */\n                pfd[i].events &= ~POLLIN;\n                /*\n                 * calc the max. time to spend in poll() until adjustments\n                 * to the pollfd array are needed again.\n                 */\n                tmp = pc[i].penaltyTimeoutAbs - now;\n                if (*pollTo == -1 || tmp < *pollTo)\n                    *pollTo = tmp;\n            } else {\n                /* listen again to the fd */\n                pfd[i].events |= POLLIN;\n\n                pc[i].penaltyTimeoutAbs = 0;\n            }\n        }\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopAdjustPoll(virNWFilterSnoopPcapConfPtr pc,\n                           size_t nPc, struct pollfd *pfd,\n                           int *pollTo)\n{\n    int ret = 0;\n    size_t i;\n    int tmp;\n    unsigned long long now = 0;\n\n    *pollTo = -1;\n\n    for (i = 0; i < nPc; i++) {\n        if (pc[i].penaltyTimeoutAbs != 0) {\n            if (now == 0) {\n                if (virTimeMillisNow(&now) < 0) {\n                    ret = -1;\n                    break;\n                }\n            }\n\n            if (now < pc[i].penaltyTimeoutAbs) {\n                /* don't listen to incoming data on the fd for some time */\n                pfd[i].events &= ~POLLIN;\n                /*\n                 * calc the max. time to spend in poll() until adjustments\n                 * to the pollfd array are needed again.\n                 */\n                tmp = pc[i].penaltyTimeoutAbs - now;\n                if (*pollTo == -1 || tmp < *pollTo)\n                    *pollTo = tmp;\n            } else {\n                /* listen again to the fd */\n                pfd[i].events |= POLLIN;\n\n                pc[i].penaltyTimeoutAbs = 0;\n            }\n        }\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "pcapConf"
          ],
          "line": 1393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCondSignal",
          "args": [
            "&req->threadStatusCond"
          ],
          "line": 1384
        },
        "resolved": true,
        "details": {
          "function_name": "virCondSignal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "170-173",
          "snippet": "void virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorPreserveLast",
          "args": [
            "&req->threadError"
          ],
          "line": 1378
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorPreserveLast",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "424-436",
          "snippet": "void\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virThreadPoolNewFull",
          "args": [
            "1",
            "1",
            "0",
            "virNWFilterDHCPDecodeWorker",
            "\"dhcp-decode\"",
            "req"
          ],
          "line": 1369
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadPoolNewFull",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthreadpool.c",
          "lines": "222-272",
          "snippet": "virThreadPoolPtr\nvirThreadPoolNewFull(size_t minWorkers,\n                     size_t maxWorkers,\n                     size_t prioWorkers,\n                     virThreadPoolJobFunc func,\n                     const char *name,\n                     void *opaque)\n{\n    virThreadPoolPtr pool;\n\n    if (minWorkers > maxWorkers)\n        minWorkers = maxWorkers;\n\n    if (VIR_ALLOC(pool) < 0)\n        return NULL;\n\n    pool->jobList.tail = pool->jobList.head = NULL;\n\n    pool->jobFunc = func;\n    pool->jobName = name;\n    pool->jobOpaque = opaque;\n\n    if (virMutexInit(&pool->mutex) < 0)\n        goto error;\n    if (virCondInit(&pool->cond) < 0)\n        goto error;\n    if (virCondInit(&pool->quit_cond) < 0)\n        goto error;\n\n    pool->minWorkers = minWorkers;\n    pool->maxWorkers = maxWorkers;\n    pool->maxPrioWorkers = prioWorkers;\n\n    if (virThreadPoolExpand(pool, minWorkers, false) < 0)\n        goto error;\n\n    if (prioWorkers) {\n        if (virCondInit(&pool->prioCond) < 0)\n            goto error;\n\n        if (virThreadPoolExpand(pool, prioWorkers, true) < 0)\n            goto error;\n    }\n\n    return pool;\n\n error:\n    virThreadPoolFree(pool);\n    return NULL;\n\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthreadpool.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virthreadpool.h\"\n#include <config.h>\n\nvirThreadPoolPtr\nvirThreadPoolNewFull(size_t minWorkers,\n                     size_t maxWorkers,\n                     size_t prioWorkers,\n                     virThreadPoolJobFunc func,\n                     const char *name,\n                     void *opaque)\n{\n    virThreadPoolPtr pool;\n\n    if (minWorkers > maxWorkers)\n        minWorkers = maxWorkers;\n\n    if (VIR_ALLOC(pool) < 0)\n        return NULL;\n\n    pool->jobList.tail = pool->jobList.head = NULL;\n\n    pool->jobFunc = func;\n    pool->jobName = name;\n    pool->jobOpaque = opaque;\n\n    if (virMutexInit(&pool->mutex) < 0)\n        goto error;\n    if (virCondInit(&pool->cond) < 0)\n        goto error;\n    if (virCondInit(&pool->quit_cond) < 0)\n        goto error;\n\n    pool->minWorkers = minWorkers;\n    pool->maxWorkers = maxWorkers;\n    pool->maxPrioWorkers = prioWorkers;\n\n    if (virThreadPoolExpand(pool, minWorkers, false) < 0)\n        goto error;\n\n    if (prioWorkers) {\n        if (virCondInit(&pool->prioCond) < 0)\n            goto error;\n\n        if (virThreadPoolExpand(pool, prioWorkers, true) < 0)\n            goto error;\n    }\n\n    return pool;\n\n error:\n    virThreadPoolFree(pool);\n    return NULL;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "req->threadkey"
          ],
          "line": 1368
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevGetIndex",
          "args": [
            "req->binding->portdevname",
            "&ifindex"
          ],
          "line": 1367
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevGetIndex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "893-899",
          "snippet": "int virNetDevGetIndex(const char *ifname G_GNUC_UNUSED,\n                      int *ifindex G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to get interface index on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevGetIndex(const char *ifname G_GNUC_UNUSED,\n                      int *ifindex G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Unable to get interface index on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pcap_fileno",
          "args": [
            "pcapConf[i].handle"
          ],
          "line": 1365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "pcapConf"
          ],
          "line": 1355
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterDHCPSnoopThread(void *req0)\n{\n    virNWFilterSnoopReqPtr req = req0;\n    struct pcap_pkthdr *hdr;\n    virNWFilterSnoopEthHdrPtr packet;\n    int ifindex = 0;\n    int errcount = 0;\n    int tmp = -1, rv, n, pollTo;\n    size_t i;\n    char *threadkey = NULL;\n    virThreadPoolPtr worker = NULL;\n    time_t last_displayed = 0, last_displayed_queue = 0;\n    virNWFilterSnoopPcapConf pcapConf[] = {\n        {\n            .dir = PCAP_D_IN, /* from VM */\n            .filter = \"dst port 67 and src port 68\",\n            .rateLimit = {\n                .prev = time(0),\n                .rate = DHCP_PKT_RATE,\n                .burstRate = DHCP_PKT_BURST,\n                .burstInterval = DHCP_BURST_INTERVAL_S,\n            },\n            .maxQSize = MAX_QUEUED_JOBS,\n        }, {\n            .dir = PCAP_D_OUT, /* to VM */\n            .filter = \"src port 67 and dst port 68\",\n            .rateLimit = {\n                .prev = time(0),\n                .rate = DHCP_PKT_RATE,\n                .burstRate = DHCP_PKT_BURST,\n                .burstInterval = DHCP_BURST_INTERVAL_S,\n            },\n            .maxQSize = MAX_QUEUED_JOBS,\n        },\n    };\n    struct pollfd fds[] = {\n        {\n            /* get a POLLERR if interface goes down or disappears */\n            .events = POLLIN | POLLERR,\n        }, {\n            .events = POLLIN | POLLERR,\n        },\n    };\n    bool error = false;\n\n    /* whoever started us increased the reference counter for the req for us */\n\n    /* protect req->binding->portdevname & req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->binding->portdevname && req->threadkey) {\n        for (i = 0; i < G_N_ELEMENTS(pcapConf); i++) {\n            pcapConf[i].handle =\n                virNWFilterSnoopDHCPOpen(req->binding->portdevname,\n                                         &req->binding->mac,\n                                         pcapConf[i].filter,\n                                         pcapConf[i].dir);\n            if (!pcapConf[i].handle) {\n                error = true;\n                break;\n            }\n            fds[i].fd = pcap_fileno(pcapConf[i].handle);\n        }\n        tmp = virNetDevGetIndex(req->binding->portdevname, &ifindex);\n        threadkey = g_strdup(req->threadkey);\n        worker = virThreadPoolNewFull(1, 1, 0,\n                                      virNWFilterDHCPDecodeWorker,\n                                      \"dhcp-decode\",\n                                      req);\n    }\n\n    /* let creator know how well we initialized */\n    if (error || !threadkey || tmp < 0 || !worker ||\n        ifindex != req->ifindex) {\n        virErrorPreserveLast(&req->threadError);\n        req->threadStatus = THREAD_STATUS_FAIL;\n    } else {\n        req->threadStatus = THREAD_STATUS_OK;\n    }\n\n    virCondSignal(&req->threadStatusCond);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    if (req->threadStatus != THREAD_STATUS_OK)\n        goto exit;\n\n    while (!error) {\n        if (virNWFilterSnoopAdjustPoll(pcapConf,\n                                       G_N_ELEMENTS(pcapConf),\n                                       fds, &pollTo) < 0) {\n            break;\n        }\n\n        /* cap pollTo so we don't hold up the join for too long */\n        if (pollTo < 0 || pollTo > SNOOP_POLL_MAX_TIMEOUT_MS)\n            pollTo = SNOOP_POLL_MAX_TIMEOUT_MS;\n\n        n = poll(fds, G_N_ELEMENTS(fds), pollTo);\n\n        if (n < 0) {\n            if (errno != EAGAIN && errno != EINTR)\n                error = true;\n        }\n\n        virNWFilterSnoopReqLeaseTimerRun(req);\n\n        /*\n         * Check whether we were cancelled or whether\n         * a previously submitted job failed.\n         */\n        if (!virNWFilterSnoopIsActive(threadkey) ||\n            req->jobCompletionStatus != 0)\n            goto exit;\n\n        for (i = 0; n > 0 && i < G_N_ELEMENTS(fds); i++) {\n            if (!fds[i].revents)\n                continue;\n\n            fds[i].revents = 0;\n            n--;\n\n            rv = pcap_next_ex(pcapConf[i].handle, &hdr,\n                              (const u_char **)&packet);\n\n            if (rv < 0) {\n                /* error reading from socket */\n                tmp = -1;\n\n                /* protect req->binding->portdevname */\n                virNWFilterSnoopReqLock(req);\n\n                if (req->binding->portdevname)\n                    tmp = virNetDevValidateConfig(req->binding->portdevname, NULL, ifindex);\n\n                virNWFilterSnoopReqUnlock(req);\n\n                if (tmp <= 0) {\n                    error = true;\n                    break;\n                }\n\n                if (++errcount > PCAP_READ_MAXERRS) {\n                    pcap_close(pcapConf[i].handle);\n                    pcapConf[i].handle = NULL;\n\n                    /* protect req->binding->portdevname */\n                    virNWFilterSnoopReqLock(req);\n\n                    virReportError(VIR_ERR_INTERNAL_ERROR,\n                                   _(\"interface '%s' failing; \"\n                                     \"reopening\"),\n                                   req->binding->portdevname);\n                    if (req->binding->portdevname)\n                        pcapConf[i].handle =\n                            virNWFilterSnoopDHCPOpen(req->binding->portdevname,\n                                                     &req->binding->mac,\n                                                     pcapConf[i].filter,\n                                                     pcapConf[i].dir);\n\n                    virNWFilterSnoopReqUnlock(req);\n\n                    if (!pcapConf[i].handle) {\n                        error = true;\n                        break;\n                    }\n                }\n                continue;\n            }\n\n            errcount = 0;\n\n            if (rv) {\n                unsigned int diff;\n\n                /* submit packet to worker thread */\n                if (g_atomic_int_get(&pcapConf[i].qCtr) >\n                    pcapConf[i].maxQSize) {\n                    if (last_displayed_queue - time(0) > 10) {\n                        last_displayed_queue = time(0);\n                        VIR_WARN(\"Worker thread for interface '%s' has a \"\n                                 \"job queue that is too long\",\n                                 req->binding->portdevname);\n                    }\n                    continue;\n                }\n\n                diff = virNWFilterSnoopRateLimit(&pcapConf[i].rateLimit);\n                if (diff > 0) {\n                    virNWFilterSnoopRatePenalty(&pcapConf[i], diff,\n                                                DHCP_PKT_RATE);\n                    /* rate-limited warnings */\n                    if (time(0) - last_displayed > 10) {\n                         last_displayed = time(0);\n                         VIR_WARN(\"Too many DHCP packets on interface '%s'\",\n                                  req->binding->portdevname);\n                    }\n                    continue;\n                }\n\n                if (virNWFilterSnoopDHCPDecodeJobSubmit(worker, packet,\n                                                      hdr->caplen,\n                                                      pcapConf[i].dir,\n                                                      &pcapConf[i].qCtr) < 0) {\n                    virReportError(VIR_ERR_INTERNAL_ERROR,\n                                   _(\"Job submission failed on \"\n                                     \"interface '%s'\"), req->binding->portdevname);\n                    error = true;\n                    break;\n                }\n            }\n        } /* for all fds */\n    } /* while (!error) */\n\n    /* protect IfNameToKey */\n    virNWFilterSnoopLock();\n\n    /* protect req->binding->portdevname & req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopCancel(&req->threadkey);\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.ifnameToKey,\n                                    req->binding->portdevname));\n\n    VIR_FREE(req->binding->portdevname);\n\n    virNWFilterSnoopReqUnlock(req);\n    virNWFilterSnoopUnlock();\n\n exit:\n    virThreadPoolFree(worker);\n\n    virNWFilterSnoopReqPut(req);\n\n    VIR_FREE(threadkey);\n\n    for (i = 0; i < G_N_ELEMENTS(pcapConf); i++) {\n        if (pcapConf[i].handle)\n            pcap_close(pcapConf[i].handle);\n    }\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nThreads));\n\n    return;\n}"
  },
  {
    "function_name": "virNWFilterSnoopAdjustPoll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1255-1296",
    "snippet": "static int\nvirNWFilterSnoopAdjustPoll(virNWFilterSnoopPcapConfPtr pc,\n                           size_t nPc, struct pollfd *pfd,\n                           int *pollTo)\n{\n    int ret = 0;\n    size_t i;\n    int tmp;\n    unsigned long long now = 0;\n\n    *pollTo = -1;\n\n    for (i = 0; i < nPc; i++) {\n        if (pc[i].penaltyTimeoutAbs != 0) {\n            if (now == 0) {\n                if (virTimeMillisNow(&now) < 0) {\n                    ret = -1;\n                    break;\n                }\n            }\n\n            if (now < pc[i].penaltyTimeoutAbs) {\n                /* don't listen to incoming data on the fd for some time */\n                pfd[i].events &= ~POLLIN;\n                /*\n                 * calc the max. time to spend in poll() until adjustments\n                 * to the pollfd array are needed again.\n                 */\n                tmp = pc[i].penaltyTimeoutAbs - now;\n                if (*pollTo == -1 || tmp < *pollTo)\n                    *pollTo = tmp;\n            } else {\n                /* listen again to the fd */\n                pfd[i].events |= POLLIN;\n\n                pc[i].penaltyTimeoutAbs = 0;\n            }\n        }\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virTimeMillisNow",
          "args": [
            "&now"
          ],
          "line": 1270
        },
        "resolved": true,
        "details": {
          "function_name": "virTimeMillisNow",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtime.c",
          "lines": "214-222",
          "snippet": "int virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtime.h\"",
            "#include <sys/time.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtime.h\"\n#include <sys/time.h>\n#include <unistd.h>\n#include <config.h>\n\nint virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopAdjustPoll(virNWFilterSnoopPcapConfPtr pc,\n                           size_t nPc, struct pollfd *pfd,\n                           int *pollTo)\n{\n    int ret = 0;\n    size_t i;\n    int tmp;\n    unsigned long long now = 0;\n\n    *pollTo = -1;\n\n    for (i = 0; i < nPc; i++) {\n        if (pc[i].penaltyTimeoutAbs != 0) {\n            if (now == 0) {\n                if (virTimeMillisNow(&now) < 0) {\n                    ret = -1;\n                    break;\n                }\n            }\n\n            if (now < pc[i].penaltyTimeoutAbs) {\n                /* don't listen to incoming data on the fd for some time */\n                pfd[i].events &= ~POLLIN;\n                /*\n                 * calc the max. time to spend in poll() until adjustments\n                 * to the pollfd array are needed again.\n                 */\n                tmp = pc[i].penaltyTimeoutAbs - now;\n                if (*pollTo == -1 || tmp < *pollTo)\n                    *pollTo = tmp;\n            } else {\n                /* listen again to the fd */\n                pfd[i].events |= POLLIN;\n\n                pc[i].penaltyTimeoutAbs = 0;\n            }\n        }\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virNWFilterSnoopRatePenalty",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1238-1253",
    "snippet": "static void\nvirNWFilterSnoopRatePenalty(virNWFilterSnoopPcapConfPtr pc,\n                            unsigned int diff, unsigned int limit)\n{\n    if (diff > limit) {\n        unsigned long long now;\n\n        if (virTimeMillisNowRaw(&now) < 0) {\n            g_usleep(PCAP_FLOOD_TIMEOUT_MS); /* 1 ms */\n            pc->penaltyTimeoutAbs = 0;\n        } else {\n            /* don't listen to the fd for 1 ms */\n            pc->penaltyTimeoutAbs = now + PCAP_FLOOD_TIMEOUT_MS;\n        }\n    }\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_usleep",
          "args": [
            "PCAP_FLOOD_TIMEOUT_MS"
          ],
          "line": 1246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virTimeMillisNowRaw",
          "args": [
            "&now"
          ],
          "line": 1245
        },
        "resolved": true,
        "details": {
          "function_name": "virTimeMillisNowRaw",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtime.c",
          "lines": "55-59",
          "snippet": "int virTimeMillisNowRaw(unsigned long long *now)\n{\n    *now = g_get_real_time() / 1000;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtime.h\"",
            "#include <sys/time.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtime.h\"\n#include <sys/time.h>\n#include <unistd.h>\n#include <config.h>\n\nint virTimeMillisNowRaw(unsigned long long *now)\n{\n    *now = g_get_real_time() / 1000;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopRatePenalty(virNWFilterSnoopPcapConfPtr pc,\n                            unsigned int diff, unsigned int limit)\n{\n    if (diff > limit) {\n        unsigned long long now;\n\n        if (virTimeMillisNowRaw(&now) < 0) {\n            g_usleep(PCAP_FLOOD_TIMEOUT_MS); /* 1 ms */\n            pc->penaltyTimeoutAbs = 0;\n        } else {\n            /* don't listen to the fd for 1 ms */\n            pc->penaltyTimeoutAbs = now + PCAP_FLOOD_TIMEOUT_MS;\n        }\n    }\n}"
  },
  {
    "function_name": "virNWFilterSnoopRateLimit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1194-1225",
    "snippet": "static unsigned int\nvirNWFilterSnoopRateLimit(virNWFilterSnoopRateLimitConfPtr rl)\n{\n    time_t now = time(0);\n    int diff;\n# define IN_BURST(n, b) ((n)-(b) <= 1) /* bursts span 2 discrete seconds */\n\n    if (rl->prev != now && !IN_BURST(now, rl->burst)) {\n        rl->prev = now;\n        rl->pkt_ctr = 1;\n    } else {\n        rl->pkt_ctr++;\n        if (rl->pkt_ctr >= rl->rate) {\n            if (IN_BURST(now, rl->burst)) {\n                /* in a burst */\n                diff = rl->pkt_ctr - rl->burstRate;\n                if (diff > 0)\n                    return diff;\n                return 0;\n            }\n            if (rl->prev - rl->burst > rl->burstInterval) {\n                /* this second will start a new burst */\n                rl->burst = rl->prev;\n                return 0;\n            }\n            /* previous burst is too close */\n            return rl->pkt_ctr - rl->rate;\n        }\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "IN_BURST",
          "args": [
            "now",
            "rl->burst"
          ],
          "line": 1207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IN_BURST",
          "args": [
            "now",
            "rl->burst"
          ],
          "line": 1201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "0"
          ],
          "line": 1197
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic unsigned int\nvirNWFilterSnoopRateLimit(virNWFilterSnoopRateLimitConfPtr rl)\n{\n    time_t now = time(0);\n    int diff;\n# define IN_BURST(n, b) ((n)-(b) <= 1) /* bursts span 2 discrete seconds */\n\n    if (rl->prev != now && !IN_BURST(now, rl->burst)) {\n        rl->prev = now;\n        rl->pkt_ctr = 1;\n    } else {\n        rl->pkt_ctr++;\n        if (rl->pkt_ctr >= rl->rate) {\n            if (IN_BURST(now, rl->burst)) {\n                /* in a burst */\n                diff = rl->pkt_ctr - rl->burstRate;\n                if (diff > 0)\n                    return diff;\n                return 0;\n            }\n            if (rl->prev - rl->burst > rl->burstInterval) {\n                /* this second will start a new burst */\n                rl->burst = rl->prev;\n                return 0;\n            }\n            /* previous burst is too close */\n            return rl->pkt_ctr - rl->rate;\n        }\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virNWFilterSnoopDHCPDecodeJobSubmit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1151-1179",
    "snippet": "static int\nvirNWFilterSnoopDHCPDecodeJobSubmit(virThreadPoolPtr pool,\n                                    virNWFilterSnoopEthHdrPtr pep,\n                                    int len, pcap_direction_t dir,\n                                    int *qCtr)\n{\n    virNWFilterDHCPDecodeJobPtr job;\n    int ret;\n\n    if (len <= MIN_VALID_DHCP_PKT_SIZE || len > sizeof(job->packet))\n        return 0;\n\n    if (VIR_ALLOC(job) < 0)\n        return -1;\n\n    memcpy(job->packet, pep, len);\n    job->caplen = len;\n    job->fromVM = (dir == PCAP_D_IN);\n    job->qCtr = qCtr;\n\n    ret = virThreadPoolSendJob(pool, 0, job);\n\n    if (ret == 0)\n        g_atomic_int_add(qCtr, 1);\n    else\n        VIR_FREE(job);\n\n    return ret;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "job"
          ],
          "line": 1176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_add",
          "args": [
            "qCtr",
            "1"
          ],
          "line": 1174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virThreadPoolSendJob",
          "args": [
            "pool",
            "0",
            "job"
          ],
          "line": 1171
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadPoolSendJob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthreadpool.c",
          "lines": "382-426",
          "snippet": "int virThreadPoolSendJob(virThreadPoolPtr pool,\n                         unsigned int priority,\n                         void *jobData)\n{\n    virThreadPoolJobPtr job;\n\n    virMutexLock(&pool->mutex);\n    if (pool->quit)\n        goto error;\n\n    if (pool->freeWorkers - pool->jobQueueDepth <= 0 &&\n        pool->nWorkers < pool->maxWorkers &&\n        virThreadPoolExpand(pool, 1, false) < 0)\n        goto error;\n\n    if (VIR_ALLOC(job) < 0)\n        goto error;\n\n    job->data = jobData;\n    job->priority = priority;\n\n    job->prev = pool->jobList.tail;\n    if (pool->jobList.tail)\n        pool->jobList.tail->next = job;\n    pool->jobList.tail = job;\n\n    if (!pool->jobList.head)\n        pool->jobList.head = job;\n\n    if (priority && !pool->jobList.firstPrio)\n        pool->jobList.firstPrio = job;\n\n    pool->jobQueueDepth++;\n\n    virCondSignal(&pool->cond);\n    if (priority)\n        virCondSignal(&pool->prioCond);\n\n    virMutexUnlock(&pool->mutex);\n    return 0;\n\n error:\n    virMutexUnlock(&pool->mutex);\n    return -1;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthreadpool.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virthreadpool.h\"\n#include <config.h>\n\nint virThreadPoolSendJob(virThreadPoolPtr pool,\n                         unsigned int priority,\n                         void *jobData)\n{\n    virThreadPoolJobPtr job;\n\n    virMutexLock(&pool->mutex);\n    if (pool->quit)\n        goto error;\n\n    if (pool->freeWorkers - pool->jobQueueDepth <= 0 &&\n        pool->nWorkers < pool->maxWorkers &&\n        virThreadPoolExpand(pool, 1, false) < 0)\n        goto error;\n\n    if (VIR_ALLOC(job) < 0)\n        goto error;\n\n    job->data = jobData;\n    job->priority = priority;\n\n    job->prev = pool->jobList.tail;\n    if (pool->jobList.tail)\n        pool->jobList.tail->next = job;\n    pool->jobList.tail = job;\n\n    if (!pool->jobList.head)\n        pool->jobList.head = job;\n\n    if (priority && !pool->jobList.firstPrio)\n        pool->jobList.firstPrio = job;\n\n    pool->jobQueueDepth++;\n\n    virCondSignal(&pool->cond);\n    if (priority)\n        virCondSignal(&pool->prioCond);\n\n    virMutexUnlock(&pool->mutex);\n    return 0;\n\n error:\n    virMutexUnlock(&pool->mutex);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "job->packet",
            "pep",
            "len"
          ],
          "line": 1166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "job"
          ],
          "line": 1163
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopDHCPDecodeJobSubmit(virThreadPoolPtr pool,\n                                    virNWFilterSnoopEthHdrPtr pep,\n                                    int len, pcap_direction_t dir,\n                                    int *qCtr)\n{\n    virNWFilterDHCPDecodeJobPtr job;\n    int ret;\n\n    if (len <= MIN_VALID_DHCP_PKT_SIZE || len > sizeof(job->packet))\n        return 0;\n\n    if (VIR_ALLOC(job) < 0)\n        return -1;\n\n    memcpy(job->packet, pep, len);\n    job->caplen = len;\n    job->fromVM = (dir == PCAP_D_IN);\n    job->qCtr = qCtr;\n\n    ret = virThreadPoolSendJob(pool, 0, job);\n\n    if (ret == 0)\n        g_atomic_int_add(qCtr, 1);\n    else\n        VIR_FREE(job);\n\n    return ret;\n}"
  },
  {
    "function_name": "virNWFilterDHCPDecodeWorker",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1130-1146",
    "snippet": "static void virNWFilterDHCPDecodeWorker(void *jobdata, void *opaque)\n{\n    virNWFilterSnoopReqPtr req = opaque;\n    virNWFilterDHCPDecodeJobPtr job = jobdata;\n    virNWFilterSnoopEthHdrPtr packet = (virNWFilterSnoopEthHdrPtr)job->packet;\n\n    if (virNWFilterSnoopDHCPDecode(req, packet,\n                                   job->caplen, job->fromVM) == -1) {\n        req->jobCompletionStatus = -1;\n\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Instantiation of rules failed on \"\n                         \"interface '%s'\"), req->binding->portdevname);\n    }\n    ignore_value(!!g_atomic_int_dec_and_test(job->qCtr));\n    VIR_FREE(job);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "job"
          ],
          "line": 1145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "!!g_atomic_int_dec_and_test(job->qCtr)"
          ],
          "line": 1144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_dec_and_test",
          "args": [
            "job->qCtr"
          ],
          "line": 1144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Instantiation of rules failed on \"\n                         \"interface '%s'\")",
            "req->binding->portdevname"
          ],
          "line": 1140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Instantiation of rules failed on \"\n                         \"interface '%s'\""
          ],
          "line": 1141
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopDHCPDecode",
          "args": [
            "req",
            "packet",
            "job->caplen",
            "job->fromVM"
          ],
          "line": 1136
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopDHCPDecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "942-1041",
          "snippet": "static int\nvirNWFilterSnoopDHCPDecode(virNWFilterSnoopReqPtr req,\n                           virNWFilterSnoopEthHdrPtr pep,\n                           int len, bool fromVM)\n{\n    struct iphdr *pip;\n    struct udphdr *pup;\n    virNWFilterSnoopDHCPHdrPtr pd;\n    virNWFilterSnoopIPLease ipl;\n    uint8_t mtype;\n    uint32_t leasetime;\n    uint32_t nwint;\n\n    /* go through the protocol headers */\n    switch (ntohs(pep->eh_type)) {\n    case ETHERTYPE_IP:\n        VIR_WARNINGS_NO_CAST_ALIGN\n        pip = (struct iphdr *)pep->eh_data;\n        VIR_WARNINGS_RESET\n        len -= offsetof(virNWFilterSnoopEthHdr, eh_data);\n        break;\n    default:\n        return -2;\n    }\n\n    if (len < 0)\n        return -2;\n\n    VIR_WARNINGS_NO_CAST_ALIGN\n    pup = (struct udphdr *)((char *)pip + (pip->ihl << 2));\n    VIR_WARNINGS_RESET\n    len -= pip->ihl << 2;\n    if (len < 0)\n        return -2;\n\n    pd = (virNWFilterSnoopDHCPHdrPtr) ((char *)pup + sizeof(*pup));\n    len -= sizeof(*pup);\n    if (len < 0)\n        return -2;                 /* invalid packet length */\n\n    /*\n     * some DHCP servers send their responses as MAC broadcast replies\n     * filter messages from the server also by the destination MAC\n     * inside the DHCP response\n     */\n    if (!fromVM) {\n        if (virMacAddrCmpRaw(&req->binding->mac,\n                             (unsigned char *)&pd->d_chaddr) != 0)\n            return -2;\n    }\n\n    if (virNWFilterSnoopDHCPGetOpt(pd, len, &mtype, &leasetime) < 0)\n        return -2;\n\n    memset(&ipl, 0, sizeof(ipl));\n\n    memcpy(&nwint, &pd->d_yiaddr, sizeof(nwint));\n    virSocketAddrSetIPv4AddrNetOrder(&ipl.ipAddress, nwint);\n\n    memcpy(&nwint, &pd->d_siaddr, sizeof(nwint));\n    virSocketAddrSetIPv4AddrNetOrder(&ipl.ipServer, nwint);\n\n    if (leasetime == ~0)\n        ipl.timeout = ~0;\n    else\n        ipl.timeout = time(0) + leasetime;\n\n    ipl.snoopReq = req;\n\n    /* check that the type of message comes from the right direction */\n    switch (mtype) {\n    case DHCPACK:\n    case DHCPDECLINE:\n        if (fromVM)\n            return -2;\n        break;\n    case DHCPRELEASE:\n        if (!fromVM)\n            return -2;\n        break;\n    default:\n        break;\n    }\n\n    switch (mtype) {\n    case DHCPACK:\n        if (virNWFilterSnoopReqLeaseAdd(req, &ipl, true) < 0)\n            return -1;\n        break;\n    case DHCPDECLINE:\n    case DHCPRELEASE:\n        if (virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, true, true) < 0)\n            return -1;\n        break;\n    default:\n        return -2;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopDHCPDecode(virNWFilterSnoopReqPtr req,\n                           virNWFilterSnoopEthHdrPtr pep,\n                           int len, bool fromVM)\n{\n    struct iphdr *pip;\n    struct udphdr *pup;\n    virNWFilterSnoopDHCPHdrPtr pd;\n    virNWFilterSnoopIPLease ipl;\n    uint8_t mtype;\n    uint32_t leasetime;\n    uint32_t nwint;\n\n    /* go through the protocol headers */\n    switch (ntohs(pep->eh_type)) {\n    case ETHERTYPE_IP:\n        VIR_WARNINGS_NO_CAST_ALIGN\n        pip = (struct iphdr *)pep->eh_data;\n        VIR_WARNINGS_RESET\n        len -= offsetof(virNWFilterSnoopEthHdr, eh_data);\n        break;\n    default:\n        return -2;\n    }\n\n    if (len < 0)\n        return -2;\n\n    VIR_WARNINGS_NO_CAST_ALIGN\n    pup = (struct udphdr *)((char *)pip + (pip->ihl << 2));\n    VIR_WARNINGS_RESET\n    len -= pip->ihl << 2;\n    if (len < 0)\n        return -2;\n\n    pd = (virNWFilterSnoopDHCPHdrPtr) ((char *)pup + sizeof(*pup));\n    len -= sizeof(*pup);\n    if (len < 0)\n        return -2;                 /* invalid packet length */\n\n    /*\n     * some DHCP servers send their responses as MAC broadcast replies\n     * filter messages from the server also by the destination MAC\n     * inside the DHCP response\n     */\n    if (!fromVM) {\n        if (virMacAddrCmpRaw(&req->binding->mac,\n                             (unsigned char *)&pd->d_chaddr) != 0)\n            return -2;\n    }\n\n    if (virNWFilterSnoopDHCPGetOpt(pd, len, &mtype, &leasetime) < 0)\n        return -2;\n\n    memset(&ipl, 0, sizeof(ipl));\n\n    memcpy(&nwint, &pd->d_yiaddr, sizeof(nwint));\n    virSocketAddrSetIPv4AddrNetOrder(&ipl.ipAddress, nwint);\n\n    memcpy(&nwint, &pd->d_siaddr, sizeof(nwint));\n    virSocketAddrSetIPv4AddrNetOrder(&ipl.ipServer, nwint);\n\n    if (leasetime == ~0)\n        ipl.timeout = ~0;\n    else\n        ipl.timeout = time(0) + leasetime;\n\n    ipl.snoopReq = req;\n\n    /* check that the type of message comes from the right direction */\n    switch (mtype) {\n    case DHCPACK:\n    case DHCPDECLINE:\n        if (fromVM)\n            return -2;\n        break;\n    case DHCPRELEASE:\n        if (!fromVM)\n            return -2;\n        break;\n    default:\n        break;\n    }\n\n    switch (mtype) {\n    case DHCPACK:\n        if (virNWFilterSnoopReqLeaseAdd(req, &ipl, true) < 0)\n            return -1;\n        break;\n    case DHCPDECLINE:\n    case DHCPRELEASE:\n        if (virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, true, true) < 0)\n            return -1;\n        break;\n    default:\n        return -2;\n    }\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void virNWFilterDHCPDecodeWorker(void *jobdata, void *opaque)\n{\n    virNWFilterSnoopReqPtr req = opaque;\n    virNWFilterDHCPDecodeJobPtr job = jobdata;\n    virNWFilterSnoopEthHdrPtr packet = (virNWFilterSnoopEthHdrPtr)job->packet;\n\n    if (virNWFilterSnoopDHCPDecode(req, packet,\n                                   job->caplen, job->fromVM) == -1) {\n        req->jobCompletionStatus = -1;\n\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Instantiation of rules failed on \"\n                         \"interface '%s'\"), req->binding->portdevname);\n    }\n    ignore_value(!!g_atomic_int_dec_and_test(job->qCtr));\n    VIR_FREE(job);\n}"
  },
  {
    "function_name": "virNWFilterSnoopDHCPOpen",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "1043-1124",
    "snippet": "static pcap_t *\nvirNWFilterSnoopDHCPOpen(const char *ifname, virMacAddr *mac,\n                         const char *filter, pcap_direction_t dir)\n{\n    pcap_t *handle = NULL;\n    struct bpf_program fp;\n    char pcap_errbuf[PCAP_ERRBUF_SIZE];\n    char *ext_filter = NULL;\n    char macaddr[VIR_MAC_STRING_BUFLEN];\n\n    virMacAddrFormat(mac, macaddr);\n\n    if (dir == PCAP_D_IN /* from VM */) {\n        /*\n         * don't want to hear about another VM's DHCP requests\n         *\n         * extend the filter with the macaddr of the VM; filter the\n         * more unlikely parameters first, then go for the MAC\n         */\n        ext_filter = g_strdup_printf(\"%s and ether src %s\", filter, macaddr);\n    } else {\n        /*\n         * Some DHCP servers respond via MAC broadcast; we rely on later\n         * filtering of responses by comparing the MAC address inside the\n         * DHCP response against the one of the VM. Assuming that the\n         * bridge learns the VM's MAC address quickly this should not\n         * generate much more traffic than if we filtered by VM and\n         * braodcast MAC as well\n         */\n        ext_filter = g_strdup(filter);\n    }\n\n    handle = pcap_create(ifname, pcap_errbuf);\n\n    if (handle == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"pcap_create failed\"));\n        goto cleanup_nohandle;\n    }\n\n    if (pcap_set_snaplen(handle, PCAP_PBUFSIZE) < 0 ||\n        pcap_set_immediate_mode(handle, 1) < 0 ||\n        pcap_activate(handle) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"setup of pcap handle failed: %s\"),\n                       pcap_geterr(handle));\n        goto cleanup;\n    }\n\n    if (pcap_compile(handle, &fp, ext_filter, 1, PCAP_NETMASK_UNKNOWN) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_compile: %s\"), pcap_geterr(handle));\n        goto cleanup;\n    }\n\n    if (pcap_setfilter(handle, &fp) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_setfilter: %s\"), pcap_geterr(handle));\n        goto cleanup_freecode;\n    }\n\n    if (pcap_setdirection(handle, dir) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_setdirection: %s\"),\n                       pcap_geterr(handle));\n        goto cleanup_freecode;\n    }\n\n    pcap_freecode(&fp);\n    VIR_FREE(ext_filter);\n\n    return handle;\n\n cleanup_freecode:\n    pcap_freecode(&fp);\n cleanup:\n    pcap_close(handle);\n cleanup_nohandle:\n    VIR_FREE(ext_filter);\n\n    return NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ext_filter"
          ],
          "line": 1121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_close",
          "args": [
            "handle"
          ],
          "line": 1119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_freecode",
          "args": [
            "&fp"
          ],
          "line": 1117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ext_filter"
          ],
          "line": 1112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_freecode",
          "args": [
            "&fp"
          ],
          "line": 1111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"pcap_setdirection: %s\")",
            "pcap_geterr(handle)"
          ],
          "line": 1105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_geterr",
          "args": [
            "handle"
          ],
          "line": 1107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"pcap_setdirection: %s\""
          ],
          "line": 1106
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pcap_setdirection",
          "args": [
            "handle",
            "dir"
          ],
          "line": 1104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"pcap_setfilter: %s\")",
            "pcap_geterr(handle)"
          ],
          "line": 1099
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_geterr",
          "args": [
            "handle"
          ],
          "line": 1100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_setfilter",
          "args": [
            "handle",
            "&fp"
          ],
          "line": 1098
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"pcap_compile: %s\")",
            "pcap_geterr(handle)"
          ],
          "line": 1093
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_geterr",
          "args": [
            "handle"
          ],
          "line": 1094
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_compile",
          "args": [
            "handle",
            "&fp",
            "ext_filter",
            "1",
            "PCAP_NETMASK_UNKNOWN"
          ],
          "line": 1092
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"setup of pcap handle failed: %s\")",
            "pcap_geterr(handle)"
          ],
          "line": 1086
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_geterr",
          "args": [
            "handle"
          ],
          "line": 1088
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_activate",
          "args": [
            "handle"
          ],
          "line": 1085
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_set_immediate_mode",
          "args": [
            "handle",
            "1"
          ],
          "line": 1084
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_set_snaplen",
          "args": [
            "handle",
            "PCAP_PBUFSIZE"
          ],
          "line": 1083
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"pcap_create failed\")"
          ],
          "line": 1078
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcap_create",
          "args": [
            "ifname",
            "pcap_errbuf"
          ],
          "line": 1075
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "filter"
          ],
          "line": 1072
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMacAddrFormat",
          "args": [
            "mac",
            "macaddr"
          ],
          "line": 1053
        },
        "resolved": true,
        "details": {
          "function_name": "virMacAddrFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmacaddr.c",
          "lines": "184-194",
          "snippet": "const char *\nvirMacAddrFormat(const virMacAddr *addr,\n                 char *str)\n{\n    g_snprintf(str, VIR_MAC_STRING_BUFLEN,\n               \"%02x:%02x:%02x:%02x:%02x:%02x\",\n               addr->addr[0], addr->addr[1], addr->addr[2],\n               addr->addr[3], addr->addr[4], addr->addr[5]);\n    str[VIR_MAC_STRING_BUFLEN-1] = '\\0';\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virrandom.h\"",
            "#include \"virmacaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virrandom.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nconst char *\nvirMacAddrFormat(const virMacAddr *addr,\n                 char *str)\n{\n    g_snprintf(str, VIR_MAC_STRING_BUFLEN,\n               \"%02x:%02x:%02x:%02x:%02x:%02x\",\n               addr->addr[0], addr->addr[1], addr->addr[2],\n               addr->addr[3], addr->addr[4], addr->addr[5]);\n    str[VIR_MAC_STRING_BUFLEN-1] = '\\0';\n    return str;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic pcap_t *\nvirNWFilterSnoopDHCPOpen(const char *ifname, virMacAddr *mac,\n                         const char *filter, pcap_direction_t dir)\n{\n    pcap_t *handle = NULL;\n    struct bpf_program fp;\n    char pcap_errbuf[PCAP_ERRBUF_SIZE];\n    char *ext_filter = NULL;\n    char macaddr[VIR_MAC_STRING_BUFLEN];\n\n    virMacAddrFormat(mac, macaddr);\n\n    if (dir == PCAP_D_IN /* from VM */) {\n        /*\n         * don't want to hear about another VM's DHCP requests\n         *\n         * extend the filter with the macaddr of the VM; filter the\n         * more unlikely parameters first, then go for the MAC\n         */\n        ext_filter = g_strdup_printf(\"%s and ether src %s\", filter, macaddr);\n    } else {\n        /*\n         * Some DHCP servers respond via MAC broadcast; we rely on later\n         * filtering of responses by comparing the MAC address inside the\n         * DHCP response against the one of the VM. Assuming that the\n         * bridge learns the VM's MAC address quickly this should not\n         * generate much more traffic than if we filtered by VM and\n         * braodcast MAC as well\n         */\n        ext_filter = g_strdup(filter);\n    }\n\n    handle = pcap_create(ifname, pcap_errbuf);\n\n    if (handle == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"pcap_create failed\"));\n        goto cleanup_nohandle;\n    }\n\n    if (pcap_set_snaplen(handle, PCAP_PBUFSIZE) < 0 ||\n        pcap_set_immediate_mode(handle, 1) < 0 ||\n        pcap_activate(handle) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"setup of pcap handle failed: %s\"),\n                       pcap_geterr(handle));\n        goto cleanup;\n    }\n\n    if (pcap_compile(handle, &fp, ext_filter, 1, PCAP_NETMASK_UNKNOWN) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_compile: %s\"), pcap_geterr(handle));\n        goto cleanup;\n    }\n\n    if (pcap_setfilter(handle, &fp) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_setfilter: %s\"), pcap_geterr(handle));\n        goto cleanup_freecode;\n    }\n\n    if (pcap_setdirection(handle, dir) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"pcap_setdirection: %s\"),\n                       pcap_geterr(handle));\n        goto cleanup_freecode;\n    }\n\n    pcap_freecode(&fp);\n    VIR_FREE(ext_filter);\n\n    return handle;\n\n cleanup_freecode:\n    pcap_freecode(&fp);\n cleanup:\n    pcap_close(handle);\n cleanup_nohandle:\n    VIR_FREE(ext_filter);\n\n    return NULL;\n}"
  },
  {
    "function_name": "virNWFilterSnoopDHCPDecode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "942-1041",
    "snippet": "static int\nvirNWFilterSnoopDHCPDecode(virNWFilterSnoopReqPtr req,\n                           virNWFilterSnoopEthHdrPtr pep,\n                           int len, bool fromVM)\n{\n    struct iphdr *pip;\n    struct udphdr *pup;\n    virNWFilterSnoopDHCPHdrPtr pd;\n    virNWFilterSnoopIPLease ipl;\n    uint8_t mtype;\n    uint32_t leasetime;\n    uint32_t nwint;\n\n    /* go through the protocol headers */\n    switch (ntohs(pep->eh_type)) {\n    case ETHERTYPE_IP:\n        VIR_WARNINGS_NO_CAST_ALIGN\n        pip = (struct iphdr *)pep->eh_data;\n        VIR_WARNINGS_RESET\n        len -= offsetof(virNWFilterSnoopEthHdr, eh_data);\n        break;\n    default:\n        return -2;\n    }\n\n    if (len < 0)\n        return -2;\n\n    VIR_WARNINGS_NO_CAST_ALIGN\n    pup = (struct udphdr *)((char *)pip + (pip->ihl << 2));\n    VIR_WARNINGS_RESET\n    len -= pip->ihl << 2;\n    if (len < 0)\n        return -2;\n\n    pd = (virNWFilterSnoopDHCPHdrPtr) ((char *)pup + sizeof(*pup));\n    len -= sizeof(*pup);\n    if (len < 0)\n        return -2;                 /* invalid packet length */\n\n    /*\n     * some DHCP servers send their responses as MAC broadcast replies\n     * filter messages from the server also by the destination MAC\n     * inside the DHCP response\n     */\n    if (!fromVM) {\n        if (virMacAddrCmpRaw(&req->binding->mac,\n                             (unsigned char *)&pd->d_chaddr) != 0)\n            return -2;\n    }\n\n    if (virNWFilterSnoopDHCPGetOpt(pd, len, &mtype, &leasetime) < 0)\n        return -2;\n\n    memset(&ipl, 0, sizeof(ipl));\n\n    memcpy(&nwint, &pd->d_yiaddr, sizeof(nwint));\n    virSocketAddrSetIPv4AddrNetOrder(&ipl.ipAddress, nwint);\n\n    memcpy(&nwint, &pd->d_siaddr, sizeof(nwint));\n    virSocketAddrSetIPv4AddrNetOrder(&ipl.ipServer, nwint);\n\n    if (leasetime == ~0)\n        ipl.timeout = ~0;\n    else\n        ipl.timeout = time(0) + leasetime;\n\n    ipl.snoopReq = req;\n\n    /* check that the type of message comes from the right direction */\n    switch (mtype) {\n    case DHCPACK:\n    case DHCPDECLINE:\n        if (fromVM)\n            return -2;\n        break;\n    case DHCPRELEASE:\n        if (!fromVM)\n            return -2;\n        break;\n    default:\n        break;\n    }\n\n    switch (mtype) {\n    case DHCPACK:\n        if (virNWFilterSnoopReqLeaseAdd(req, &ipl, true) < 0)\n            return -1;\n        break;\n    case DHCPDECLINE:\n    case DHCPRELEASE:\n        if (virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, true, true) < 0)\n            return -1;\n        break;\n    default:\n        return -2;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLeaseDel",
          "args": [
            "req",
            "&ipl.ipAddress",
            "true",
            "true"
          ],
          "line": 1033
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLeaseDel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "813-878",
          "snippet": "static int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLeaseAdd",
          "args": [
            "req",
            "&ipl",
            "true"
          ],
          "line": 1028
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLeaseAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "716-765",
          "snippet": "static int\nvirNWFilterSnoopReqLeaseAdd(virNWFilterSnoopReqPtr req,\n                            virNWFilterSnoopIPLeasePtr plnew,\n                            bool update_leasefile)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->snoopReq = req;\n\n    /* protect req->start and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    pl = virNWFilterSnoopIPLeaseGetByIP(req->start, &plnew->ipAddress);\n\n    if (pl) {\n        virNWFilterSnoopIPLeaseUpdate(pl, plnew->timeout);\n\n        virNWFilterSnoopReqUnlock(req);\n\n        goto exit;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    if (VIR_ALLOC(pl) < 0)\n        return -1;\n    *pl = *plnew;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey && virNWFilterSnoopIPLeaseInstallRule(pl, true) < 0) {\n        virNWFilterSnoopReqUnlock(req);\n        VIR_FREE(pl);\n        return -1;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    /* put the lease on the req's list */\n    virNWFilterSnoopIPLeaseTimerAdd(pl);\n\n    g_atomic_int_add(&virNWFilterSnoopState.nLeases, 1);\n\n exit:\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(pl);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqLeaseAdd(virNWFilterSnoopReqPtr req,\n                            virNWFilterSnoopIPLeasePtr plnew,\n                            bool update_leasefile)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->snoopReq = req;\n\n    /* protect req->start and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    pl = virNWFilterSnoopIPLeaseGetByIP(req->start, &plnew->ipAddress);\n\n    if (pl) {\n        virNWFilterSnoopIPLeaseUpdate(pl, plnew->timeout);\n\n        virNWFilterSnoopReqUnlock(req);\n\n        goto exit;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    if (VIR_ALLOC(pl) < 0)\n        return -1;\n    *pl = *plnew;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey && virNWFilterSnoopIPLeaseInstallRule(pl, true) < 0) {\n        virNWFilterSnoopReqUnlock(req);\n        VIR_FREE(pl);\n        return -1;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    /* put the lease on the req's list */\n    virNWFilterSnoopIPLeaseTimerAdd(pl);\n\n    g_atomic_int_add(&virNWFilterSnoopState.nLeases, 1);\n\n exit:\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(pl);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "0"
          ],
          "line": 1007
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSocketAddrSetIPv4AddrNetOrder",
          "args": [
            "&ipl.ipServer",
            "nwint"
          ],
          "line": 1002
        },
        "resolved": true,
        "details": {
          "function_name": "virSocketAddrSetIPv4AddrNetOrder",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocketaddr.c",
          "lines": "295-301",
          "snippet": "void\nvirSocketAddrSetIPv4AddrNetOrder(virSocketAddrPtr addr, uint32_t val)\n{\n    addr->data.stor.ss_family = AF_INET;\n    addr->data.inet4.sin_addr.s_addr = val;\n    addr->len = sizeof(struct sockaddr_in);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virsocketaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virsocketaddr.h\"\n#include <config.h>\n\nvoid\nvirSocketAddrSetIPv4AddrNetOrder(virSocketAddrPtr addr, uint32_t val)\n{\n    addr->data.stor.ss_family = AF_INET;\n    addr->data.inet4.sin_addr.s_addr = val;\n    addr->len = sizeof(struct sockaddr_in);\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&nwint",
            "&pd->d_siaddr",
            "sizeof(nwint)"
          ],
          "line": 1001
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&nwint",
            "&pd->d_yiaddr",
            "sizeof(nwint)"
          ],
          "line": 998
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&ipl",
            "0",
            "sizeof(ipl)"
          ],
          "line": 996
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopDHCPGetOpt",
          "args": [
            "pd",
            "len",
            "&mtype",
            "&leasetime"
          ],
          "line": 993
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopDHCPGetOpt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "880-933",
          "snippet": "static int\nvirNWFilterSnoopDHCPGetOpt(virNWFilterSnoopDHCPHdrPtr pd, int len,\n                           uint8_t *pmtype, uint32_t *pleasetime)\n{\n    int oind, olen;\n    uint32_t nwint;\n\n    olen = len - sizeof(*pd);\n    oind = 0;\n\n    if (olen < 4)               /* bad magic */\n        return -1;\n\n    if (memcmp(dhcp_magic, pd->d_opts, sizeof(dhcp_magic)) != 0)\n        return -1;              /* bad magic */\n\n    oind += sizeof(dhcp_magic);\n\n    *pmtype = 0;\n    *pleasetime = 0;\n\n    while (oind < olen) {\n        switch (pd->d_opts[oind]) {\n        case DHCPO_LEASE:\n            if (olen - oind < 6)\n                goto malformed;\n            if (*pleasetime)\n                return -1;  /* duplicate lease time */\n            memcpy(&nwint, (char *)pd->d_opts + oind + 2, sizeof(nwint));\n            *pleasetime = ntohl(nwint);\n            break;\n        case DHCPO_MTYPE:\n            if (olen - oind < 3)\n                goto malformed;\n            if (*pmtype)\n                return -1;  /* duplicate message type */\n            *pmtype = pd->d_opts[oind + 2];\n            break;\n        case DHCPO_PAD:\n            oind++;\n            continue;\n        case DHCPO_END:\n            return 0;\n        default:\n            if (olen - oind < 2)\n                goto malformed;\n        }\n        oind += pd->d_opts[oind + 1] + 2;\n    }\n    return 0;\n malformed:\n    VIR_WARN(\"got lost in the options!\");\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopDHCPGetOpt(virNWFilterSnoopDHCPHdrPtr pd, int len,\n                           uint8_t *pmtype, uint32_t *pleasetime)\n{\n    int oind, olen;\n    uint32_t nwint;\n\n    olen = len - sizeof(*pd);\n    oind = 0;\n\n    if (olen < 4)               /* bad magic */\n        return -1;\n\n    if (memcmp(dhcp_magic, pd->d_opts, sizeof(dhcp_magic)) != 0)\n        return -1;              /* bad magic */\n\n    oind += sizeof(dhcp_magic);\n\n    *pmtype = 0;\n    *pleasetime = 0;\n\n    while (oind < olen) {\n        switch (pd->d_opts[oind]) {\n        case DHCPO_LEASE:\n            if (olen - oind < 6)\n                goto malformed;\n            if (*pleasetime)\n                return -1;  /* duplicate lease time */\n            memcpy(&nwint, (char *)pd->d_opts + oind + 2, sizeof(nwint));\n            *pleasetime = ntohl(nwint);\n            break;\n        case DHCPO_MTYPE:\n            if (olen - oind < 3)\n                goto malformed;\n            if (*pmtype)\n                return -1;  /* duplicate message type */\n            *pmtype = pd->d_opts[oind + 2];\n            break;\n        case DHCPO_PAD:\n            oind++;\n            continue;\n        case DHCPO_END:\n            return 0;\n        default:\n            if (olen - oind < 2)\n                goto malformed;\n        }\n        oind += pd->d_opts[oind + 1] + 2;\n    }\n    return 0;\n malformed:\n    VIR_WARN(\"got lost in the options!\");\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMacAddrCmpRaw",
          "args": [
            "&req->binding->mac",
            "(unsigned char *)&pd->d_chaddr"
          ],
          "line": 988
        },
        "resolved": true,
        "details": {
          "function_name": "virMacAddrCmpRaw",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmacaddr.c",
          "lines": "86-91",
          "snippet": "int\nvirMacAddrCmpRaw(const virMacAddr *mac1,\n                 const unsigned char mac2[VIR_MAC_BUFLEN])\n{\n    return memcmp(mac1->addr, mac2, VIR_MAC_BUFLEN);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virrandom.h\"",
            "#include \"virmacaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virrandom.h\"\n#include \"virmacaddr.h\"\n#include <config.h>\n\nint\nvirMacAddrCmpRaw(const virMacAddr *mac1,\n                 const unsigned char mac2[VIR_MAC_BUFLEN])\n{\n    return memcmp(mac1->addr, mac2, VIR_MAC_BUFLEN);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "(char *)pup + sizeof(*pup)"
          ],
          "line": 977
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntohs",
          "args": [
            "pep->eh_type"
          ],
          "line": 956
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopDHCPDecode(virNWFilterSnoopReqPtr req,\n                           virNWFilterSnoopEthHdrPtr pep,\n                           int len, bool fromVM)\n{\n    struct iphdr *pip;\n    struct udphdr *pup;\n    virNWFilterSnoopDHCPHdrPtr pd;\n    virNWFilterSnoopIPLease ipl;\n    uint8_t mtype;\n    uint32_t leasetime;\n    uint32_t nwint;\n\n    /* go through the protocol headers */\n    switch (ntohs(pep->eh_type)) {\n    case ETHERTYPE_IP:\n        VIR_WARNINGS_NO_CAST_ALIGN\n        pip = (struct iphdr *)pep->eh_data;\n        VIR_WARNINGS_RESET\n        len -= offsetof(virNWFilterSnoopEthHdr, eh_data);\n        break;\n    default:\n        return -2;\n    }\n\n    if (len < 0)\n        return -2;\n\n    VIR_WARNINGS_NO_CAST_ALIGN\n    pup = (struct udphdr *)((char *)pip + (pip->ihl << 2));\n    VIR_WARNINGS_RESET\n    len -= pip->ihl << 2;\n    if (len < 0)\n        return -2;\n\n    pd = (virNWFilterSnoopDHCPHdrPtr) ((char *)pup + sizeof(*pup));\n    len -= sizeof(*pup);\n    if (len < 0)\n        return -2;                 /* invalid packet length */\n\n    /*\n     * some DHCP servers send their responses as MAC broadcast replies\n     * filter messages from the server also by the destination MAC\n     * inside the DHCP response\n     */\n    if (!fromVM) {\n        if (virMacAddrCmpRaw(&req->binding->mac,\n                             (unsigned char *)&pd->d_chaddr) != 0)\n            return -2;\n    }\n\n    if (virNWFilterSnoopDHCPGetOpt(pd, len, &mtype, &leasetime) < 0)\n        return -2;\n\n    memset(&ipl, 0, sizeof(ipl));\n\n    memcpy(&nwint, &pd->d_yiaddr, sizeof(nwint));\n    virSocketAddrSetIPv4AddrNetOrder(&ipl.ipAddress, nwint);\n\n    memcpy(&nwint, &pd->d_siaddr, sizeof(nwint));\n    virSocketAddrSetIPv4AddrNetOrder(&ipl.ipServer, nwint);\n\n    if (leasetime == ~0)\n        ipl.timeout = ~0;\n    else\n        ipl.timeout = time(0) + leasetime;\n\n    ipl.snoopReq = req;\n\n    /* check that the type of message comes from the right direction */\n    switch (mtype) {\n    case DHCPACK:\n    case DHCPDECLINE:\n        if (fromVM)\n            return -2;\n        break;\n    case DHCPRELEASE:\n        if (!fromVM)\n            return -2;\n        break;\n    default:\n        break;\n    }\n\n    switch (mtype) {\n    case DHCPACK:\n        if (virNWFilterSnoopReqLeaseAdd(req, &ipl, true) < 0)\n            return -1;\n        break;\n    case DHCPDECLINE:\n    case DHCPRELEASE:\n        if (virNWFilterSnoopReqLeaseDel(req, &ipl.ipAddress, true, true) < 0)\n            return -1;\n        break;\n    default:\n        return -2;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virNWFilterSnoopDHCPGetOpt",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "880-933",
    "snippet": "static int\nvirNWFilterSnoopDHCPGetOpt(virNWFilterSnoopDHCPHdrPtr pd, int len,\n                           uint8_t *pmtype, uint32_t *pleasetime)\n{\n    int oind, olen;\n    uint32_t nwint;\n\n    olen = len - sizeof(*pd);\n    oind = 0;\n\n    if (olen < 4)               /* bad magic */\n        return -1;\n\n    if (memcmp(dhcp_magic, pd->d_opts, sizeof(dhcp_magic)) != 0)\n        return -1;              /* bad magic */\n\n    oind += sizeof(dhcp_magic);\n\n    *pmtype = 0;\n    *pleasetime = 0;\n\n    while (oind < olen) {\n        switch (pd->d_opts[oind]) {\n        case DHCPO_LEASE:\n            if (olen - oind < 6)\n                goto malformed;\n            if (*pleasetime)\n                return -1;  /* duplicate lease time */\n            memcpy(&nwint, (char *)pd->d_opts + oind + 2, sizeof(nwint));\n            *pleasetime = ntohl(nwint);\n            break;\n        case DHCPO_MTYPE:\n            if (olen - oind < 3)\n                goto malformed;\n            if (*pmtype)\n                return -1;  /* duplicate message type */\n            *pmtype = pd->d_opts[oind + 2];\n            break;\n        case DHCPO_PAD:\n            oind++;\n            continue;\n        case DHCPO_END:\n            return 0;\n        default:\n            if (olen - oind < 2)\n                goto malformed;\n        }\n        oind += pd->d_opts[oind + 1] + 2;\n    }\n    return 0;\n malformed:\n    VIR_WARN(\"got lost in the options!\");\n    return -1;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"got lost in the options!\""
          ],
          "line": 931
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntohl",
          "args": [
            "nwint"
          ],
          "line": 909
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "&nwint",
            "(char *)pd->d_opts + oind + 2",
            "sizeof(nwint)"
          ],
          "line": 908
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "dhcp_magic",
            "pd->d_opts",
            "sizeof(dhcp_magic)"
          ],
          "line": 893
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopDHCPGetOpt(virNWFilterSnoopDHCPHdrPtr pd, int len,\n                           uint8_t *pmtype, uint32_t *pleasetime)\n{\n    int oind, olen;\n    uint32_t nwint;\n\n    olen = len - sizeof(*pd);\n    oind = 0;\n\n    if (olen < 4)               /* bad magic */\n        return -1;\n\n    if (memcmp(dhcp_magic, pd->d_opts, sizeof(dhcp_magic)) != 0)\n        return -1;              /* bad magic */\n\n    oind += sizeof(dhcp_magic);\n\n    *pmtype = 0;\n    *pleasetime = 0;\n\n    while (oind < olen) {\n        switch (pd->d_opts[oind]) {\n        case DHCPO_LEASE:\n            if (olen - oind < 6)\n                goto malformed;\n            if (*pleasetime)\n                return -1;  /* duplicate lease time */\n            memcpy(&nwint, (char *)pd->d_opts + oind + 2, sizeof(nwint));\n            *pleasetime = ntohl(nwint);\n            break;\n        case DHCPO_MTYPE:\n            if (olen - oind < 3)\n                goto malformed;\n            if (*pmtype)\n                return -1;  /* duplicate message type */\n            *pmtype = pd->d_opts[oind + 2];\n            break;\n        case DHCPO_PAD:\n            oind++;\n            continue;\n        case DHCPO_END:\n            return 0;\n        default:\n            if (olen - oind < 2)\n                goto malformed;\n        }\n        oind += pd->d_opts[oind + 1] + 2;\n    }\n    return 0;\n malformed:\n    VIR_WARN(\"got lost in the options!\");\n    return -1;\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqLeaseDel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "813-878",
    "snippet": "static int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 875
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ipstr"
          ],
          "line": 873
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases)"
          ],
          "line": 870
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_dec_and_test",
          "args": [
            "&virNWFilterSnoopState.nLeases"
          ],
          "line": 870
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ipl"
          ],
          "line": 868
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"virNWFilterSnoopListDel failed\")"
          ],
          "line": 860
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"virNWFilterSnoopListDel failed\""
          ],
          "line": 861
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "req->techdriver->applyDHCPOnlyRules",
          "args": [
            "req->binding->portdevname",
            "&req->binding->mac",
            "dhcpsrvrs",
            "false"
          ],
          "line": 857
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "req->binding->filterparams",
            "NWFILTER_VARNAME_DHCPSERVER"
          ],
          "line": 853
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterInstantiateFilterLate",
          "args": [
            "req->driver",
            "req->binding",
            "req->ifindex"
          ],
          "line": 848
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterInstantiateFilterLate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "785-814",
          "snippet": "int\nvirNWFilterInstantiateFilterLate(virNWFilterDriverStatePtr driver,\n                                 virNWFilterBindingDefPtr binding,\n                                 int ifindex)\n{\n    int rc;\n    bool foundNewFilter = false;\n\n    virNWFilterReadLockFilterUpdates();\n    virMutexLock(&updateMutex);\n\n    rc = virNWFilterInstantiateFilterUpdate(driver, true,\n                                            binding, ifindex,\n                                            INSTANTIATE_ALWAYS, true,\n                                            &foundNewFilter);\n    if (rc < 0) {\n        /* something went wrong... 'DOWN' the interface */\n        if ((virNetDevValidateConfig(binding->portdevname, NULL, ifindex) <= 0) ||\n            (virNetDevSetOnline(binding->portdevname, false) < 0)) {\n            virResetLastError();\n            /* assuming interface disappeared... */\n            _virNWFilterTeardownFilter(binding->portdevname);\n        }\n    }\n\n    virNWFilterUnlockFilterUpdates();\n    virMutexUnlock(&updateMutex);\n\n    return rc;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex updateMutex;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virMutex updateMutex;\n\nint\nvirNWFilterInstantiateFilterLate(virNWFilterDriverStatePtr driver,\n                                 virNWFilterBindingDefPtr binding,\n                                 int ifindex)\n{\n    int rc;\n    bool foundNewFilter = false;\n\n    virNWFilterReadLockFilterUpdates();\n    virMutexLock(&updateMutex);\n\n    rc = virNWFilterInstantiateFilterUpdate(driver, true,\n                                            binding, ifindex,\n                                            INSTANTIATE_ALWAYS, true,\n                                            &foundNewFilter);\n    if (rc < 0) {\n        /* something went wrong... 'DOWN' the interface */\n        if ((virNetDevValidateConfig(binding->portdevname, NULL, ifindex) <= 0) ||\n            (virNetDevSetOnline(binding->portdevname, false) < 0)) {\n            virResetLastError();\n            /* assuming interface disappeared... */\n            _virNWFilterTeardownFilter(binding->portdevname);\n        }\n    }\n\n    virNWFilterUnlockFilterUpdates();\n    virMutexUnlock(&updateMutex);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterIPAddrMapDelIPAddr",
          "args": [
            "req->binding->portdevname",
            "ipstr"
          ],
          "line": 847
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterIPAddrMapDelIPAddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_ipaddrmap.c",
          "lines": "99-127",
          "snippet": "int\nvirNWFilterIPAddrMapDelIPAddr(const char *ifname, const char *ipaddr)\n{\n    int ret = -1;\n    virNWFilterVarValuePtr val = NULL;\n\n    virMutexLock(&ipAddressMapLock);\n\n    if (ipaddr != NULL) {\n        val = virHashLookup(ipAddressMap, ifname);\n        if (val) {\n            if (virNWFilterVarValueGetCardinality(val) == 1 &&\n                STREQ(ipaddr,\n                      virNWFilterVarValueGetNthValue(val, 0)))\n                goto remove_entry;\n            virNWFilterVarValueDelValue(val, ipaddr);\n            ret = virNWFilterVarValueGetCardinality(val);\n        }\n    } else {\n remove_entry:\n        /* remove whole entry */\n        virHashRemoveEntry(ipAddressMap, ifname);\n        ret = 0;\n    }\n\n    virMutexUnlock(&ipAddressMapLock);\n\n    return ret;\n}",
          "includes": [
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;",
            "static virHashTablePtr ipAddressMap;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;\nstatic virHashTablePtr ipAddressMap;\n\nint\nvirNWFilterIPAddrMapDelIPAddr(const char *ifname, const char *ipaddr)\n{\n    int ret = -1;\n    virNWFilterVarValuePtr val = NULL;\n\n    virMutexLock(&ipAddressMapLock);\n\n    if (ipaddr != NULL) {\n        val = virHashLookup(ipAddressMap, ifname);\n        if (val) {\n            if (virNWFilterVarValueGetCardinality(val) == 1 &&\n                STREQ(ipaddr,\n                      virNWFilterVarValueGetNthValue(val, 0)))\n                goto remove_entry;\n            virNWFilterVarValueDelValue(val, ipaddr);\n            ret = virNWFilterVarValueGetCardinality(val);\n        }\n    } else {\n remove_entry:\n        /* remove whole entry */\n        virHashRemoveEntry(ipAddressMap, ifname);\n        ret = 0;\n    }\n\n    virMutexUnlock(&ipAddressMapLock);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileSave",
          "args": [
            "ipl"
          ],
          "line": 839
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileSave",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1766-1786",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileSave(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    virNWFilterSnoopLock();\n\n    if (virNWFilterSnoopState.leaseFD < 0)\n        virNWFilterSnoopLeaseFileOpen();\n    if (virNWFilterSnoopLeaseFileWrite(virNWFilterSnoopState.leaseFD,\n                                       req->ifkey, ipl) < 0)\n        goto err_exit;\n\n    /* keep dead leases at < ~95% of file size */\n    if (g_atomic_int_add(&virNWFilterSnoopState.wLeases, 1) >=\n        g_atomic_int_get(&virNWFilterSnoopState.nLeases) * 20)\n        virNWFilterSnoopLeaseFileLoad();   /* load & refresh lease file */\n\n err_exit:\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileSave(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    virNWFilterSnoopLock();\n\n    if (virNWFilterSnoopState.leaseFD < 0)\n        virNWFilterSnoopLeaseFileOpen();\n    if (virNWFilterSnoopLeaseFileWrite(virNWFilterSnoopState.leaseFD,\n                                       req->ifkey, ipl) < 0)\n        goto err_exit;\n\n    /* keep dead leases at < ~95% of file size */\n    if (g_atomic_int_add(&virNWFilterSnoopState.wLeases, 1) >=\n        g_atomic_int_get(&virNWFilterSnoopState.nLeases) * 20)\n        virNWFilterSnoopLeaseFileLoad();   /* load & refresh lease file */\n\n err_exit:\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseTimerDel",
          "args": [
            "ipl"
          ],
          "line": 835
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseTimerDel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "417-430",
          "snippet": "static void\nvirNWFilterSnoopIPLeaseTimerDel(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListDel(ipl, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    ipl->timeout = 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIPLeaseTimerDel(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListDel(ipl, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    ipl->timeout = 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSocketAddrFormat",
          "args": [
            "&ipl->ipAddress"
          ],
          "line": 829
        },
        "resolved": true,
        "details": {
          "function_name": "virSocketAddrFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocketaddr.c",
          "lines": "441-445",
          "snippet": "char *\nvirSocketAddrFormat(const virSocketAddr *addr)\n{\n    return virSocketAddrFormatFull(addr, false, NULL);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virsocketaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virsocketaddr.h\"\n#include <config.h>\n\nchar *\nvirSocketAddrFormat(const virSocketAddr *addr)\n{\n    return virSocketAddrFormatFull(addr, false, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseGetByIP",
          "args": [
            "req->start",
            "ipaddr"
          ],
          "line": 825
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseGetByIP",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "499-510",
          "snippet": "static virNWFilterSnoopIPLeasePtr\nvirNWFilterSnoopIPLeaseGetByIP(virNWFilterSnoopIPLeasePtr start,\n                               virSocketAddrPtr ipaddr)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    for (pl = start;\n         pl && !virSocketAddrEqual(&pl->ipAddress, ipaddr);\n         pl = pl->next)\n        ; /* empty */\n    return pl;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopIPLeasePtr\nvirNWFilterSnoopIPLeaseGetByIP(virNWFilterSnoopIPLeasePtr start,\n                               virSocketAddrPtr ipaddr)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    for (pl = start;\n         pl && !virSocketAddrEqual(&pl->ipAddress, ipaddr);\n         pl = pl->next)\n        ; /* empty */\n    return pl;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 823
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqRestore",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "771-792",
    "snippet": "static int\nvirNWFilterSnoopReqRestore(virNWFilterSnoopReqPtr req)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    for (ipl = req->start; ipl; ipl = ipl->next) {\n        /* instantiate the rules at the last lease */\n        bool is_last = (ipl->next == NULL);\n        if (virNWFilterSnoopIPLeaseInstallRule(ipl, is_last) < 0) {\n            ret = -1;\n            break;\n        }\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 789
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseInstallRule",
          "args": [
            "ipl",
            "is_last"
          ],
          "line": 783
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseInstallRule",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "441-480",
          "snippet": "static int\nvirNWFilterSnoopIPLeaseInstallRule(virNWFilterSnoopIPLeasePtr ipl,\n                                   bool instantiate)\n{\n    char *ipaddr;\n    int rc = -1;\n    virNWFilterSnoopReqPtr req;\n\n    ipaddr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipaddr)\n        return -1;\n\n    req = ipl->snoopReq;\n\n    /* protect req->binding->portdevname */\n    virNWFilterSnoopReqLock(req);\n\n    if (virNWFilterIPAddrMapAddIPAddr(req->binding->portdevname, ipaddr) < 0)\n        goto exit_snooprequnlock;\n\n    if (!instantiate) {\n        rc = 0;\n        goto exit_snooprequnlock;\n    }\n\n    /* instantiate the filters */\n\n    if (req->binding->portdevname) {\n        rc = virNWFilterInstantiateFilterLate(req->driver,\n                                              req->binding,\n                                              req->ifindex);\n    }\n\n exit_snooprequnlock:\n    virNWFilterSnoopReqUnlock(req);\n\n    VIR_FREE(ipaddr);\n\n    return rc;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopIPLeaseInstallRule(virNWFilterSnoopIPLeasePtr ipl,\n                                   bool instantiate)\n{\n    char *ipaddr;\n    int rc = -1;\n    virNWFilterSnoopReqPtr req;\n\n    ipaddr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipaddr)\n        return -1;\n\n    req = ipl->snoopReq;\n\n    /* protect req->binding->portdevname */\n    virNWFilterSnoopReqLock(req);\n\n    if (virNWFilterIPAddrMapAddIPAddr(req->binding->portdevname, ipaddr) < 0)\n        goto exit_snooprequnlock;\n\n    if (!instantiate) {\n        rc = 0;\n        goto exit_snooprequnlock;\n    }\n\n    /* instantiate the filters */\n\n    if (req->binding->portdevname) {\n        rc = virNWFilterInstantiateFilterLate(req->driver,\n                                              req->binding,\n                                              req->ifindex);\n    }\n\n exit_snooprequnlock:\n    virNWFilterSnoopReqUnlock(req);\n\n    VIR_FREE(ipaddr);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 778
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqRestore(virNWFilterSnoopReqPtr req)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    for (ipl = req->start; ipl; ipl = ipl->next) {\n        /* instantiate the rules at the last lease */\n        bool is_last = (ipl->next == NULL);\n        if (virNWFilterSnoopIPLeaseInstallRule(ipl, is_last) < 0) {\n            ret = -1;\n            break;\n        }\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqLeaseAdd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "716-765",
    "snippet": "static int\nvirNWFilterSnoopReqLeaseAdd(virNWFilterSnoopReqPtr req,\n                            virNWFilterSnoopIPLeasePtr plnew,\n                            bool update_leasefile)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->snoopReq = req;\n\n    /* protect req->start and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    pl = virNWFilterSnoopIPLeaseGetByIP(req->start, &plnew->ipAddress);\n\n    if (pl) {\n        virNWFilterSnoopIPLeaseUpdate(pl, plnew->timeout);\n\n        virNWFilterSnoopReqUnlock(req);\n\n        goto exit;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    if (VIR_ALLOC(pl) < 0)\n        return -1;\n    *pl = *plnew;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey && virNWFilterSnoopIPLeaseInstallRule(pl, true) < 0) {\n        virNWFilterSnoopReqUnlock(req);\n        VIR_FREE(pl);\n        return -1;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    /* put the lease on the req's list */\n    virNWFilterSnoopIPLeaseTimerAdd(pl);\n\n    g_atomic_int_add(&virNWFilterSnoopState.nLeases, 1);\n\n exit:\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(pl);\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopLeaseFileSave",
          "args": [
            "pl"
          ],
          "line": 762
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopLeaseFileSave",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "1766-1786",
          "snippet": "static void\nvirNWFilterSnoopLeaseFileSave(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    virNWFilterSnoopLock();\n\n    if (virNWFilterSnoopState.leaseFD < 0)\n        virNWFilterSnoopLeaseFileOpen();\n    if (virNWFilterSnoopLeaseFileWrite(virNWFilterSnoopState.leaseFD,\n                                       req->ifkey, ipl) < 0)\n        goto err_exit;\n\n    /* keep dead leases at < ~95% of file size */\n    if (g_atomic_int_add(&virNWFilterSnoopState.wLeases, 1) >=\n        g_atomic_int_get(&virNWFilterSnoopState.nLeases) * 20)\n        virNWFilterSnoopLeaseFileLoad();   /* load & refresh lease file */\n\n err_exit:\n    virNWFilterSnoopUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopLeaseFileSave(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    virNWFilterSnoopLock();\n\n    if (virNWFilterSnoopState.leaseFD < 0)\n        virNWFilterSnoopLeaseFileOpen();\n    if (virNWFilterSnoopLeaseFileWrite(virNWFilterSnoopState.leaseFD,\n                                       req->ifkey, ipl) < 0)\n        goto err_exit;\n\n    /* keep dead leases at < ~95% of file size */\n    if (g_atomic_int_add(&virNWFilterSnoopState.wLeases, 1) >=\n        g_atomic_int_get(&virNWFilterSnoopState.nLeases) * 20)\n        virNWFilterSnoopLeaseFileLoad();   /* load & refresh lease file */\n\n err_exit:\n    virNWFilterSnoopUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_add",
          "args": [
            "&virNWFilterSnoopState.nLeases",
            "1"
          ],
          "line": 758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseTimerAdd",
          "args": [
            "pl"
          ],
          "line": 756
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseTimerAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "401-412",
          "snippet": "static void\nvirNWFilterSnoopIPLeaseTimerAdd(virNWFilterSnoopIPLeasePtr plnew)\n{\n    virNWFilterSnoopReqPtr req = plnew->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListAdd(plnew, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIPLeaseTimerAdd(virNWFilterSnoopIPLeasePtr plnew)\n{\n    virNWFilterSnoopReqPtr req = plnew->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListAdd(plnew, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 753
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pl"
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseInstallRule",
          "args": [
            "pl",
            "true"
          ],
          "line": 747
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseInstallRule",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "441-480",
          "snippet": "static int\nvirNWFilterSnoopIPLeaseInstallRule(virNWFilterSnoopIPLeasePtr ipl,\n                                   bool instantiate)\n{\n    char *ipaddr;\n    int rc = -1;\n    virNWFilterSnoopReqPtr req;\n\n    ipaddr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipaddr)\n        return -1;\n\n    req = ipl->snoopReq;\n\n    /* protect req->binding->portdevname */\n    virNWFilterSnoopReqLock(req);\n\n    if (virNWFilterIPAddrMapAddIPAddr(req->binding->portdevname, ipaddr) < 0)\n        goto exit_snooprequnlock;\n\n    if (!instantiate) {\n        rc = 0;\n        goto exit_snooprequnlock;\n    }\n\n    /* instantiate the filters */\n\n    if (req->binding->portdevname) {\n        rc = virNWFilterInstantiateFilterLate(req->driver,\n                                              req->binding,\n                                              req->ifindex);\n    }\n\n exit_snooprequnlock:\n    virNWFilterSnoopReqUnlock(req);\n\n    VIR_FREE(ipaddr);\n\n    return rc;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopIPLeaseInstallRule(virNWFilterSnoopIPLeasePtr ipl,\n                                   bool instantiate)\n{\n    char *ipaddr;\n    int rc = -1;\n    virNWFilterSnoopReqPtr req;\n\n    ipaddr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipaddr)\n        return -1;\n\n    req = ipl->snoopReq;\n\n    /* protect req->binding->portdevname */\n    virNWFilterSnoopReqLock(req);\n\n    if (virNWFilterIPAddrMapAddIPAddr(req->binding->portdevname, ipaddr) < 0)\n        goto exit_snooprequnlock;\n\n    if (!instantiate) {\n        rc = 0;\n        goto exit_snooprequnlock;\n    }\n\n    /* instantiate the filters */\n\n    if (req->binding->portdevname) {\n        rc = virNWFilterInstantiateFilterLate(req->driver,\n                                              req->binding,\n                                              req->ifindex);\n    }\n\n exit_snooprequnlock:\n    virNWFilterSnoopReqUnlock(req);\n\n    VIR_FREE(ipaddr);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 745
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "pl"
          ],
          "line": 740
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseUpdate",
          "args": [
            "pl",
            "plnew->timeout"
          ],
          "line": 731
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseUpdate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "485-494",
          "snippet": "static void\nvirNWFilterSnoopIPLeaseUpdate(virNWFilterSnoopIPLeasePtr ipl, time_t timeout)\n{\n    if (timeout < ipl->timeout)\n        return;  /* no take-backs */\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    ipl->timeout = timeout;\n    virNWFilterSnoopIPLeaseTimerAdd(ipl);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIPLeaseUpdate(virNWFilterSnoopIPLeasePtr ipl, time_t timeout)\n{\n    if (timeout < ipl->timeout)\n        return;  /* no take-backs */\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    ipl->timeout = timeout;\n    virNWFilterSnoopIPLeaseTimerAdd(ipl);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseGetByIP",
          "args": [
            "req->start",
            "&plnew->ipAddress"
          ],
          "line": 728
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseGetByIP",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "499-510",
          "snippet": "static virNWFilterSnoopIPLeasePtr\nvirNWFilterSnoopIPLeaseGetByIP(virNWFilterSnoopIPLeasePtr start,\n                               virSocketAddrPtr ipaddr)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    for (pl = start;\n         pl && !virSocketAddrEqual(&pl->ipAddress, ipaddr);\n         pl = pl->next)\n        ; /* empty */\n    return pl;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopIPLeasePtr\nvirNWFilterSnoopIPLeaseGetByIP(virNWFilterSnoopIPLeasePtr start,\n                               virSocketAddrPtr ipaddr)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    for (pl = start;\n         pl && !virSocketAddrEqual(&pl->ipAddress, ipaddr);\n         pl = pl->next)\n        ; /* empty */\n    return pl;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqLeaseAdd(virNWFilterSnoopReqPtr req,\n                            virNWFilterSnoopIPLeasePtr plnew,\n                            bool update_leasefile)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->snoopReq = req;\n\n    /* protect req->start and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    pl = virNWFilterSnoopIPLeaseGetByIP(req->start, &plnew->ipAddress);\n\n    if (pl) {\n        virNWFilterSnoopIPLeaseUpdate(pl, plnew->timeout);\n\n        virNWFilterSnoopReqUnlock(req);\n\n        goto exit;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    if (VIR_ALLOC(pl) < 0)\n        return -1;\n    *pl = *plnew;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey && virNWFilterSnoopIPLeaseInstallRule(pl, true) < 0) {\n        virNWFilterSnoopReqUnlock(req);\n        VIR_FREE(pl);\n        return -1;\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    /* put the lease on the req's list */\n    virNWFilterSnoopIPLeaseTimerAdd(pl);\n\n    g_atomic_int_add(&virNWFilterSnoopState.nLeases, 1);\n\n exit:\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(pl);\n\n    return 0;\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqPut",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "686-711",
    "snippet": "static void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 710
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey)"
          ],
          "line": 705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "virNWFilterSnoopState.snoopReqs",
            "req->ifkey"
          ],
          "line": 705
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "0"
          ],
          "line": 704
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqRelease",
          "args": [
            "req"
          ],
          "line": 703
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqRelease",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "641-658",
          "snippet": "static void\nvirNWFilterSnoopReqRelease(void *req0)\n{\n    virNWFilterSnoopReqPtr req = req0;\n\n    if (!req)\n        return;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey)\n        virNWFilterSnoopCancel(&req->threadkey);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    virNWFilterSnoopReqFree(req);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqRelease(void *req0)\n{\n    virNWFilterSnoopReqPtr req = req0;\n\n    if (!req)\n        return;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey)\n        virNWFilterSnoopCancel(&req->threadkey);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    virNWFilterSnoopReqFree(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "virNWFilterSnoopState.snoopReqs",
            "req->ifkey"
          ],
          "line": 702
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_dec_and_test",
          "args": [
            "&req->refctr"
          ],
          "line": 694
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 692
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqPut(virNWFilterSnoopReqPtr req)\n{\n    if (!req)\n        return;\n\n    virNWFilterSnoopLock();\n\n    if (!!g_atomic_int_dec_and_test(&req->refctr)) {\n        /*\n         * delete the request:\n         * - if we don't find req on the global list anymore\n         *   (this happens during SIGHUP)\n         * we would keep the request:\n         * - if we still have a valid lease, keep the req for restarts\n         */\n        if (virHashLookup(virNWFilterSnoopState.snoopReqs, req->ifkey) != req) {\n            virNWFilterSnoopReqRelease(req);\n        } else if (!req->start || req->start->timeout < time(0)) {\n            ignore_value(virHashRemoveEntry(virNWFilterSnoopState.snoopReqs,\n                                            req->ifkey));\n        }\n    }\n\n    virNWFilterSnoopUnlock();\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqGetByIFKey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "666-680",
    "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopUnlock",
          "args": [],
          "line": 677
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqGet",
          "args": [
            "req"
          ],
          "line": 675
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqGetByIFKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "666-680",
          "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "virNWFilterSnoopState.snoopReqs",
            "ifkey"
          ],
          "line": 673
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopLock",
          "args": [],
          "line": 671
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqRelease",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "641-658",
    "snippet": "static void\nvirNWFilterSnoopReqRelease(void *req0)\n{\n    virNWFilterSnoopReqPtr req = req0;\n\n    if (!req)\n        return;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey)\n        virNWFilterSnoopCancel(&req->threadkey);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    virNWFilterSnoopReqFree(req);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqFree",
          "args": [
            "req"
          ],
          "line": 657
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "595-618",
          "snippet": "static void\nvirNWFilterSnoopReqFree(virNWFilterSnoopReqPtr req)\n{\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    if (!req)\n        return;\n\n    if (g_atomic_int_get(&req->refctr) != 0)\n        return;\n\n    /* free all leases */\n    for (ipl = req->start; ipl; ipl = req->start)\n        virNWFilterSnoopReqLeaseDel(req, &ipl->ipAddress, false, false);\n\n    /* free all req data */\n    virNWFilterBindingDefFree(req->binding);\n\n    virMutexDestroy(&req->lock);\n    virCondDestroy(&req->threadStatusCond);\n    virFreeError(req->threadError);\n\n    VIR_FREE(req);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqFree(virNWFilterSnoopReqPtr req)\n{\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    if (!req)\n        return;\n\n    if (g_atomic_int_get(&req->refctr) != 0)\n        return;\n\n    /* free all leases */\n    for (ipl = req->start; ipl; ipl = req->start)\n        virNWFilterSnoopReqLeaseDel(req, &ipl->ipAddress, false, false);\n\n    /* free all req data */\n    virNWFilterBindingDefFree(req->binding);\n\n    virMutexDestroy(&req->lock);\n    virCondDestroy(&req->threadStatusCond);\n    virFreeError(req->threadError);\n\n    VIR_FREE(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopCancel",
          "args": [
            "&req->threadkey"
          ],
          "line": 653
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopCancel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "309-321",
          "snippet": "static void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 650
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqRelease(void *req0)\n{\n    virNWFilterSnoopReqPtr req = req0;\n\n    if (!req)\n        return;\n\n    /* protect req->threadkey */\n    virNWFilterSnoopReqLock(req);\n\n    if (req->threadkey)\n        virNWFilterSnoopCancel(&req->threadkey);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    virNWFilterSnoopReqFree(req);\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqUnlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "632-636",
    "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&req->lock"
          ],
          "line": 635
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqLock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "623-627",
    "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&req->lock"
          ],
          "line": 626
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "595-618",
    "snippet": "static void\nvirNWFilterSnoopReqFree(virNWFilterSnoopReqPtr req)\n{\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    if (!req)\n        return;\n\n    if (g_atomic_int_get(&req->refctr) != 0)\n        return;\n\n    /* free all leases */\n    for (ipl = req->start; ipl; ipl = req->start)\n        virNWFilterSnoopReqLeaseDel(req, &ipl->ipAddress, false, false);\n\n    /* free all req data */\n    virNWFilterBindingDefFree(req->binding);\n\n    virMutexDestroy(&req->lock);\n    virCondDestroy(&req->threadStatusCond);\n    virFreeError(req->threadError);\n\n    VIR_FREE(req);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "req"
          ],
          "line": 617
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFreeError",
          "args": [
            "req->threadError"
          ],
          "line": 615
        },
        "resolved": true,
        "details": {
          "function_name": "virFreeError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "484-489",
          "snippet": "void\nvirFreeError(virErrorPtr err)\n{\n    virResetError(err);\n    VIR_FREE(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirFreeError(virErrorPtr err)\n{\n    virResetError(err);\n    VIR_FREE(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCondDestroy",
          "args": [
            "&req->threadStatusCond"
          ],
          "line": 614
        },
        "resolved": true,
        "details": {
          "function_name": "virCondDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "135-143",
          "snippet": "int virCondDestroy(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_destroy(&c->cond)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondDestroy(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_destroy(&c->cond)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexDestroy",
          "args": [
            "&req->lock"
          ],
          "line": 613
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "76-79",
          "snippet": "void virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterBindingDefFree",
          "args": [
            "req->binding"
          ],
          "line": 611
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterBindingDefFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnwfilterbindingdef.c",
          "lines": "33-46",
          "snippet": "void\nvirNWFilterBindingDefFree(virNWFilterBindingDefPtr def)\n{\n    if (!def)\n        return;\n\n    VIR_FREE(def->ownername);\n    VIR_FREE(def->portdevname);\n    VIR_FREE(def->linkdevname);\n    VIR_FREE(def->filter);\n    virHashFree(def->filterparams);\n\n    VIR_FREE(def);\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virnwfilterbindingdef.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virnwfilterbindingdef.h\"\n#include \"nwfilter_params.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nvoid\nvirNWFilterBindingDefFree(virNWFilterBindingDefPtr def)\n{\n    if (!def)\n        return;\n\n    VIR_FREE(def->ownername);\n    VIR_FREE(def->portdevname);\n    VIR_FREE(def->linkdevname);\n    VIR_FREE(def->filter);\n    virHashFree(def->filterparams);\n\n    VIR_FREE(def);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLeaseDel",
          "args": [
            "req",
            "&ipl->ipAddress",
            "false",
            "false"
          ],
          "line": 608
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLeaseDel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "813-878",
          "snippet": "static int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&req->refctr"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqFree(virNWFilterSnoopReqPtr req)\n{\n    virNWFilterSnoopIPLeasePtr ipl;\n\n    if (!req)\n        return;\n\n    if (g_atomic_int_get(&req->refctr) != 0)\n        return;\n\n    /* free all leases */\n    for (ipl = req->start; ipl; ipl = req->start)\n        virNWFilterSnoopReqLeaseDel(req, &ipl->ipAddress, false, false);\n\n    /* free all req data */\n    virNWFilterBindingDefFree(req->binding);\n\n    virMutexDestroy(&req->lock);\n    virCondDestroy(&req->threadStatusCond);\n    virFreeError(req->threadError);\n\n    VIR_FREE(req);\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "551-588",
    "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqNew(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    if (ifkey == NULL || strlen(ifkey) != VIR_IFKEY_LEN - 1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterSnoopReqNew called with invalid \"\n                         \"key \\\"%s\\\" (%zu)\"),\n                       NULLSTR_EMPTY(ifkey),\n                       ifkey ? strlen(ifkey) : 0);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(req) < 0)\n        return NULL;\n\n    req->threadStatus = THREAD_STATUS_NONE;\n\n    if (virStrcpyStatic(req->ifkey, ifkey) < 0||\n        virMutexInitRecursive(&req->lock) < 0)\n        goto err_free_req;\n\n    if (virCondInit(&req->threadStatusCond) < 0)\n        goto err_destroy_mutex;\n\n    virNWFilterSnoopReqGet(req);\n\n    return req;\n\n err_destroy_mutex:\n    virMutexDestroy(&req->lock);\n\n err_free_req:\n    VIR_FREE(req);\n\n    return NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "req"
          ],
          "line": 585
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexDestroy",
          "args": [
            "&req->lock"
          ],
          "line": 582
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "76-79",
          "snippet": "void virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqGet",
          "args": [
            "req"
          ],
          "line": 577
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqGetByIFKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "666-680",
          "snippet": "static virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqGetByIFKey(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    virNWFilterSnoopLock();\n\n    req = virHashLookup(virNWFilterSnoopState.snoopReqs, ifkey);\n    if (req)\n        virNWFilterSnoopReqGet(req);\n\n    virNWFilterSnoopUnlock();\n\n    return req;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCondInit",
          "args": [
            "&req->threadStatusCond"
          ],
          "line": 574
        },
        "resolved": true,
        "details": {
          "function_name": "virCondInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "125-133",
          "snippet": "int virCondInit(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_init(&c->cond, NULL)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondInit(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_init(&c->cond, NULL)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexInitRecursive",
          "args": [
            "&req->lock"
          ],
          "line": 571
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrcpyStatic",
          "args": [
            "req->ifkey",
            "ifkey"
          ],
          "line": 570
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "req"
          ],
          "line": 565
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"virNWFilterSnoopReqNew called with invalid \"\n                         \"key \\\"%s\\\" (%zu)\")",
            "NULLSTR_EMPTY(ifkey)",
            "ifkey ? strlen(ifkey) : 0"
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "ifkey"
          ],
          "line": 561
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR_EMPTY",
          "args": [
            "ifkey"
          ],
          "line": 560
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"virNWFilterSnoopReqNew called with invalid \"\n                         \"key \\\"%s\\\" (%zu)\""
          ],
          "line": 558
        },
        "resolved": true,
        "details": {
          "function_name": "_virNWFilterTeardownFilter",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "898-927",
          "snippet": "static int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int _virNWFilterTeardownFilter(const char *ifname);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int _virNWFilterTeardownFilter(const char *ifname);\n\nstatic int\n_virNWFilterTeardownFilter(const char *ifname)\n{\n    const char *drvname = EBIPTABLES_DRIVER_ID;\n    virNWFilterTechDriverPtr techdriver;\n    techdriver = virNWFilterTechDriverForName(drvname);\n\n    if (!techdriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not get access to ACL tech \"\n                         \"driver '%s'\"),\n                       drvname);\n        return -1;\n    }\n\n    virNWFilterDHCPSnoopEnd(ifname);\n\n    virNWFilterTerminateLearnReq(ifname);\n\n    if (virNWFilterLockIface(ifname) < 0)\n        return -1;\n\n    techdriver->allTeardown(ifname);\n\n    virNWFilterIPAddrMapDelIPAddr(ifname, NULL);\n\n    virNWFilterUnlockIface(ifname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "ifkey"
          ],
          "line": 556
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopReqPtr\nvirNWFilterSnoopReqNew(const char *ifkey)\n{\n    virNWFilterSnoopReqPtr req;\n\n    if (ifkey == NULL || strlen(ifkey) != VIR_IFKEY_LEN - 1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"virNWFilterSnoopReqNew called with invalid \"\n                         \"key \\\"%s\\\" (%zu)\"),\n                       NULLSTR_EMPTY(ifkey),\n                       ifkey ? strlen(ifkey) : 0);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(req) < 0)\n        return NULL;\n\n    req->threadStatus = THREAD_STATUS_NONE;\n\n    if (virStrcpyStatic(req->ifkey, ifkey) < 0||\n        virMutexInitRecursive(&req->lock) < 0)\n        goto err_free_req;\n\n    if (virCondInit(&req->threadStatusCond) < 0)\n        goto err_destroy_mutex;\n\n    virNWFilterSnoopReqGet(req);\n\n    return req;\n\n err_destroy_mutex:\n    virMutexDestroy(&req->lock);\n\n err_free_req:\n    VIR_FREE(req);\n\n    return NULL;\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqGet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "540-544",
    "snippet": "static void\nvirNWFilterSnoopReqGet(virNWFilterSnoopReqPtr req)\n{\n    g_atomic_int_add(&req->refctr, 1);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_atomic_int_add",
          "args": [
            "&req->refctr",
            "1"
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqGet(virNWFilterSnoopReqPtr req)\n{\n    g_atomic_int_add(&req->refctr, 1);\n}"
  },
  {
    "function_name": "virNWFilterSnoopReqLeaseTimerRun",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "515-535",
    "snippet": "static unsigned int\nvirNWFilterSnoopReqLeaseTimerRun(virNWFilterSnoopReqPtr req)\n{\n    time_t now = time(0);\n    bool is_last = false;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    while (req->start && req->start->timeout <= now) {\n        if (req->start->next == NULL ||\n            req->start->next->timeout > now)\n            is_last = true;\n        virNWFilterSnoopReqLeaseDel(req, &req->start->ipAddress, true,\n                                    is_last);\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 532
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLeaseDel",
          "args": [
            "req",
            "&req->start->ipAddress",
            "true",
            "is_last"
          ],
          "line": 528
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLeaseDel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "813-878",
          "snippet": "static int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopReqLeaseDel(virNWFilterSnoopReqPtr req,\n                            virSocketAddrPtr ipaddr, bool update_leasefile,\n                            bool instantiate)\n{\n    int ret = 0;\n    virNWFilterSnoopIPLeasePtr ipl;\n    char *ipstr = NULL;\n\n    /* protect req->start, req->ifname and the lease */\n    virNWFilterSnoopReqLock(req);\n\n    ipl = virNWFilterSnoopIPLeaseGetByIP(req->start, ipaddr);\n    if (ipl == NULL)\n        goto lease_not_found;\n\n    ipstr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipstr) {\n        ret = -1;\n        goto lease_not_found;\n    }\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    /* lease is off the list now */\n\n    if (update_leasefile)\n        virNWFilterSnoopLeaseFileSave(ipl);\n\n    if (!req->threadkey || !instantiate)\n        goto skip_instantiate;\n\n    /* Assumes that req->binding is valid since req->threadkey\n     * is only generated after req->binding is filled in during\n     * virNWFilterDHCPSnoopReq processing */\n    if ((virNWFilterIPAddrMapDelIPAddr(req->binding->portdevname, ipstr)) > 0) {\n        ret = virNWFilterInstantiateFilterLate(req->driver,\n                                               req->binding,\n                                               req->ifindex);\n    } else {\n        virNWFilterVarValuePtr dhcpsrvrs =\n            virHashLookup(req->binding->filterparams,\n                          NWFILTER_VARNAME_DHCPSERVER);\n\n        if (req->techdriver &&\n            req->techdriver->applyDHCPOnlyRules(req->binding->portdevname,\n                                                &req->binding->mac,\n                                                dhcpsrvrs, false) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"virNWFilterSnoopListDel failed\"));\n            ret = -1;\n        }\n\n    }\n\n skip_instantiate:\n    VIR_FREE(ipl);\n\n    ignore_value(!!g_atomic_int_dec_and_test(&virNWFilterSnoopState.nLeases));\n\n lease_not_found:\n    VIR_FREE(ipstr);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 522
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "0"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic unsigned int\nvirNWFilterSnoopReqLeaseTimerRun(virNWFilterSnoopReqPtr req)\n{\n    time_t now = time(0);\n    bool is_last = false;\n\n    /* protect req->start */\n    virNWFilterSnoopReqLock(req);\n\n    while (req->start && req->start->timeout <= now) {\n        if (req->start->next == NULL ||\n            req->start->next->timeout > now)\n            is_last = true;\n        virNWFilterSnoopReqLeaseDel(req, &req->start->ipAddress, true,\n                                    is_last);\n    }\n\n    virNWFilterSnoopReqUnlock(req);\n\n    return 0;\n}"
  },
  {
    "function_name": "virNWFilterSnoopIPLeaseGetByIP",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "499-510",
    "snippet": "static virNWFilterSnoopIPLeasePtr\nvirNWFilterSnoopIPLeaseGetByIP(virNWFilterSnoopIPLeasePtr start,\n                               virSocketAddrPtr ipaddr)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    for (pl = start;\n         pl && !virSocketAddrEqual(&pl->ipAddress, ipaddr);\n         pl = pl->next)\n        ; /* empty */\n    return pl;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSocketAddrEqual",
          "args": [
            "&pl->ipAddress",
            "ipaddr"
          ],
          "line": 506
        },
        "resolved": true,
        "details": {
          "function_name": "virSocketAddrEqual",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocketaddr.c",
          "lines": "359-378",
          "snippet": "bool\nvirSocketAddrEqual(const virSocketAddr *s1, const virSocketAddr *s2)\n{\n    if (s1->data.stor.ss_family != s2->data.stor.ss_family)\n        return false;\n\n    switch (s1->data.stor.ss_family) {\n    case AF_INET:\n        return (memcmp(&s1->data.inet4.sin_addr.s_addr,\n                       &s2->data.inet4.sin_addr.s_addr,\n                       sizeof(s1->data.inet4.sin_addr.s_addr)) == 0 &&\n                s1->data.inet4.sin_port == s2->data.inet4.sin_port);\n    case AF_INET6:\n        return (memcmp(&s1->data.inet6.sin6_addr.s6_addr,\n                       &s2->data.inet6.sin6_addr.s6_addr,\n                       sizeof(s1->data.inet6.sin6_addr.s6_addr)) == 0 &&\n                s1->data.inet6.sin6_port == s2->data.inet6.sin6_port);\n    }\n    return false;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virsocketaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virsocketaddr.h\"\n#include <config.h>\n\nbool\nvirSocketAddrEqual(const virSocketAddr *s1, const virSocketAddr *s2)\n{\n    if (s1->data.stor.ss_family != s2->data.stor.ss_family)\n        return false;\n\n    switch (s1->data.stor.ss_family) {\n    case AF_INET:\n        return (memcmp(&s1->data.inet4.sin_addr.s_addr,\n                       &s2->data.inet4.sin_addr.s_addr,\n                       sizeof(s1->data.inet4.sin_addr.s_addr)) == 0 &&\n                s1->data.inet4.sin_port == s2->data.inet4.sin_port);\n    case AF_INET6:\n        return (memcmp(&s1->data.inet6.sin6_addr.s6_addr,\n                       &s2->data.inet6.sin6_addr.s6_addr,\n                       sizeof(s1->data.inet6.sin6_addr.s6_addr)) == 0 &&\n                s1->data.inet6.sin6_port == s2->data.inet6.sin6_port);\n    }\n    return false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic virNWFilterSnoopIPLeasePtr\nvirNWFilterSnoopIPLeaseGetByIP(virNWFilterSnoopIPLeasePtr start,\n                               virSocketAddrPtr ipaddr)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    for (pl = start;\n         pl && !virSocketAddrEqual(&pl->ipAddress, ipaddr);\n         pl = pl->next)\n        ; /* empty */\n    return pl;\n}"
  },
  {
    "function_name": "virNWFilterSnoopIPLeaseUpdate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "485-494",
    "snippet": "static void\nvirNWFilterSnoopIPLeaseUpdate(virNWFilterSnoopIPLeasePtr ipl, time_t timeout)\n{\n    if (timeout < ipl->timeout)\n        return;  /* no take-backs */\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    ipl->timeout = timeout;\n    virNWFilterSnoopIPLeaseTimerAdd(ipl);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseTimerAdd",
          "args": [
            "ipl"
          ],
          "line": 493
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseTimerAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "401-412",
          "snippet": "static void\nvirNWFilterSnoopIPLeaseTimerAdd(virNWFilterSnoopIPLeasePtr plnew)\n{\n    virNWFilterSnoopReqPtr req = plnew->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListAdd(plnew, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIPLeaseTimerAdd(virNWFilterSnoopIPLeasePtr plnew)\n{\n    virNWFilterSnoopReqPtr req = plnew->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListAdd(plnew, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopIPLeaseTimerDel",
          "args": [
            "ipl"
          ],
          "line": 491
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopIPLeaseTimerDel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "417-430",
          "snippet": "static void\nvirNWFilterSnoopIPLeaseTimerDel(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListDel(ipl, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    ipl->timeout = 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIPLeaseTimerDel(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListDel(ipl, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    ipl->timeout = 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIPLeaseUpdate(virNWFilterSnoopIPLeasePtr ipl, time_t timeout)\n{\n    if (timeout < ipl->timeout)\n        return;  /* no take-backs */\n\n    virNWFilterSnoopIPLeaseTimerDel(ipl);\n    ipl->timeout = timeout;\n    virNWFilterSnoopIPLeaseTimerAdd(ipl);\n}"
  },
  {
    "function_name": "virNWFilterSnoopIPLeaseInstallRule",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "441-480",
    "snippet": "static int\nvirNWFilterSnoopIPLeaseInstallRule(virNWFilterSnoopIPLeasePtr ipl,\n                                   bool instantiate)\n{\n    char *ipaddr;\n    int rc = -1;\n    virNWFilterSnoopReqPtr req;\n\n    ipaddr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipaddr)\n        return -1;\n\n    req = ipl->snoopReq;\n\n    /* protect req->binding->portdevname */\n    virNWFilterSnoopReqLock(req);\n\n    if (virNWFilterIPAddrMapAddIPAddr(req->binding->portdevname, ipaddr) < 0)\n        goto exit_snooprequnlock;\n\n    if (!instantiate) {\n        rc = 0;\n        goto exit_snooprequnlock;\n    }\n\n    /* instantiate the filters */\n\n    if (req->binding->portdevname) {\n        rc = virNWFilterInstantiateFilterLate(req->driver,\n                                              req->binding,\n                                              req->ifindex);\n    }\n\n exit_snooprequnlock:\n    virNWFilterSnoopReqUnlock(req);\n\n    VIR_FREE(ipaddr);\n\n    return rc;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ipaddr"
          ],
          "line": 477
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 475
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterInstantiateFilterLate",
          "args": [
            "req->driver",
            "req->binding",
            "req->ifindex"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterInstantiateFilterLate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_gentech_driver.c",
          "lines": "785-814",
          "snippet": "int\nvirNWFilterInstantiateFilterLate(virNWFilterDriverStatePtr driver,\n                                 virNWFilterBindingDefPtr binding,\n                                 int ifindex)\n{\n    int rc;\n    bool foundNewFilter = false;\n\n    virNWFilterReadLockFilterUpdates();\n    virMutexLock(&updateMutex);\n\n    rc = virNWFilterInstantiateFilterUpdate(driver, true,\n                                            binding, ifindex,\n                                            INSTANTIATE_ALWAYS, true,\n                                            &foundNewFilter);\n    if (rc < 0) {\n        /* something went wrong... 'DOWN' the interface */\n        if ((virNetDevValidateConfig(binding->portdevname, NULL, ifindex) <= 0) ||\n            (virNetDevSetOnline(binding->portdevname, false) < 0)) {\n            virResetLastError();\n            /* assuming interface disappeared... */\n            _virNWFilterTeardownFilter(binding->portdevname);\n        }\n    }\n\n    virNWFilterUnlockFilterUpdates();\n    virMutexUnlock(&updateMutex);\n\n    return rc;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"datatypes.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_learnipaddr.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_ebiptables_driver.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"virerror.h\"",
            "#include \"domain_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex updateMutex;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virsocketaddr.h\"\n#include \"datatypes.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_learnipaddr.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_ebiptables_driver.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"virerror.h\"\n#include \"domain_conf.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virMutex updateMutex;\n\nint\nvirNWFilterInstantiateFilterLate(virNWFilterDriverStatePtr driver,\n                                 virNWFilterBindingDefPtr binding,\n                                 int ifindex)\n{\n    int rc;\n    bool foundNewFilter = false;\n\n    virNWFilterReadLockFilterUpdates();\n    virMutexLock(&updateMutex);\n\n    rc = virNWFilterInstantiateFilterUpdate(driver, true,\n                                            binding, ifindex,\n                                            INSTANTIATE_ALWAYS, true,\n                                            &foundNewFilter);\n    if (rc < 0) {\n        /* something went wrong... 'DOWN' the interface */\n        if ((virNetDevValidateConfig(binding->portdevname, NULL, ifindex) <= 0) ||\n            (virNetDevSetOnline(binding->portdevname, false) < 0)) {\n            virResetLastError();\n            /* assuming interface disappeared... */\n            _virNWFilterTeardownFilter(binding->portdevname);\n        }\n    }\n\n    virNWFilterUnlockFilterUpdates();\n    virMutexUnlock(&updateMutex);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterIPAddrMapAddIPAddr",
          "args": [
            "req->binding->portdevname",
            "ipaddr"
          ],
          "line": 458
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterIPAddrMapAddIPAddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/nwfilter_ipaddrmap.c",
          "lines": "49-83",
          "snippet": "int\nvirNWFilterIPAddrMapAddIPAddr(const char *ifname, char *addr)\n{\n    int ret = -1;\n    char *addrCopy;\n    virNWFilterVarValuePtr val;\n\n    addrCopy = g_strdup(addr);\n\n    virMutexLock(&ipAddressMapLock);\n\n    val = virHashLookup(ipAddressMap, ifname);\n    if (!val) {\n        val = virNWFilterVarValueCreateSimple(addrCopy);\n        if (!val)\n            goto cleanup;\n        addrCopy = NULL;\n        ret = virHashUpdateEntry(ipAddressMap, ifname, val);\n        if (ret < 0)\n            virNWFilterVarValueFree(val);\n        goto cleanup;\n    } else {\n        if (virNWFilterVarValueAddValue(val, addrCopy) < 0)\n            goto cleanup;\n        addrCopy = NULL;\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&ipAddressMapLock);\n    VIR_FREE(addrCopy);\n\n    return ret;\n}",
          "includes": [
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"datatypes.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;",
            "static virHashTablePtr ipAddressMap;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_params.h\"\n#include \"datatypes.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic virMutex ipAddressMapLock = VIR_MUTEX_INITIALIZER;\nstatic virHashTablePtr ipAddressMap;\n\nint\nvirNWFilterIPAddrMapAddIPAddr(const char *ifname, char *addr)\n{\n    int ret = -1;\n    char *addrCopy;\n    virNWFilterVarValuePtr val;\n\n    addrCopy = g_strdup(addr);\n\n    virMutexLock(&ipAddressMapLock);\n\n    val = virHashLookup(ipAddressMap, ifname);\n    if (!val) {\n        val = virNWFilterVarValueCreateSimple(addrCopy);\n        if (!val)\n            goto cleanup;\n        addrCopy = NULL;\n        ret = virHashUpdateEntry(ipAddressMap, ifname, val);\n        if (ret < 0)\n            virNWFilterVarValueFree(val);\n        goto cleanup;\n    } else {\n        if (virNWFilterVarValueAddValue(val, addrCopy) < 0)\n            goto cleanup;\n        addrCopy = NULL;\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&ipAddressMapLock);\n    VIR_FREE(addrCopy);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 456
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSocketAddrFormat",
          "args": [
            "&ipl->ipAddress"
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "virSocketAddrFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocketaddr.c",
          "lines": "441-445",
          "snippet": "char *\nvirSocketAddrFormat(const virSocketAddr *addr)\n{\n    return virSocketAddrFormatFull(addr, false, NULL);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virsocketaddr.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virsocketaddr.h\"\n#include <config.h>\n\nchar *\nvirSocketAddrFormat(const virSocketAddr *addr)\n{\n    return virSocketAddrFormatFull(addr, false, NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic int\nvirNWFilterSnoopIPLeaseInstallRule(virNWFilterSnoopIPLeasePtr ipl,\n                                   bool instantiate)\n{\n    char *ipaddr;\n    int rc = -1;\n    virNWFilterSnoopReqPtr req;\n\n    ipaddr = virSocketAddrFormat(&ipl->ipAddress);\n    if (!ipaddr)\n        return -1;\n\n    req = ipl->snoopReq;\n\n    /* protect req->binding->portdevname */\n    virNWFilterSnoopReqLock(req);\n\n    if (virNWFilterIPAddrMapAddIPAddr(req->binding->portdevname, ipaddr) < 0)\n        goto exit_snooprequnlock;\n\n    if (!instantiate) {\n        rc = 0;\n        goto exit_snooprequnlock;\n    }\n\n    /* instantiate the filters */\n\n    if (req->binding->portdevname) {\n        rc = virNWFilterInstantiateFilterLate(req->driver,\n                                              req->binding,\n                                              req->ifindex);\n    }\n\n exit_snooprequnlock:\n    virNWFilterSnoopReqUnlock(req);\n\n    VIR_FREE(ipaddr);\n\n    return rc;\n}"
  },
  {
    "function_name": "virNWFilterSnoopIPLeaseTimerDel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "417-430",
    "snippet": "static void\nvirNWFilterSnoopIPLeaseTimerDel(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListDel(ipl, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    ipl->timeout = 0;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopListDel",
          "args": [
            "ipl",
            "&req->start",
            "&req->end"
          ],
          "line": 425
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopListDel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "380-396",
          "snippet": "static void\nvirNWFilterSnoopListDel(virNWFilterSnoopIPLeasePtr ipl,\n                        virNWFilterSnoopIPLeasePtr *start,\n                        virNWFilterSnoopIPLeasePtr *end)\n{\n    if (ipl->prev)\n        ipl->prev->next = ipl->next;\n    else\n        *start = ipl->next;\n\n    if (ipl->next)\n        ipl->next->prev = ipl->prev;\n    else\n        *end = ipl->prev;\n\n    ipl->next = ipl->prev = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopListDel(virNWFilterSnoopIPLeasePtr ipl,\n                        virNWFilterSnoopIPLeasePtr *start,\n                        virNWFilterSnoopIPLeasePtr *end)\n{\n    if (ipl->prev)\n        ipl->prev->next = ipl->next;\n    else\n        *start = ipl->next;\n\n    if (ipl->next)\n        ipl->next->prev = ipl->prev;\n    else\n        *end = ipl->prev;\n\n    ipl->next = ipl->prev = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIPLeaseTimerDel(virNWFilterSnoopIPLeasePtr ipl)\n{\n    virNWFilterSnoopReqPtr req = ipl->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListDel(ipl, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n\n    ipl->timeout = 0;\n}"
  },
  {
    "function_name": "virNWFilterSnoopIPLeaseTimerAdd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "401-412",
    "snippet": "static void\nvirNWFilterSnoopIPLeaseTimerAdd(virNWFilterSnoopIPLeasePtr plnew)\n{\n    virNWFilterSnoopReqPtr req = plnew->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListAdd(plnew, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqUnlock",
          "args": [
            "req"
          ],
          "line": 411
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "632-636",
          "snippet": "static void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqUnlock(virNWFilterSnoopReqPtr req)\n{\n    virMutexUnlock(&req->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopListAdd",
          "args": [
            "plnew",
            "&req->start",
            "&req->end"
          ],
          "line": 409
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopListAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "343-375",
          "snippet": "static void\nvirNWFilterSnoopListAdd(virNWFilterSnoopIPLeasePtr plnew,\n                        virNWFilterSnoopIPLeasePtr *start,\n                        virNWFilterSnoopIPLeasePtr *end)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->next = plnew->prev = NULL;\n\n    if (!*start) {\n        *start = *end = plnew;\n        return;\n    }\n\n    for (pl = *end; pl && plnew->timeout < pl->timeout;\n         pl = pl->prev)\n        ; /* empty */\n\n    if (!pl) {\n        plnew->next = *start;\n        *start = plnew;\n    } else {\n        plnew->next = pl->next;\n        pl->next = plnew;\n    }\n\n    plnew->prev = pl;\n\n    if (plnew->next)\n        plnew->next->prev = plnew;\n    else\n        *end = plnew;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopListAdd(virNWFilterSnoopIPLeasePtr plnew,\n                        virNWFilterSnoopIPLeasePtr *start,\n                        virNWFilterSnoopIPLeasePtr *end)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->next = plnew->prev = NULL;\n\n    if (!*start) {\n        *start = *end = plnew;\n        return;\n    }\n\n    for (pl = *end; pl && plnew->timeout < pl->timeout;\n         pl = pl->prev)\n        ; /* empty */\n\n    if (!pl) {\n        plnew->next = *start;\n        *start = plnew;\n    } else {\n        plnew->next = pl->next;\n        pl->next = plnew;\n    }\n\n    plnew->prev = pl;\n\n    if (plnew->next)\n        plnew->next->prev = plnew;\n    else\n        *end = plnew;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopReqLock",
          "args": [
            "req"
          ],
          "line": 407
        },
        "resolved": true,
        "details": {
          "function_name": "virNWFilterSnoopReqLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
          "lines": "623-627",
          "snippet": "static void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"configmake.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetdev.h\"",
            "#include \"nwfilter_ipaddrmap.h\"",
            "#include \"nwfilter_dhcpsnoop.h\"",
            "#include \"nwfilter_gentech_driver.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <net/if.h>",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "# include <pcap.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopReqLock(virNWFilterSnoopReqPtr req)\n{\n    virMutexLock(&req->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopIPLeaseTimerAdd(virNWFilterSnoopIPLeasePtr plnew)\n{\n    virNWFilterSnoopReqPtr req = plnew->snoopReq;\n\n    /* protect req->start / req->end */\n    virNWFilterSnoopReqLock(req);\n\n    virNWFilterSnoopListAdd(plnew, &req->start, &req->end);\n\n    virNWFilterSnoopReqUnlock(req);\n}"
  },
  {
    "function_name": "virNWFilterSnoopListDel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "380-396",
    "snippet": "static void\nvirNWFilterSnoopListDel(virNWFilterSnoopIPLeasePtr ipl,\n                        virNWFilterSnoopIPLeasePtr *start,\n                        virNWFilterSnoopIPLeasePtr *end)\n{\n    if (ipl->prev)\n        ipl->prev->next = ipl->next;\n    else\n        *start = ipl->next;\n\n    if (ipl->next)\n        ipl->next->prev = ipl->prev;\n    else\n        *end = ipl->prev;\n\n    ipl->next = ipl->prev = NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopListDel(virNWFilterSnoopIPLeasePtr ipl,\n                        virNWFilterSnoopIPLeasePtr *start,\n                        virNWFilterSnoopIPLeasePtr *end)\n{\n    if (ipl->prev)\n        ipl->prev->next = ipl->next;\n    else\n        *start = ipl->next;\n\n    if (ipl->next)\n        ipl->next->prev = ipl->prev;\n    else\n        *end = ipl->prev;\n\n    ipl->next = ipl->prev = NULL;\n}"
  },
  {
    "function_name": "virNWFilterSnoopListAdd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "343-375",
    "snippet": "static void\nvirNWFilterSnoopListAdd(virNWFilterSnoopIPLeasePtr plnew,\n                        virNWFilterSnoopIPLeasePtr *start,\n                        virNWFilterSnoopIPLeasePtr *end)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->next = plnew->prev = NULL;\n\n    if (!*start) {\n        *start = *end = plnew;\n        return;\n    }\n\n    for (pl = *end; pl && plnew->timeout < pl->timeout;\n         pl = pl->prev)\n        ; /* empty */\n\n    if (!pl) {\n        plnew->next = *start;\n        *start = plnew;\n    } else {\n        plnew->next = pl->next;\n        pl->next = plnew;\n    }\n\n    plnew->prev = pl;\n\n    if (plnew->next)\n        plnew->next->prev = plnew;\n    else\n        *end = plnew;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopListAdd(virNWFilterSnoopIPLeasePtr plnew,\n                        virNWFilterSnoopIPLeasePtr *start,\n                        virNWFilterSnoopIPLeasePtr *end)\n{\n    virNWFilterSnoopIPLeasePtr pl;\n\n    plnew->next = plnew->prev = NULL;\n\n    if (!*start) {\n        *start = *end = plnew;\n        return;\n    }\n\n    for (pl = *end; pl && plnew->timeout < pl->timeout;\n         pl = pl->prev)\n        ; /* empty */\n\n    if (!pl) {\n        plnew->next = *start;\n        *start = plnew;\n    } else {\n        plnew->next = pl->next;\n        pl->next = plnew;\n    }\n\n    plnew->prev = pl;\n\n    if (plnew->next)\n        plnew->next->prev = plnew;\n    else\n        *end = plnew;\n}"
  },
  {
    "function_name": "virNWFilterSnoopIsActive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "323-338",
    "snippet": "static bool\nvirNWFilterSnoopIsActive(char *threadKey)\n{\n    void *entry;\n\n    if (threadKey == NULL)\n        return 0;\n\n    virNWFilterSnoopActiveLock();\n\n    entry = virHashLookup(virNWFilterSnoopState.active, threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n\n    return entry != NULL;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopActiveUnlock",
          "args": [],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "virNWFilterSnoopState.active",
            "threadKey"
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopActiveLock",
          "args": [],
          "line": 331
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic bool\nvirNWFilterSnoopIsActive(char *threadKey)\n{\n    void *entry;\n\n    if (threadKey == NULL)\n        return 0;\n\n    virNWFilterSnoopActiveLock();\n\n    entry = virHashLookup(virNWFilterSnoopState.active, threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n\n    return entry != NULL;\n}"
  },
  {
    "function_name": "virNWFilterSnoopCancel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "309-321",
    "snippet": "static void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopActiveUnlock",
          "args": [],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*threadKey"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey)"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "virNWFilterSnoopState.active",
            "*threadKey"
          ],
          "line": 317
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopActiveLock",
          "args": [],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic void\nvirNWFilterSnoopCancel(char **threadKey)\n{\n    if (*threadKey == NULL)\n        return;\n\n    virNWFilterSnoopActiveLock();\n\n    ignore_value(virHashRemoveEntry(virNWFilterSnoopState.active, *threadKey));\n    VIR_FREE(*threadKey);\n\n    virNWFilterSnoopActiveUnlock();\n}"
  },
  {
    "function_name": "virNWFilterSnoopActivate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/nwfilter/nwfilter_dhcpsnoop.c",
    "lines": "292-307",
    "snippet": "static char *\nvirNWFilterSnoopActivate(virNWFilterSnoopReqPtr req)\n{\n    char *key;\n\n    key = g_strdup_printf(\"%p-%d\", req, req->ifindex);\n\n    virNWFilterSnoopActiveLock();\n\n    if (virHashAddEntry(virNWFilterSnoopState.active, key, (void *)0x1) < 0)\n        VIR_FREE(key);\n\n    virNWFilterSnoopActiveUnlock();\n\n    return key;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"virtime.h\"",
      "#include \"configmake.h\"",
      "#include \"virthreadpool.h\"",
      "#include \"virsocketaddr.h\"",
      "#include \"virfile.h\"",
      "#include \"virnetdev.h\"",
      "#include \"nwfilter_ipaddrmap.h\"",
      "#include \"nwfilter_dhcpsnoop.h\"",
      "#include \"nwfilter_gentech_driver.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"virerror.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include <net/if.h>",
      "#include <poll.h>",
      "#include <fcntl.h>",
      "# include <pcap.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNWFilterSnoopActiveUnlock",
          "args": [],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "key"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "virNWFilterSnoopState.active",
            "key",
            "(void *)0x1"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNWFilterSnoopActiveLock",
          "args": [],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%p-%d\"",
            "req",
            "req->ifindex"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"configmake.h\"\n#include \"virthreadpool.h\"\n#include \"virsocketaddr.h\"\n#include \"virfile.h\"\n#include \"virnetdev.h\"\n#include \"nwfilter_ipaddrmap.h\"\n#include \"nwfilter_dhcpsnoop.h\"\n#include \"nwfilter_gentech_driver.h\"\n#include \"conf/domain_conf.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <net/if.h>\n#include <poll.h>\n#include <fcntl.h>\n# include <pcap.h>\n#include <config.h>\n\nstatic char *\nvirNWFilterSnoopActivate(virNWFilterSnoopReqPtr req)\n{\n    char *key;\n\n    key = g_strdup_printf(\"%p-%d\", req, req->ifindex);\n\n    virNWFilterSnoopActiveLock();\n\n    if (virHashAddEntry(virNWFilterSnoopState.active, key, (void *)0x1) < 0)\n        VIR_FREE(key);\n\n    virNWFilterSnoopActiveUnlock();\n\n    return key;\n}"
  }
]