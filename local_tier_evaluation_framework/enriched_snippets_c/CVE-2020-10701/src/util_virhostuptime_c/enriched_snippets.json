[
  {
    "function_name": "virHostBootTimeInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhostuptime.c",
    "lines": "142-149",
    "snippet": "int\nvirHostBootTimeInit(void)\n{\n    if (virOnce(&virHostGetBootTimeOnce, virHostGetBootTimeOnceInit) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virthread.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virhostuptime.h\"",
      "# include <utmpx.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virOnceControl virHostGetBootTimeOnce = VIR_ONCE_CONTROL_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virOnce",
          "args": [
            "&virHostGetBootTimeOnce",
            "virHostGetBootTimeOnceInit"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "virOnce",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "40-43",
          "snippet": "int virOnce(virOnceControlPtr once, virOnceFunc init)\n{\n    return pthread_once(&once->once, init);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virOnce(virOnceControlPtr once, virOnceFunc init)\n{\n    return pthread_once(&once->once, init);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virthread.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virhostuptime.h\"\n# include <utmpx.h>\n#include <config.h>\n\nstatic virOnceControl virHostGetBootTimeOnce = VIR_ONCE_CONTROL_INITIALIZER;\n\nint\nvirHostBootTimeInit(void)\n{\n    if (virOnce(&virHostGetBootTimeOnce, virHostGetBootTimeOnceInit) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virHostGetBootTime",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhostuptime.c",
    "lines": "126-139",
    "snippet": "int\nvirHostGetBootTime(unsigned long long *when)\n{\n    if (virHostBootTimeInit() < 0)\n        return -1;\n\n    if (bootTimeErrno) {\n        errno = bootTimeErrno;\n        return -1;\n    }\n\n    *when = bootTime;\n    return 0;\n}",
    "includes": [
      "#include \"virthread.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virhostuptime.h\"",
      "# include <utmpx.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static unsigned long long bootTime;",
      "static int bootTimeErrno;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virHostBootTimeInit",
          "args": [],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "virHostBootTimeInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhostuptime.c",
          "lines": "142-149",
          "snippet": "int\nvirHostBootTimeInit(void)\n{\n    if (virOnce(&virHostGetBootTimeOnce, virHostGetBootTimeOnceInit) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhostuptime.h\"",
            "# include <utmpx.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virOnceControl virHostGetBootTimeOnce = VIR_ONCE_CONTROL_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virhostuptime.h\"\n# include <utmpx.h>\n#include <config.h>\n\nstatic virOnceControl virHostGetBootTimeOnce = VIR_ONCE_CONTROL_INITIALIZER;\n\nint\nvirHostBootTimeInit(void)\n{\n    if (virOnce(&virHostGetBootTimeOnce, virHostGetBootTimeOnceInit) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virthread.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virhostuptime.h\"\n# include <utmpx.h>\n#include <config.h>\n\nstatic unsigned long long bootTime;\nstatic int bootTimeErrno;\n\nint\nvirHostGetBootTime(unsigned long long *when)\n{\n    if (virHostBootTimeInit() < 0)\n        return -1;\n\n    if (bootTimeErrno) {\n        errno = bootTimeErrno;\n        return -1;\n    }\n\n    *when = bootTime;\n    return 0;\n}"
  },
  {
    "function_name": "virHostGetBootTimeOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhostuptime.c",
    "lines": "110-114",
    "snippet": "static void\nvirHostGetBootTimeOnceInit(void)\n{\n    bootTimeErrno = ENOSYS;\n}",
    "includes": [
      "#include \"virthread.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virhostuptime.h\"",
      "# include <utmpx.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int bootTimeErrno;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"virthread.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virhostuptime.h\"\n# include <utmpx.h>\n#include <config.h>\n\nstatic int bootTimeErrno;\n\nstatic void\nvirHostGetBootTimeOnceInit(void)\n{\n    bootTimeErrno = ENOSYS;\n}"
  },
  {
    "function_name": "virHostGetBootTimeOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhostuptime.c",
    "lines": "86-106",
    "snippet": "static void\nvirHostGetBootTimeOnceInit(void)\n{\n# ifdef HAVE_GETUTXID\n    struct utmpx id = {.ut_type = BOOT_TIME};\n    struct utmpx *res = NULL;\n\n    if (!(res = getutxid(&id))) {\n        bootTimeErrno = errno;\n    } else {\n        bootTime = res->ut_tv.tv_sec;\n    }\n\n    endutxent();\n# endif /* HAVE_GETUTXID */\n\n# ifdef __linux__\n    if (bootTimeErrno != 0 || bootTime == 0)\n        bootTimeErrno = -virHostGetBootTimeProcfs(&bootTime);\n# endif /* __linux__ */\n}",
    "includes": [
      "#include \"virthread.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virhostuptime.h\"",
      "# include <utmpx.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static unsigned long long bootTime;",
      "static int bootTimeErrno;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virHostGetBootTimeProcfs",
          "args": [
            "&bootTime"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "virHostGetBootTimeProcfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhostuptime.c",
          "lines": "45-82",
          "snippet": "static int\nvirHostGetBootTimeProcfs(unsigned long long *btime)\n{\n    unsigned long long now;\n    double up;\n    g_autofree char *buf = NULL;\n    char *tmp;\n\n    if (virTimeMillisNow(&now) < 0)\n        return -errno;\n\n    /* 1KiB limit is more than enough. */\n    if (virFileReadAll(UPTIME_FILE, 1024, &buf) < 0)\n        return -errno;\n\n    /* buf contains two doubles now:\n     *   $uptime $idle_time\n     * We're interested only in the first one */\n    if (!(tmp = strchr(buf, ' '))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"uptime file has unexpected format '%s'\"),\n                       buf);\n        return -EINVAL;\n    }\n\n    *tmp = '\\0';\n\n    if (virStrToDouble(buf, NULL, &up) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to parse uptime value '%s'\"),\n                       buf);\n        return -EINVAL;\n    }\n\n    *btime = now / 1000 - up + 0.5;\n\n    return 0;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhostuptime.h\"",
            "# include <utmpx.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virhostuptime.h\"\n# include <utmpx.h>\n#include <config.h>\n\nstatic int\nvirHostGetBootTimeProcfs(unsigned long long *btime)\n{\n    unsigned long long now;\n    double up;\n    g_autofree char *buf = NULL;\n    char *tmp;\n\n    if (virTimeMillisNow(&now) < 0)\n        return -errno;\n\n    /* 1KiB limit is more than enough. */\n    if (virFileReadAll(UPTIME_FILE, 1024, &buf) < 0)\n        return -errno;\n\n    /* buf contains two doubles now:\n     *   $uptime $idle_time\n     * We're interested only in the first one */\n    if (!(tmp = strchr(buf, ' '))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"uptime file has unexpected format '%s'\"),\n                       buf);\n        return -EINVAL;\n    }\n\n    *tmp = '\\0';\n\n    if (virStrToDouble(buf, NULL, &up) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to parse uptime value '%s'\"),\n                       buf);\n        return -EINVAL;\n    }\n\n    *btime = now / 1000 - up + 0.5;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "endutxent",
          "args": [],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getutxid",
          "args": [
            "&id"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virthread.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virhostuptime.h\"\n# include <utmpx.h>\n#include <config.h>\n\nstatic unsigned long long bootTime;\nstatic int bootTimeErrno;\n\nstatic void\nvirHostGetBootTimeOnceInit(void)\n{\n# ifdef HAVE_GETUTXID\n    struct utmpx id = {.ut_type = BOOT_TIME};\n    struct utmpx *res = NULL;\n\n    if (!(res = getutxid(&id))) {\n        bootTimeErrno = errno;\n    } else {\n        bootTime = res->ut_tv.tv_sec;\n    }\n\n    endutxent();\n# endif /* HAVE_GETUTXID */\n\n# ifdef __linux__\n    if (bootTimeErrno != 0 || bootTime == 0)\n        bootTimeErrno = -virHostGetBootTimeProcfs(&bootTime);\n# endif /* __linux__ */\n}"
  },
  {
    "function_name": "virHostGetBootTimeProcfs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhostuptime.c",
    "lines": "45-82",
    "snippet": "static int\nvirHostGetBootTimeProcfs(unsigned long long *btime)\n{\n    unsigned long long now;\n    double up;\n    g_autofree char *buf = NULL;\n    char *tmp;\n\n    if (virTimeMillisNow(&now) < 0)\n        return -errno;\n\n    /* 1KiB limit is more than enough. */\n    if (virFileReadAll(UPTIME_FILE, 1024, &buf) < 0)\n        return -errno;\n\n    /* buf contains two doubles now:\n     *   $uptime $idle_time\n     * We're interested only in the first one */\n    if (!(tmp = strchr(buf, ' '))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"uptime file has unexpected format '%s'\"),\n                       buf);\n        return -EINVAL;\n    }\n\n    *tmp = '\\0';\n\n    if (virStrToDouble(buf, NULL, &up) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to parse uptime value '%s'\"),\n                       buf);\n        return -EINVAL;\n    }\n\n    *btime = now / 1000 - up + 0.5;\n\n    return 0;\n}",
    "includes": [
      "#include \"virthread.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"virhostuptime.h\"",
      "# include <utmpx.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unable to parse uptime value '%s'\")",
            "buf"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to parse uptime value '%s'\""
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrToDouble",
          "args": [
            "buf",
            "NULL",
            "&up"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToDouble",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "674-697",
          "snippet": "int\nvirStrToDouble(char const *s,\n               char **end_ptr,\n               double *result)\n{\n    virLocale oldlocale;\n    double val;\n    char *p;\n    int err;\n\n    errno = 0;\n    if (virLocaleSetRaw(&oldlocale) < 0)\n        return -1;\n    val = strtod(s, &p); /* exempt from syntax-check */\n    virLocaleRevert(&oldlocale);\n\n    err = (errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToDouble(char const *s,\n               char **end_ptr,\n               double *result)\n{\n    virLocale oldlocale;\n    double val;\n    char *p;\n    int err;\n\n    errno = 0;\n    if (virLocaleSetRaw(&oldlocale) < 0)\n        return -1;\n    val = strtod(s, &p); /* exempt from syntax-check */\n    virLocaleRevert(&oldlocale);\n\n    err = (errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"uptime file has unexpected format '%s'\")",
            "buf"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "buf",
            "' '"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "UPTIME_FILE",
            "1024",
            "&buf"
          ],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTimeMillisNow",
          "args": [
            "&now"
          ],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "virTimeMillisNow",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtime.c",
          "lines": "214-222",
          "snippet": "int virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtime.h\"",
            "#include <sys/time.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtime.h\"\n#include <sys/time.h>\n#include <unistd.h>\n#include <config.h>\n\nint virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virthread.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virhostuptime.h\"\n# include <utmpx.h>\n#include <config.h>\n\nstatic int\nvirHostGetBootTimeProcfs(unsigned long long *btime)\n{\n    unsigned long long now;\n    double up;\n    g_autofree char *buf = NULL;\n    char *tmp;\n\n    if (virTimeMillisNow(&now) < 0)\n        return -errno;\n\n    /* 1KiB limit is more than enough. */\n    if (virFileReadAll(UPTIME_FILE, 1024, &buf) < 0)\n        return -errno;\n\n    /* buf contains two doubles now:\n     *   $uptime $idle_time\n     * We're interested only in the first one */\n    if (!(tmp = strchr(buf, ' '))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"uptime file has unexpected format '%s'\"),\n                       buf);\n        return -EINVAL;\n    }\n\n    *tmp = '\\0';\n\n    if (virStrToDouble(buf, NULL, &up) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to parse uptime value '%s'\"),\n                       buf);\n        return -EINVAL;\n    }\n\n    *btime = now / 1000 - up + 0.5;\n\n    return 0;\n}"
  }
]