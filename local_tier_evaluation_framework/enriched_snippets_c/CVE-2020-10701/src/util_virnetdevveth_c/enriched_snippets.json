[
  {
    "function_name": "virNetDevVethDelete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevveth.c",
    "lines": "189-209",
    "snippet": "int virNetDevVethDelete(const char *veth)\n{\n    int status;\n    g_autoptr(virCommand) cmd = virCommandNewArgList(\"ip\", \"link\",\n                                                       \"del\", veth, NULL);\n\n    if (virCommandRun(cmd, &status) < 0)\n        return -1;\n\n    if (status != 0) {\n        if (!virNetDevExists(veth)) {\n            VIR_DEBUG(\"Device %s already deleted (by kernel namespace cleanup)\", veth);\n            return 0;\n        }\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to delete veth device %s\"), veth);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virnetdev.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"vircommand.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to delete veth device %s\")",
            "veth"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to delete veth device %s\""
          ],
          "line": 204
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Device %s already deleted (by kernel namespace cleanup)\"",
            "veth"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevExists",
          "args": [
            "veth"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "218-223",
          "snippet": "int virNetDevExists(const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to check interface %s\"), ifname);\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevExists(const char *ifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Unable to check interface %s\"), ifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "&status"
          ],
          "line": 195
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "\"ip\"",
            "\"link\"",
            "\"del\"",
            "veth",
            "NULL"
          ],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include <config.h>\n\nint virNetDevVethDelete(const char *veth)\n{\n    int status;\n    g_autoptr(virCommand) cmd = virCommandNewArgList(\"ip\", \"link\",\n                                                       \"del\", veth, NULL);\n\n    if (virCommandRun(cmd, &status) < 0)\n        return -1;\n\n    if (status != 0) {\n        if (!virNetDevExists(veth)) {\n            VIR_DEBUG(\"Device %s already deleted (by kernel namespace cleanup)\", veth);\n            return 0;\n        }\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to delete veth device %s\"), veth);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virNetDevVethCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevveth.c",
    "lines": "103-176",
    "snippet": "int virNetDevVethCreate(char** veth1, char** veth2)\n{\n    int ret = -1;\n    int vethNum = 0;\n    size_t i;\n\n    /*\n     * We might race with other containers, but this is reasonably\n     * unlikely, so don't do too many retries for device creation\n     */\n    virMutexLock(&virNetDevVethCreateMutex);\n#define MAX_VETH_RETRIES 10\n\n    for (i = 0; i < MAX_VETH_RETRIES; i++) {\n        g_autofree char *veth1auto = NULL;\n        g_autofree char *veth2auto = NULL;\n        g_autoptr(virCommand) cmd = NULL;\n\n        int status;\n        if (!*veth1) {\n            int veth1num;\n            if ((veth1num = virNetDevVethGetFreeNum(vethNum)) < 0)\n                goto cleanup;\n\n            veth1auto = g_strdup_printf(\"vnet%d\", veth1num);\n            vethNum = veth1num + 1;\n        }\n        if (!*veth2) {\n            int veth2num;\n            if ((veth2num = virNetDevVethGetFreeNum(vethNum)) < 0)\n                goto cleanup;\n\n            veth2auto = g_strdup_printf(\"vnet%d\", veth2num);\n            vethNum = veth2num + 1;\n        }\n\n        cmd = virCommandNew(\"ip\");\n        virCommandAddArgList(cmd, \"link\", \"add\",\n                             *veth1 ? *veth1 : veth1auto,\n                             \"type\", \"veth\", \"peer\", \"name\",\n                             *veth2 ? *veth2 : veth2auto,\n                             NULL);\n\n        if (virCommandRun(cmd, &status) < 0)\n            goto cleanup;\n\n        if (status == 0) {\n            if (veth1auto) {\n                *veth1 = veth1auto;\n                veth1auto = NULL;\n            }\n            if (veth2auto) {\n                *veth2 = veth2auto;\n                veth2auto = NULL;\n            }\n            VIR_DEBUG(\"Create Host: %s guest: %s\", *veth1, *veth2);\n            ret = 0;\n            goto cleanup;\n        }\n\n        VIR_DEBUG(\"Failed to create veth host: %s guest: %s: %d\",\n                  *veth1 ? *veth1 : veth1auto,\n                  *veth2 ? *veth2 : veth2auto,\n                  status);\n    }\n\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Failed to allocate free veth pair after %d attempts\"),\n                   MAX_VETH_RETRIES);\n\n cleanup:\n    virMutexUnlock(&virNetDevVethCreateMutex);\n    return ret;\n}",
    "includes": [
      "#include \"virnetdev.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"vircommand.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_VETH_RETRIES 10"
    ],
    "globals_used": [
      "virMutex virNetDevVethCreateMutex = VIR_MUTEX_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&virNetDevVethCreateMutex"
          ],
          "line": 174
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to allocate free veth pair after %d attempts\")",
            "MAX_VETH_RETRIES"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to allocate free veth pair after %d attempts\""
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Failed to create veth host: %s guest: %s: %d\"",
            "*veth1 ? *veth1 : veth1auto",
            "*veth2 ? *veth2 : veth2auto",
            "status"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Create Host: %s guest: %s\"",
            "*veth1",
            "*veth2"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "&status"
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgList",
          "args": [
            "cmd",
            "\"link\"",
            "\"add\"",
            "*veth1 ? *veth1 : veth1auto",
            "\"type\"",
            "\"veth\"",
            "\"peer\"",
            "\"name\"",
            "*veth2 ? *veth2 : veth2auto",
            "NULL"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "\"ip\""
          ],
          "line": 139
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevVethGetFreeNum",
          "args": [
            "vethNum"
          ],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevVethGetFreeNum",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevveth.c",
          "lines": "59-76",
          "snippet": "static int virNetDevVethGetFreeNum(int startDev)\n{\n    int devNum;\n\n#define MAX_DEV_NUM 65536\n\n    for (devNum = startDev; devNum < MAX_DEV_NUM; devNum++) {\n        int ret = virNetDevVethExists(devNum);\n        if (ret < 0)\n            return -1;\n        if (ret == 0)\n            return devNum;\n    }\n\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No free veth devices available\"));\n    return -1;\n}",
          "includes": [
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_DEV_NUM 65536"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include <config.h>\n\n#define MAX_DEV_NUM 65536\n\nstatic int virNetDevVethGetFreeNum(int startDev)\n{\n    int devNum;\n\n#define MAX_DEV_NUM 65536\n\n    for (devNum = startDev; devNum < MAX_DEV_NUM; devNum++) {\n        int ret = virNetDevVethExists(devNum);\n        if (ret < 0)\n            return -1;\n        if (ret == 0)\n            return devNum;\n    }\n\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No free veth devices available\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&virNetDevVethCreateMutex"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include <config.h>\n\n#define MAX_VETH_RETRIES 10\n\nvirMutex virNetDevVethCreateMutex = VIR_MUTEX_INITIALIZER;\n\nint virNetDevVethCreate(char** veth1, char** veth2)\n{\n    int ret = -1;\n    int vethNum = 0;\n    size_t i;\n\n    /*\n     * We might race with other containers, but this is reasonably\n     * unlikely, so don't do too many retries for device creation\n     */\n    virMutexLock(&virNetDevVethCreateMutex);\n#define MAX_VETH_RETRIES 10\n\n    for (i = 0; i < MAX_VETH_RETRIES; i++) {\n        g_autofree char *veth1auto = NULL;\n        g_autofree char *veth2auto = NULL;\n        g_autoptr(virCommand) cmd = NULL;\n\n        int status;\n        if (!*veth1) {\n            int veth1num;\n            if ((veth1num = virNetDevVethGetFreeNum(vethNum)) < 0)\n                goto cleanup;\n\n            veth1auto = g_strdup_printf(\"vnet%d\", veth1num);\n            vethNum = veth1num + 1;\n        }\n        if (!*veth2) {\n            int veth2num;\n            if ((veth2num = virNetDevVethGetFreeNum(vethNum)) < 0)\n                goto cleanup;\n\n            veth2auto = g_strdup_printf(\"vnet%d\", veth2num);\n            vethNum = veth2num + 1;\n        }\n\n        cmd = virCommandNew(\"ip\");\n        virCommandAddArgList(cmd, \"link\", \"add\",\n                             *veth1 ? *veth1 : veth1auto,\n                             \"type\", \"veth\", \"peer\", \"name\",\n                             *veth2 ? *veth2 : veth2auto,\n                             NULL);\n\n        if (virCommandRun(cmd, &status) < 0)\n            goto cleanup;\n\n        if (status == 0) {\n            if (veth1auto) {\n                *veth1 = veth1auto;\n                veth1auto = NULL;\n            }\n            if (veth2auto) {\n                *veth2 = veth2auto;\n                veth2auto = NULL;\n            }\n            VIR_DEBUG(\"Create Host: %s guest: %s\", *veth1, *veth2);\n            ret = 0;\n            goto cleanup;\n        }\n\n        VIR_DEBUG(\"Failed to create veth host: %s guest: %s: %d\",\n                  *veth1 ? *veth1 : veth1auto,\n                  *veth2 ? *veth2 : veth2auto,\n                  status);\n    }\n\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"Failed to allocate free veth pair after %d attempts\"),\n                   MAX_VETH_RETRIES);\n\n cleanup:\n    virMutexUnlock(&virNetDevVethCreateMutex);\n    return ret;\n}"
  },
  {
    "function_name": "virNetDevVethGetFreeNum",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevveth.c",
    "lines": "59-76",
    "snippet": "static int virNetDevVethGetFreeNum(int startDev)\n{\n    int devNum;\n\n#define MAX_DEV_NUM 65536\n\n    for (devNum = startDev; devNum < MAX_DEV_NUM; devNum++) {\n        int ret = virNetDevVethExists(devNum);\n        if (ret < 0)\n            return -1;\n        if (ret == 0)\n            return devNum;\n    }\n\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No free veth devices available\"));\n    return -1;\n}",
    "includes": [
      "#include \"virnetdev.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"vircommand.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MAX_DEV_NUM 65536"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"No free veth devices available\")"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"No free veth devices available\""
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevVethExists",
          "args": [
            "devNum"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevVethExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevveth.c",
          "lines": "39-48",
          "snippet": "static int virNetDevVethExists(int devNum)\n{\n    int ret;\n    g_autofree char *path = NULL;\n\n    path = g_strdup_printf(SYSFS_NET_DIR \"vnet%d/\", devNum);\n    ret = virFileExists(path) ? 1 : 0;\n    VIR_DEBUG(\"Checked dev vnet%d usage: %d\", devNum, ret);\n    return ret;\n}",
          "includes": [
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdevveth.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include <config.h>\n\nstatic int virNetDevVethExists(int devNum)\n{\n    int ret;\n    g_autofree char *path = NULL;\n\n    path = g_strdup_printf(SYSFS_NET_DIR \"vnet%d/\", devNum);\n    ret = virFileExists(path) ? 1 : 0;\n    VIR_DEBUG(\"Checked dev vnet%d usage: %d\", devNum, ret);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include <config.h>\n\n#define MAX_DEV_NUM 65536\n\nstatic int virNetDevVethGetFreeNum(int startDev)\n{\n    int devNum;\n\n#define MAX_DEV_NUM 65536\n\n    for (devNum = startDev; devNum < MAX_DEV_NUM; devNum++) {\n        int ret = virNetDevVethExists(devNum);\n        if (ret < 0)\n            return -1;\n        if (ret == 0)\n            return devNum;\n    }\n\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No free veth devices available\"));\n    return -1;\n}"
  },
  {
    "function_name": "virNetDevVethExists",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevveth.c",
    "lines": "39-48",
    "snippet": "static int virNetDevVethExists(int devNum)\n{\n    int ret;\n    g_autofree char *path = NULL;\n\n    path = g_strdup_printf(SYSFS_NET_DIR \"vnet%d/\", devNum);\n    ret = virFileExists(path) ? 1 : 0;\n    VIR_DEBUG(\"Checked dev vnet%d usage: %d\", devNum, ret);\n    return ret;\n}",
    "includes": [
      "#include \"virnetdev.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"vircommand.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"virnetdevveth.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Checked dev vnet%d usage: %d\"",
            "devNum",
            "ret"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "path"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "SYSFS_NET_DIR \"vnet%d/\"",
            "devNum"
          ],
          "line": 44
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virnetdevveth.h\"\n#include <config.h>\n\nstatic int virNetDevVethExists(int devNum)\n{\n    int ret;\n    g_autofree char *path = NULL;\n\n    path = g_strdup_printf(SYSFS_NET_DIR \"vnet%d/\", devNum);\n    ret = virFileExists(path) ? 1 : 0;\n    VIR_DEBUG(\"Checked dev vnet%d usage: %d\", devNum, ret);\n    return ret;\n}"
  }
]