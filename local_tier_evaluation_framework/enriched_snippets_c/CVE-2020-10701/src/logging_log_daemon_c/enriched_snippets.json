[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "831-1180",
    "snippet": "int main(int argc, char **argv) {\n    virNetServerPtr logSrv = NULL;\n    virNetServerPtr adminSrv = NULL;\n    virNetServerProgramPtr logProgram = NULL;\n    virNetServerProgramPtr adminProgram = NULL;\n    char *remote_config_file = NULL;\n    int statuswrite = -1;\n    int ret = 1;\n    int verbose = 0;\n    int godaemon = 0;\n    char *run_dir = NULL;\n    char *pid_file = NULL;\n    int pid_file_fd = -1;\n    char *sock_file = NULL;\n    char *admin_sock_file = NULL;\n    int timeout = -1;        /* -t: Shutdown timeout */\n    char *state_file = NULL;\n    bool implicit_conf = false;\n    mode_t old_umask;\n    bool privileged = false;\n    virLogDaemonConfigPtr config = NULL;\n    int rv;\n\n    struct option opts[] = {\n        { \"verbose\", no_argument, &verbose, 'v'},\n        { \"daemon\", no_argument, &godaemon, 'd'},\n        { \"config\", required_argument, NULL, 'f'},\n        { \"timeout\", required_argument, NULL, 't'},\n        { \"pid-file\", required_argument, NULL, 'p'},\n        { \"version\", no_argument, NULL, 'V' },\n        { \"help\", no_argument, NULL, 'h' },\n        {0, 0, 0, 0}\n    };\n\n    privileged = geteuid() == 0;\n\n    if (virGettextInitialize() < 0 ||\n        virErrorInitialize() < 0) {\n        fprintf(stderr, _(\"%s: initialization failed\\n\"), argv[0]);\n        exit(EXIT_FAILURE);\n    }\n\n    while (1) {\n        int optidx = 0;\n        int c;\n        char *tmp;\n\n        c = getopt_long(argc, argv, \"df:p:t:vVh\", opts, &optidx);\n\n        if (c == -1)\n            break;\n\n        switch (c) {\n        case 0:\n            /* Got one of the flags */\n            break;\n        case 'v':\n            verbose = 1;\n            break;\n        case 'd':\n            godaemon = 1;\n            break;\n\n        case 't':\n            if (virStrToLong_i(optarg, &tmp, 10, &timeout) != 0\n                || timeout <= 0\n                /* Ensure that we can multiply by 1000 without overflowing.  */\n                || timeout > INT_MAX / 1000) {\n                VIR_ERROR(_(\"Invalid value for timeout\"));\n                exit(EXIT_FAILURE);\n            }\n            break;\n\n        case 'p':\n            VIR_FREE(pid_file);\n            pid_file = g_strdup(optarg);\n            break;\n\n        case 'f':\n            VIR_FREE(remote_config_file);\n            remote_config_file = g_strdup(optarg);\n            break;\n\n        case 'V':\n            virLogDaemonVersion(argv[0]);\n            exit(EXIT_SUCCESS);\n\n        case 'h':\n            virLogDaemonUsage(argv[0], privileged);\n            exit(EXIT_SUCCESS);\n\n        case '?':\n        default:\n            virLogDaemonUsage(argv[0], privileged);\n            exit(EXIT_FAILURE);\n        }\n    }\n\n    virFileActivateDirOverrideForProg(argv[0]);\n\n    if (!(config = virLogDaemonConfigNew(privileged))) {\n        VIR_ERROR(_(\"Can't create initial configuration\"));\n        exit(EXIT_FAILURE);\n    }\n\n    /* No explicit config, so try and find a default one */\n    if (remote_config_file == NULL) {\n        implicit_conf = true;\n        if (virLogDaemonConfigFilePath(privileged,\n                                       &remote_config_file) < 0) {\n            VIR_ERROR(_(\"Can't determine config path\"));\n            exit(EXIT_FAILURE);\n        }\n    }\n\n    /* Read the config file if it exists */\n    if (remote_config_file &&\n        virLogDaemonConfigLoadFile(config, remote_config_file, implicit_conf) < 0) {\n        VIR_ERROR(_(\"Can't load config file: %s: %s\"),\n                  virGetLastErrorMessage(), remote_config_file);\n        exit(EXIT_FAILURE);\n    }\n\n    virLogDaemonSetupLogging(config, privileged, verbose, godaemon);\n\n    if (!pid_file &&\n        virPidFileConstructPath(privileged,\n                                RUNSTATEDIR,\n                                \"virtlogd\",\n                                &pid_file) < 0) {\n        VIR_ERROR(_(\"Can't determine pid file path.\"));\n        exit(EXIT_FAILURE);\n    }\n    VIR_DEBUG(\"Decided on pid file path '%s'\", NULLSTR(pid_file));\n\n    if (virLogDaemonUnixSocketPaths(privileged,\n                                    &sock_file,\n                                    &admin_sock_file) < 0) {\n        VIR_ERROR(_(\"Can't determine socket paths\"));\n        exit(EXIT_FAILURE);\n    }\n    VIR_DEBUG(\"Decided on socket paths '%s' and '%s'\",\n              sock_file, admin_sock_file);\n\n    if (virLogDaemonExecRestartStatePath(privileged,\n                                         &state_file) < 0) {\n        VIR_ERROR(_(\"Can't determine restart state file path\"));\n        exit(EXIT_FAILURE);\n    }\n    VIR_DEBUG(\"Decided on restart state file path '%s'\",\n              state_file);\n\n    /* Ensure the rundir exists (on tmpfs on some systems) */\n    if (privileged) {\n        run_dir = g_strdup(RUNSTATEDIR \"/libvirt\");\n    } else {\n        run_dir = virGetUserRuntimeDirectory();\n    }\n\n    if (privileged)\n        old_umask = umask(022);\n    else\n        old_umask = umask(077);\n    VIR_DEBUG(\"Ensuring run dir '%s' exists\", run_dir);\n    if (virFileMakePath(run_dir) < 0) {\n        VIR_ERROR(_(\"unable to create rundir %s: %s\"), run_dir,\n                  g_strerror(errno));\n        ret = VIR_LOG_DAEMON_ERR_RUNDIR;\n        umask(old_umask);\n        goto cleanup;\n    }\n    umask(old_umask);\n\n    if ((rv = virLogDaemonPostExecRestart(state_file,\n                                          pid_file,\n                                          &pid_file_fd,\n                                          privileged,\n                                          config)) < 0) {\n        ret = VIR_LOG_DAEMON_ERR_INIT;\n        goto cleanup;\n    }\n\n    /* rv == 1, means we setup everything from saved state,\n     * so only (possibly) daemonize and setup stuff from\n     * scratch if rv == 0\n     */\n    if (rv == 0) {\n        g_autoptr(virSystemdActivation) act = NULL;\n        virSystemdActivationMap actmap[] = {\n            { .name = \"virtlogd.socket\", .family = AF_UNIX, .path = sock_file },\n            { .name = \"virtlogd-admin.socket\", .family = AF_UNIX, .path = admin_sock_file },\n        };\n\n        if (godaemon) {\n            if (chdir(\"/\") < 0) {\n                VIR_ERROR(_(\"cannot change to root directory: %s\"),\n                          g_strerror(errno));\n                goto cleanup;\n            }\n\n            if ((statuswrite = virLogDaemonForkIntoBackground(argv[0])) < 0) {\n                VIR_ERROR(_(\"Failed to fork as daemon: %s\"),\n                          g_strerror(errno));\n                goto cleanup;\n            }\n        }\n\n        /* If we have a pidfile set, claim it now, exiting if already taken */\n        if ((pid_file_fd = virPidFileAcquirePath(pid_file, false, getpid())) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_PIDFILE;\n            goto cleanup;\n        }\n\n        if (!(logDaemon = virLogDaemonNew(config, privileged))) {\n            ret = VIR_LOG_DAEMON_ERR_INIT;\n            goto cleanup;\n        }\n\n        if (virSystemdGetActivation(actmap,\n                                    G_N_ELEMENTS(actmap),\n                                    &act) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_NETWORK;\n            goto cleanup;\n        }\n\n        logSrv = virNetDaemonGetServer(logDaemon->dmn, \"virtlogd\");\n        adminSrv = virNetDaemonGetServer(logDaemon->dmn, \"admin\");\n\n        if (virNetServerAddServiceUNIX(logSrv,\n                                       act, \"virtlogd.socket\",\n                                       sock_file, 0700, 0, 0,\n                                       NULL,\n                                       false, 0, 1) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_NETWORK;\n            goto cleanup;\n        }\n        if (virNetServerAddServiceUNIX(adminSrv,\n                                       act, \"virtlogd-admin.socket\",\n                                       admin_sock_file, 0700, 0, 0,\n                                       NULL,\n                                       false, 0, 1) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_NETWORK;\n            goto cleanup;\n        }\n\n        if (act &&\n            virSystemdActivationComplete(act) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_NETWORK;\n            goto cleanup;\n        }\n    } else {\n        logSrv = virNetDaemonGetServer(logDaemon->dmn, \"virtlogd\");\n        /* If exec-restarting from old virtlogd, we won't have an\n         * admin server present */\n        if (virNetDaemonHasServer(logDaemon->dmn, \"admin\"))\n            adminSrv = virNetDaemonGetServer(logDaemon->dmn, \"admin\");\n    }\n\n    if (timeout != -1) {\n        VIR_DEBUG(\"Registering shutdown timeout %d\", timeout);\n        virNetDaemonAutoShutdown(logDaemon->dmn,\n                                 timeout);\n    }\n\n    if ((virLogDaemonSetupSignals(logDaemon->dmn)) < 0) {\n        ret = VIR_LOG_DAEMON_ERR_SIGNAL;\n        goto cleanup;\n    }\n\n    if (!(logProgram = virNetServerProgramNew(VIR_LOG_MANAGER_PROTOCOL_PROGRAM,\n                                              VIR_LOG_MANAGER_PROTOCOL_PROGRAM_VERSION,\n                                              virLogManagerProtocolProcs,\n                                              virLogManagerProtocolNProcs))) {\n        ret = VIR_LOG_DAEMON_ERR_INIT;\n        goto cleanup;\n    }\n    if (virNetServerAddProgram(logSrv, logProgram) < 0) {\n        ret = VIR_LOG_DAEMON_ERR_INIT;\n        goto cleanup;\n    }\n\n    if (adminSrv != NULL) {\n        if (!(adminProgram = virNetServerProgramNew(ADMIN_PROGRAM,\n                                                    ADMIN_PROTOCOL_VERSION,\n                                                    adminProcs,\n                                                    adminNProcs))) {\n            ret = VIR_LOG_DAEMON_ERR_INIT;\n            goto cleanup;\n        }\n        if (virNetServerAddProgram(adminSrv, adminProgram) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_INIT;\n            goto cleanup;\n        }\n    }\n\n    /* Disable error func, now logging is setup */\n    virSetErrorFunc(NULL, virLogDaemonErrorHandler);\n\n    /* Tell parent of daemon that basic initialization is complete\n     * In particular we're ready to accept net connections & have\n     * written the pidfile\n     */\n    if (statuswrite != -1) {\n        char status = 0;\n        while (write(statuswrite, &status, 1) == -1 &&\n               errno == EINTR)\n            ;\n        VIR_FORCE_CLOSE(statuswrite);\n    }\n\n    /* Start accepting new clients from network */\n\n    virNetDaemonUpdateServices(logDaemon->dmn, true);\n    virNetDaemonRun(logDaemon->dmn);\n\n    if (execRestart &&\n        virLogDaemonPreExecRestart(state_file,\n                                   logDaemon->dmn,\n                                   argv) < 0)\n        ret = VIR_LOG_DAEMON_ERR_REEXEC;\n    else\n        ret = 0;\n\n cleanup:\n    virObjectUnref(logProgram);\n    virObjectUnref(adminProgram);\n    virObjectUnref(logSrv);\n    virObjectUnref(adminSrv);\n    virLogDaemonFree(logDaemon);\n    if (statuswrite != -1) {\n        if (ret != 0) {\n            /* Tell parent of daemon what failed */\n            char status = ret;\n            while (write(statuswrite, &status, 1) == -1 &&\n                   errno == EINTR)\n                ;\n        }\n        VIR_FORCE_CLOSE(statuswrite);\n    }\n    if (pid_file_fd != -1)\n        virPidFileReleasePath(pid_file, pid_file_fd);\n    VIR_FREE(pid_file);\n    VIR_FREE(sock_file);\n    VIR_FREE(admin_sock_file);\n    VIR_FREE(state_file);\n    VIR_FREE(run_dir);\n    VIR_FREE(remote_config_file);\n    virLogDaemonConfigFree(config);\n    return ret;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virLogDaemonPtr logDaemon = NULL;",
      "static bool execRestart;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLogDaemonConfigFree",
          "args": [
            "config"
          ],
          "line": 1178
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonConfigFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon_config.c",
          "lines": "72-82",
          "snippet": "void\nvirLogDaemonConfigFree(virLogDaemonConfigPtr data)\n{\n    if (!data)\n        return;\n\n    VIR_FREE(data->log_filters);\n    VIR_FREE(data->log_outputs);\n\n    VIR_FREE(data);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"rpc/virnetserver.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"log_daemon_config.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"rpc/virnetserver.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"log_daemon_config.h\"\n#include <config.h>\n\nvoid\nvirLogDaemonConfigFree(virLogDaemonConfigPtr data)\n{\n    if (!data)\n        return;\n\n    VIR_FREE(data->log_filters);\n    VIR_FREE(data->log_outputs);\n\n    VIR_FREE(data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "remote_config_file"
          ],
          "line": 1177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "run_dir"
          ],
          "line": 1176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "state_file"
          ],
          "line": 1175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "admin_sock_file"
          ],
          "line": 1174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sock_file"
          ],
          "line": 1173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pid_file"
          ],
          "line": 1172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPidFileReleasePath",
          "args": [
            "pid_file",
            "pid_file_fd"
          ],
          "line": 1171
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileReleasePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "430-450",
          "snippet": "int virPidFileReleasePath(const char *path,\n                          int fd)\n{\n    int rc = 0;\n    /*\n     * We need to unlink before closing the FD to avoid\n     * a race, but Win32 won't let you unlink an open\n     * file handle. So on that platform we do the reverse\n     * and just have to live with the possible race.\n     */\n#ifdef WIN32\n    VIR_FORCE_CLOSE(fd);\n    if (unlink(path) < 0 && errno != ENOENT)\n        rc = -errno;\n#else\n    if (unlink(path) < 0 && errno != ENOENT)\n        rc = -errno;\n    VIR_FORCE_CLOSE(fd);\n#endif\n    return rc;\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileReleasePath(const char *path,\n                          int fd)\n{\n    int rc = 0;\n    /*\n     * We need to unlink before closing the FD to avoid\n     * a race, but Win32 won't let you unlink an open\n     * file handle. So on that platform we do the reverse\n     * and just have to live with the possible race.\n     */\n#ifdef WIN32\n    VIR_FORCE_CLOSE(fd);\n    if (unlink(path) < 0 && errno != ENOENT)\n        rc = -errno;\n#else\n    if (unlink(path) < 0 && errno != ENOENT)\n        rc = -errno;\n    VIR_FORCE_CLOSE(fd);\n#endif\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "statuswrite"
          ],
          "line": 1168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "write",
          "args": [
            "statuswrite",
            "&status",
            "1"
          ],
          "line": 1164
        },
        "resolved": true,
        "details": {
          "function_name": "safewrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1093-1111",
          "snippet": "ssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogDaemonFree",
          "args": [
            "logDaemon"
          ],
          "line": 1159
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "112-123",
          "snippet": "static void\nvirLogDaemonFree(virLogDaemonPtr logd)\n{\n    if (!logd)\n        return;\n\n    virObjectUnref(logd->handler);\n    virMutexDestroy(&logd->lock);\n    virObjectUnref(logd->dmn);\n\n    VIR_FREE(logd);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonFree(virLogDaemonPtr logd)\n{\n    if (!logd)\n        return;\n\n    virObjectUnref(logd->handler);\n    virMutexDestroy(&logd->lock);\n    virObjectUnref(logd->dmn);\n\n    VIR_FREE(logd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "adminSrv"
          ],
          "line": 1158
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogDaemonPreExecRestart",
          "args": [
            "state_file",
            "logDaemon->dmn",
            "argv"
          ],
          "line": 1147
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonPreExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "710-775",
          "snippet": "static int\nvirLogDaemonPreExecRestart(const char *state_file,\n                           virNetDaemonPtr dmn,\n                           char **argv)\n{\n    virJSONValuePtr child;\n    char *state = NULL;\n    int ret = -1;\n    virJSONValuePtr object = virJSONValueNewObject();\n    char *magic;\n    virHashKeyValuePairPtr pairs = NULL;\n\n    VIR_DEBUG(\"Running pre-restart exec\");\n\n    if (!(child = virNetDaemonPreExecRestart(dmn)))\n        goto cleanup;\n\n    if (virJSONValueObjectAppend(object, \"daemon\", child) < 0) {\n        virJSONValueFree(child);\n        goto cleanup;\n    }\n\n    if (!(magic = virLogDaemonGetExecRestartMagic()))\n        goto cleanup;\n\n    if (virJSONValueObjectAppendString(object, \"magic\", magic) < 0) {\n        VIR_FREE(magic);\n        goto cleanup;\n    }\n\n    if (!(child = virLogHandlerPreExecRestart(logDaemon->handler)))\n        goto cleanup;\n\n    if (virJSONValueObjectAppend(object, \"handler\", child) < 0) {\n        virJSONValueFree(child);\n        goto cleanup;\n    }\n\n\n    if (!(state = virJSONValueToString(object, true)))\n        goto cleanup;\n\n    VIR_DEBUG(\"Saving state %s\", state);\n\n    if (virFileWriteStr(state_file,\n                        state, 0700) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to save state file %s\"),\n                             state_file);\n        goto cleanup;\n    }\n\n    if (execvp(argv[0], argv) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to restart self\"));\n        goto cleanup;\n    }\n\n    abort(); /* This should be impossible to reach */\n\n cleanup:\n    VIR_FREE(pairs);\n    VIR_FREE(state);\n    virJSONValueFree(object);\n    return ret;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virLogDaemonPtr logDaemon = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirLogDaemonPtr logDaemon = NULL;\n\nstatic int\nvirLogDaemonPreExecRestart(const char *state_file,\n                           virNetDaemonPtr dmn,\n                           char **argv)\n{\n    virJSONValuePtr child;\n    char *state = NULL;\n    int ret = -1;\n    virJSONValuePtr object = virJSONValueNewObject();\n    char *magic;\n    virHashKeyValuePairPtr pairs = NULL;\n\n    VIR_DEBUG(\"Running pre-restart exec\");\n\n    if (!(child = virNetDaemonPreExecRestart(dmn)))\n        goto cleanup;\n\n    if (virJSONValueObjectAppend(object, \"daemon\", child) < 0) {\n        virJSONValueFree(child);\n        goto cleanup;\n    }\n\n    if (!(magic = virLogDaemonGetExecRestartMagic()))\n        goto cleanup;\n\n    if (virJSONValueObjectAppendString(object, \"magic\", magic) < 0) {\n        VIR_FREE(magic);\n        goto cleanup;\n    }\n\n    if (!(child = virLogHandlerPreExecRestart(logDaemon->handler)))\n        goto cleanup;\n\n    if (virJSONValueObjectAppend(object, \"handler\", child) < 0) {\n        virJSONValueFree(child);\n        goto cleanup;\n    }\n\n\n    if (!(state = virJSONValueToString(object, true)))\n        goto cleanup;\n\n    VIR_DEBUG(\"Saving state %s\", state);\n\n    if (virFileWriteStr(state_file,\n                        state, 0700) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to save state file %s\"),\n                             state_file);\n        goto cleanup;\n    }\n\n    if (execvp(argv[0], argv) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to restart self\"));\n        goto cleanup;\n    }\n\n    abort(); /* This should be impossible to reach */\n\n cleanup:\n    VIR_FREE(pairs);\n    VIR_FREE(state);\n    virJSONValueFree(object);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonRun",
          "args": [
            "logDaemon->dmn"
          ],
          "line": 1144
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonRun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "799-864",
          "snippet": "void\nvirNetDaemonRun(virNetDaemonPtr dmn)\n{\n    int timerid = -1;\n    bool timerActive = false;\n\n    virObjectLock(dmn);\n\n    if (dmn->srvObject) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Not all servers restored, cannot run server\"));\n        goto cleanup;\n    }\n\n    dmn->quit = false;\n\n    if (dmn->autoShutdownTimeout &&\n        (timerid = virEventAddTimeout(-1,\n                                      virNetDaemonAutoShutdownTimer,\n                                      dmn, NULL)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Failed to register shutdown timeout\"));\n        goto cleanup;\n    }\n\n    /* We are accepting connections now. Notify systemd\n     * so it can start dependent services. */\n    virSystemdNotifyStartup();\n\n    VIR_DEBUG(\"dmn=%p quit=%d\", dmn, dmn->quit);\n    while (!dmn->quit) {\n        /* A shutdown timeout is specified, so check\n         * if any drivers have active state, if not\n         * shutdown after timeout seconds\n         */\n        if (dmn->autoShutdownTimeout) {\n            if (timerActive) {\n                if (virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Deactivating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid, -1);\n                    timerActive = false;\n                }\n            } else {\n                if (!virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Activating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid,\n                                          dmn->autoShutdownTimeout * 1000);\n                    timerActive = true;\n                }\n            }\n        }\n\n        virObjectUnlock(dmn);\n        if (virEventRunDefaultImpl() < 0) {\n            virObjectLock(dmn);\n            VIR_DEBUG(\"Loop iteration error, exiting\");\n            break;\n        }\n        virObjectLock(dmn);\n\n        virHashForEach(dmn->servers, daemonServerProcessClients, NULL);\n    }\n\n cleanup:\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonRun(virNetDaemonPtr dmn)\n{\n    int timerid = -1;\n    bool timerActive = false;\n\n    virObjectLock(dmn);\n\n    if (dmn->srvObject) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Not all servers restored, cannot run server\"));\n        goto cleanup;\n    }\n\n    dmn->quit = false;\n\n    if (dmn->autoShutdownTimeout &&\n        (timerid = virEventAddTimeout(-1,\n                                      virNetDaemonAutoShutdownTimer,\n                                      dmn, NULL)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Failed to register shutdown timeout\"));\n        goto cleanup;\n    }\n\n    /* We are accepting connections now. Notify systemd\n     * so it can start dependent services. */\n    virSystemdNotifyStartup();\n\n    VIR_DEBUG(\"dmn=%p quit=%d\", dmn, dmn->quit);\n    while (!dmn->quit) {\n        /* A shutdown timeout is specified, so check\n         * if any drivers have active state, if not\n         * shutdown after timeout seconds\n         */\n        if (dmn->autoShutdownTimeout) {\n            if (timerActive) {\n                if (virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Deactivating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid, -1);\n                    timerActive = false;\n                }\n            } else {\n                if (!virNetDaemonHasClients(dmn)) {\n                    VIR_DEBUG(\"Activating shutdown timer %d\", timerid);\n                    virEventUpdateTimeout(timerid,\n                                          dmn->autoShutdownTimeout * 1000);\n                    timerActive = true;\n                }\n            }\n        }\n\n        virObjectUnlock(dmn);\n        if (virEventRunDefaultImpl() < 0) {\n            virObjectLock(dmn);\n            VIR_DEBUG(\"Loop iteration error, exiting\");\n            break;\n        }\n        virObjectLock(dmn);\n\n        virHashForEach(dmn->servers, daemonServerProcessClients, NULL);\n    }\n\n cleanup:\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonUpdateServices",
          "args": [
            "logDaemon->dmn",
            "true"
          ],
          "line": 1143
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonUpdateServices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "779-786",
          "snippet": "void\nvirNetDaemonUpdateServices(virNetDaemonPtr dmn,\n                           bool enabled)\n{\n    virObjectLock(dmn);\n    virHashForEach(dmn->servers, daemonServerUpdateServices, &enabled);\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonUpdateServices(virNetDaemonPtr dmn,\n                           bool enabled)\n{\n    virObjectLock(dmn);\n    virHashForEach(dmn->servers, daemonServerUpdateServices, &enabled);\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "statuswrite"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSetErrorFunc",
          "args": [
            "NULL",
            "virLogDaemonErrorHandler"
          ],
          "line": 1127
        },
        "resolved": true,
        "details": {
          "function_name": "virSetErrorFunc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "609-614",
          "snippet": "void\nvirSetErrorFunc(void *userData, virErrorFunc handler)\n{\n    virErrorHandler = handler;\n    virUserData = userData;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirSetErrorFunc(void *userData, virErrorFunc handler)\n{\n    virErrorHandler = handler;\n    virUserData = userData;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerAddProgram",
          "args": [
            "adminSrv",
            "adminProgram"
          ],
          "line": 1120
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerAddProgram",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserver.c",
          "lines": "820-836",
          "snippet": "int virNetServerAddProgram(virNetServerPtr srv,\n                           virNetServerProgramPtr prog)\n{\n    virObjectLock(srv);\n\n    if (VIR_EXPAND_N(srv->programs, srv->nprograms, 1) < 0)\n        goto error;\n\n    srv->programs[srv->nprograms-1] = virObjectRef(prog);\n\n    virObjectUnlock(srv);\n    return 0;\n\n error:\n    virObjectUnlock(srv);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserver.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);",
            "static inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetserver.h\"\n#include <config.h>\n\nstatic inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);\nstatic inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);\n\nint virNetServerAddProgram(virNetServerPtr srv,\n                           virNetServerProgramPtr prog)\n{\n    virObjectLock(srv);\n\n    if (VIR_EXPAND_N(srv->programs, srv->nprograms, 1) < 0)\n        goto error;\n\n    srv->programs[srv->nprograms-1] = virObjectRef(prog);\n\n    virObjectUnlock(srv);\n    return 0;\n\n error:\n    virObjectUnlock(srv);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerProgramNew",
          "args": [
            "ADMIN_PROGRAM",
            "ADMIN_PROTOCOL_VERSION",
            "adminProcs",
            "adminNProcs"
          ],
          "line": 1113
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerProgramNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverprogram.c",
          "lines": "61-82",
          "snippet": "virNetServerProgramPtr virNetServerProgramNew(unsigned program,\n                                              unsigned version,\n                                              virNetServerProgramProcPtr procs,\n                                              size_t nprocs)\n{\n    virNetServerProgramPtr prog;\n\n    if (virNetServerProgramInitialize() < 0)\n        return NULL;\n\n    if (!(prog = virObjectNew(virNetServerProgramClass)))\n        return NULL;\n\n    prog->program = program;\n    prog->version = version;\n    prog->procs = procs;\n    prog->nprocs = nprocs;\n\n    VIR_DEBUG(\"prog=%p\", prog);\n\n    return prog;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserverprogram.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virNetServerProgramClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserverprogram.h\"\n#include <config.h>\n\nstatic virClassPtr virNetServerProgramClass;\n\nvirNetServerProgramPtr virNetServerProgramNew(unsigned program,\n                                              unsigned version,\n                                              virNetServerProgramProcPtr procs,\n                                              size_t nprocs)\n{\n    virNetServerProgramPtr prog;\n\n    if (virNetServerProgramInitialize() < 0)\n        return NULL;\n\n    if (!(prog = virObjectNew(virNetServerProgramClass)))\n        return NULL;\n\n    prog->program = program;\n    prog->version = version;\n    prog->procs = procs;\n    prog->nprocs = nprocs;\n\n    VIR_DEBUG(\"prog=%p\", prog);\n\n    return prog;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogDaemonSetupSignals",
          "args": [
            "logDaemon->dmn"
          ],
          "line": 1095
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonSetupSignals",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "491-503",
          "snippet": "static int\nvirLogDaemonSetupSignals(virNetDaemonPtr dmn)\n{\n    if (virNetDaemonAddSignalHandler(dmn, SIGINT, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGQUIT, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGTERM, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGUSR1, virLogDaemonExecRestartHandler, NULL) < 0)\n        return -1;\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirLogDaemonSetupSignals(virNetDaemonPtr dmn)\n{\n    if (virNetDaemonAddSignalHandler(dmn, SIGINT, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGQUIT, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGTERM, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGUSR1, virLogDaemonExecRestartHandler, NULL) < 0)\n        return -1;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonAutoShutdown",
          "args": [
            "logDaemon->dmn",
            "timeout"
          ],
          "line": 1091
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonAutoShutdownTimer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "751-765",
          "snippet": "static void\nvirNetDaemonAutoShutdownTimer(int timerid G_GNUC_UNUSED,\n                              void *opaque)\n{\n    virNetDaemonPtr dmn = opaque;\n\n    virObjectLock(dmn);\n\n    if (!dmn->autoShutdownInhibitions) {\n        VIR_DEBUG(\"Automatic shutdown triggered\");\n        dmn->quit = true;\n    }\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirNetDaemonAutoShutdownTimer(int timerid G_GNUC_UNUSED,\n                              void *opaque)\n{\n    virNetDaemonPtr dmn = opaque;\n\n    virObjectLock(dmn);\n\n    if (!dmn->autoShutdownInhibitions) {\n        VIR_DEBUG(\"Automatic shutdown triggered\");\n        dmn->quit = true;\n    }\n\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Registering shutdown timeout %d\"",
            "timeout"
          ],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDaemonGetServer",
          "args": [
            "logDaemon->dmn",
            "\"admin\""
          ],
          "line": 1086
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonGetServers",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "240-264",
          "snippet": "ssize_t\nvirNetDaemonGetServers(virNetDaemonPtr dmn,\n                       virNetServerPtr **servers)\n{\n    struct collectData data = { servers, 0 };\n    ssize_t ret = -1;\n\n    *servers = NULL;\n\n    virObjectLock(dmn);\n\n    if (virHashForEach(dmn->servers, collectServers, &data) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Cannot get all servers from daemon\"));\n        goto cleanup;\n    }\n\n    ret = data.nservers;\n\n cleanup:\n    if (ret < 0)\n        virObjectListFreeCount(*servers, data.nservers);\n    virObjectUnlock(dmn);\n    return ret;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nssize_t\nvirNetDaemonGetServers(virNetDaemonPtr dmn,\n                       virNetServerPtr **servers)\n{\n    struct collectData data = { servers, 0 };\n    ssize_t ret = -1;\n\n    *servers = NULL;\n\n    virObjectLock(dmn);\n\n    if (virHashForEach(dmn->servers, collectServers, &data) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Cannot get all servers from daemon\"));\n        goto cleanup;\n    }\n\n    ret = data.nservers;\n\n cleanup:\n    if (ret < 0)\n        virObjectListFreeCount(*servers, data.nservers);\n    virObjectUnlock(dmn);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonHasServer",
          "args": [
            "logDaemon->dmn",
            "\"admin\""
          ],
          "line": 1085
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonHasServer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "200-211",
          "snippet": "bool\nvirNetDaemonHasServer(virNetDaemonPtr dmn,\n                      const char *serverName)\n{\n    void *ent;\n\n    virObjectLock(dmn);\n    ent = virHashLookup(dmn->servers, serverName);\n    virObjectUnlock(dmn);\n\n    return ent != NULL;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nbool\nvirNetDaemonHasServer(virNetDaemonPtr dmn,\n                      const char *serverName)\n{\n    void *ent;\n\n    virObjectLock(dmn);\n    ent = virHashLookup(dmn->servers, serverName);\n    virObjectUnlock(dmn);\n\n    return ent != NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdActivationComplete",
          "args": [
            "act"
          ],
          "line": 1077
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdActivationComplete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "976-986",
          "snippet": "int\nvirSystemdActivationComplete(virSystemdActivationPtr act)\n{\n    if (virHashSize(act->fds) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Some activation file descriptors are unclaimed\"));\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint\nvirSystemdActivationComplete(virSystemdActivationPtr act)\n{\n    if (virHashSize(act->fds) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Some activation file descriptors are unclaimed\"));\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerAddServiceUNIX",
          "args": [
            "adminSrv",
            "act",
            "\"virtlogd-admin.socket\"",
            "admin_sock_file",
            "0700",
            "0",
            "0",
            "NULL",
            "false",
            "0",
            "1"
          ],
          "line": 1067
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerAddServiceUNIX",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserver.c",
          "lines": "772-817",
          "snippet": "int virNetServerAddServiceUNIX(virNetServerPtr srv,\n                               virSystemdActivationPtr act,\n                               const char *actname,\n                               const char *path,\n                               mode_t mask,\n                               gid_t grp,\n                               int auth,\n                               virNetTLSContextPtr tls,\n                               bool readonly,\n                               size_t max_queued_clients,\n                               size_t nrequests_client_max)\n{\n    virNetServerServicePtr svc = NULL;\n    int ret;\n\n    ret = virNetServerAddServiceActivation(srv, act, actname,\n                                           auth,\n                                           tls,\n                                           readonly,\n                                           max_queued_clients,\n                                           nrequests_client_max);\n    if (ret < 0)\n        return -1;\n\n    if (ret == 1)\n        return 0;\n\n    if (!(svc = virNetServerServiceNewUNIX(path,\n                                           mask,\n                                           grp,\n                                           auth,\n                                           tls,\n                                           readonly,\n                                           max_queued_clients,\n                                           nrequests_client_max)))\n        return -1;\n\n    if (virNetServerAddService(srv, svc) < 0) {\n        virObjectUnref(svc);\n        return -1;\n    }\n\n    virObjectUnref(svc);\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserver.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);",
            "static inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetserver.h\"\n#include <config.h>\n\nstatic inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);\nstatic inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);\n\nint virNetServerAddServiceUNIX(virNetServerPtr srv,\n                               virSystemdActivationPtr act,\n                               const char *actname,\n                               const char *path,\n                               mode_t mask,\n                               gid_t grp,\n                               int auth,\n                               virNetTLSContextPtr tls,\n                               bool readonly,\n                               size_t max_queued_clients,\n                               size_t nrequests_client_max)\n{\n    virNetServerServicePtr svc = NULL;\n    int ret;\n\n    ret = virNetServerAddServiceActivation(srv, act, actname,\n                                           auth,\n                                           tls,\n                                           readonly,\n                                           max_queued_clients,\n                                           nrequests_client_max);\n    if (ret < 0)\n        return -1;\n\n    if (ret == 1)\n        return 0;\n\n    if (!(svc = virNetServerServiceNewUNIX(path,\n                                           mask,\n                                           grp,\n                                           auth,\n                                           tls,\n                                           readonly,\n                                           max_queued_clients,\n                                           nrequests_client_max)))\n        return -1;\n\n    if (virNetServerAddService(srv, svc) < 0) {\n        virObjectUnref(svc);\n        return -1;\n    }\n\n    virObjectUnref(svc);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdGetActivation",
          "args": [
            "actmap",
            "G_N_ELEMENTS(actmap)",
            "&act"
          ],
          "line": 1049
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdGetActivation",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "926-944",
          "snippet": "int\nvirSystemdGetActivation(virSystemdActivationMap *map,\n                        size_t nmap,\n                        virSystemdActivationPtr *act)\n{\n    int nfds = 0;\n\n    if ((nfds = virSystemdGetListenFDs()) < 0)\n        return -1;\n\n    if (nfds == 0) {\n        VIR_DEBUG(\"No activation FDs present\");\n        *act = NULL;\n        return 0;\n    }\n\n    *act = virSystemdActivationNew(map, nmap, nfds);\n    return 0;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint\nvirSystemdGetActivation(virSystemdActivationMap *map,\n                        size_t nmap,\n                        virSystemdActivationPtr *act)\n{\n    int nfds = 0;\n\n    if ((nfds = virSystemdGetListenFDs()) < 0)\n        return -1;\n\n    if (nfds == 0) {\n        VIR_DEBUG(\"No activation FDs present\");\n        *act = NULL;\n        return 0;\n    }\n\n    *act = virSystemdActivationNew(map, nmap, nfds);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "actmap"
          ],
          "line": 1050
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonNew",
          "args": [
            "config",
            "privileged"
          ],
          "line": 1044
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "143-203",
          "snippet": "static virLogDaemonPtr\nvirLogDaemonNew(virLogDaemonConfigPtr config, bool privileged)\n{\n    virLogDaemonPtr logd;\n    virNetServerPtr srv = NULL;\n\n    if (VIR_ALLOC(logd) < 0)\n        return NULL;\n\n    if (virMutexInit(&logd->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        VIR_FREE(logd);\n        return NULL;\n    }\n\n    if (!(logd->dmn = virNetDaemonNew()))\n        goto error;\n\n    if (!(srv = virNetServerNew(\"virtlogd\", 1,\n                                0, 0, 0, config->max_clients,\n                                config->max_clients, -1, 0,\n                                virLogDaemonClientNew,\n                                virLogDaemonClientPreExecRestart,\n                                virLogDaemonClientFree,\n                                (void*)(intptr_t)(privileged ? 0x1 : 0x0))))\n        goto error;\n\n    if (virNetDaemonAddServer(logd->dmn, srv) < 0)\n        goto error;\n    virObjectUnref(srv);\n    srv = NULL;\n\n    if (!(srv = virNetServerNew(\"admin\", 1,\n                                0, 0, 0, config->admin_max_clients,\n                                config->admin_max_clients, -1, 0,\n                                remoteAdmClientNew,\n                                remoteAdmClientPreExecRestart,\n                                remoteAdmClientFree,\n                                logd->dmn)))\n        goto error;\n\n    if (virNetDaemonAddServer(logd->dmn, srv) < 0)\n        goto error;\n    virObjectUnref(srv);\n    srv = NULL;\n\n    if (!(logd->handler = virLogHandlerNew(privileged,\n                                           config->max_size,\n                                           config->max_backups,\n                                           virLogDaemonInhibitor,\n                                           logd)))\n        goto error;\n\n    return logd;\n\n error:\n    virObjectUnref(srv);\n    virLogDaemonFree(logd);\n    return NULL;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virLogDaemonPtr\nvirLogDaemonNew(virLogDaemonConfigPtr config, bool privileged)\n{\n    virLogDaemonPtr logd;\n    virNetServerPtr srv = NULL;\n\n    if (VIR_ALLOC(logd) < 0)\n        return NULL;\n\n    if (virMutexInit(&logd->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        VIR_FREE(logd);\n        return NULL;\n    }\n\n    if (!(logd->dmn = virNetDaemonNew()))\n        goto error;\n\n    if (!(srv = virNetServerNew(\"virtlogd\", 1,\n                                0, 0, 0, config->max_clients,\n                                config->max_clients, -1, 0,\n                                virLogDaemonClientNew,\n                                virLogDaemonClientPreExecRestart,\n                                virLogDaemonClientFree,\n                                (void*)(intptr_t)(privileged ? 0x1 : 0x0))))\n        goto error;\n\n    if (virNetDaemonAddServer(logd->dmn, srv) < 0)\n        goto error;\n    virObjectUnref(srv);\n    srv = NULL;\n\n    if (!(srv = virNetServerNew(\"admin\", 1,\n                                0, 0, 0, config->admin_max_clients,\n                                config->admin_max_clients, -1, 0,\n                                remoteAdmClientNew,\n                                remoteAdmClientPreExecRestart,\n                                remoteAdmClientFree,\n                                logd->dmn)))\n        goto error;\n\n    if (virNetDaemonAddServer(logd->dmn, srv) < 0)\n        goto error;\n    virObjectUnref(srv);\n    srv = NULL;\n\n    if (!(logd->handler = virLogHandlerNew(privileged,\n                                           config->max_size,\n                                           config->max_backups,\n                                           virLogDaemonInhibitor,\n                                           logd)))\n        goto error;\n\n    return logd;\n\n error:\n    virObjectUnref(srv);\n    virLogDaemonFree(logd);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPidFileAcquirePath",
          "args": [
            "pid_file",
            "false",
            "getpid()"
          ],
          "line": 1039
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileAcquirePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "330-410",
          "snippet": "int virPidFileAcquirePath(const char *path,\n                          bool waitForLock,\n                          pid_t pid)\n{\n    int fd = -1;\n    char pidstr[VIR_INT64_STR_BUFLEN];\n\n    if (path[0] == '\\0')\n        return 0;\n\n    while (1) {\n        struct stat a, b;\n        if ((fd = open(path, O_WRONLY|O_CREAT, 0644)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to open pid file '%s'\"),\n                                 path);\n            return -1;\n        }\n\n        if (virSetCloseExec(fd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to set close-on-exec flag '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        if (fstat(fd, &b) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to check status of pid file '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        if (virFileLock(fd, false, 0, 1, waitForLock) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to acquire pid file '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        /* Now make sure the pidfile we locked is the same\n         * one that now exists on the filesystem\n         */\n        if (stat(path, &a) < 0) {\n            VIR_DEBUG(\"Pid file '%s' disappeared: %s\",\n                      path, g_strerror(errno));\n            VIR_FORCE_CLOSE(fd);\n            /* Someone else must be racing with us, so try again */\n            continue;\n        }\n\n        if (a.st_ino == b.st_ino)\n            break;\n\n        VIR_DEBUG(\"Pid file '%s' was recreated\", path);\n        VIR_FORCE_CLOSE(fd);\n        /* Someone else must be racing with us, so try again */\n    }\n\n    g_snprintf(pidstr, sizeof(pidstr), \"%lld\", (long long) pid);\n\n    if (ftruncate(fd, 0) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to truncate pid file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    if (safewrite(fd, pidstr, strlen(pidstr)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to write to pid file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n    }\n\n    return fd;\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileAcquirePath(const char *path,\n                          bool waitForLock,\n                          pid_t pid)\n{\n    int fd = -1;\n    char pidstr[VIR_INT64_STR_BUFLEN];\n\n    if (path[0] == '\\0')\n        return 0;\n\n    while (1) {\n        struct stat a, b;\n        if ((fd = open(path, O_WRONLY|O_CREAT, 0644)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to open pid file '%s'\"),\n                                 path);\n            return -1;\n        }\n\n        if (virSetCloseExec(fd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to set close-on-exec flag '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        if (fstat(fd, &b) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to check status of pid file '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        if (virFileLock(fd, false, 0, 1, waitForLock) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to acquire pid file '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        /* Now make sure the pidfile we locked is the same\n         * one that now exists on the filesystem\n         */\n        if (stat(path, &a) < 0) {\n            VIR_DEBUG(\"Pid file '%s' disappeared: %s\",\n                      path, g_strerror(errno));\n            VIR_FORCE_CLOSE(fd);\n            /* Someone else must be racing with us, so try again */\n            continue;\n        }\n\n        if (a.st_ino == b.st_ino)\n            break;\n\n        VIR_DEBUG(\"Pid file '%s' was recreated\", path);\n        VIR_FORCE_CLOSE(fd);\n        /* Someone else must be racing with us, so try again */\n    }\n\n    g_snprintf(pidstr, sizeof(pidstr), \"%lld\", (long long) pid);\n\n    if (ftruncate(fd, 0) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to truncate pid file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    if (safewrite(fd, pidstr, strlen(pidstr)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to write to pid file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n    }\n\n    return fd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 1039
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Failed to fork as daemon: %s\")",
            "g_strerror(errno)"
          ],
          "line": 1032
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 1033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to fork as daemon: %s\""
          ],
          "line": 1032
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogDaemonForkIntoBackground",
          "args": [
            "argv[0]"
          ],
          "line": 1031
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonForkIntoBackground",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "297-382",
          "snippet": "static int\nvirLogDaemonForkIntoBackground(const char *argv0)\n{\n    int statuspipe[2];\n    if (virPipeQuiet(statuspipe) < 0)\n        return -1;\n\n    pid_t pid = fork();\n    switch (pid) {\n    case 0:\n        {\n            int stdinfd = -1;\n            int stdoutfd = -1;\n            int nextpid;\n\n            VIR_FORCE_CLOSE(statuspipe[0]);\n\n            if ((stdinfd = open(\"/dev/null\", O_RDONLY)) < 0)\n                goto cleanup;\n            if ((stdoutfd = open(\"/dev/null\", O_WRONLY)) < 0)\n                goto cleanup;\n            if (dup2(stdinfd, STDIN_FILENO) != STDIN_FILENO)\n                goto cleanup;\n            if (dup2(stdoutfd, STDOUT_FILENO) != STDOUT_FILENO)\n                goto cleanup;\n            if (dup2(stdoutfd, STDERR_FILENO) != STDERR_FILENO)\n                goto cleanup;\n            if (VIR_CLOSE(stdinfd) < 0)\n                goto cleanup;\n            if (VIR_CLOSE(stdoutfd) < 0)\n                goto cleanup;\n\n            if (setsid() < 0)\n                goto cleanup;\n\n            nextpid = fork();\n            switch (nextpid) {\n            case 0:\n                return statuspipe[1];\n            case -1:\n                return -1;\n            default:\n                _exit(0);\n            }\n\n        cleanup:\n            VIR_FORCE_CLOSE(stdoutfd);\n            VIR_FORCE_CLOSE(stdinfd);\n            return -1;\n\n        }\n\n    case -1:\n        return -1;\n\n    default:\n        {\n            int got, exitstatus = 0;\n            int ret;\n            char status;\n\n            VIR_FORCE_CLOSE(statuspipe[1]);\n\n            /* We wait to make sure the first child forked successfully */\n            if ((got = waitpid(pid, &exitstatus, 0)) < 0 ||\n                got != pid ||\n                exitstatus != 0) {\n                return -1;\n            }\n\n            /* Now block until the second child initializes successfully */\n        again:\n            ret = read(statuspipe[0], &status, 1);\n            if (ret == -1 && errno == EINTR)\n                goto again;\n\n            if (ret == 1 && status != 0) {\n                fprintf(stderr,\n                        _(\"%s: error: %s. Check /var/log/messages or run without \"\n                          \"--daemon for more info.\\n\"), argv0,\n                        virDaemonErrTypeToString(status));\n            }\n            _exit(ret == 1 && status == 0 ? 0 : 1);\n        }\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirLogDaemonForkIntoBackground(const char *argv0)\n{\n    int statuspipe[2];\n    if (virPipeQuiet(statuspipe) < 0)\n        return -1;\n\n    pid_t pid = fork();\n    switch (pid) {\n    case 0:\n        {\n            int stdinfd = -1;\n            int stdoutfd = -1;\n            int nextpid;\n\n            VIR_FORCE_CLOSE(statuspipe[0]);\n\n            if ((stdinfd = open(\"/dev/null\", O_RDONLY)) < 0)\n                goto cleanup;\n            if ((stdoutfd = open(\"/dev/null\", O_WRONLY)) < 0)\n                goto cleanup;\n            if (dup2(stdinfd, STDIN_FILENO) != STDIN_FILENO)\n                goto cleanup;\n            if (dup2(stdoutfd, STDOUT_FILENO) != STDOUT_FILENO)\n                goto cleanup;\n            if (dup2(stdoutfd, STDERR_FILENO) != STDERR_FILENO)\n                goto cleanup;\n            if (VIR_CLOSE(stdinfd) < 0)\n                goto cleanup;\n            if (VIR_CLOSE(stdoutfd) < 0)\n                goto cleanup;\n\n            if (setsid() < 0)\n                goto cleanup;\n\n            nextpid = fork();\n            switch (nextpid) {\n            case 0:\n                return statuspipe[1];\n            case -1:\n                return -1;\n            default:\n                _exit(0);\n            }\n\n        cleanup:\n            VIR_FORCE_CLOSE(stdoutfd);\n            VIR_FORCE_CLOSE(stdinfd);\n            return -1;\n\n        }\n\n    case -1:\n        return -1;\n\n    default:\n        {\n            int got, exitstatus = 0;\n            int ret;\n            char status;\n\n            VIR_FORCE_CLOSE(statuspipe[1]);\n\n            /* We wait to make sure the first child forked successfully */\n            if ((got = waitpid(pid, &exitstatus, 0)) < 0 ||\n                got != pid ||\n                exitstatus != 0) {\n                return -1;\n            }\n\n            /* Now block until the second child initializes successfully */\n        again:\n            ret = read(statuspipe[0], &status, 1);\n            if (ret == -1 && errno == EINTR)\n                goto again;\n\n            if (ret == 1 && status != 0) {\n                fprintf(stderr,\n                        _(\"%s: error: %s. Check /var/log/messages or run without \"\n                          \"--daemon for more info.\\n\"), argv0,\n                        virDaemonErrTypeToString(status));\n            }\n            _exit(ret == 1 && status == 0 ? 0 : 1);\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"cannot change to root directory: %s\")",
            "g_strerror(errno)"
          ],
          "line": 1026
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 1027
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "\"/\""
          ],
          "line": 1025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonPostExecRestart",
          "args": [
            "state_file",
            "pid_file",
            "&pid_file_fd",
            "privileged",
            "config"
          ],
          "line": 1004
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonPostExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "640-707",
          "snippet": "static int\nvirLogDaemonPostExecRestart(const char *state_file,\n                            const char *pid_file,\n                            int *pid_file_fd,\n                            bool privileged,\n                            virLogDaemonConfigPtr config)\n{\n    const char *gotmagic;\n    char *wantmagic = NULL;\n    int ret = -1;\n    char *state = NULL;\n    virJSONValuePtr object = NULL;\n\n    VIR_DEBUG(\"Running post-restart exec\");\n\n    if (!virFileExists(state_file)) {\n        VIR_DEBUG(\"No restart state file %s present\",\n                  state_file);\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (virFileReadAll(state_file,\n                       1024 * 1024 * 10, /* 10 MB */\n                       &state) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Loading state %s\", state);\n\n    if (!(object = virJSONValueFromString(state)))\n        goto cleanup;\n\n    gotmagic = virJSONValueObjectGetString(object, \"magic\");\n    if (!gotmagic) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing magic data in JSON document\"));\n        goto cleanup;\n    }\n\n    if (!(wantmagic = virLogDaemonGetExecRestartMagic()))\n        goto cleanup;\n\n    if (STRNEQ(gotmagic, wantmagic)) {\n        VIR_WARN(\"Found restart exec file with old magic %s vs wanted %s\",\n                 gotmagic, wantmagic);\n        ret = 0;\n        goto cleanup;\n    }\n\n    /* Re-claim PID file now as we will not be daemonizing */\n    if (pid_file &&\n        (*pid_file_fd = virPidFileAcquirePath(pid_file, false, getpid())) < 0)\n        goto cleanup;\n\n    if (!(logDaemon = virLogDaemonNewPostExecRestart(object,\n                                                     privileged,\n                                                     config)))\n        goto cleanup;\n\n    ret = 1;\n\n cleanup:\n    unlink(state_file);\n    VIR_FREE(wantmagic);\n    VIR_FREE(state);\n    virJSONValueFree(object);\n    return ret;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virLogDaemonPtr logDaemon = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirLogDaemonPtr logDaemon = NULL;\n\nstatic int\nvirLogDaemonPostExecRestart(const char *state_file,\n                            const char *pid_file,\n                            int *pid_file_fd,\n                            bool privileged,\n                            virLogDaemonConfigPtr config)\n{\n    const char *gotmagic;\n    char *wantmagic = NULL;\n    int ret = -1;\n    char *state = NULL;\n    virJSONValuePtr object = NULL;\n\n    VIR_DEBUG(\"Running post-restart exec\");\n\n    if (!virFileExists(state_file)) {\n        VIR_DEBUG(\"No restart state file %s present\",\n                  state_file);\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (virFileReadAll(state_file,\n                       1024 * 1024 * 10, /* 10 MB */\n                       &state) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Loading state %s\", state);\n\n    if (!(object = virJSONValueFromString(state)))\n        goto cleanup;\n\n    gotmagic = virJSONValueObjectGetString(object, \"magic\");\n    if (!gotmagic) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing magic data in JSON document\"));\n        goto cleanup;\n    }\n\n    if (!(wantmagic = virLogDaemonGetExecRestartMagic()))\n        goto cleanup;\n\n    if (STRNEQ(gotmagic, wantmagic)) {\n        VIR_WARN(\"Found restart exec file with old magic %s vs wanted %s\",\n                 gotmagic, wantmagic);\n        ret = 0;\n        goto cleanup;\n    }\n\n    /* Re-claim PID file now as we will not be daemonizing */\n    if (pid_file &&\n        (*pid_file_fd = virPidFileAcquirePath(pid_file, false, getpid())) < 0)\n        goto cleanup;\n\n    if (!(logDaemon = virLogDaemonNewPostExecRestart(object,\n                                                     privileged,\n                                                     config)))\n        goto cleanup;\n\n    ret = 1;\n\n cleanup:\n    unlink(state_file);\n    VIR_FREE(wantmagic);\n    VIR_FREE(state);\n    virJSONValueFree(object);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "old_umask"
          ],
          "line": 1002
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "old_umask"
          ],
          "line": 999
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"unable to create rundir %s: %s\")",
            "run_dir",
            "g_strerror(errno)"
          ],
          "line": 996
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 997
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "run_dir"
          ],
          "line": 995
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Ensuring run dir '%s' exists\"",
            "run_dir"
          ],
          "line": 994
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "077"
          ],
          "line": 993
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "022"
          ],
          "line": 991
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetUserRuntimeDirectory",
          "args": [],
          "line": 987
        },
        "resolved": true,
        "details": {
          "function_name": "virGetUserRuntimeDirectory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "594-601",
          "snippet": "char *virGetUserRuntimeDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_runtime_dir());\n#else\n    return g_build_filename(g_get_user_runtime_dir(), \"libvirt\", NULL);\n#endif\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *virGetUserRuntimeDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_runtime_dir());\n#else\n    return g_build_filename(g_get_user_runtime_dir(), \"libvirt\", NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Decided on restart state file path '%s'\"",
            "state_file"
          ],
          "line": 980
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Can't determine restart state file path\")"
          ],
          "line": 977
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonExecRestartStatePath",
          "args": [
            "privileged",
            "&state_file"
          ],
          "line": 975
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonExecRestartStatePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "604-627",
          "snippet": "static int\nvirLogDaemonExecRestartStatePath(bool privileged,\n                                 char **state_file)\n{\n    if (privileged) {\n        *state_file = g_strdup(RUNSTATEDIR \"/virtlogd-restart-exec.json\");\n    } else {\n        g_autofree char *rundir = NULL;\n        mode_t old_umask;\n\n        rundir = virGetUserRuntimeDirectory();\n\n        old_umask = umask(077);\n        if (virFileMakePath(rundir) < 0) {\n            umask(old_umask);\n            return -1;\n        }\n        umask(old_umask);\n\n        *state_file = g_strdup_printf(\"%s/virtlogd-restart-exec.json\", rundir);\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirLogDaemonExecRestartStatePath(bool privileged,\n                                 char **state_file)\n{\n    if (privileged) {\n        *state_file = g_strdup(RUNSTATEDIR \"/virtlogd-restart-exec.json\");\n    } else {\n        g_autofree char *rundir = NULL;\n        mode_t old_umask;\n\n        rundir = virGetUserRuntimeDirectory();\n\n        old_umask = umask(077);\n        if (virFileMakePath(rundir) < 0) {\n            umask(old_umask);\n            return -1;\n        }\n        umask(old_umask);\n\n        *state_file = g_strdup_printf(\"%s/virtlogd-restart-exec.json\", rundir);\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Decided on socket paths '%s' and '%s'\"",
            "sock_file",
            "admin_sock_file"
          ],
          "line": 972
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Can't determine socket paths\")"
          ],
          "line": 969
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonUnixSocketPaths",
          "args": [
            "privileged",
            "&sock_file",
            "&admin_sock_file"
          ],
          "line": 966
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonUnixSocketPaths",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "385-410",
          "snippet": "static int\nvirLogDaemonUnixSocketPaths(bool privileged,\n                            char **sockfile,\n                            char **adminSockfile)\n{\n    if (privileged) {\n        *sockfile = g_strdup(RUNSTATEDIR \"/libvirt/virtlogd-sock\");\n        *adminSockfile = g_strdup(RUNSTATEDIR \"/libvirt/virtlogd-admin-sock\");\n    } else {\n        g_autofree char *rundir = NULL;\n        mode_t old_umask;\n\n        rundir = virGetUserRuntimeDirectory();\n\n        old_umask = umask(077);\n        if (virFileMakePath(rundir) < 0) {\n            umask(old_umask);\n            return -1;\n        }\n        umask(old_umask);\n\n        *sockfile = g_strdup_printf(\"%s/virtlogd-sock\", rundir);\n        *adminSockfile = g_strdup_printf(\"%s/virtlogd-admin-sock\", rundir);\n    }\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirLogDaemonUnixSocketPaths(bool privileged,\n                            char **sockfile,\n                            char **adminSockfile)\n{\n    if (privileged) {\n        *sockfile = g_strdup(RUNSTATEDIR \"/libvirt/virtlogd-sock\");\n        *adminSockfile = g_strdup(RUNSTATEDIR \"/libvirt/virtlogd-admin-sock\");\n    } else {\n        g_autofree char *rundir = NULL;\n        mode_t old_umask;\n\n        rundir = virGetUserRuntimeDirectory();\n\n        old_umask = umask(077);\n        if (virFileMakePath(rundir) < 0) {\n            umask(old_umask);\n            return -1;\n        }\n        umask(old_umask);\n\n        *sockfile = g_strdup_printf(\"%s/virtlogd-sock\", rundir);\n        *adminSockfile = g_strdup_printf(\"%s/virtlogd-admin-sock\", rundir);\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Decided on pid file path '%s'\"",
            "NULLSTR(pid_file)"
          ],
          "line": 964
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "pid_file"
          ],
          "line": 964
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 962
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Can't determine pid file path.\")"
          ],
          "line": 961
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPidFileConstructPath",
          "args": [
            "privileged",
            "RUNSTATEDIR",
            "\"virtlogd\"",
            "&pid_file"
          ],
          "line": 957
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileConstructPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "469-502",
          "snippet": "int\nvirPidFileConstructPath(bool privileged,\n                        const char *runstatedir,\n                        const char *progname,\n                        char **pidfile)\n{\n    g_autofree char *rundir = NULL;\n\n    if (privileged) {\n        /*\n         * This is here just to allow calling this function with\n         * statedir == NULL; of course only when !privileged.\n         */\n        if (!runstatedir) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"No runstatedir specified\"));\n            return -1;\n        }\n        *pidfile = g_strdup_printf(\"%s/%s.pid\", runstatedir, progname);\n    } else {\n        rundir = virGetUserRuntimeDirectory();\n\n        if (virFileMakePathWithMode(rundir, 0700) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Cannot create user runtime directory '%s'\"),\n                                 rundir);\n            return -1;\n        }\n\n        *pidfile = g_strdup_printf(\"%s/%s.pid\", rundir, progname);\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirPidFileConstructPath(bool privileged,\n                        const char *runstatedir,\n                        const char *progname,\n                        char **pidfile)\n{\n    g_autofree char *rundir = NULL;\n\n    if (privileged) {\n        /*\n         * This is here just to allow calling this function with\n         * statedir == NULL; of course only when !privileged.\n         */\n        if (!runstatedir) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"No runstatedir specified\"));\n            return -1;\n        }\n        *pidfile = g_strdup_printf(\"%s/%s.pid\", runstatedir, progname);\n    } else {\n        rundir = virGetUserRuntimeDirectory();\n\n        if (virFileMakePathWithMode(rundir, 0700) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Cannot create user runtime directory '%s'\"),\n                                 rundir);\n            return -1;\n        }\n\n        *pidfile = g_strdup_printf(\"%s/%s.pid\", rundir, progname);\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogDaemonSetupLogging",
          "args": [
            "config",
            "privileged",
            "verbose",
            "godaemon"
          ],
          "line": 954
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonSetupLogging",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "422-463",
          "snippet": "static void\nvirLogDaemonSetupLogging(virLogDaemonConfigPtr config,\n                         bool privileged,\n                         bool verbose,\n                         bool godaemon)\n{\n    virLogReset();\n\n    /*\n     * Libvirtd's order of precedence is:\n     * cmdline > environment > config\n     *\n     * Given the precedence, we must process the variables in the opposite\n     * order, each one overriding the previous.\n     */\n    if (config->log_level != 0)\n        virLogSetDefaultPriority(config->log_level);\n\n    /* In case the config is empty, both filters and outputs will become empty,\n     * however we can't start with empty outputs, thus we'll need to define and\n     * setup a default one.\n     */\n    ignore_value(virLogSetFilters(config->log_filters));\n    ignore_value(virLogSetOutputs(config->log_outputs));\n\n    /* If there are some environment variables defined, use those instead */\n    virLogSetFromEnv();\n\n    /*\n     * Command line override for --verbose\n     */\n    if ((verbose) && (virLogGetDefaultPriority() > VIR_LOG_INFO))\n        virLogSetDefaultPriority(VIR_LOG_INFO);\n\n    /* Define the default output. This is only applied if there was no setting\n     * from either the config or the environment.\n     */\n    virLogSetDefaultOutput(\"virtlogd\", godaemon, privileged);\n\n    if (virLogGetNbOutputs() == 0)\n        virLogSetOutputs(virLogGetDefaultOutput());\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonSetupLogging(virLogDaemonConfigPtr config,\n                         bool privileged,\n                         bool verbose,\n                         bool godaemon)\n{\n    virLogReset();\n\n    /*\n     * Libvirtd's order of precedence is:\n     * cmdline > environment > config\n     *\n     * Given the precedence, we must process the variables in the opposite\n     * order, each one overriding the previous.\n     */\n    if (config->log_level != 0)\n        virLogSetDefaultPriority(config->log_level);\n\n    /* In case the config is empty, both filters and outputs will become empty,\n     * however we can't start with empty outputs, thus we'll need to define and\n     * setup a default one.\n     */\n    ignore_value(virLogSetFilters(config->log_filters));\n    ignore_value(virLogSetOutputs(config->log_outputs));\n\n    /* If there are some environment variables defined, use those instead */\n    virLogSetFromEnv();\n\n    /*\n     * Command line override for --verbose\n     */\n    if ((verbose) && (virLogGetDefaultPriority() > VIR_LOG_INFO))\n        virLogSetDefaultPriority(VIR_LOG_INFO);\n\n    /* Define the default output. This is only applied if there was no setting\n     * from either the config or the environment.\n     */\n    virLogSetDefaultOutput(\"virtlogd\", godaemon, privileged);\n\n    if (virLogGetNbOutputs() == 0)\n        virLogSetOutputs(virLogGetDefaultOutput());\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 951
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Can't load config file: %s: %s\")",
            "virGetLastErrorMessage()",
            "remote_config_file"
          ],
          "line": 949
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetLastErrorMessage",
          "args": [],
          "line": 950
        },
        "resolved": true,
        "details": {
          "function_name": "virGetLastErrorMessage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "316-325",
          "snippet": "const char *\nvirGetLastErrorMessage(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err && err->code == VIR_ERR_OK)\n        return _(\"no error\");\n    if (!err || !err->message)\n        return _(\"unknown error\");\n    return err->message;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nconst char *\nvirGetLastErrorMessage(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err && err->code == VIR_ERR_OK)\n        return _(\"no error\");\n    if (!err || !err->message)\n        return _(\"unknown error\");\n    return err->message;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogDaemonConfigLoadFile",
          "args": [
            "config",
            "remote_config_file",
            "implicit_conf"
          ],
          "line": 948
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonConfigLoadFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon_config.c",
          "lines": "109-126",
          "snippet": "int\nvirLogDaemonConfigLoadFile(virLogDaemonConfigPtr data,\n                           const char *filename,\n                           bool allow_missing)\n{\n    g_autoptr(virConf) conf = NULL;\n\n    if (allow_missing &&\n        access(filename, R_OK) == -1 &&\n        errno == ENOENT)\n        return 0;\n\n    conf = virConfReadFile(filename, 0);\n    if (!conf)\n        return -1;\n\n    return virLogDaemonConfigLoadOptions(data, conf);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"rpc/virnetserver.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"log_daemon_config.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"rpc/virnetserver.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"log_daemon_config.h\"\n#include <config.h>\n\nint\nvirLogDaemonConfigLoadFile(virLogDaemonConfigPtr data,\n                           const char *filename,\n                           bool allow_missing)\n{\n    g_autoptr(virConf) conf = NULL;\n\n    if (allow_missing &&\n        access(filename, R_OK) == -1 &&\n        errno == ENOENT)\n        return 0;\n\n    conf = virConfReadFile(filename, 0);\n    if (!conf)\n        return -1;\n\n    return virLogDaemonConfigLoadOptions(data, conf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 942
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Can't determine config path\")"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonConfigFilePath",
          "args": [
            "privileged",
            "&remote_config_file"
          ],
          "line": 939
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonConfigFilePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon_config.c",
          "lines": "39-53",
          "snippet": "int\nvirLogDaemonConfigFilePath(bool privileged, char **configfile)\n{\n    if (privileged) {\n        *configfile = g_strdup(SYSCONFDIR \"/libvirt/virtlogd.conf\");\n    } else {\n        g_autofree char *configdir = NULL;\n\n        configdir = virGetUserConfigDirectory();\n\n        *configfile = g_strdup_printf(\"%s/virtlogd.conf\", configdir);\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"rpc/virnetserver.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"log_daemon_config.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"rpc/virnetserver.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"log_daemon_config.h\"\n#include <config.h>\n\nint\nvirLogDaemonConfigFilePath(bool privileged, char **configfile)\n{\n    if (privileged) {\n        *configfile = g_strdup(SYSCONFDIR \"/libvirt/virtlogd.conf\");\n    } else {\n        g_autofree char *configdir = NULL;\n\n        configdir = virGetUserConfigDirectory();\n\n        *configfile = g_strdup_printf(\"%s/virtlogd.conf\", configdir);\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 933
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Can't create initial configuration\")"
          ],
          "line": 932
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonConfigNew",
          "args": [
            "privileged"
          ],
          "line": 931
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonConfigNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon_config.c",
          "lines": "56-70",
          "snippet": "virLogDaemonConfigPtr\nvirLogDaemonConfigNew(bool privileged G_GNUC_UNUSED)\n{\n    virLogDaemonConfigPtr data;\n\n    if (VIR_ALLOC(data) < 0)\n        return NULL;\n\n    data->max_clients = 1024;\n    data->admin_max_clients = 5000;\n    data->max_size = 1024 * 1024 * 2;\n    data->max_backups = 3;\n\n    return data;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"rpc/virnetserver.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"log_daemon_config.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"rpc/virnetserver.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"log_daemon_config.h\"\n#include <config.h>\n\nvirLogDaemonConfigPtr\nvirLogDaemonConfigNew(bool privileged G_GNUC_UNUSED)\n{\n    virLogDaemonConfigPtr data;\n\n    if (VIR_ALLOC(data) < 0)\n        return NULL;\n\n    data->max_clients = 1024;\n    data->admin_max_clients = 5000;\n    data->max_size = 1024 * 1024 * 2;\n    data->max_backups = 3;\n\n    return data;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileActivateDirOverrideForProg",
          "args": [
            "argv[0]"
          ],
          "line": 929
        },
        "resolved": true,
        "details": {
          "function_name": "virFileActivateDirOverrideForProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1788-1800",
          "snippet": "void\nvirFileActivateDirOverrideForProg(const char *argv0)\n{\n    char *file = strrchr(argv0, '/');\n    if (!file || file[1] == '\\0')\n        return;\n    file++;\n    if (STRPREFIX(file, \"lt-\") ||\n        strstr(argv0, \"/.libs/\")) {\n        useDirOverride = true;\n        VIR_DEBUG(\"Activating build dir override for %s\", argv0);\n    }\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool useDirOverride;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic bool useDirOverride;\n\nvoid\nvirFileActivateDirOverrideForProg(const char *argv0)\n{\n    char *file = strrchr(argv0, '/');\n    if (!file || file[1] == '\\0')\n        return;\n    file++;\n    if (STRPREFIX(file, \"lt-\") ||\n        strstr(argv0, \"/.libs/\")) {\n        useDirOverride = true;\n        VIR_DEBUG(\"Activating build dir override for %s\", argv0);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonUsage",
          "args": [
            "argv[0]",
            "privileged"
          ],
          "line": 924
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonUsage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "778-829",
          "snippet": "static void\nvirLogDaemonUsage(const char *argv0, bool privileged)\n{\n    fprintf(stderr,\n            _(\"\\n\"\n              \"Usage:\\n\"\n              \"  %s [options]\\n\"\n              \"\\n\"\n              \"Options:\\n\"\n              \"  -h | --help            Display program help:\\n\"\n              \"  -v | --verbose         Verbose messages.\\n\"\n              \"  -d | --daemon          Run as a daemon & write PID file.\\n\"\n              \"  -t | --timeout <secs>  Exit after timeout period.\\n\"\n              \"  -f | --config <file>   Configuration file.\\n\"\n              \"  -V | --version         Display version information.\\n\"\n              \"  -p | --pid-file <file> Change name of PID file.\\n\"\n              \"\\n\"\n              \"libvirt log management daemon:\\n\"), argv0);\n\n    if (privileged) {\n        fprintf(stderr,\n                _(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      %s/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      %s/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file (unless overridden by -p):\\n\"\n                  \"      %s/virtlogd.pid\\n\"\n                  \"\\n\"),\n                SYSCONFDIR,\n                RUNSTATEDIR,\n                RUNSTATEDIR);\n    } else {\n        fprintf(stderr, \"%s\",\n                _(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      $XDG_CONFIG_HOME/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd.pid\\n\"\n                  \"\\n\"));\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonUsage(const char *argv0, bool privileged)\n{\n    fprintf(stderr,\n            _(\"\\n\"\n              \"Usage:\\n\"\n              \"  %s [options]\\n\"\n              \"\\n\"\n              \"Options:\\n\"\n              \"  -h | --help            Display program help:\\n\"\n              \"  -v | --verbose         Verbose messages.\\n\"\n              \"  -d | --daemon          Run as a daemon & write PID file.\\n\"\n              \"  -t | --timeout <secs>  Exit after timeout period.\\n\"\n              \"  -f | --config <file>   Configuration file.\\n\"\n              \"  -V | --version         Display version information.\\n\"\n              \"  -p | --pid-file <file> Change name of PID file.\\n\"\n              \"\\n\"\n              \"libvirt log management daemon:\\n\"), argv0);\n\n    if (privileged) {\n        fprintf(stderr,\n                _(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      %s/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      %s/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file (unless overridden by -p):\\n\"\n                  \"      %s/virtlogd.pid\\n\"\n                  \"\\n\"),\n                SYSCONFDIR,\n                RUNSTATEDIR,\n                RUNSTATEDIR);\n    } else {\n        fprintf(stderr, \"%s\",\n                _(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      $XDG_CONFIG_HOME/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd.pid\\n\"\n                  \"\\n\"));\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 920
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 916
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonVersion",
          "args": [
            "argv[0]"
          ],
          "line": 915
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonVersion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "468-472",
          "snippet": "static void\nvirLogDaemonVersion(const char *argv0)\n{\n    printf(\"%s (%s) %s\\n\", argv0, PACKAGE_NAME, PACKAGE_VERSION);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonVersion(const char *argv0)\n{\n    printf(\"%s (%s) %s\\n\", argv0, PACKAGE_NAME, PACKAGE_VERSION);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "remote_config_file"
          ],
          "line": 910
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pid_file"
          ],
          "line": 905
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 900
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Invalid value for timeout\")"
          ],
          "line": 899
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrToLong_i",
          "args": [
            "optarg",
            "&tmp",
            "10",
            "&timeout"
          ],
          "line": 895
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "391-407",
          "snippet": "int\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getopt_long",
          "args": [
            "argc",
            "argv",
            "\"df:p:t:vVh\"",
            "opts",
            "&optidx"
          ],
          "line": 878
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 870
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"%s: initialization failed\\n\")",
            "argv[0]"
          ],
          "line": 869
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virErrorInitialize",
          "args": [],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorInitialize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "172-176",
          "snippet": "int\nvirErrorInitialize(void)\n{\n    return virThreadLocalInit(&virLastErr, virLastErrFreeData);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virThreadLocal virLastErr;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirThreadLocal virLastErr;\n\nint\nvirErrorInitialize(void)\n{\n    return virThreadLocalInit(&virLastErr, virLastErrFreeData);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGettextInitialize",
          "args": [],
          "line": 867
        },
        "resolved": true,
        "details": {
          "function_name": "virGettextInitialize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virgettext.c",
          "lines": "39-59",
          "snippet": "int\nvirGettextInitialize(void)\n{\n#if HAVE_LIBINTL_H\n    if (!setlocale(LC_ALL, \"\")) {\n        perror(\"setlocale\");\n        /* failure to setup locale is not fatal */\n    }\n\n    if (!bindtextdomain(PACKAGE, LOCALEDIR)) {\n        perror(\"bindtextdomain\");\n        return -1;\n    }\n\n    if (!textdomain(PACKAGE)) {\n        perror(\"textdomain\");\n        return -1;\n    }\n#endif /* HAVE_LIBINTL_H */\n    return 0;\n}",
          "includes": [
            "#include \"virgettext.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virgettext.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <config.h>\n\nint\nvirGettextInitialize(void)\n{\n#if HAVE_LIBINTL_H\n    if (!setlocale(LC_ALL, \"\")) {\n        perror(\"setlocale\");\n        /* failure to setup locale is not fatal */\n    }\n\n    if (!bindtextdomain(PACKAGE, LOCALEDIR)) {\n        perror(\"bindtextdomain\");\n        return -1;\n    }\n\n    if (!textdomain(PACKAGE)) {\n        perror(\"textdomain\");\n        return -1;\n    }\n#endif /* HAVE_LIBINTL_H */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 865
        },
        "resolved": true,
        "details": {
          "function_name": "geteuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.h",
          "lines": "68-69",
          "snippet": "static inline int geteuid(void)\n{ return 0; }",
          "includes": [
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <unistd.h>\n#include \"internal.h\"\n\nstatic inline int geteuid(void)\n{ return 0; }"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirLogDaemonPtr logDaemon = NULL;\nstatic bool execRestart;\n\nint main(int argc, char **argv) {\n    virNetServerPtr logSrv = NULL;\n    virNetServerPtr adminSrv = NULL;\n    virNetServerProgramPtr logProgram = NULL;\n    virNetServerProgramPtr adminProgram = NULL;\n    char *remote_config_file = NULL;\n    int statuswrite = -1;\n    int ret = 1;\n    int verbose = 0;\n    int godaemon = 0;\n    char *run_dir = NULL;\n    char *pid_file = NULL;\n    int pid_file_fd = -1;\n    char *sock_file = NULL;\n    char *admin_sock_file = NULL;\n    int timeout = -1;        /* -t: Shutdown timeout */\n    char *state_file = NULL;\n    bool implicit_conf = false;\n    mode_t old_umask;\n    bool privileged = false;\n    virLogDaemonConfigPtr config = NULL;\n    int rv;\n\n    struct option opts[] = {\n        { \"verbose\", no_argument, &verbose, 'v'},\n        { \"daemon\", no_argument, &godaemon, 'd'},\n        { \"config\", required_argument, NULL, 'f'},\n        { \"timeout\", required_argument, NULL, 't'},\n        { \"pid-file\", required_argument, NULL, 'p'},\n        { \"version\", no_argument, NULL, 'V' },\n        { \"help\", no_argument, NULL, 'h' },\n        {0, 0, 0, 0}\n    };\n\n    privileged = geteuid() == 0;\n\n    if (virGettextInitialize() < 0 ||\n        virErrorInitialize() < 0) {\n        fprintf(stderr, _(\"%s: initialization failed\\n\"), argv[0]);\n        exit(EXIT_FAILURE);\n    }\n\n    while (1) {\n        int optidx = 0;\n        int c;\n        char *tmp;\n\n        c = getopt_long(argc, argv, \"df:p:t:vVh\", opts, &optidx);\n\n        if (c == -1)\n            break;\n\n        switch (c) {\n        case 0:\n            /* Got one of the flags */\n            break;\n        case 'v':\n            verbose = 1;\n            break;\n        case 'd':\n            godaemon = 1;\n            break;\n\n        case 't':\n            if (virStrToLong_i(optarg, &tmp, 10, &timeout) != 0\n                || timeout <= 0\n                /* Ensure that we can multiply by 1000 without overflowing.  */\n                || timeout > INT_MAX / 1000) {\n                VIR_ERROR(_(\"Invalid value for timeout\"));\n                exit(EXIT_FAILURE);\n            }\n            break;\n\n        case 'p':\n            VIR_FREE(pid_file);\n            pid_file = g_strdup(optarg);\n            break;\n\n        case 'f':\n            VIR_FREE(remote_config_file);\n            remote_config_file = g_strdup(optarg);\n            break;\n\n        case 'V':\n            virLogDaemonVersion(argv[0]);\n            exit(EXIT_SUCCESS);\n\n        case 'h':\n            virLogDaemonUsage(argv[0], privileged);\n            exit(EXIT_SUCCESS);\n\n        case '?':\n        default:\n            virLogDaemonUsage(argv[0], privileged);\n            exit(EXIT_FAILURE);\n        }\n    }\n\n    virFileActivateDirOverrideForProg(argv[0]);\n\n    if (!(config = virLogDaemonConfigNew(privileged))) {\n        VIR_ERROR(_(\"Can't create initial configuration\"));\n        exit(EXIT_FAILURE);\n    }\n\n    /* No explicit config, so try and find a default one */\n    if (remote_config_file == NULL) {\n        implicit_conf = true;\n        if (virLogDaemonConfigFilePath(privileged,\n                                       &remote_config_file) < 0) {\n            VIR_ERROR(_(\"Can't determine config path\"));\n            exit(EXIT_FAILURE);\n        }\n    }\n\n    /* Read the config file if it exists */\n    if (remote_config_file &&\n        virLogDaemonConfigLoadFile(config, remote_config_file, implicit_conf) < 0) {\n        VIR_ERROR(_(\"Can't load config file: %s: %s\"),\n                  virGetLastErrorMessage(), remote_config_file);\n        exit(EXIT_FAILURE);\n    }\n\n    virLogDaemonSetupLogging(config, privileged, verbose, godaemon);\n\n    if (!pid_file &&\n        virPidFileConstructPath(privileged,\n                                RUNSTATEDIR,\n                                \"virtlogd\",\n                                &pid_file) < 0) {\n        VIR_ERROR(_(\"Can't determine pid file path.\"));\n        exit(EXIT_FAILURE);\n    }\n    VIR_DEBUG(\"Decided on pid file path '%s'\", NULLSTR(pid_file));\n\n    if (virLogDaemonUnixSocketPaths(privileged,\n                                    &sock_file,\n                                    &admin_sock_file) < 0) {\n        VIR_ERROR(_(\"Can't determine socket paths\"));\n        exit(EXIT_FAILURE);\n    }\n    VIR_DEBUG(\"Decided on socket paths '%s' and '%s'\",\n              sock_file, admin_sock_file);\n\n    if (virLogDaemonExecRestartStatePath(privileged,\n                                         &state_file) < 0) {\n        VIR_ERROR(_(\"Can't determine restart state file path\"));\n        exit(EXIT_FAILURE);\n    }\n    VIR_DEBUG(\"Decided on restart state file path '%s'\",\n              state_file);\n\n    /* Ensure the rundir exists (on tmpfs on some systems) */\n    if (privileged) {\n        run_dir = g_strdup(RUNSTATEDIR \"/libvirt\");\n    } else {\n        run_dir = virGetUserRuntimeDirectory();\n    }\n\n    if (privileged)\n        old_umask = umask(022);\n    else\n        old_umask = umask(077);\n    VIR_DEBUG(\"Ensuring run dir '%s' exists\", run_dir);\n    if (virFileMakePath(run_dir) < 0) {\n        VIR_ERROR(_(\"unable to create rundir %s: %s\"), run_dir,\n                  g_strerror(errno));\n        ret = VIR_LOG_DAEMON_ERR_RUNDIR;\n        umask(old_umask);\n        goto cleanup;\n    }\n    umask(old_umask);\n\n    if ((rv = virLogDaemonPostExecRestart(state_file,\n                                          pid_file,\n                                          &pid_file_fd,\n                                          privileged,\n                                          config)) < 0) {\n        ret = VIR_LOG_DAEMON_ERR_INIT;\n        goto cleanup;\n    }\n\n    /* rv == 1, means we setup everything from saved state,\n     * so only (possibly) daemonize and setup stuff from\n     * scratch if rv == 0\n     */\n    if (rv == 0) {\n        g_autoptr(virSystemdActivation) act = NULL;\n        virSystemdActivationMap actmap[] = {\n            { .name = \"virtlogd.socket\", .family = AF_UNIX, .path = sock_file },\n            { .name = \"virtlogd-admin.socket\", .family = AF_UNIX, .path = admin_sock_file },\n        };\n\n        if (godaemon) {\n            if (chdir(\"/\") < 0) {\n                VIR_ERROR(_(\"cannot change to root directory: %s\"),\n                          g_strerror(errno));\n                goto cleanup;\n            }\n\n            if ((statuswrite = virLogDaemonForkIntoBackground(argv[0])) < 0) {\n                VIR_ERROR(_(\"Failed to fork as daemon: %s\"),\n                          g_strerror(errno));\n                goto cleanup;\n            }\n        }\n\n        /* If we have a pidfile set, claim it now, exiting if already taken */\n        if ((pid_file_fd = virPidFileAcquirePath(pid_file, false, getpid())) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_PIDFILE;\n            goto cleanup;\n        }\n\n        if (!(logDaemon = virLogDaemonNew(config, privileged))) {\n            ret = VIR_LOG_DAEMON_ERR_INIT;\n            goto cleanup;\n        }\n\n        if (virSystemdGetActivation(actmap,\n                                    G_N_ELEMENTS(actmap),\n                                    &act) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_NETWORK;\n            goto cleanup;\n        }\n\n        logSrv = virNetDaemonGetServer(logDaemon->dmn, \"virtlogd\");\n        adminSrv = virNetDaemonGetServer(logDaemon->dmn, \"admin\");\n\n        if (virNetServerAddServiceUNIX(logSrv,\n                                       act, \"virtlogd.socket\",\n                                       sock_file, 0700, 0, 0,\n                                       NULL,\n                                       false, 0, 1) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_NETWORK;\n            goto cleanup;\n        }\n        if (virNetServerAddServiceUNIX(adminSrv,\n                                       act, \"virtlogd-admin.socket\",\n                                       admin_sock_file, 0700, 0, 0,\n                                       NULL,\n                                       false, 0, 1) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_NETWORK;\n            goto cleanup;\n        }\n\n        if (act &&\n            virSystemdActivationComplete(act) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_NETWORK;\n            goto cleanup;\n        }\n    } else {\n        logSrv = virNetDaemonGetServer(logDaemon->dmn, \"virtlogd\");\n        /* If exec-restarting from old virtlogd, we won't have an\n         * admin server present */\n        if (virNetDaemonHasServer(logDaemon->dmn, \"admin\"))\n            adminSrv = virNetDaemonGetServer(logDaemon->dmn, \"admin\");\n    }\n\n    if (timeout != -1) {\n        VIR_DEBUG(\"Registering shutdown timeout %d\", timeout);\n        virNetDaemonAutoShutdown(logDaemon->dmn,\n                                 timeout);\n    }\n\n    if ((virLogDaemonSetupSignals(logDaemon->dmn)) < 0) {\n        ret = VIR_LOG_DAEMON_ERR_SIGNAL;\n        goto cleanup;\n    }\n\n    if (!(logProgram = virNetServerProgramNew(VIR_LOG_MANAGER_PROTOCOL_PROGRAM,\n                                              VIR_LOG_MANAGER_PROTOCOL_PROGRAM_VERSION,\n                                              virLogManagerProtocolProcs,\n                                              virLogManagerProtocolNProcs))) {\n        ret = VIR_LOG_DAEMON_ERR_INIT;\n        goto cleanup;\n    }\n    if (virNetServerAddProgram(logSrv, logProgram) < 0) {\n        ret = VIR_LOG_DAEMON_ERR_INIT;\n        goto cleanup;\n    }\n\n    if (adminSrv != NULL) {\n        if (!(adminProgram = virNetServerProgramNew(ADMIN_PROGRAM,\n                                                    ADMIN_PROTOCOL_VERSION,\n                                                    adminProcs,\n                                                    adminNProcs))) {\n            ret = VIR_LOG_DAEMON_ERR_INIT;\n            goto cleanup;\n        }\n        if (virNetServerAddProgram(adminSrv, adminProgram) < 0) {\n            ret = VIR_LOG_DAEMON_ERR_INIT;\n            goto cleanup;\n        }\n    }\n\n    /* Disable error func, now logging is setup */\n    virSetErrorFunc(NULL, virLogDaemonErrorHandler);\n\n    /* Tell parent of daemon that basic initialization is complete\n     * In particular we're ready to accept net connections & have\n     * written the pidfile\n     */\n    if (statuswrite != -1) {\n        char status = 0;\n        while (write(statuswrite, &status, 1) == -1 &&\n               errno == EINTR)\n            ;\n        VIR_FORCE_CLOSE(statuswrite);\n    }\n\n    /* Start accepting new clients from network */\n\n    virNetDaemonUpdateServices(logDaemon->dmn, true);\n    virNetDaemonRun(logDaemon->dmn);\n\n    if (execRestart &&\n        virLogDaemonPreExecRestart(state_file,\n                                   logDaemon->dmn,\n                                   argv) < 0)\n        ret = VIR_LOG_DAEMON_ERR_REEXEC;\n    else\n        ret = 0;\n\n cleanup:\n    virObjectUnref(logProgram);\n    virObjectUnref(adminProgram);\n    virObjectUnref(logSrv);\n    virObjectUnref(adminSrv);\n    virLogDaemonFree(logDaemon);\n    if (statuswrite != -1) {\n        if (ret != 0) {\n            /* Tell parent of daemon what failed */\n            char status = ret;\n            while (write(statuswrite, &status, 1) == -1 &&\n                   errno == EINTR)\n                ;\n        }\n        VIR_FORCE_CLOSE(statuswrite);\n    }\n    if (pid_file_fd != -1)\n        virPidFileReleasePath(pid_file, pid_file_fd);\n    VIR_FREE(pid_file);\n    VIR_FREE(sock_file);\n    VIR_FREE(admin_sock_file);\n    VIR_FREE(state_file);\n    VIR_FREE(run_dir);\n    VIR_FREE(remote_config_file);\n    virLogDaemonConfigFree(config);\n    return ret;\n}"
  },
  {
    "function_name": "virLogDaemonUsage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "778-829",
    "snippet": "static void\nvirLogDaemonUsage(const char *argv0, bool privileged)\n{\n    fprintf(stderr,\n            _(\"\\n\"\n              \"Usage:\\n\"\n              \"  %s [options]\\n\"\n              \"\\n\"\n              \"Options:\\n\"\n              \"  -h | --help            Display program help:\\n\"\n              \"  -v | --verbose         Verbose messages.\\n\"\n              \"  -d | --daemon          Run as a daemon & write PID file.\\n\"\n              \"  -t | --timeout <secs>  Exit after timeout period.\\n\"\n              \"  -f | --config <file>   Configuration file.\\n\"\n              \"  -V | --version         Display version information.\\n\"\n              \"  -p | --pid-file <file> Change name of PID file.\\n\"\n              \"\\n\"\n              \"libvirt log management daemon:\\n\"), argv0);\n\n    if (privileged) {\n        fprintf(stderr,\n                _(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      %s/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      %s/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file (unless overridden by -p):\\n\"\n                  \"      %s/virtlogd.pid\\n\"\n                  \"\\n\"),\n                SYSCONFDIR,\n                RUNSTATEDIR,\n                RUNSTATEDIR);\n    } else {\n        fprintf(stderr, \"%s\",\n                _(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      $XDG_CONFIG_HOME/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd.pid\\n\"\n                  \"\\n\"));\n    }\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s\"",
            "_(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      $XDG_CONFIG_HOME/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd.pid\\n\"\n                  \"\\n\")"
          ],
          "line": 815
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      $XDG_CONFIG_HOME/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd.pid\\n\"\n                  \"\\n\""
          ],
          "line": 816
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      %s/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      %s/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file (unless overridden by -p):\\n\"\n                  \"      %s/virtlogd.pid\\n\"\n                  \"\\n\")",
            "SYSCONFDIR",
            "RUNSTATEDIR",
            "RUNSTATEDIR"
          ],
          "line": 798
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"\\n\"\n              \"Usage:\\n\"\n              \"  %s [options]\\n\"\n              \"\\n\"\n              \"Options:\\n\"\n              \"  -h | --help            Display program help:\\n\"\n              \"  -v | --verbose         Verbose messages.\\n\"\n              \"  -d | --daemon          Run as a daemon & write PID file.\\n\"\n              \"  -t | --timeout <secs>  Exit after timeout period.\\n\"\n              \"  -f | --config <file>   Configuration file.\\n\"\n              \"  -V | --version         Display version information.\\n\"\n              \"  -p | --pid-file <file> Change name of PID file.\\n\"\n              \"\\n\"\n              \"libvirt log management daemon:\\n\")",
            "argv0"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonUsage(const char *argv0, bool privileged)\n{\n    fprintf(stderr,\n            _(\"\\n\"\n              \"Usage:\\n\"\n              \"  %s [options]\\n\"\n              \"\\n\"\n              \"Options:\\n\"\n              \"  -h | --help            Display program help:\\n\"\n              \"  -v | --verbose         Verbose messages.\\n\"\n              \"  -d | --daemon          Run as a daemon & write PID file.\\n\"\n              \"  -t | --timeout <secs>  Exit after timeout period.\\n\"\n              \"  -f | --config <file>   Configuration file.\\n\"\n              \"  -V | --version         Display version information.\\n\"\n              \"  -p | --pid-file <file> Change name of PID file.\\n\"\n              \"\\n\"\n              \"libvirt log management daemon:\\n\"), argv0);\n\n    if (privileged) {\n        fprintf(stderr,\n                _(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      %s/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      %s/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file (unless overridden by -p):\\n\"\n                  \"      %s/virtlogd.pid\\n\"\n                  \"\\n\"),\n                SYSCONFDIR,\n                RUNSTATEDIR,\n                RUNSTATEDIR);\n    } else {\n        fprintf(stderr, \"%s\",\n                _(\"\\n\"\n                  \"  Default paths:\\n\"\n                  \"\\n\"\n                  \"    Configuration file (unless overridden by -f):\\n\"\n                  \"      $XDG_CONFIG_HOME/libvirt/virtlogd.conf\\n\"\n                  \"\\n\"\n                  \"    Sockets:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd-sock\\n\"\n                  \"\\n\"\n                  \"    PID file:\\n\"\n                  \"      $XDG_RUNTIME_DIR/libvirt/virtlogd.pid\\n\"\n                  \"\\n\"));\n    }\n}"
  },
  {
    "function_name": "virLogDaemonPreExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "710-775",
    "snippet": "static int\nvirLogDaemonPreExecRestart(const char *state_file,\n                           virNetDaemonPtr dmn,\n                           char **argv)\n{\n    virJSONValuePtr child;\n    char *state = NULL;\n    int ret = -1;\n    virJSONValuePtr object = virJSONValueNewObject();\n    char *magic;\n    virHashKeyValuePairPtr pairs = NULL;\n\n    VIR_DEBUG(\"Running pre-restart exec\");\n\n    if (!(child = virNetDaemonPreExecRestart(dmn)))\n        goto cleanup;\n\n    if (virJSONValueObjectAppend(object, \"daemon\", child) < 0) {\n        virJSONValueFree(child);\n        goto cleanup;\n    }\n\n    if (!(magic = virLogDaemonGetExecRestartMagic()))\n        goto cleanup;\n\n    if (virJSONValueObjectAppendString(object, \"magic\", magic) < 0) {\n        VIR_FREE(magic);\n        goto cleanup;\n    }\n\n    if (!(child = virLogHandlerPreExecRestart(logDaemon->handler)))\n        goto cleanup;\n\n    if (virJSONValueObjectAppend(object, \"handler\", child) < 0) {\n        virJSONValueFree(child);\n        goto cleanup;\n    }\n\n\n    if (!(state = virJSONValueToString(object, true)))\n        goto cleanup;\n\n    VIR_DEBUG(\"Saving state %s\", state);\n\n    if (virFileWriteStr(state_file,\n                        state, 0700) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to save state file %s\"),\n                             state_file);\n        goto cleanup;\n    }\n\n    if (execvp(argv[0], argv) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to restart self\"));\n        goto cleanup;\n    }\n\n    abort(); /* This should be impossible to reach */\n\n cleanup:\n    VIR_FREE(pairs);\n    VIR_FREE(state);\n    virJSONValueFree(object);\n    return ret;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virLogDaemonPtr logDaemon = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "object"
          ],
          "line": 773
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "state"
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pairs"
          ],
          "line": 771
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "abort",
          "args": [],
          "line": 768
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to restart self\")"
          ],
          "line": 763
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to restart self\""
          ],
          "line": 764
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "execvp",
          "args": [
            "argv[0]",
            "argv"
          ],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to save state file %s\")",
            "state_file"
          ],
          "line": 756
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileWriteStr",
          "args": [
            "state_file",
            "state",
            "0700"
          ],
          "line": 754
        },
        "resolved": true,
        "details": {
          "function_name": "virFileWriteStr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1502-1524",
          "snippet": "int\nvirFileWriteStr(const char *path, const char *str, mode_t mode)\n{\n    int fd;\n\n    if (mode)\n        fd = open(path, O_WRONLY|O_TRUNC|O_CREAT, mode);\n    else\n        fd = open(path, O_WRONLY|O_TRUNC);\n    if (fd == -1)\n        return -1;\n\n    if (safewrite(fd, str, strlen(str)) < 0) {\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    /* Use errno from failed close only if there was no write error.  */\n    if (VIR_CLOSE(fd) != 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileWriteStr(const char *path, const char *str, mode_t mode)\n{\n    int fd;\n\n    if (mode)\n        fd = open(path, O_WRONLY|O_TRUNC|O_CREAT, mode);\n    else\n        fd = open(path, O_WRONLY|O_TRUNC);\n    if (fd == -1)\n        return -1;\n\n    if (safewrite(fd, str, strlen(str)) < 0) {\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    /* Use errno from failed close only if there was no write error.  */\n    if (VIR_CLOSE(fd) != 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Saving state %s\"",
            "state"
          ],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueToString",
          "args": [
            "object",
            "true"
          ],
          "line": 749
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueToString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "2014-2024",
          "snippet": "char *\nvirJSONValueToString(virJSONValuePtr object,\n                     bool pretty)\n{\n    g_auto(virBuffer) buf = VIR_BUFFER_INITIALIZER;\n\n    if (virJSONValueToBuffer(object, &buf, pretty) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nchar *\nvirJSONValueToString(virJSONValuePtr object,\n                     bool pretty)\n{\n    g_auto(virBuffer) buf = VIR_BUFFER_INITIALIZER;\n\n    if (virJSONValueToBuffer(object, &buf, pretty) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppend",
          "args": [
            "object",
            "\"handler\"",
            "child"
          ],
          "line": 743
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendBoolean",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "741-754",
          "snippet": "int\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerPreExecRestart",
          "args": [
            "logDaemon->handler"
          ],
          "line": 740
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerPreExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "610-665",
          "snippet": "virJSONValuePtr\nvirLogHandlerPreExecRestart(virLogHandlerPtr handler)\n{\n    virJSONValuePtr ret = virJSONValueNewObject();\n    virJSONValuePtr files;\n    size_t i;\n    char domuuid[VIR_UUID_STRING_BUFLEN];\n\n    files = virJSONValueNewArray();\n\n    if (virJSONValueObjectAppend(ret, \"files\", files) < 0) {\n        virJSONValueFree(files);\n        goto error;\n    }\n\n    for (i = 0; i < handler->nfiles; i++) {\n        virJSONValuePtr file = virJSONValueNewObject();\n\n        if (virJSONValueArrayAppend(files, file) < 0) {\n            virJSONValueFree(file);\n            goto error;\n        }\n\n        if (virJSONValueObjectAppendNumberInt(file, \"pipefd\",\n                                              handler->files[i]->pipefd) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"path\",\n                                           virRotatingFileWriterGetPath(handler->files[i]->file)) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"driver\",\n                                           handler->files[i]->driver) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"domname\",\n                                           handler->files[i]->domname) < 0)\n            goto error;\n\n        virUUIDFormat(handler->files[i]->domuuid, domuuid);\n        if (virJSONValueObjectAppendString(file, \"domuuid\", domuuid) < 0)\n            goto error;\n\n        if (virSetInherit(handler->files[i]->pipefd, true) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Cannot disable close-on-exec flag\"));\n            goto error;\n        }\n    }\n\n    return ret;\n\n error:\n    virJSONValueFree(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirLogHandlerPreExecRestart(virLogHandlerPtr handler)\n{\n    virJSONValuePtr ret = virJSONValueNewObject();\n    virJSONValuePtr files;\n    size_t i;\n    char domuuid[VIR_UUID_STRING_BUFLEN];\n\n    files = virJSONValueNewArray();\n\n    if (virJSONValueObjectAppend(ret, \"files\", files) < 0) {\n        virJSONValueFree(files);\n        goto error;\n    }\n\n    for (i = 0; i < handler->nfiles; i++) {\n        virJSONValuePtr file = virJSONValueNewObject();\n\n        if (virJSONValueArrayAppend(files, file) < 0) {\n            virJSONValueFree(file);\n            goto error;\n        }\n\n        if (virJSONValueObjectAppendNumberInt(file, \"pipefd\",\n                                              handler->files[i]->pipefd) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"path\",\n                                           virRotatingFileWriterGetPath(handler->files[i]->file)) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"driver\",\n                                           handler->files[i]->driver) < 0)\n            goto error;\n\n        if (virJSONValueObjectAppendString(file, \"domname\",\n                                           handler->files[i]->domname) < 0)\n            goto error;\n\n        virUUIDFormat(handler->files[i]->domuuid, domuuid);\n        if (virJSONValueObjectAppendString(file, \"domuuid\", domuuid) < 0)\n            goto error;\n\n        if (virSetInherit(handler->files[i]->pipefd, true) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Cannot disable close-on-exec flag\"));\n            goto error;\n        }\n    }\n\n    return ret;\n\n error:\n    virJSONValueFree(ret);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "magic"
          ],
          "line": 736
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendString",
          "args": [
            "object",
            "\"magic\"",
            "magic"
          ],
          "line": 735
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "643-649",
          "snippet": "int\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogDaemonGetExecRestartMagic",
          "args": [],
          "line": 732
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonGetExecRestartMagic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "630-637",
          "snippet": "static char *\nvirLogDaemonGetExecRestartMagic(void)\n{\n    char *ret;\n\n    ret = g_strdup_printf(\"%lld\", (long long int)getpid());\n    return ret;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic char *\nvirLogDaemonGetExecRestartMagic(void)\n{\n    char *ret;\n\n    ret = g_strdup_printf(\"%lld\", (long long int)getpid());\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonPreExecRestart",
          "args": [
            "dmn"
          ],
          "line": 724
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonPreExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "381-426",
          "snippet": "virJSONValuePtr\nvirNetDaemonPreExecRestart(virNetDaemonPtr dmn)\n{\n    size_t i = 0;\n    virJSONValuePtr object = virJSONValueNewObject();\n    virJSONValuePtr srvObj = virJSONValueNewObject();\n    virHashKeyValuePairPtr srvArray = NULL;\n\n    virObjectLock(dmn);\n\n    if (virJSONValueObjectAppend(object, \"servers\", srvObj) < 0) {\n        virJSONValueFree(srvObj);\n        goto error;\n    }\n\n    if (!(srvArray = virHashGetItems(dmn->servers, daemonServerCompare)))\n        goto error;\n\n    for (i = 0; srvArray[i].key; i++) {\n        virNetServerPtr server = virHashLookup(dmn->servers, srvArray[i].key);\n        virJSONValuePtr srvJSON;\n\n        if (!server)\n            goto error;\n\n        srvJSON = virNetServerPreExecRestart(server);\n        if (!srvJSON)\n            goto error;\n\n        if (virJSONValueObjectAppend(srvObj, srvArray[i].key, srvJSON) < 0) {\n            virJSONValueFree(srvJSON);\n            goto error;\n        }\n    }\n\n    VIR_FREE(srvArray);\n    virObjectUnlock(dmn);\n\n    return object;\n\n error:\n    VIR_FREE(srvArray);\n    virJSONValueFree(object);\n    virObjectUnlock(dmn);\n    return NULL;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirJSONValuePtr\nvirNetDaemonPreExecRestart(virNetDaemonPtr dmn)\n{\n    size_t i = 0;\n    virJSONValuePtr object = virJSONValueNewObject();\n    virJSONValuePtr srvObj = virJSONValueNewObject();\n    virHashKeyValuePairPtr srvArray = NULL;\n\n    virObjectLock(dmn);\n\n    if (virJSONValueObjectAppend(object, \"servers\", srvObj) < 0) {\n        virJSONValueFree(srvObj);\n        goto error;\n    }\n\n    if (!(srvArray = virHashGetItems(dmn->servers, daemonServerCompare)))\n        goto error;\n\n    for (i = 0; srvArray[i].key; i++) {\n        virNetServerPtr server = virHashLookup(dmn->servers, srvArray[i].key);\n        virJSONValuePtr srvJSON;\n\n        if (!server)\n            goto error;\n\n        srvJSON = virNetServerPreExecRestart(server);\n        if (!srvJSON)\n            goto error;\n\n        if (virJSONValueObjectAppend(srvObj, srvArray[i].key, srvJSON) < 0) {\n            virJSONValueFree(srvJSON);\n            goto error;\n        }\n    }\n\n    VIR_FREE(srvArray);\n    virObjectUnlock(dmn);\n\n    return object;\n\n error:\n    VIR_FREE(srvArray);\n    virJSONValueFree(object);\n    virObjectUnlock(dmn);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Running pre-restart exec\""
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueNewObject",
          "args": [],
          "line": 718
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "571-579",
          "snippet": "virJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirLogDaemonPtr logDaemon = NULL;\n\nstatic int\nvirLogDaemonPreExecRestart(const char *state_file,\n                           virNetDaemonPtr dmn,\n                           char **argv)\n{\n    virJSONValuePtr child;\n    char *state = NULL;\n    int ret = -1;\n    virJSONValuePtr object = virJSONValueNewObject();\n    char *magic;\n    virHashKeyValuePairPtr pairs = NULL;\n\n    VIR_DEBUG(\"Running pre-restart exec\");\n\n    if (!(child = virNetDaemonPreExecRestart(dmn)))\n        goto cleanup;\n\n    if (virJSONValueObjectAppend(object, \"daemon\", child) < 0) {\n        virJSONValueFree(child);\n        goto cleanup;\n    }\n\n    if (!(magic = virLogDaemonGetExecRestartMagic()))\n        goto cleanup;\n\n    if (virJSONValueObjectAppendString(object, \"magic\", magic) < 0) {\n        VIR_FREE(magic);\n        goto cleanup;\n    }\n\n    if (!(child = virLogHandlerPreExecRestart(logDaemon->handler)))\n        goto cleanup;\n\n    if (virJSONValueObjectAppend(object, \"handler\", child) < 0) {\n        virJSONValueFree(child);\n        goto cleanup;\n    }\n\n\n    if (!(state = virJSONValueToString(object, true)))\n        goto cleanup;\n\n    VIR_DEBUG(\"Saving state %s\", state);\n\n    if (virFileWriteStr(state_file,\n                        state, 0700) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to save state file %s\"),\n                             state_file);\n        goto cleanup;\n    }\n\n    if (execvp(argv[0], argv) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to restart self\"));\n        goto cleanup;\n    }\n\n    abort(); /* This should be impossible to reach */\n\n cleanup:\n    VIR_FREE(pairs);\n    VIR_FREE(state);\n    virJSONValueFree(object);\n    return ret;\n}"
  },
  {
    "function_name": "virLogDaemonPostExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "640-707",
    "snippet": "static int\nvirLogDaemonPostExecRestart(const char *state_file,\n                            const char *pid_file,\n                            int *pid_file_fd,\n                            bool privileged,\n                            virLogDaemonConfigPtr config)\n{\n    const char *gotmagic;\n    char *wantmagic = NULL;\n    int ret = -1;\n    char *state = NULL;\n    virJSONValuePtr object = NULL;\n\n    VIR_DEBUG(\"Running post-restart exec\");\n\n    if (!virFileExists(state_file)) {\n        VIR_DEBUG(\"No restart state file %s present\",\n                  state_file);\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (virFileReadAll(state_file,\n                       1024 * 1024 * 10, /* 10 MB */\n                       &state) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Loading state %s\", state);\n\n    if (!(object = virJSONValueFromString(state)))\n        goto cleanup;\n\n    gotmagic = virJSONValueObjectGetString(object, \"magic\");\n    if (!gotmagic) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing magic data in JSON document\"));\n        goto cleanup;\n    }\n\n    if (!(wantmagic = virLogDaemonGetExecRestartMagic()))\n        goto cleanup;\n\n    if (STRNEQ(gotmagic, wantmagic)) {\n        VIR_WARN(\"Found restart exec file with old magic %s vs wanted %s\",\n                 gotmagic, wantmagic);\n        ret = 0;\n        goto cleanup;\n    }\n\n    /* Re-claim PID file now as we will not be daemonizing */\n    if (pid_file &&\n        (*pid_file_fd = virPidFileAcquirePath(pid_file, false, getpid())) < 0)\n        goto cleanup;\n\n    if (!(logDaemon = virLogDaemonNewPostExecRestart(object,\n                                                     privileged,\n                                                     config)))\n        goto cleanup;\n\n    ret = 1;\n\n cleanup:\n    unlink(state_file);\n    VIR_FREE(wantmagic);\n    VIR_FREE(state);\n    virJSONValueFree(object);\n    return ret;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virLogDaemonPtr logDaemon = NULL;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "object"
          ],
          "line": 705
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "state"
          ],
          "line": 704
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "wantmagic"
          ],
          "line": 703
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "state_file"
          ],
          "line": 702
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonNewPostExecRestart",
          "args": [
            "object",
            "privileged",
            "config"
          ],
          "line": 694
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonNewPostExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "244-294",
          "snippet": "static virLogDaemonPtr\nvirLogDaemonNewPostExecRestart(virJSONValuePtr object, bool privileged,\n                               virLogDaemonConfigPtr config)\n{\n    virLogDaemonPtr logd;\n    virJSONValuePtr child;\n    const char *serverNames[] = { \"virtlogd\" };\n\n    if (VIR_ALLOC(logd) < 0)\n        return NULL;\n\n    if (virMutexInit(&logd->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        VIR_FREE(logd);\n        return NULL;\n    }\n\n    if (!(child = virJSONValueObjectGet(object, \"daemon\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed daemon data from JSON file\"));\n        goto error;\n    }\n\n    if (!(logd->dmn = virNetDaemonNewPostExecRestart(child,\n                                                     G_N_ELEMENTS(serverNames),\n                                                     serverNames,\n                                                     virLogDaemonNewServerPostExecRestart,\n                                                     (void*)(intptr_t)(privileged ? 0x1 : 0x0))))\n        goto error;\n\n    if (!(child = virJSONValueObjectGet(object, \"handler\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed daemon data from JSON file\"));\n        goto error;\n    }\n\n    if (!(logd->handler = virLogHandlerNewPostExecRestart(child,\n                                                          privileged,\n                                                          config->max_size,\n                                                          config->max_backups,\n                                                          virLogDaemonInhibitor,\n                                                          logd)))\n        goto error;\n\n    return logd;\n\n error:\n    virLogDaemonFree(logd);\n    return NULL;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virLogDaemonPtr\nvirLogDaemonNewPostExecRestart(virJSONValuePtr object, bool privileged,\n                               virLogDaemonConfigPtr config)\n{\n    virLogDaemonPtr logd;\n    virJSONValuePtr child;\n    const char *serverNames[] = { \"virtlogd\" };\n\n    if (VIR_ALLOC(logd) < 0)\n        return NULL;\n\n    if (virMutexInit(&logd->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        VIR_FREE(logd);\n        return NULL;\n    }\n\n    if (!(child = virJSONValueObjectGet(object, \"daemon\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed daemon data from JSON file\"));\n        goto error;\n    }\n\n    if (!(logd->dmn = virNetDaemonNewPostExecRestart(child,\n                                                     G_N_ELEMENTS(serverNames),\n                                                     serverNames,\n                                                     virLogDaemonNewServerPostExecRestart,\n                                                     (void*)(intptr_t)(privileged ? 0x1 : 0x0))))\n        goto error;\n\n    if (!(child = virJSONValueObjectGet(object, \"handler\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed daemon data from JSON file\"));\n        goto error;\n    }\n\n    if (!(logd->handler = virLogHandlerNewPostExecRestart(child,\n                                                          privileged,\n                                                          config->max_size,\n                                                          config->max_backups,\n                                                          virLogDaemonInhibitor,\n                                                          logd)))\n        goto error;\n\n    return logd;\n\n error:\n    virLogDaemonFree(logd);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPidFileAcquirePath",
          "args": [
            "pid_file",
            "false",
            "getpid()"
          ],
          "line": 691
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileAcquirePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "330-410",
          "snippet": "int virPidFileAcquirePath(const char *path,\n                          bool waitForLock,\n                          pid_t pid)\n{\n    int fd = -1;\n    char pidstr[VIR_INT64_STR_BUFLEN];\n\n    if (path[0] == '\\0')\n        return 0;\n\n    while (1) {\n        struct stat a, b;\n        if ((fd = open(path, O_WRONLY|O_CREAT, 0644)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to open pid file '%s'\"),\n                                 path);\n            return -1;\n        }\n\n        if (virSetCloseExec(fd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to set close-on-exec flag '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        if (fstat(fd, &b) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to check status of pid file '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        if (virFileLock(fd, false, 0, 1, waitForLock) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to acquire pid file '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        /* Now make sure the pidfile we locked is the same\n         * one that now exists on the filesystem\n         */\n        if (stat(path, &a) < 0) {\n            VIR_DEBUG(\"Pid file '%s' disappeared: %s\",\n                      path, g_strerror(errno));\n            VIR_FORCE_CLOSE(fd);\n            /* Someone else must be racing with us, so try again */\n            continue;\n        }\n\n        if (a.st_ino == b.st_ino)\n            break;\n\n        VIR_DEBUG(\"Pid file '%s' was recreated\", path);\n        VIR_FORCE_CLOSE(fd);\n        /* Someone else must be racing with us, so try again */\n    }\n\n    g_snprintf(pidstr, sizeof(pidstr), \"%lld\", (long long) pid);\n\n    if (ftruncate(fd, 0) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to truncate pid file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    if (safewrite(fd, pidstr, strlen(pidstr)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to write to pid file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n    }\n\n    return fd;\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileAcquirePath(const char *path,\n                          bool waitForLock,\n                          pid_t pid)\n{\n    int fd = -1;\n    char pidstr[VIR_INT64_STR_BUFLEN];\n\n    if (path[0] == '\\0')\n        return 0;\n\n    while (1) {\n        struct stat a, b;\n        if ((fd = open(path, O_WRONLY|O_CREAT, 0644)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to open pid file '%s'\"),\n                                 path);\n            return -1;\n        }\n\n        if (virSetCloseExec(fd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to set close-on-exec flag '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        if (fstat(fd, &b) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to check status of pid file '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        if (virFileLock(fd, false, 0, 1, waitForLock) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to acquire pid file '%s'\"),\n                                 path);\n            VIR_FORCE_CLOSE(fd);\n            return -1;\n        }\n\n        /* Now make sure the pidfile we locked is the same\n         * one that now exists on the filesystem\n         */\n        if (stat(path, &a) < 0) {\n            VIR_DEBUG(\"Pid file '%s' disappeared: %s\",\n                      path, g_strerror(errno));\n            VIR_FORCE_CLOSE(fd);\n            /* Someone else must be racing with us, so try again */\n            continue;\n        }\n\n        if (a.st_ino == b.st_ino)\n            break;\n\n        VIR_DEBUG(\"Pid file '%s' was recreated\", path);\n        VIR_FORCE_CLOSE(fd);\n        /* Someone else must be racing with us, so try again */\n    }\n\n    g_snprintf(pidstr, sizeof(pidstr), \"%lld\", (long long) pid);\n\n    if (ftruncate(fd, 0) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to truncate pid file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    if (safewrite(fd, pidstr, strlen(pidstr)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to write to pid file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n    }\n\n    return fd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 691
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Found restart exec file with old magic %s vs wanted %s\"",
            "gotmagic",
            "wantmagic"
          ],
          "line": 683
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "gotmagic",
            "wantmagic"
          ],
          "line": 682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogDaemonGetExecRestartMagic",
          "args": [],
          "line": 679
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonGetExecRestartMagic",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "630-637",
          "snippet": "static char *\nvirLogDaemonGetExecRestartMagic(void)\n{\n    char *ret;\n\n    ret = g_strdup_printf(\"%lld\", (long long int)getpid());\n    return ret;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic char *\nvirLogDaemonGetExecRestartMagic(void)\n{\n    char *ret;\n\n    ret = g_strdup_printf(\"%lld\", (long long int)getpid());\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing magic data in JSON document\")"
          ],
          "line": 674
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Missing magic data in JSON document\""
          ],
          "line": 675
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "object",
            "\"magic\""
          ],
          "line": 672
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueFromString",
          "args": [
            "state"
          ],
          "line": 669
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFromString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1993-1999",
          "snippet": "virJSONValuePtr\nvirJSONValueFromString(const char *jsonstring G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No JSON parser implementation is available\"));\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueFromString(const char *jsonstring G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No JSON parser implementation is available\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Loading state %s\"",
            "state"
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "state_file",
            "1024 * 1024 * 10",
            "/* 10 MB */&state"
          ],
          "line": 662
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No restart state file %s present\"",
            "state_file"
          ],
          "line": 656
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "state_file"
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Running post-restart exec\""
          ],
          "line": 653
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirLogDaemonPtr logDaemon = NULL;\n\nstatic int\nvirLogDaemonPostExecRestart(const char *state_file,\n                            const char *pid_file,\n                            int *pid_file_fd,\n                            bool privileged,\n                            virLogDaemonConfigPtr config)\n{\n    const char *gotmagic;\n    char *wantmagic = NULL;\n    int ret = -1;\n    char *state = NULL;\n    virJSONValuePtr object = NULL;\n\n    VIR_DEBUG(\"Running post-restart exec\");\n\n    if (!virFileExists(state_file)) {\n        VIR_DEBUG(\"No restart state file %s present\",\n                  state_file);\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (virFileReadAll(state_file,\n                       1024 * 1024 * 10, /* 10 MB */\n                       &state) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Loading state %s\", state);\n\n    if (!(object = virJSONValueFromString(state)))\n        goto cleanup;\n\n    gotmagic = virJSONValueObjectGetString(object, \"magic\");\n    if (!gotmagic) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing magic data in JSON document\"));\n        goto cleanup;\n    }\n\n    if (!(wantmagic = virLogDaemonGetExecRestartMagic()))\n        goto cleanup;\n\n    if (STRNEQ(gotmagic, wantmagic)) {\n        VIR_WARN(\"Found restart exec file with old magic %s vs wanted %s\",\n                 gotmagic, wantmagic);\n        ret = 0;\n        goto cleanup;\n    }\n\n    /* Re-claim PID file now as we will not be daemonizing */\n    if (pid_file &&\n        (*pid_file_fd = virPidFileAcquirePath(pid_file, false, getpid())) < 0)\n        goto cleanup;\n\n    if (!(logDaemon = virLogDaemonNewPostExecRestart(object,\n                                                     privileged,\n                                                     config)))\n        goto cleanup;\n\n    ret = 1;\n\n cleanup:\n    unlink(state_file);\n    VIR_FREE(wantmagic);\n    VIR_FREE(state);\n    virJSONValueFree(object);\n    return ret;\n}"
  },
  {
    "function_name": "virLogDaemonGetExecRestartMagic",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "630-637",
    "snippet": "static char *\nvirLogDaemonGetExecRestartMagic(void)\n{\n    char *ret;\n\n    ret = g_strdup_printf(\"%lld\", (long long int)getpid());\n    return ret;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%lld\"",
            "(long long int)getpid()"
          ],
          "line": 635
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic char *\nvirLogDaemonGetExecRestartMagic(void)\n{\n    char *ret;\n\n    ret = g_strdup_printf(\"%lld\", (long long int)getpid());\n    return ret;\n}"
  },
  {
    "function_name": "virLogDaemonExecRestartStatePath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "604-627",
    "snippet": "static int\nvirLogDaemonExecRestartStatePath(bool privileged,\n                                 char **state_file)\n{\n    if (privileged) {\n        *state_file = g_strdup(RUNSTATEDIR \"/virtlogd-restart-exec.json\");\n    } else {\n        g_autofree char *rundir = NULL;\n        mode_t old_umask;\n\n        rundir = virGetUserRuntimeDirectory();\n\n        old_umask = umask(077);\n        if (virFileMakePath(rundir) < 0) {\n            umask(old_umask);\n            return -1;\n        }\n        umask(old_umask);\n\n        *state_file = g_strdup_printf(\"%s/virtlogd-restart-exec.json\", rundir);\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/virtlogd-restart-exec.json\"",
            "rundir"
          ],
          "line": 623
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "old_umask"
          ],
          "line": 621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "old_umask"
          ],
          "line": 618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "rundir"
          ],
          "line": 617
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "077"
          ],
          "line": 616
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetUserRuntimeDirectory",
          "args": [],
          "line": 614
        },
        "resolved": true,
        "details": {
          "function_name": "virGetUserRuntimeDirectory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "594-601",
          "snippet": "char *virGetUserRuntimeDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_runtime_dir());\n#else\n    return g_build_filename(g_get_user_runtime_dir(), \"libvirt\", NULL);\n#endif\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *virGetUserRuntimeDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_runtime_dir());\n#else\n    return g_build_filename(g_get_user_runtime_dir(), \"libvirt\", NULL);\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirLogDaemonExecRestartStatePath(bool privileged,\n                                 char **state_file)\n{\n    if (privileged) {\n        *state_file = g_strdup(RUNSTATEDIR \"/virtlogd-restart-exec.json\");\n    } else {\n        g_autofree char *rundir = NULL;\n        mode_t old_umask;\n\n        rundir = virGetUserRuntimeDirectory();\n\n        old_umask = umask(077);\n        if (virFileMakePath(rundir) < 0) {\n            umask(old_umask);\n            return -1;\n        }\n        umask(old_umask);\n\n        *state_file = g_strdup_printf(\"%s/virtlogd-restart-exec.json\", rundir);\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virLogDaemonClientPreExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "594-601",
    "snippet": "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client G_GNUC_UNUSED,\n                                 void *opaque G_GNUC_UNUSED)\n{\n    virJSONValuePtr object = virJSONValueNewObject();\n\n    return object;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueNewObject",
          "args": [],
          "line": 598
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "571-579",
          "snippet": "virJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client G_GNUC_UNUSED,\n                                 void *opaque G_GNUC_UNUSED)\n{\n    virJSONValuePtr object = virJSONValueNewObject();\n\n    return object;\n}"
  },
  {
    "function_name": "virLogDaemonClientNewPostExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "580-591",
    "snippet": "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object G_GNUC_UNUSED,\n                                     void *opaque)\n{\n    virLogDaemonClientPtr priv = virLogDaemonClientNew(client, opaque);\n\n    if (!priv)\n        return NULL;\n\n    return priv;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLogDaemonClientNew",
          "args": [
            "client",
            "opaque"
          ],
          "line": 585
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonClientNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "523-577",
          "snippet": "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque)\n{\n    virLogDaemonClientPtr priv;\n    uid_t clientuid;\n    gid_t clientgid;\n    unsigned long long timestamp;\n    bool privileged = opaque != NULL;\n\n    if (VIR_ALLOC(priv) < 0)\n        return NULL;\n\n    if (virMutexInit(&priv->lock) < 0) {\n        VIR_FREE(priv);\n        virReportSystemError(errno, \"%s\", _(\"unable to init mutex\"));\n        return NULL;\n    }\n\n    if (virNetServerClientGetUNIXIdentity(client,\n                                          &clientuid,\n                                          &clientgid,\n                                          &priv->clientPid,\n                                          &timestamp) < 0)\n        goto error;\n\n    VIR_DEBUG(\"New client pid %llu uid %llu\",\n              (unsigned long long)priv->clientPid,\n              (unsigned long long)clientuid);\n\n    if (!privileged) {\n        if (geteuid() != clientuid) {\n            virReportRestrictedError(_(\"Disallowing client %llu with uid %llu\"),\n                                     (unsigned long long)priv->clientPid,\n                                     (unsigned long long)clientuid);\n            goto error;\n        }\n    } else {\n        if (clientuid != 0) {\n            virReportRestrictedError(_(\"Disallowing client %llu with uid %llu\"),\n                                     (unsigned long long)priv->clientPid,\n                                     (unsigned long long)clientuid);\n            goto error;\n        }\n    }\n\n    /* there's no closing handshake in the logging protocol */\n    virNetServerClientSetQuietEOF(client);\n\n    return priv;\n\n error:\n    virLogDaemonClientFree(priv);\n    return NULL;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
            "static void\nvirLogDaemonClientFree(void *opaque);",
            "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
            "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque)\n{\n    virLogDaemonClientPtr priv;\n    uid_t clientuid;\n    gid_t clientgid;\n    unsigned long long timestamp;\n    bool privileged = opaque != NULL;\n\n    if (VIR_ALLOC(priv) < 0)\n        return NULL;\n\n    if (virMutexInit(&priv->lock) < 0) {\n        VIR_FREE(priv);\n        virReportSystemError(errno, \"%s\", _(\"unable to init mutex\"));\n        return NULL;\n    }\n\n    if (virNetServerClientGetUNIXIdentity(client,\n                                          &clientuid,\n                                          &clientgid,\n                                          &priv->clientPid,\n                                          &timestamp) < 0)\n        goto error;\n\n    VIR_DEBUG(\"New client pid %llu uid %llu\",\n              (unsigned long long)priv->clientPid,\n              (unsigned long long)clientuid);\n\n    if (!privileged) {\n        if (geteuid() != clientuid) {\n            virReportRestrictedError(_(\"Disallowing client %llu with uid %llu\"),\n                                     (unsigned long long)priv->clientPid,\n                                     (unsigned long long)clientuid);\n            goto error;\n        }\n    } else {\n        if (clientuid != 0) {\n            virReportRestrictedError(_(\"Disallowing client %llu with uid %llu\"),\n                                     (unsigned long long)priv->clientPid,\n                                     (unsigned long long)clientuid);\n            goto error;\n        }\n    }\n\n    /* there's no closing handshake in the logging protocol */\n    virNetServerClientSetQuietEOF(client);\n\n    return priv;\n\n error:\n    virLogDaemonClientFree(priv);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object G_GNUC_UNUSED,\n                                     void *opaque)\n{\n    virLogDaemonClientPtr priv = virLogDaemonClientNew(client, opaque);\n\n    if (!priv)\n        return NULL;\n\n    return priv;\n}"
  },
  {
    "function_name": "virLogDaemonClientNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "523-577",
    "snippet": "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque)\n{\n    virLogDaemonClientPtr priv;\n    uid_t clientuid;\n    gid_t clientgid;\n    unsigned long long timestamp;\n    bool privileged = opaque != NULL;\n\n    if (VIR_ALLOC(priv) < 0)\n        return NULL;\n\n    if (virMutexInit(&priv->lock) < 0) {\n        VIR_FREE(priv);\n        virReportSystemError(errno, \"%s\", _(\"unable to init mutex\"));\n        return NULL;\n    }\n\n    if (virNetServerClientGetUNIXIdentity(client,\n                                          &clientuid,\n                                          &clientgid,\n                                          &priv->clientPid,\n                                          &timestamp) < 0)\n        goto error;\n\n    VIR_DEBUG(\"New client pid %llu uid %llu\",\n              (unsigned long long)priv->clientPid,\n              (unsigned long long)clientuid);\n\n    if (!privileged) {\n        if (geteuid() != clientuid) {\n            virReportRestrictedError(_(\"Disallowing client %llu with uid %llu\"),\n                                     (unsigned long long)priv->clientPid,\n                                     (unsigned long long)clientuid);\n            goto error;\n        }\n    } else {\n        if (clientuid != 0) {\n            virReportRestrictedError(_(\"Disallowing client %llu with uid %llu\"),\n                                     (unsigned long long)priv->clientPid,\n                                     (unsigned long long)clientuid);\n            goto error;\n        }\n    }\n\n    /* there's no closing handshake in the logging protocol */\n    virNetServerClientSetQuietEOF(client);\n\n    return priv;\n\n error:\n    virLogDaemonClientFree(priv);\n    return NULL;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLogDaemonClientFree",
          "args": [
            "priv"
          ],
          "line": 575
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonClientFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "506-520",
          "snippet": "static void\nvirLogDaemonClientFree(void *opaque)\n{\n    virLogDaemonClientPtr priv = opaque;\n\n    if (!priv)\n        return;\n\n    VIR_DEBUG(\"priv=%p client=%lld\",\n              priv,\n              (unsigned long long)priv->clientPid);\n\n    virMutexDestroy(&priv->lock);\n    VIR_FREE(priv);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
            "static void\nvirLogDaemonClientFree(void *opaque);",
            "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
            "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void\nvirLogDaemonClientFree(void *opaque)\n{\n    virLogDaemonClientPtr priv = opaque;\n\n    if (!priv)\n        return;\n\n    VIR_DEBUG(\"priv=%p client=%lld\",\n              priv,\n              (unsigned long long)priv->clientPid);\n\n    virMutexDestroy(&priv->lock);\n    VIR_FREE(priv);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerClientSetQuietEOF",
          "args": [
            "client"
          ],
          "line": 570
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerClientSetQuietEOF",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverclient.c",
          "lines": "1692-1696",
          "snippet": "void\nvirNetServerClientSetQuietEOF(virNetServerClientPtr client)\n{\n    virNetSocketSetQuietEOF(client->sock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virkeepalive.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserver.h\"",
            "# include <sasl/sasl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virNetServerClientUpdateEvent(virNetServerClientPtr client);",
            "static virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virkeepalive.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserver.h\"\n# include <sasl/sasl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic void virNetServerClientUpdateEvent(virNetServerClientPtr client);\nstatic virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);\n\nvoid\nvirNetServerClientSetQuietEOF(virNetServerClientPtr client)\n{\n    virNetSocketSetQuietEOF(client->sock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportRestrictedError",
          "args": [
            "_(\"Disallowing client %llu with uid %llu\")",
            "(unsigned long long)priv->clientPid",
            "(unsigned long long)clientuid"
          ],
          "line": 562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Disallowing client %llu with uid %llu\""
          ],
          "line": 562
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportRestrictedError",
          "args": [
            "_(\"Disallowing client %llu with uid %llu\")",
            "(unsigned long long)priv->clientPid",
            "(unsigned long long)clientuid"
          ],
          "line": 555
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "geteuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.h",
          "lines": "68-69",
          "snippet": "static inline int geteuid(void)\n{ return 0; }",
          "includes": [
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <unistd.h>\n#include \"internal.h\"\n\nstatic inline int geteuid(void)\n{ return 0; }"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"New client pid %llu uid %llu\"",
            "(unsigned long long)priv->clientPid",
            "(unsigned long long)clientuid"
          ],
          "line": 549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetServerClientGetUNIXIdentity",
          "args": [
            "client",
            "&clientuid",
            "&clientgid",
            "&priv->clientPid",
            "&timestamp"
          ],
          "line": 542
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerClientGetUNIXIdentity",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserverclient.c",
          "lines": "741-753",
          "snippet": "int virNetServerClientGetUNIXIdentity(virNetServerClientPtr client,\n                                      uid_t *uid, gid_t *gid, pid_t *pid,\n                                      unsigned long long *timestamp)\n{\n    int ret = -1;\n    virObjectLock(client);\n    if (client->sock)\n        ret = virNetSocketGetUNIXIdentity(client->sock,\n                                          uid, gid, pid,\n                                          timestamp);\n    virObjectUnlock(client);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virkeepalive.h\"",
            "#include \"virthread.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserverclient.h\"",
            "#include \"virnetserver.h\"",
            "# include <sasl/sasl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virNetServerClientUpdateEvent(virNetServerClientPtr client);",
            "static virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virkeepalive.h\"\n#include \"virthread.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virnetserverclient.h\"\n#include \"virnetserver.h\"\n# include <sasl/sasl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic void virNetServerClientUpdateEvent(virNetServerClientPtr client);\nstatic virNetMessagePtr virNetServerClientDispatchRead(virNetServerClientPtr client);\n\nint virNetServerClientGetUNIXIdentity(virNetServerClientPtr client,\n                                      uid_t *uid, gid_t *gid, pid_t *pid,\n                                      unsigned long long *timestamp)\n{\n    int ret = -1;\n    virObjectLock(client);\n    if (client->sock)\n        ret = virNetSocketGetUNIXIdentity(client->sock,\n                                          uid, gid, pid,\n                                          timestamp);\n    virObjectUnlock(client);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"unable to init mutex\")"
          ],
          "line": 538
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv"
          ],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexInit",
          "args": [
            "&priv->lock"
          ],
          "line": 536
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "priv"
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque)\n{\n    virLogDaemonClientPtr priv;\n    uid_t clientuid;\n    gid_t clientgid;\n    unsigned long long timestamp;\n    bool privileged = opaque != NULL;\n\n    if (VIR_ALLOC(priv) < 0)\n        return NULL;\n\n    if (virMutexInit(&priv->lock) < 0) {\n        VIR_FREE(priv);\n        virReportSystemError(errno, \"%s\", _(\"unable to init mutex\"));\n        return NULL;\n    }\n\n    if (virNetServerClientGetUNIXIdentity(client,\n                                          &clientuid,\n                                          &clientgid,\n                                          &priv->clientPid,\n                                          &timestamp) < 0)\n        goto error;\n\n    VIR_DEBUG(\"New client pid %llu uid %llu\",\n              (unsigned long long)priv->clientPid,\n              (unsigned long long)clientuid);\n\n    if (!privileged) {\n        if (geteuid() != clientuid) {\n            virReportRestrictedError(_(\"Disallowing client %llu with uid %llu\"),\n                                     (unsigned long long)priv->clientPid,\n                                     (unsigned long long)clientuid);\n            goto error;\n        }\n    } else {\n        if (clientuid != 0) {\n            virReportRestrictedError(_(\"Disallowing client %llu with uid %llu\"),\n                                     (unsigned long long)priv->clientPid,\n                                     (unsigned long long)clientuid);\n            goto error;\n        }\n    }\n\n    /* there's no closing handshake in the logging protocol */\n    virNetServerClientSetQuietEOF(client);\n\n    return priv;\n\n error:\n    virLogDaemonClientFree(priv);\n    return NULL;\n}"
  },
  {
    "function_name": "virLogDaemonClientFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "506-520",
    "snippet": "static void\nvirLogDaemonClientFree(void *opaque)\n{\n    virLogDaemonClientPtr priv = opaque;\n\n    if (!priv)\n        return;\n\n    VIR_DEBUG(\"priv=%p client=%lld\",\n              priv,\n              (unsigned long long)priv->clientPid);\n\n    virMutexDestroy(&priv->lock);\n    VIR_FREE(priv);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "priv"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexDestroy",
          "args": [
            "&priv->lock"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "76-79",
          "snippet": "void virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"priv=%p client=%lld\"",
            "priv",
            "(unsigned long long)priv->clientPid"
          ],
          "line": 514
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void\nvirLogDaemonClientFree(void *opaque)\n{\n    virLogDaemonClientPtr priv = opaque;\n\n    if (!priv)\n        return;\n\n    VIR_DEBUG(\"priv=%p client=%lld\",\n              priv,\n              (unsigned long long)priv->clientPid);\n\n    virMutexDestroy(&priv->lock);\n    VIR_FREE(priv);\n}"
  },
  {
    "function_name": "virLogDaemonSetupSignals",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "491-503",
    "snippet": "static int\nvirLogDaemonSetupSignals(virNetDaemonPtr dmn)\n{\n    if (virNetDaemonAddSignalHandler(dmn, SIGINT, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGQUIT, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGTERM, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGUSR1, virLogDaemonExecRestartHandler, NULL) < 0)\n        return -1;\n    return 0;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDaemonAddSignalHandler",
          "args": [
            "dmn",
            "SIGUSR1",
            "virLogDaemonExecRestartHandler",
            "NULL"
          ],
          "line": 500
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonAddSignalHandler",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "737-746",
          "snippet": "int\nvirNetDaemonAddSignalHandler(virNetDaemonPtr dmn G_GNUC_UNUSED,\n                             int signum G_GNUC_UNUSED,\n                             virNetDaemonSignalFunc func G_GNUC_UNUSED,\n                             void *opaque G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Signal handling not available on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNetDaemonAddSignalHandler(virNetDaemonPtr dmn G_GNUC_UNUSED,\n                             int signum G_GNUC_UNUSED,\n                             virNetDaemonSignalFunc func G_GNUC_UNUSED,\n                             void *opaque G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Signal handling not available on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirLogDaemonSetupSignals(virNetDaemonPtr dmn)\n{\n    if (virNetDaemonAddSignalHandler(dmn, SIGINT, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGQUIT, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGTERM, virLogDaemonShutdownHandler, NULL) < 0)\n        return -1;\n    if (virNetDaemonAddSignalHandler(dmn, SIGUSR1, virLogDaemonExecRestartHandler, NULL) < 0)\n        return -1;\n    return 0;\n}"
  },
  {
    "function_name": "virLogDaemonExecRestartHandler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "482-489",
    "snippet": "static void\nvirLogDaemonExecRestartHandler(virNetDaemonPtr dmn,\n                               siginfo_t *sig G_GNUC_UNUSED,\n                               void *opaque G_GNUC_UNUSED)\n{\n    execRestart = true;\n    virNetDaemonQuit(dmn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bool execRestart;",
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDaemonQuit",
          "args": [
            "dmn"
          ],
          "line": 488
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonQuit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "867-876",
          "snippet": "void\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic bool execRestart;\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void\nvirLogDaemonExecRestartHandler(virNetDaemonPtr dmn,\n                               siginfo_t *sig G_GNUC_UNUSED,\n                               void *opaque G_GNUC_UNUSED)\n{\n    execRestart = true;\n    virNetDaemonQuit(dmn);\n}"
  },
  {
    "function_name": "virLogDaemonShutdownHandler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "474-480",
    "snippet": "static void\nvirLogDaemonShutdownHandler(virNetDaemonPtr dmn,\n                            siginfo_t *sig G_GNUC_UNUSED,\n                            void *opaque G_GNUC_UNUSED)\n{\n    virNetDaemonQuit(dmn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDaemonQuit",
          "args": [
            "dmn"
          ],
          "line": 479
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonQuit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "867-876",
          "snippet": "void\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonQuit(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n\n    VIR_DEBUG(\"Quit requested %p\", dmn);\n    dmn->quit = true;\n\n    virObjectUnlock(dmn);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void\nvirLogDaemonShutdownHandler(virNetDaemonPtr dmn,\n                            siginfo_t *sig G_GNUC_UNUSED,\n                            void *opaque G_GNUC_UNUSED)\n{\n    virNetDaemonQuit(dmn);\n}"
  },
  {
    "function_name": "virLogDaemonVersion",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "468-472",
    "snippet": "static void\nvirLogDaemonVersion(const char *argv0)\n{\n    printf(\"%s (%s) %s\\n\", argv0, PACKAGE_NAME, PACKAGE_VERSION);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s (%s) %s\\n\"",
            "argv0",
            "PACKAGE_NAME",
            "PACKAGE_VERSION"
          ],
          "line": 471
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonVersion(const char *argv0)\n{\n    printf(\"%s (%s) %s\\n\", argv0, PACKAGE_NAME, PACKAGE_VERSION);\n}"
  },
  {
    "function_name": "virLogDaemonSetupLogging",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "422-463",
    "snippet": "static void\nvirLogDaemonSetupLogging(virLogDaemonConfigPtr config,\n                         bool privileged,\n                         bool verbose,\n                         bool godaemon)\n{\n    virLogReset();\n\n    /*\n     * Libvirtd's order of precedence is:\n     * cmdline > environment > config\n     *\n     * Given the precedence, we must process the variables in the opposite\n     * order, each one overriding the previous.\n     */\n    if (config->log_level != 0)\n        virLogSetDefaultPriority(config->log_level);\n\n    /* In case the config is empty, both filters and outputs will become empty,\n     * however we can't start with empty outputs, thus we'll need to define and\n     * setup a default one.\n     */\n    ignore_value(virLogSetFilters(config->log_filters));\n    ignore_value(virLogSetOutputs(config->log_outputs));\n\n    /* If there are some environment variables defined, use those instead */\n    virLogSetFromEnv();\n\n    /*\n     * Command line override for --verbose\n     */\n    if ((verbose) && (virLogGetDefaultPriority() > VIR_LOG_INFO))\n        virLogSetDefaultPriority(VIR_LOG_INFO);\n\n    /* Define the default output. This is only applied if there was no setting\n     * from either the config or the environment.\n     */\n    virLogSetDefaultOutput(\"virtlogd\", godaemon, privileged);\n\n    if (virLogGetNbOutputs() == 0)\n        virLogSetOutputs(virLogGetDefaultOutput());\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLogSetOutputs",
          "args": [
            "virLogGetDefaultOutput()"
          ],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "virLogSetOutputs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "1747-1779",
          "snippet": "int\nvirLogSetOutputs(const char *src)\n{\n    int ret = -1;\n    int noutputs = 0;\n    const char *outputstr = virLogDefaultOutput;\n    virLogOutputPtr *outputs = NULL;\n\n    if (virLogInitialize() < 0)\n        return -1;\n\n    if (src && *src)\n        outputstr = src;\n\n    /* This can only happen during daemon init when the default output is not\n     * determined yet. It's safe to do, since it's the only place setting the\n     * default output.\n     */\n    if (!outputstr)\n        return 0;\n\n    if ((noutputs = virLogParseOutputs(outputstr, &outputs)) < 0)\n        goto cleanup;\n\n    if (virLogDefineOutputs(outputs, noutputs) < 0)\n        goto cleanup;\n\n    outputs = NULL;\n    ret = 0;\n cleanup:\n    virLogOutputListFree(outputs, noutputs);\n    return ret;\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char *virLogDefaultOutput;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic char *virLogDefaultOutput;\n\nint\nvirLogSetOutputs(const char *src)\n{\n    int ret = -1;\n    int noutputs = 0;\n    const char *outputstr = virLogDefaultOutput;\n    virLogOutputPtr *outputs = NULL;\n\n    if (virLogInitialize() < 0)\n        return -1;\n\n    if (src && *src)\n        outputstr = src;\n\n    /* This can only happen during daemon init when the default output is not\n     * determined yet. It's safe to do, since it's the only place setting the\n     * default output.\n     */\n    if (!outputstr)\n        return 0;\n\n    if ((noutputs = virLogParseOutputs(outputstr, &outputs)) < 0)\n        goto cleanup;\n\n    if (virLogDefineOutputs(outputs, noutputs) < 0)\n        goto cleanup;\n\n    outputs = NULL;\n    ret = 0;\n cleanup:\n    virLogOutputListFree(outputs, noutputs);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogGetDefaultOutput",
          "args": [],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "virLogGetDefaultOutput",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "223-227",
          "snippet": "char *\nvirLogGetDefaultOutput(void)\n{\n    return virLogDefaultOutput;\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static char *virLogDefaultOutput;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic char *virLogDefaultOutput;\n\nchar *\nvirLogGetDefaultOutput(void)\n{\n    return virLogDefaultOutput;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogGetNbOutputs",
          "args": [],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "virLogGetNbOutputs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "1163-1167",
          "snippet": "int\nvirLogGetNbOutputs(void)\n{\n    return virLogNbOutputs;\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static size_t virLogNbOutputs;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic size_t virLogNbOutputs;\n\nint\nvirLogGetNbOutputs(void)\n{\n    return virLogNbOutputs;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogSetDefaultOutput",
          "args": [
            "\"virtlogd\"",
            "godaemon",
            "privileged"
          ],
          "line": 459
        },
        "resolved": true,
        "details": {
          "function_name": "virLogSetDefaultOutput",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "204-220",
          "snippet": "void\nvirLogSetDefaultOutput(const char *binary, bool godaemon, bool privileged)\n{\n    bool have_journald = access(\"/run/systemd/journal/socket\", W_OK) >= 0;\n\n    if (godaemon) {\n        if (have_journald)\n            virLogSetDefaultOutputToJournald();\n        else\n            virLogSetDefaultOutputToFile(binary, privileged);\n    } else {\n        if (!isatty(STDIN_FILENO) && have_journald)\n            virLogSetDefaultOutputToJournald();\n        else\n            virLogSetDefaultOutputToStderr();\n    }\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirLogSetDefaultOutput(const char *binary, bool godaemon, bool privileged)\n{\n    bool have_journald = access(\"/run/systemd/journal/socket\", W_OK) >= 0;\n\n    if (godaemon) {\n        if (have_journald)\n            virLogSetDefaultOutputToJournald();\n        else\n            virLogSetDefaultOutputToFile(binary, privileged);\n    } else {\n        if (!isatty(STDIN_FILENO) && have_journald)\n            virLogSetDefaultOutputToJournald();\n        else\n            virLogSetDefaultOutputToStderr();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogSetDefaultPriority",
          "args": [
            "VIR_LOG_INFO"
          ],
          "line": 454
        },
        "resolved": true,
        "details": {
          "function_name": "virLogSetDefaultPriority",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "304-318",
          "snippet": "int\nvirLogSetDefaultPriority(virLogPriority priority)\n{\n    if ((priority < VIR_LOG_DEBUG) || (priority > VIR_LOG_ERROR)) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Failed to set logging priority, argument '%u' is \"\n                         \"invalid\"), priority);\n        return -1;\n    }\n    if (virLogInitialize() < 0)\n        return -1;\n\n    virLogDefaultPriority = priority;\n    return 0;\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virLogPriority virLogDefaultPriority = VIR_LOG_DEFAULT;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic virLogPriority virLogDefaultPriority = VIR_LOG_DEFAULT;\n\nint\nvirLogSetDefaultPriority(virLogPriority priority)\n{\n    if ((priority < VIR_LOG_DEBUG) || (priority > VIR_LOG_ERROR)) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Failed to set logging priority, argument '%u' is \"\n                         \"invalid\"), priority);\n        return -1;\n    }\n    if (virLogInitialize() < 0)\n        return -1;\n\n    virLogDefaultPriority = priority;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogGetDefaultPriority",
          "args": [],
          "line": 453
        },
        "resolved": true,
        "details": {
          "function_name": "virLogGetDefaultPriority",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "1063-1067",
          "snippet": "virLogPriority\nvirLogGetDefaultPriority(void)\n{\n    return virLogDefaultPriority;\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virLogPriority virLogDefaultPriority = VIR_LOG_DEFAULT;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic virLogPriority virLogDefaultPriority = VIR_LOG_DEFAULT;\n\nvirLogPriority\nvirLogGetDefaultPriority(void)\n{\n    return virLogDefaultPriority;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogSetFromEnv",
          "args": [],
          "line": 448
        },
        "resolved": true,
        "details": {
          "function_name": "virLogSetFromEnv",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "1208-1225",
          "snippet": "void\nvirLogSetFromEnv(void)\n{\n    const char *debugEnv;\n\n    if (virLogInitialize() < 0)\n        return;\n\n    debugEnv = getenv(\"LIBVIRT_DEBUG\");\n    if (debugEnv && *debugEnv)\n        virLogSetDefaultPriority(virLogParseDefaultPriority(debugEnv));\n    debugEnv = getenv(\"LIBVIRT_LOG_FILTERS\");\n    if (debugEnv && *debugEnv)\n        virLogSetFilters(debugEnv);\n    debugEnv = getenv(\"LIBVIRT_LOG_OUTPUTS\");\n    if (debugEnv && *debugEnv)\n        virLogSetOutputs(debugEnv);\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirLogSetFromEnv(void)\n{\n    const char *debugEnv;\n\n    if (virLogInitialize() < 0)\n        return;\n\n    debugEnv = getenv(\"LIBVIRT_DEBUG\");\n    if (debugEnv && *debugEnv)\n        virLogSetDefaultPriority(virLogParseDefaultPriority(debugEnv));\n    debugEnv = getenv(\"LIBVIRT_LOG_FILTERS\");\n    if (debugEnv && *debugEnv)\n        virLogSetFilters(debugEnv);\n    debugEnv = getenv(\"LIBVIRT_LOG_OUTPUTS\");\n    if (debugEnv && *debugEnv)\n        virLogSetOutputs(debugEnv);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virLogSetOutputs(config->log_outputs)"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virLogSetFilters(config->log_filters)"
          ],
          "line": 444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLogSetFilters",
          "args": [
            "config->log_filters"
          ],
          "line": 444
        },
        "resolved": true,
        "details": {
          "function_name": "virLogSetFilters",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "1790-1811",
          "snippet": "int\nvirLogSetFilters(const char *src)\n{\n    int ret = -1;\n    int nfilters = 0;\n    virLogFilterPtr *filters = NULL;\n\n    if (virLogInitialize() < 0)\n        return -1;\n\n    if (src && (nfilters = virLogParseFilters(src, &filters)) < 0)\n        goto cleanup;\n\n    if (virLogDefineFilters(filters, nfilters) < 0)\n        goto cleanup;\n\n    filters = NULL;\n    ret = 0;\n cleanup:\n    virLogFilterListFree(filters, nfilters);\n    return ret;\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirLogSetFilters(const char *src)\n{\n    int ret = -1;\n    int nfilters = 0;\n    virLogFilterPtr *filters = NULL;\n\n    if (virLogInitialize() < 0)\n        return -1;\n\n    if (src && (nfilters = virLogParseFilters(src, &filters)) < 0)\n        goto cleanup;\n\n    if (virLogDefineFilters(filters, nfilters) < 0)\n        goto cleanup;\n\n    filters = NULL;\n    ret = 0;\n cleanup:\n    virLogFilterListFree(filters, nfilters);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogReset",
          "args": [],
          "line": 428
        },
        "resolved": true,
        "details": {
          "function_name": "virLogResetOutputs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "373-379",
          "snippet": "static void\nvirLogResetOutputs(void)\n{\n    virLogOutputListFree(virLogOutputs, virLogNbOutputs);\n    virLogOutputs = NULL;\n    virLogNbOutputs = 0;\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virLogOutputPtr *virLogOutputs;",
            "static size_t virLogNbOutputs;",
            "static void virLogResetOutputs(void);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic virLogOutputPtr *virLogOutputs;\nstatic size_t virLogNbOutputs;\nstatic void virLogResetOutputs(void);\n\nstatic void\nvirLogResetOutputs(void)\n{\n    virLogOutputListFree(virLogOutputs, virLogNbOutputs);\n    virLogOutputs = NULL;\n    virLogNbOutputs = 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonSetupLogging(virLogDaemonConfigPtr config,\n                         bool privileged,\n                         bool verbose,\n                         bool godaemon)\n{\n    virLogReset();\n\n    /*\n     * Libvirtd's order of precedence is:\n     * cmdline > environment > config\n     *\n     * Given the precedence, we must process the variables in the opposite\n     * order, each one overriding the previous.\n     */\n    if (config->log_level != 0)\n        virLogSetDefaultPriority(config->log_level);\n\n    /* In case the config is empty, both filters and outputs will become empty,\n     * however we can't start with empty outputs, thus we'll need to define and\n     * setup a default one.\n     */\n    ignore_value(virLogSetFilters(config->log_filters));\n    ignore_value(virLogSetOutputs(config->log_outputs));\n\n    /* If there are some environment variables defined, use those instead */\n    virLogSetFromEnv();\n\n    /*\n     * Command line override for --verbose\n     */\n    if ((verbose) && (virLogGetDefaultPriority() > VIR_LOG_INFO))\n        virLogSetDefaultPriority(VIR_LOG_INFO);\n\n    /* Define the default output. This is only applied if there was no setting\n     * from either the config or the environment.\n     */\n    virLogSetDefaultOutput(\"virtlogd\", godaemon, privileged);\n\n    if (virLogGetNbOutputs() == 0)\n        virLogSetOutputs(virLogGetDefaultOutput());\n}"
  },
  {
    "function_name": "virLogDaemonErrorHandler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "413-419",
    "snippet": "static void\nvirLogDaemonErrorHandler(void *opaque G_GNUC_UNUSED,\n                         virErrorPtr err G_GNUC_UNUSED)\n{\n    /* Don't do anything, since logging infrastructure already\n     * took care of reporting the error */\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void\nvirLogDaemonErrorHandler(void *opaque G_GNUC_UNUSED,\n                         virErrorPtr err G_GNUC_UNUSED)\n{\n    /* Don't do anything, since logging infrastructure already\n     * took care of reporting the error */\n}"
  },
  {
    "function_name": "virLogDaemonUnixSocketPaths",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "385-410",
    "snippet": "static int\nvirLogDaemonUnixSocketPaths(bool privileged,\n                            char **sockfile,\n                            char **adminSockfile)\n{\n    if (privileged) {\n        *sockfile = g_strdup(RUNSTATEDIR \"/libvirt/virtlogd-sock\");\n        *adminSockfile = g_strdup(RUNSTATEDIR \"/libvirt/virtlogd-admin-sock\");\n    } else {\n        g_autofree char *rundir = NULL;\n        mode_t old_umask;\n\n        rundir = virGetUserRuntimeDirectory();\n\n        old_umask = umask(077);\n        if (virFileMakePath(rundir) < 0) {\n            umask(old_umask);\n            return -1;\n        }\n        umask(old_umask);\n\n        *sockfile = g_strdup_printf(\"%s/virtlogd-sock\", rundir);\n        *adminSockfile = g_strdup_printf(\"%s/virtlogd-admin-sock\", rundir);\n    }\n    return 0;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/virtlogd-admin-sock\"",
            "rundir"
          ],
          "line": 407
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "old_umask"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "old_umask"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "rundir"
          ],
          "line": 400
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "umask",
          "args": [
            "077"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetUserRuntimeDirectory",
          "args": [],
          "line": 397
        },
        "resolved": true,
        "details": {
          "function_name": "virGetUserRuntimeDirectory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "594-601",
          "snippet": "char *virGetUserRuntimeDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_runtime_dir());\n#else\n    return g_build_filename(g_get_user_runtime_dir(), \"libvirt\", NULL);\n#endif\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *virGetUserRuntimeDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_runtime_dir());\n#else\n    return g_build_filename(g_get_user_runtime_dir(), \"libvirt\", NULL);\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirLogDaemonUnixSocketPaths(bool privileged,\n                            char **sockfile,\n                            char **adminSockfile)\n{\n    if (privileged) {\n        *sockfile = g_strdup(RUNSTATEDIR \"/libvirt/virtlogd-sock\");\n        *adminSockfile = g_strdup(RUNSTATEDIR \"/libvirt/virtlogd-admin-sock\");\n    } else {\n        g_autofree char *rundir = NULL;\n        mode_t old_umask;\n\n        rundir = virGetUserRuntimeDirectory();\n\n        old_umask = umask(077);\n        if (virFileMakePath(rundir) < 0) {\n            umask(old_umask);\n            return -1;\n        }\n        umask(old_umask);\n\n        *sockfile = g_strdup_printf(\"%s/virtlogd-sock\", rundir);\n        *adminSockfile = g_strdup_printf(\"%s/virtlogd-admin-sock\", rundir);\n    }\n    return 0;\n}"
  },
  {
    "function_name": "virLogDaemonForkIntoBackground",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "297-382",
    "snippet": "static int\nvirLogDaemonForkIntoBackground(const char *argv0)\n{\n    int statuspipe[2];\n    if (virPipeQuiet(statuspipe) < 0)\n        return -1;\n\n    pid_t pid = fork();\n    switch (pid) {\n    case 0:\n        {\n            int stdinfd = -1;\n            int stdoutfd = -1;\n            int nextpid;\n\n            VIR_FORCE_CLOSE(statuspipe[0]);\n\n            if ((stdinfd = open(\"/dev/null\", O_RDONLY)) < 0)\n                goto cleanup;\n            if ((stdoutfd = open(\"/dev/null\", O_WRONLY)) < 0)\n                goto cleanup;\n            if (dup2(stdinfd, STDIN_FILENO) != STDIN_FILENO)\n                goto cleanup;\n            if (dup2(stdoutfd, STDOUT_FILENO) != STDOUT_FILENO)\n                goto cleanup;\n            if (dup2(stdoutfd, STDERR_FILENO) != STDERR_FILENO)\n                goto cleanup;\n            if (VIR_CLOSE(stdinfd) < 0)\n                goto cleanup;\n            if (VIR_CLOSE(stdoutfd) < 0)\n                goto cleanup;\n\n            if (setsid() < 0)\n                goto cleanup;\n\n            nextpid = fork();\n            switch (nextpid) {\n            case 0:\n                return statuspipe[1];\n            case -1:\n                return -1;\n            default:\n                _exit(0);\n            }\n\n        cleanup:\n            VIR_FORCE_CLOSE(stdoutfd);\n            VIR_FORCE_CLOSE(stdinfd);\n            return -1;\n\n        }\n\n    case -1:\n        return -1;\n\n    default:\n        {\n            int got, exitstatus = 0;\n            int ret;\n            char status;\n\n            VIR_FORCE_CLOSE(statuspipe[1]);\n\n            /* We wait to make sure the first child forked successfully */\n            if ((got = waitpid(pid, &exitstatus, 0)) < 0 ||\n                got != pid ||\n                exitstatus != 0) {\n                return -1;\n            }\n\n            /* Now block until the second child initializes successfully */\n        again:\n            ret = read(statuspipe[0], &status, 1);\n            if (ret == -1 && errno == EINTR)\n                goto again;\n\n            if (ret == 1 && status != 0) {\n                fprintf(stderr,\n                        _(\"%s: error: %s. Check /var/log/messages or run without \"\n                          \"--daemon for more info.\\n\"), argv0,\n                        virDaemonErrTypeToString(status));\n            }\n            _exit(ret == 1 && status == 0 ? 0 : 1);\n        }\n    }\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "_exit",
          "args": [
            "ret == 1 && status == 0 ? 0 : 1"
          ],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"%s: error: %s. Check /var/log/messages or run without \"\n                          \"--daemon for more info.\\n\")",
            "argv0",
            "virDaemonErrTypeToString(status)"
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDaemonErrTypeToString",
          "args": [
            "status"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"%s: error: %s. Check /var/log/messages or run without \"\n                          \"--daemon for more info.\\n\""
          ],
          "line": 375
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "statuspipe[0]",
            "&status",
            "1"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDelIOThread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "7811-7841",
          "snippet": "int\nvirDomainDelIOThread(virDomainPtr domain,\n                     unsigned int iothread_id,\n                     unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"iothread_id=%u, flags=0x%x\", iothread_id, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    virCheckReadOnlyGoto(domain->conn->flags, error);\n    virCheckNonZeroArgGoto(iothread_id, error);\n\n    conn = domain->conn;\n\n    if (conn->driver->domainDelIOThread) {\n        int ret;\n        ret = conn->driver->domainDelIOThread(domain, iothread_id, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nint\nvirDomainDelIOThread(virDomainPtr domain,\n                     unsigned int iothread_id,\n                     unsigned int flags)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain, \"iothread_id=%u, flags=0x%x\", iothread_id, flags);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    virCheckReadOnlyGoto(domain->conn->flags, error);\n    virCheckNonZeroArgGoto(iothread_id, error);\n\n    conn = domain->conn;\n\n    if (conn->driver->domainDelIOThread) {\n        int ret;\n        ret = conn->driver->domainDelIOThread(domain, iothread_id, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "waitpid",
          "args": [
            "pid",
            "&exitstatus",
            "0"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "statuspipe[1]"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "stdinfd"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "stdoutfd"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exit",
          "args": [
            "0"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsid",
          "args": [],
          "line": 329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_CLOSE",
          "args": [
            "stdoutfd"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_CLOSE",
          "args": [
            "stdinfd"
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup2",
          "args": [
            "stdoutfd",
            "STDERR_FILENO"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup2",
          "args": [
            "stdoutfd",
            "STDOUT_FILENO"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup2",
          "args": [
            "stdinfd",
            "STDIN_FILENO"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "\"/dev/null\"",
            "O_WRONLY"
          ],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "statuspipe[0]"
          ],
          "line": 312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fork",
          "args": [],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPipeQuiet",
          "args": [
            "statuspipe"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "virPipeQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1806-1810",
          "snippet": "int\nvirPipeQuiet(int fds[2])\n{\n    return virPipeImpl(fds, false, false);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPipeQuiet(int fds[2])\n{\n    return virPipeImpl(fds, false, false);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirLogDaemonForkIntoBackground(const char *argv0)\n{\n    int statuspipe[2];\n    if (virPipeQuiet(statuspipe) < 0)\n        return -1;\n\n    pid_t pid = fork();\n    switch (pid) {\n    case 0:\n        {\n            int stdinfd = -1;\n            int stdoutfd = -1;\n            int nextpid;\n\n            VIR_FORCE_CLOSE(statuspipe[0]);\n\n            if ((stdinfd = open(\"/dev/null\", O_RDONLY)) < 0)\n                goto cleanup;\n            if ((stdoutfd = open(\"/dev/null\", O_WRONLY)) < 0)\n                goto cleanup;\n            if (dup2(stdinfd, STDIN_FILENO) != STDIN_FILENO)\n                goto cleanup;\n            if (dup2(stdoutfd, STDOUT_FILENO) != STDOUT_FILENO)\n                goto cleanup;\n            if (dup2(stdoutfd, STDERR_FILENO) != STDERR_FILENO)\n                goto cleanup;\n            if (VIR_CLOSE(stdinfd) < 0)\n                goto cleanup;\n            if (VIR_CLOSE(stdoutfd) < 0)\n                goto cleanup;\n\n            if (setsid() < 0)\n                goto cleanup;\n\n            nextpid = fork();\n            switch (nextpid) {\n            case 0:\n                return statuspipe[1];\n            case -1:\n                return -1;\n            default:\n                _exit(0);\n            }\n\n        cleanup:\n            VIR_FORCE_CLOSE(stdoutfd);\n            VIR_FORCE_CLOSE(stdinfd);\n            return -1;\n\n        }\n\n    case -1:\n        return -1;\n\n    default:\n        {\n            int got, exitstatus = 0;\n            int ret;\n            char status;\n\n            VIR_FORCE_CLOSE(statuspipe[1]);\n\n            /* We wait to make sure the first child forked successfully */\n            if ((got = waitpid(pid, &exitstatus, 0)) < 0 ||\n                got != pid ||\n                exitstatus != 0) {\n                return -1;\n            }\n\n            /* Now block until the second child initializes successfully */\n        again:\n            ret = read(statuspipe[0], &status, 1);\n            if (ret == -1 && errno == EINTR)\n                goto again;\n\n            if (ret == 1 && status != 0) {\n                fprintf(stderr,\n                        _(\"%s: error: %s. Check /var/log/messages or run without \"\n                          \"--daemon for more info.\\n\"), argv0,\n                        virDaemonErrTypeToString(status));\n            }\n            _exit(ret == 1 && status == 0 ? 0 : 1);\n        }\n    }\n}"
  },
  {
    "function_name": "virLogDaemonNewPostExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "244-294",
    "snippet": "static virLogDaemonPtr\nvirLogDaemonNewPostExecRestart(virJSONValuePtr object, bool privileged,\n                               virLogDaemonConfigPtr config)\n{\n    virLogDaemonPtr logd;\n    virJSONValuePtr child;\n    const char *serverNames[] = { \"virtlogd\" };\n\n    if (VIR_ALLOC(logd) < 0)\n        return NULL;\n\n    if (virMutexInit(&logd->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        VIR_FREE(logd);\n        return NULL;\n    }\n\n    if (!(child = virJSONValueObjectGet(object, \"daemon\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed daemon data from JSON file\"));\n        goto error;\n    }\n\n    if (!(logd->dmn = virNetDaemonNewPostExecRestart(child,\n                                                     G_N_ELEMENTS(serverNames),\n                                                     serverNames,\n                                                     virLogDaemonNewServerPostExecRestart,\n                                                     (void*)(intptr_t)(privileged ? 0x1 : 0x0))))\n        goto error;\n\n    if (!(child = virJSONValueObjectGet(object, \"handler\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed daemon data from JSON file\"));\n        goto error;\n    }\n\n    if (!(logd->handler = virLogHandlerNewPostExecRestart(child,\n                                                          privileged,\n                                                          config->max_size,\n                                                          config->max_backups,\n                                                          virLogDaemonInhibitor,\n                                                          logd)))\n        goto error;\n\n    return logd;\n\n error:\n    virLogDaemonFree(logd);\n    return NULL;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLogDaemonFree",
          "args": [
            "logd"
          ],
          "line": 292
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "112-123",
          "snippet": "static void\nvirLogDaemonFree(virLogDaemonPtr logd)\n{\n    if (!logd)\n        return;\n\n    virObjectUnref(logd->handler);\n    virMutexDestroy(&logd->lock);\n    virObjectUnref(logd->dmn);\n\n    VIR_FREE(logd);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonFree(virLogDaemonPtr logd)\n{\n    if (!logd)\n        return;\n\n    virObjectUnref(logd->handler);\n    virMutexDestroy(&logd->lock);\n    virObjectUnref(logd->dmn);\n\n    VIR_FREE(logd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerNewPostExecRestart",
          "args": [
            "child",
            "privileged",
            "config->max_size",
            "config->max_backups",
            "virLogDaemonInhibitor",
            "logd"
          ],
          "line": 281
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerNewPostExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "287-344",
          "snippet": "virLogHandlerPtr\nvirLogHandlerNewPostExecRestart(virJSONValuePtr object,\n                                bool privileged,\n                                size_t max_size,\n                                size_t max_backups,\n                                virLogHandlerShutdownInhibitor inhibitor,\n                                void *opaque)\n{\n    virLogHandlerPtr handler;\n    virJSONValuePtr files;\n    size_t i;\n\n    if (!(handler = virLogHandlerNew(privileged,\n                                     max_size,\n                                     max_backups,\n                                     inhibitor,\n                                     opaque)))\n        return NULL;\n\n    if (!(files = virJSONValueObjectGet(object, \"files\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing files data from JSON file\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(files)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed files array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(files); i++) {\n        virLogHandlerLogFilePtr file;\n        virJSONValuePtr child = virJSONValueArrayGet(files, i);\n\n        if (!(file = virLogHandlerLogFilePostExecRestart(handler, child)))\n            goto error;\n\n        if (VIR_APPEND_ELEMENT_COPY(handler->files, handler->nfiles, file) < 0)\n            goto error;\n\n        if ((file->watch = virEventAddHandle(file->pipefd,\n                                             VIR_EVENT_HANDLE_READABLE,\n                                             virLogHandlerDomainLogFileEvent,\n                                             handler,\n                                             NULL)) < 0) {\n            VIR_DELETE_ELEMENT(handler->files, handler->nfiles - 1, handler->nfiles);\n            goto error;\n        }\n    }\n\n\n    return handler;\n\n error:\n    virObjectUnref(handler);\n    return NULL;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nvirLogHandlerPtr\nvirLogHandlerNewPostExecRestart(virJSONValuePtr object,\n                                bool privileged,\n                                size_t max_size,\n                                size_t max_backups,\n                                virLogHandlerShutdownInhibitor inhibitor,\n                                void *opaque)\n{\n    virLogHandlerPtr handler;\n    virJSONValuePtr files;\n    size_t i;\n\n    if (!(handler = virLogHandlerNew(privileged,\n                                     max_size,\n                                     max_backups,\n                                     inhibitor,\n                                     opaque)))\n        return NULL;\n\n    if (!(files = virJSONValueObjectGet(object, \"files\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing files data from JSON file\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(files)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed files array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(files); i++) {\n        virLogHandlerLogFilePtr file;\n        virJSONValuePtr child = virJSONValueArrayGet(files, i);\n\n        if (!(file = virLogHandlerLogFilePostExecRestart(handler, child)))\n            goto error;\n\n        if (VIR_APPEND_ELEMENT_COPY(handler->files, handler->nfiles, file) < 0)\n            goto error;\n\n        if ((file->watch = virEventAddHandle(file->pipefd,\n                                             VIR_EVENT_HANDLE_READABLE,\n                                             virLogHandlerDomainLogFileEvent,\n                                             handler,\n                                             NULL)) < 0) {\n            VIR_DELETE_ELEMENT(handler->files, handler->nfiles - 1, handler->nfiles);\n            goto error;\n        }\n    }\n\n\n    return handler;\n\n error:\n    virObjectUnref(handler);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed daemon data from JSON file\")"
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Malformed daemon data from JSON file\""
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "object",
            "\"handler\""
          ],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonNewPostExecRestart",
          "args": [
            "child",
            "G_N_ELEMENTS(serverNames)",
            "serverNames",
            "virLogDaemonNewServerPostExecRestart",
            "(void*)(intptr_t)(privileged ? 0x1 : 0x0)"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonNewPostExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "293-369",
          "snippet": "virNetDaemonPtr\nvirNetDaemonNewPostExecRestart(virJSONValuePtr object,\n                               size_t nDefServerNames,\n                               const char **defServerNames,\n                               virNetDaemonNewServerPostExecRestart cb,\n                               void *opaque)\n{\n    virNetDaemonPtr dmn = NULL;\n    virJSONValuePtr servers = virJSONValueObjectGet(object, \"servers\");\n    bool new_version = virJSONValueObjectHasKey(object, \"servers\");\n\n    if (!(dmn = virNetDaemonNew()))\n        goto error;\n\n    if (new_version && !servers) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed servers data in JSON document\"));\n        goto error;\n    }\n\n    if (!new_version) {\n        virNetServerPtr srv;\n\n        if (nDefServerNames < 1) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"No default server names provided\"));\n            goto error;\n        }\n\n        VIR_DEBUG(\"No 'servers' data, creating default '%s' name\", defServerNames[0]);\n\n        srv = cb(dmn, defServerNames[0], object, opaque);\n\n        if (virHashAddEntry(dmn->servers, defServerNames[0], srv) < 0)\n            goto error;\n    } else if (virJSONValueIsArray(servers)) {\n        size_t i;\n        size_t n = virJSONValueArraySize(servers);\n        if (n > nDefServerNames) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Server count %zd greater than default name count %zu\"),\n                           n, nDefServerNames);\n            goto error;\n        }\n\n        for (i = 0; i < n; i++) {\n            virNetServerPtr srv;\n            virJSONValuePtr value = virJSONValueArrayGet(servers, i);\n\n            VIR_DEBUG(\"Creating server '%s'\", defServerNames[i]);\n            srv = cb(dmn, defServerNames[i], value, opaque);\n            if (!srv)\n                goto error;\n\n            if (virHashAddEntry(dmn->servers, defServerNames[i], srv) < 0) {\n                virObjectUnref(srv);\n                goto error;\n            }\n        }\n    } else {\n        struct virNetDaemonServerData data = {\n            dmn,\n            cb,\n            opaque,\n        };\n        if (virJSONValueObjectForeachKeyValue(servers,\n                                              virNetDaemonServerIterator,\n                                              &data) < 0)\n            goto error;\n    }\n\n    return dmn;\n\n error:\n    virObjectUnref(dmn);\n    return NULL;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNetDaemonPtr\nvirNetDaemonNewPostExecRestart(virJSONValuePtr object,\n                               size_t nDefServerNames,\n                               const char **defServerNames,\n                               virNetDaemonNewServerPostExecRestart cb,\n                               void *opaque)\n{\n    virNetDaemonPtr dmn = NULL;\n    virJSONValuePtr servers = virJSONValueObjectGet(object, \"servers\");\n    bool new_version = virJSONValueObjectHasKey(object, \"servers\");\n\n    if (!(dmn = virNetDaemonNew()))\n        goto error;\n\n    if (new_version && !servers) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed servers data in JSON document\"));\n        goto error;\n    }\n\n    if (!new_version) {\n        virNetServerPtr srv;\n\n        if (nDefServerNames < 1) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"No default server names provided\"));\n            goto error;\n        }\n\n        VIR_DEBUG(\"No 'servers' data, creating default '%s' name\", defServerNames[0]);\n\n        srv = cb(dmn, defServerNames[0], object, opaque);\n\n        if (virHashAddEntry(dmn->servers, defServerNames[0], srv) < 0)\n            goto error;\n    } else if (virJSONValueIsArray(servers)) {\n        size_t i;\n        size_t n = virJSONValueArraySize(servers);\n        if (n > nDefServerNames) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Server count %zd greater than default name count %zu\"),\n                           n, nDefServerNames);\n            goto error;\n        }\n\n        for (i = 0; i < n; i++) {\n            virNetServerPtr srv;\n            virJSONValuePtr value = virJSONValueArrayGet(servers, i);\n\n            VIR_DEBUG(\"Creating server '%s'\", defServerNames[i]);\n            srv = cb(dmn, defServerNames[i], value, opaque);\n            if (!srv)\n                goto error;\n\n            if (virHashAddEntry(dmn->servers, defServerNames[i], srv) < 0) {\n                virObjectUnref(srv);\n                goto error;\n            }\n        }\n    } else {\n        struct virNetDaemonServerData data = {\n            dmn,\n            cb,\n            opaque,\n        };\n        if (virJSONValueObjectForeachKeyValue(servers,\n                                              virNetDaemonServerIterator,\n                                              &data) < 0)\n            goto error;\n    }\n\n    return dmn;\n\n error:\n    virObjectUnref(dmn);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "serverNames"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed daemon data from JSON file\")"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "logd"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Unable to initialize mutex\")"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexInit",
          "args": [
            "&logd->lock"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "logd"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virLogDaemonPtr\nvirLogDaemonNewPostExecRestart(virJSONValuePtr object, bool privileged,\n                               virLogDaemonConfigPtr config)\n{\n    virLogDaemonPtr logd;\n    virJSONValuePtr child;\n    const char *serverNames[] = { \"virtlogd\" };\n\n    if (VIR_ALLOC(logd) < 0)\n        return NULL;\n\n    if (virMutexInit(&logd->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        VIR_FREE(logd);\n        return NULL;\n    }\n\n    if (!(child = virJSONValueObjectGet(object, \"daemon\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed daemon data from JSON file\"));\n        goto error;\n    }\n\n    if (!(logd->dmn = virNetDaemonNewPostExecRestart(child,\n                                                     G_N_ELEMENTS(serverNames),\n                                                     serverNames,\n                                                     virLogDaemonNewServerPostExecRestart,\n                                                     (void*)(intptr_t)(privileged ? 0x1 : 0x0))))\n        goto error;\n\n    if (!(child = virJSONValueObjectGet(object, \"handler\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed daemon data from JSON file\"));\n        goto error;\n    }\n\n    if (!(logd->handler = virLogHandlerNewPostExecRestart(child,\n                                                          privileged,\n                                                          config->max_size,\n                                                          config->max_backups,\n                                                          virLogDaemonInhibitor,\n                                                          logd)))\n        goto error;\n\n    return logd;\n\n error:\n    virLogDaemonFree(logd);\n    return NULL;\n}"
  },
  {
    "function_name": "virLogDaemonNewServerPostExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "213-241",
    "snippet": "static virNetServerPtr\nvirLogDaemonNewServerPostExecRestart(virNetDaemonPtr dmn,\n                                     const char *name,\n                                     virJSONValuePtr object,\n                                     void *opaque)\n{\n    if (STREQ(name, \"virtlogd\")) {\n        return virNetServerNewPostExecRestart(object,\n                                              name,\n                                              virLogDaemonClientNew,\n                                              virLogDaemonClientNewPostExecRestart,\n                                              virLogDaemonClientPreExecRestart,\n                                              virLogDaemonClientFree,\n                                              opaque);\n    } else if (STREQ(name, \"admin\")) {\n        return virNetServerNewPostExecRestart(object,\n                                              name,\n                                              remoteAdmClientNew,\n                                              remoteAdmClientNewPostExecRestart,\n                                              remoteAdmClientPreExecRestart,\n                                              remoteAdmClientFree,\n                                              dmn);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected server name '%s' during restart\"),\n                       name);\n        return NULL;\n    }\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unexpected server name '%s' during restart\")",
            "name"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unexpected server name '%s' during restart\""
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerNewPostExecRestart",
          "args": [
            "object",
            "name",
            "remoteAdmClientNew",
            "remoteAdmClientNewPostExecRestart",
            "remoteAdmClientPreExecRestart",
            "remoteAdmClientFree",
            "dmn"
          ],
          "line": 228
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerNewPostExecRestart",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserver.c",
          "lines": "397-546",
          "snippet": "virNetServerPtr virNetServerNewPostExecRestart(virJSONValuePtr object,\n                                               const char *name,\n                                               virNetServerClientPrivNew clientPrivNew,\n                                               virNetServerClientPrivNewPostExecRestart clientPrivNewPostExecRestart,\n                                               virNetServerClientPrivPreExecRestart clientPrivPreExecRestart,\n                                               virFreeCallback clientPrivFree,\n                                               void *clientPrivOpaque)\n{\n    virNetServerPtr srv = NULL;\n    virJSONValuePtr clients;\n    virJSONValuePtr services;\n    size_t i;\n    unsigned int min_workers;\n    unsigned int max_workers;\n    unsigned int priority_workers;\n    unsigned int max_clients;\n    unsigned int max_anonymous_clients;\n    unsigned int keepaliveInterval;\n    unsigned int keepaliveCount;\n    unsigned long long next_client_id;\n\n    if (virJSONValueObjectGetNumberUint(object, \"min_workers\", &min_workers) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing min_workers data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"max_workers\", &max_workers) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing max_workers data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"priority_workers\", &priority_workers) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing priority_workers data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"max_clients\", &max_clients) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing max_clients data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectHasKey(object, \"max_anonymous_clients\")) {\n        if (virJSONValueObjectGetNumberUint(object, \"max_anonymous_clients\",\n                                            &max_anonymous_clients) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Malformed max_anonymous_clients data in JSON document\"));\n            goto error;\n        }\n    } else {\n        max_anonymous_clients = max_clients;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"keepaliveInterval\", &keepaliveInterval) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing keepaliveInterval data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"keepaliveCount\", &keepaliveCount) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing keepaliveCount data in JSON document\"));\n        goto error;\n    }\n\n    if (virJSONValueObjectGetNumberUlong(object, \"next_client_id\",\n                                         &next_client_id) < 0) {\n        VIR_WARN(\"Missing next_client_id data in JSON document\");\n        next_client_id = 1;\n    }\n\n    if (!(srv = virNetServerNew(name, next_client_id,\n                                min_workers, max_workers,\n                                priority_workers, max_clients,\n                                max_anonymous_clients,\n                                keepaliveInterval, keepaliveCount,\n                                clientPrivNew, clientPrivPreExecRestart,\n                                clientPrivFree, clientPrivOpaque)))\n        goto error;\n\n    if (!(services = virJSONValueObjectGet(object, \"services\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing services data in JSON document\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(services)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed services array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(services); i++) {\n        virNetServerServicePtr service;\n        virJSONValuePtr child = virJSONValueArrayGet(services, i);\n        if (!child) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing service data in JSON document\"));\n            goto error;\n        }\n\n        if (!(service = virNetServerServiceNewPostExecRestart(child)))\n            goto error;\n\n        if (virNetServerAddService(srv, service) < 0) {\n            virObjectUnref(service);\n            goto error;\n        }\n    }\n\n\n    if (!(clients = virJSONValueObjectGet(object, \"clients\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing clients data in JSON document\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(clients)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed clients array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(clients); i++) {\n        virNetServerClientPtr client;\n        virJSONValuePtr child = virJSONValueArrayGet(clients, i);\n        if (!child) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing client data in JSON document\"));\n            goto error;\n        }\n\n        if (!(client = virNetServerClientNewPostExecRestart(srv,\n                                                            child,\n                                                            clientPrivNewPostExecRestart,\n                                                            clientPrivPreExecRestart,\n                                                            clientPrivFree,\n                                                            clientPrivOpaque)))\n            goto error;\n\n        if (virNetServerAddClient(srv, client) < 0) {\n            virObjectUnref(client);\n            goto error;\n        }\n        virObjectUnref(client);\n    }\n\n    return srv;\n\n error:\n    virObjectUnref(srv);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserver.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);",
            "static inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetserver.h\"\n#include <config.h>\n\nstatic inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);\nstatic inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);\n\nvirNetServerPtr virNetServerNewPostExecRestart(virJSONValuePtr object,\n                                               const char *name,\n                                               virNetServerClientPrivNew clientPrivNew,\n                                               virNetServerClientPrivNewPostExecRestart clientPrivNewPostExecRestart,\n                                               virNetServerClientPrivPreExecRestart clientPrivPreExecRestart,\n                                               virFreeCallback clientPrivFree,\n                                               void *clientPrivOpaque)\n{\n    virNetServerPtr srv = NULL;\n    virJSONValuePtr clients;\n    virJSONValuePtr services;\n    size_t i;\n    unsigned int min_workers;\n    unsigned int max_workers;\n    unsigned int priority_workers;\n    unsigned int max_clients;\n    unsigned int max_anonymous_clients;\n    unsigned int keepaliveInterval;\n    unsigned int keepaliveCount;\n    unsigned long long next_client_id;\n\n    if (virJSONValueObjectGetNumberUint(object, \"min_workers\", &min_workers) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing min_workers data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"max_workers\", &max_workers) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing max_workers data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"priority_workers\", &priority_workers) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing priority_workers data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"max_clients\", &max_clients) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing max_clients data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectHasKey(object, \"max_anonymous_clients\")) {\n        if (virJSONValueObjectGetNumberUint(object, \"max_anonymous_clients\",\n                                            &max_anonymous_clients) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Malformed max_anonymous_clients data in JSON document\"));\n            goto error;\n        }\n    } else {\n        max_anonymous_clients = max_clients;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"keepaliveInterval\", &keepaliveInterval) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing keepaliveInterval data in JSON document\"));\n        goto error;\n    }\n    if (virJSONValueObjectGetNumberUint(object, \"keepaliveCount\", &keepaliveCount) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing keepaliveCount data in JSON document\"));\n        goto error;\n    }\n\n    if (virJSONValueObjectGetNumberUlong(object, \"next_client_id\",\n                                         &next_client_id) < 0) {\n        VIR_WARN(\"Missing next_client_id data in JSON document\");\n        next_client_id = 1;\n    }\n\n    if (!(srv = virNetServerNew(name, next_client_id,\n                                min_workers, max_workers,\n                                priority_workers, max_clients,\n                                max_anonymous_clients,\n                                keepaliveInterval, keepaliveCount,\n                                clientPrivNew, clientPrivPreExecRestart,\n                                clientPrivFree, clientPrivOpaque)))\n        goto error;\n\n    if (!(services = virJSONValueObjectGet(object, \"services\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing services data in JSON document\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(services)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed services array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(services); i++) {\n        virNetServerServicePtr service;\n        virJSONValuePtr child = virJSONValueArrayGet(services, i);\n        if (!child) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing service data in JSON document\"));\n            goto error;\n        }\n\n        if (!(service = virNetServerServiceNewPostExecRestart(child)))\n            goto error;\n\n        if (virNetServerAddService(srv, service) < 0) {\n            virObjectUnref(service);\n            goto error;\n        }\n    }\n\n\n    if (!(clients = virJSONValueObjectGet(object, \"clients\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing clients data in JSON document\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(clients)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed clients array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(clients); i++) {\n        virNetServerClientPtr client;\n        virJSONValuePtr child = virJSONValueArrayGet(clients, i);\n        if (!child) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing client data in JSON document\"));\n            goto error;\n        }\n\n        if (!(client = virNetServerClientNewPostExecRestart(srv,\n                                                            child,\n                                                            clientPrivNewPostExecRestart,\n                                                            clientPrivPreExecRestart,\n                                                            clientPrivFree,\n                                                            clientPrivOpaque)))\n            goto error;\n\n        if (virNetServerAddClient(srv, client) < 0) {\n            virObjectUnref(client);\n            goto error;\n        }\n        virObjectUnref(client);\n    }\n\n    return srv;\n\n error:\n    virObjectUnref(srv);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "name",
            "\"admin\""
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "name",
            "\"virtlogd\""
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic virNetServerPtr\nvirLogDaemonNewServerPostExecRestart(virNetDaemonPtr dmn,\n                                     const char *name,\n                                     virJSONValuePtr object,\n                                     void *opaque)\n{\n    if (STREQ(name, \"virtlogd\")) {\n        return virNetServerNewPostExecRestart(object,\n                                              name,\n                                              virLogDaemonClientNew,\n                                              virLogDaemonClientNewPostExecRestart,\n                                              virLogDaemonClientPreExecRestart,\n                                              virLogDaemonClientFree,\n                                              opaque);\n    } else if (STREQ(name, \"admin\")) {\n        return virNetServerNewPostExecRestart(object,\n                                              name,\n                                              remoteAdmClientNew,\n                                              remoteAdmClientNewPostExecRestart,\n                                              remoteAdmClientPreExecRestart,\n                                              remoteAdmClientFree,\n                                              dmn);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected server name '%s' during restart\"),\n                       name);\n        return NULL;\n    }\n}"
  },
  {
    "function_name": "virLogDaemonGetHandler",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "206-210",
    "snippet": "virLogHandlerPtr\nvirLogDaemonGetHandler(virLogDaemonPtr dmn)\n{\n    return dmn->handler;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirLogHandlerPtr\nvirLogDaemonGetHandler(virLogDaemonPtr dmn)\n{\n    return dmn->handler;\n}"
  },
  {
    "function_name": "virLogDaemonNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "143-203",
    "snippet": "static virLogDaemonPtr\nvirLogDaemonNew(virLogDaemonConfigPtr config, bool privileged)\n{\n    virLogDaemonPtr logd;\n    virNetServerPtr srv = NULL;\n\n    if (VIR_ALLOC(logd) < 0)\n        return NULL;\n\n    if (virMutexInit(&logd->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        VIR_FREE(logd);\n        return NULL;\n    }\n\n    if (!(logd->dmn = virNetDaemonNew()))\n        goto error;\n\n    if (!(srv = virNetServerNew(\"virtlogd\", 1,\n                                0, 0, 0, config->max_clients,\n                                config->max_clients, -1, 0,\n                                virLogDaemonClientNew,\n                                virLogDaemonClientPreExecRestart,\n                                virLogDaemonClientFree,\n                                (void*)(intptr_t)(privileged ? 0x1 : 0x0))))\n        goto error;\n\n    if (virNetDaemonAddServer(logd->dmn, srv) < 0)\n        goto error;\n    virObjectUnref(srv);\n    srv = NULL;\n\n    if (!(srv = virNetServerNew(\"admin\", 1,\n                                0, 0, 0, config->admin_max_clients,\n                                config->admin_max_clients, -1, 0,\n                                remoteAdmClientNew,\n                                remoteAdmClientPreExecRestart,\n                                remoteAdmClientFree,\n                                logd->dmn)))\n        goto error;\n\n    if (virNetDaemonAddServer(logd->dmn, srv) < 0)\n        goto error;\n    virObjectUnref(srv);\n    srv = NULL;\n\n    if (!(logd->handler = virLogHandlerNew(privileged,\n                                           config->max_size,\n                                           config->max_backups,\n                                           virLogDaemonInhibitor,\n                                           logd)))\n        goto error;\n\n    return logd;\n\n error:\n    virObjectUnref(srv);\n    virLogDaemonFree(logd);\n    return NULL;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLogDaemonFree",
          "args": [
            "logd"
          ],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "virLogDaemonFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
          "lines": "112-123",
          "snippet": "static void\nvirLogDaemonFree(virLogDaemonPtr logd)\n{\n    if (!logd)\n        return;\n\n    virObjectUnref(logd->handler);\n    virMutexDestroy(&logd->lock);\n    virObjectUnref(logd->dmn);\n\n    VIR_FREE(logd);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"log_protocol.h\"",
            "#include \"log_daemon_dispatch.h\"",
            "#include \"virenum.h\"",
            "#include \"virgettext.h\"",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"virhash.h\"",
            "#include \"virrandom.h\"",
            "#include \"rpc/virnetdaemon.h\"",
            "#include \"virconf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"admin/admin_server_dispatch.h\"",
            "#include \"log_daemon_config.h\"",
            "#include \"log_daemon.h\"",
            "#include <getopt.h>",
            "#include <sys/stat.h>",
            "#include <sys/wait.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonFree(virLogDaemonPtr logd)\n{\n    if (!logd)\n        return;\n\n    virObjectUnref(logd->handler);\n    virMutexDestroy(&logd->lock);\n    virObjectUnref(logd->dmn);\n\n    VIR_FREE(logd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "srv"
          ],
          "line": 200
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogHandlerNew",
          "args": [
            "privileged",
            "config->max_size",
            "config->max_backups",
            "virLogDaemonInhibitor",
            "logd"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "virLogHandlerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_handler.c",
          "lines": "190-212",
          "snippet": "virLogHandlerPtr\nvirLogHandlerNew(bool privileged,\n                 size_t max_size,\n                 size_t max_backups,\n                 virLogHandlerShutdownInhibitor inhibitor,\n                 void *opaque)\n{\n    virLogHandlerPtr handler;\n\n    if (virLogHandlerInitialize() < 0)\n        return NULL;\n\n    if (!(handler = virObjectLockableNew(virLogHandlerClass)))\n        return NULL;\n\n    handler->privileged = privileged;\n    handler->max_size = max_size;\n    handler->max_backups = max_backups;\n    handler->inhibitor = inhibitor;\n    handler->opaque = opaque;\n\n    return handler;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <poll.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virutil.h\"",
            "#include \"viruuid.h\"",
            "#include \"virrotatingfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"log_handler.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virLogHandlerClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <poll.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virutil.h\"\n#include \"viruuid.h\"\n#include \"virrotatingfile.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"log_handler.h\"\n#include <config.h>\n\nstatic virClassPtr virLogHandlerClass;\n\nvirLogHandlerPtr\nvirLogHandlerNew(bool privileged,\n                 size_t max_size,\n                 size_t max_backups,\n                 virLogHandlerShutdownInhibitor inhibitor,\n                 void *opaque)\n{\n    virLogHandlerPtr handler;\n\n    if (virLogHandlerInitialize() < 0)\n        return NULL;\n\n    if (!(handler = virObjectLockableNew(virLogHandlerClass)))\n        return NULL;\n\n    handler->privileged = privileged;\n    handler->max_size = max_size;\n    handler->max_backups = max_backups;\n    handler->inhibitor = inhibitor;\n    handler->opaque = opaque;\n\n    return handler;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonAddServer",
          "args": [
            "logd->dmn",
            "srv"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonAddServer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "161-179",
          "snippet": "int\nvirNetDaemonAddServer(virNetDaemonPtr dmn,\n                      virNetServerPtr srv)\n{\n    int ret = -1;\n    const char *serverName = virNetServerGetName(srv);\n\n    virObjectLock(dmn);\n\n    if (virHashAddEntry(dmn->servers, serverName, srv) < 0)\n        goto cleanup;\n\n    virObjectRef(srv);\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(dmn);\n    return ret;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNetDaemonAddServer(virNetDaemonPtr dmn,\n                      virNetServerPtr srv)\n{\n    int ret = -1;\n    const char *serverName = virNetServerGetName(srv);\n\n    virObjectLock(dmn);\n\n    if (virHashAddEntry(dmn->servers, serverName, srv) < 0)\n        goto cleanup;\n\n    virObjectRef(srv);\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(dmn);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetServerNew",
          "args": [
            "\"admin\"",
            "1",
            "0",
            "0",
            "0",
            "config->admin_max_clients",
            "config->admin_max_clients",
            "-1",
            "0",
            "remoteAdmClientNew",
            "remoteAdmClientPreExecRestart",
            "remoteAdmClientFree",
            "logd->dmn"
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "virNetServerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetserver.c",
          "lines": "349-394",
          "snippet": "virNetServerPtr virNetServerNew(const char *name,\n                                unsigned long long next_client_id,\n                                size_t min_workers,\n                                size_t max_workers,\n                                size_t priority_workers,\n                                size_t max_clients,\n                                size_t max_anonymous_clients,\n                                int keepaliveInterval,\n                                unsigned int keepaliveCount,\n                                virNetServerClientPrivNew clientPrivNew,\n                                virNetServerClientPrivPreExecRestart clientPrivPreExecRestart,\n                                virFreeCallback clientPrivFree,\n                                void *clientPrivOpaque)\n{\n    virNetServerPtr srv;\n\n    if (virNetServerInitialize() < 0)\n        return NULL;\n\n    if (!(srv = virObjectLockableNew(virNetServerClass)))\n        return NULL;\n\n    if (!(srv->workers = virThreadPoolNewFull(min_workers, max_workers,\n                                              priority_workers,\n                                              virNetServerHandleJob,\n                                              \"rpc-worker\",\n                                              srv)))\n        goto error;\n\n    srv->name = g_strdup(name);\n\n    srv->next_client_id = next_client_id;\n    srv->nclients_max = max_clients;\n    srv->nclients_unauth_max = max_anonymous_clients;\n    srv->keepaliveInterval = keepaliveInterval;\n    srv->keepaliveCount = keepaliveCount;\n    srv->clientPrivNew = clientPrivNew;\n    srv->clientPrivPreExecRestart = clientPrivPreExecRestart;\n    srv->clientPrivFree = clientPrivFree;\n    srv->clientPrivOpaque = clientPrivOpaque;\n\n    return srv;\n error:\n    virObjectUnref(srv);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetserver.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virNetServerClass;",
            "static inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);",
            "static inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetserver.h\"\n#include <config.h>\n\nstatic virClassPtr virNetServerClass;\nstatic inline size_t virNetServerTrackPendingAuthLocked(virNetServerPtr srv);\nstatic inline size_t virNetServerTrackCompletedAuthLocked(virNetServerPtr srv);\n\nvirNetServerPtr virNetServerNew(const char *name,\n                                unsigned long long next_client_id,\n                                size_t min_workers,\n                                size_t max_workers,\n                                size_t priority_workers,\n                                size_t max_clients,\n                                size_t max_anonymous_clients,\n                                int keepaliveInterval,\n                                unsigned int keepaliveCount,\n                                virNetServerClientPrivNew clientPrivNew,\n                                virNetServerClientPrivPreExecRestart clientPrivPreExecRestart,\n                                virFreeCallback clientPrivFree,\n                                void *clientPrivOpaque)\n{\n    virNetServerPtr srv;\n\n    if (virNetServerInitialize() < 0)\n        return NULL;\n\n    if (!(srv = virObjectLockableNew(virNetServerClass)))\n        return NULL;\n\n    if (!(srv->workers = virThreadPoolNewFull(min_workers, max_workers,\n                                              priority_workers,\n                                              virNetServerHandleJob,\n                                              \"rpc-worker\",\n                                              srv)))\n        goto error;\n\n    srv->name = g_strdup(name);\n\n    srv->next_client_id = next_client_id;\n    srv->nclients_max = max_clients;\n    srv->nclients_unauth_max = max_anonymous_clients;\n    srv->keepaliveInterval = keepaliveInterval;\n    srv->keepaliveCount = keepaliveCount;\n    srv->clientPrivNew = clientPrivNew;\n    srv->clientPrivPreExecRestart = clientPrivPreExecRestart;\n    srv->clientPrivFree = clientPrivFree;\n    srv->clientPrivOpaque = clientPrivOpaque;\n\n    return srv;\n error:\n    virObjectUnref(srv);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonNew",
          "args": [],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "120-158",
          "snippet": "virNetDaemonPtr\nvirNetDaemonNew(void)\n{\n    virNetDaemonPtr dmn;\n#ifndef WIN32\n    struct sigaction sig_action;\n#endif /* !WIN32 */\n\n    if (virNetDaemonInitialize() < 0)\n        return NULL;\n\n    if (!(dmn = virObjectLockableNew(virNetDaemonClass)))\n        return NULL;\n\n    if (!(dmn->servers = virHashCreate(5, virObjectFreeHashData)))\n        goto error;\n\n#ifndef WIN32\n    dmn->sigwrite = dmn->sigread = -1;\n#endif /* !WIN32 */\n\n    dmn->privileged = geteuid() == 0;\n    dmn->autoShutdownInhibitFd = -1;\n\n    if (virEventRegisterDefaultImpl() < 0)\n        goto error;\n\n#ifndef WIN32\n    memset(&sig_action, 0, sizeof(sig_action));\n    sig_action.sa_handler = SIG_IGN;\n    sigaction(SIGPIPE, &sig_action, NULL);\n#endif /* !WIN32 */\n\n    return dmn;\n\n error:\n    virObjectUnref(dmn);\n    return NULL;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virNetDaemonClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virClassPtr virNetDaemonClass;\n\nvirNetDaemonPtr\nvirNetDaemonNew(void)\n{\n    virNetDaemonPtr dmn;\n#ifndef WIN32\n    struct sigaction sig_action;\n#endif /* !WIN32 */\n\n    if (virNetDaemonInitialize() < 0)\n        return NULL;\n\n    if (!(dmn = virObjectLockableNew(virNetDaemonClass)))\n        return NULL;\n\n    if (!(dmn->servers = virHashCreate(5, virObjectFreeHashData)))\n        goto error;\n\n#ifndef WIN32\n    dmn->sigwrite = dmn->sigread = -1;\n#endif /* !WIN32 */\n\n    dmn->privileged = geteuid() == 0;\n    dmn->autoShutdownInhibitFd = -1;\n\n    if (virEventRegisterDefaultImpl() < 0)\n        goto error;\n\n#ifndef WIN32\n    memset(&sig_action, 0, sizeof(sig_action));\n    sig_action.sa_handler = SIG_IGN;\n    sigaction(SIGPIPE, &sig_action, NULL);\n#endif /* !WIN32 */\n\n    return dmn;\n\n error:\n    virObjectUnref(dmn);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "logd"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Unable to initialize mutex\")"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to initialize mutex\""
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexInit",
          "args": [
            "&logd->lock"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "logd"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virLogDaemonPtr\nvirLogDaemonNew(virLogDaemonConfigPtr config, bool privileged)\n{\n    virLogDaemonPtr logd;\n    virNetServerPtr srv = NULL;\n\n    if (VIR_ALLOC(logd) < 0)\n        return NULL;\n\n    if (virMutexInit(&logd->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        VIR_FREE(logd);\n        return NULL;\n    }\n\n    if (!(logd->dmn = virNetDaemonNew()))\n        goto error;\n\n    if (!(srv = virNetServerNew(\"virtlogd\", 1,\n                                0, 0, 0, config->max_clients,\n                                config->max_clients, -1, 0,\n                                virLogDaemonClientNew,\n                                virLogDaemonClientPreExecRestart,\n                                virLogDaemonClientFree,\n                                (void*)(intptr_t)(privileged ? 0x1 : 0x0))))\n        goto error;\n\n    if (virNetDaemonAddServer(logd->dmn, srv) < 0)\n        goto error;\n    virObjectUnref(srv);\n    srv = NULL;\n\n    if (!(srv = virNetServerNew(\"admin\", 1,\n                                0, 0, 0, config->admin_max_clients,\n                                config->admin_max_clients, -1, 0,\n                                remoteAdmClientNew,\n                                remoteAdmClientPreExecRestart,\n                                remoteAdmClientFree,\n                                logd->dmn)))\n        goto error;\n\n    if (virNetDaemonAddServer(logd->dmn, srv) < 0)\n        goto error;\n    virObjectUnref(srv);\n    srv = NULL;\n\n    if (!(logd->handler = virLogHandlerNew(privileged,\n                                           config->max_size,\n                                           config->max_backups,\n                                           virLogDaemonInhibitor,\n                                           logd)))\n        goto error;\n\n    return logd;\n\n error:\n    virObjectUnref(srv);\n    virLogDaemonFree(logd);\n    return NULL;\n}"
  },
  {
    "function_name": "virLogDaemonInhibitor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "126-141",
    "snippet": "static void\nvirLogDaemonInhibitor(bool inhibit, void *opaque)\n{\n    virLogDaemonPtr dmn = opaque;\n\n    /* virtlogd uses inhibition only to stop session daemon being killed after\n     * the specified timeout, for the system daemon this is taken care of by\n     * libvirtd and the dependencies between the services. */\n    if (virNetDaemonIsPrivileged(dmn->dmn))\n        return;\n\n    if (inhibit)\n        virNetDaemonAddShutdownInhibition(dmn->dmn);\n    else\n        virNetDaemonRemoveShutdownInhibition(dmn->dmn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);",
      "static void\nvirLogDaemonClientFree(void *opaque);",
      "static void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);",
      "static virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDaemonRemoveShutdownInhibition",
          "args": [
            "dmn->dmn"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonRemoveShutdownInhibition",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "576-590",
          "snippet": "void\nvirNetDaemonRemoveShutdownInhibition(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n    dmn->autoShutdownInhibitions--;\n\n    VIR_DEBUG(\"dmn=%p inhibitions=%zu\", dmn, dmn->autoShutdownInhibitions);\n\n    if (dmn->autoShutdownInhibitions == 0) {\n        VIR_DEBUG(\"Closing inhibit FD %d\", dmn->autoShutdownInhibitFd);\n        VIR_FORCE_CLOSE(dmn->autoShutdownInhibitFd);\n    }\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonRemoveShutdownInhibition(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n    dmn->autoShutdownInhibitions--;\n\n    VIR_DEBUG(\"dmn=%p inhibitions=%zu\", dmn, dmn->autoShutdownInhibitions);\n\n    if (dmn->autoShutdownInhibitions == 0) {\n        VIR_DEBUG(\"Closing inhibit FD %d\", dmn->autoShutdownInhibitFd);\n        VIR_FORCE_CLOSE(dmn->autoShutdownInhibitFd);\n    }\n\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonAddShutdownInhibition",
          "args": [
            "dmn->dmn"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonAddShutdownInhibition",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "555-573",
          "snippet": "void\nvirNetDaemonAddShutdownInhibition(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n    dmn->autoShutdownInhibitions++;\n\n    VIR_DEBUG(\"dmn=%p inhibitions=%zu\", dmn, dmn->autoShutdownInhibitions);\n\n#if defined(WITH_DBUS) && defined(DBUS_TYPE_UNIX_FD)\n    if (dmn->autoShutdownInhibitions == 1)\n        virNetDaemonCallInhibit(dmn,\n                                \"shutdown\",\n                                _(\"Libvirt\"),\n                                _(\"Virtual machines need to be saved\"),\n                                \"delay\");\n#endif\n\n    virObjectUnlock(dmn);\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirNetDaemonAddShutdownInhibition(virNetDaemonPtr dmn)\n{\n    virObjectLock(dmn);\n    dmn->autoShutdownInhibitions++;\n\n    VIR_DEBUG(\"dmn=%p inhibitions=%zu\", dmn, dmn->autoShutdownInhibitions);\n\n#if defined(WITH_DBUS) && defined(DBUS_TYPE_UNIX_FD)\n    if (dmn->autoShutdownInhibitions == 1)\n        virNetDaemonCallInhibit(dmn,\n                                \"shutdown\",\n                                _(\"Libvirt\"),\n                                _(\"Virtual machines need to be saved\"),\n                                \"delay\");\n#endif\n\n    virObjectUnlock(dmn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDaemonIsPrivileged",
          "args": [
            "dmn->dmn"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDaemonIsPrivileged",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/rpc/virnetdaemon.c",
          "lines": "429-437",
          "snippet": "bool\nvirNetDaemonIsPrivileged(virNetDaemonPtr dmn)\n{\n    bool priv;\n    virObjectLock(dmn);\n    priv = dmn->privileged;\n    virObjectUnlock(dmn);\n    return priv;\n}",
          "includes": [
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhash.h\"",
            "#include \"virdbus.h\"",
            "#include \"virnetserver.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"virthread.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virnetdaemon.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhash.h\"\n#include \"virdbus.h\"\n#include \"virnetserver.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virthreadpool.h\"\n#include \"virthread.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virnetdaemon.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nbool\nvirNetDaemonIsPrivileged(virNetDaemonPtr dmn)\n{\n    bool priv;\n    virObjectLock(dmn);\n    priv = dmn->privileged;\n    virObjectUnlock(dmn);\n    return priv;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void *\nvirLogDaemonClientNew(virNetServerClientPtr client,\n                      void *opaque);\nstatic void\nvirLogDaemonClientFree(void *opaque);\nstatic void *\nvirLogDaemonClientNewPostExecRestart(virNetServerClientPtr client,\n                                     virJSONValuePtr object,\n                                     void *opaque);\nstatic virJSONValuePtr\nvirLogDaemonClientPreExecRestart(virNetServerClientPtr client,\n                                 void *opaque);\n\nstatic void\nvirLogDaemonInhibitor(bool inhibit, void *opaque)\n{\n    virLogDaemonPtr dmn = opaque;\n\n    /* virtlogd uses inhibition only to stop session daemon being killed after\n     * the specified timeout, for the system daemon this is taken care of by\n     * libvirtd and the dependencies between the services. */\n    if (virNetDaemonIsPrivileged(dmn->dmn))\n        return;\n\n    if (inhibit)\n        virNetDaemonAddShutdownInhibition(dmn->dmn);\n    else\n        virNetDaemonRemoveShutdownInhibition(dmn->dmn);\n}"
  },
  {
    "function_name": "virLogDaemonFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/logging/log_daemon.c",
    "lines": "112-123",
    "snippet": "static void\nvirLogDaemonFree(virLogDaemonPtr logd)\n{\n    if (!logd)\n        return;\n\n    virObjectUnref(logd->handler);\n    virMutexDestroy(&logd->lock);\n    virObjectUnref(logd->dmn);\n\n    VIR_FREE(logd);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"log_protocol.h\"",
      "#include \"log_daemon_dispatch.h\"",
      "#include \"virenum.h\"",
      "#include \"virgettext.h\"",
      "#include \"virstring.h\"",
      "#include \"viruuid.h\"",
      "#include \"virhash.h\"",
      "#include \"virrandom.h\"",
      "#include \"rpc/virnetdaemon.h\"",
      "#include \"virconf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virprocess.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"admin/admin_server_dispatch.h\"",
      "#include \"log_daemon_config.h\"",
      "#include \"log_daemon.h\"",
      "#include <getopt.h>",
      "#include <sys/stat.h>",
      "#include <sys/wait.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "logd"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "logd->dmn"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexDestroy",
          "args": [
            "&logd->lock"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "76-79",
          "snippet": "void virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"log_protocol.h\"\n#include \"log_daemon_dispatch.h\"\n#include \"virenum.h\"\n#include \"virgettext.h\"\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"virhash.h\"\n#include \"virrandom.h\"\n#include \"rpc/virnetdaemon.h\"\n#include \"virconf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"admin/admin_server_dispatch.h\"\n#include \"log_daemon_config.h\"\n#include \"log_daemon.h\"\n#include <getopt.h>\n#include <sys/stat.h>\n#include <sys/wait.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirLogDaemonFree(virLogDaemonPtr logd)\n{\n    if (!logd)\n        return;\n\n    virObjectUnref(logd->handler);\n    virMutexDestroy(&logd->lock);\n    virObjectUnref(logd->dmn);\n\n    VIR_FREE(logd);\n}"
  }
]