[
  {
    "function_name": "virPolkitAgentCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpolkit.c",
    "lines": "235-241",
    "snippet": "virPolkitAgentPtr\nvirPolkitAgentCreate(void)\n{\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"polkit text authentication agent unavailable\"));\n    return NULL;\n}",
    "includes": [
      "# include <poll.h>",
      "#include \"virutil.h\"",
      "#include \"virfile.h\"",
      "#include \"virdbus.h\"",
      "#include \"viralloc.h\"",
      "#include \"virprocess.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virpolkit.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"polkit text authentication agent unavailable\")"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"polkit text authentication agent unavailable\""
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <poll.h>\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virdbus.h\"\n#include \"viralloc.h\"\n#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virpolkit.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirPolkitAgentPtr\nvirPolkitAgentCreate(void)\n{\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"polkit text authentication agent unavailable\"));\n    return NULL;\n}"
  },
  {
    "function_name": "virPolkitAgentDestroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpolkit.c",
    "lines": "228-232",
    "snippet": "void\nvirPolkitAgentDestroy(virPolkitAgentPtr agent G_GNUC_UNUSED)\n{\n    return; /* do nothing */\n}",
    "includes": [
      "# include <poll.h>",
      "#include \"virutil.h\"",
      "#include \"virfile.h\"",
      "#include \"virdbus.h\"",
      "#include \"viralloc.h\"",
      "#include \"virprocess.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virpolkit.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "# include <poll.h>\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virdbus.h\"\n#include \"viralloc.h\"\n#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virpolkit.h\"\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirPolkitAgentDestroy(virPolkitAgentPtr agent G_GNUC_UNUSED)\n{\n    return; /* do nothing */\n}"
  },
  {
    "function_name": "virPolkitCheckAuth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpolkit.c",
    "lines": "214-225",
    "snippet": "int virPolkitCheckAuth(const char *actionid G_GNUC_UNUSED,\n                       pid_t pid G_GNUC_UNUSED,\n                       unsigned long long startTime G_GNUC_UNUSED,\n                       uid_t uid G_GNUC_UNUSED,\n                       const char **details G_GNUC_UNUSED,\n                       bool allowInteraction G_GNUC_UNUSED)\n{\n    VIR_ERROR(_(\"Polkit auth attempted, even though polkit is not available\"));\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"authentication failed\"));\n    return -1;\n}",
    "includes": [
      "# include <poll.h>",
      "#include \"virutil.h\"",
      "#include \"virfile.h\"",
      "#include \"virdbus.h\"",
      "#include \"viralloc.h\"",
      "#include \"virprocess.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virpolkit.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"authentication failed\")"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"authentication failed\""
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Polkit auth attempted, even though polkit is not available\")"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <poll.h>\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virdbus.h\"\n#include \"viralloc.h\"\n#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virpolkit.h\"\n#include <unistd.h>\n#include <config.h>\n\nint virPolkitCheckAuth(const char *actionid G_GNUC_UNUSED,\n                       pid_t pid G_GNUC_UNUSED,\n                       unsigned long long startTime G_GNUC_UNUSED,\n                       uid_t uid G_GNUC_UNUSED,\n                       const char **details G_GNUC_UNUSED,\n                       bool allowInteraction G_GNUC_UNUSED)\n{\n    VIR_ERROR(_(\"Polkit auth attempted, even though polkit is not available\"));\n    virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                   _(\"authentication failed\"));\n    return -1;\n}"
  },
  {
    "function_name": "virPolkitAgentCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpolkit.c",
    "lines": "164-209",
    "snippet": "virPolkitAgentPtr\nvirPolkitAgentCreate(void)\n{\n    virPolkitAgentPtr agent = NULL;\n    int pipe_fd[2] = {-1, -1};\n    struct pollfd pollfd;\n    int outfd = STDOUT_FILENO;\n    int errfd = STDERR_FILENO;\n\n    if (!isatty(STDIN_FILENO))\n        goto error;\n\n    if (virPipe(pipe_fd) < 0)\n        goto error;\n\n    if (VIR_ALLOC(agent) < 0)\n        goto error;\n\n    agent->cmd = virCommandNewArgList(PKTTYAGENT, \"--process\", NULL);\n\n    virCommandAddArgFormat(agent->cmd, \"%lld\", (long long int) getpid());\n    virCommandAddArg(agent->cmd, \"--notify-fd\");\n    virCommandAddArgFormat(agent->cmd, \"%d\", pipe_fd[1]);\n    virCommandAddArg(agent->cmd, \"--fallback\");\n    virCommandSetInputFD(agent->cmd, STDIN_FILENO);\n    virCommandSetOutputFD(agent->cmd, &outfd);\n    virCommandSetErrorFD(agent->cmd, &errfd);\n    virCommandPassFD(agent->cmd, pipe_fd[1], VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n    pipe_fd[1] = -1;\n    if (virCommandRunAsync(agent->cmd, NULL) < 0)\n        goto error;\n\n    pollfd.fd = pipe_fd[0];\n    pollfd.events = POLLHUP;\n\n    if (poll(&pollfd, 1, -1) < 0)\n        goto error;\n\n    return agent;\n\n error:\n    VIR_FORCE_CLOSE(pipe_fd[0]);\n    VIR_FORCE_CLOSE(pipe_fd[1]);\n    virPolkitAgentDestroy(agent);\n    return NULL;\n}",
    "includes": [
      "# include <poll.h>",
      "#include \"virutil.h\"",
      "#include \"virfile.h\"",
      "#include \"virdbus.h\"",
      "#include \"viralloc.h\"",
      "#include \"virprocess.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virpolkit.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virPolkitAgentDestroy",
          "args": [
            "agent"
          ],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "virPolkitAgentDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpolkit.c",
          "lines": "228-232",
          "snippet": "void\nvirPolkitAgentDestroy(virPolkitAgentPtr agent G_GNUC_UNUSED)\n{\n    return; /* do nothing */\n}",
          "includes": [
            "# include <poll.h>",
            "#include \"virutil.h\"",
            "#include \"virfile.h\"",
            "#include \"virdbus.h\"",
            "#include \"viralloc.h\"",
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virpolkit.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <poll.h>\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virdbus.h\"\n#include \"viralloc.h\"\n#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virpolkit.h\"\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirPolkitAgentDestroy(virPolkitAgentPtr agent G_GNUC_UNUSED)\n{\n    return; /* do nothing */\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "pipe_fd[1]"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "pipe_fd[0]"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "poll",
          "args": [
            "&pollfd",
            "1",
            "-1"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandRunAsync",
          "args": [
            "agent->cmd",
            "NULL"
          ],
          "line": 193
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandPassFD",
          "args": [
            "agent->cmd",
            "pipe_fd[1]",
            "VIR_COMMAND_PASS_FD_CLOSE_PARENT"
          ],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandPassFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1024-1049",
          "snippet": "void\nvirCommandPassFD(virCommandPtr cmd, int fd, unsigned int flags)\n{\n    int ret = 0;\n\n    if (!cmd) {\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n\n    if (fd <= STDERR_FILENO) {\n        VIR_DEBUG(\"invalid fd %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        if (!cmd->has_error)\n            cmd->has_error = -1;\n        return;\n    }\n\n    if ((ret = virCommandFDSet(cmd, fd, flags)) != 0) {\n        if (!cmd->has_error)\n            cmd->has_error = ret;\n        VIR_DEBUG(\"cannot preserve %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandPassFD(virCommandPtr cmd, int fd, unsigned int flags)\n{\n    int ret = 0;\n\n    if (!cmd) {\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n\n    if (fd <= STDERR_FILENO) {\n        VIR_DEBUG(\"invalid fd %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        if (!cmd->has_error)\n            cmd->has_error = -1;\n        return;\n    }\n\n    if ((ret = virCommandFDSet(cmd, fd, flags)) != 0) {\n        if (!cmd->has_error)\n            cmd->has_error = ret;\n        VIR_DEBUG(\"cannot preserve %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetErrorFD",
          "args": [
            "agent->cmd",
            "&errfd"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetErrorFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1984-1997",
          "snippet": "void\nvirCommandSetErrorFD(virCommandPtr cmd, int *errfd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errfdptr = errfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetErrorFD(virCommandPtr cmd, int *errfd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errfdptr = errfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetOutputFD",
          "args": [
            "agent->cmd",
            "&outfd"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetOutputFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1958-1971",
          "snippet": "void\nvirCommandSetOutputFD(virCommandPtr cmd, int *outfd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outfdptr = outfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetOutputFD(virCommandPtr cmd, int *outfd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outfdptr = outfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetInputFD",
          "args": [
            "agent->cmd",
            "STDIN_FILENO"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetInputFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1928-1946",
          "snippet": "void\nvirCommandSetInputFD(virCommandPtr cmd, int infd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->infd != -1 || cmd->inbuf) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify input twice\");\n        return;\n    }\n    if (infd < 0) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify invalid input fd\");\n        return;\n    }\n\n    cmd->infd = infd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetInputFD(virCommandPtr cmd, int infd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->infd != -1 || cmd->inbuf) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify input twice\");\n        return;\n    }\n    if (infd < 0) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify invalid input fd\");\n        return;\n    }\n\n    cmd->infd = infd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArg",
          "args": [
            "agent->cmd",
            "\"--fallback\""
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgFormat",
          "args": [
            "agent->cmd",
            "\"%d\"",
            "pipe_fd[1]"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1569-1590",
          "snippet": "void\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "PKTTYAGENT",
            "\"--process\"",
            "NULL"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "agent"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPipe",
          "args": [
            "pipe_fd"
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "virPipeNonBlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1813-1817",
          "snippet": "int\nvirPipeNonBlock(int fds[2])\n{\n    return virPipeImpl(fds, true, true);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPipeNonBlock(int fds[2])\n{\n    return virPipeImpl(fds, true, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "isatty",
          "args": [
            "STDIN_FILENO"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <poll.h>\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virdbus.h\"\n#include \"viralloc.h\"\n#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virpolkit.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirPolkitAgentPtr\nvirPolkitAgentCreate(void)\n{\n    virPolkitAgentPtr agent = NULL;\n    int pipe_fd[2] = {-1, -1};\n    struct pollfd pollfd;\n    int outfd = STDOUT_FILENO;\n    int errfd = STDERR_FILENO;\n\n    if (!isatty(STDIN_FILENO))\n        goto error;\n\n    if (virPipe(pipe_fd) < 0)\n        goto error;\n\n    if (VIR_ALLOC(agent) < 0)\n        goto error;\n\n    agent->cmd = virCommandNewArgList(PKTTYAGENT, \"--process\", NULL);\n\n    virCommandAddArgFormat(agent->cmd, \"%lld\", (long long int) getpid());\n    virCommandAddArg(agent->cmd, \"--notify-fd\");\n    virCommandAddArgFormat(agent->cmd, \"%d\", pipe_fd[1]);\n    virCommandAddArg(agent->cmd, \"--fallback\");\n    virCommandSetInputFD(agent->cmd, STDIN_FILENO);\n    virCommandSetOutputFD(agent->cmd, &outfd);\n    virCommandSetErrorFD(agent->cmd, &errfd);\n    virCommandPassFD(agent->cmd, pipe_fd[1], VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n    pipe_fd[1] = -1;\n    if (virCommandRunAsync(agent->cmd, NULL) < 0)\n        goto error;\n\n    pollfd.fd = pipe_fd[0];\n    pollfd.events = POLLHUP;\n\n    if (poll(&pollfd, 1, -1) < 0)\n        goto error;\n\n    return agent;\n\n error:\n    VIR_FORCE_CLOSE(pipe_fd[0]);\n    VIR_FORCE_CLOSE(pipe_fd[1]);\n    virPolkitAgentDestroy(agent);\n    return NULL;\n}"
  },
  {
    "function_name": "virPolkitAgentDestroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpolkit.c",
    "lines": "148-156",
    "snippet": "void\nvirPolkitAgentDestroy(virPolkitAgentPtr agent)\n{\n    if (!agent)\n        return;\n\n    virCommandFree(agent->cmd);\n    VIR_FREE(agent);\n}",
    "includes": [
      "# include <poll.h>",
      "#include \"virutil.h\"",
      "#include \"virfile.h\"",
      "#include \"virdbus.h\"",
      "#include \"viralloc.h\"",
      "#include \"virprocess.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virpolkit.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "agent"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "agent->cmd"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      }
    ],
    "contextual_snippet": "# include <poll.h>\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virdbus.h\"\n#include \"viralloc.h\"\n#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virpolkit.h\"\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirPolkitAgentDestroy(virPolkitAgentPtr agent)\n{\n    if (!agent)\n        return;\n\n    virCommandFree(agent->cmd);\n    VIR_FREE(agent);\n}"
  },
  {
    "function_name": "virPolkitCheckAuth",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpolkit.c",
    "lines": "59-140",
    "snippet": "int virPolkitCheckAuth(const char *actionid,\n                       pid_t pid,\n                       unsigned long long startTime,\n                       uid_t uid,\n                       const char **details,\n                       bool allowInteraction)\n{\n    DBusConnection *sysbus;\n    DBusMessage *reply = NULL;\n    char **retdetails = NULL;\n    size_t nretdetails = 0;\n    bool is_authorized;\n    bool is_challenge;\n    bool is_dismissed = false;\n    size_t i;\n    int ret = -1;\n\n    if (!(sysbus = virDBusGetSystemBus()))\n        goto cleanup;\n\n    VIR_INFO(\"Checking PID %lld running as %d\",\n             (long long) pid, uid);\n\n    if (virDBusCallMethod(sysbus,\n                          &reply,\n                          NULL,\n                          \"org.freedesktop.PolicyKit1\",\n                          \"/org/freedesktop/PolicyKit1/Authority\",\n                          \"org.freedesktop.PolicyKit1.Authority\",\n                          \"CheckAuthorization\",\n                          \"(sa{sv})sa&{ss}us\",\n                          \"unix-process\",\n                          3,\n                          \"pid\", \"u\", (unsigned int)pid,\n                          \"start-time\", \"t\", startTime,\n                          \"uid\", \"i\", (int)uid,\n                          actionid,\n                          virStringListLength(details) / 2,\n                          details,\n                          allowInteraction,\n                          \"\" /* cancellation ID */) < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply,\n                             \"(bba&{ss})\",\n                             &is_authorized,\n                             &is_challenge,\n                             &nretdetails,\n                             &retdetails) < 0)\n        goto cleanup;\n\n    for (i = 0; i < (nretdetails / 2); i++) {\n        if (STREQ(retdetails[(i * 2)], \"polkit.dismissed\") &&\n            STREQ(retdetails[(i * 2) + 1], \"true\"))\n            is_dismissed = true;\n    }\n\n    VIR_DEBUG(\"is auth %d  is challenge %d\",\n              is_authorized, is_challenge);\n\n    if (is_authorized) {\n        ret = 0;\n    } else {\n        ret = -2;\n        if (is_dismissed)\n            virReportError(VIR_ERR_AUTH_CANCELLED, \"%s\",\n                           _(\"user cancelled authentication process\"));\n        else if (is_challenge)\n            virReportError(VIR_ERR_AUTH_UNAVAILABLE,\n                           _(\"no polkit agent available to authenticate \"\n                             \"action '%s'\"),\n                           actionid);\n        else\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"access denied by policy\"));\n    }\n\n cleanup:\n    virStringListFreeCount(retdetails, nretdetails);\n    virDBusMessageUnref(reply);\n    return ret;\n}",
    "includes": [
      "# include <poll.h>",
      "#include \"virutil.h\"",
      "#include \"virfile.h\"",
      "#include \"virdbus.h\"",
      "#include \"viralloc.h\"",
      "#include \"virprocess.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virpolkit.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDBusMessageUnref",
          "args": [
            "reply"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusMessageUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1858-1861",
          "snippet": "void virDBusMessageUnref(DBusMessage *msg G_GNUC_UNUSED)\n{\n    /* nothing */\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nvoid virDBusMessageUnref(DBusMessage *msg G_GNUC_UNUSED)\n{\n    /* nothing */\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStringListFreeCount",
          "args": [
            "retdetails",
            "nretdetails"
          ],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListFreeCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "334-347",
          "snippet": "void\nvirStringListFreeCount(char **strings,\n                       size_t count)\n{\n    size_t i;\n\n    if (!strings)\n        return;\n\n    for (i = 0; i < count; i++)\n        VIR_FREE(strings[i]);\n\n    VIR_FREE(strings);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid\nvirStringListFreeCount(char **strings,\n                       size_t count)\n{\n    size_t i;\n\n    if (!strings)\n        return;\n\n    for (i = 0; i < count; i++)\n        VIR_FREE(strings[i]);\n\n    VIR_FREE(strings);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_FAILED",
            "\"%s\"",
            "_(\"access denied by policy\")"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"access denied by policy\""
          ],
          "line": 133
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_UNAVAILABLE",
            "_(\"no polkit agent available to authenticate \"\n                             \"action '%s'\")",
            "actionid"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AUTH_CANCELLED",
            "\"%s\"",
            "_(\"user cancelled authentication process\")"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"is auth %d  is challenge %d\"",
            "is_authorized",
            "is_challenge"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "retdetails[(i * 2) + 1]",
            "\"true\""
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "retdetails[(i * 2)]",
            "\"polkit.dismissed\""
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusMessageDecode",
          "args": [
            "reply",
            "\"(bba&{ss})\"",
            "&is_authorized",
            "&is_challenge",
            "&nretdetails",
            "&retdetails"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusMessageDecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1837-1844",
          "snippet": "int virDBusMessageDecode(DBusMessage* msg G_GNUC_UNUSED,\n                         const char *types G_GNUC_UNUSED,\n                         ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusMessageDecode(DBusMessage* msg G_GNUC_UNUSED,\n                         const char *types G_GNUC_UNUSED,\n                         ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDBusCallMethod",
          "args": [
            "sysbus",
            "&reply",
            "NULL",
            "\"org.freedesktop.PolicyKit1\"",
            "\"/org/freedesktop/PolicyKit1/Authority\"",
            "\"org.freedesktop.PolicyKit1.Authority\"",
            "\"CheckAuthorization\"",
            "\"(sa{sv})sa&{ss}us\"",
            "\"unix-process\"",
            "3",
            "\"pid\"",
            "\"u\"",
            "(unsigned int)pid",
            "\"start-time\"",
            "\"t\"",
            "startTime",
            "\"uid\"",
            "\"i\"",
            "(int)uid",
            "actionid",
            "virStringListLength(details) / 2",
            "details",
            "allowInteraction",
            "\"\"/* cancellation ID */"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusCallMethod",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1813-1825",
          "snippet": "int virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStringListLength",
          "args": [
            "details"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListLength",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "893-901",
          "snippet": "size_t virStringListLength(const char * const *strings)\n{\n    size_t i = 0;\n\n    while (strings && strings[i])\n        i++;\n\n    return i;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nsize_t virStringListLength(const char * const *strings)\n{\n    size_t i = 0;\n\n    while (strings && strings[i])\n        i++;\n\n    return i;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Checking PID %lld running as %d\"",
            "(long long) pid",
            "uid"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusGetSystemBus",
          "args": [],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusGetSystemBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1744-1749",
          "snippet": "DBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nDBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <poll.h>\n#include \"virutil.h\"\n#include \"virfile.h\"\n#include \"virdbus.h\"\n#include \"viralloc.h\"\n#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virpolkit.h\"\n#include <unistd.h>\n#include <config.h>\n\nint virPolkitCheckAuth(const char *actionid,\n                       pid_t pid,\n                       unsigned long long startTime,\n                       uid_t uid,\n                       const char **details,\n                       bool allowInteraction)\n{\n    DBusConnection *sysbus;\n    DBusMessage *reply = NULL;\n    char **retdetails = NULL;\n    size_t nretdetails = 0;\n    bool is_authorized;\n    bool is_challenge;\n    bool is_dismissed = false;\n    size_t i;\n    int ret = -1;\n\n    if (!(sysbus = virDBusGetSystemBus()))\n        goto cleanup;\n\n    VIR_INFO(\"Checking PID %lld running as %d\",\n             (long long) pid, uid);\n\n    if (virDBusCallMethod(sysbus,\n                          &reply,\n                          NULL,\n                          \"org.freedesktop.PolicyKit1\",\n                          \"/org/freedesktop/PolicyKit1/Authority\",\n                          \"org.freedesktop.PolicyKit1.Authority\",\n                          \"CheckAuthorization\",\n                          \"(sa{sv})sa&{ss}us\",\n                          \"unix-process\",\n                          3,\n                          \"pid\", \"u\", (unsigned int)pid,\n                          \"start-time\", \"t\", startTime,\n                          \"uid\", \"i\", (int)uid,\n                          actionid,\n                          virStringListLength(details) / 2,\n                          details,\n                          allowInteraction,\n                          \"\" /* cancellation ID */) < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply,\n                             \"(bba&{ss})\",\n                             &is_authorized,\n                             &is_challenge,\n                             &nretdetails,\n                             &retdetails) < 0)\n        goto cleanup;\n\n    for (i = 0; i < (nretdetails / 2); i++) {\n        if (STREQ(retdetails[(i * 2)], \"polkit.dismissed\") &&\n            STREQ(retdetails[(i * 2) + 1], \"true\"))\n            is_dismissed = true;\n    }\n\n    VIR_DEBUG(\"is auth %d  is challenge %d\",\n              is_authorized, is_challenge);\n\n    if (is_authorized) {\n        ret = 0;\n    } else {\n        ret = -2;\n        if (is_dismissed)\n            virReportError(VIR_ERR_AUTH_CANCELLED, \"%s\",\n                           _(\"user cancelled authentication process\"));\n        else if (is_challenge)\n            virReportError(VIR_ERR_AUTH_UNAVAILABLE,\n                           _(\"no polkit agent available to authenticate \"\n                             \"action '%s'\"),\n                           actionid);\n        else\n            virReportError(VIR_ERR_AUTH_FAILED, \"%s\",\n                           _(\"access denied by policy\"));\n    }\n\n cleanup:\n    virStringListFreeCount(retdetails, nretdetails);\n    virDBusMessageUnref(reply);\n    return ret;\n}"
  }
]