[
  {
    "function_name": "virConnectValidateURIPath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "260-296",
    "snippet": "bool\nvirConnectValidateURIPath(const char *uriPath,\n                          const char *entityName,\n                          bool privileged)\n{\n    if (privileged) {\n        /* TODO: qemu and vbox drivers allow '/session'\n         * connections as root. This is not ideal, but changing\n         * these drivers to refuse privileged '/session'\n         * connections, like everyone else is already doing, can\n         * break existing applications. Until we decide what to do,\n         * for now we can handle them as exception in this validate\n         * function.\n         */\n        bool compatSessionRoot = (STREQ(entityName, \"qemu\") ||\n                                  STREQ(entityName, \"vbox\")) &&\n                                  STREQ(uriPath, \"/session\");\n\n        if (STRNEQ(uriPath, \"/system\") && !compatSessionRoot) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///system\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    } else {\n        if (STRNEQ(uriPath, \"/session\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///session\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    }\n\n    return true;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"unexpected %s URI path '%s', try \"\n                             \"%s:///session\")",
            "entityName",
            "uriPath",
            "entityName"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unexpected %s URI path '%s', try \"\n                             \"%s:///session\""
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "uriPath",
            "\"/session\""
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"unexpected %s URI path '%s', try \"\n                             \"%s:///system\")",
            "entityName",
            "uriPath",
            "entityName"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "uriPath",
            "\"/system\""
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "uriPath",
            "\"/session\""
          ],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "entityName",
            "\"vbox\""
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "entityName",
            "\"qemu\""
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nbool\nvirConnectValidateURIPath(const char *uriPath,\n                          const char *entityName,\n                          bool privileged)\n{\n    if (privileged) {\n        /* TODO: qemu and vbox drivers allow '/session'\n         * connections as root. This is not ideal, but changing\n         * these drivers to refuse privileged '/session'\n         * connections, like everyone else is already doing, can\n         * break existing applications. Until we decide what to do,\n         * for now we can handle them as exception in this validate\n         * function.\n         */\n        bool compatSessionRoot = (STREQ(entityName, \"qemu\") ||\n                                  STREQ(entityName, \"vbox\")) &&\n                                  STREQ(uriPath, \"/session\");\n\n        if (STRNEQ(uriPath, \"/system\") && !compatSessionRoot) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///system\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    } else {\n        if (STRNEQ(uriPath, \"/session\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///session\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    }\n\n    return true;\n}"
  },
  {
    "function_name": "virSetConnectStorage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "250-258",
    "snippet": "int\nvirSetConnectStorage(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override storage connection with %p\", conn);\n    return virThreadLocalSet(&connectStorage, conn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectStorage;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virThreadLocalSet",
          "args": [
            "&connectStorage",
            "conn"
          ],
          "line": 257
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadLocalSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "352-360",
          "snippet": "int virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Override storage connection with %p\"",
            "conn"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectCacheInitialize",
          "args": [],
          "line": 253
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectStorage;\n\nint\nvirSetConnectStorage(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override storage connection with %p\", conn);\n    return virThreadLocalSet(&connectStorage, conn);\n}"
  },
  {
    "function_name": "virSetConnectSecret",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "239-247",
    "snippet": "int\nvirSetConnectSecret(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override secret connection with %p\", conn);\n    return virThreadLocalSet(&connectSecret, conn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectSecret;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virThreadLocalSet",
          "args": [
            "&connectSecret",
            "conn"
          ],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadLocalSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "352-360",
          "snippet": "int virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Override secret connection with %p\"",
            "conn"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectCacheInitialize",
          "args": [],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectSecret;\n\nint\nvirSetConnectSecret(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override secret connection with %p\", conn);\n    return virThreadLocalSet(&connectSecret, conn);\n}"
  },
  {
    "function_name": "virSetConnectNodeDev",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "228-236",
    "snippet": "int\nvirSetConnectNodeDev(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override nodedev connection with %p\", conn);\n    return virThreadLocalSet(&connectNodeDev, conn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectNodeDev;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virThreadLocalSet",
          "args": [
            "&connectNodeDev",
            "conn"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadLocalSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "352-360",
          "snippet": "int virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Override nodedev connection with %p\"",
            "conn"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectCacheInitialize",
          "args": [],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectNodeDev;\n\nint\nvirSetConnectNodeDev(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override nodedev connection with %p\", conn);\n    return virThreadLocalSet(&connectNodeDev, conn);\n}"
  },
  {
    "function_name": "virSetConnectNWFilter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "217-225",
    "snippet": "int\nvirSetConnectNWFilter(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override nwfilter connection with %p\", conn);\n    return virThreadLocalSet(&connectNWFilter, conn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectNWFilter;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virThreadLocalSet",
          "args": [
            "&connectNWFilter",
            "conn"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadLocalSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "352-360",
          "snippet": "int virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Override nwfilter connection with %p\"",
            "conn"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectCacheInitialize",
          "args": [],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectNWFilter;\n\nint\nvirSetConnectNWFilter(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override nwfilter connection with %p\", conn);\n    return virThreadLocalSet(&connectNWFilter, conn);\n}"
  },
  {
    "function_name": "virSetConnectNetwork",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "206-214",
    "snippet": "int\nvirSetConnectNetwork(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override network connection with %p\", conn);\n    return virThreadLocalSet(&connectNetwork, conn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectNetwork;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virThreadLocalSet",
          "args": [
            "&connectNetwork",
            "conn"
          ],
          "line": 213
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadLocalSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "352-360",
          "snippet": "int virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Override network connection with %p\"",
            "conn"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectCacheInitialize",
          "args": [],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectNetwork;\n\nint\nvirSetConnectNetwork(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override network connection with %p\", conn);\n    return virThreadLocalSet(&connectNetwork, conn);\n}"
  },
  {
    "function_name": "virSetConnectInterface",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "195-203",
    "snippet": "int\nvirSetConnectInterface(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override interface connection with %p\", conn);\n    return virThreadLocalSet(&connectInterface, conn);\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectInterface;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virThreadLocalSet",
          "args": [
            "&connectInterface",
            "conn"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadLocalSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "352-360",
          "snippet": "int virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadLocalSet(virThreadLocalPtr l, void *val)\n{\n    int err = pthread_setspecific(l->key, val);\n    if (err) {\n        errno = err;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Override interface connection with %p\"",
            "conn"
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectCacheInitialize",
          "args": [],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectInterface;\n\nint\nvirSetConnectInterface(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override interface connection with %p\", conn);\n    return virThreadLocalSet(&connectInterface, conn);\n}"
  },
  {
    "function_name": "virGetConnectStorage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "189-192",
    "snippet": "virConnectPtr virGetConnectStorage(void)\n{\n    return virGetConnectGeneric(&connectStorage, \"storage\");\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectStorage;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virGetConnectGeneric",
          "args": [
            "&connectStorage",
            "\"storage\""
          ],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectGeneric",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "138-161",
          "snippet": "static virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectStorage;\n\nvirConnectPtr virGetConnectStorage(void)\n{\n    return virGetConnectGeneric(&connectStorage, \"storage\");\n}"
  },
  {
    "function_name": "virGetConnectSecret",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "184-187",
    "snippet": "virConnectPtr virGetConnectSecret(void)\n{\n    return virGetConnectGeneric(&connectSecret, \"secret\");\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectSecret;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virGetConnectGeneric",
          "args": [
            "&connectSecret",
            "\"secret\""
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectGeneric",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "138-161",
          "snippet": "static virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectSecret;\n\nvirConnectPtr virGetConnectSecret(void)\n{\n    return virGetConnectGeneric(&connectSecret, \"secret\");\n}"
  },
  {
    "function_name": "virGetConnectNodeDev",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "179-182",
    "snippet": "virConnectPtr virGetConnectNodeDev(void)\n{\n    return virGetConnectGeneric(&connectNodeDev, \"nodedev\");\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectNodeDev;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virGetConnectGeneric",
          "args": [
            "&connectNodeDev",
            "\"nodedev\""
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectGeneric",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "138-161",
          "snippet": "static virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectNodeDev;\n\nvirConnectPtr virGetConnectNodeDev(void)\n{\n    return virGetConnectGeneric(&connectNodeDev, \"nodedev\");\n}"
  },
  {
    "function_name": "virGetConnectNWFilter",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "174-177",
    "snippet": "virConnectPtr virGetConnectNWFilter(void)\n{\n    return virGetConnectGeneric(&connectNWFilter, \"nwfilter\");\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectNWFilter;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virGetConnectGeneric",
          "args": [
            "&connectNWFilter",
            "\"nwfilter\""
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectGeneric",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "138-161",
          "snippet": "static virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectNWFilter;\n\nvirConnectPtr virGetConnectNWFilter(void)\n{\n    return virGetConnectGeneric(&connectNWFilter, \"nwfilter\");\n}"
  },
  {
    "function_name": "virGetConnectNetwork",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "169-172",
    "snippet": "virConnectPtr virGetConnectNetwork(void)\n{\n    return virGetConnectGeneric(&connectNetwork, \"network\");\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectNetwork;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virGetConnectGeneric",
          "args": [
            "&connectNetwork",
            "\"network\""
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectGeneric",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "138-161",
          "snippet": "static virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectNetwork;\n\nvirConnectPtr virGetConnectNetwork(void)\n{\n    return virGetConnectGeneric(&connectNetwork, \"network\");\n}"
  },
  {
    "function_name": "virGetConnectInterface",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "164-167",
    "snippet": "virConnectPtr virGetConnectInterface(void)\n{\n    return virGetConnectGeneric(&connectInterface, \"interface\");\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectInterface;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virGetConnectGeneric",
          "args": [
            "&connectInterface",
            "\"interface\""
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectGeneric",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "138-161",
          "snippet": "static virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectInterface;\n\nvirConnectPtr virGetConnectInterface(void)\n{\n    return virGetConnectGeneric(&connectInterface, \"interface\");\n}"
  },
  {
    "function_name": "virGetConnectGeneric",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "138-161",
    "snippet": "static virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Opened new %s connection %p\"",
            "name",
            "conn"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectOpen",
          "args": [
            "uri"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "virConnectOpenReadOnly",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt.c",
          "lines": "1181-1199",
          "snippet": "virConnectPtr\nvirConnectOpenReadOnly(const char *name)\n{\n    virConnectPtr ret = NULL;\n\n    if (virInitialize() < 0)\n        goto error;\n\n    VIR_DEBUG(\"name=%s\", NULLSTR(name));\n    virResetLastError();\n    ret = virConnectOpenInternal(name, NULL, VIR_CONNECT_RO);\n    if (!ret)\n        goto error;\n    return ret;\n\n error:\n    virDispatchError(NULL);\n    return NULL;\n}",
          "includes": [
            "#include \"access/viraccessmanager.h\"",
            "# include \"bhyve/bhyve_driver.h\"",
            "# include \"hyperv/hyperv_driver.h\"",
            "# include \"esx/esx_driver.h\"",
            "# include \"vmware/vmware_driver.h\"",
            "# include \"openvz/openvz_driver.h\"",
            "# include \"remote/remote_driver.h\"",
            "# include \"test/test_driver.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"viruri.h\"",
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"virevent.h\"",
            "#include \"vircommand.h\"",
            "#include \"rpc/virnettlscontext.h\"",
            "#include \"virconf.h\"",
            "#include \"configmake.h\"",
            "#include \"viralloc.h\"",
            "#include \"viruuid.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <curl/curl.h>",
            "#include <libxml/xpath.h>",
            "#include <libxml/parser.h>",
            "#include <gio/gnetworking.h>",
            "#include <time.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"access/viraccessmanager.h\"\n# include \"bhyve/bhyve_driver.h\"\n# include \"hyperv/hyperv_driver.h\"\n# include \"esx/esx_driver.h\"\n# include \"vmware/vmware_driver.h\"\n# include \"openvz/openvz_driver.h\"\n# include \"remote/remote_driver.h\"\n# include \"test/test_driver.h\"\n#include \"virtypedparam.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"viruri.h\"\n#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"virevent.h\"\n#include \"vircommand.h\"\n#include \"rpc/virnettlscontext.h\"\n#include \"virconf.h\"\n#include \"configmake.h\"\n#include \"viralloc.h\"\n#include \"viruuid.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <curl/curl.h>\n#include <libxml/xpath.h>\n#include <libxml/parser.h>\n#include <gio/gnetworking.h>\n#include <time.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirConnectPtr\nvirConnectOpenReadOnly(const char *name)\n{\n    virConnectPtr ret = NULL;\n\n    if (virInitialize() < 0)\n        goto error;\n\n    VIR_DEBUG(\"name=%s\", NULLSTR(name));\n    virResetLastError();\n    ret = virConnectOpenInternal(name, NULL, VIR_CONNECT_RO);\n    if (!ret)\n        goto error;\n    return ret;\n\n error:\n    virDispatchError(NULL);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s://%s\"",
            "name",
            "uriPath"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "geteuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.h",
          "lines": "68-69",
          "snippet": "static inline int geteuid(void)\n{ return 0; }",
          "includes": [
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <unistd.h>\n#include \"internal.h\"\n\nstatic inline int geteuid(void)\n{ return 0; }"
        }
      },
      {
        "call_info": {
          "callee": "virObjectRef",
          "args": [
            "conn"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectRef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "377-387",
          "snippet": "void *\nvirObjectRef(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return NULL;\n    g_atomic_int_add(&obj->u.s.refs, 1);\n    PROBE(OBJECT_REF, \"obj=%p\", obj);\n    return anyobj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid *\nvirObjectRef(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return NULL;\n    g_atomic_int_add(&obj->u.s.refs, 1);\n    PROBE(OBJECT_REF, \"obj=%p\", obj);\n    return anyobj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Return cached %s connection %p\"",
            "name",
            "conn"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virThreadLocalGet",
          "args": [
            "threadPtr"
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadLocalGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "347-350",
          "snippet": "void *virThreadLocalGet(virThreadLocalPtr l)\n{\n    return pthread_getspecific(l->key);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid *virThreadLocalGet(virThreadLocalPtr l)\n{\n    return pthread_getspecific(l->key);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectCacheInitialize",
          "args": [],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virConnectPtr\nvirGetConnectGeneric(virThreadLocalPtr threadPtr, const char *name)\n{\n    virConnectPtr conn;\n\n    if (virConnectCacheInitialize() < 0)\n        return NULL;\n\n    conn = virThreadLocalGet(threadPtr);\n\n    if (conn) {\n        VIR_DEBUG(\"Return cached %s connection %p\", name, conn);\n        virObjectRef(conn);\n    } else {\n        g_autofree char *uri = NULL;\n        const char *uriPath = geteuid() == 0 ? \"/system\" : \"/session\";\n\n        uri = g_strdup_printf(\"%s://%s\", name, uriPath);\n\n        conn = virConnectOpen(uri);\n        VIR_DEBUG(\"Opened new %s connection %p\", name, conn);\n    }\n    return conn;\n}"
  },
  {
    "function_name": "virConnectCacheOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "118-134",
    "snippet": "static int\nvirConnectCacheOnceInit(void)\n{\n    if (virThreadLocalInit(&connectInterface, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectNetwork, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectNWFilter, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectNodeDev, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectSecret, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectStorage, NULL) < 0)\n        return -1;\n    return 0;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virThreadLocal connectInterface;",
      "virThreadLocal connectNetwork;",
      "virThreadLocal connectNWFilter;",
      "virThreadLocal connectNodeDev;",
      "virThreadLocal connectSecret;",
      "virThreadLocal connectStorage;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virThreadLocalInit",
          "args": [
            "&connectStorage",
            "NULL"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadLocalInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "336-345",
          "snippet": "int virThreadLocalInit(virThreadLocalPtr l,\n                       virThreadLocalCleanup c)\n{\n    int ret;\n    if ((ret = pthread_key_create(&l->key, c)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadLocalInit(virThreadLocalPtr l,\n                       virThreadLocalCleanup c)\n{\n    int ret;\n    if ((ret = pthread_key_create(&l->key, c)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectInterface;\nvirThreadLocal connectNetwork;\nvirThreadLocal connectNWFilter;\nvirThreadLocal connectNodeDev;\nvirThreadLocal connectSecret;\nvirThreadLocal connectStorage;\n\nstatic int\nvirConnectCacheOnceInit(void)\n{\n    if (virThreadLocalInit(&connectInterface, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectNetwork, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectNWFilter, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectNodeDev, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectSecret, NULL) < 0)\n        return -1;\n    if (virThreadLocalInit(&connectStorage, NULL) < 0)\n        return -1;\n    return 0;\n}"
  },
  {
    "function_name": "virDriverShouldAutostart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "86-108",
    "snippet": "int\nvirDriverShouldAutostart(const char *dir,\n                         bool *autostart)\n{\n    g_autofree char *path = NULL;\n\n    *autostart = false;\n\n    path = g_strdup_printf(\"%s/autostarted\", dir);\n\n    if (virFileExists(path)) {\n        VIR_DEBUG(\"Autostart file %s exists, skipping autostart\", path);\n        return 0;\n    }\n\n    VIR_DEBUG(\"Autostart file %s does not exist, do autostart\", path);\n    *autostart = true;\n\n    if (virFileTouch(path, 0600) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virFileTouch",
          "args": [
            "path",
            "0600"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "virFileTouch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "591-609",
          "snippet": "int virFileTouch(const char *path, mode_t mode)\n{\n    int fd = -1;\n\n    if ((fd = open(path, O_WRONLY | O_CREAT, mode)) < 0) {\n        virReportSystemError(errno, _(\"cannot create file '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (VIR_CLOSE(fd) < 0) {\n        virReportSystemError(errno, _(\"cannot save file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileTouch(const char *path, mode_t mode)\n{\n    int fd = -1;\n\n    if ((fd = open(path, O_WRONLY | O_CREAT, mode)) < 0) {\n        virReportSystemError(errno, _(\"cannot create file '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (VIR_CLOSE(fd) < 0) {\n        virReportSystemError(errno, _(\"cannot save file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Autostart file %s does not exist, do autostart\"",
            "path"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Autostart file %s exists, skipping autostart\"",
            "path"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "path"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/autostarted\"",
            "dir"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirDriverShouldAutostart(const char *dir,\n                         bool *autostart)\n{\n    g_autofree char *path = NULL;\n\n    *autostart = false;\n\n    path = g_strdup_printf(\"%s/autostarted\", dir);\n\n    if (virFileExists(path)) {\n        VIR_DEBUG(\"Autostart file %s exists, skipping autostart\", path);\n        return 0;\n    }\n\n    VIR_DEBUG(\"Autostart file %s does not exist, do autostart\", path);\n    *autostart = true;\n\n    if (virFileTouch(path, 0600) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virDriverLoadModule",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
    "lines": "46-69",
    "snippet": "int\nvirDriverLoadModule(const char *name,\n                    const char *regfunc,\n                    bool required)\n{\n    char *modfile = NULL;\n    int ret;\n\n    VIR_DEBUG(\"Module load %s\", name);\n\n    if (!(modfile = virFileFindResourceFull(name,\n                                            \"libvirt_driver_\",\n                                            \".so\",\n                                            abs_top_builddir \"/src/.libs\",\n                                            DEFAULT_DRIVER_DIR,\n                                            \"LIBVIRT_DRIVER_DIR\")))\n        return -1;\n\n    ret = virModuleLoad(modfile, regfunc, required);\n\n    VIR_FREE(modfile);\n\n    return ret;\n}",
    "includes": [
      "#include \"configmake.h\"",
      "#include \"virutil.h\"",
      "#include \"virthread.h\"",
      "#include \"virstring.h\"",
      "#include \"virmodule.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"driver.h\"",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DEFAULT_DRIVER_DIR LIBDIR \"/libvirt/connection-driver\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "modfile"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virModuleLoad",
          "args": [
            "modfile",
            "regfunc",
            "required"
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "virModuleLoad",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmodule.c",
          "lines": "145-162",
          "snippet": "int\nvirModuleLoad(const char *path,\n              const char *regfunc G_GNUC_UNUSED,\n              bool required)\n{\n    VIR_DEBUG(\"dlopen not available on this platform\");\n    if (required) {\n        virReportSystemError(ENOSYS,\n                             _(\"Failed to find module '%s'\"), path);\n        return -1;\n    } else {\n        /* Since we have no dlopen(), but definition we have no\n         * loadable modules on disk, so we can reasonably\n         * return '1' instead of an error.\n         */\n        return 1;\n    }\n}",
          "includes": [
            "# include <dlfcn.h>",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virmodule.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <dlfcn.h>\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virmodule.h\"\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirModuleLoad(const char *path,\n              const char *regfunc G_GNUC_UNUSED,\n              bool required)\n{\n    VIR_DEBUG(\"dlopen not available on this platform\");\n    if (required) {\n        virReportSystemError(ENOSYS,\n                             _(\"Failed to find module '%s'\"), path);\n        return -1;\n    } else {\n        /* Since we have no dlopen(), but definition we have no\n         * loadable modules on disk, so we can reasonably\n         * return '1' instead of an error.\n         */\n        return 1;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileFindResourceFull",
          "args": [
            "name",
            "\"libvirt_driver_\"",
            "\".so\"",
            "abs_top_builddir \"/src/.libs\"",
            "DEFAULT_DRIVER_DIR",
            "\"LIBVIRT_DRIVER_DIR\""
          ],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFindResourceFull",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1741-1769",
          "snippet": "char *\nvirFileFindResourceFull(const char *filename,\n                        const char *prefix,\n                        const char *suffix,\n                        const char *builddir,\n                        const char *installdir,\n                        const char *envname)\n{\n    char *ret = NULL;\n    const char *envval = envname ? getenv(envname) : NULL;\n    const char *path;\n\n    if (!prefix)\n        prefix = \"\";\n    if (!suffix)\n        suffix = \"\";\n\n    if (envval)\n        path = envval;\n    else if (useDirOverride)\n        path = builddir;\n    else\n        path = installdir;\n\n    ret = g_strdup_printf(\"%s/%s%s%s\", path, prefix, filename, suffix);\n\n    VIR_DEBUG(\"Resolved '%s' to '%s'\", filename, ret);\n    return ret;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool useDirOverride;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic bool useDirOverride;\n\nchar *\nvirFileFindResourceFull(const char *filename,\n                        const char *prefix,\n                        const char *suffix,\n                        const char *builddir,\n                        const char *installdir,\n                        const char *envname)\n{\n    char *ret = NULL;\n    const char *envval = envname ? getenv(envname) : NULL;\n    const char *path;\n\n    if (!prefix)\n        prefix = \"\";\n    if (!suffix)\n        suffix = \"\";\n\n    if (envval)\n        path = envval;\n    else if (useDirOverride)\n        path = builddir;\n    else\n        path = installdir;\n\n    ret = g_strdup_printf(\"%s/%s%s%s\", path, prefix, filename, suffix);\n\n    VIR_DEBUG(\"Resolved '%s' to '%s'\", filename, ret);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Module load %s\"",
            "name"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\n#define DEFAULT_DRIVER_DIR LIBDIR \"/libvirt/connection-driver\"\n\nint\nvirDriverLoadModule(const char *name,\n                    const char *regfunc,\n                    bool required)\n{\n    char *modfile = NULL;\n    int ret;\n\n    VIR_DEBUG(\"Module load %s\", name);\n\n    if (!(modfile = virFileFindResourceFull(name,\n                                            \"libvirt_driver_\",\n                                            \".so\",\n                                            abs_top_builddir \"/src/.libs\",\n                                            DEFAULT_DRIVER_DIR,\n                                            \"LIBVIRT_DRIVER_DIR\")))\n        return -1;\n\n    ret = virModuleLoad(modfile, regfunc, required);\n\n    VIR_FREE(modfile);\n\n    return ret;\n}"
  }
]