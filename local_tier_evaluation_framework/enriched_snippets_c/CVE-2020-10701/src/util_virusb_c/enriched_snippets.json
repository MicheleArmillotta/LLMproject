[
  {
    "function_name": "virUSBDeviceListFind",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "497-510",
    "snippet": "virUSBDevicePtr\nvirUSBDeviceListFind(virUSBDeviceListPtr list,\n                     virUSBDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev)\n            return list->devs[i];\n    }\n\n    return NULL;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListFind(virUSBDeviceListPtr list,\n                     virUSBDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev)\n            return list->devs[i];\n    }\n\n    return NULL;\n}"
  },
  {
    "function_name": "virUSBDeviceListDel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "490-495",
    "snippet": "void\nvirUSBDeviceListDel(virUSBDeviceListPtr list,\n                    virUSBDevicePtr dev)\n{\n    virUSBDeviceFree(virUSBDeviceListSteal(list, dev));\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virUSBDeviceFree",
          "args": [
            "virUSBDeviceListSteal(list, dev)"
          ],
          "line": 494
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "353-363",
          "snippet": "void\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceListSteal",
          "args": [
            "list",
            "dev"
          ],
          "line": 494
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceListSteal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "472-488",
          "snippet": "virUSBDevicePtr\nvirUSBDeviceListSteal(virUSBDeviceListPtr list,\n                      virUSBDevicePtr dev)\n{\n    virUSBDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListSteal(virUSBDeviceListPtr list,\n                      virUSBDevicePtr dev)\n{\n    virUSBDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirUSBDeviceListDel(virUSBDeviceListPtr list,\n                    virUSBDevicePtr dev)\n{\n    virUSBDeviceFree(virUSBDeviceListSteal(list, dev));\n}"
  },
  {
    "function_name": "virUSBDeviceListSteal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "472-488",
    "snippet": "virUSBDevicePtr\nvirUSBDeviceListSteal(virUSBDeviceListPtr list,\n                      virUSBDevicePtr dev)\n{\n    virUSBDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n    return ret;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "list->devs",
            "i",
            "list->count"
          ],
          "line": 483
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListSteal(virUSBDeviceListPtr list,\n                      virUSBDevicePtr dev)\n{\n    virUSBDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n    return ret;\n}"
  },
  {
    "function_name": "virUSBDeviceListCount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "466-470",
    "snippet": "size_t\nvirUSBDeviceListCount(virUSBDeviceListPtr list)\n{\n    return list->count;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nsize_t\nvirUSBDeviceListCount(virUSBDeviceListPtr list)\n{\n    return list->count;\n}"
  },
  {
    "function_name": "virUSBDeviceListGet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "455-464",
    "snippet": "virUSBDevicePtr\nvirUSBDeviceListGet(virUSBDeviceListPtr list,\n                    int idx)\n{\n    if (idx >= list->count ||\n        idx < 0)\n        return NULL;\n\n    return list->devs[idx];\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListGet(virUSBDeviceListPtr list,\n                    int idx)\n{\n    if (idx >= list->count ||\n        idx < 0)\n        return NULL;\n\n    return list->devs[idx];\n}"
  },
  {
    "function_name": "virUSBDeviceListAdd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "442-453",
    "snippet": "int\nvirUSBDeviceListAdd(virUSBDeviceListPtr list,\n                    virUSBDevicePtr *dev)\n{\n    if (virUSBDeviceListFind(list, *dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Device %s is already in use\"),\n                       (*dev)->name);\n        return -1;\n    }\n    return VIR_APPEND_ELEMENT(list->devs, list->count, *dev);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT",
          "args": [
            "list->devs",
            "list->count",
            "*dev"
          ],
          "line": 452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Device %s is already in use\")",
            "(*dev)->name"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Device %s is already in use\""
          ],
          "line": 448
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceListFind",
          "args": [
            "list",
            "*dev"
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceListFind",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "497-510",
          "snippet": "virUSBDevicePtr\nvirUSBDeviceListFind(virUSBDeviceListPtr list,\n                     virUSBDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev)\n            return list->devs[i];\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListFind(virUSBDeviceListPtr list,\n                     virUSBDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev)\n            return list->devs[i];\n    }\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirUSBDeviceListAdd(virUSBDeviceListPtr list,\n                    virUSBDevicePtr *dev)\n{\n    if (virUSBDeviceListFind(list, *dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Device %s is already in use\"),\n                       (*dev)->name);\n        return -1;\n    }\n    return VIR_APPEND_ELEMENT(list->devs, list->count, *dev);\n}"
  },
  {
    "function_name": "virUSBDeviceListDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "430-440",
    "snippet": "static void\nvirUSBDeviceListDispose(void *obj)\n{\n    virUSBDeviceListPtr list = obj;\n    size_t i;\n\n    for (i = 0; i < list->count; i++)\n        virUSBDeviceFree(list->devs[i]);\n\n    VIR_FREE(list->devs);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void virUSBDeviceListDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "list->devs"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virUSBDeviceFree",
          "args": [
            "list->devs[i]"
          ],
          "line": 437
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "353-363",
          "snippet": "void\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virUSBDeviceListDispose(void *obj);\n\nstatic void\nvirUSBDeviceListDispose(void *obj)\n{\n    virUSBDeviceListPtr list = obj;\n    size_t i;\n\n    for (i = 0; i < list->count; i++)\n        virUSBDeviceFree(list->devs[i]);\n\n    VIR_FREE(list->devs);\n}"
  },
  {
    "function_name": "virUSBDeviceListNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "416-428",
    "snippet": "virUSBDeviceListPtr\nvirUSBDeviceListNew(void)\n{\n    virUSBDeviceListPtr list;\n\n    if (virUSBInitialize() < 0)\n        return NULL;\n\n    if (!(list = virObjectLockableNew(virUSBDeviceListClass)))\n        return NULL;\n\n    return list;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virUSBDeviceListClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectLockableNew",
          "args": [
            "virUSBDeviceListClass"
          ],
          "line": 424
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLockableNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "256-279",
          "snippet": "void *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nvoid *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBInitialize",
          "args": [],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic virClassPtr virUSBDeviceListClass;\n\nvirUSBDeviceListPtr\nvirUSBDeviceListNew(void)\n{\n    virUSBDeviceListPtr list;\n\n    if (virUSBInitialize() < 0)\n        return NULL;\n\n    if (!(list = virObjectLockableNew(virUSBDeviceListClass)))\n        return NULL;\n\n    return list;\n}"
  },
  {
    "function_name": "virUSBDeviceFileIterate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "409-414",
    "snippet": "int virUSBDeviceFileIterate(virUSBDevicePtr dev,\n                            virUSBDeviceFileActor actor,\n                            void *opaque)\n{\n    return (actor)(dev, dev->path, opaque);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "dev",
            "dev->path",
            "opaque"
          ],
          "line": 413
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint virUSBDeviceFileIterate(virUSBDevicePtr dev,\n                            virUSBDeviceFileActor actor,\n                            void *opaque)\n{\n    return (actor)(dev, dev->path, opaque);\n}"
  },
  {
    "function_name": "virUSBDeviceGetDevno",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "403-406",
    "snippet": "unsigned int virUSBDeviceGetDevno(virUSBDevicePtr dev)\n{\n    return dev->dev;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nunsigned int virUSBDeviceGetDevno(virUSBDevicePtr dev)\n{\n    return dev->dev;\n}"
  },
  {
    "function_name": "virUSBDeviceGetBus",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "397-400",
    "snippet": "unsigned int virUSBDeviceGetBus(virUSBDevicePtr dev)\n{\n    return dev->bus;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nunsigned int virUSBDeviceGetBus(virUSBDevicePtr dev)\n{\n    return dev->bus;\n}"
  },
  {
    "function_name": "virUSBDeviceGetPath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "392-395",
    "snippet": "const char *virUSBDeviceGetPath(virUSBDevicePtr dev)\n{\n    return dev->path;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nconst char *virUSBDeviceGetPath(virUSBDevicePtr dev)\n{\n    return dev->path;\n}"
  },
  {
    "function_name": "virUSBDeviceGetName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "387-390",
    "snippet": "const char *virUSBDeviceGetName(virUSBDevicePtr dev)\n{\n    return dev->name;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nconst char *virUSBDeviceGetName(virUSBDevicePtr dev)\n{\n    return dev->name;\n}"
  },
  {
    "function_name": "virUSBDeviceGetUsedBy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "378-385",
    "snippet": "void\nvirUSBDeviceGetUsedBy(virUSBDevicePtr dev,\n                      const char **drv_name,\n                      const char **dom_name)\n{\n    *drv_name = dev->used_by_drvname;\n    *dom_name = dev->used_by_domname;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirUSBDeviceGetUsedBy(virUSBDevicePtr dev,\n                      const char **drv_name,\n                      const char **dom_name)\n{\n    *drv_name = dev->used_by_drvname;\n    *dom_name = dev->used_by_domname;\n}"
  },
  {
    "function_name": "virUSBDeviceSetUsedBy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "365-376",
    "snippet": "int\nvirUSBDeviceSetUsedBy(virUSBDevicePtr dev,\n                      const char *drv_name,\n                      const char *dom_name)\n{\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    dev->used_by_drvname = g_strdup(drv_name);\n    dev->used_by_domname = g_strdup(dom_name);\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "dom_name"
          ],
          "line": 373
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by_domname"
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by_drvname"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirUSBDeviceSetUsedBy(virUSBDevicePtr dev,\n                      const char *drv_name,\n                      const char *dom_name)\n{\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    dev->used_by_drvname = g_strdup(drv_name);\n    dev->used_by_domname = g_strdup(dom_name);\n\n    return 0;\n}"
  },
  {
    "function_name": "virUSBDeviceFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "353-363",
    "snippet": "void\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by_domname"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by_drvname"
          ],
          "line": 360
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->path"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"%s %s: freeing\"",
            "dev->id",
            "dev->name"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
  },
  {
    "function_name": "virUSBDeviceNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "308-351",
    "snippet": "virUSBDevicePtr\nvirUSBDeviceNew(unsigned int bus,\n                unsigned int devno,\n                const char *vroot)\n{\n    virUSBDevicePtr dev;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus     = bus;\n    dev->dev     = devno;\n\n    if (g_snprintf(dev->name, sizeof(dev->name), \"%.3d:%.3d\",\n                   dev->bus, dev->dev) >= sizeof(dev->name)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->name buffer overflow: %.3d:%.3d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    if (vroot) {\n        dev->path = g_strdup_printf(\"%s/%03d/%03d\",\n                                    vroot, dev->bus, dev->dev);\n    } else {\n        dev->path = g_strdup_printf(USB_DEVFS \"%03d/%03d\",\n                                    dev->bus, dev->dev);\n    }\n\n    /* XXX fixme. this should be product/vendor */\n    if (g_snprintf(dev->id, sizeof(dev->id), \"%d %d\", dev->bus,\n                   dev->dev) >= sizeof(dev->id)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->id buffer overflow: %d %d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    VIR_DEBUG(\"%s %s: initialized\", dev->id, dev->name);\n\n    return dev;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"%s %s: initialized\"",
            "dev->id",
            "dev->name"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virUSBDeviceFree",
          "args": [
            "dev"
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "353-363",
          "snippet": "void\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"dev->id buffer overflow: %d %d\")",
            "dev->bus",
            "dev->dev"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"dev->id buffer overflow: %d %d\""
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_snprintf",
          "args": [
            "dev->id",
            "sizeof(dev->id)",
            "\"%d %d\"",
            "dev->bus",
            "dev->dev"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"dev->name buffer overflow: %.3d:%.3d\")",
            "dev->bus",
            "dev->dev"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_snprintf",
          "args": [
            "dev->name",
            "sizeof(dev->name)",
            "\"%.3d:%.3d\"",
            "dev->bus",
            "dev->dev"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "dev"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceNew(unsigned int bus,\n                unsigned int devno,\n                const char *vroot)\n{\n    virUSBDevicePtr dev;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus     = bus;\n    dev->dev     = devno;\n\n    if (g_snprintf(dev->name, sizeof(dev->name), \"%.3d:%.3d\",\n                   dev->bus, dev->dev) >= sizeof(dev->name)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->name buffer overflow: %.3d:%.3d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    if (vroot) {\n        dev->path = g_strdup_printf(\"%s/%03d/%03d\",\n                                    vroot, dev->bus, dev->dev);\n    } else {\n        dev->path = g_strdup_printf(USB_DEVFS \"%03d/%03d\",\n                                    dev->bus, dev->dev);\n    }\n\n    /* XXX fixme. this should be product/vendor */\n    if (g_snprintf(dev->id, sizeof(dev->id), \"%d %d\", dev->bus,\n                   dev->dev) >= sizeof(dev->id)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->id buffer overflow: %d %d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    VIR_DEBUG(\"%s %s: initialized\", dev->id, dev->name);\n\n    return dev;\n}"
  },
  {
    "function_name": "virUSBDeviceFind",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "267-306",
    "snippet": "int\nvirUSBDeviceFind(unsigned int vendor,\n                 unsigned int product,\n                 unsigned int bus,\n                 unsigned int devno,\n                 const char *vroot,\n                 bool mandatory,\n                 virUSBDevicePtr *usb)\n{\n    virUSBDeviceListPtr list;\n\n    unsigned int flags = USB_DEVICE_FIND_BY_VENDOR|USB_DEVICE_FIND_BY_BUS;\n    if (!(list = virUSBDeviceSearch(vendor, product, bus, devno,\n                                    vroot, flags)))\n        return -1;\n\n    if (list->count == 0) {\n        virObjectUnref(list);\n        if (!mandatory) {\n            VIR_DEBUG(\"Did not find USB device %04x:%04x bus:%u device:%u\",\n                      vendor, product, bus, devno);\n            if (usb)\n                *usb = NULL;\n            return 0;\n        }\n\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Did not find USB device %04x:%04x bus:%u device:%u\"),\n                       vendor, product, bus, devno);\n        return -1;\n    }\n\n    if (usb) {\n        *usb = virUSBDeviceListGet(list, 0);\n        virUSBDeviceListSteal(list, *usb);\n    }\n    virObjectUnref(list);\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "list"
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceListSteal",
          "args": [
            "list",
            "*usb"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceListSteal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "472-488",
          "snippet": "virUSBDevicePtr\nvirUSBDeviceListSteal(virUSBDeviceListPtr list,\n                      virUSBDevicePtr dev)\n{\n    virUSBDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListSteal(virUSBDeviceListPtr list,\n                      virUSBDevicePtr dev)\n{\n    virUSBDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceListGet",
          "args": [
            "list",
            "0"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceListGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "455-464",
          "snippet": "virUSBDevicePtr\nvirUSBDeviceListGet(virUSBDeviceListPtr list,\n                    int idx)\n{\n    if (idx >= list->count ||\n        idx < 0)\n        return NULL;\n\n    return list->devs[idx];\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListGet(virUSBDeviceListPtr list,\n                    int idx)\n{\n    if (idx >= list->count ||\n        idx < 0)\n        return NULL;\n\n    return list->devs[idx];\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Did not find USB device %04x:%04x bus:%u device:%u\")",
            "vendor",
            "product",
            "bus",
            "devno"
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "virReportErrorHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "1282-1308",
          "snippet": "void virReportErrorHelper(int domcode,\n                          int errorcode,\n                          const char *filename,\n                          const char *funcname,\n                          size_t linenr,\n                          const char *fmt, ...)\n{\n    int save_errno = errno;\n    va_list args;\n    char errorMessage[VIR_ERROR_MAX_LENGTH];\n    const char *virerr;\n\n    if (fmt) {\n        va_start(args, fmt);\n        g_vsnprintf(errorMessage, sizeof(errorMessage)-1, fmt, args);\n        va_end(args);\n    } else {\n        errorMessage[0] = '\\0';\n    }\n\n    virerr = virErrorMsg(errorcode, (errorMessage[0] ? errorMessage : NULL));\n    virRaiseErrorFull(filename, funcname, linenr,\n                      domcode, errorcode, VIR_ERR_ERROR,\n                      virerr, errorMessage, NULL,\n                      -1, -1, virerr, errorMessage);\n    errno = save_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid virReportErrorHelper(int domcode,\n                          int errorcode,\n                          const char *filename,\n                          const char *funcname,\n                          size_t linenr,\n                          const char *fmt, ...)\n{\n    int save_errno = errno;\n    va_list args;\n    char errorMessage[VIR_ERROR_MAX_LENGTH];\n    const char *virerr;\n\n    if (fmt) {\n        va_start(args, fmt);\n        g_vsnprintf(errorMessage, sizeof(errorMessage)-1, fmt, args);\n        va_end(args);\n    } else {\n        errorMessage[0] = '\\0';\n    }\n\n    virerr = virErrorMsg(errorcode, (errorMessage[0] ? errorMessage : NULL));\n    virRaiseErrorFull(filename, funcname, linenr,\n                      domcode, errorcode, VIR_ERR_ERROR,\n                      virerr, errorMessage, NULL,\n                      -1, -1, virerr, errorMessage);\n    errno = save_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Did not find USB device %04x:%04x bus:%u device:%u\""
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Did not find USB device %04x:%04x bus:%u device:%u\"",
            "vendor",
            "product",
            "bus",
            "devno"
          ],
          "line": 286
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virUSBDeviceSearch",
          "args": [
            "vendor",
            "product",
            "bus",
            "devno",
            "vroot",
            "flags"
          ],
          "line": 279
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceSearch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "105-187",
          "snippet": "static virUSBDeviceListPtr\nvirUSBDeviceSearch(unsigned int vendor,\n                   unsigned int product,\n                   unsigned int bus,\n                   unsigned int devno,\n                   const char *vroot,\n                   unsigned int flags)\n{\n    DIR *dir = NULL;\n    bool found = false;\n    char *ignore = NULL;\n    struct dirent *de;\n    virUSBDeviceListPtr list = NULL;\n    virUSBDeviceListPtr ret = NULL;\n    g_autoptr(virUSBDevice) usb = NULL;\n    int direrr;\n\n    if (!(list = virUSBDeviceListNew()))\n        goto cleanup;\n\n    if (virDirOpen(&dir, USB_SYSFS \"/devices\") < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &de, USB_SYSFS \"/devices\")) > 0) {\n        unsigned int found_prod, found_vend, found_bus, found_devno;\n        char *tmpstr = de->d_name;\n\n        if (strchr(de->d_name, ':'))\n            continue;\n\n        if (virUSBSysReadFile(\"idVendor\", de->d_name,\n                              16, &found_vend) < 0)\n            goto cleanup;\n\n        if (virUSBSysReadFile(\"idProduct\", de->d_name,\n                              16, &found_prod) < 0)\n            goto cleanup;\n\n        if (STRPREFIX(de->d_name, \"usb\"))\n            tmpstr += 3;\n\n        if (virStrToLong_ui(tmpstr, &ignore, 10, &found_bus) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to parse dir name '%s'\"),\n                           de->d_name);\n            goto cleanup;\n        }\n\n        if (virUSBSysReadFile(\"devnum\", de->d_name,\n                              10, &found_devno) < 0)\n            goto cleanup;\n\n        if ((flags & USB_DEVICE_FIND_BY_VENDOR) &&\n            (found_prod != product || found_vend != vendor))\n            continue;\n\n        if (flags & USB_DEVICE_FIND_BY_BUS) {\n            if (found_bus != bus || found_devno != devno)\n                continue;\n            found = true;\n        }\n\n        usb = virUSBDeviceNew(found_bus, found_devno, vroot);\n\n        if (!usb)\n            goto cleanup;\n\n        if (virUSBDeviceListAdd(list, &usb) < 0)\n            goto cleanup;\n\n        if (found)\n            break;\n    }\n    if (direrr < 0)\n        goto cleanup;\n    ret = list;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (!ret)\n        virObjectUnref(list);\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define USB_SYSFS \"/sys/bus/usb\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define USB_SYSFS \"/sys/bus/usb\"\n\nstatic virUSBDeviceListPtr\nvirUSBDeviceSearch(unsigned int vendor,\n                   unsigned int product,\n                   unsigned int bus,\n                   unsigned int devno,\n                   const char *vroot,\n                   unsigned int flags)\n{\n    DIR *dir = NULL;\n    bool found = false;\n    char *ignore = NULL;\n    struct dirent *de;\n    virUSBDeviceListPtr list = NULL;\n    virUSBDeviceListPtr ret = NULL;\n    g_autoptr(virUSBDevice) usb = NULL;\n    int direrr;\n\n    if (!(list = virUSBDeviceListNew()))\n        goto cleanup;\n\n    if (virDirOpen(&dir, USB_SYSFS \"/devices\") < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &de, USB_SYSFS \"/devices\")) > 0) {\n        unsigned int found_prod, found_vend, found_bus, found_devno;\n        char *tmpstr = de->d_name;\n\n        if (strchr(de->d_name, ':'))\n            continue;\n\n        if (virUSBSysReadFile(\"idVendor\", de->d_name,\n                              16, &found_vend) < 0)\n            goto cleanup;\n\n        if (virUSBSysReadFile(\"idProduct\", de->d_name,\n                              16, &found_prod) < 0)\n            goto cleanup;\n\n        if (STRPREFIX(de->d_name, \"usb\"))\n            tmpstr += 3;\n\n        if (virStrToLong_ui(tmpstr, &ignore, 10, &found_bus) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to parse dir name '%s'\"),\n                           de->d_name);\n            goto cleanup;\n        }\n\n        if (virUSBSysReadFile(\"devnum\", de->d_name,\n                              10, &found_devno) < 0)\n            goto cleanup;\n\n        if ((flags & USB_DEVICE_FIND_BY_VENDOR) &&\n            (found_prod != product || found_vend != vendor))\n            continue;\n\n        if (flags & USB_DEVICE_FIND_BY_BUS) {\n            if (found_bus != bus || found_devno != devno)\n                continue;\n            found = true;\n        }\n\n        usb = virUSBDeviceNew(found_bus, found_devno, vroot);\n\n        if (!usb)\n            goto cleanup;\n\n        if (virUSBDeviceListAdd(list, &usb) < 0)\n            goto cleanup;\n\n        if (found)\n            break;\n    }\n    if (direrr < 0)\n        goto cleanup;\n    ret = list;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (!ret)\n        virObjectUnref(list);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirUSBDeviceFind(unsigned int vendor,\n                 unsigned int product,\n                 unsigned int bus,\n                 unsigned int devno,\n                 const char *vroot,\n                 bool mandatory,\n                 virUSBDevicePtr *usb)\n{\n    virUSBDeviceListPtr list;\n\n    unsigned int flags = USB_DEVICE_FIND_BY_VENDOR|USB_DEVICE_FIND_BY_BUS;\n    if (!(list = virUSBDeviceSearch(vendor, product, bus, devno,\n                                    vroot, flags)))\n        return -1;\n\n    if (list->count == 0) {\n        virObjectUnref(list);\n        if (!mandatory) {\n            VIR_DEBUG(\"Did not find USB device %04x:%04x bus:%u device:%u\",\n                      vendor, product, bus, devno);\n            if (usb)\n                *usb = NULL;\n            return 0;\n        }\n\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Did not find USB device %04x:%04x bus:%u device:%u\"),\n                       vendor, product, bus, devno);\n        return -1;\n    }\n\n    if (usb) {\n        *usb = virUSBDeviceListGet(list, 0);\n        virUSBDeviceListSteal(list, *usb);\n    }\n    virObjectUnref(list);\n\n    return 0;\n}"
  },
  {
    "function_name": "virUSBDeviceFindByBus",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "228-265",
    "snippet": "int\nvirUSBDeviceFindByBus(unsigned int bus,\n                      unsigned int devno,\n                      const char *vroot,\n                      bool mandatory,\n                      virUSBDevicePtr *usb)\n{\n    virUSBDeviceListPtr list;\n\n    if (!(list = virUSBDeviceSearch(0, 0, bus, devno,\n                                    vroot,\n                                    USB_DEVICE_FIND_BY_BUS)))\n        return -1;\n\n    if (list->count == 0) {\n        virObjectUnref(list);\n        if (!mandatory) {\n            VIR_DEBUG(\"Did not find USB device bus:%u device:%u\",\n                      bus, devno);\n            if (usb)\n                *usb = NULL;\n            return 0;\n        }\n\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Did not find USB device bus:%u device:%u\"),\n                       bus, devno);\n        return -1;\n    }\n\n    if (usb) {\n        *usb = virUSBDeviceListGet(list, 0);\n        virUSBDeviceListSteal(list, *usb);\n    }\n    virObjectUnref(list);\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "list"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceListSteal",
          "args": [
            "list",
            "*usb"
          ],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceListSteal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "472-488",
          "snippet": "virUSBDevicePtr\nvirUSBDeviceListSteal(virUSBDeviceListPtr list,\n                      virUSBDevicePtr dev)\n{\n    virUSBDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListSteal(virUSBDeviceListPtr list,\n                      virUSBDevicePtr dev)\n{\n    virUSBDevicePtr ret = NULL;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        if (list->devs[i]->bus == dev->bus &&\n            list->devs[i]->dev == dev->dev) {\n            ret = list->devs[i];\n            VIR_DELETE_ELEMENT(list->devs, i, list->count);\n            break;\n        }\n    }\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceListGet",
          "args": [
            "list",
            "0"
          ],
          "line": 259
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceListGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "455-464",
          "snippet": "virUSBDevicePtr\nvirUSBDeviceListGet(virUSBDeviceListPtr list,\n                    int idx)\n{\n    if (idx >= list->count ||\n        idx < 0)\n        return NULL;\n\n    return list->devs[idx];\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceListGet(virUSBDeviceListPtr list,\n                    int idx)\n{\n    if (idx >= list->count ||\n        idx < 0)\n        return NULL;\n\n    return list->devs[idx];\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Did not find USB device bus:%u device:%u\")",
            "bus",
            "devno"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Did not find USB device bus:%u device:%u\""
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Did not find USB device bus:%u device:%u\"",
            "bus",
            "devno"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virUSBDeviceSearch",
          "args": [
            "0",
            "0",
            "bus",
            "devno",
            "vroot",
            "USB_DEVICE_FIND_BY_BUS"
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceSearch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "105-187",
          "snippet": "static virUSBDeviceListPtr\nvirUSBDeviceSearch(unsigned int vendor,\n                   unsigned int product,\n                   unsigned int bus,\n                   unsigned int devno,\n                   const char *vroot,\n                   unsigned int flags)\n{\n    DIR *dir = NULL;\n    bool found = false;\n    char *ignore = NULL;\n    struct dirent *de;\n    virUSBDeviceListPtr list = NULL;\n    virUSBDeviceListPtr ret = NULL;\n    g_autoptr(virUSBDevice) usb = NULL;\n    int direrr;\n\n    if (!(list = virUSBDeviceListNew()))\n        goto cleanup;\n\n    if (virDirOpen(&dir, USB_SYSFS \"/devices\") < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &de, USB_SYSFS \"/devices\")) > 0) {\n        unsigned int found_prod, found_vend, found_bus, found_devno;\n        char *tmpstr = de->d_name;\n\n        if (strchr(de->d_name, ':'))\n            continue;\n\n        if (virUSBSysReadFile(\"idVendor\", de->d_name,\n                              16, &found_vend) < 0)\n            goto cleanup;\n\n        if (virUSBSysReadFile(\"idProduct\", de->d_name,\n                              16, &found_prod) < 0)\n            goto cleanup;\n\n        if (STRPREFIX(de->d_name, \"usb\"))\n            tmpstr += 3;\n\n        if (virStrToLong_ui(tmpstr, &ignore, 10, &found_bus) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to parse dir name '%s'\"),\n                           de->d_name);\n            goto cleanup;\n        }\n\n        if (virUSBSysReadFile(\"devnum\", de->d_name,\n                              10, &found_devno) < 0)\n            goto cleanup;\n\n        if ((flags & USB_DEVICE_FIND_BY_VENDOR) &&\n            (found_prod != product || found_vend != vendor))\n            continue;\n\n        if (flags & USB_DEVICE_FIND_BY_BUS) {\n            if (found_bus != bus || found_devno != devno)\n                continue;\n            found = true;\n        }\n\n        usb = virUSBDeviceNew(found_bus, found_devno, vroot);\n\n        if (!usb)\n            goto cleanup;\n\n        if (virUSBDeviceListAdd(list, &usb) < 0)\n            goto cleanup;\n\n        if (found)\n            break;\n    }\n    if (direrr < 0)\n        goto cleanup;\n    ret = list;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (!ret)\n        virObjectUnref(list);\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define USB_SYSFS \"/sys/bus/usb\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define USB_SYSFS \"/sys/bus/usb\"\n\nstatic virUSBDeviceListPtr\nvirUSBDeviceSearch(unsigned int vendor,\n                   unsigned int product,\n                   unsigned int bus,\n                   unsigned int devno,\n                   const char *vroot,\n                   unsigned int flags)\n{\n    DIR *dir = NULL;\n    bool found = false;\n    char *ignore = NULL;\n    struct dirent *de;\n    virUSBDeviceListPtr list = NULL;\n    virUSBDeviceListPtr ret = NULL;\n    g_autoptr(virUSBDevice) usb = NULL;\n    int direrr;\n\n    if (!(list = virUSBDeviceListNew()))\n        goto cleanup;\n\n    if (virDirOpen(&dir, USB_SYSFS \"/devices\") < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &de, USB_SYSFS \"/devices\")) > 0) {\n        unsigned int found_prod, found_vend, found_bus, found_devno;\n        char *tmpstr = de->d_name;\n\n        if (strchr(de->d_name, ':'))\n            continue;\n\n        if (virUSBSysReadFile(\"idVendor\", de->d_name,\n                              16, &found_vend) < 0)\n            goto cleanup;\n\n        if (virUSBSysReadFile(\"idProduct\", de->d_name,\n                              16, &found_prod) < 0)\n            goto cleanup;\n\n        if (STRPREFIX(de->d_name, \"usb\"))\n            tmpstr += 3;\n\n        if (virStrToLong_ui(tmpstr, &ignore, 10, &found_bus) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to parse dir name '%s'\"),\n                           de->d_name);\n            goto cleanup;\n        }\n\n        if (virUSBSysReadFile(\"devnum\", de->d_name,\n                              10, &found_devno) < 0)\n            goto cleanup;\n\n        if ((flags & USB_DEVICE_FIND_BY_VENDOR) &&\n            (found_prod != product || found_vend != vendor))\n            continue;\n\n        if (flags & USB_DEVICE_FIND_BY_BUS) {\n            if (found_bus != bus || found_devno != devno)\n                continue;\n            found = true;\n        }\n\n        usb = virUSBDeviceNew(found_bus, found_devno, vroot);\n\n        if (!usb)\n            goto cleanup;\n\n        if (virUSBDeviceListAdd(list, &usb) < 0)\n            goto cleanup;\n\n        if (found)\n            break;\n    }\n    if (direrr < 0)\n        goto cleanup;\n    ret = list;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (!ret)\n        virObjectUnref(list);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirUSBDeviceFindByBus(unsigned int bus,\n                      unsigned int devno,\n                      const char *vroot,\n                      bool mandatory,\n                      virUSBDevicePtr *usb)\n{\n    virUSBDeviceListPtr list;\n\n    if (!(list = virUSBDeviceSearch(0, 0, bus, devno,\n                                    vroot,\n                                    USB_DEVICE_FIND_BY_BUS)))\n        return -1;\n\n    if (list->count == 0) {\n        virObjectUnref(list);\n        if (!mandatory) {\n            VIR_DEBUG(\"Did not find USB device bus:%u device:%u\",\n                      bus, devno);\n            if (usb)\n                *usb = NULL;\n            return 0;\n        }\n\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Did not find USB device bus:%u device:%u\"),\n                       bus, devno);\n        return -1;\n    }\n\n    if (usb) {\n        *usb = virUSBDeviceListGet(list, 0);\n        virUSBDeviceListSteal(list, *usb);\n    }\n    virObjectUnref(list);\n\n    return 0;\n}"
  },
  {
    "function_name": "virUSBDeviceFindByVendor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "189-226",
    "snippet": "int\nvirUSBDeviceFindByVendor(unsigned int vendor,\n                         unsigned int product,\n                         const char *vroot,\n                         bool mandatory,\n                         virUSBDeviceListPtr *devices)\n{\n    virUSBDeviceListPtr list;\n    int count;\n\n    if (!(list = virUSBDeviceSearch(vendor, product, 0, 0,\n                                    vroot,\n                                    USB_DEVICE_FIND_BY_VENDOR)))\n        return -1;\n\n    if (list->count == 0) {\n        virObjectUnref(list);\n        if (!mandatory) {\n            VIR_DEBUG(\"Did not find USB device %04x:%04x\",\n                      vendor, product);\n            if (devices)\n                *devices = NULL;\n            return 0;\n        }\n\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Did not find USB device %04x:%04x\"), vendor, product);\n        return -1;\n    }\n\n    count = list->count;\n    if (devices)\n        *devices = list;\n    else\n        virObjectUnref(list);\n\n    return count;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "list"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Did not find USB device %04x:%04x\")",
            "vendor",
            "product"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Did not find USB device %04x:%04x\""
          ],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Did not find USB device %04x:%04x\"",
            "vendor",
            "product"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virUSBDeviceSearch",
          "args": [
            "vendor",
            "product",
            "0",
            "0",
            "vroot",
            "USB_DEVICE_FIND_BY_VENDOR"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceSearch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "105-187",
          "snippet": "static virUSBDeviceListPtr\nvirUSBDeviceSearch(unsigned int vendor,\n                   unsigned int product,\n                   unsigned int bus,\n                   unsigned int devno,\n                   const char *vroot,\n                   unsigned int flags)\n{\n    DIR *dir = NULL;\n    bool found = false;\n    char *ignore = NULL;\n    struct dirent *de;\n    virUSBDeviceListPtr list = NULL;\n    virUSBDeviceListPtr ret = NULL;\n    g_autoptr(virUSBDevice) usb = NULL;\n    int direrr;\n\n    if (!(list = virUSBDeviceListNew()))\n        goto cleanup;\n\n    if (virDirOpen(&dir, USB_SYSFS \"/devices\") < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &de, USB_SYSFS \"/devices\")) > 0) {\n        unsigned int found_prod, found_vend, found_bus, found_devno;\n        char *tmpstr = de->d_name;\n\n        if (strchr(de->d_name, ':'))\n            continue;\n\n        if (virUSBSysReadFile(\"idVendor\", de->d_name,\n                              16, &found_vend) < 0)\n            goto cleanup;\n\n        if (virUSBSysReadFile(\"idProduct\", de->d_name,\n                              16, &found_prod) < 0)\n            goto cleanup;\n\n        if (STRPREFIX(de->d_name, \"usb\"))\n            tmpstr += 3;\n\n        if (virStrToLong_ui(tmpstr, &ignore, 10, &found_bus) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to parse dir name '%s'\"),\n                           de->d_name);\n            goto cleanup;\n        }\n\n        if (virUSBSysReadFile(\"devnum\", de->d_name,\n                              10, &found_devno) < 0)\n            goto cleanup;\n\n        if ((flags & USB_DEVICE_FIND_BY_VENDOR) &&\n            (found_prod != product || found_vend != vendor))\n            continue;\n\n        if (flags & USB_DEVICE_FIND_BY_BUS) {\n            if (found_bus != bus || found_devno != devno)\n                continue;\n            found = true;\n        }\n\n        usb = virUSBDeviceNew(found_bus, found_devno, vroot);\n\n        if (!usb)\n            goto cleanup;\n\n        if (virUSBDeviceListAdd(list, &usb) < 0)\n            goto cleanup;\n\n        if (found)\n            break;\n    }\n    if (direrr < 0)\n        goto cleanup;\n    ret = list;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (!ret)\n        virObjectUnref(list);\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define USB_SYSFS \"/sys/bus/usb\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define USB_SYSFS \"/sys/bus/usb\"\n\nstatic virUSBDeviceListPtr\nvirUSBDeviceSearch(unsigned int vendor,\n                   unsigned int product,\n                   unsigned int bus,\n                   unsigned int devno,\n                   const char *vroot,\n                   unsigned int flags)\n{\n    DIR *dir = NULL;\n    bool found = false;\n    char *ignore = NULL;\n    struct dirent *de;\n    virUSBDeviceListPtr list = NULL;\n    virUSBDeviceListPtr ret = NULL;\n    g_autoptr(virUSBDevice) usb = NULL;\n    int direrr;\n\n    if (!(list = virUSBDeviceListNew()))\n        goto cleanup;\n\n    if (virDirOpen(&dir, USB_SYSFS \"/devices\") < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &de, USB_SYSFS \"/devices\")) > 0) {\n        unsigned int found_prod, found_vend, found_bus, found_devno;\n        char *tmpstr = de->d_name;\n\n        if (strchr(de->d_name, ':'))\n            continue;\n\n        if (virUSBSysReadFile(\"idVendor\", de->d_name,\n                              16, &found_vend) < 0)\n            goto cleanup;\n\n        if (virUSBSysReadFile(\"idProduct\", de->d_name,\n                              16, &found_prod) < 0)\n            goto cleanup;\n\n        if (STRPREFIX(de->d_name, \"usb\"))\n            tmpstr += 3;\n\n        if (virStrToLong_ui(tmpstr, &ignore, 10, &found_bus) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to parse dir name '%s'\"),\n                           de->d_name);\n            goto cleanup;\n        }\n\n        if (virUSBSysReadFile(\"devnum\", de->d_name,\n                              10, &found_devno) < 0)\n            goto cleanup;\n\n        if ((flags & USB_DEVICE_FIND_BY_VENDOR) &&\n            (found_prod != product || found_vend != vendor))\n            continue;\n\n        if (flags & USB_DEVICE_FIND_BY_BUS) {\n            if (found_bus != bus || found_devno != devno)\n                continue;\n            found = true;\n        }\n\n        usb = virUSBDeviceNew(found_bus, found_devno, vroot);\n\n        if (!usb)\n            goto cleanup;\n\n        if (virUSBDeviceListAdd(list, &usb) < 0)\n            goto cleanup;\n\n        if (found)\n            break;\n    }\n    if (direrr < 0)\n        goto cleanup;\n    ret = list;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (!ret)\n        virObjectUnref(list);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirUSBDeviceFindByVendor(unsigned int vendor,\n                         unsigned int product,\n                         const char *vroot,\n                         bool mandatory,\n                         virUSBDeviceListPtr *devices)\n{\n    virUSBDeviceListPtr list;\n    int count;\n\n    if (!(list = virUSBDeviceSearch(vendor, product, 0, 0,\n                                    vroot,\n                                    USB_DEVICE_FIND_BY_VENDOR)))\n        return -1;\n\n    if (list->count == 0) {\n        virObjectUnref(list);\n        if (!mandatory) {\n            VIR_DEBUG(\"Did not find USB device %04x:%04x\",\n                      vendor, product);\n            if (devices)\n                *devices = NULL;\n            return 0;\n        }\n\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Did not find USB device %04x:%04x\"), vendor, product);\n        return -1;\n    }\n\n    count = list->count;\n    if (devices)\n        *devices = list;\n    else\n        virObjectUnref(list);\n\n    return count;\n}"
  },
  {
    "function_name": "virUSBDeviceSearch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "105-187",
    "snippet": "static virUSBDeviceListPtr\nvirUSBDeviceSearch(unsigned int vendor,\n                   unsigned int product,\n                   unsigned int bus,\n                   unsigned int devno,\n                   const char *vroot,\n                   unsigned int flags)\n{\n    DIR *dir = NULL;\n    bool found = false;\n    char *ignore = NULL;\n    struct dirent *de;\n    virUSBDeviceListPtr list = NULL;\n    virUSBDeviceListPtr ret = NULL;\n    g_autoptr(virUSBDevice) usb = NULL;\n    int direrr;\n\n    if (!(list = virUSBDeviceListNew()))\n        goto cleanup;\n\n    if (virDirOpen(&dir, USB_SYSFS \"/devices\") < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &de, USB_SYSFS \"/devices\")) > 0) {\n        unsigned int found_prod, found_vend, found_bus, found_devno;\n        char *tmpstr = de->d_name;\n\n        if (strchr(de->d_name, ':'))\n            continue;\n\n        if (virUSBSysReadFile(\"idVendor\", de->d_name,\n                              16, &found_vend) < 0)\n            goto cleanup;\n\n        if (virUSBSysReadFile(\"idProduct\", de->d_name,\n                              16, &found_prod) < 0)\n            goto cleanup;\n\n        if (STRPREFIX(de->d_name, \"usb\"))\n            tmpstr += 3;\n\n        if (virStrToLong_ui(tmpstr, &ignore, 10, &found_bus) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to parse dir name '%s'\"),\n                           de->d_name);\n            goto cleanup;\n        }\n\n        if (virUSBSysReadFile(\"devnum\", de->d_name,\n                              10, &found_devno) < 0)\n            goto cleanup;\n\n        if ((flags & USB_DEVICE_FIND_BY_VENDOR) &&\n            (found_prod != product || found_vend != vendor))\n            continue;\n\n        if (flags & USB_DEVICE_FIND_BY_BUS) {\n            if (found_bus != bus || found_devno != devno)\n                continue;\n            found = true;\n        }\n\n        usb = virUSBDeviceNew(found_bus, found_devno, vroot);\n\n        if (!usb)\n            goto cleanup;\n\n        if (virUSBDeviceListAdd(list, &usb) < 0)\n            goto cleanup;\n\n        if (found)\n            break;\n    }\n    if (direrr < 0)\n        goto cleanup;\n    ret = list;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (!ret)\n        virObjectUnref(list);\n    return ret;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define USB_SYSFS \"/sys/bus/usb\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "list"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DIR_CLOSE",
          "args": [
            "dir"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virUSBDeviceListAdd",
          "args": [
            "list",
            "&usb"
          ],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceListAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "442-453",
          "snippet": "int\nvirUSBDeviceListAdd(virUSBDeviceListPtr list,\n                    virUSBDevicePtr *dev)\n{\n    if (virUSBDeviceListFind(list, *dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Device %s is already in use\"),\n                       (*dev)->name);\n        return -1;\n    }\n    return VIR_APPEND_ELEMENT(list->devs, list->count, *dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirUSBDeviceListAdd(virUSBDeviceListPtr list,\n                    virUSBDevicePtr *dev)\n{\n    if (virUSBDeviceListFind(list, *dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Device %s is already in use\"),\n                       (*dev)->name);\n        return -1;\n    }\n    return VIR_APPEND_ELEMENT(list->devs, list->count, *dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceNew",
          "args": [
            "found_bus",
            "found_devno",
            "vroot"
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "308-351",
          "snippet": "virUSBDevicePtr\nvirUSBDeviceNew(unsigned int bus,\n                unsigned int devno,\n                const char *vroot)\n{\n    virUSBDevicePtr dev;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus     = bus;\n    dev->dev     = devno;\n\n    if (g_snprintf(dev->name, sizeof(dev->name), \"%.3d:%.3d\",\n                   dev->bus, dev->dev) >= sizeof(dev->name)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->name buffer overflow: %.3d:%.3d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    if (vroot) {\n        dev->path = g_strdup_printf(\"%s/%03d/%03d\",\n                                    vroot, dev->bus, dev->dev);\n    } else {\n        dev->path = g_strdup_printf(USB_DEVFS \"%03d/%03d\",\n                                    dev->bus, dev->dev);\n    }\n\n    /* XXX fixme. this should be product/vendor */\n    if (g_snprintf(dev->id, sizeof(dev->id), \"%d %d\", dev->bus,\n                   dev->dev) >= sizeof(dev->id)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->id buffer overflow: %d %d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    VIR_DEBUG(\"%s %s: initialized\", dev->id, dev->name);\n\n    return dev;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceNew(unsigned int bus,\n                unsigned int devno,\n                const char *vroot)\n{\n    virUSBDevicePtr dev;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus     = bus;\n    dev->dev     = devno;\n\n    if (g_snprintf(dev->name, sizeof(dev->name), \"%.3d:%.3d\",\n                   dev->bus, dev->dev) >= sizeof(dev->name)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->name buffer overflow: %.3d:%.3d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    if (vroot) {\n        dev->path = g_strdup_printf(\"%s/%03d/%03d\",\n                                    vroot, dev->bus, dev->dev);\n    } else {\n        dev->path = g_strdup_printf(USB_DEVFS \"%03d/%03d\",\n                                    dev->bus, dev->dev);\n    }\n\n    /* XXX fixme. this should be product/vendor */\n    if (g_snprintf(dev->id, sizeof(dev->id), \"%d %d\", dev->bus,\n                   dev->dev) >= sizeof(dev->id)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->id buffer overflow: %d %d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    VIR_DEBUG(\"%s %s: initialized\", dev->id, dev->name);\n\n    return dev;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBSysReadFile",
          "args": [
            "\"devnum\"",
            "de->d_name",
            "10",
            "&found_devno"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBSysReadFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "84-103",
          "snippet": "static int virUSBSysReadFile(const char *f_name, const char *d_name,\n                             int base, unsigned int *value)\n{\n    g_autofree char *buf = NULL;\n    g_autofree char *filename = NULL;\n    char *ignore = NULL;\n\n    filename = g_strdup_printf(USB_SYSFS \"/devices/%s/%s\", d_name, f_name);\n\n    if (virFileReadAll(filename, 1024, &buf) < 0)\n        return -1;\n\n    if (virStrToLong_ui(buf, &ignore, base, value) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not parse usb file %s\"), filename);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define USB_SYSFS \"/sys/bus/usb\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define USB_SYSFS \"/sys/bus/usb\"\n\nstatic int virUSBSysReadFile(const char *f_name, const char *d_name,\n                             int base, unsigned int *value)\n{\n    g_autofree char *buf = NULL;\n    g_autofree char *filename = NULL;\n    char *ignore = NULL;\n\n    filename = g_strdup_printf(USB_SYSFS \"/devices/%s/%s\", d_name, f_name);\n\n    if (virFileReadAll(filename, 1024, &buf) < 0)\n        return -1;\n\n    if (virStrToLong_ui(buf, &ignore, base, value) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not parse usb file %s\"), filename);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to parse dir name '%s'\")",
            "de->d_name"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to parse dir name '%s'\""
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrToLong_ui",
          "args": [
            "tmpstr",
            "&ignore",
            "10",
            "&found_bus"
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_uip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "444-461",
          "snippet": "int\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "de->d_name",
            "\"usb\""
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "de->d_name",
            "':'"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDirRead",
          "args": [
            "dir",
            "&de",
            "USB_SYSFS \"/devices\""
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "virDirRead",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2940-2954",
          "snippet": "int virDirRead(DIR *dirp, struct dirent **ent, const char *name)\n{\n    do {\n        errno = 0;\n        *ent = readdir(dirp); /* exempt from syntax-check */\n        if (!*ent && errno) {\n            if (name)\n                virReportSystemError(errno, _(\"Unable to read directory '%s'\"),\n                                     name);\n            return -1;\n        }\n    } while (*ent && (STREQ((*ent)->d_name, \".\") ||\n                      STREQ((*ent)->d_name, \"..\")));\n    return !!*ent;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virDirRead(DIR *dirp, struct dirent **ent, const char *name)\n{\n    do {\n        errno = 0;\n        *ent = readdir(dirp); /* exempt from syntax-check */\n        if (!*ent && errno) {\n            if (name)\n                virReportSystemError(errno, _(\"Unable to read directory '%s'\"),\n                                     name);\n            return -1;\n        }\n    } while (*ent && (STREQ((*ent)->d_name, \".\") ||\n                      STREQ((*ent)->d_name, \"..\")));\n    return !!*ent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDirOpen",
          "args": [
            "&dir",
            "USB_SYSFS \"/devices\""
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "virDirOpenQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2914-2918",
          "snippet": "int\nvirDirOpenQuiet(DIR **dirp, const char *name)\n{\n    return virDirOpenInternal(dirp, name, false, true);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDirOpenQuiet(DIR **dirp, const char *name)\n{\n    return virDirOpenInternal(dirp, name, false, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceListNew",
          "args": [],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceListNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "416-428",
          "snippet": "virUSBDeviceListPtr\nvirUSBDeviceListNew(void)\n{\n    virUSBDeviceListPtr list;\n\n    if (virUSBInitialize() < 0)\n        return NULL;\n\n    if (!(list = virObjectLockableNew(virUSBDeviceListClass)))\n        return NULL;\n\n    return list;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virUSBDeviceListClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic virClassPtr virUSBDeviceListClass;\n\nvirUSBDeviceListPtr\nvirUSBDeviceListNew(void)\n{\n    virUSBDeviceListPtr list;\n\n    if (virUSBInitialize() < 0)\n        return NULL;\n\n    if (!(list = virObjectLockableNew(virUSBDeviceListClass)))\n        return NULL;\n\n    return list;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define USB_SYSFS \"/sys/bus/usb\"\n\nstatic virUSBDeviceListPtr\nvirUSBDeviceSearch(unsigned int vendor,\n                   unsigned int product,\n                   unsigned int bus,\n                   unsigned int devno,\n                   const char *vroot,\n                   unsigned int flags)\n{\n    DIR *dir = NULL;\n    bool found = false;\n    char *ignore = NULL;\n    struct dirent *de;\n    virUSBDeviceListPtr list = NULL;\n    virUSBDeviceListPtr ret = NULL;\n    g_autoptr(virUSBDevice) usb = NULL;\n    int direrr;\n\n    if (!(list = virUSBDeviceListNew()))\n        goto cleanup;\n\n    if (virDirOpen(&dir, USB_SYSFS \"/devices\") < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &de, USB_SYSFS \"/devices\")) > 0) {\n        unsigned int found_prod, found_vend, found_bus, found_devno;\n        char *tmpstr = de->d_name;\n\n        if (strchr(de->d_name, ':'))\n            continue;\n\n        if (virUSBSysReadFile(\"idVendor\", de->d_name,\n                              16, &found_vend) < 0)\n            goto cleanup;\n\n        if (virUSBSysReadFile(\"idProduct\", de->d_name,\n                              16, &found_prod) < 0)\n            goto cleanup;\n\n        if (STRPREFIX(de->d_name, \"usb\"))\n            tmpstr += 3;\n\n        if (virStrToLong_ui(tmpstr, &ignore, 10, &found_bus) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to parse dir name '%s'\"),\n                           de->d_name);\n            goto cleanup;\n        }\n\n        if (virUSBSysReadFile(\"devnum\", de->d_name,\n                              10, &found_devno) < 0)\n            goto cleanup;\n\n        if ((flags & USB_DEVICE_FIND_BY_VENDOR) &&\n            (found_prod != product || found_vend != vendor))\n            continue;\n\n        if (flags & USB_DEVICE_FIND_BY_BUS) {\n            if (found_bus != bus || found_devno != devno)\n                continue;\n            found = true;\n        }\n\n        usb = virUSBDeviceNew(found_bus, found_devno, vroot);\n\n        if (!usb)\n            goto cleanup;\n\n        if (virUSBDeviceListAdd(list, &usb) < 0)\n            goto cleanup;\n\n        if (found)\n            break;\n    }\n    if (direrr < 0)\n        goto cleanup;\n    ret = list;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    if (!ret)\n        virObjectUnref(list);\n    return ret;\n}"
  },
  {
    "function_name": "virUSBSysReadFile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "84-103",
    "snippet": "static int virUSBSysReadFile(const char *f_name, const char *d_name,\n                             int base, unsigned int *value)\n{\n    g_autofree char *buf = NULL;\n    g_autofree char *filename = NULL;\n    char *ignore = NULL;\n\n    filename = g_strdup_printf(USB_SYSFS \"/devices/%s/%s\", d_name, f_name);\n\n    if (virFileReadAll(filename, 1024, &buf) < 0)\n        return -1;\n\n    if (virStrToLong_ui(buf, &ignore, base, value) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not parse usb file %s\"), filename);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define USB_SYSFS \"/sys/bus/usb\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Could not parse usb file %s\")",
            "filename"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Could not parse usb file %s\""
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrToLong_ui",
          "args": [
            "buf",
            "&ignore",
            "base",
            "value"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_uip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "444-461",
          "snippet": "int\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "filename",
            "1024",
            "&buf"
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define USB_SYSFS \"/sys/bus/usb\"\n\nstatic int virUSBSysReadFile(const char *f_name, const char *d_name,\n                             int base, unsigned int *value)\n{\n    g_autofree char *buf = NULL;\n    g_autofree char *filename = NULL;\n    char *ignore = NULL;\n\n    filename = g_strdup_printf(USB_SYSFS \"/devices/%s/%s\", d_name, f_name);\n\n    if (virFileReadAll(filename, 1024, &buf) < 0)\n        return -1;\n\n    if (virStrToLong_ui(buf, &ignore, base, value) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not parse usb file %s\"), filename);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virUSBOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
    "lines": "74-80",
    "snippet": "static int virUSBOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virUSBDeviceList, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virusb.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <inttypes.h>",
      "#include <fcntl.h>",
      "#include <dirent.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virUSBDeviceList",
            "virClassForObjectLockable()"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virClassForObjectLockable",
          "args": [],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "virClassForObjectLockable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "116-123",
          "snippet": "virClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectLockableClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectLockableClass;\n\nvirClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic int virUSBOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virUSBDeviceList, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}"
  }
]