[
  {
    "function_name": "hypervFreeParsedUri",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/hyperv/hyperv_util.c",
    "lines": "87-96",
    "snippet": "void\nhypervFreeParsedUri(hypervParsedUri **parsedUri)\n{\n    if (parsedUri == NULL || *parsedUri == NULL)\n        return;\n\n    VIR_FREE((*parsedUri)->transport);\n\n    VIR_FREE(*parsedUri);\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"hyperv_util.h\"",
      "#include \"hyperv_private.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "*parsedUri"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "(*parsedUri)->transport"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"hyperv_util.h\"\n#include \"hyperv_private.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nhypervFreeParsedUri(hypervParsedUri **parsedUri)\n{\n    if (parsedUri == NULL || *parsedUri == NULL)\n        return;\n\n    VIR_FREE((*parsedUri)->transport);\n\n    VIR_FREE(*parsedUri);\n}"
  },
  {
    "function_name": "hypervParseUri",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/hyperv/hyperv_util.c",
    "lines": "37-83",
    "snippet": "int\nhypervParseUri(hypervParsedUri **parsedUri, virURIPtr uri)\n{\n    int result = -1;\n    size_t i;\n\n    if (parsedUri == NULL || *parsedUri != NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\", _(\"Invalid argument\"));\n        return -1;\n    }\n\n    if (VIR_ALLOC(*parsedUri) < 0)\n        return -1;\n\n    for (i = 0; i < uri->paramsCount; i++) {\n        virURIParamPtr queryParam = &uri->params[i];\n\n        if (STRCASEEQ(queryParam->name, \"transport\")) {\n            VIR_FREE((*parsedUri)->transport);\n\n            (*parsedUri)->transport = g_strdup(queryParam->value);\n\n            if (STRNEQ((*parsedUri)->transport, \"http\") &&\n                STRNEQ((*parsedUri)->transport, \"https\")) {\n                virReportError(VIR_ERR_INVALID_ARG,\n                               _(\"Query parameter 'transport' has unexpected value \"\n                                 \"'%s' (should be http|https)\"),\n                               (*parsedUri)->transport);\n                goto cleanup;\n            }\n        } else {\n            VIR_WARN(\"Ignoring unexpected query parameter '%s'\",\n                     queryParam->name);\n        }\n    }\n\n    if (!(*parsedUri)->transport)\n        (*parsedUri)->transport = g_strdup(\"https\");\n\n    result = 0;\n\n cleanup:\n    if (result < 0)\n        hypervFreeParsedUri(parsedUri);\n\n    return result;\n}",
    "includes": [
      "#include \"virstring.h\"",
      "#include \"hyperv_util.h\"",
      "#include \"hyperv_private.h\"",
      "#include \"viruuid.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hypervFreeParsedUri",
          "args": [
            "parsedUri"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "hypervFreeParsedUri",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/hyperv/hyperv_util.c",
          "lines": "87-96",
          "snippet": "void\nhypervFreeParsedUri(hypervParsedUri **parsedUri)\n{\n    if (parsedUri == NULL || *parsedUri == NULL)\n        return;\n\n    VIR_FREE((*parsedUri)->transport);\n\n    VIR_FREE(*parsedUri);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"hyperv_util.h\"",
            "#include \"hyperv_private.h\"",
            "#include \"viruuid.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"hyperv_util.h\"\n#include \"hyperv_private.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nhypervFreeParsedUri(hypervParsedUri **parsedUri)\n{\n    if (parsedUri == NULL || *parsedUri == NULL)\n        return;\n\n    VIR_FREE((*parsedUri)->transport);\n\n    VIR_FREE(*parsedUri);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "\"https\""
          ],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Ignoring unexpected query parameter '%s'\"",
            "queryParam->name"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "_(\"Query parameter 'transport' has unexpected value \"\n                                 \"'%s' (should be http|https)\")",
            "(*parsedUri)->transport"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "(*parsedUri)->transport",
            "\"https\""
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "(*parsedUri)->transport",
            "\"http\""
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "(*parsedUri)->transport"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRCASEEQ",
          "args": [
            "queryParam->name",
            "\"transport\""
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "*parsedUri"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Invalid argument\")"
          ],
          "line": 44
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virstring.h\"\n#include \"hyperv_util.h\"\n#include \"hyperv_private.h\"\n#include \"viruuid.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <config.h>\n\nint\nhypervParseUri(hypervParsedUri **parsedUri, virURIPtr uri)\n{\n    int result = -1;\n    size_t i;\n\n    if (parsedUri == NULL || *parsedUri != NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\", _(\"Invalid argument\"));\n        return -1;\n    }\n\n    if (VIR_ALLOC(*parsedUri) < 0)\n        return -1;\n\n    for (i = 0; i < uri->paramsCount; i++) {\n        virURIParamPtr queryParam = &uri->params[i];\n\n        if (STRCASEEQ(queryParam->name, \"transport\")) {\n            VIR_FREE((*parsedUri)->transport);\n\n            (*parsedUri)->transport = g_strdup(queryParam->value);\n\n            if (STRNEQ((*parsedUri)->transport, \"http\") &&\n                STRNEQ((*parsedUri)->transport, \"https\")) {\n                virReportError(VIR_ERR_INVALID_ARG,\n                               _(\"Query parameter 'transport' has unexpected value \"\n                                 \"'%s' (should be http|https)\"),\n                               (*parsedUri)->transport);\n                goto cleanup;\n            }\n        } else {\n            VIR_WARN(\"Ignoring unexpected query parameter '%s'\",\n                     queryParam->name);\n        }\n    }\n\n    if (!(*parsedUri)->transport)\n        (*parsedUri)->transport = g_strdup(\"https\");\n\n    result = 0;\n\n cleanup:\n    if (result < 0)\n        hypervFreeParsedUri(parsedUri);\n\n    return result;\n}"
  }
]