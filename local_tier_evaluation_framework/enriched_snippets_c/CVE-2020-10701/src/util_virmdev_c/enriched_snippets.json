[
  {
    "function_name": "virMediatedDeviceTypeReadAttrs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "488-520",
    "snippet": "int\nvirMediatedDeviceTypeReadAttrs(const char *sysfspath,\n                               virMediatedDeviceTypePtr *type)\n{\n    g_autoptr(virMediatedDeviceType) tmp = NULL;\n\n#define MDEV_GET_SYSFS_ATTR(attr, dst, cb, optional) \\\n    do { \\\n        int rc; \\\n        if ((rc = cb(dst, \"%s/%s\", sysfspath, attr)) < 0) { \\\n            if (rc != -2 || !optional) \\\n                return -1; \\\n        } \\\n    } while (0)\n\n    if (VIR_ALLOC(tmp) < 0)\n        return -1;\n\n    tmp->id = g_path_get_basename(sysfspath);\n\n    /* @name sysfs attribute is optional, so getting ENOENT is fine */\n    MDEV_GET_SYSFS_ATTR(\"name\", &tmp->name, virFileReadValueString, true);\n    MDEV_GET_SYSFS_ATTR(\"device_api\", &tmp->device_api,\n                        virFileReadValueString, false);\n    MDEV_GET_SYSFS_ATTR(\"available_instances\", &tmp->available_instances,\n                        virFileReadValueUint, false);\n\n#undef MDEV_GET_SYSFS_ATTR\n\n    *type = g_steal_pointer(&tmp);\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&tmp"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MDEV_GET_SYSFS_ATTR",
          "args": [
            "\"available_instances\"",
            "&tmp->available_instances",
            "virFileReadValueUint",
            "false"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MDEV_GET_SYSFS_ATTR",
          "args": [
            "\"device_api\"",
            "&tmp->device_api",
            "virFileReadValueString",
            "false"
          ],
          "line": 510
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MDEV_GET_SYSFS_ATTR",
          "args": [
            "\"name\"",
            "&tmp->name",
            "virFileReadValueString",
            "true"
          ],
          "line": 509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_path_get_basename",
          "args": [
            "sysfspath"
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "tmp"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceTypeReadAttrs(const char *sysfspath,\n                               virMediatedDeviceTypePtr *type)\n{\n    g_autoptr(virMediatedDeviceType) tmp = NULL;\n\n#define MDEV_GET_SYSFS_ATTR(attr, dst, cb, optional) \\\n    do { \\\n        int rc; \\\n        if ((rc = cb(dst, \"%s/%s\", sysfspath, attr)) < 0) { \\\n            if (rc != -2 || !optional) \\\n                return -1; \\\n        } \\\n    } while (0)\n\n    if (VIR_ALLOC(tmp) < 0)\n        return -1;\n\n    tmp->id = g_path_get_basename(sysfspath);\n\n    /* @name sysfs attribute is optional, so getting ENOENT is fine */\n    MDEV_GET_SYSFS_ATTR(\"name\", &tmp->name, virFileReadValueString, true);\n    MDEV_GET_SYSFS_ATTR(\"device_api\", &tmp->device_api,\n                        virFileReadValueString, false);\n    MDEV_GET_SYSFS_ATTR(\"available_instances\", &tmp->available_instances,\n                        virFileReadValueUint, false);\n\n#undef MDEV_GET_SYSFS_ATTR\n\n    *type = g_steal_pointer(&tmp);\n\n    return 0;\n}"
  },
  {
    "function_name": "virMediatedDeviceTypeFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "475-485",
    "snippet": "void\nvirMediatedDeviceTypeFree(virMediatedDeviceTypePtr type)\n{\n    if (!type)\n        return;\n\n    VIR_FREE(type->id);\n    VIR_FREE(type->name);\n    VIR_FREE(type->device_api);\n    VIR_FREE(type);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "type"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "type->device_api"
          ],
          "line": 483
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "type->name"
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "type->id"
          ],
          "line": 481
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvoid\nvirMediatedDeviceTypeFree(virMediatedDeviceTypePtr type)\n{\n    if (!type)\n        return;\n\n    VIR_FREE(type->id);\n    VIR_FREE(type->name);\n    VIR_FREE(type->device_api);\n    VIR_FREE(type);\n}"
  },
  {
    "function_name": "virMediatedDeviceListMarkDevices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "432-472",
    "snippet": "int\nvirMediatedDeviceListMarkDevices(virMediatedDeviceListPtr dst,\n                                 virMediatedDeviceListPtr src,\n                                 const char *drvname,\n                                 const char *domname)\n{\n    int ret = -1;\n    size_t count = virMediatedDeviceListCount(src);\n    size_t i, j;\n\n    virObjectLock(dst);\n    for (i = 0; i < count; i++) {\n        virMediatedDevicePtr mdev = virMediatedDeviceListGet(src, i);\n\n        if (virMediatedDeviceIsUsed(mdev, dst) ||\n            virMediatedDeviceSetUsedBy(mdev, drvname, domname) < 0)\n            goto cleanup;\n\n        /* Copy mdev references to the driver list:\n         * - caller is responsible for NOT freeing devices in @src on success\n         * - we're responsible for performing a rollback on failure\n         */\n        VIR_DEBUG(\"Add '%s' to list of active mediated devices used by '%s'\",\n                  mdev->path, domname);\n        if (virMediatedDeviceListAdd(dst, &mdev) < 0)\n            goto rollback;\n\n    }\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(dst);\n    return ret;\n\n rollback:\n    for (j = 0; j < i; j++) {\n        virMediatedDevicePtr tmp = virMediatedDeviceListGet(src, j);\n        virMediatedDeviceListSteal(dst, tmp);\n    }\n    goto cleanup;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMediatedDeviceListSteal",
          "args": [
            "dst",
            "tmp"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListSteal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "357-364",
          "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListSteal(virMediatedDeviceListPtr list,\n                           virMediatedDevicePtr dev)\n{\n    int idx = virMediatedDeviceListFindIndex(list, dev);\n\n    return virMediatedDeviceListStealIndex(list, idx);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListSteal(virMediatedDeviceListPtr list,\n                           virMediatedDevicePtr dev)\n{\n    int idx = virMediatedDeviceListFindIndex(list, dev);\n\n    return virMediatedDeviceListStealIndex(list, idx);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceListGet",
          "args": [
            "src",
            "j"
          ],
          "line": 468
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "324-332",
          "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListGet(virMediatedDeviceListPtr list,\n                         ssize_t idx)\n{\n    if (idx < 0 || idx >= list->count)\n        return NULL;\n\n    return list->devs[idx];\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListGet(virMediatedDeviceListPtr list,\n                         ssize_t idx)\n{\n    if (idx < 0 || idx >= list->count)\n        return NULL;\n\n    return list->devs[idx];\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "dst"
          ],
          "line": 463
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceListAdd",
          "args": [
            "dst",
            "&mdev"
          ],
          "line": 456
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "311-321",
          "snippet": "int\nvirMediatedDeviceListAdd(virMediatedDeviceListPtr list,\n                         virMediatedDevicePtr *dev)\n{\n    if (virMediatedDeviceListFind(list, *dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"device %s is already in use\"), (*dev)->path);\n        return -1;\n    }\n    return VIR_APPEND_ELEMENT(list->devs, list->count, *dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceListAdd(virMediatedDeviceListPtr list,\n                         virMediatedDevicePtr *dev)\n{\n    if (virMediatedDeviceListFind(list, *dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"device %s is already in use\"), (*dev)->path);\n        return -1;\n    }\n    return VIR_APPEND_ELEMENT(list->devs, list->count, *dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Add '%s' to list of active mediated devices used by '%s'\"",
            "mdev->path",
            "domname"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceSetUsedBy",
          "args": [
            "mdev",
            "drvname",
            "domname"
          ],
          "line": 447
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceSetUsedBy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "263-274",
          "snippet": "int\nvirMediatedDeviceSetUsedBy(virMediatedDevicePtr dev,\n                           const char *drvname,\n                           const char *domname)\n{\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    dev->used_by_drvname = g_strdup(drvname);\n    dev->used_by_domname = g_strdup(domname);\n\n    return 0;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceSetUsedBy(virMediatedDevicePtr dev,\n                           const char *drvname,\n                           const char *domname)\n{\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    dev->used_by_drvname = g_strdup(drvname);\n    dev->used_by_domname = g_strdup(domname);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceIsUsed",
          "args": [
            "mdev",
            "dst"
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceIsUsed",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "403-419",
          "snippet": "bool\nvirMediatedDeviceIsUsed(virMediatedDevicePtr dev,\n                        virMediatedDeviceListPtr list)\n{\n    const char *drvname, *domname;\n    virMediatedDevicePtr tmp = NULL;\n\n    if ((tmp = virMediatedDeviceListFind(list, dev))) {\n        virMediatedDeviceGetUsedBy(tmp, &drvname, &domname);\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"mediated device %s is in use by \"\n                         \"driver %s, domain %s\"),\n                       tmp->path, drvname, domname);\n    }\n\n    return !!tmp;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nbool\nvirMediatedDeviceIsUsed(virMediatedDevicePtr dev,\n                        virMediatedDeviceListPtr list)\n{\n    const char *drvname, *domname;\n    virMediatedDevicePtr tmp = NULL;\n\n    if ((tmp = virMediatedDeviceListFind(list, dev))) {\n        virMediatedDeviceGetUsedBy(tmp, &drvname, &domname);\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"mediated device %s is in use by \"\n                         \"driver %s, domain %s\"),\n                       tmp->path, drvname, domname);\n    }\n\n    return !!tmp;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "dst"
          ],
          "line": 442
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceListCount",
          "args": [
            "src"
          ],
          "line": 439
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "335-339",
          "snippet": "size_t\nvirMediatedDeviceListCount(virMediatedDeviceListPtr list)\n{\n    return list->count;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nsize_t\nvirMediatedDeviceListCount(virMediatedDeviceListPtr list)\n{\n    return list->count;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceListMarkDevices(virMediatedDeviceListPtr dst,\n                                 virMediatedDeviceListPtr src,\n                                 const char *drvname,\n                                 const char *domname)\n{\n    int ret = -1;\n    size_t count = virMediatedDeviceListCount(src);\n    size_t i, j;\n\n    virObjectLock(dst);\n    for (i = 0; i < count; i++) {\n        virMediatedDevicePtr mdev = virMediatedDeviceListGet(src, i);\n\n        if (virMediatedDeviceIsUsed(mdev, dst) ||\n            virMediatedDeviceSetUsedBy(mdev, drvname, domname) < 0)\n            goto cleanup;\n\n        /* Copy mdev references to the driver list:\n         * - caller is responsible for NOT freeing devices in @src on success\n         * - we're responsible for performing a rollback on failure\n         */\n        VIR_DEBUG(\"Add '%s' to list of active mediated devices used by '%s'\",\n                  mdev->path, domname);\n        if (virMediatedDeviceListAdd(dst, &mdev) < 0)\n            goto rollback;\n\n    }\n\n    ret = 0;\n cleanup:\n    virObjectUnlock(dst);\n    return ret;\n\n rollback:\n    for (j = 0; j < i; j++) {\n        virMediatedDevicePtr tmp = virMediatedDeviceListGet(src, j);\n        virMediatedDeviceListSteal(dst, tmp);\n    }\n    goto cleanup;\n}"
  },
  {
    "function_name": "virMediatedDeviceGetSysfsPath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "422-429",
    "snippet": "char *\nvirMediatedDeviceGetSysfsPath(const char *uuidstr)\n{\n    char *ret = NULL;\n\n    ret = g_strdup_printf(MDEV_SYSFS_DEVICES \"%s\", uuidstr);\n    return ret;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MDEV_SYSFS_DEVICES \"/sys/bus/mdev/devices/\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "MDEV_SYSFS_DEVICES \"%s\"",
            "uuidstr"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\n#define MDEV_SYSFS_DEVICES \"/sys/bus/mdev/devices/\"\n\nchar *\nvirMediatedDeviceGetSysfsPath(const char *uuidstr)\n{\n    char *ret = NULL;\n\n    ret = g_strdup_printf(MDEV_SYSFS_DEVICES \"%s\", uuidstr);\n    return ret;\n}"
  },
  {
    "function_name": "virMediatedDeviceIsUsed",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "403-419",
    "snippet": "bool\nvirMediatedDeviceIsUsed(virMediatedDevicePtr dev,\n                        virMediatedDeviceListPtr list)\n{\n    const char *drvname, *domname;\n    virMediatedDevicePtr tmp = NULL;\n\n    if ((tmp = virMediatedDeviceListFind(list, dev))) {\n        virMediatedDeviceGetUsedBy(tmp, &drvname, &domname);\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"mediated device %s is in use by \"\n                         \"driver %s, domain %s\"),\n                       tmp->path, drvname, domname);\n    }\n\n    return !!tmp;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "_(\"mediated device %s is in use by \"\n                         \"driver %s, domain %s\")",
            "tmp->path",
            "drvname",
            "domname"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"mediated device %s is in use by \"\n                         \"driver %s, domain %s\""
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceGetUsedBy",
          "args": [
            "tmp",
            "&drvname",
            "&domname"
          ],
          "line": 411
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceGetUsedBy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "254-260",
          "snippet": "void\nvirMediatedDeviceGetUsedBy(virMediatedDevicePtr dev,\n                           const char **drvname, const char **domname)\n{\n    *drvname = dev->used_by_drvname;\n    *domname = dev->used_by_domname;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvoid\nvirMediatedDeviceGetUsedBy(virMediatedDevicePtr dev,\n                           const char **drvname, const char **domname)\n{\n    *drvname = dev->used_by_drvname;\n    *domname = dev->used_by_domname;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceListFind",
          "args": [
            "list",
            "dev"
          ],
          "line": 410
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListFind",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "390-400",
          "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListFind(virMediatedDeviceListPtr list,\n                          virMediatedDevicePtr dev)\n{\n    int idx;\n\n    if ((idx = virMediatedDeviceListFindIndex(list, dev)) >= 0)\n        return list->devs[idx];\n    else\n        return NULL;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListFind(virMediatedDeviceListPtr list,\n                          virMediatedDevicePtr dev)\n{\n    int idx;\n\n    if ((idx = virMediatedDeviceListFindIndex(list, dev)) >= 0)\n        return list->devs[idx];\n    else\n        return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nbool\nvirMediatedDeviceIsUsed(virMediatedDevicePtr dev,\n                        virMediatedDeviceListPtr list)\n{\n    const char *drvname, *domname;\n    virMediatedDevicePtr tmp = NULL;\n\n    if ((tmp = virMediatedDeviceListFind(list, dev))) {\n        virMediatedDeviceGetUsedBy(tmp, &drvname, &domname);\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"mediated device %s is in use by \"\n                         \"driver %s, domain %s\"),\n                       tmp->path, drvname, domname);\n    }\n\n    return !!tmp;\n}"
  },
  {
    "function_name": "virMediatedDeviceListFind",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "390-400",
    "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListFind(virMediatedDeviceListPtr list,\n                          virMediatedDevicePtr dev)\n{\n    int idx;\n\n    if ((idx = virMediatedDeviceListFindIndex(list, dev)) >= 0)\n        return list->devs[idx];\n    else\n        return NULL;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMediatedDeviceListFindIndex",
          "args": [
            "list",
            "dev"
          ],
          "line": 396
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListFindIndex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "375-387",
          "snippet": "int\nvirMediatedDeviceListFindIndex(virMediatedDeviceListPtr list,\n                               virMediatedDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        virMediatedDevicePtr other = list->devs[i];\n        if (STREQ(other->path, dev->path))\n            return i;\n    }\n    return -1;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceListFindIndex(virMediatedDeviceListPtr list,\n                               virMediatedDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        virMediatedDevicePtr other = list->devs[i];\n        if (STREQ(other->path, dev->path))\n            return i;\n    }\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListFind(virMediatedDeviceListPtr list,\n                          virMediatedDevicePtr dev)\n{\n    int idx;\n\n    if ((idx = virMediatedDeviceListFindIndex(list, dev)) >= 0)\n        return list->devs[idx];\n    else\n        return NULL;\n}"
  },
  {
    "function_name": "virMediatedDeviceListFindIndex",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "375-387",
    "snippet": "int\nvirMediatedDeviceListFindIndex(virMediatedDeviceListPtr list,\n                               virMediatedDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        virMediatedDevicePtr other = list->devs[i];\n        if (STREQ(other->path, dev->path))\n            return i;\n    }\n    return -1;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "other->path",
            "dev->path"
          ],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceListFindIndex(virMediatedDeviceListPtr list,\n                               virMediatedDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        virMediatedDevicePtr other = list->devs[i];\n        if (STREQ(other->path, dev->path))\n            return i;\n    }\n    return -1;\n}"
  },
  {
    "function_name": "virMediatedDeviceListDel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "367-372",
    "snippet": "void\nvirMediatedDeviceListDel(virMediatedDeviceListPtr list,\n                         virMediatedDevicePtr dev)\n{\n    virMediatedDeviceFree(virMediatedDeviceListSteal(list, dev));\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMediatedDeviceFree",
          "args": [
            "virMediatedDeviceListSteal(list, dev)"
          ],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "182-191",
          "snippet": "void\nvirMediatedDeviceFree(virMediatedDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvoid\nvirMediatedDeviceFree(virMediatedDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceListSteal",
          "args": [
            "list",
            "dev"
          ],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListSteal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "357-364",
          "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListSteal(virMediatedDeviceListPtr list,\n                           virMediatedDevicePtr dev)\n{\n    int idx = virMediatedDeviceListFindIndex(list, dev);\n\n    return virMediatedDeviceListStealIndex(list, idx);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListSteal(virMediatedDeviceListPtr list,\n                           virMediatedDevicePtr dev)\n{\n    int idx = virMediatedDeviceListFindIndex(list, dev);\n\n    return virMediatedDeviceListStealIndex(list, idx);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvoid\nvirMediatedDeviceListDel(virMediatedDeviceListPtr list,\n                         virMediatedDevicePtr dev)\n{\n    virMediatedDeviceFree(virMediatedDeviceListSteal(list, dev));\n}"
  },
  {
    "function_name": "virMediatedDeviceListSteal",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "357-364",
    "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListSteal(virMediatedDeviceListPtr list,\n                           virMediatedDevicePtr dev)\n{\n    int idx = virMediatedDeviceListFindIndex(list, dev);\n\n    return virMediatedDeviceListStealIndex(list, idx);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMediatedDeviceListStealIndex",
          "args": [
            "list",
            "idx"
          ],
          "line": 363
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListStealIndex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "342-354",
          "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListStealIndex(virMediatedDeviceListPtr list,\n                                ssize_t idx)\n{\n    virMediatedDevicePtr ret;\n\n    if (idx < 0 || idx >= list->count)\n        return NULL;\n\n    ret = list->devs[idx];\n    VIR_DELETE_ELEMENT(list->devs, idx, list->count);\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListStealIndex(virMediatedDeviceListPtr list,\n                                ssize_t idx)\n{\n    virMediatedDevicePtr ret;\n\n    if (idx < 0 || idx >= list->count)\n        return NULL;\n\n    ret = list->devs[idx];\n    VIR_DELETE_ELEMENT(list->devs, idx, list->count);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceListFindIndex",
          "args": [
            "list",
            "dev"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListFindIndex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "375-387",
          "snippet": "int\nvirMediatedDeviceListFindIndex(virMediatedDeviceListPtr list,\n                               virMediatedDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        virMediatedDevicePtr other = list->devs[i];\n        if (STREQ(other->path, dev->path))\n            return i;\n    }\n    return -1;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceListFindIndex(virMediatedDeviceListPtr list,\n                               virMediatedDevicePtr dev)\n{\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        virMediatedDevicePtr other = list->devs[i];\n        if (STREQ(other->path, dev->path))\n            return i;\n    }\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListSteal(virMediatedDeviceListPtr list,\n                           virMediatedDevicePtr dev)\n{\n    int idx = virMediatedDeviceListFindIndex(list, dev);\n\n    return virMediatedDeviceListStealIndex(list, idx);\n}"
  },
  {
    "function_name": "virMediatedDeviceListStealIndex",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "342-354",
    "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListStealIndex(virMediatedDeviceListPtr list,\n                                ssize_t idx)\n{\n    virMediatedDevicePtr ret;\n\n    if (idx < 0 || idx >= list->count)\n        return NULL;\n\n    ret = list->devs[idx];\n    VIR_DELETE_ELEMENT(list->devs, idx, list->count);\n    return ret;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "list->devs",
            "idx",
            "list->count"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListStealIndex(virMediatedDeviceListPtr list,\n                                ssize_t idx)\n{\n    virMediatedDevicePtr ret;\n\n    if (idx < 0 || idx >= list->count)\n        return NULL;\n\n    ret = list->devs[idx];\n    VIR_DELETE_ELEMENT(list->devs, idx, list->count);\n    return ret;\n}"
  },
  {
    "function_name": "virMediatedDeviceListCount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "335-339",
    "snippet": "size_t\nvirMediatedDeviceListCount(virMediatedDeviceListPtr list)\n{\n    return list->count;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nsize_t\nvirMediatedDeviceListCount(virMediatedDeviceListPtr list)\n{\n    return list->count;\n}"
  },
  {
    "function_name": "virMediatedDeviceListGet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "324-332",
    "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListGet(virMediatedDeviceListPtr list,\n                         ssize_t idx)\n{\n    if (idx < 0 || idx >= list->count)\n        return NULL;\n\n    return list->devs[idx];\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListGet(virMediatedDeviceListPtr list,\n                         ssize_t idx)\n{\n    if (idx < 0 || idx >= list->count)\n        return NULL;\n\n    return list->devs[idx];\n}"
  },
  {
    "function_name": "virMediatedDeviceListAdd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "311-321",
    "snippet": "int\nvirMediatedDeviceListAdd(virMediatedDeviceListPtr list,\n                         virMediatedDevicePtr *dev)\n{\n    if (virMediatedDeviceListFind(list, *dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"device %s is already in use\"), (*dev)->path);\n        return -1;\n    }\n    return VIR_APPEND_ELEMENT(list->devs, list->count, *dev);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT",
          "args": [
            "list->devs",
            "list->count",
            "*dev"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"device %s is already in use\")",
            "(*dev)->path"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"device %s is already in use\""
          ],
          "line": 317
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceListFind",
          "args": [
            "list",
            "*dev"
          ],
          "line": 315
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceListFind",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "390-400",
          "snippet": "virMediatedDevicePtr\nvirMediatedDeviceListFind(virMediatedDeviceListPtr list,\n                          virMediatedDevicePtr dev)\n{\n    int idx;\n\n    if ((idx = virMediatedDeviceListFindIndex(list, dev)) >= 0)\n        return list->devs[idx];\n    else\n        return NULL;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceListFind(virMediatedDeviceListPtr list,\n                          virMediatedDevicePtr dev)\n{\n    int idx;\n\n    if ((idx = virMediatedDeviceListFindIndex(list, dev)) >= 0)\n        return list->devs[idx];\n    else\n        return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceListAdd(virMediatedDeviceListPtr list,\n                         virMediatedDevicePtr *dev)\n{\n    if (virMediatedDeviceListFind(list, *dev)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"device %s is already in use\"), (*dev)->path);\n        return -1;\n    }\n    return VIR_APPEND_ELEMENT(list->devs, list->count, *dev);\n}"
  },
  {
    "function_name": "virMediatedDeviceListDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "292-305",
    "snippet": "static void\nvirMediatedDeviceListDispose(void *obj)\n{\n    virMediatedDeviceListPtr list = obj;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        virMediatedDeviceFree(list->devs[i]);\n        list->devs[i] = NULL;\n    }\n\n    list->count = 0;\n    VIR_FREE(list->devs);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void\nvirMediatedDeviceListDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "list->devs"
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceFree",
          "args": [
            "list->devs[i]"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "182-191",
          "snippet": "void\nvirMediatedDeviceFree(virMediatedDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvoid\nvirMediatedDeviceFree(virMediatedDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nstatic void\nvirMediatedDeviceListDispose(void *obj);\n\nstatic void\nvirMediatedDeviceListDispose(void *obj)\n{\n    virMediatedDeviceListPtr list = obj;\n    size_t i;\n\n    for (i = 0; i < list->count; i++) {\n        virMediatedDeviceFree(list->devs[i]);\n        list->devs[i] = NULL;\n    }\n\n    list->count = 0;\n    VIR_FREE(list->devs);\n}"
  },
  {
    "function_name": "virMediatedDeviceListNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "277-289",
    "snippet": "virMediatedDeviceListPtr\nvirMediatedDeviceListNew(void)\n{\n    virMediatedDeviceListPtr list;\n\n    if (virMediatedInitialize() < 0)\n        return NULL;\n\n    if (!(list = virObjectLockableNew(virMediatedDeviceListClass)))\n        return NULL;\n\n    return list;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr virMediatedDeviceListClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectLockableNew",
          "args": [
            "virMediatedDeviceListClass"
          ],
          "line": 285
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLockableNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "256-279",
          "snippet": "void *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nvoid *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedInitialize",
          "args": [],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nstatic virClassPtr virMediatedDeviceListClass;\n\nvirMediatedDeviceListPtr\nvirMediatedDeviceListNew(void)\n{\n    virMediatedDeviceListPtr list;\n\n    if (virMediatedInitialize() < 0)\n        return NULL;\n\n    if (!(list = virObjectLockableNew(virMediatedDeviceListClass)))\n        return NULL;\n\n    return list;\n}"
  },
  {
    "function_name": "virMediatedDeviceSetUsedBy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "263-274",
    "snippet": "int\nvirMediatedDeviceSetUsedBy(virMediatedDevicePtr dev,\n                           const char *drvname,\n                           const char *domname)\n{\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    dev->used_by_drvname = g_strdup(drvname);\n    dev->used_by_domname = g_strdup(domname);\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "domname"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by_domname"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by_drvname"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceSetUsedBy(virMediatedDevicePtr dev,\n                           const char *drvname,\n                           const char *domname)\n{\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    dev->used_by_drvname = g_strdup(drvname);\n    dev->used_by_domname = g_strdup(domname);\n\n    return 0;\n}"
  },
  {
    "function_name": "virMediatedDeviceGetUsedBy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "254-260",
    "snippet": "void\nvirMediatedDeviceGetUsedBy(virMediatedDevicePtr dev,\n                           const char **drvname, const char **domname)\n{\n    *drvname = dev->used_by_drvname;\n    *domname = dev->used_by_domname;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvoid\nvirMediatedDeviceGetUsedBy(virMediatedDevicePtr dev,\n                           const char **drvname, const char **domname)\n{\n    *drvname = dev->used_by_drvname;\n    *domname = dev->used_by_domname;\n}"
  },
  {
    "function_name": "virMediatedDeviceGetIOMMUGroupNum",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "237-251",
    "snippet": "int\nvirMediatedDeviceGetIOMMUGroupNum(const char *uuidstr)\n{\n    g_autofree char *vfio_path = NULL;\n    g_autofree char *group_num_str = NULL;\n    unsigned int group_num = -1;\n\n    if (!(vfio_path = virMediatedDeviceGetIOMMUGroupDev(uuidstr)))\n        return -1;\n\n    group_num_str = g_path_get_basename(vfio_path);\n    ignore_value(virStrToLong_ui(group_num_str, NULL, 10, &group_num));\n\n    return group_num;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virStrToLong_ui(group_num_str, NULL, 10, &group_num)"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrToLong_ui",
          "args": [
            "group_num_str",
            "NULL",
            "10",
            "&group_num"
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_uip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "444-461",
          "snippet": "int\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_path_get_basename",
          "args": [
            "vfio_path"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceGetIOMMUGroupDev",
          "args": [
            "uuidstr"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceGetIOMMUGroupDev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "205-234",
          "snippet": "char *\nvirMediatedDeviceGetIOMMUGroupDev(const char *uuidstr)\n{\n    g_autofree char *result_path = NULL;\n    g_autofree char *result_file = NULL;\n    g_autofree char *iommu_path = NULL;\n    g_autofree char *dev_path = virMediatedDeviceGetSysfsPath(uuidstr);\n    char *vfio_path = NULL;\n\n    if (!dev_path)\n        return NULL;\n\n    iommu_path = g_strdup_printf(\"%s/iommu_group\", dev_path);\n\n    if (!virFileExists(iommu_path)) {\n        virReportSystemError(errno, _(\"failed to access '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    if (virFileResolveLink(iommu_path, &result_path) < 0) {\n        virReportSystemError(errno, _(\"failed to resolve '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    result_file = g_path_get_basename(result_path);\n\n    vfio_path = g_strdup_printf(\"/dev/vfio/%s\", result_file);\n\n    return vfio_path;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nchar *\nvirMediatedDeviceGetIOMMUGroupDev(const char *uuidstr)\n{\n    g_autofree char *result_path = NULL;\n    g_autofree char *result_file = NULL;\n    g_autofree char *iommu_path = NULL;\n    g_autofree char *dev_path = virMediatedDeviceGetSysfsPath(uuidstr);\n    char *vfio_path = NULL;\n\n    if (!dev_path)\n        return NULL;\n\n    iommu_path = g_strdup_printf(\"%s/iommu_group\", dev_path);\n\n    if (!virFileExists(iommu_path)) {\n        virReportSystemError(errno, _(\"failed to access '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    if (virFileResolveLink(iommu_path, &result_path) < 0) {\n        virReportSystemError(errno, _(\"failed to resolve '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    result_file = g_path_get_basename(result_path);\n\n    vfio_path = g_strdup_printf(\"/dev/vfio/%s\", result_file);\n\n    return vfio_path;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nint\nvirMediatedDeviceGetIOMMUGroupNum(const char *uuidstr)\n{\n    g_autofree char *vfio_path = NULL;\n    g_autofree char *group_num_str = NULL;\n    unsigned int group_num = -1;\n\n    if (!(vfio_path = virMediatedDeviceGetIOMMUGroupDev(uuidstr)))\n        return -1;\n\n    group_num_str = g_path_get_basename(vfio_path);\n    ignore_value(virStrToLong_ui(group_num_str, NULL, 10, &group_num));\n\n    return group_num;\n}"
  },
  {
    "function_name": "virMediatedDeviceGetIOMMUGroupDev",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "205-234",
    "snippet": "char *\nvirMediatedDeviceGetIOMMUGroupDev(const char *uuidstr)\n{\n    g_autofree char *result_path = NULL;\n    g_autofree char *result_file = NULL;\n    g_autofree char *iommu_path = NULL;\n    g_autofree char *dev_path = virMediatedDeviceGetSysfsPath(uuidstr);\n    char *vfio_path = NULL;\n\n    if (!dev_path)\n        return NULL;\n\n    iommu_path = g_strdup_printf(\"%s/iommu_group\", dev_path);\n\n    if (!virFileExists(iommu_path)) {\n        virReportSystemError(errno, _(\"failed to access '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    if (virFileResolveLink(iommu_path, &result_path) < 0) {\n        virReportSystemError(errno, _(\"failed to resolve '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    result_file = g_path_get_basename(result_path);\n\n    vfio_path = g_strdup_printf(\"/dev/vfio/%s\", result_file);\n\n    return vfio_path;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/dev/vfio/%s\"",
            "result_file"
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_path_get_basename",
          "args": [
            "result_path"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to resolve '%s'\")",
            "iommu_path"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileResolveLink",
          "args": [
            "iommu_path",
            "&result_path"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "virFileResolveLink",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1608-1612",
          "snippet": "int\nvirFileResolveLink(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, false, resultpath);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileResolveLink(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, false, resultpath);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to access '%s'\")",
            "iommu_path"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "iommu_path"
          ],
          "line": 219
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceGetSysfsPath",
          "args": [
            "uuidstr"
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceGetSysfsPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "422-429",
          "snippet": "char *\nvirMediatedDeviceGetSysfsPath(const char *uuidstr)\n{\n    char *ret = NULL;\n\n    ret = g_strdup_printf(MDEV_SYSFS_DEVICES \"%s\", uuidstr);\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MDEV_SYSFS_DEVICES \"/sys/bus/mdev/devices/\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\n#define MDEV_SYSFS_DEVICES \"/sys/bus/mdev/devices/\"\n\nchar *\nvirMediatedDeviceGetSysfsPath(const char *uuidstr)\n{\n    char *ret = NULL;\n\n    ret = g_strdup_printf(MDEV_SYSFS_DEVICES \"%s\", uuidstr);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nchar *\nvirMediatedDeviceGetIOMMUGroupDev(const char *uuidstr)\n{\n    g_autofree char *result_path = NULL;\n    g_autofree char *result_file = NULL;\n    g_autofree char *iommu_path = NULL;\n    g_autofree char *dev_path = virMediatedDeviceGetSysfsPath(uuidstr);\n    char *vfio_path = NULL;\n\n    if (!dev_path)\n        return NULL;\n\n    iommu_path = g_strdup_printf(\"%s/iommu_group\", dev_path);\n\n    if (!virFileExists(iommu_path)) {\n        virReportSystemError(errno, _(\"failed to access '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    if (virFileResolveLink(iommu_path, &result_path) < 0) {\n        virReportSystemError(errno, _(\"failed to resolve '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    result_file = g_path_get_basename(result_path);\n\n    vfio_path = g_strdup_printf(\"/dev/vfio/%s\", result_file);\n\n    return vfio_path;\n}"
  },
  {
    "function_name": "virMediatedDeviceGetPath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "194-198",
    "snippet": "const char *\nvirMediatedDeviceGetPath(virMediatedDevicePtr dev)\n{\n    return dev->path;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nconst char *\nvirMediatedDeviceGetPath(virMediatedDevicePtr dev)\n{\n    return dev->path;\n}"
  },
  {
    "function_name": "virMediatedDeviceFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "182-191",
    "snippet": "void\nvirMediatedDeviceFree(virMediatedDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by_domname"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->used_by_drvname"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dev->path"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvoid\nvirMediatedDeviceFree(virMediatedDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
  },
  {
    "function_name": "virMediatedDeviceNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "170-178",
    "snippet": "virMediatedDevicePtr\nvirMediatedDeviceNew(const char *uuidstr G_GNUC_UNUSED,\n                     virMediatedDeviceModelType model G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"mediated devices are not supported on non-linux \"\n                     \"platforms\"));\n    return NULL;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"mediated devices are not supported on non-linux \"\n                     \"platforms\")"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"mediated devices are not supported on non-linux \"\n                     \"platforms\""
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceNew(const char *uuidstr G_GNUC_UNUSED,\n                     virMediatedDeviceModelType model G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"mediated devices are not supported on non-linux \"\n                     \"platforms\"));\n    return NULL;\n}"
  },
  {
    "function_name": "virMediatedDeviceNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "138-166",
    "snippet": "virMediatedDevicePtr\nvirMediatedDeviceNew(const char *uuidstr, virMediatedDeviceModelType model)\n{\n    g_autoptr(virMediatedDevice) dev = NULL;\n    g_autofree char *sysfspath = NULL;\n\n    if (!(sysfspath = virMediatedDeviceGetSysfsPath(uuidstr)))\n        return NULL;\n\n    if (!virFileExists(sysfspath)) {\n        virReportError(VIR_ERR_DEVICE_MISSING,\n                       _(\"mediated device '%s' not found\"), uuidstr);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->path = g_steal_pointer(&sysfspath);\n\n    /* Check whether the user-provided model corresponds with the actually\n     * supported mediated device's API.\n     */\n    if (virMediatedDeviceCheckModel(dev, model))\n        return NULL;\n\n    dev->model = model;\n    return g_steal_pointer(&dev);\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&dev"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceCheckModel",
          "args": [
            "dev",
            "model"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceCheckModel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "105-135",
          "snippet": "static int\nvirMediatedDeviceCheckModel(virMediatedDevicePtr dev,\n                            virMediatedDeviceModelType model)\n{\n    g_autofree char *dev_api = NULL;\n    int actual_model;\n\n    if (virMediatedDeviceGetSysfsDeviceAPI(dev, &dev_api) < 0)\n        return -1;\n\n    /* safeguard in case we've got an older libvirt which doesn't know newer\n     * device_api models yet\n     */\n    if ((actual_model = virMediatedDeviceModelTypeFromString(dev_api)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"device API '%s' not supported yet\"),\n                       dev_api);\n        return -1;\n    }\n\n    if (actual_model != model) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid device API '%s' for device %s: \"\n                         \"device only supports '%s'\"),\n                       virMediatedDeviceModelTypeToString(model),\n                       dev->path, dev_api);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nstatic int\nvirMediatedDeviceCheckModel(virMediatedDevicePtr dev,\n                            virMediatedDeviceModelType model)\n{\n    g_autofree char *dev_api = NULL;\n    int actual_model;\n\n    if (virMediatedDeviceGetSysfsDeviceAPI(dev, &dev_api) < 0)\n        return -1;\n\n    /* safeguard in case we've got an older libvirt which doesn't know newer\n     * device_api models yet\n     */\n    if ((actual_model = virMediatedDeviceModelTypeFromString(dev_api)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"device API '%s' not supported yet\"),\n                       dev_api);\n        return -1;\n    }\n\n    if (actual_model != model) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid device API '%s' for device %s: \"\n                         \"device only supports '%s'\"),\n                       virMediatedDeviceModelTypeToString(model),\n                       dev->path, dev_api);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&sysfspath"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "dev"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_DEVICE_MISSING",
            "_(\"mediated device '%s' not found\")",
            "uuidstr"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"mediated device '%s' not found\""
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "sysfspath"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceGetSysfsPath",
          "args": [
            "uuidstr"
          ],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceGetSysfsPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "422-429",
          "snippet": "char *\nvirMediatedDeviceGetSysfsPath(const char *uuidstr)\n{\n    char *ret = NULL;\n\n    ret = g_strdup_printf(MDEV_SYSFS_DEVICES \"%s\", uuidstr);\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MDEV_SYSFS_DEVICES \"/sys/bus/mdev/devices/\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\n#define MDEV_SYSFS_DEVICES \"/sys/bus/mdev/devices/\"\n\nchar *\nvirMediatedDeviceGetSysfsPath(const char *uuidstr)\n{\n    char *ret = NULL;\n\n    ret = g_strdup_printf(MDEV_SYSFS_DEVICES \"%s\", uuidstr);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nvirMediatedDevicePtr\nvirMediatedDeviceNew(const char *uuidstr, virMediatedDeviceModelType model)\n{\n    g_autoptr(virMediatedDevice) dev = NULL;\n    g_autofree char *sysfspath = NULL;\n\n    if (!(sysfspath = virMediatedDeviceGetSysfsPath(uuidstr)))\n        return NULL;\n\n    if (!virFileExists(sysfspath)) {\n        virReportError(VIR_ERR_DEVICE_MISSING,\n                       _(\"mediated device '%s' not found\"), uuidstr);\n        return NULL;\n    }\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->path = g_steal_pointer(&sysfspath);\n\n    /* Check whether the user-provided model corresponds with the actually\n     * supported mediated device's API.\n     */\n    if (virMediatedDeviceCheckModel(dev, model))\n        return NULL;\n\n    dev->model = model;\n    return g_steal_pointer(&dev);\n}"
  },
  {
    "function_name": "virMediatedDeviceCheckModel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "105-135",
    "snippet": "static int\nvirMediatedDeviceCheckModel(virMediatedDevicePtr dev,\n                            virMediatedDeviceModelType model)\n{\n    g_autofree char *dev_api = NULL;\n    int actual_model;\n\n    if (virMediatedDeviceGetSysfsDeviceAPI(dev, &dev_api) < 0)\n        return -1;\n\n    /* safeguard in case we've got an older libvirt which doesn't know newer\n     * device_api models yet\n     */\n    if ((actual_model = virMediatedDeviceModelTypeFromString(dev_api)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"device API '%s' not supported yet\"),\n                       dev_api);\n        return -1;\n    }\n\n    if (actual_model != model) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid device API '%s' for device %s: \"\n                         \"device only supports '%s'\"),\n                       virMediatedDeviceModelTypeToString(model),\n                       dev->path, dev_api);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"invalid device API '%s' for device %s: \"\n                         \"device only supports '%s'\")",
            "virMediatedDeviceModelTypeToString(model)",
            "dev->path",
            "dev_api"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceModelTypeToString",
          "args": [
            "model"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"invalid device API '%s' for device %s: \"\n                         \"device only supports '%s'\""
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"device API '%s' not supported yet\")",
            "dev_api"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceModelTypeFromString",
          "args": [
            "dev_api"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceGetSysfsDeviceAPI",
          "args": [
            "dev",
            "&dev_api"
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceGetSysfsDeviceAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "74-102",
          "snippet": "static int\nvirMediatedDeviceGetSysfsDeviceAPI(virMediatedDevicePtr dev,\n                                   char **device_api)\n{\n    g_autofree char *buf = NULL;\n    g_autofree char *file = NULL;\n    char *tmp = NULL;\n\n    file = g_strdup_printf(\"%s/mdev_type/device_api\", dev->path);\n\n    /* TODO - make this a generic method to access sysfs files for various\n     * kinds of devices\n     */\n    if (!virFileExists(file)) {\n        virReportSystemError(errno, _(\"failed to read '%s'\"), file);\n        return -1;\n    }\n\n    if (virFileReadAll(file, 1024, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    *device_api = buf;\n    buf = NULL;\n\n    return 0;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nstatic int\nvirMediatedDeviceGetSysfsDeviceAPI(virMediatedDevicePtr dev,\n                                   char **device_api)\n{\n    g_autofree char *buf = NULL;\n    g_autofree char *file = NULL;\n    char *tmp = NULL;\n\n    file = g_strdup_printf(\"%s/mdev_type/device_api\", dev->path);\n\n    /* TODO - make this a generic method to access sysfs files for various\n     * kinds of devices\n     */\n    if (!virFileExists(file)) {\n        virReportSystemError(errno, _(\"failed to read '%s'\"), file);\n        return -1;\n    }\n\n    if (virFileReadAll(file, 1024, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    *device_api = buf;\n    buf = NULL;\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nstatic int\nvirMediatedDeviceCheckModel(virMediatedDevicePtr dev,\n                            virMediatedDeviceModelType model)\n{\n    g_autofree char *dev_api = NULL;\n    int actual_model;\n\n    if (virMediatedDeviceGetSysfsDeviceAPI(dev, &dev_api) < 0)\n        return -1;\n\n    /* safeguard in case we've got an older libvirt which doesn't know newer\n     * device_api models yet\n     */\n    if ((actual_model = virMediatedDeviceModelTypeFromString(dev_api)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"device API '%s' not supported yet\"),\n                       dev_api);\n        return -1;\n    }\n\n    if (actual_model != model) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid device API '%s' for device %s: \"\n                         \"device only supports '%s'\"),\n                       virMediatedDeviceModelTypeToString(model),\n                       dev->path, dev_api);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virMediatedDeviceGetSysfsDeviceAPI",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "74-102",
    "snippet": "static int\nvirMediatedDeviceGetSysfsDeviceAPI(virMediatedDevicePtr dev,\n                                   char **device_api)\n{\n    g_autofree char *buf = NULL;\n    g_autofree char *file = NULL;\n    char *tmp = NULL;\n\n    file = g_strdup_printf(\"%s/mdev_type/device_api\", dev->path);\n\n    /* TODO - make this a generic method to access sysfs files for various\n     * kinds of devices\n     */\n    if (!virFileExists(file)) {\n        virReportSystemError(errno, _(\"failed to read '%s'\"), file);\n        return -1;\n    }\n\n    if (virFileReadAll(file, 1024, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    *device_api = buf;\n    buf = NULL;\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "buf",
            "'\\n'"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "file",
            "1024",
            "&buf"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"failed to read '%s'\")",
            "file"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to read '%s'\""
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "file"
          ],
          "line": 87
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nstatic int\nvirMediatedDeviceGetSysfsDeviceAPI(virMediatedDevicePtr dev,\n                                   char **device_api)\n{\n    g_autofree char *buf = NULL;\n    g_autofree char *file = NULL;\n    char *tmp = NULL;\n\n    file = g_strdup_printf(\"%s/mdev_type/device_api\", dev->path);\n\n    /* TODO - make this a generic method to access sysfs files for various\n     * kinds of devices\n     */\n    if (!virFileExists(file)) {\n        virReportSystemError(errno, _(\"failed to read '%s'\"), file);\n        return -1;\n    }\n\n    if (virFileReadAll(file, 1024, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    *device_api = buf;\n    buf = NULL;\n\n    return 0;\n}"
  },
  {
    "function_name": "virMediatedOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
    "lines": "61-68",
    "snippet": "static int\nvirMediatedOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virMediatedDeviceList, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virmdev.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "virMediatedDeviceList",
            "virClassForObjectLockable()"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virClassForObjectLockable",
          "args": [],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "virClassForObjectLockable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "116-123",
          "snippet": "virClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectLockableClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectLockableClass;\n\nvirClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nstatic int\nvirMediatedOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(virMediatedDeviceList, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}"
  }
]