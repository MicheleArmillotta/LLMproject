[
  {
    "function_name": "virStreamFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "1265-1278",
    "snippet": "int\nvirStreamFree(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    /* XXX Enforce shutdown before free'ing resources ? */\n\n    virObjectUnref(stream);\n    return 0;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "stream"
          ],
          "line": 1276
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 1272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 1270
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p\"",
            "stream"
          ],
          "line": 1268
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamFree(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    /* XXX Enforce shutdown before free'ing resources ? */\n\n    virObjectUnref(stream);\n    return 0;\n}"
  },
  {
    "function_name": "virStreamAbort",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "1221-1248",
    "snippet": "int\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 1246
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 1243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream"
          ],
          "line": 1237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"aborting unused stream\""
          ],
          "line": 1231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 1228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 1226
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p\"",
            "stream"
          ],
          "line": 1224
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamFinish",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "1179-1202",
    "snippet": "int\nvirStreamFinish(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamFinish) {\n        int ret;\n        ret = (stream->driver->streamFinish)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 1200
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 1197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream"
          ],
          "line": 1191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 1186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 1184
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p\"",
            "stream"
          ],
          "line": 1182
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamFinish(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamFinish) {\n        int ret;\n        ret = (stream->driver->streamFinish)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamEventRemoveCallback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "1135-1158",
    "snippet": "int\nvirStreamEventRemoveCallback(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamEventRemoveCallback) {\n        int ret;\n        ret = (stream->driver->streamEventRemoveCallback)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 1156
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 1153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream"
          ],
          "line": 1147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 1142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 1140
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p\"",
            "stream"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamEventRemoveCallback(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamEventRemoveCallback) {\n        int ret;\n        ret = (stream->driver->streamEventRemoveCallback)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamEventUpdateCallback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "1100-1124",
    "snippet": "int\nvirStreamEventUpdateCallback(virStreamPtr stream,\n                             int events)\n{\n    VIR_DEBUG(\"stream=%p, events=%d\", stream, events);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamEventUpdateCallback) {\n        int ret;\n        ret = (stream->driver->streamEventUpdateCallback)(stream, events);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 1122
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 1119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "events"
          ],
          "line": 1113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 1106
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, events=%d\"",
            "stream",
            "events"
          ],
          "line": 1104
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamEventUpdateCallback(virStreamPtr stream,\n                             int events)\n{\n    VIR_DEBUG(\"stream=%p, events=%d\", stream, events);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamEventUpdateCallback) {\n        int ret;\n        ret = (stream->driver->streamEventUpdateCallback)(stream, events);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamEventAddCallback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "1057-1085",
    "snippet": "int\nvirStreamEventAddCallback(virStreamPtr stream,\n                          int events,\n                          virStreamEventCallback cb,\n                          void *opaque,\n                          virFreeCallback ff)\n{\n    VIR_DEBUG(\"stream=%p, events=%d, cb=%p, opaque=%p, ff=%p\",\n              stream, events, cb, opaque, ff);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamEventAddCallback) {\n        int ret;\n        ret = (stream->driver->streamEventAddCallback)(stream, events, cb, opaque, ff);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 1083
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 1080
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "events",
            "cb",
            "opaque",
            "ff"
          ],
          "line": 1074
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 1069
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 1067
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, events=%d, cb=%p, opaque=%p, ff=%p\"",
            "stream",
            "events",
            "cb",
            "opaque",
            "ff"
          ],
          "line": 1064
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamEventAddCallback(virStreamPtr stream,\n                          int events,\n                          virStreamEventCallback cb,\n                          void *opaque,\n                          virFreeCallback ff)\n{\n    VIR_DEBUG(\"stream=%p, events=%d, cb=%p, opaque=%p, ff=%p\",\n              stream, events, cb, opaque, ff);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamEventAddCallback) {\n        int ret;\n        ret = (stream->driver->streamEventAddCallback)(stream, events, cb, opaque, ff);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamSparseRecvAll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "961-1040",
    "snippet": "int\nvirStreamSparseRecvAll(virStreamPtr stream,\n                       virStreamSinkFunc handler,\n                       virStreamSinkHoleFunc holeHandler,\n                       void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    const unsigned int flags = VIR_STREAM_RECV_STOP_AT_HOLE;\n    int ret = -1;\n\n    VIR_DEBUG(\"stream=%p handler=%p holeHandler=%p opaque=%p\",\n              stream, handler, holeHandler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n    virCheckNonNullArgGoto(holeHandler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sinks cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n        long long holeLen;\n        const unsigned int holeFlags = 0;\n\n        got = virStreamRecvFlags(stream, bytes, want, flags);\n        if (got == -3) {\n            if (virStreamRecvHole(stream, &holeLen, holeFlags) < 0)\n                goto cleanup;\n\n            if (holeHandler(stream, holeLen, opaque) < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\", _(\"recv holeHandler failed\"));\n                goto cleanup;\n            }\n            continue;\n        } else if (got < 0) {\n            goto cleanup;\n        } else if (got == 0) {\n            break;\n        }\n        while (offset < got) {\n            int done;\n            done = (handler)(stream, bytes + offset, got - offset, opaque);\n            if (done < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\", _(\"recv handler failed\"));\n                goto cleanup;\n            }\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 1036
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorRestore",
          "args": [
            "&orig_err"
          ],
          "line": 1035
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorRestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "445-457",
          "snippet": "void\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStreamAbort",
          "args": [
            "stream"
          ],
          "line": 1034
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "1221-1248",
          "snippet": "int\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
          "includes": [
            "#include \"rpc/virnetprotocol.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorPreserveLast",
          "args": [
            "&orig_err"
          ],
          "line": 1033
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorPreserveLast",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "424-436",
          "snippet": "void\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "bytes"
          ],
          "line": 1028
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"recv handler failed\")"
          ],
          "line": 1019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"recv handler failed\""
          ],
          "line": 1019
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "bytes + offset",
            "got - offset",
            "opaque"
          ],
          "line": 1015
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"recv holeHandler failed\")"
          ],
          "line": 1004
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "holeHandler",
          "args": [
            "stream",
            "holeLen",
            "opaque"
          ],
          "line": 1001
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStreamRecvHole",
          "args": [
            "stream",
            "&holeLen",
            "holeFlags"
          ],
          "line": 998
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamRecvHole",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "456-483",
          "snippet": "int\nvirStreamRecvHole(virStreamPtr stream,\n                  long long *length,\n                  unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, length=%p flags=0x%x\",\n              stream, length, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgReturn(length, -1);\n\n    if (stream->driver &&\n        stream->driver->streamRecvHole) {\n        int ret;\n        ret = (stream->driver->streamRecvHole)(stream, length, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
          "includes": [
            "#include \"rpc/virnetprotocol.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamRecvHole(virStreamPtr stream,\n                  long long *length,\n                  unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, length=%p flags=0x%x\",\n              stream, length, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgReturn(length, -1);\n\n    if (stream->driver &&\n        stream->driver->streamRecvHole) {\n        int ret;\n        ret = (stream->driver->streamRecvHole)(stream, length, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStreamRecvFlags",
          "args": [
            "stream",
            "bytes",
            "want",
            "flags"
          ],
          "line": 996
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamRecvFlags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "346-378",
          "snippet": "int\nvirStreamRecvFlags(virStreamPtr stream,\n                   char *data,\n                   size_t nbytes,\n                   unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, nbytes=%zu flags=0x%x\",\n              stream, data, nbytes, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(data, error);\n\n    if (stream->driver &&\n        stream->driver->streamRecvFlags) {\n        int ret;\n        ret = (stream->driver->streamRecvFlags)(stream, data, nbytes, flags);\n        if (ret == -2)\n            return -2;\n        if (ret == -3)\n            return -3;\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
          "includes": [
            "#include \"rpc/virnetprotocol.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamRecvFlags(virStreamPtr stream,\n                   char *data,\n                   size_t nbytes,\n                   unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, nbytes=%zu flags=0x%x\",\n              stream, data, nbytes, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(data, error);\n\n    if (stream->driver &&\n        stream->driver->streamRecvFlags) {\n        int ret;\n        ret = (stream->driver->streamRecvFlags)(stream, data, nbytes, flags);\n        if (ret == -2)\n            return -2;\n        if (ret == -3)\n            return -3;\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "bytes",
            "want"
          ],
          "line": 987
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "\"%s\"",
            "_(\"data sinks cannot be used for non-blocking streams\")"
          ],
          "line": 982
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "holeHandler",
            "cleanup"
          ],
          "line": 979
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "handler",
            "cleanup"
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 977
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 975
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p handler=%p holeHandler=%p opaque=%p\"",
            "stream",
            "handler",
            "holeHandler",
            "opaque"
          ],
          "line": 972
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamSparseRecvAll(virStreamPtr stream,\n                       virStreamSinkFunc handler,\n                       virStreamSinkHoleFunc holeHandler,\n                       void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    const unsigned int flags = VIR_STREAM_RECV_STOP_AT_HOLE;\n    int ret = -1;\n\n    VIR_DEBUG(\"stream=%p handler=%p holeHandler=%p opaque=%p\",\n              stream, handler, holeHandler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n    virCheckNonNullArgGoto(holeHandler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sinks cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n        long long holeLen;\n        const unsigned int holeFlags = 0;\n\n        got = virStreamRecvFlags(stream, bytes, want, flags);\n        if (got == -3) {\n            if (virStreamRecvHole(stream, &holeLen, holeFlags) < 0)\n                goto cleanup;\n\n            if (holeHandler(stream, holeLen, opaque) < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\", _(\"recv holeHandler failed\"));\n                goto cleanup;\n            }\n            continue;\n        } else if (got < 0) {\n            goto cleanup;\n        } else if (got == 0) {\n            break;\n        }\n        while (offset < got) {\n            int done;\n            done = (handler)(stream, bytes + offset, got - offset, opaque);\n            if (done < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\", _(\"recv handler failed\"));\n                goto cleanup;\n            }\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virStreamRecvAll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "845-907",
    "snippet": "int\nvirStreamRecvAll(virStreamPtr stream,\n                 virStreamSinkFunc handler,\n                 void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    VIR_DEBUG(\"stream=%p, handler=%p, opaque=%p\", stream, handler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sinks cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n\n        got = virStreamRecv(stream, bytes, want);\n        if (got < 0)\n            goto cleanup;\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = (handler)(stream, bytes + offset, got - offset, opaque);\n            if (done < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\",\n                                     _(\"recv handler failed\"));\n                goto cleanup;\n            }\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 903
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorRestore",
          "args": [
            "&orig_err"
          ],
          "line": 902
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorRestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "445-457",
          "snippet": "void\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStreamAbort",
          "args": [
            "stream"
          ],
          "line": 901
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "1221-1248",
          "snippet": "int\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
          "includes": [
            "#include \"rpc/virnetprotocol.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorPreserveLast",
          "args": [
            "&orig_err"
          ],
          "line": 900
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorPreserveLast",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "424-436",
          "snippet": "void\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "bytes"
          ],
          "line": 895
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"recv handler failed\")"
          ],
          "line": 885
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"recv handler failed\""
          ],
          "line": 886
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "bytes + offset",
            "got - offset",
            "opaque"
          ],
          "line": 881
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStreamRecv",
          "args": [
            "stream",
            "bytes",
            "want"
          ],
          "line": 874
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamRecvAll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "845-907",
          "snippet": "int\nvirStreamRecvAll(virStreamPtr stream,\n                 virStreamSinkFunc handler,\n                 void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    VIR_DEBUG(\"stream=%p, handler=%p, opaque=%p\", stream, handler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sinks cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n\n        got = virStreamRecv(stream, bytes, want);\n        if (got < 0)\n            goto cleanup;\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = (handler)(stream, bytes + offset, got - offset, opaque);\n            if (done < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\",\n                                     _(\"recv handler failed\"));\n                goto cleanup;\n            }\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "bytes",
            "want"
          ],
          "line": 867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "\"%s\"",
            "_(\"data sinks cannot be used for non-blocking streams\")"
          ],
          "line": 861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "handler",
            "cleanup"
          ],
          "line": 858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 857
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 855
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, handler=%p, opaque=%p\"",
            "stream",
            "handler",
            "opaque"
          ],
          "line": 853
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamRecvAll(virStreamPtr stream,\n                 virStreamSinkFunc handler,\n                 void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    VIR_DEBUG(\"stream=%p, handler=%p, opaque=%p\", stream, handler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sinks cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n\n        got = virStreamRecv(stream, bytes, want);\n        if (got < 0)\n            goto cleanup;\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = (handler)(stream, bytes + offset, got - offset, opaque);\n            if (done < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\",\n                                     _(\"recv handler failed\"));\n                goto cleanup;\n            }\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virStreamSparseSendAll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "703-802",
    "snippet": "int virStreamSparseSendAll(virStreamPtr stream,\n                           virStreamSourceFunc handler,\n                           virStreamSourceHoleFunc holeHandler,\n                           virStreamSourceSkipFunc skipHandler,\n                           void *opaque)\n{\n    char *bytes = NULL;\n    size_t bufLen = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    unsigned long long dataLen = 0;\n\n    VIR_DEBUG(\"stream=%p handler=%p holeHandler=%p opaque=%p\",\n              stream, handler, holeHandler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n    virCheckNonNullArgGoto(holeHandler, cleanup);\n    virCheckNonNullArgGoto(skipHandler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sources cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, bufLen) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int inData, got, offset = 0;\n        long long sectionLen;\n        size_t want = bufLen;\n        const unsigned int skipFlags = 0;\n\n        if (!dataLen) {\n            if (holeHandler(stream, &inData, &sectionLen, opaque) < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\", _(\"send holeHandler failed\"));\n                goto cleanup;\n            }\n\n            if (!inData && sectionLen) {\n                if (virStreamSendHole(stream, sectionLen, skipFlags) < 0)\n                    goto cleanup;\n\n                if (skipHandler(stream, sectionLen, opaque) < 0) {\n                    if (errno == 0)\n                        errno = EIO;\n                    virReportSystemError(errno, \"%s\",\n                                         _(\"send skipHandler failed\"));\n                    goto cleanup;\n                }\n                continue;\n            } else {\n                dataLen = sectionLen;\n            }\n        }\n\n        if (want > dataLen)\n            want = dataLen;\n\n        got = (handler)(stream, bytes, want, opaque);\n        if (got < 0) {\n            if (errno == 0)\n                errno = EIO;\n            virReportSystemError(errno, \"%s\",\n                                 _(\"send handler failed\"));\n            goto cleanup;\n        }\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = virStreamSend(stream, bytes + offset, got - offset);\n            if (done < 0)\n                goto cleanup;\n            offset += done;\n            dataLen -= done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 798
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorRestore",
          "args": [
            "&orig_err"
          ],
          "line": 797
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorRestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "445-457",
          "snippet": "void\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStreamAbort",
          "args": [
            "stream"
          ],
          "line": 796
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "1221-1248",
          "snippet": "int\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
          "includes": [
            "#include \"rpc/virnetprotocol.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorPreserveLast",
          "args": [
            "&orig_err"
          ],
          "line": 795
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorPreserveLast",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "424-436",
          "snippet": "void\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "bytes"
          ],
          "line": 790
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStreamSend",
          "args": [
            "stream",
            "bytes + offset",
            "got - offset"
          ],
          "line": 780
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamSendAll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "571-631",
          "snippet": "int\nvirStreamSendAll(virStreamPtr stream,\n                 virStreamSourceFunc handler,\n                 void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    VIR_DEBUG(\"stream=%p, handler=%p, opaque=%p\", stream, handler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sources cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n\n        got = (handler)(stream, bytes, want, opaque);\n        if (got < 0) {\n            if (errno == 0)\n                errno = EIO;\n            virReportSystemError(errno, \"%s\", _(\"send handler failed\"));\n            goto cleanup;\n        }\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = virStreamSend(stream, bytes + offset, got - offset);\n            if (done < 0)\n                goto cleanup;\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"rpc/virnetprotocol.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamSendAll(virStreamPtr stream,\n                 virStreamSourceFunc handler,\n                 void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    VIR_DEBUG(\"stream=%p, handler=%p, opaque=%p\", stream, handler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sources cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n\n        got = (handler)(stream, bytes, want, opaque);\n        if (got < 0) {\n            if (errno == 0)\n                errno = EIO;\n            virReportSystemError(errno, \"%s\", _(\"send handler failed\"));\n            goto cleanup;\n        }\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = virStreamSend(stream, bytes + offset, got - offset);\n            if (done < 0)\n                goto cleanup;\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"send handler failed\")"
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"send handler failed\""
          ],
          "line": 773
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "bytes",
            "want",
            "opaque"
          ],
          "line": 768
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"send skipHandler failed\")"
          ],
          "line": 755
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "skipHandler",
          "args": [
            "stream",
            "sectionLen",
            "opaque"
          ],
          "line": 752
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStreamSendHole",
          "args": [
            "stream",
            "sectionLen",
            "skipFlags"
          ],
          "line": 749
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamSendHole",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "413-439",
          "snippet": "int\nvirStreamSendHole(virStreamPtr stream,\n                  long long length,\n                  unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, length=%lld flags=0x%x\",\n              stream, length, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamSendHole) {\n        int ret;\n        ret = (stream->driver->streamSendHole)(stream, length, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
          "includes": [
            "#include \"rpc/virnetprotocol.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamSendHole(virStreamPtr stream,\n                  long long length,\n                  unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, length=%lld flags=0x%x\",\n              stream, length, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamSendHole) {\n        int ret;\n        ret = (stream->driver->streamSendHole)(stream, length, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"send holeHandler failed\")"
          ],
          "line": 744
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "holeHandler",
          "args": [
            "stream",
            "&inData",
            "&sectionLen",
            "opaque"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "bytes",
            "bufLen"
          ],
          "line": 730
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "\"%s\"",
            "_(\"data sources cannot be used for non-blocking streams\")"
          ],
          "line": 725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "skipHandler",
            "cleanup"
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "holeHandler",
            "cleanup"
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "handler",
            "cleanup"
          ],
          "line": 720
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 717
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p handler=%p holeHandler=%p opaque=%p\"",
            "stream",
            "handler",
            "holeHandler",
            "opaque"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint virStreamSparseSendAll(virStreamPtr stream,\n                           virStreamSourceFunc handler,\n                           virStreamSourceHoleFunc holeHandler,\n                           virStreamSourceSkipFunc skipHandler,\n                           void *opaque)\n{\n    char *bytes = NULL;\n    size_t bufLen = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    unsigned long long dataLen = 0;\n\n    VIR_DEBUG(\"stream=%p handler=%p holeHandler=%p opaque=%p\",\n              stream, handler, holeHandler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n    virCheckNonNullArgGoto(holeHandler, cleanup);\n    virCheckNonNullArgGoto(skipHandler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sources cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, bufLen) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int inData, got, offset = 0;\n        long long sectionLen;\n        size_t want = bufLen;\n        const unsigned int skipFlags = 0;\n\n        if (!dataLen) {\n            if (holeHandler(stream, &inData, &sectionLen, opaque) < 0) {\n                if (errno == 0)\n                    errno = EIO;\n                virReportSystemError(errno, \"%s\", _(\"send holeHandler failed\"));\n                goto cleanup;\n            }\n\n            if (!inData && sectionLen) {\n                if (virStreamSendHole(stream, sectionLen, skipFlags) < 0)\n                    goto cleanup;\n\n                if (skipHandler(stream, sectionLen, opaque) < 0) {\n                    if (errno == 0)\n                        errno = EIO;\n                    virReportSystemError(errno, \"%s\",\n                                         _(\"send skipHandler failed\"));\n                    goto cleanup;\n                }\n                continue;\n            } else {\n                dataLen = sectionLen;\n            }\n        }\n\n        if (want > dataLen)\n            want = dataLen;\n\n        got = (handler)(stream, bytes, want, opaque);\n        if (got < 0) {\n            if (errno == 0)\n                errno = EIO;\n            virReportSystemError(errno, \"%s\",\n                                 _(\"send handler failed\"));\n            goto cleanup;\n        }\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = virStreamSend(stream, bytes + offset, got - offset);\n            if (done < 0)\n                goto cleanup;\n            offset += done;\n            dataLen -= done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virStreamSendAll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "571-631",
    "snippet": "int\nvirStreamSendAll(virStreamPtr stream,\n                 virStreamSourceFunc handler,\n                 void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    VIR_DEBUG(\"stream=%p, handler=%p, opaque=%p\", stream, handler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sources cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n\n        got = (handler)(stream, bytes, want, opaque);\n        if (got < 0) {\n            if (errno == 0)\n                errno = EIO;\n            virReportSystemError(errno, \"%s\", _(\"send handler failed\"));\n            goto cleanup;\n        }\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = virStreamSend(stream, bytes + offset, got - offset);\n            if (done < 0)\n                goto cleanup;\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 627
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorRestore",
          "args": [
            "&orig_err"
          ],
          "line": 626
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorRestore",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "445-457",
          "snippet": "void\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorRestore(virErrorPtr *savederr)\n{\n    int saved_errno = errno;\n\n    if (!*savederr)\n        return;\n\n    virSetError(*savederr);\n    virFreeError(*savederr);\n    *savederr = NULL;\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStreamAbort",
          "args": [
            "stream"
          ],
          "line": 625
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamAbort",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "1221-1248",
          "snippet": "int\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
          "includes": [
            "#include \"rpc/virnetprotocol.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamAbort(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p\", stream);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (!stream->driver) {\n        VIR_DEBUG(\"aborting unused stream\");\n        return 0;\n    }\n\n    if (stream->driver->streamAbort) {\n        int ret;\n        ret = (stream->driver->streamAbort)(stream);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virErrorPreserveLast",
          "args": [
            "&orig_err"
          ],
          "line": 624
        },
        "resolved": true,
        "details": {
          "function_name": "virErrorPreserveLast",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "424-436",
          "snippet": "void\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirErrorPreserveLast(virErrorPtr *saveerr)\n{\n    int saved_errno = errno;\n    virErrorPtr lasterr = virGetLastError();\n\n    *saveerr = NULL;\n\n    if (lasterr)\n        *saveerr = virErrorCopyNew(lasterr);\n\n    errno = saved_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "bytes"
          ],
          "line": 619
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStreamSend",
          "args": [
            "stream",
            "bytes + offset",
            "got - offset"
          ],
          "line": 610
        },
        "resolved": true,
        "details": {
          "function_name": "virStreamSendAll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
          "lines": "571-631",
          "snippet": "int\nvirStreamSendAll(virStreamPtr stream,\n                 virStreamSourceFunc handler,\n                 void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    VIR_DEBUG(\"stream=%p, handler=%p, opaque=%p\", stream, handler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sources cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n\n        got = (handler)(stream, bytes, want, opaque);\n        if (got < 0) {\n            if (errno == 0)\n                errno = EIO;\n            virReportSystemError(errno, \"%s\", _(\"send handler failed\"));\n            goto cleanup;\n        }\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = virStreamSend(stream, bytes + offset, got - offset);\n            if (done < 0)\n                goto cleanup;\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"send handler failed\")"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"send handler failed\""
          ],
          "line": 603
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "bytes",
            "want",
            "opaque"
          ],
          "line": 599
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "bytes",
            "want"
          ],
          "line": 592
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "\"%s\"",
            "_(\"data sources cannot be used for non-blocking streams\")"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "handler",
            "cleanup"
          ],
          "line": 584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 581
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, handler=%p, opaque=%p\"",
            "stream",
            "handler",
            "opaque"
          ],
          "line": 579
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamSendAll(virStreamPtr stream,\n                 virStreamSourceFunc handler,\n                 void *opaque)\n{\n    char *bytes = NULL;\n    size_t want = VIR_NET_MESSAGE_LEGACY_PAYLOAD_MAX;\n    int ret = -1;\n    VIR_DEBUG(\"stream=%p, handler=%p, opaque=%p\", stream, handler, opaque);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(handler, cleanup);\n\n    if (stream->flags & VIR_STREAM_NONBLOCK) {\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"data sources cannot be used for non-blocking streams\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC_N(bytes, want) < 0)\n        goto cleanup;\n\n    errno = 0;\n    for (;;) {\n        int got, offset = 0;\n\n        got = (handler)(stream, bytes, want, opaque);\n        if (got < 0) {\n            if (errno == 0)\n                errno = EIO;\n            virReportSystemError(errno, \"%s\", _(\"send handler failed\"));\n            goto cleanup;\n        }\n        if (got == 0)\n            break;\n        while (offset < got) {\n            int done;\n            done = virStreamSend(stream, bytes + offset, got - offset);\n            if (done < 0)\n                goto cleanup;\n            offset += done;\n        }\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(bytes);\n\n    if (ret != 0) {\n        virErrorPtr orig_err;\n\n        virErrorPreserveLast(&orig_err);\n        virStreamAbort(stream);\n        virErrorRestore(&orig_err);\n        virDispatchError(stream->conn);\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virStreamInData",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "512-528",
    "snippet": "int\nvirStreamInData(virStreamPtr stream,\n                int *data,\n                long long *length)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, length=%p\", stream, data, length);\n\n    virResetLastError();\n    virCheckNonNullArgReturn(data, -1);\n    virCheckNonNullArgReturn(length, -1);\n\n    if (stream->driver->streamInData)\n        return (stream->driver->streamInData)(stream, data, length);\n\n    virReportUnsupportedError();\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "data",
            "length"
          ],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgReturn",
          "args": [
            "length",
            "-1"
          ],
          "line": 521
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgReturn",
          "args": [
            "data",
            "-1"
          ],
          "line": 520
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, data=%p, length=%p\"",
            "stream",
            "data",
            "length"
          ],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamInData(virStreamPtr stream,\n                int *data,\n                long long *length)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, length=%p\", stream, data, length);\n\n    virResetLastError();\n    virCheckNonNullArgReturn(data, -1);\n    virCheckNonNullArgReturn(length, -1);\n\n    if (stream->driver->streamInData)\n        return (stream->driver->streamInData)(stream, data, length);\n\n    virReportUnsupportedError();\n    return -1;\n}"
  },
  {
    "function_name": "virStreamRecvHole",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "456-483",
    "snippet": "int\nvirStreamRecvHole(virStreamPtr stream,\n                  long long *length,\n                  unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, length=%p flags=0x%x\",\n              stream, length, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgReturn(length, -1);\n\n    if (stream->driver &&\n        stream->driver->streamRecvHole) {\n        int ret;\n        ret = (stream->driver->streamRecvHole)(stream, length, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 481
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "length",
            "flags"
          ],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgReturn",
          "args": [
            "length",
            "-1"
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, length=%p flags=0x%x\"",
            "stream",
            "length",
            "flags"
          ],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamRecvHole(virStreamPtr stream,\n                  long long *length,\n                  unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, length=%p flags=0x%x\",\n              stream, length, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgReturn(length, -1);\n\n    if (stream->driver &&\n        stream->driver->streamRecvHole) {\n        int ret;\n        ret = (stream->driver->streamRecvHole)(stream, length, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamSendHole",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "413-439",
    "snippet": "int\nvirStreamSendHole(virStreamPtr stream,\n                  long long length,\n                  unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, length=%lld flags=0x%x\",\n              stream, length, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamSendHole) {\n        int ret;\n        ret = (stream->driver->streamSendHole)(stream, length, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 437
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "length",
            "flags"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 421
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, length=%lld flags=0x%x\"",
            "stream",
            "length",
            "flags"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamSendHole(virStreamPtr stream,\n                  long long length,\n                  unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, length=%lld flags=0x%x\",\n              stream, length, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    if (stream->driver &&\n        stream->driver->streamSendHole) {\n        int ret;\n        ret = (stream->driver->streamSendHole)(stream, length, flags);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamRecvFlags",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "346-378",
    "snippet": "int\nvirStreamRecvFlags(virStreamPtr stream,\n                   char *data,\n                   size_t nbytes,\n                   unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, nbytes=%zu flags=0x%x\",\n              stream, data, nbytes, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(data, error);\n\n    if (stream->driver &&\n        stream->driver->streamRecvFlags) {\n        int ret;\n        ret = (stream->driver->streamRecvFlags)(stream, data, nbytes, flags);\n        if (ret == -2)\n            return -2;\n        if (ret == -3)\n            return -3;\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "data",
            "nbytes",
            "flags"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "data",
            "error"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 355
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, data=%p, nbytes=%zu flags=0x%x\"",
            "stream",
            "data",
            "nbytes",
            "flags"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamRecvFlags(virStreamPtr stream,\n                   char *data,\n                   size_t nbytes,\n                   unsigned int flags)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, nbytes=%zu flags=0x%x\",\n              stream, data, nbytes, flags);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(data, error);\n\n    if (stream->driver &&\n        stream->driver->streamRecvFlags) {\n        int ret;\n        ret = (stream->driver->streamRecvFlags)(stream, data, nbytes, flags);\n        if (ret == -2)\n            return -2;\n        if (ret == -3)\n            return -3;\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamRecv",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "259-287",
    "snippet": "int\nvirStreamRecv(virStreamPtr stream,\n              char *data,\n              size_t nbytes)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, nbytes=%zi\", stream, data, nbytes);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(data, error);\n\n    if (stream->driver &&\n        stream->driver->streamRecv) {\n        int ret;\n        ret = (stream->driver->streamRecv)(stream, data, nbytes);\n        if (ret == -2)\n            return -2;\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 285
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "data",
            "nbytes"
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "data",
            "error"
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, data=%p, nbytes=%zi\"",
            "stream",
            "data",
            "nbytes"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamRecv(virStreamPtr stream,\n              char *data,\n              size_t nbytes)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, nbytes=%zi\", stream, data, nbytes);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(data, error);\n\n    if (stream->driver &&\n        stream->driver->streamRecv) {\n        int ret;\n        ret = (stream->driver->streamRecv)(stream, data, nbytes);\n        if (ret == -2)\n            return -2;\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamSend",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "164-192",
    "snippet": "int\nvirStreamSend(virStreamPtr stream,\n              const char *data,\n              size_t nbytes)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, nbytes=%zi\", stream, data, nbytes);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(data, error);\n\n    if (stream->driver &&\n        stream->driver->streamSend) {\n        int ret;\n        ret = (stream->driver->streamSend)(stream, data, nbytes);\n        if (ret == -2)\n            return -2;\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "stream->conn"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportUnsupportedError",
          "args": [],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "stream",
            "data",
            "nbytes"
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckNonNullArgGoto",
          "args": [
            "data",
            "error"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p, data=%p, nbytes=%zi\"",
            "stream",
            "data",
            "nbytes"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamSend(virStreamPtr stream,\n              const char *data,\n              size_t nbytes)\n{\n    VIR_DEBUG(\"stream=%p, data=%p, nbytes=%zi\", stream, data, nbytes);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n    virCheckNonNullArgGoto(data, error);\n\n    if (stream->driver &&\n        stream->driver->streamSend) {\n        int ret;\n        ret = (stream->driver->streamSend)(stream, data, nbytes);\n        if (ret == -2)\n            return -2;\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(stream->conn);\n    return -1;\n}"
  },
  {
    "function_name": "virStreamRef",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "85-97",
    "snippet": "int\nvirStreamRef(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p refs=%d\", stream,\n              stream ? stream->parent.u.s.refs : 0);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    virObjectRef(stream);\n    return 0;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectRef",
          "args": [
            "stream"
          ],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectRef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "377-387",
          "snippet": "void *\nvirObjectRef(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return NULL;\n    g_atomic_int_add(&obj->u.s.refs, 1);\n    PROBE(OBJECT_REF, \"obj=%p\", obj);\n    return anyobj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid *\nvirObjectRef(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return NULL;\n    g_atomic_int_add(&obj->u.s.refs, 1);\n    PROBE(OBJECT_REF, \"obj=%p\", obj);\n    return anyobj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckStreamReturn",
          "args": [
            "stream",
            "-1"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"stream=%p refs=%d\"",
            "stream",
            "stream ? stream->parent.u.s.refs : 0"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirStreamRef(virStreamPtr stream)\n{\n    VIR_DEBUG(\"stream=%p refs=%d\", stream,\n              stream ? stream->parent.u.s.refs : 0);\n\n    virResetLastError();\n\n    virCheckStreamReturn(stream, -1);\n\n    virObjectRef(stream);\n    return 0;\n}"
  },
  {
    "function_name": "virStreamNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-stream.c",
    "lines": "52-71",
    "snippet": "virStreamPtr\nvirStreamNew(virConnectPtr conn,\n             unsigned int flags)\n{\n    virStreamPtr st;\n\n    VIR_DEBUG(\"conn=%p, flags=0x%x\", conn, flags);\n\n    virResetLastError();\n\n    virCheckConnectReturn(conn, NULL);\n\n    st = virGetStream(conn);\n    if (st)\n        st->flags = flags;\n    else\n        virDispatchError(conn);\n\n    return st;\n}",
    "includes": [
      "#include \"rpc/virnetprotocol.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDispatchError",
          "args": [
            "conn"
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "virDispatchError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "695-728",
          "snippet": "void\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorFunc virErrorHandler = NULL;",
            "void *virUserData = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorFunc virErrorHandler = NULL;\nvoid *virUserData = NULL;\n\nvoid\nvirDispatchError(virConnectPtr conn)\n{\n    virErrorPtr err = virLastErrorObject();\n    virErrorFunc handler = virErrorHandler;\n    void *userData = virUserData;\n\n    /* Can only happen on OOM.  */\n    if (!err)\n        return;\n\n    /* Set a generic error message if none is already set */\n    if (err->code == VIR_ERR_OK)\n        virErrorGenericFailure(err);\n\n    /* Copy the global error to per-connection error if needed */\n    if (conn) {\n        virObjectLock(conn);\n        virCopyError(err, &conn->err);\n\n        if (conn->handler != NULL) {\n            handler = conn->handler;\n            userData = conn->userData;\n        }\n        virObjectUnlock(conn);\n    }\n\n    /* Invoke the error callback functions */\n    if (handler != NULL) {\n        (handler)(userData, err);\n    } else {\n        virDefaultErrorFunc(err);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetStream",
          "args": [
            "conn"
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "virGetStream",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/datatypes.c",
          "lines": "790-804",
          "snippet": "virStreamPtr\nvirGetStream(virConnectPtr conn)\n{\n    virStreamPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    if (!(ret = virObjectNew(virStreamClass)))\n        return NULL;\n\n    ret->conn = virObjectRef(conn);\n\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virClassPtr virStreamClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirClassPtr virStreamClass;\n\nvirStreamPtr\nvirGetStream(virConnectPtr conn)\n{\n    virStreamPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    if (!(ret = virObjectNew(virStreamClass)))\n        return NULL;\n\n    ret->conn = virObjectRef(conn);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckConnectReturn",
          "args": [
            "conn",
            "NULL"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"conn=%p, flags=0x%x\"",
            "conn",
            "flags"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"rpc/virnetprotocol.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirStreamPtr\nvirStreamNew(virConnectPtr conn,\n             unsigned int flags)\n{\n    virStreamPtr st;\n\n    VIR_DEBUG(\"conn=%p, flags=0x%x\", conn, flags);\n\n    virResetLastError();\n\n    virCheckConnectReturn(conn, NULL);\n\n    st = virGetStream(conn);\n    if (st)\n        st->flags = flags;\n    else\n        virDispatchError(conn);\n\n    return st;\n}"
  }
]