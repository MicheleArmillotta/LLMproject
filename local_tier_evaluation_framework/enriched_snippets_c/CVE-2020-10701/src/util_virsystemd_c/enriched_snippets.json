[
  {
    "function_name": "virSystemdActivationFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "1034-1043",
    "snippet": "void\nvirSystemdActivationFree(virSystemdActivationPtr act)\n{\n    if (!act)\n        return;\n\n    virHashFree(act->fds);\n\n    VIR_FREE(act);\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "act"
          ],
          "line": 1042
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashFree",
          "args": [
            "act->fds"
          ],
          "line": 1040
        },
        "resolved": true,
        "details": {
          "function_name": "virHashFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "313-337",
          "snippet": "void\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nvoid\nvirSystemdActivationFree(virSystemdActivationPtr act)\n{\n    if (!act)\n        return;\n\n    virHashFree(act->fds);\n\n    VIR_FREE(act);\n}"
  },
  {
    "function_name": "virSystemdActivationClaimFDs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "1004-1024",
    "snippet": "void\nvirSystemdActivationClaimFDs(virSystemdActivationPtr act,\n                             const char *name,\n                             int **fds,\n                             size_t *nfds)\n{\n    virSystemdActivationEntryPtr ent = virHashSteal(act->fds, name);\n\n    if (!ent) {\n        *fds = NULL;\n        *nfds = 0;\n        VIR_DEBUG(\"No FD with name %s\", name);\n        return;\n    }\n\n    VIR_DEBUG(\"Found %zu FDs with name %s\", ent->nfds, name);\n    *fds = ent->fds;\n    *nfds = ent->nfds;\n\n    VIR_FREE(ent);\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ent"
          ],
          "line": 1023
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Found %zu FDs with name %s\"",
            "ent->nfds",
            "name"
          ],
          "line": 1019
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No FD with name %s\"",
            "name"
          ],
          "line": 1015
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashSteal",
          "args": [
            "act->fds",
            "name"
          ],
          "line": 1010
        },
        "resolved": true,
        "details": {
          "function_name": "virHashSteal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "512-522",
          "snippet": "void *virHashSteal(virHashTablePtr table, const void *name)\n{\n    void *data = virHashLookup(table, name);\n    if (data) {\n        virHashDataFree dataFree = table->dataFree;\n        table->dataFree = NULL;\n        virHashRemoveEntry(table, name);\n        table->dataFree = dataFree;\n    }\n    return data;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *virHashSteal(virHashTablePtr table, const void *name)\n{\n    void *data = virHashLookup(table, name);\n    if (data) {\n        virHashDataFree dataFree = table->dataFree;\n        table->dataFree = NULL;\n        virHashRemoveEntry(table, name);\n        table->dataFree = dataFree;\n    }\n    return data;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nvoid\nvirSystemdActivationClaimFDs(virSystemdActivationPtr act,\n                             const char *name,\n                             int **fds,\n                             size_t *nfds)\n{\n    virSystemdActivationEntryPtr ent = virHashSteal(act->fds, name);\n\n    if (!ent) {\n        *fds = NULL;\n        *nfds = 0;\n        VIR_DEBUG(\"No FD with name %s\", name);\n        return;\n    }\n\n    VIR_DEBUG(\"Found %zu FDs with name %s\", ent->nfds, name);\n    *fds = ent->fds;\n    *nfds = ent->nfds;\n\n    VIR_FREE(ent);\n}"
  },
  {
    "function_name": "virSystemdActivationComplete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "976-986",
    "snippet": "int\nvirSystemdActivationComplete(virSystemdActivationPtr act)\n{\n    if (virHashSize(act->fds) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Some activation file descriptors are unclaimed\"));\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Some activation file descriptors are unclaimed\")"
          ],
          "line": 980
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Some activation file descriptors are unclaimed\""
          ],
          "line": 981
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashSize",
          "args": [
            "act->fds"
          ],
          "line": 979
        },
        "resolved": true,
        "details": {
          "function_name": "virHashSize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "547-553",
          "snippet": "ssize_t\nvirHashSize(const virHashTable *table)\n{\n    if (table == NULL)\n        return -1;\n    return table->nbElems;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nssize_t\nvirHashSize(const virHashTable *table)\n{\n    if (table == NULL)\n        return -1;\n    return table->nbElems;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint\nvirSystemdActivationComplete(virSystemdActivationPtr act)\n{\n    if (virHashSize(act->fds) != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Some activation file descriptors are unclaimed\"));\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virSystemdActivationHasName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "957-962",
    "snippet": "bool\nvirSystemdActivationHasName(virSystemdActivationPtr act,\n                            const char *name)\n{\n    return virHashLookup(act->fds, name) != NULL;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "act->fds",
            "name"
          ],
          "line": 961
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nbool\nvirSystemdActivationHasName(virSystemdActivationPtr act,\n                            const char *name)\n{\n    return virHashLookup(act->fds, name) != NULL;\n}"
  },
  {
    "function_name": "virSystemdGetActivation",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "926-944",
    "snippet": "int\nvirSystemdGetActivation(virSystemdActivationMap *map,\n                        size_t nmap,\n                        virSystemdActivationPtr *act)\n{\n    int nfds = 0;\n\n    if ((nfds = virSystemdGetListenFDs()) < 0)\n        return -1;\n\n    if (nfds == 0) {\n        VIR_DEBUG(\"No activation FDs present\");\n        *act = NULL;\n        return 0;\n    }\n\n    *act = virSystemdActivationNew(map, nmap, nfds);\n    return 0;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSystemdActivationNew",
          "args": [
            "map",
            "nmap",
            "nfds"
          ],
          "line": 942
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdActivationNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "878-908",
          "snippet": "static virSystemdActivationPtr\nvirSystemdActivationNew(virSystemdActivationMap *map,\n                        size_t nmap,\n                        int nfds)\n{\n    virSystemdActivationPtr act;\n    const char *fdnames;\n\n    VIR_DEBUG(\"Activated with %d FDs\", nfds);\n    if (VIR_ALLOC(act) < 0)\n        return NULL;\n\n    if (!(act->fds = virHashCreate(10, virSystemdActivationEntryFree)))\n        goto error;\n\n    fdnames = getenv(\"LISTEN_FDNAMES\");\n    if (fdnames) {\n        if (virSystemdActivationInitFromNames(act, nfds, fdnames) < 0)\n            goto error;\n    } else {\n        if (virSystemdActivationInitFromMap(act, nfds, map, nmap) < 0)\n            goto error;\n    }\n\n    VIR_DEBUG(\"Created activation object for %d FDs\", nfds);\n    return act;\n\n error:\n    virSystemdActivationFree(act);\n    return NULL;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic virSystemdActivationPtr\nvirSystemdActivationNew(virSystemdActivationMap *map,\n                        size_t nmap,\n                        int nfds)\n{\n    virSystemdActivationPtr act;\n    const char *fdnames;\n\n    VIR_DEBUG(\"Activated with %d FDs\", nfds);\n    if (VIR_ALLOC(act) < 0)\n        return NULL;\n\n    if (!(act->fds = virHashCreate(10, virSystemdActivationEntryFree)))\n        goto error;\n\n    fdnames = getenv(\"LISTEN_FDNAMES\");\n    if (fdnames) {\n        if (virSystemdActivationInitFromNames(act, nfds, fdnames) < 0)\n            goto error;\n    } else {\n        if (virSystemdActivationInitFromMap(act, nfds, map, nmap) < 0)\n            goto error;\n    }\n\n    VIR_DEBUG(\"Created activation object for %d FDs\", nfds);\n    return act;\n\n error:\n    virSystemdActivationFree(act);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No activation FDs present\""
          ],
          "line": 937
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSystemdGetListenFDs",
          "args": [],
          "line": 933
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdGetListenFDs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "870-874",
          "snippet": "static unsigned int\nvirSystemdGetListenFDs(void)\n{\n    return 0;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic unsigned int\nvirSystemdGetListenFDs(void)\n{\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint\nvirSystemdGetActivation(virSystemdActivationMap *map,\n                        size_t nmap,\n                        virSystemdActivationPtr *act)\n{\n    int nfds = 0;\n\n    if ((nfds = virSystemdGetListenFDs()) < 0)\n        return -1;\n\n    if (nfds == 0) {\n        VIR_DEBUG(\"No activation FDs present\");\n        *act = NULL;\n        return 0;\n    }\n\n    *act = virSystemdActivationNew(map, nmap, nfds);\n    return 0;\n}"
  },
  {
    "function_name": "virSystemdActivationNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "878-908",
    "snippet": "static virSystemdActivationPtr\nvirSystemdActivationNew(virSystemdActivationMap *map,\n                        size_t nmap,\n                        int nfds)\n{\n    virSystemdActivationPtr act;\n    const char *fdnames;\n\n    VIR_DEBUG(\"Activated with %d FDs\", nfds);\n    if (VIR_ALLOC(act) < 0)\n        return NULL;\n\n    if (!(act->fds = virHashCreate(10, virSystemdActivationEntryFree)))\n        goto error;\n\n    fdnames = getenv(\"LISTEN_FDNAMES\");\n    if (fdnames) {\n        if (virSystemdActivationInitFromNames(act, nfds, fdnames) < 0)\n            goto error;\n    } else {\n        if (virSystemdActivationInitFromMap(act, nfds, map, nmap) < 0)\n            goto error;\n    }\n\n    VIR_DEBUG(\"Created activation object for %d FDs\", nfds);\n    return act;\n\n error:\n    virSystemdActivationFree(act);\n    return NULL;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSystemdActivationFree",
          "args": [
            "act"
          ],
          "line": 906
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdActivationFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "1034-1043",
          "snippet": "void\nvirSystemdActivationFree(virSystemdActivationPtr act)\n{\n    if (!act)\n        return;\n\n    virHashFree(act->fds);\n\n    VIR_FREE(act);\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nvoid\nvirSystemdActivationFree(virSystemdActivationPtr act)\n{\n    if (!act)\n        return;\n\n    virHashFree(act->fds);\n\n    VIR_FREE(act);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Created activation object for %d FDs\"",
            "nfds"
          ],
          "line": 902
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSystemdActivationInitFromMap",
          "args": [
            "act",
            "nfds",
            "map",
            "nmap"
          ],
          "line": 898
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdActivationInitFromMap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "717-803",
          "snippet": "static int\nvirSystemdActivationInitFromMap(virSystemdActivationPtr act,\n                                int nfds,\n                                virSystemdActivationMap *map,\n                                size_t nmap)\n{\n    int nextfd = STDERR_FILENO + 1;\n    size_t i;\n\n    while (nfds) {\n        virSocketAddr addr;\n        const char *name = NULL;\n\n        memset(&addr, 0, sizeof(addr));\n\n        addr.len = sizeof(addr.data);\n        if (getsockname(nextfd, &addr.data.sa, &addr.len) < 0) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to get local socket name\"));\n            goto error;\n        }\n\n        VIR_DEBUG(\"Got socket family %d for FD %d\",\n                  addr.data.sa.sa_family, nextfd);\n\n        for (i = 0; i < nmap && !name; i++) {\n            if (map[i].name == NULL)\n                continue;\n\n            if (addr.data.sa.sa_family == AF_INET) {\n                if (map[i].family == AF_INET) {\n                    VIR_DEBUG(\"Expect %d got %d\",\n                              map[i].port, ntohs(addr.data.inet4.sin_port));\n                    if (addr.data.inet4.sin_port == htons(map[i].port))\n                        name = map[i].name;\n                }\n            } else if (addr.data.sa.sa_family == AF_INET6) {\n                /* NB use of AF_INET here is correct. The \"map\" struct\n                 * only refers to AF_INET. The socket may be AF_INET\n                 * or AF_INET6\n                 */\n                if (map[i].family == AF_INET) {\n                    VIR_DEBUG(\"Expect %d got %d\",\n                              map[i].port, ntohs(addr.data.inet6.sin6_port));\n                    if (addr.data.inet6.sin6_port == htons(map[i].port))\n                        name = map[i].name;\n                }\n#ifndef WIN32\n            } else if (addr.data.sa.sa_family == AF_UNIX) {\n                if (map[i].family == AF_UNIX) {\n                    VIR_DEBUG(\"Expect %s got %s\", map[i].path, addr.data.un.sun_path);\n                    if (STREQLEN(map[i].path,\n                                 addr.data.un.sun_path,\n                                 sizeof(addr.data.un.sun_path)))\n                        name = map[i].name;\n                }\n#endif\n            } else {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Unexpected socket family %d\"),\n                               addr.data.sa.sa_family);\n                goto error;\n            }\n        }\n\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Cannot find name for FD %d socket family %d\"),\n                           nextfd, addr.data.sa.sa_family);\n            goto error;\n        }\n\n        if (virSystemdActivationAddFD(act, name, nextfd) < 0)\n            goto error;\n\n        nfds--;\n        nextfd++;\n    }\n\n    return 0;\n\n error:\n    for (i = 0; i < nfds; i++) {\n        int fd = nextfd + i;\n        VIR_FORCE_CLOSE(fd);\n    }\n    return -1;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdActivationInitFromMap(virSystemdActivationPtr act,\n                                int nfds,\n                                virSystemdActivationMap *map,\n                                size_t nmap)\n{\n    int nextfd = STDERR_FILENO + 1;\n    size_t i;\n\n    while (nfds) {\n        virSocketAddr addr;\n        const char *name = NULL;\n\n        memset(&addr, 0, sizeof(addr));\n\n        addr.len = sizeof(addr.data);\n        if (getsockname(nextfd, &addr.data.sa, &addr.len) < 0) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to get local socket name\"));\n            goto error;\n        }\n\n        VIR_DEBUG(\"Got socket family %d for FD %d\",\n                  addr.data.sa.sa_family, nextfd);\n\n        for (i = 0; i < nmap && !name; i++) {\n            if (map[i].name == NULL)\n                continue;\n\n            if (addr.data.sa.sa_family == AF_INET) {\n                if (map[i].family == AF_INET) {\n                    VIR_DEBUG(\"Expect %d got %d\",\n                              map[i].port, ntohs(addr.data.inet4.sin_port));\n                    if (addr.data.inet4.sin_port == htons(map[i].port))\n                        name = map[i].name;\n                }\n            } else if (addr.data.sa.sa_family == AF_INET6) {\n                /* NB use of AF_INET here is correct. The \"map\" struct\n                 * only refers to AF_INET. The socket may be AF_INET\n                 * or AF_INET6\n                 */\n                if (map[i].family == AF_INET) {\n                    VIR_DEBUG(\"Expect %d got %d\",\n                              map[i].port, ntohs(addr.data.inet6.sin6_port));\n                    if (addr.data.inet6.sin6_port == htons(map[i].port))\n                        name = map[i].name;\n                }\n#ifndef WIN32\n            } else if (addr.data.sa.sa_family == AF_UNIX) {\n                if (map[i].family == AF_UNIX) {\n                    VIR_DEBUG(\"Expect %s got %s\", map[i].path, addr.data.un.sun_path);\n                    if (STREQLEN(map[i].path,\n                                 addr.data.un.sun_path,\n                                 sizeof(addr.data.un.sun_path)))\n                        name = map[i].name;\n                }\n#endif\n            } else {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Unexpected socket family %d\"),\n                               addr.data.sa.sa_family);\n                goto error;\n            }\n        }\n\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Cannot find name for FD %d socket family %d\"),\n                           nextfd, addr.data.sa.sa_family);\n            goto error;\n        }\n\n        if (virSystemdActivationAddFD(act, name, nextfd) < 0)\n            goto error;\n\n        nfds--;\n        nextfd++;\n    }\n\n    return 0;\n\n error:\n    for (i = 0; i < nfds; i++) {\n        int fd = nextfd + i;\n        VIR_FORCE_CLOSE(fd);\n    }\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdActivationInitFromNames",
          "args": [
            "act",
            "nfds",
            "fdnames"
          ],
          "line": 895
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdActivationInitFromNames",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "669-710",
          "snippet": "static int\nvirSystemdActivationInitFromNames(virSystemdActivationPtr act,\n                                  int nfds,\n                                  const char *fdnames)\n{\n    VIR_AUTOSTRINGLIST fdnamelistptr = NULL;\n    char **fdnamelist;\n    size_t nfdnames;\n    size_t i;\n    int nextfd = STDERR_FILENO + 1;\n\n    VIR_DEBUG(\"FD names %s\", fdnames);\n\n    if (!(fdnamelistptr = virStringSplitCount(fdnames, \":\", 0, &nfdnames)))\n        goto error;\n\n    if (nfdnames != nfds) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Expecting %d FD names but got %zu\"),\n                       nfds, nfdnames);\n        goto error;\n    }\n\n    fdnamelist = fdnamelistptr;\n    while (nfds) {\n        if (virSystemdActivationAddFD(act, *fdnamelist, nextfd) < 0)\n            goto error;\n\n        fdnamelist++;\n        nextfd++;\n        nfds--;\n    }\n\n    return 0;\n\n error:\n    for (i = 0; i < nfds; i++) {\n        int fd = nextfd + i;\n        VIR_FORCE_CLOSE(fd);\n    }\n    return -1;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdActivationInitFromNames(virSystemdActivationPtr act,\n                                  int nfds,\n                                  const char *fdnames)\n{\n    VIR_AUTOSTRINGLIST fdnamelistptr = NULL;\n    char **fdnamelist;\n    size_t nfdnames;\n    size_t i;\n    int nextfd = STDERR_FILENO + 1;\n\n    VIR_DEBUG(\"FD names %s\", fdnames);\n\n    if (!(fdnamelistptr = virStringSplitCount(fdnames, \":\", 0, &nfdnames)))\n        goto error;\n\n    if (nfdnames != nfds) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Expecting %d FD names but got %zu\"),\n                       nfds, nfdnames);\n        goto error;\n    }\n\n    fdnamelist = fdnamelistptr;\n    while (nfds) {\n        if (virSystemdActivationAddFD(act, *fdnamelist, nextfd) < 0)\n            goto error;\n\n        fdnamelist++;\n        nextfd++;\n        nfds--;\n    }\n\n    return 0;\n\n error:\n    for (i = 0; i < nfds; i++) {\n        int fd = nextfd + i;\n        VIR_FORCE_CLOSE(fd);\n    }\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"LISTEN_FDNAMES\""
          ],
          "line": 893
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashCreate",
          "args": [
            "10",
            "virSystemdActivationEntryFree"
          ],
          "line": 890
        },
        "resolved": true,
        "details": {
          "function_name": "virHashCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "202-211",
          "snippet": "virHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "act"
          ],
          "line": 887
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Activated with %d FDs\"",
            "nfds"
          ],
          "line": 886
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic virSystemdActivationPtr\nvirSystemdActivationNew(virSystemdActivationMap *map,\n                        size_t nmap,\n                        int nfds)\n{\n    virSystemdActivationPtr act;\n    const char *fdnames;\n\n    VIR_DEBUG(\"Activated with %d FDs\", nfds);\n    if (VIR_ALLOC(act) < 0)\n        return NULL;\n\n    if (!(act->fds = virHashCreate(10, virSystemdActivationEntryFree)))\n        goto error;\n\n    fdnames = getenv(\"LISTEN_FDNAMES\");\n    if (fdnames) {\n        if (virSystemdActivationInitFromNames(act, nfds, fdnames) < 0)\n            goto error;\n    } else {\n        if (virSystemdActivationInitFromMap(act, nfds, map, nmap) < 0)\n            goto error;\n    }\n\n    VIR_DEBUG(\"Created activation object for %d FDs\", nfds);\n    return act;\n\n error:\n    virSystemdActivationFree(act);\n    return NULL;\n}"
  },
  {
    "function_name": "virSystemdGetListenFDs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "870-874",
    "snippet": "static unsigned int\nvirSystemdGetListenFDs(void)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic unsigned int\nvirSystemdGetListenFDs(void)\n{\n    return 0;\n}"
  },
  {
    "function_name": "virSystemdGetListenFDs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "814-866",
    "snippet": "static unsigned int\nvirSystemdGetListenFDs(void)\n{\n    const char *pidstr;\n    const char *fdstr;\n    size_t i = 0;\n    unsigned long long procid;\n    unsigned int nfds;\n\n    VIR_DEBUG(\"Setting up networking from caller\");\n\n    if (!(pidstr = getenv(\"LISTEN_PID\"))) {\n        VIR_DEBUG(\"No LISTEN_PID from caller\");\n        return 0;\n    }\n\n    if (virStrToLong_ull(pidstr, NULL, 10, &procid) < 0) {\n        VIR_DEBUG(\"Malformed LISTEN_PID from caller %s\", pidstr);\n        return 0;\n    }\n\n    if ((pid_t)procid != getpid()) {\n        VIR_DEBUG(\"LISTEN_PID %s is not for us %lld\",\n                  pidstr, (long long) getpid());\n        return 0;\n    }\n\n    if (!(fdstr = getenv(\"LISTEN_FDS\"))) {\n        VIR_DEBUG(\"No LISTEN_FDS from caller\");\n        return 0;\n    }\n\n    if (virStrToLong_ui(fdstr, NULL, 10, &nfds) < 0) {\n        VIR_DEBUG(\"Malformed LISTEN_FDS from caller %s\", fdstr);\n        return 0;\n    }\n\n    g_unsetenv(\"LISTEN_PID\");\n    g_unsetenv(\"LISTEN_FDS\");\n\n    VIR_DEBUG(\"Got %u file descriptors\", nfds);\n\n    for (i = 0; i < nfds; i++) {\n        int fd = STDERR_FILENO + i + 1;\n\n        VIR_DEBUG(\"Disabling inheritance of passed FD %d\", fd);\n\n        if (virSetInherit(fd, false) < 0)\n            VIR_WARN(\"Couldn't disable inheritance of passed FD %d\", fd);\n    }\n\n    return nfds;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Couldn't disable inheritance of passed FD %d\"",
            "fd"
          ],
          "line": 862
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSetInherit",
          "args": [
            "fd",
            "false"
          ],
          "line": 861
        },
        "resolved": true,
        "details": {
          "function_name": "virSetInherit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "104-111",
          "snippet": "int virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Disabling inheritance of passed FD %d\"",
            "fd"
          ],
          "line": 859
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Got %u file descriptors\"",
            "nfds"
          ],
          "line": 854
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_unsetenv",
          "args": [
            "\"LISTEN_FDS\""
          ],
          "line": 852
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_unsetenv",
          "args": [
            "\"LISTEN_PID\""
          ],
          "line": 851
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Malformed LISTEN_FDS from caller %s\"",
            "fdstr"
          ],
          "line": 847
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrToLong_ui",
          "args": [
            "fdstr",
            "NULL",
            "10",
            "&nfds"
          ],
          "line": 846
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_uip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "444-461",
          "snippet": "int\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No LISTEN_FDS from caller\""
          ],
          "line": 842
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"LISTEN_FDS\""
          ],
          "line": 841
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"LISTEN_PID %s is not for us %lld\"",
            "pidstr",
            "(long long) getpid()"
          ],
          "line": 836
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 837
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 835
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Malformed LISTEN_PID from caller %s\"",
            "pidstr"
          ],
          "line": 831
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrToLong_ull",
          "args": [
            "pidstr",
            "NULL",
            "10",
            "&procid"
          ],
          "line": 830
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_ullp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "568-586",
          "snippet": "int\nvirStrToLong_ullp(char const *s, char **end_ptr, int base,\n                  unsigned long long *result)\n{\n    unsigned long long val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtoull(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_ullp(char const *s, char **end_ptr, int base,\n                  unsigned long long *result)\n{\n    unsigned long long val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtoull(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No LISTEN_PID from caller\""
          ],
          "line": 826
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"LISTEN_PID\""
          ],
          "line": 825
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up networking from caller\""
          ],
          "line": 823
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic unsigned int\nvirSystemdGetListenFDs(void)\n{\n    const char *pidstr;\n    const char *fdstr;\n    size_t i = 0;\n    unsigned long long procid;\n    unsigned int nfds;\n\n    VIR_DEBUG(\"Setting up networking from caller\");\n\n    if (!(pidstr = getenv(\"LISTEN_PID\"))) {\n        VIR_DEBUG(\"No LISTEN_PID from caller\");\n        return 0;\n    }\n\n    if (virStrToLong_ull(pidstr, NULL, 10, &procid) < 0) {\n        VIR_DEBUG(\"Malformed LISTEN_PID from caller %s\", pidstr);\n        return 0;\n    }\n\n    if ((pid_t)procid != getpid()) {\n        VIR_DEBUG(\"LISTEN_PID %s is not for us %lld\",\n                  pidstr, (long long) getpid());\n        return 0;\n    }\n\n    if (!(fdstr = getenv(\"LISTEN_FDS\"))) {\n        VIR_DEBUG(\"No LISTEN_FDS from caller\");\n        return 0;\n    }\n\n    if (virStrToLong_ui(fdstr, NULL, 10, &nfds) < 0) {\n        VIR_DEBUG(\"Malformed LISTEN_FDS from caller %s\", fdstr);\n        return 0;\n    }\n\n    g_unsetenv(\"LISTEN_PID\");\n    g_unsetenv(\"LISTEN_FDS\");\n\n    VIR_DEBUG(\"Got %u file descriptors\", nfds);\n\n    for (i = 0; i < nfds; i++) {\n        int fd = STDERR_FILENO + i + 1;\n\n        VIR_DEBUG(\"Disabling inheritance of passed FD %d\", fd);\n\n        if (virSetInherit(fd, false) < 0)\n            VIR_WARN(\"Couldn't disable inheritance of passed FD %d\", fd);\n    }\n\n    return nfds;\n}"
  },
  {
    "function_name": "virSystemdActivationInitFromMap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "717-803",
    "snippet": "static int\nvirSystemdActivationInitFromMap(virSystemdActivationPtr act,\n                                int nfds,\n                                virSystemdActivationMap *map,\n                                size_t nmap)\n{\n    int nextfd = STDERR_FILENO + 1;\n    size_t i;\n\n    while (nfds) {\n        virSocketAddr addr;\n        const char *name = NULL;\n\n        memset(&addr, 0, sizeof(addr));\n\n        addr.len = sizeof(addr.data);\n        if (getsockname(nextfd, &addr.data.sa, &addr.len) < 0) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to get local socket name\"));\n            goto error;\n        }\n\n        VIR_DEBUG(\"Got socket family %d for FD %d\",\n                  addr.data.sa.sa_family, nextfd);\n\n        for (i = 0; i < nmap && !name; i++) {\n            if (map[i].name == NULL)\n                continue;\n\n            if (addr.data.sa.sa_family == AF_INET) {\n                if (map[i].family == AF_INET) {\n                    VIR_DEBUG(\"Expect %d got %d\",\n                              map[i].port, ntohs(addr.data.inet4.sin_port));\n                    if (addr.data.inet4.sin_port == htons(map[i].port))\n                        name = map[i].name;\n                }\n            } else if (addr.data.sa.sa_family == AF_INET6) {\n                /* NB use of AF_INET here is correct. The \"map\" struct\n                 * only refers to AF_INET. The socket may be AF_INET\n                 * or AF_INET6\n                 */\n                if (map[i].family == AF_INET) {\n                    VIR_DEBUG(\"Expect %d got %d\",\n                              map[i].port, ntohs(addr.data.inet6.sin6_port));\n                    if (addr.data.inet6.sin6_port == htons(map[i].port))\n                        name = map[i].name;\n                }\n#ifndef WIN32\n            } else if (addr.data.sa.sa_family == AF_UNIX) {\n                if (map[i].family == AF_UNIX) {\n                    VIR_DEBUG(\"Expect %s got %s\", map[i].path, addr.data.un.sun_path);\n                    if (STREQLEN(map[i].path,\n                                 addr.data.un.sun_path,\n                                 sizeof(addr.data.un.sun_path)))\n                        name = map[i].name;\n                }\n#endif\n            } else {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Unexpected socket family %d\"),\n                               addr.data.sa.sa_family);\n                goto error;\n            }\n        }\n\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Cannot find name for FD %d socket family %d\"),\n                           nextfd, addr.data.sa.sa_family);\n            goto error;\n        }\n\n        if (virSystemdActivationAddFD(act, name, nextfd) < 0)\n            goto error;\n\n        nfds--;\n        nextfd++;\n    }\n\n    return 0;\n\n error:\n    for (i = 0; i < nfds; i++) {\n        int fd = nextfd + i;\n        VIR_FORCE_CLOSE(fd);\n    }\n    return -1;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "fd"
          ],
          "line": 800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSystemdActivationAddFD",
          "args": [
            "act",
            "name",
            "nextfd"
          ],
          "line": 788
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdActivationAddFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "632-666",
          "snippet": "static int\nvirSystemdActivationAddFD(virSystemdActivationPtr act,\n                          const char *name,\n                          int fd)\n{\n    virSystemdActivationEntryPtr ent = virHashLookup(act->fds, name);\n\n    if (!ent) {\n        if (VIR_ALLOC(ent) < 0)\n            return -1;\n\n        if (VIR_ALLOC_N(ent->fds, 1) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        ent->fds[ent->nfds++] = fd;\n\n        VIR_DEBUG(\"Record first FD %d with name %s\", fd, name);\n        if (virHashAddEntry(act->fds, name, ent) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        return 0;\n    }\n\n    if (VIR_EXPAND_N(ent->fds, ent->nfds, 1) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Record extra FD %d with name %s\", fd, name);\n    ent->fds[ent->nfds - 1] = fd;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdActivationAddFD(virSystemdActivationPtr act,\n                          const char *name,\n                          int fd)\n{\n    virSystemdActivationEntryPtr ent = virHashLookup(act->fds, name);\n\n    if (!ent) {\n        if (VIR_ALLOC(ent) < 0)\n            return -1;\n\n        if (VIR_ALLOC_N(ent->fds, 1) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        ent->fds[ent->nfds++] = fd;\n\n        VIR_DEBUG(\"Record first FD %d with name %s\", fd, name);\n        if (virHashAddEntry(act->fds, name, ent) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        return 0;\n    }\n\n    if (VIR_EXPAND_N(ent->fds, ent->nfds, 1) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Record extra FD %d with name %s\", fd, name);\n    ent->fds[ent->nfds - 1] = fd;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Cannot find name for FD %d socket family %d\")",
            "nextfd",
            "addr.data.sa.sa_family"
          ],
          "line": 782
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot find name for FD %d socket family %d\""
          ],
          "line": 783
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unexpected socket family %d\")",
            "addr.data.sa.sa_family"
          ],
          "line": 774
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQLEN",
          "args": [
            "map[i].path",
            "addr.data.un.sun_path",
            "sizeof(addr.data.un.sun_path)"
          ],
          "line": 767
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Expect %s got %s\"",
            "map[i].path",
            "addr.data.un.sun_path"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "map[i].port"
          ],
          "line": 760
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Expect %d got %d\"",
            "map[i].port",
            "ntohs(addr.data.inet6.sin6_port)"
          ],
          "line": 758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntohs",
          "args": [
            "addr.data.inet6.sin6_port"
          ],
          "line": 759
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "map[i].port"
          ],
          "line": 749
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Expect %d got %d\"",
            "map[i].port",
            "ntohs(addr.data.inet4.sin_port)"
          ],
          "line": 747
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ntohs",
          "args": [
            "addr.data.inet4.sin_port"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Got socket family %d for FD %d\"",
            "addr.data.sa.sa_family",
            "nextfd"
          ],
          "line": 738
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to get local socket name\")"
          ],
          "line": 734
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getsockname",
          "args": [
            "nextfd",
            "&addr.data.sa",
            "&addr.len"
          ],
          "line": 733
        },
        "resolved": true,
        "details": {
          "function_name": "vir_getsockname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "254-270",
          "snippet": "int\nvir_getsockname(int fd, struct sockaddr *addr, socklen_t *addrlen)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (getsockname(sk, addr, addrlen) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_getsockname(int fd, struct sockaddr *addr, socklen_t *addrlen)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (getsockname(sk, addr, addrlen) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&addr",
            "0",
            "sizeof(addr)"
          ],
          "line": 730
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdActivationInitFromMap(virSystemdActivationPtr act,\n                                int nfds,\n                                virSystemdActivationMap *map,\n                                size_t nmap)\n{\n    int nextfd = STDERR_FILENO + 1;\n    size_t i;\n\n    while (nfds) {\n        virSocketAddr addr;\n        const char *name = NULL;\n\n        memset(&addr, 0, sizeof(addr));\n\n        addr.len = sizeof(addr.data);\n        if (getsockname(nextfd, &addr.data.sa, &addr.len) < 0) {\n            virReportSystemError(errno, \"%s\", _(\"Unable to get local socket name\"));\n            goto error;\n        }\n\n        VIR_DEBUG(\"Got socket family %d for FD %d\",\n                  addr.data.sa.sa_family, nextfd);\n\n        for (i = 0; i < nmap && !name; i++) {\n            if (map[i].name == NULL)\n                continue;\n\n            if (addr.data.sa.sa_family == AF_INET) {\n                if (map[i].family == AF_INET) {\n                    VIR_DEBUG(\"Expect %d got %d\",\n                              map[i].port, ntohs(addr.data.inet4.sin_port));\n                    if (addr.data.inet4.sin_port == htons(map[i].port))\n                        name = map[i].name;\n                }\n            } else if (addr.data.sa.sa_family == AF_INET6) {\n                /* NB use of AF_INET here is correct. The \"map\" struct\n                 * only refers to AF_INET. The socket may be AF_INET\n                 * or AF_INET6\n                 */\n                if (map[i].family == AF_INET) {\n                    VIR_DEBUG(\"Expect %d got %d\",\n                              map[i].port, ntohs(addr.data.inet6.sin6_port));\n                    if (addr.data.inet6.sin6_port == htons(map[i].port))\n                        name = map[i].name;\n                }\n#ifndef WIN32\n            } else if (addr.data.sa.sa_family == AF_UNIX) {\n                if (map[i].family == AF_UNIX) {\n                    VIR_DEBUG(\"Expect %s got %s\", map[i].path, addr.data.un.sun_path);\n                    if (STREQLEN(map[i].path,\n                                 addr.data.un.sun_path,\n                                 sizeof(addr.data.un.sun_path)))\n                        name = map[i].name;\n                }\n#endif\n            } else {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Unexpected socket family %d\"),\n                               addr.data.sa.sa_family);\n                goto error;\n            }\n        }\n\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Cannot find name for FD %d socket family %d\"),\n                           nextfd, addr.data.sa.sa_family);\n            goto error;\n        }\n\n        if (virSystemdActivationAddFD(act, name, nextfd) < 0)\n            goto error;\n\n        nfds--;\n        nextfd++;\n    }\n\n    return 0;\n\n error:\n    for (i = 0; i < nfds; i++) {\n        int fd = nextfd + i;\n        VIR_FORCE_CLOSE(fd);\n    }\n    return -1;\n}"
  },
  {
    "function_name": "virSystemdActivationInitFromNames",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "669-710",
    "snippet": "static int\nvirSystemdActivationInitFromNames(virSystemdActivationPtr act,\n                                  int nfds,\n                                  const char *fdnames)\n{\n    VIR_AUTOSTRINGLIST fdnamelistptr = NULL;\n    char **fdnamelist;\n    size_t nfdnames;\n    size_t i;\n    int nextfd = STDERR_FILENO + 1;\n\n    VIR_DEBUG(\"FD names %s\", fdnames);\n\n    if (!(fdnamelistptr = virStringSplitCount(fdnames, \":\", 0, &nfdnames)))\n        goto error;\n\n    if (nfdnames != nfds) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Expecting %d FD names but got %zu\"),\n                       nfds, nfdnames);\n        goto error;\n    }\n\n    fdnamelist = fdnamelistptr;\n    while (nfds) {\n        if (virSystemdActivationAddFD(act, *fdnamelist, nextfd) < 0)\n            goto error;\n\n        fdnamelist++;\n        nextfd++;\n        nfds--;\n    }\n\n    return 0;\n\n error:\n    for (i = 0; i < nfds; i++) {\n        int fd = nextfd + i;\n        VIR_FORCE_CLOSE(fd);\n    }\n    return -1;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "fd"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSystemdActivationAddFD",
          "args": [
            "act",
            "*fdnamelist",
            "nextfd"
          ],
          "line": 694
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdActivationAddFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "632-666",
          "snippet": "static int\nvirSystemdActivationAddFD(virSystemdActivationPtr act,\n                          const char *name,\n                          int fd)\n{\n    virSystemdActivationEntryPtr ent = virHashLookup(act->fds, name);\n\n    if (!ent) {\n        if (VIR_ALLOC(ent) < 0)\n            return -1;\n\n        if (VIR_ALLOC_N(ent->fds, 1) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        ent->fds[ent->nfds++] = fd;\n\n        VIR_DEBUG(\"Record first FD %d with name %s\", fd, name);\n        if (virHashAddEntry(act->fds, name, ent) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        return 0;\n    }\n\n    if (VIR_EXPAND_N(ent->fds, ent->nfds, 1) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Record extra FD %d with name %s\", fd, name);\n    ent->fds[ent->nfds - 1] = fd;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdActivationAddFD(virSystemdActivationPtr act,\n                          const char *name,\n                          int fd)\n{\n    virSystemdActivationEntryPtr ent = virHashLookup(act->fds, name);\n\n    if (!ent) {\n        if (VIR_ALLOC(ent) < 0)\n            return -1;\n\n        if (VIR_ALLOC_N(ent->fds, 1) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        ent->fds[ent->nfds++] = fd;\n\n        VIR_DEBUG(\"Record first FD %d with name %s\", fd, name);\n        if (virHashAddEntry(act->fds, name, ent) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        return 0;\n    }\n\n    if (VIR_EXPAND_N(ent->fds, ent->nfds, 1) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Record extra FD %d with name %s\", fd, name);\n    ent->fds[ent->nfds - 1] = fd;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Expecting %d FD names but got %zu\")",
            "nfds",
            "nfdnames"
          ],
          "line": 686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Expecting %d FD names but got %zu\""
          ],
          "line": 687
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStringSplitCount",
          "args": [
            "fdnames",
            "\":\"",
            "0",
            "&nfdnames"
          ],
          "line": 682
        },
        "resolved": true,
        "details": {
          "function_name": "virStringSplitCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "69-123",
          "snippet": "char **\nvirStringSplitCount(const char *string,\n                    const char *delim,\n                    size_t max_tokens,\n                    size_t *tokcount)\n{\n    char **tokens = NULL;\n    size_t ntokens = 0;\n    size_t maxtokens = 0;\n    const char *remainder = string;\n    char *tmp;\n    size_t i;\n\n    if (max_tokens == 0)\n        max_tokens = INT_MAX;\n\n    tmp = strstr(remainder, delim);\n    if (tmp) {\n        size_t delimlen = strlen(delim);\n\n        while (--max_tokens && tmp) {\n            size_t len = tmp - remainder;\n\n            if (VIR_RESIZE_N(tokens, maxtokens, ntokens, 1) < 0)\n                goto error;\n\n            tokens[ntokens] = g_strndup(remainder, len);\n            ntokens++;\n            remainder = tmp + delimlen;\n            tmp = strstr(remainder, delim);\n        }\n    }\n    if (*string) {\n        if (VIR_RESIZE_N(tokens, maxtokens, ntokens, 1) < 0)\n            goto error;\n\n        tokens[ntokens] = g_strdup(remainder);\n        ntokens++;\n    }\n\n    if (VIR_RESIZE_N(tokens, maxtokens, ntokens, 1) < 0)\n        goto error;\n    tokens[ntokens++] = NULL;\n\n    if (tokcount)\n        *tokcount = ntokens - 1;\n\n    return tokens;\n\n error:\n    for (i = 0; i < ntokens; i++)\n        VIR_FREE(tokens[i]);\n    VIR_FREE(tokens);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nchar **\nvirStringSplitCount(const char *string,\n                    const char *delim,\n                    size_t max_tokens,\n                    size_t *tokcount)\n{\n    char **tokens = NULL;\n    size_t ntokens = 0;\n    size_t maxtokens = 0;\n    const char *remainder = string;\n    char *tmp;\n    size_t i;\n\n    if (max_tokens == 0)\n        max_tokens = INT_MAX;\n\n    tmp = strstr(remainder, delim);\n    if (tmp) {\n        size_t delimlen = strlen(delim);\n\n        while (--max_tokens && tmp) {\n            size_t len = tmp - remainder;\n\n            if (VIR_RESIZE_N(tokens, maxtokens, ntokens, 1) < 0)\n                goto error;\n\n            tokens[ntokens] = g_strndup(remainder, len);\n            ntokens++;\n            remainder = tmp + delimlen;\n            tmp = strstr(remainder, delim);\n        }\n    }\n    if (*string) {\n        if (VIR_RESIZE_N(tokens, maxtokens, ntokens, 1) < 0)\n            goto error;\n\n        tokens[ntokens] = g_strdup(remainder);\n        ntokens++;\n    }\n\n    if (VIR_RESIZE_N(tokens, maxtokens, ntokens, 1) < 0)\n        goto error;\n    tokens[ntokens++] = NULL;\n\n    if (tokcount)\n        *tokcount = ntokens - 1;\n\n    return tokens;\n\n error:\n    for (i = 0; i < ntokens; i++)\n        VIR_FREE(tokens[i]);\n    VIR_FREE(tokens);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"FD names %s\"",
            "fdnames"
          ],
          "line": 680
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdActivationInitFromNames(virSystemdActivationPtr act,\n                                  int nfds,\n                                  const char *fdnames)\n{\n    VIR_AUTOSTRINGLIST fdnamelistptr = NULL;\n    char **fdnamelist;\n    size_t nfdnames;\n    size_t i;\n    int nextfd = STDERR_FILENO + 1;\n\n    VIR_DEBUG(\"FD names %s\", fdnames);\n\n    if (!(fdnamelistptr = virStringSplitCount(fdnames, \":\", 0, &nfdnames)))\n        goto error;\n\n    if (nfdnames != nfds) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Expecting %d FD names but got %zu\"),\n                       nfds, nfdnames);\n        goto error;\n    }\n\n    fdnamelist = fdnamelistptr;\n    while (nfds) {\n        if (virSystemdActivationAddFD(act, *fdnamelist, nextfd) < 0)\n            goto error;\n\n        fdnamelist++;\n        nextfd++;\n        nfds--;\n    }\n\n    return 0;\n\n error:\n    for (i = 0; i < nfds; i++) {\n        int fd = nextfd + i;\n        VIR_FORCE_CLOSE(fd);\n    }\n    return -1;\n}"
  },
  {
    "function_name": "virSystemdActivationAddFD",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "632-666",
    "snippet": "static int\nvirSystemdActivationAddFD(virSystemdActivationPtr act,\n                          const char *name,\n                          int fd)\n{\n    virSystemdActivationEntryPtr ent = virHashLookup(act->fds, name);\n\n    if (!ent) {\n        if (VIR_ALLOC(ent) < 0)\n            return -1;\n\n        if (VIR_ALLOC_N(ent->fds, 1) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        ent->fds[ent->nfds++] = fd;\n\n        VIR_DEBUG(\"Record first FD %d with name %s\", fd, name);\n        if (virHashAddEntry(act->fds, name, ent) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        return 0;\n    }\n\n    if (VIR_EXPAND_N(ent->fds, ent->nfds, 1) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Record extra FD %d with name %s\", fd, name);\n    ent->fds[ent->nfds - 1] = fd;\n\n    return 0;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Record extra FD %d with name %s\"",
            "fd",
            "name"
          ],
          "line": 662
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "ent->fds",
            "ent->nfds",
            "1"
          ],
          "line": 659
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSystemdActivationEntryFree",
          "args": [
            "ent"
          ],
          "line": 652
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdActivationEntryFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "615-629",
          "snippet": "static void\nvirSystemdActivationEntryFree(void *data)\n{\n    virSystemdActivationEntryPtr ent = data;\n    size_t i;\n\n    VIR_DEBUG(\"Closing activation FDs\");\n    for (i = 0; i < ent->nfds; i++) {\n        VIR_DEBUG(\"Closing activation FD %d\", ent->fds[i]);\n        VIR_FORCE_CLOSE(ent->fds[i]);\n    }\n\n    VIR_FREE(ent->fds);\n    VIR_FREE(ent);\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic void\nvirSystemdActivationEntryFree(void *data)\n{\n    virSystemdActivationEntryPtr ent = data;\n    size_t i;\n\n    VIR_DEBUG(\"Closing activation FDs\");\n    for (i = 0; i < ent->nfds; i++) {\n        VIR_DEBUG(\"Closing activation FD %d\", ent->fds[i]);\n        VIR_FORCE_CLOSE(ent->fds[i]);\n    }\n\n    VIR_FREE(ent->fds);\n    VIR_FREE(ent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "act->fds",
            "name",
            "ent"
          ],
          "line": 651
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Record first FD %d with name %s\"",
            "fd",
            "name"
          ],
          "line": 650
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "ent->fds",
            "1"
          ],
          "line": 643
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "ent"
          ],
          "line": 640
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "act->fds",
            "name"
          ],
          "line": 637
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdActivationAddFD(virSystemdActivationPtr act,\n                          const char *name,\n                          int fd)\n{\n    virSystemdActivationEntryPtr ent = virHashLookup(act->fds, name);\n\n    if (!ent) {\n        if (VIR_ALLOC(ent) < 0)\n            return -1;\n\n        if (VIR_ALLOC_N(ent->fds, 1) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        ent->fds[ent->nfds++] = fd;\n\n        VIR_DEBUG(\"Record first FD %d with name %s\", fd, name);\n        if (virHashAddEntry(act->fds, name, ent) < 0) {\n            virSystemdActivationEntryFree(ent);\n            return -1;\n        }\n\n        return 0;\n    }\n\n    if (VIR_EXPAND_N(ent->fds, ent->nfds, 1) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Record extra FD %d with name %s\", fd, name);\n    ent->fds[ent->nfds - 1] = fd;\n\n    return 0;\n}"
  },
  {
    "function_name": "virSystemdActivationEntryFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "615-629",
    "snippet": "static void\nvirSystemdActivationEntryFree(void *data)\n{\n    virSystemdActivationEntryPtr ent = data;\n    size_t i;\n\n    VIR_DEBUG(\"Closing activation FDs\");\n    for (i = 0; i < ent->nfds; i++) {\n        VIR_DEBUG(\"Closing activation FD %d\", ent->fds[i]);\n        VIR_FORCE_CLOSE(ent->fds[i]);\n    }\n\n    VIR_FREE(ent->fds);\n    VIR_FREE(ent);\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ent"
          ],
          "line": 628
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ent->fds"
          ],
          "line": 627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ent->fds[i]"
          ],
          "line": 624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Closing activation FD %d\"",
            "ent->fds[i]"
          ],
          "line": 623
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Closing activation FDs\""
          ],
          "line": 621
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic void\nvirSystemdActivationEntryFree(void *data)\n{\n    virSystemdActivationEntryPtr ent = data;\n    size_t i;\n\n    VIR_DEBUG(\"Closing activation FDs\");\n    for (i = 0; i < ent->nfds; i++) {\n        VIR_DEBUG(\"Closing activation FD %d\", ent->fds[i]);\n        VIR_FORCE_CLOSE(ent->fds[i]);\n    }\n\n    VIR_FREE(ent->fds);\n    VIR_FREE(ent);\n}"
  },
  {
    "function_name": "virSystemdCanHybridSleep",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "609-612",
    "snippet": "int virSystemdCanHybridSleep(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanHybridSleep\", result);\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSystemdPMSupportTarget",
          "args": [
            "\"CanHybridSleep\"",
            "result"
          ],
          "line": 611
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdPMSupportTarget",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "559-597",
          "snippet": "static int\nvirSystemdPMSupportTarget(const char *methodName, bool *result)\n{\n    int ret;\n    DBusConnection *conn;\n    DBusMessage *message = NULL;\n    char *response;\n\n    if ((ret = virSystemdHasLogind()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    if (virDBusCallMethod(conn,\n                          &message,\n                          NULL,\n                          \"org.freedesktop.login1\",\n                          \"/org/freedesktop/login1\",\n                          \"org.freedesktop.login1.Manager\",\n                          methodName,\n                          NULL) < 0)\n        return ret;\n\n    if ((ret = virDBusMessageDecode(message, \"s\", &response)) < 0)\n        goto cleanup;\n\n    *result = STREQ(\"yes\", response) || STREQ(\"challenge\", response);\n\n    ret = 0;\n\n cleanup:\n    virDBusMessageUnref(message);\n    VIR_FREE(response);\n\n    return ret;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdPMSupportTarget(const char *methodName, bool *result)\n{\n    int ret;\n    DBusConnection *conn;\n    DBusMessage *message = NULL;\n    char *response;\n\n    if ((ret = virSystemdHasLogind()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    if (virDBusCallMethod(conn,\n                          &message,\n                          NULL,\n                          \"org.freedesktop.login1\",\n                          \"/org/freedesktop/login1\",\n                          \"org.freedesktop.login1.Manager\",\n                          methodName,\n                          NULL) < 0)\n        return ret;\n\n    if ((ret = virDBusMessageDecode(message, \"s\", &response)) < 0)\n        goto cleanup;\n\n    *result = STREQ(\"yes\", response) || STREQ(\"challenge\", response);\n\n    ret = 0;\n\n cleanup:\n    virDBusMessageUnref(message);\n    VIR_FREE(response);\n\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint virSystemdCanHybridSleep(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanHybridSleep\", result);\n}"
  },
  {
    "function_name": "virSystemdCanHibernate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "604-607",
    "snippet": "int virSystemdCanHibernate(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanHibernate\", result);\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSystemdPMSupportTarget",
          "args": [
            "\"CanHibernate\"",
            "result"
          ],
          "line": 606
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdPMSupportTarget",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "559-597",
          "snippet": "static int\nvirSystemdPMSupportTarget(const char *methodName, bool *result)\n{\n    int ret;\n    DBusConnection *conn;\n    DBusMessage *message = NULL;\n    char *response;\n\n    if ((ret = virSystemdHasLogind()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    if (virDBusCallMethod(conn,\n                          &message,\n                          NULL,\n                          \"org.freedesktop.login1\",\n                          \"/org/freedesktop/login1\",\n                          \"org.freedesktop.login1.Manager\",\n                          methodName,\n                          NULL) < 0)\n        return ret;\n\n    if ((ret = virDBusMessageDecode(message, \"s\", &response)) < 0)\n        goto cleanup;\n\n    *result = STREQ(\"yes\", response) || STREQ(\"challenge\", response);\n\n    ret = 0;\n\n cleanup:\n    virDBusMessageUnref(message);\n    VIR_FREE(response);\n\n    return ret;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdPMSupportTarget(const char *methodName, bool *result)\n{\n    int ret;\n    DBusConnection *conn;\n    DBusMessage *message = NULL;\n    char *response;\n\n    if ((ret = virSystemdHasLogind()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    if (virDBusCallMethod(conn,\n                          &message,\n                          NULL,\n                          \"org.freedesktop.login1\",\n                          \"/org/freedesktop/login1\",\n                          \"org.freedesktop.login1.Manager\",\n                          methodName,\n                          NULL) < 0)\n        return ret;\n\n    if ((ret = virDBusMessageDecode(message, \"s\", &response)) < 0)\n        goto cleanup;\n\n    *result = STREQ(\"yes\", response) || STREQ(\"challenge\", response);\n\n    ret = 0;\n\n cleanup:\n    virDBusMessageUnref(message);\n    VIR_FREE(response);\n\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint virSystemdCanHibernate(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanHibernate\", result);\n}"
  },
  {
    "function_name": "virSystemdCanSuspend",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "599-602",
    "snippet": "int virSystemdCanSuspend(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanSuspend\", result);\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSystemdPMSupportTarget",
          "args": [
            "\"CanSuspend\"",
            "result"
          ],
          "line": 601
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdPMSupportTarget",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "559-597",
          "snippet": "static int\nvirSystemdPMSupportTarget(const char *methodName, bool *result)\n{\n    int ret;\n    DBusConnection *conn;\n    DBusMessage *message = NULL;\n    char *response;\n\n    if ((ret = virSystemdHasLogind()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    if (virDBusCallMethod(conn,\n                          &message,\n                          NULL,\n                          \"org.freedesktop.login1\",\n                          \"/org/freedesktop/login1\",\n                          \"org.freedesktop.login1.Manager\",\n                          methodName,\n                          NULL) < 0)\n        return ret;\n\n    if ((ret = virDBusMessageDecode(message, \"s\", &response)) < 0)\n        goto cleanup;\n\n    *result = STREQ(\"yes\", response) || STREQ(\"challenge\", response);\n\n    ret = 0;\n\n cleanup:\n    virDBusMessageUnref(message);\n    VIR_FREE(response);\n\n    return ret;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdPMSupportTarget(const char *methodName, bool *result)\n{\n    int ret;\n    DBusConnection *conn;\n    DBusMessage *message = NULL;\n    char *response;\n\n    if ((ret = virSystemdHasLogind()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    if (virDBusCallMethod(conn,\n                          &message,\n                          NULL,\n                          \"org.freedesktop.login1\",\n                          \"/org/freedesktop/login1\",\n                          \"org.freedesktop.login1.Manager\",\n                          methodName,\n                          NULL) < 0)\n        return ret;\n\n    if ((ret = virDBusMessageDecode(message, \"s\", &response)) < 0)\n        goto cleanup;\n\n    *result = STREQ(\"yes\", response) || STREQ(\"challenge\", response);\n\n    ret = 0;\n\n cleanup:\n    virDBusMessageUnref(message);\n    VIR_FREE(response);\n\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint virSystemdCanSuspend(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanSuspend\", result);\n}"
  },
  {
    "function_name": "virSystemdPMSupportTarget",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "559-597",
    "snippet": "static int\nvirSystemdPMSupportTarget(const char *methodName, bool *result)\n{\n    int ret;\n    DBusConnection *conn;\n    DBusMessage *message = NULL;\n    char *response;\n\n    if ((ret = virSystemdHasLogind()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    if (virDBusCallMethod(conn,\n                          &message,\n                          NULL,\n                          \"org.freedesktop.login1\",\n                          \"/org/freedesktop/login1\",\n                          \"org.freedesktop.login1.Manager\",\n                          methodName,\n                          NULL) < 0)\n        return ret;\n\n    if ((ret = virDBusMessageDecode(message, \"s\", &response)) < 0)\n        goto cleanup;\n\n    *result = STREQ(\"yes\", response) || STREQ(\"challenge\", response);\n\n    ret = 0;\n\n cleanup:\n    virDBusMessageUnref(message);\n    VIR_FREE(response);\n\n    return ret;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "response"
          ],
          "line": 594
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusMessageUnref",
          "args": [
            "message"
          ],
          "line": 593
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusMessageUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1858-1861",
          "snippet": "void virDBusMessageUnref(DBusMessage *msg G_GNUC_UNUSED)\n{\n    /* nothing */\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nvoid virDBusMessageUnref(DBusMessage *msg G_GNUC_UNUSED)\n{\n    /* nothing */\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "\"challenge\"",
            "response"
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "\"yes\"",
            "response"
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusMessageDecode",
          "args": [
            "message",
            "\"s\"",
            "&response"
          ],
          "line": 585
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusMessageDecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1837-1844",
          "snippet": "int virDBusMessageDecode(DBusMessage* msg G_GNUC_UNUSED,\n                         const char *types G_GNUC_UNUSED,\n                         ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusMessageDecode(DBusMessage* msg G_GNUC_UNUSED,\n                         const char *types G_GNUC_UNUSED,\n                         ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDBusCallMethod",
          "args": [
            "conn",
            "&message",
            "NULL",
            "\"org.freedesktop.login1\"",
            "\"/org/freedesktop/login1\"",
            "\"org.freedesktop.login1.Manager\"",
            "methodName",
            "NULL"
          ],
          "line": 575
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusCallMethod",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1813-1825",
          "snippet": "int virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDBusGetSystemBus",
          "args": [],
          "line": 570
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusGetSystemBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1744-1749",
          "snippet": "DBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nDBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdHasLogind",
          "args": [],
          "line": 567
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdHasLogind",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "172-194",
          "snippet": "int\nvirSystemdHasLogind(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasLogindCachedValue);\n    if (val != -1)\n        return val;\n\n    ret = virDBusIsServiceEnabled(\"org.freedesktop.login1\");\n    if (ret < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasLogindCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.login1\")) == -1)\n        return ret;\n\n    g_atomic_int_set(&virSystemdHasLogindCachedValue, ret);\n    return ret;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int virSystemdHasLogindCachedValue = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int virSystemdHasLogindCachedValue = -1;\n\nint\nvirSystemdHasLogind(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasLogindCachedValue);\n    if (val != -1)\n        return val;\n\n    ret = virDBusIsServiceEnabled(\"org.freedesktop.login1\");\n    if (ret < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasLogindCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.login1\")) == -1)\n        return ret;\n\n    g_atomic_int_set(&virSystemdHasLogindCachedValue, ret);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int\nvirSystemdPMSupportTarget(const char *methodName, bool *result)\n{\n    int ret;\n    DBusConnection *conn;\n    DBusMessage *message = NULL;\n    char *response;\n\n    if ((ret = virSystemdHasLogind()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    if (virDBusCallMethod(conn,\n                          &message,\n                          NULL,\n                          \"org.freedesktop.login1\",\n                          \"/org/freedesktop/login1\",\n                          \"org.freedesktop.login1.Manager\",\n                          methodName,\n                          NULL) < 0)\n        return ret;\n\n    if ((ret = virDBusMessageDecode(message, \"s\", &response)) < 0)\n        goto cleanup;\n\n    *result = STREQ(\"yes\", response) || STREQ(\"challenge\", response);\n\n    ret = 0;\n\n cleanup:\n    virDBusMessageUnref(message);\n    VIR_FREE(response);\n\n    return ret;\n}"
  },
  {
    "function_name": "virSystemdNotifyStartup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "509-557",
    "snippet": "void\nvirSystemdNotifyStartup(void)\n{\n#ifndef WIN32\n    const char *path;\n    const char *msg = \"READY=1\";\n    int fd;\n    struct sockaddr_un un = {\n        .sun_family = AF_UNIX,\n    };\n    struct iovec iov = {\n        .iov_base = (char *)msg,\n        .iov_len = strlen(msg),\n    };\n    struct msghdr mh = {\n        .msg_name = &un,\n        .msg_iov = &iov,\n        .msg_iovlen = 1,\n    };\n\n    if (!(path = getenv(\"NOTIFY_SOCKET\"))) {\n        VIR_DEBUG(\"Skipping systemd notify, not requested\");\n        return;\n    }\n\n    /* NB sun_path field is *not* NUL-terminated, hence >, not >= */\n    if (strlen(path) > sizeof(un.sun_path)) {\n        VIR_WARN(\"Systemd notify socket path '%s' too long\", path);\n        return;\n    }\n\n    memcpy(un.sun_path, path, strlen(path));\n    if (un.sun_path[0] == '@')\n        un.sun_path[0] = '\\0';\n\n    mh.msg_namelen = offsetof(struct sockaddr_un, sun_path) + strlen(path);\n\n    fd = socket(AF_UNIX, SOCK_DGRAM, 0);\n    if (fd < 0) {\n        VIR_WARN(\"Unable to create socket FD\");\n        return;\n    }\n\n    if (sendmsg(fd, &mh, MSG_NOSIGNAL) < 0)\n        VIR_WARN(\"Failed to notify systemd\");\n\n    VIR_FORCE_CLOSE(fd);\n#endif /* !WIN32 */\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "fd"
          ],
          "line": 555
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to notify systemd\""
          ],
          "line": 553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sendmsg",
          "args": [
            "fd",
            "&mh",
            "MSG_NOSIGNAL"
          ],
          "line": 552
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Unable to create socket FD\""
          ],
          "line": 548
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket",
          "args": [
            "AF_UNIX",
            "SOCK_DGRAM",
            "0"
          ],
          "line": 546
        },
        "resolved": true,
        "details": {
          "function_name": "vir_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "351-367",
          "snippet": "int\nvir_socket(int domain, int type, int protocol)\n{\n    SOCKET sk;\n\n    /* We have to use WSASocket() instead of socket(), to create\n     * non-overlapped IO sockets. Overlapped IO sockets cannot\n     * be used with read/write.\n     */\n    sk = WSASocket(domain, type, protocol, NULL, 0, 0);\n    if (sk == INVALID_SOCKET) {\n        set_errno();\n        return -1;\n    }\n\n    return SK2FD(sk);\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_socket(int domain, int type, int protocol)\n{\n    SOCKET sk;\n\n    /* We have to use WSASocket() instead of socket(), to create\n     * non-overlapped IO sockets. Overlapped IO sockets cannot\n     * be used with read/write.\n     */\n    sk = WSASocket(domain, type, protocol, NULL, 0, 0);\n    if (sk == INVALID_SOCKET) {\n        set_errno();\n        return -1;\n    }\n\n    return SK2FD(sk);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "path"
          ],
          "line": 544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "un.sun_path",
            "path",
            "strlen(path)"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "path"
          ],
          "line": 540
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Systemd notify socket path '%s' too long\"",
            "path"
          ],
          "line": 536
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "path"
          ],
          "line": 535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Skipping systemd notify, not requested\""
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "\"NOTIFY_SOCKET\""
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "msg"
          ],
          "line": 521
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nvoid\nvirSystemdNotifyStartup(void)\n{\n#ifndef WIN32\n    const char *path;\n    const char *msg = \"READY=1\";\n    int fd;\n    struct sockaddr_un un = {\n        .sun_family = AF_UNIX,\n    };\n    struct iovec iov = {\n        .iov_base = (char *)msg,\n        .iov_len = strlen(msg),\n    };\n    struct msghdr mh = {\n        .msg_name = &un,\n        .msg_iov = &iov,\n        .msg_iovlen = 1,\n    };\n\n    if (!(path = getenv(\"NOTIFY_SOCKET\"))) {\n        VIR_DEBUG(\"Skipping systemd notify, not requested\");\n        return;\n    }\n\n    /* NB sun_path field is *not* NUL-terminated, hence >, not >= */\n    if (strlen(path) > sizeof(un.sun_path)) {\n        VIR_WARN(\"Systemd notify socket path '%s' too long\", path);\n        return;\n    }\n\n    memcpy(un.sun_path, path, strlen(path));\n    if (un.sun_path[0] == '@')\n        un.sun_path[0] = '\\0';\n\n    mh.msg_namelen = offsetof(struct sockaddr_un, sun_path) + strlen(path);\n\n    fd = socket(AF_UNIX, SOCK_DGRAM, 0);\n    if (fd < 0) {\n        VIR_WARN(\"Unable to create socket FD\");\n        return;\n    }\n\n    if (sendmsg(fd, &mh, MSG_NOSIGNAL) < 0)\n        VIR_WARN(\"Failed to notify systemd\");\n\n    VIR_FORCE_CLOSE(fd);\n#endif /* !WIN32 */\n}"
  },
  {
    "function_name": "virSystemdTerminateMachine",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "453-507",
    "snippet": "int virSystemdTerminateMachine(const char *name)\n{\n    int ret;\n    DBusConnection *conn;\n    virError error;\n\n    if (!name)\n        return 0;\n\n    memset(&error, 0, sizeof(error));\n\n    if ((ret = virSystemdHasMachined()) < 0)\n        goto cleanup;\n\n    ret = -1;\n\n    if (!(conn = virDBusGetSystemBus()))\n        goto cleanup;\n\n    /*\n     * The systemd DBus API we're invoking has the\n     * following signature\n     *\n     * TerminateMachine(in  s name);\n     *\n     * @name a host unique name for the machine. shows up\n     * in 'ps' listing & similar\n     */\n\n    VIR_DEBUG(\"Attempting to terminate machine via systemd\");\n    if (virDBusCallMethod(conn,\n                          NULL,\n                          &error,\n                          \"org.freedesktop.machine1\",\n                          \"/org/freedesktop/machine1\",\n                          \"org.freedesktop.machine1.Manager\",\n                          \"TerminateMachine\",\n                          \"s\",\n                          name) < 0)\n        goto cleanup;\n\n    if (error.level == VIR_ERR_ERROR &&\n        STRNEQ_NULLABLE(\"org.freedesktop.machine1.NoSuchMachine\",\n                        error.str1)) {\n        virReportErrorObject(&error);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    virResetError(&error);\n\n    return ret;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virResetError",
          "args": [
            "&error"
          ],
          "line": 504
        },
        "resolved": true,
        "details": {
          "function_name": "virResetError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "466-476",
          "snippet": "void\nvirResetError(virErrorPtr err)\n{\n    if (err == NULL)\n        return;\n    VIR_FREE(err->message);\n    VIR_FREE(err->str1);\n    VIR_FREE(err->str2);\n    VIR_FREE(err->str3);\n    memset(err, 0, sizeof(virError));\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetError(virErrorPtr err)\n{\n    if (err == NULL)\n        return;\n    VIR_FREE(err->message);\n    VIR_FREE(err->str1);\n    VIR_FREE(err->str2);\n    VIR_FREE(err->str3);\n    memset(err, 0, sizeof(virError));\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportErrorObject",
          "args": [
            "&error"
          ],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ_NULLABLE",
          "args": [
            "\"org.freedesktop.machine1.NoSuchMachine\"",
            "error.str1"
          ],
          "line": 495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusCallMethod",
          "args": [
            "conn",
            "NULL",
            "&error",
            "\"org.freedesktop.machine1\"",
            "\"/org/freedesktop/machine1\"",
            "\"org.freedesktop.machine1.Manager\"",
            "\"TerminateMachine\"",
            "\"s\"",
            "name"
          ],
          "line": 483
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusCallMethod",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1813-1825",
          "snippet": "int virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Attempting to terminate machine via systemd\""
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusGetSystemBus",
          "args": [],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusGetSystemBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1744-1749",
          "snippet": "DBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nDBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdHasMachined",
          "args": [],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdHasMachined",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "150-170",
          "snippet": "static int\nvirSystemdHasMachined(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasMachinedCachedValue);\n    if (val != -1)\n        return val;\n\n    if ((ret = virDBusIsServiceEnabled(\"org.freedesktop.machine1\")) < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasMachinedCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.systemd1\")) == -1)\n        return ret;\n    g_atomic_int_set(&virSystemdHasMachinedCachedValue, ret);\n    return ret;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int virSystemdHasMachinedCachedValue = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int virSystemdHasMachinedCachedValue = -1;\n\nstatic int\nvirSystemdHasMachined(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasMachinedCachedValue);\n    if (val != -1)\n        return val;\n\n    if ((ret = virDBusIsServiceEnabled(\"org.freedesktop.machine1\")) < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasMachinedCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.systemd1\")) == -1)\n        return ret;\n    g_atomic_int_set(&virSystemdHasMachinedCachedValue, ret);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&error",
            "0",
            "sizeof(error)"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint virSystemdTerminateMachine(const char *name)\n{\n    int ret;\n    DBusConnection *conn;\n    virError error;\n\n    if (!name)\n        return 0;\n\n    memset(&error, 0, sizeof(error));\n\n    if ((ret = virSystemdHasMachined()) < 0)\n        goto cleanup;\n\n    ret = -1;\n\n    if (!(conn = virDBusGetSystemBus()))\n        goto cleanup;\n\n    /*\n     * The systemd DBus API we're invoking has the\n     * following signature\n     *\n     * TerminateMachine(in  s name);\n     *\n     * @name a host unique name for the machine. shows up\n     * in 'ps' listing & similar\n     */\n\n    VIR_DEBUG(\"Attempting to terminate machine via systemd\");\n    if (virDBusCallMethod(conn,\n                          NULL,\n                          &error,\n                          \"org.freedesktop.machine1\",\n                          \"/org/freedesktop/machine1\",\n                          \"org.freedesktop.machine1.Manager\",\n                          \"TerminateMachine\",\n                          \"s\",\n                          name) < 0)\n        goto cleanup;\n\n    if (error.level == VIR_ERR_ERROR &&\n        STRNEQ_NULLABLE(\"org.freedesktop.machine1.NoSuchMachine\",\n                        error.str1)) {\n        virReportErrorObject(&error);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    virResetError(&error);\n\n    return ret;\n}"
  },
  {
    "function_name": "virSystemdCreateMachine",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "266-451",
    "snippet": "int virSystemdCreateMachine(const char *name,\n                            const char *drivername,\n                            const unsigned char *uuid,\n                            const char *rootdir,\n                            pid_t pidleader,\n                            bool iscontainer,\n                            size_t nnicindexes,\n                            int *nicindexes,\n                            const char *partition,\n                            unsigned int maxthreads)\n{\n    int ret;\n    DBusConnection *conn;\n    char *creatorname = NULL;\n    char *slicename = NULL;\n    char *scopename = NULL;\n    static int hasCreateWithNetwork = 1;\n\n    if ((ret = virSystemdHasMachined()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    creatorname = g_strdup_printf(\"libvirt-%s\", drivername);\n\n    if (partition) {\n        if (!(slicename = virSystemdMakeSliceName(partition)))\n             goto cleanup;\n    } else {\n        slicename = g_strdup(\"\");\n    }\n\n    /*\n     * The systemd DBus APIs we're invoking have the\n     * following signature(s)\n     *\n     * CreateMachineWithNetwork(in  s name,\n     *                          in  ay id,\n     *                          in  s service,\n     *                          in  s class,\n     *                          in  u leader,\n     *                          in  s root_directory,\n     *                          in  ai nicindexes\n     *                          in  a(sv) scope_properties,\n     *                          out o path);\n     *\n     * CreateMachine(in  s name,\n     *               in  ay id,\n     *               in  s service,\n     *               in  s class,\n     *               in  u leader,\n     *               in  s root_directory,\n     *               in  a(sv) scope_properties,\n     *               out o path);\n     *\n     * @name a host unique name for the machine. shows up\n     * in 'ps' listing & similar\n     *\n     * @id: a UUID of the machine, ideally matching /etc/machine-id\n     * for containers\n     *\n     * @service: identifier of the client ie \"libvirt-lxc\"\n     *\n     * @class: either the string \"container\" or \"vm\" depending\n     * on the type of machine\n     *\n     * @leader: main PID of the machine, either the host emulator\n     * process, or the 'init' PID of the container\n     *\n     * @root_directory: the root directory of the container, if\n     * this is known & visible in the host filesystem, or empty string\n     *\n     * @nicindexes: list of network interface indexes for the\n     * host end of the VETH device pairs.\n     *\n     * @scope_properties:an array (not a dict!) of properties that are\n     * passed on to PID 1 when creating a scope unit for your machine.\n     * Will allow initial settings for the cgroup & similar.\n     *\n     * @path: a bus path returned for the machine object created, to\n     * allow further API calls to be made against the object.\n     *\n     */\n\n    VIR_DEBUG(\"Attempting to create machine via systemd\");\n    if (g_atomic_int_get(&hasCreateWithNetwork)) {\n        virError error;\n        memset(&error, 0, sizeof(error));\n\n        if (virDBusCallMethod(conn,\n                              NULL,\n                              &error,\n                              \"org.freedesktop.machine1\",\n                              \"/org/freedesktop/machine1\",\n                              \"org.freedesktop.machine1.Manager\",\n                              \"CreateMachineWithNetwork\",\n                              \"sayssusa&ia(sv)\",\n                              name,\n                              16,\n                              uuid[0], uuid[1], uuid[2], uuid[3],\n                              uuid[4], uuid[5], uuid[6], uuid[7],\n                              uuid[8], uuid[9], uuid[10], uuid[11],\n                              uuid[12], uuid[13], uuid[14], uuid[15],\n                              creatorname,\n                              iscontainer ? \"container\" : \"vm\",\n                              (unsigned int)pidleader,\n                              NULLSTR_EMPTY(rootdir),\n                              nnicindexes, nicindexes,\n                              3,\n                              \"Slice\", \"s\", slicename,\n                              \"After\", \"as\", 1, \"libvirtd.service\",\n                              \"Before\", \"as\", 1, \"virt-guest-shutdown.target\") < 0)\n            goto cleanup;\n\n        if (error.level == VIR_ERR_ERROR) {\n            if (virDBusErrorIsUnknownMethod(&error)) {\n                VIR_INFO(\"CreateMachineWithNetwork isn't supported, switching \"\n                         \"to legacy CreateMachine method for systemd-machined\");\n                virResetError(&error);\n                g_atomic_int_set(&hasCreateWithNetwork, 0);\n                /* Could re-structure without Using goto, but this\n                 * avoids another atomic read which would trigger\n                 * another memory barrier */\n                goto fallback;\n            }\n            virReportErrorObject(&error);\n            virResetError(&error);\n            goto cleanup;\n        }\n    } else {\n    fallback:\n        if (virDBusCallMethod(conn,\n                              NULL,\n                              NULL,\n                              \"org.freedesktop.machine1\",\n                              \"/org/freedesktop/machine1\",\n                              \"org.freedesktop.machine1.Manager\",\n                              \"CreateMachine\",\n                              \"sayssusa(sv)\",\n                              name,\n                              16,\n                              uuid[0], uuid[1], uuid[2], uuid[3],\n                              uuid[4], uuid[5], uuid[6], uuid[7],\n                              uuid[8], uuid[9], uuid[10], uuid[11],\n                              uuid[12], uuid[13], uuid[14], uuid[15],\n                              creatorname,\n                              iscontainer ? \"container\" : \"vm\",\n                              (unsigned int)pidleader,\n                              NULLSTR_EMPTY(rootdir),\n                              3,\n                              \"Slice\", \"s\", slicename,\n                              \"After\", \"as\", 1, \"libvirtd.service\",\n                              \"Before\", \"as\", 1, \"virt-guest-shutdown.target\") < 0)\n            goto cleanup;\n    }\n\n    if (maxthreads > 0) {\n        if (!(scopename = virSystemdMakeScopeName(name, drivername, false)))\n            goto cleanup;\n\n        if (virDBusCallMethod(conn,\n                              NULL,\n                              NULL,\n                              \"org.freedesktop.systemd1\",\n                              \"/org/freedesktop/systemd1\",\n                              \"org.freedesktop.systemd1.Manager\",\n                              \"SetUnitProperties\",\n                              \"sba(sv)\",\n                              scopename,\n                              true,\n                              1,\n                              \"TasksMax\", \"t\", (uint64_t)maxthreads) < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(creatorname);\n    VIR_FREE(slicename);\n    VIR_FREE(scopename);\n    return ret;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "scopename"
          ],
          "line": 449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "slicename"
          ],
          "line": 448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "creatorname"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusCallMethod",
          "args": [
            "conn",
            "NULL",
            "NULL",
            "\"org.freedesktop.systemd1\"",
            "\"/org/freedesktop/systemd1\"",
            "\"org.freedesktop.systemd1.Manager\"",
            "\"SetUnitProperties\"",
            "\"sba(sv)\"",
            "scopename",
            "true",
            "1",
            "\"TasksMax\"",
            "\"t\"",
            "(uint64_t)maxthreads"
          ],
          "line": 429
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusCallMethod",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1813-1825",
          "snippet": "int virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdMakeScopeName",
          "args": [
            "name",
            "drivername",
            "false"
          ],
          "line": 426
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdMakeScopeName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "99-114",
          "snippet": "char *virSystemdMakeScopeName(const char *name,\n                              const char *drivername,\n                              bool legacy_behaviour)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virBufferAddLit(&buf, \"machine-\");\n    if (legacy_behaviour) {\n        virSystemdEscapeName(&buf, drivername);\n        virBufferAddLit(&buf, \"\\\\x2d\");\n    }\n    virSystemdEscapeName(&buf, name);\n    virBufferAddLit(&buf, \".scope\");\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nchar *virSystemdMakeScopeName(const char *name,\n                              const char *drivername,\n                              bool legacy_behaviour)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virBufferAddLit(&buf, \"machine-\");\n    if (legacy_behaviour) {\n        virSystemdEscapeName(&buf, drivername);\n        virBufferAddLit(&buf, \"\\\\x2d\");\n    }\n    virSystemdEscapeName(&buf, name);\n    virBufferAddLit(&buf, \".scope\");\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "NULLSTR_EMPTY",
          "args": [
            "rootdir"
          ],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetError",
          "args": [
            "&error"
          ],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "virResetError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "466-476",
          "snippet": "void\nvirResetError(virErrorPtr err)\n{\n    if (err == NULL)\n        return;\n    VIR_FREE(err->message);\n    VIR_FREE(err->str1);\n    VIR_FREE(err->str2);\n    VIR_FREE(err->str3);\n    memset(err, 0, sizeof(virError));\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetError(virErrorPtr err)\n{\n    if (err == NULL)\n        return;\n    VIR_FREE(err->message);\n    VIR_FREE(err->str1);\n    VIR_FREE(err->str2);\n    VIR_FREE(err->str3);\n    memset(err, 0, sizeof(virError));\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportErrorObject",
          "args": [
            "&error"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_set",
          "args": [
            "&hasCreateWithNetwork",
            "0"
          ],
          "line": 388
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"CreateMachineWithNetwork isn't supported, switching \"\n                         \"to legacy CreateMachine method for systemd-machined\""
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusErrorIsUnknownMethod",
          "args": [
            "&error"
          ],
          "line": 384
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusErrorIsUnknownMethod",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1864-1871",
          "snippet": "bool virDBusErrorIsUnknownMethod(virErrorPtr err)\n{\n    return err->domain == VIR_FROM_DBUS &&\n        err->code == VIR_ERR_DBUS_SERVICE &&\n        err->level == VIR_ERR_ERROR &&\n        STREQ_NULLABLE(\"org.freedesktop.DBus.Error.UnknownMethod\",\n                       err->str1);\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nbool virDBusErrorIsUnknownMethod(virErrorPtr err)\n{\n    return err->domain == VIR_FROM_DBUS &&\n        err->code == VIR_ERR_DBUS_SERVICE &&\n        err->level == VIR_ERR_ERROR &&\n        STREQ_NULLABLE(\"org.freedesktop.DBus.Error.UnknownMethod\",\n                       err->str1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "NULLSTR_EMPTY",
          "args": [
            "rootdir"
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&error",
            "0",
            "sizeof(error)"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&hasCreateWithNetwork"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Attempting to create machine via systemd\""
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "\"\""
          ],
          "line": 298
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdMakeSliceName",
          "args": [
            "partition"
          ],
          "line": 295
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdMakeSliceName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "117-128",
          "snippet": "char *virSystemdMakeSliceName(const char *partition)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    if (*partition == '/')\n        partition++;\n\n    virSystemdEscapeName(&buf, partition);\n    virBufferAddLit(&buf, \".slice\");\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nchar *virSystemdMakeSliceName(const char *partition)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    if (*partition == '/')\n        partition++;\n\n    virSystemdEscapeName(&buf, partition);\n    virBufferAddLit(&buf, \".slice\");\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDBusGetSystemBus",
          "args": [],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusGetSystemBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1744-1749",
          "snippet": "DBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nDBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdHasMachined",
          "args": [],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdHasMachined",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "150-170",
          "snippet": "static int\nvirSystemdHasMachined(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasMachinedCachedValue);\n    if (val != -1)\n        return val;\n\n    if ((ret = virDBusIsServiceEnabled(\"org.freedesktop.machine1\")) < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasMachinedCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.systemd1\")) == -1)\n        return ret;\n    g_atomic_int_set(&virSystemdHasMachinedCachedValue, ret);\n    return ret;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int virSystemdHasMachinedCachedValue = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int virSystemdHasMachinedCachedValue = -1;\n\nstatic int\nvirSystemdHasMachined(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasMachinedCachedValue);\n    if (val != -1)\n        return val;\n\n    if ((ret = virDBusIsServiceEnabled(\"org.freedesktop.machine1\")) < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasMachinedCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.systemd1\")) == -1)\n        return ret;\n    g_atomic_int_set(&virSystemdHasMachinedCachedValue, ret);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint virSystemdCreateMachine(const char *name,\n                            const char *drivername,\n                            const unsigned char *uuid,\n                            const char *rootdir,\n                            pid_t pidleader,\n                            bool iscontainer,\n                            size_t nnicindexes,\n                            int *nicindexes,\n                            const char *partition,\n                            unsigned int maxthreads)\n{\n    int ret;\n    DBusConnection *conn;\n    char *creatorname = NULL;\n    char *slicename = NULL;\n    char *scopename = NULL;\n    static int hasCreateWithNetwork = 1;\n\n    if ((ret = virSystemdHasMachined()) < 0)\n        return ret;\n\n    if (!(conn = virDBusGetSystemBus()))\n        return -1;\n\n    ret = -1;\n\n    creatorname = g_strdup_printf(\"libvirt-%s\", drivername);\n\n    if (partition) {\n        if (!(slicename = virSystemdMakeSliceName(partition)))\n             goto cleanup;\n    } else {\n        slicename = g_strdup(\"\");\n    }\n\n    /*\n     * The systemd DBus APIs we're invoking have the\n     * following signature(s)\n     *\n     * CreateMachineWithNetwork(in  s name,\n     *                          in  ay id,\n     *                          in  s service,\n     *                          in  s class,\n     *                          in  u leader,\n     *                          in  s root_directory,\n     *                          in  ai nicindexes\n     *                          in  a(sv) scope_properties,\n     *                          out o path);\n     *\n     * CreateMachine(in  s name,\n     *               in  ay id,\n     *               in  s service,\n     *               in  s class,\n     *               in  u leader,\n     *               in  s root_directory,\n     *               in  a(sv) scope_properties,\n     *               out o path);\n     *\n     * @name a host unique name for the machine. shows up\n     * in 'ps' listing & similar\n     *\n     * @id: a UUID of the machine, ideally matching /etc/machine-id\n     * for containers\n     *\n     * @service: identifier of the client ie \"libvirt-lxc\"\n     *\n     * @class: either the string \"container\" or \"vm\" depending\n     * on the type of machine\n     *\n     * @leader: main PID of the machine, either the host emulator\n     * process, or the 'init' PID of the container\n     *\n     * @root_directory: the root directory of the container, if\n     * this is known & visible in the host filesystem, or empty string\n     *\n     * @nicindexes: list of network interface indexes for the\n     * host end of the VETH device pairs.\n     *\n     * @scope_properties:an array (not a dict!) of properties that are\n     * passed on to PID 1 when creating a scope unit for your machine.\n     * Will allow initial settings for the cgroup & similar.\n     *\n     * @path: a bus path returned for the machine object created, to\n     * allow further API calls to be made against the object.\n     *\n     */\n\n    VIR_DEBUG(\"Attempting to create machine via systemd\");\n    if (g_atomic_int_get(&hasCreateWithNetwork)) {\n        virError error;\n        memset(&error, 0, sizeof(error));\n\n        if (virDBusCallMethod(conn,\n                              NULL,\n                              &error,\n                              \"org.freedesktop.machine1\",\n                              \"/org/freedesktop/machine1\",\n                              \"org.freedesktop.machine1.Manager\",\n                              \"CreateMachineWithNetwork\",\n                              \"sayssusa&ia(sv)\",\n                              name,\n                              16,\n                              uuid[0], uuid[1], uuid[2], uuid[3],\n                              uuid[4], uuid[5], uuid[6], uuid[7],\n                              uuid[8], uuid[9], uuid[10], uuid[11],\n                              uuid[12], uuid[13], uuid[14], uuid[15],\n                              creatorname,\n                              iscontainer ? \"container\" : \"vm\",\n                              (unsigned int)pidleader,\n                              NULLSTR_EMPTY(rootdir),\n                              nnicindexes, nicindexes,\n                              3,\n                              \"Slice\", \"s\", slicename,\n                              \"After\", \"as\", 1, \"libvirtd.service\",\n                              \"Before\", \"as\", 1, \"virt-guest-shutdown.target\") < 0)\n            goto cleanup;\n\n        if (error.level == VIR_ERR_ERROR) {\n            if (virDBusErrorIsUnknownMethod(&error)) {\n                VIR_INFO(\"CreateMachineWithNetwork isn't supported, switching \"\n                         \"to legacy CreateMachine method for systemd-machined\");\n                virResetError(&error);\n                g_atomic_int_set(&hasCreateWithNetwork, 0);\n                /* Could re-structure without Using goto, but this\n                 * avoids another atomic read which would trigger\n                 * another memory barrier */\n                goto fallback;\n            }\n            virReportErrorObject(&error);\n            virResetError(&error);\n            goto cleanup;\n        }\n    } else {\n    fallback:\n        if (virDBusCallMethod(conn,\n                              NULL,\n                              NULL,\n                              \"org.freedesktop.machine1\",\n                              \"/org/freedesktop/machine1\",\n                              \"org.freedesktop.machine1.Manager\",\n                              \"CreateMachine\",\n                              \"sayssusa(sv)\",\n                              name,\n                              16,\n                              uuid[0], uuid[1], uuid[2], uuid[3],\n                              uuid[4], uuid[5], uuid[6], uuid[7],\n                              uuid[8], uuid[9], uuid[10], uuid[11],\n                              uuid[12], uuid[13], uuid[14], uuid[15],\n                              creatorname,\n                              iscontainer ? \"container\" : \"vm\",\n                              (unsigned int)pidleader,\n                              NULLSTR_EMPTY(rootdir),\n                              3,\n                              \"Slice\", \"s\", slicename,\n                              \"After\", \"as\", 1, \"libvirtd.service\",\n                              \"Before\", \"as\", 1, \"virt-guest-shutdown.target\") < 0)\n            goto cleanup;\n    }\n\n    if (maxthreads > 0) {\n        if (!(scopename = virSystemdMakeScopeName(name, drivername, false)))\n            goto cleanup;\n\n        if (virDBusCallMethod(conn,\n                              NULL,\n                              NULL,\n                              \"org.freedesktop.systemd1\",\n                              \"/org/freedesktop/systemd1\",\n                              \"org.freedesktop.systemd1.Manager\",\n                              \"SetUnitProperties\",\n                              \"sba(sv)\",\n                              scopename,\n                              true,\n                              1,\n                              \"TasksMax\", \"t\", (uint64_t)maxthreads) < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(creatorname);\n    VIR_FREE(slicename);\n    VIR_FREE(scopename);\n    return ret;\n}"
  },
  {
    "function_name": "virSystemdGetMachineNameByPID",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "197-248",
    "snippet": "char *\nvirSystemdGetMachineNameByPID(pid_t pid)\n{\n    DBusConnection *conn;\n    DBusMessage *reply = NULL;\n    char *name = NULL, *object = NULL;\n\n    if (virSystemdHasMachined() < 0)\n        goto cleanup;\n\n    if (!(conn = virDBusGetSystemBus()))\n        goto cleanup;\n\n    if (virDBusCallMethod(conn, &reply, NULL,\n                          \"org.freedesktop.machine1\",\n                          \"/org/freedesktop/machine1\",\n                          \"org.freedesktop.machine1.Manager\",\n                          \"GetMachineByPID\",\n                          \"u\", pid) < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply, \"o\", &object) < 0)\n        goto cleanup;\n\n    virDBusMessageUnref(reply);\n    reply = NULL;\n\n    VIR_DEBUG(\"Domain with pid %lld has object path '%s'\",\n              (long long) pid, object);\n\n    if (virDBusCallMethod(conn, &reply, NULL,\n                          \"org.freedesktop.machine1\",\n                          object,\n                          \"org.freedesktop.DBus.Properties\",\n                          \"Get\",\n                          \"ss\",\n                          \"org.freedesktop.machine1.Machine\",\n                          \"Name\") < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply, \"v\", \"s\", &name) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Domain with pid %lld has machine name '%s'\",\n              (long long) pid, name);\n\n cleanup:\n    VIR_FREE(object);\n    virDBusMessageUnref(reply);\n\n    return name;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDBusMessageUnref",
          "args": [
            "reply"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusMessageUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1858-1861",
          "snippet": "void virDBusMessageUnref(DBusMessage *msg G_GNUC_UNUSED)\n{\n    /* nothing */\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nvoid virDBusMessageUnref(DBusMessage *msg G_GNUC_UNUSED)\n{\n    /* nothing */\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "object"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Domain with pid %lld has machine name '%s'\"",
            "(long long) pid",
            "name"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusMessageDecode",
          "args": [
            "reply",
            "\"v\"",
            "\"s\"",
            "&name"
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusMessageDecode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1837-1844",
          "snippet": "int virDBusMessageDecode(DBusMessage* msg G_GNUC_UNUSED,\n                         const char *types G_GNUC_UNUSED,\n                         ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusMessageDecode(DBusMessage* msg G_GNUC_UNUSED,\n                         const char *types G_GNUC_UNUSED,\n                         ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDBusCallMethod",
          "args": [
            "conn",
            "&reply",
            "NULL",
            "\"org.freedesktop.machine1\"",
            "object",
            "\"org.freedesktop.DBus.Properties\"",
            "\"Get\"",
            "\"ss\"",
            "\"org.freedesktop.machine1.Machine\"",
            "\"Name\""
          ],
          "line": 227
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusCallMethod",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1813-1825",
          "snippet": "int virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusCallMethod(DBusConnection *conn G_GNUC_UNUSED,\n                      DBusMessage **reply G_GNUC_UNUSED,\n                      virErrorPtr error G_GNUC_UNUSED,\n                      const char *destination G_GNUC_UNUSED,\n                      const char *path G_GNUC_UNUSED,\n                      const char *iface G_GNUC_UNUSED,\n                      const char *member G_GNUC_UNUSED,\n                      const char *types G_GNUC_UNUSED, ...)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Domain with pid %lld has object path '%s'\"",
            "(long long) pid",
            "object"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusGetSystemBus",
          "args": [],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusGetSystemBus",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1744-1749",
          "snippet": "DBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nDBusConnection *virDBusGetSystemBus(void)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"DBus support not compiled into this binary\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdHasMachined",
          "args": [],
          "line": 204
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdHasMachined",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "150-170",
          "snippet": "static int\nvirSystemdHasMachined(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasMachinedCachedValue);\n    if (val != -1)\n        return val;\n\n    if ((ret = virDBusIsServiceEnabled(\"org.freedesktop.machine1\")) < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasMachinedCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.systemd1\")) == -1)\n        return ret;\n    g_atomic_int_set(&virSystemdHasMachinedCachedValue, ret);\n    return ret;\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int virSystemdHasMachinedCachedValue = -1;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int virSystemdHasMachinedCachedValue = -1;\n\nstatic int\nvirSystemdHasMachined(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasMachinedCachedValue);\n    if (val != -1)\n        return val;\n\n    if ((ret = virDBusIsServiceEnabled(\"org.freedesktop.machine1\")) < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasMachinedCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.systemd1\")) == -1)\n        return ret;\n    g_atomic_int_set(&virSystemdHasMachinedCachedValue, ret);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nchar *\nvirSystemdGetMachineNameByPID(pid_t pid)\n{\n    DBusConnection *conn;\n    DBusMessage *reply = NULL;\n    char *name = NULL, *object = NULL;\n\n    if (virSystemdHasMachined() < 0)\n        goto cleanup;\n\n    if (!(conn = virDBusGetSystemBus()))\n        goto cleanup;\n\n    if (virDBusCallMethod(conn, &reply, NULL,\n                          \"org.freedesktop.machine1\",\n                          \"/org/freedesktop/machine1\",\n                          \"org.freedesktop.machine1.Manager\",\n                          \"GetMachineByPID\",\n                          \"u\", pid) < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply, \"o\", &object) < 0)\n        goto cleanup;\n\n    virDBusMessageUnref(reply);\n    reply = NULL;\n\n    VIR_DEBUG(\"Domain with pid %lld has object path '%s'\",\n              (long long) pid, object);\n\n    if (virDBusCallMethod(conn, &reply, NULL,\n                          \"org.freedesktop.machine1\",\n                          object,\n                          \"org.freedesktop.DBus.Properties\",\n                          \"Get\",\n                          \"ss\",\n                          \"org.freedesktop.machine1.Machine\",\n                          \"Name\") < 0)\n        goto cleanup;\n\n    if (virDBusMessageDecode(reply, \"v\", \"s\", &name) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Domain with pid %lld has machine name '%s'\",\n              (long long) pid, name);\n\n cleanup:\n    VIR_FREE(object);\n    virDBusMessageUnref(reply);\n\n    return name;\n}"
  },
  {
    "function_name": "virSystemdHasLogind",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "172-194",
    "snippet": "int\nvirSystemdHasLogind(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasLogindCachedValue);\n    if (val != -1)\n        return val;\n\n    ret = virDBusIsServiceEnabled(\"org.freedesktop.login1\");\n    if (ret < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasLogindCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.login1\")) == -1)\n        return ret;\n\n    g_atomic_int_set(&virSystemdHasLogindCachedValue, ret);\n    return ret;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virSystemdHasLogindCachedValue = -1;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_atomic_int_set",
          "args": [
            "&virSystemdHasLogindCachedValue",
            "ret"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusIsServiceRegistered",
          "args": [
            "\"org.freedesktop.login1\""
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusIsServiceRegistered",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1852-1856",
          "snippet": "int virDBusIsServiceRegistered(const char *name G_GNUC_UNUSED)\n{\n    VIR_DEBUG(\"DBus support not compiled into this binary\");\n    return -2;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusIsServiceRegistered(const char *name G_GNUC_UNUSED)\n{\n    VIR_DEBUG(\"DBus support not compiled into this binary\");\n    return -2;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_set",
          "args": [
            "&virSystemdHasLogindCachedValue",
            "-2"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusIsServiceEnabled",
          "args": [
            "\"org.freedesktop.login1\""
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusIsServiceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1846-1850",
          "snippet": "int virDBusIsServiceEnabled(const char *name G_GNUC_UNUSED)\n{\n    VIR_DEBUG(\"DBus support not compiled into this binary\");\n    return -2;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusIsServiceEnabled(const char *name G_GNUC_UNUSED)\n{\n    VIR_DEBUG(\"DBus support not compiled into this binary\");\n    return -2;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&virSystemdHasLogindCachedValue"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int virSystemdHasLogindCachedValue = -1;\n\nint\nvirSystemdHasLogind(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasLogindCachedValue);\n    if (val != -1)\n        return val;\n\n    ret = virDBusIsServiceEnabled(\"org.freedesktop.login1\");\n    if (ret < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasLogindCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.login1\")) == -1)\n        return ret;\n\n    g_atomic_int_set(&virSystemdHasLogindCachedValue, ret);\n    return ret;\n}"
  },
  {
    "function_name": "virSystemdHasMachined",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "150-170",
    "snippet": "static int\nvirSystemdHasMachined(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasMachinedCachedValue);\n    if (val != -1)\n        return val;\n\n    if ((ret = virDBusIsServiceEnabled(\"org.freedesktop.machine1\")) < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasMachinedCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.systemd1\")) == -1)\n        return ret;\n    g_atomic_int_set(&virSystemdHasMachinedCachedValue, ret);\n    return ret;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virSystemdHasMachinedCachedValue = -1;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_atomic_int_set",
          "args": [
            "&virSystemdHasMachinedCachedValue",
            "ret"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusIsServiceRegistered",
          "args": [
            "\"org.freedesktop.systemd1\""
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusIsServiceRegistered",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1852-1856",
          "snippet": "int virDBusIsServiceRegistered(const char *name G_GNUC_UNUSED)\n{\n    VIR_DEBUG(\"DBus support not compiled into this binary\");\n    return -2;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusIsServiceRegistered(const char *name G_GNUC_UNUSED)\n{\n    VIR_DEBUG(\"DBus support not compiled into this binary\");\n    return -2;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_set",
          "args": [
            "&virSystemdHasMachinedCachedValue",
            "-2"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDBusIsServiceEnabled",
          "args": [
            "\"org.freedesktop.machine1\""
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "virDBusIsServiceEnabled",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virdbus.c",
          "lines": "1846-1850",
          "snippet": "int virDBusIsServiceEnabled(const char *name G_GNUC_UNUSED)\n{\n    VIR_DEBUG(\"DBus support not compiled into this binary\");\n    return -2;\n}",
          "includes": [
            "#include \"virprobe.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virdbuspriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprobe.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virdbuspriv.h\"\n#include <config.h>\n\nint virDBusIsServiceEnabled(const char *name G_GNUC_UNUSED)\n{\n    VIR_DEBUG(\"DBus support not compiled into this binary\");\n    return -2;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_atomic_int_get",
          "args": [
            "&virSystemdHasMachinedCachedValue"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int virSystemdHasMachinedCachedValue = -1;\n\nstatic int\nvirSystemdHasMachined(void)\n{\n    int ret;\n    int val;\n\n    val = g_atomic_int_get(&virSystemdHasMachinedCachedValue);\n    if (val != -1)\n        return val;\n\n    if ((ret = virDBusIsServiceEnabled(\"org.freedesktop.machine1\")) < 0) {\n        if (ret == -2)\n            g_atomic_int_set(&virSystemdHasMachinedCachedValue, -2);\n        return ret;\n    }\n\n    if ((ret = virDBusIsServiceRegistered(\"org.freedesktop.systemd1\")) == -1)\n        return ret;\n    g_atomic_int_set(&virSystemdHasMachinedCachedValue, ret);\n    return ret;\n}"
  },
  {
    "function_name": "virSystemdHasLogindResetCachedValue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "140-143",
    "snippet": "void virSystemdHasLogindResetCachedValue(void)\n{\n    virSystemdHasLogindCachedValue = -1;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virSystemdHasLogindCachedValue = -1;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int virSystemdHasLogindCachedValue = -1;\n\nvoid virSystemdHasLogindResetCachedValue(void)\n{\n    virSystemdHasLogindCachedValue = -1;\n}"
  },
  {
    "function_name": "virSystemdHasMachinedResetCachedValue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "135-138",
    "snippet": "void virSystemdHasMachinedResetCachedValue(void)\n{\n    virSystemdHasMachinedCachedValue = -1;\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virSystemdHasMachinedCachedValue = -1;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nstatic int virSystemdHasMachinedCachedValue = -1;\n\nvoid virSystemdHasMachinedResetCachedValue(void)\n{\n    virSystemdHasMachinedCachedValue = -1;\n}"
  },
  {
    "function_name": "virSystemdMakeSliceName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "117-128",
    "snippet": "char *virSystemdMakeSliceName(const char *partition)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    if (*partition == '/')\n        partition++;\n\n    virSystemdEscapeName(&buf, partition);\n    virBufferAddLit(&buf, \".slice\");\n\n    return virBufferContentAndReset(&buf);\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferContentAndReset",
          "args": [
            "&buf"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferContentAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "247-260",
          "snippet": "char *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "&buf",
            "\".slice\""
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSystemdEscapeName",
          "args": [
            "&buf",
            "partition"
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdEscapeName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "59-97",
          "snippet": "static void virSystemdEscapeName(virBufferPtr buf,\n                                 const char *name)\n{\n    static const char hextable[16] = \"0123456789abcdef\";\n\n#define ESCAPE(c) \\\n    do { \\\n        virBufferAddChar(buf, '\\\\'); \\\n        virBufferAddChar(buf, 'x'); \\\n        virBufferAddChar(buf, hextable[(c >> 4) & 15]); \\\n        virBufferAddChar(buf, hextable[c & 15]); \\\n    } while (0)\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\n    if (*name == '.') {\n        ESCAPE(*name);\n        name++;\n    }\n\n    while (*name) {\n        if (*name == '/')\n            virBufferAddChar(buf, '-');\n        else if (*name == '-' ||\n                 *name == '\\\\' ||\n                 !strchr(VALID_CHARS, *name))\n            ESCAPE(*name);\n        else\n            virBufferAddChar(buf, *name);\n        name++;\n    }\n\n#undef ESCAPE\n#undef VALID_CHARS\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\nstatic void virSystemdEscapeName(virBufferPtr buf,\n                                 const char *name)\n{\n    static const char hextable[16] = \"0123456789abcdef\";\n\n#define ESCAPE(c) \\\n    do { \\\n        virBufferAddChar(buf, '\\\\'); \\\n        virBufferAddChar(buf, 'x'); \\\n        virBufferAddChar(buf, hextable[(c >> 4) & 15]); \\\n        virBufferAddChar(buf, hextable[c & 15]); \\\n    } while (0)\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\n    if (*name == '.') {\n        ESCAPE(*name);\n        name++;\n    }\n\n    while (*name) {\n        if (*name == '/')\n            virBufferAddChar(buf, '-');\n        else if (*name == '-' ||\n                 *name == '\\\\' ||\n                 !strchr(VALID_CHARS, *name))\n            ESCAPE(*name);\n        else\n            virBufferAddChar(buf, *name);\n        name++;\n    }\n\n#undef ESCAPE\n#undef VALID_CHARS\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nchar *virSystemdMakeSliceName(const char *partition)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    if (*partition == '/')\n        partition++;\n\n    virSystemdEscapeName(&buf, partition);\n    virBufferAddLit(&buf, \".slice\");\n\n    return virBufferContentAndReset(&buf);\n}"
  },
  {
    "function_name": "virSystemdMakeScopeName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "99-114",
    "snippet": "char *virSystemdMakeScopeName(const char *name,\n                              const char *drivername,\n                              bool legacy_behaviour)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virBufferAddLit(&buf, \"machine-\");\n    if (legacy_behaviour) {\n        virSystemdEscapeName(&buf, drivername);\n        virBufferAddLit(&buf, \"\\\\x2d\");\n    }\n    virSystemdEscapeName(&buf, name);\n    virBufferAddLit(&buf, \".scope\");\n\n    return virBufferContentAndReset(&buf);\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferContentAndReset",
          "args": [
            "&buf"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferContentAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "247-260",
          "snippet": "char *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "&buf",
            "\".scope\""
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSystemdEscapeName",
          "args": [
            "&buf",
            "name"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdEscapeName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "59-97",
          "snippet": "static void virSystemdEscapeName(virBufferPtr buf,\n                                 const char *name)\n{\n    static const char hextable[16] = \"0123456789abcdef\";\n\n#define ESCAPE(c) \\\n    do { \\\n        virBufferAddChar(buf, '\\\\'); \\\n        virBufferAddChar(buf, 'x'); \\\n        virBufferAddChar(buf, hextable[(c >> 4) & 15]); \\\n        virBufferAddChar(buf, hextable[c & 15]); \\\n    } while (0)\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\n    if (*name == '.') {\n        ESCAPE(*name);\n        name++;\n    }\n\n    while (*name) {\n        if (*name == '/')\n            virBufferAddChar(buf, '-');\n        else if (*name == '-' ||\n                 *name == '\\\\' ||\n                 !strchr(VALID_CHARS, *name))\n            ESCAPE(*name);\n        else\n            virBufferAddChar(buf, *name);\n        name++;\n    }\n\n#undef ESCAPE\n#undef VALID_CHARS\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\nstatic void virSystemdEscapeName(virBufferPtr buf,\n                                 const char *name)\n{\n    static const char hextable[16] = \"0123456789abcdef\";\n\n#define ESCAPE(c) \\\n    do { \\\n        virBufferAddChar(buf, '\\\\'); \\\n        virBufferAddChar(buf, 'x'); \\\n        virBufferAddChar(buf, hextable[(c >> 4) & 15]); \\\n        virBufferAddChar(buf, hextable[c & 15]); \\\n    } while (0)\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\n    if (*name == '.') {\n        ESCAPE(*name);\n        name++;\n    }\n\n    while (*name) {\n        if (*name == '/')\n            virBufferAddChar(buf, '-');\n        else if (*name == '-' ||\n                 *name == '\\\\' ||\n                 !strchr(VALID_CHARS, *name))\n            ESCAPE(*name);\n        else\n            virBufferAddChar(buf, *name);\n        name++;\n    }\n\n#undef ESCAPE\n#undef VALID_CHARS\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "&buf",
            "\"\\\\x2d\""
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "&buf",
            "\"machine-\""
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nchar *virSystemdMakeScopeName(const char *name,\n                              const char *drivername,\n                              bool legacy_behaviour)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virBufferAddLit(&buf, \"machine-\");\n    if (legacy_behaviour) {\n        virSystemdEscapeName(&buf, drivername);\n        virBufferAddLit(&buf, \"\\\\x2d\");\n    }\n    virSystemdEscapeName(&buf, name);\n    virBufferAddLit(&buf, \".scope\");\n\n    return virBufferContentAndReset(&buf);\n}"
  },
  {
    "function_name": "virSystemdEscapeName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
    "lines": "59-97",
    "snippet": "static void virSystemdEscapeName(virBufferPtr buf,\n                                 const char *name)\n{\n    static const char hextable[16] = \"0123456789abcdef\";\n\n#define ESCAPE(c) \\\n    do { \\\n        virBufferAddChar(buf, '\\\\'); \\\n        virBufferAddChar(buf, 'x'); \\\n        virBufferAddChar(buf, hextable[(c >> 4) & 15]); \\\n        virBufferAddChar(buf, hextable[c & 15]); \\\n    } while (0)\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\n    if (*name == '.') {\n        ESCAPE(*name);\n        name++;\n    }\n\n    while (*name) {\n        if (*name == '/')\n            virBufferAddChar(buf, '-');\n        else if (*name == '-' ||\n                 *name == '\\\\' ||\n                 !strchr(VALID_CHARS, *name))\n            ESCAPE(*name);\n        else\n            virBufferAddChar(buf, *name);\n        name++;\n    }\n\n#undef ESCAPE\n#undef VALID_CHARS\n}",
    "includes": [
      "#include \"virsocketaddr.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virutil.h\"",
      "#include \"viralloc.h\"",
      "#include \"virstring.h\"",
      "#include \"virdbus.h\"",
      "#include \"virbuffer.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virsystemdpriv.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferAddChar",
          "args": [
            "buf",
            "*name"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAddChar",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "206-210",
          "snippet": "void\nvirBufferAddChar(virBufferPtr buf, char c)\n{\n    virBufferAdd(buf, &c, 1);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAddChar(virBufferPtr buf, char c)\n{\n    virBufferAdd(buf, &c, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ESCAPE",
          "args": [
            "*name"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "VALID_CHARS",
            "*name"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ESCAPE",
          "args": [
            "*name"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\nstatic void virSystemdEscapeName(virBufferPtr buf,\n                                 const char *name)\n{\n    static const char hextable[16] = \"0123456789abcdef\";\n\n#define ESCAPE(c) \\\n    do { \\\n        virBufferAddChar(buf, '\\\\'); \\\n        virBufferAddChar(buf, 'x'); \\\n        virBufferAddChar(buf, hextable[(c >> 4) & 15]); \\\n        virBufferAddChar(buf, hextable[c & 15]); \\\n    } while (0)\n\n#define VALID_CHARS \\\n        \"0123456789\" \\\n        \"abcdefghijklmnopqrstuvwxyz\" \\\n        \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" \\\n        \":-_.\\\\\"\n\n    if (*name == '.') {\n        ESCAPE(*name);\n        name++;\n    }\n\n    while (*name) {\n        if (*name == '/')\n            virBufferAddChar(buf, '-');\n        else if (*name == '-' ||\n                 *name == '\\\\' ||\n                 !strchr(VALID_CHARS, *name))\n            ESCAPE(*name);\n        else\n            virBufferAddChar(buf, *name);\n        name++;\n    }\n\n#undef ESCAPE\n#undef VALID_CHARS\n}"
  }
]