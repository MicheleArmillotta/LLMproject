[
  {
    "function_name": "virStorageBackendSheepdogRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "380-384",
    "snippet": "int\nvirStorageBackendSheepdogRegister(void)\n{\n    return virStorageBackendRegister(&virStorageBackendSheepdog);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virStorageBackend virStorageBackendSheepdog = {\n    .type = VIR_STORAGE_POOL_SHEEPDOG,\n\n    .refreshPool = virStorageBackendSheepdogRefreshPool,\n    .createVol = virStorageBackendSheepdogCreateVol,\n    .buildVol = virStorageBackendSheepdogBuildVol,\n    .refreshVol = virStorageBackendSheepdogRefreshVol,\n    .deleteVol = virStorageBackendSheepdogDeleteVol,\n    .resizeVol = virStorageBackendSheepdogResizeVol,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRegister",
          "args": [
            "&virStorageBackendSheepdog"
          ],
          "line": 383
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend.c",
          "lines": "153-169",
          "snippet": "int\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}",
          "includes": [
            "# include \"storage_backend_vstorage.h\"",
            "# include \"storage_backend_zfs.h\"",
            "# include \"storage_backend_gluster.h\"",
            "# include \"storage_backend_sheepdog.h\"",
            "# include \"storage_backend_rbd.h\"",
            "# include \"storage_backend_fs.h\"",
            "# include \"storage_backend_disk.h\"",
            "# include \"storage_backend_mpath.h\"",
            "# include \"storage_backend_scsi.h\"",
            "# include \"storage_backend_iscsi_direct.h\"",
            "# include \"storage_backend_iscsi.h\"",
            "# include \"storage_backend_logical.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_STORAGE_BACKENDS_MAX 20"
          ],
          "globals_used": [
            "static virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];",
            "static size_t virStorageBackendsCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include \"storage_backend_vstorage.h\"\n# include \"storage_backend_zfs.h\"\n# include \"storage_backend_gluster.h\"\n# include \"storage_backend_sheepdog.h\"\n# include \"storage_backend_rbd.h\"\n# include \"storage_backend_fs.h\"\n# include \"storage_backend_disk.h\"\n# include \"storage_backend_mpath.h\"\n# include \"storage_backend_scsi.h\"\n# include \"storage_backend_iscsi_direct.h\"\n# include \"storage_backend_iscsi.h\"\n# include \"storage_backend_logical.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"storage_backend.h\"\n#include \"virstoragefile.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\n#define VIR_STORAGE_BACKENDS_MAX 20\n\nstatic virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];\nstatic size_t virStorageBackendsCount;\n\nint\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirStorageBackend virStorageBackendSheepdog = {\n    .type = VIR_STORAGE_POOL_SHEEPDOG,\n\n    .refreshPool = virStorageBackendSheepdogRefreshPool,\n    .createVol = virStorageBackendSheepdogCreateVol,\n    .buildVol = virStorageBackendSheepdogBuildVol,\n    .refreshVol = virStorageBackendSheepdogRefreshVol,\n    .deleteVol = virStorageBackendSheepdogDeleteVol,\n    .resizeVol = virStorageBackendSheepdogResizeVol,\n};\n\nint\nvirStorageBackendSheepdogRegister(void)\n{\n    return virStorageBackendRegister(&virStorageBackendSheepdog);\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogResizeVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "350-364",
    "snippet": "static int\nvirStorageBackendSheepdogResizeVol(virStoragePoolObjPtr pool,\n                                   virStorageVolDefPtr vol,\n                                   unsigned long long capacity,\n                                   unsigned int flags)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    virCheckFlags(0, -1);\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"resize\", vol->name, NULL);\n    virCommandAddArgFormat(cmd, \"%llu\", capacity);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    return virCommandRun(cmd, NULL);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);",
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 363
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogAddHostArg",
          "args": [
            "cmd",
            "pool"
          ],
          "line": 362
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogAddHostArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "91-108",
          "snippet": "void\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nvoid\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgFormat",
          "args": [
            "cmd",
            "\"%llu\"",
            "capacity"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1569-1590",
          "snippet": "void\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "SHEEPDOGCLI",
            "\"vdi\"",
            "\"resize\"",
            "vol->name",
            "NULL"
          ],
          "line": 360
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogResizeVol(virStoragePoolObjPtr pool,\n                                   virStorageVolDefPtr vol,\n                                   unsigned long long capacity,\n                                   unsigned int flags)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    virCheckFlags(0, -1);\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"resize\", vol->name, NULL);\n    virCommandAddArgFormat(cmd, \"%llu\", capacity);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    return virCommandRun(cmd, NULL);\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogRefreshVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "321-347",
    "snippet": "static int\nvirStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                    virStorageVolDefPtr vol)\n{\n    char *output = NULL;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"list\", vol->name, \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    if (virStorageBackendSheepdogParseVdiList(vol, output) < 0)\n        return -1;\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup(vol->name);\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);",
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "vol->name"
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vol->target.path"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vol->key"
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogParseVdiList",
          "args": [
            "vol",
            "output"
          ],
          "line": 335
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogParseVdiList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "260-319",
          "snippet": "int\nvirStorageBackendSheepdogParseVdiList(virStorageVolDefPtr vol,\n                                      char *output)\n{\n    /* fields:\n     * current/clone/snapshot, name, id, size, used, shared, creation time, vdi id, [tag]\n     *\n     * example output:\n     * s test 1 10 0 0 1336556634 7c2b25\n     * s test 2 10 0 0 1336557203 7c2b26\n     * = test 3 10 0 0 1336557216 7c2b27\n     */\n\n    int id;\n    const char *p, *next;\n\n    vol->target.allocation = vol->target.capacity = 0;\n\n    p = output;\n    do {\n        char *end;\n\n        if ((next = strchr(p, '\\n')))\n            ++next;\n\n        /* ignore snapshots */\n        if (*p != '=')\n            continue;\n\n        /* skip space */\n        if (p + 2 < next)\n            p += 2;\n        else\n            return -1;\n\n        /* skip name */\n        while (*p != '\\0' && *p != ' ') {\n            if (*p == '\\\\')\n                ++p;\n            ++p;\n        }\n\n        if (virStrToLong_i(p, &end, 10, &id) < 0)\n            return -1;\n\n        p = end + 1;\n\n        if (virStrToLong_ull(p, &end, 10, &vol->target.capacity) < 0)\n            return -1;\n\n        p = end + 1;\n\n        if (virStrToLong_ull(p, &end, 10, &vol->target.allocation) < 0)\n            return -1;\n\n        return 0;\n    } while ((p = next));\n\n    return -1;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\n\nint\nvirStorageBackendSheepdogParseVdiList(virStorageVolDefPtr vol,\n                                      char *output)\n{\n    /* fields:\n     * current/clone/snapshot, name, id, size, used, shared, creation time, vdi id, [tag]\n     *\n     * example output:\n     * s test 1 10 0 0 1336556634 7c2b25\n     * s test 2 10 0 0 1336557203 7c2b26\n     * = test 3 10 0 0 1336557216 7c2b27\n     */\n\n    int id;\n    const char *p, *next;\n\n    vol->target.allocation = vol->target.capacity = 0;\n\n    p = output;\n    do {\n        char *end;\n\n        if ((next = strchr(p, '\\n')))\n            ++next;\n\n        /* ignore snapshots */\n        if (*p != '=')\n            continue;\n\n        /* skip space */\n        if (p + 2 < next)\n            p += 2;\n        else\n            return -1;\n\n        /* skip name */\n        while (*p != '\\0' && *p != ' ') {\n            if (*p == '\\\\')\n                ++p;\n            ++p;\n        }\n\n        if (virStrToLong_i(p, &end, 10, &id) < 0)\n            return -1;\n\n        p = end + 1;\n\n        if (virStrToLong_ull(p, &end, 10, &vol->target.capacity) < 0)\n            return -1;\n\n        p = end + 1;\n\n        if (virStrToLong_ull(p, &end, 10, &vol->target.allocation) < 0)\n            return -1;\n\n        return 0;\n    } while ((p = next));\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 332
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetOutputBuffer",
          "args": [
            "cmd",
            "&output"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetOutputBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1869-1884",
          "snippet": "void\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogAddHostArg",
          "args": [
            "cmd",
            "pool"
          ],
          "line": 330
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogAddHostArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "91-108",
          "snippet": "void\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nvoid\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "SHEEPDOGCLI",
            "\"vdi\"",
            "\"list\"",
            "vol->name",
            "\"-r\"",
            "NULL"
          ],
          "line": 329
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 326
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                    virStorageVolDefPtr vol)\n{\n    char *output = NULL;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"list\", vol->name, \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    if (virStorageBackendSheepdogParseVdiList(vol, output) < 0)\n        return -1;\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup(vol->name);\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogParseVdiList",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "260-319",
    "snippet": "int\nvirStorageBackendSheepdogParseVdiList(virStorageVolDefPtr vol,\n                                      char *output)\n{\n    /* fields:\n     * current/clone/snapshot, name, id, size, used, shared, creation time, vdi id, [tag]\n     *\n     * example output:\n     * s test 1 10 0 0 1336556634 7c2b25\n     * s test 2 10 0 0 1336557203 7c2b26\n     * = test 3 10 0 0 1336557216 7c2b27\n     */\n\n    int id;\n    const char *p, *next;\n\n    vol->target.allocation = vol->target.capacity = 0;\n\n    p = output;\n    do {\n        char *end;\n\n        if ((next = strchr(p, '\\n')))\n            ++next;\n\n        /* ignore snapshots */\n        if (*p != '=')\n            continue;\n\n        /* skip space */\n        if (p + 2 < next)\n            p += 2;\n        else\n            return -1;\n\n        /* skip name */\n        while (*p != '\\0' && *p != ' ') {\n            if (*p == '\\\\')\n                ++p;\n            ++p;\n        }\n\n        if (virStrToLong_i(p, &end, 10, &id) < 0)\n            return -1;\n\n        p = end + 1;\n\n        if (virStrToLong_ull(p, &end, 10, &vol->target.capacity) < 0)\n            return -1;\n\n        p = end + 1;\n\n        if (virStrToLong_ull(p, &end, 10, &vol->target.allocation) < 0)\n            return -1;\n\n        return 0;\n    } while ((p = next));\n\n    return -1;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStrToLong_ull",
          "args": [
            "p",
            "&end",
            "10",
            "&vol->target.allocation"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_ullp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "568-586",
          "snippet": "int\nvirStrToLong_ullp(char const *s, char **end_ptr, int base,\n                  unsigned long long *result)\n{\n    unsigned long long val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtoull(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_ullp(char const *s, char **end_ptr, int base,\n                  unsigned long long *result)\n{\n    unsigned long long val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtoull(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrToLong_i",
          "args": [
            "p",
            "&end",
            "10",
            "&id"
          ],
          "line": 302
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "391-407",
          "snippet": "int\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "p",
            "'\\n'"
          ],
          "line": 282
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\n\nint\nvirStorageBackendSheepdogParseVdiList(virStorageVolDefPtr vol,\n                                      char *output)\n{\n    /* fields:\n     * current/clone/snapshot, name, id, size, used, shared, creation time, vdi id, [tag]\n     *\n     * example output:\n     * s test 1 10 0 0 1336556634 7c2b25\n     * s test 2 10 0 0 1336557203 7c2b26\n     * = test 3 10 0 0 1336557216 7c2b27\n     */\n\n    int id;\n    const char *p, *next;\n\n    vol->target.allocation = vol->target.capacity = 0;\n\n    p = output;\n    do {\n        char *end;\n\n        if ((next = strchr(p, '\\n')))\n            ++next;\n\n        /* ignore snapshots */\n        if (*p != '=')\n            continue;\n\n        /* skip space */\n        if (p + 2 < next)\n            p += 2;\n        else\n            return -1;\n\n        /* skip name */\n        while (*p != '\\0' && *p != ' ') {\n            if (*p == '\\\\')\n                ++p;\n            ++p;\n        }\n\n        if (virStrToLong_i(p, &end, 10, &id) < 0)\n            return -1;\n\n        p = end + 1;\n\n        if (virStrToLong_ull(p, &end, 10, &vol->target.capacity) < 0)\n            return -1;\n\n        p = end + 1;\n\n        if (virStrToLong_ull(p, &end, 10, &vol->target.allocation) < 0)\n            return -1;\n\n        return 0;\n    } while ((p = next));\n\n    return -1;\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogBuildVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "238-257",
    "snippet": "static int\nvirStorageBackendSheepdogBuildVol(virStoragePoolObjPtr pool,\n                                  virStorageVolDefPtr vol,\n                                  unsigned int flags)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    virCheckFlags(0, -1);\n\n    if (!vol->target.capacity) {\n        virReportError(VIR_ERR_NO_SUPPORT, \"%s\",\n                       _(\"volume capacity required for this pool\"));\n        return -1;\n    }\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"create\", vol->name, NULL);\n    virCommandAddArgFormat(cmd, \"%llu\", vol->target.capacity);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    return virCommandRun(cmd, NULL);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);",
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogAddHostArg",
          "args": [
            "cmd",
            "pool"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogAddHostArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "91-108",
          "snippet": "void\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nvoid\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgFormat",
          "args": [
            "cmd",
            "\"%llu\"",
            "vol->target.capacity"
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1569-1590",
          "snippet": "void\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "SHEEPDOGCLI",
            "\"vdi\"",
            "\"create\"",
            "vol->name",
            "NULL"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_SUPPORT",
            "\"%s\"",
            "_(\"volume capacity required for this pool\")"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"volume capacity required for this pool\""
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogBuildVol(virStoragePoolObjPtr pool,\n                                  virStorageVolDefPtr vol,\n                                  unsigned int flags)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    virCheckFlags(0, -1);\n\n    if (!vol->target.capacity) {\n        virReportError(VIR_ERR_NO_SUPPORT, \"%s\",\n                       _(\"volume capacity required for this pool\"));\n        return -1;\n    }\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"create\", vol->name, NULL);\n    virCommandAddArgFormat(cmd, \"%llu\", vol->target.capacity);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    return virCommandRun(cmd, NULL);\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogCreateVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "213-235",
    "snippet": "static int\nvirStorageBackendSheepdogCreateVol(virStoragePoolObjPtr pool,\n                                   virStorageVolDefPtr vol)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (vol->target.encryption != NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       \"%s\", _(\"storage pool does not support encrypted \"\n                               \"volumes\"));\n        return -1;\n    }\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup(vol->name);\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);",
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "vol->name"
          ],
          "line": 232
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vol->target.path"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vol->key"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"storage pool does not support encrypted \"\n                               \"volumes\")"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogCreateVol(virStoragePoolObjPtr pool,\n                                   virStorageVolDefPtr vol)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (vol->target.encryption != NULL) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       \"%s\", _(\"storage pool does not support encrypted \"\n                               \"volumes\"));\n        return -1;\n    }\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup(vol->name);\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogDeleteVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "198-210",
    "snippet": "static int\nvirStorageBackendSheepdogDeleteVol(virStoragePoolObjPtr pool,\n                                   virStorageVolDefPtr vol,\n                                   unsigned int flags)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    virCheckFlags(0, -1);\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"delete\", vol->name, NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    return virCommandRun(cmd, NULL);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);",
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogAddHostArg",
          "args": [
            "cmd",
            "pool"
          ],
          "line": 208
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogAddHostArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "91-108",
          "snippet": "void\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nvoid\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "SHEEPDOGCLI",
            "\"vdi\"",
            "\"delete\"",
            "vol->name",
            "NULL"
          ],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogDeleteVol(virStoragePoolObjPtr pool,\n                                   virStorageVolDefPtr vol,\n                                   unsigned int flags)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    virCheckFlags(0, -1);\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"delete\", vol->name, NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    return virCommandRun(cmd, NULL);\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogRefreshPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "178-195",
    "snippet": "static int\nvirStorageBackendSheepdogRefreshPool(virStoragePoolObjPtr pool)\n{\n    g_autofree char *output = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"node\", \"info\", \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    if (virStorageBackendSheepdogParseNodeInfo(virStoragePoolObjGetDef(pool),\n                                               output) < 0)\n        return -1;\n\n    return virStorageBackendSheepdogRefreshAllVol(pool);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogRefreshAllVol",
          "args": [
            "pool"
          ],
          "line": 194
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogRefreshAllVol",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "138-175",
          "snippet": "static int\nvirStorageBackendSheepdogRefreshAllVol(virStoragePoolObjPtr pool)\n{\n    size_t i;\n    g_autofree char *output = NULL;\n    VIR_AUTOSTRINGLIST lines = NULL;\n    VIR_AUTOSTRINGLIST cells = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"list\", \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    lines = virStringSplit(output, \"\\n\", 0);\n    if (lines == NULL)\n        return -1;\n\n    for (i = 0; lines[i]; i++) {\n        const char *line = lines[i];\n        if (line == NULL)\n            break;\n\n        cells = virStringSplit(line, \" \", 0);\n\n        if (cells != NULL &&\n            virStringListLength((const char * const *)cells) > 2) {\n            if (virStorageBackendSheepdogAddVolume(pool, cells[1]) < 0)\n                return -1;\n        }\n\n        virStringListFree(cells);\n        cells = NULL;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogRefreshAllVol(virStoragePoolObjPtr pool)\n{\n    size_t i;\n    g_autofree char *output = NULL;\n    VIR_AUTOSTRINGLIST lines = NULL;\n    VIR_AUTOSTRINGLIST cells = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"list\", \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    lines = virStringSplit(output, \"\\n\", 0);\n    if (lines == NULL)\n        return -1;\n\n    for (i = 0; lines[i]; i++) {\n        const char *line = lines[i];\n        if (line == NULL)\n            break;\n\n        cells = virStringSplit(line, \" \", 0);\n\n        if (cells != NULL &&\n            virStringListLength((const char * const *)cells) > 2) {\n            if (virStorageBackendSheepdogAddVolume(pool, cells[1]) < 0)\n                return -1;\n        }\n\n        virStringListFree(cells);\n        cells = NULL;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogParseNodeInfo",
          "args": [
            "virStoragePoolObjGetDef(pool)",
            "output"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogParseNodeInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "44-89",
          "snippet": "int\nvirStorageBackendSheepdogParseNodeInfo(virStoragePoolDefPtr pool,\n                                       char *output)\n{\n    /* fields:\n     * node id/total, size, used, use%, [total vdi size]\n     *\n     * example output:\n     * 0 15245667872 117571104 0%\n     * Total 15245667872 117571104 0% 20972341\n     */\n\n    const char *p, *next;\n\n    pool->allocation = pool->capacity = pool->available = 0;\n\n    p = output;\n    do {\n        char *end;\n\n        if ((next = strchr(p, '\\n')))\n            ++next;\n        else\n            break;\n\n        if (!STRPREFIX(p, \"Total \"))\n            continue;\n\n        p = p + 6;\n\n        if (virStrToLong_ull(p, &end, 10, &pool->capacity) < 0)\n            break;\n\n        if ((p = end + 1) > next)\n            break;\n\n        if (virStrToLong_ull(p, &end, 10, &pool->allocation) < 0)\n            break;\n\n        pool->available = pool->capacity - pool->allocation;\n        return 0;\n\n    } while ((p = next));\n\n    return -1;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nint\nvirStorageBackendSheepdogParseNodeInfo(virStoragePoolDefPtr pool,\n                                       char *output)\n{\n    /* fields:\n     * node id/total, size, used, use%, [total vdi size]\n     *\n     * example output:\n     * 0 15245667872 117571104 0%\n     * Total 15245667872 117571104 0% 20972341\n     */\n\n    const char *p, *next;\n\n    pool->allocation = pool->capacity = pool->available = 0;\n\n    p = output;\n    do {\n        char *end;\n\n        if ((next = strchr(p, '\\n')))\n            ++next;\n        else\n            break;\n\n        if (!STRPREFIX(p, \"Total \"))\n            continue;\n\n        p = p + 6;\n\n        if (virStrToLong_ull(p, &end, 10, &pool->capacity) < 0)\n            break;\n\n        if ((p = end + 1) > next)\n            break;\n\n        if (virStrToLong_ull(p, &end, 10, &pool->allocation) < 0)\n            break;\n\n        pool->available = pool->capacity - pool->allocation;\n        return 0;\n\n    } while ((p = next));\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetOutputBuffer",
          "args": [
            "cmd",
            "&output"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetOutputBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1869-1884",
          "snippet": "void\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogAddHostArg",
          "args": [
            "cmd",
            "pool"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogAddHostArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "91-108",
          "snippet": "void\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nvoid\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "SHEEPDOGCLI",
            "\"node\"",
            "\"info\"",
            "\"-r\"",
            "NULL"
          ],
          "line": 184
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogRefreshPool(virStoragePoolObjPtr pool)\n{\n    g_autofree char *output = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"node\", \"info\", \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    if (virStorageBackendSheepdogParseNodeInfo(virStoragePoolObjGetDef(pool),\n                                               output) < 0)\n        return -1;\n\n    return virStorageBackendSheepdogRefreshAllVol(pool);\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogRefreshAllVol",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "138-175",
    "snippet": "static int\nvirStorageBackendSheepdogRefreshAllVol(virStoragePoolObjPtr pool)\n{\n    size_t i;\n    g_autofree char *output = NULL;\n    VIR_AUTOSTRINGLIST lines = NULL;\n    VIR_AUTOSTRINGLIST cells = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"list\", \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    lines = virStringSplit(output, \"\\n\", 0);\n    if (lines == NULL)\n        return -1;\n\n    for (i = 0; lines[i]; i++) {\n        const char *line = lines[i];\n        if (line == NULL)\n            break;\n\n        cells = virStringSplit(line, \" \", 0);\n\n        if (cells != NULL &&\n            virStringListLength((const char * const *)cells) > 2) {\n            if (virStorageBackendSheepdogAddVolume(pool, cells[1]) < 0)\n                return -1;\n        }\n\n        virStringListFree(cells);\n        cells = NULL;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStringListFree",
          "args": [
            "cells"
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "306-314",
          "snippet": "void virStringListFree(char **strings)\n{\n    char **tmp = strings;\n    while (tmp && *tmp) {\n        VIR_FREE(*tmp);\n        tmp++;\n    }\n    VIR_FREE(strings);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid virStringListFree(char **strings)\n{\n    char **tmp = strings;\n    while (tmp && *tmp) {\n        VIR_FREE(*tmp);\n        tmp++;\n    }\n    VIR_FREE(strings);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogAddVolume",
          "args": [
            "pool",
            "cells[1]"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogAddVolume",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "110-136",
          "snippet": "static int\nvirStorageBackendSheepdogAddVolume(virStoragePoolObjPtr pool, const char *diskInfo)\n{\n    g_autoptr(virStorageVolDef) vol = NULL;\n\n    if (diskInfo == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing disk info when adding volume\"));\n        return -1;\n    }\n\n    if (VIR_ALLOC(vol) < 0)\n        return -1;\n\n    vol->name = g_strdup(diskInfo);\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    if (virStorageBackendSheepdogRefreshVol(pool, vol) < 0)\n        return -1;\n\n    if (virStoragePoolObjAddVol(pool, vol) < 0)\n        return -1;\n    vol = NULL;\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);",
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogAddVolume(virStoragePoolObjPtr pool, const char *diskInfo)\n{\n    g_autoptr(virStorageVolDef) vol = NULL;\n\n    if (diskInfo == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing disk info when adding volume\"));\n        return -1;\n    }\n\n    if (VIR_ALLOC(vol) < 0)\n        return -1;\n\n    vol->name = g_strdup(diskInfo);\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    if (virStorageBackendSheepdogRefreshVol(pool, vol) < 0)\n        return -1;\n\n    if (virStoragePoolObjAddVol(pool, vol) < 0)\n        return -1;\n    vol = NULL;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStringListLength",
          "args": [
            "(const char * const *)cells"
          ],
          "line": 165
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListLength",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "893-901",
          "snippet": "size_t virStringListLength(const char * const *strings)\n{\n    size_t i = 0;\n\n    while (strings && strings[i])\n        i++;\n\n    return i;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nsize_t virStringListLength(const char * const *strings)\n{\n    size_t i = 0;\n\n    while (strings && strings[i])\n        i++;\n\n    return i;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStringSplit",
          "args": [
            "line",
            "\" \"",
            "0"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "virStringSplit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "126-132",
          "snippet": "char **\nvirStringSplit(const char *string,\n               const char *delim,\n               size_t max_tokens)\n{\n    return virStringSplitCount(string, delim, max_tokens, NULL);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nchar **\nvirStringSplit(const char *string,\n               const char *delim,\n               size_t max_tokens)\n{\n    return virStringSplitCount(string, delim, max_tokens, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetOutputBuffer",
          "args": [
            "cmd",
            "&output"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetOutputBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1869-1884",
          "snippet": "void\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogAddHostArg",
          "args": [
            "cmd",
            "pool"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogAddHostArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "91-108",
          "snippet": "void\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nvoid\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "SHEEPDOGCLI",
            "\"vdi\"",
            "\"list\"",
            "\"-r\"",
            "NULL"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogRefreshAllVol(virStoragePoolObjPtr pool)\n{\n    size_t i;\n    g_autofree char *output = NULL;\n    VIR_AUTOSTRINGLIST lines = NULL;\n    VIR_AUTOSTRINGLIST cells = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"list\", \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    lines = virStringSplit(output, \"\\n\", 0);\n    if (lines == NULL)\n        return -1;\n\n    for (i = 0; lines[i]; i++) {\n        const char *line = lines[i];\n        if (line == NULL)\n            break;\n\n        cells = virStringSplit(line, \" \", 0);\n\n        if (cells != NULL &&\n            virStringListLength((const char * const *)cells) > 2) {\n            if (virStorageBackendSheepdogAddVolume(pool, cells[1]) < 0)\n                return -1;\n        }\n\n        virStringListFree(cells);\n        cells = NULL;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogAddVolume",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "110-136",
    "snippet": "static int\nvirStorageBackendSheepdogAddVolume(virStoragePoolObjPtr pool, const char *diskInfo)\n{\n    g_autoptr(virStorageVolDef) vol = NULL;\n\n    if (diskInfo == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing disk info when adding volume\"));\n        return -1;\n    }\n\n    if (VIR_ALLOC(vol) < 0)\n        return -1;\n\n    vol->name = g_strdup(diskInfo);\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    if (virStorageBackendSheepdogRefreshVol(pool, vol) < 0)\n        return -1;\n\n    if (virStoragePoolObjAddVol(pool, vol) < 0)\n        return -1;\n    vol = NULL;\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);",
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStoragePoolObjAddVol",
          "args": [
            "pool",
            "vol"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjAddVol",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "641-679",
          "snippet": "int\nvirStoragePoolObjAddVol(virStoragePoolObjPtr obj,\n                        virStorageVolDefPtr voldef)\n{\n    virStorageVolObjPtr volobj = NULL;\n    virStorageVolObjListPtr volumes = obj->volumes;\n\n    virObjectRWLockWrite(volumes);\n\n    if (!(volobj = virStorageVolObjNew()))\n        goto error;\n\n    if (virHashAddEntry(volumes->objsKey, voldef->key, volobj) < 0)\n        goto error;\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsName, voldef->name, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsPath, voldef->target.path, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        virHashRemoveEntry(volumes->objsName, voldef->name);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    volobj->voldef = voldef;\n    virObjectRWUnlock(volumes);\n    virStorageVolObjEndAPI(&volobj);\n    return 0;\n\n error:\n    virStorageVolObjEndAPI(&volobj);\n    virObjectRWUnlock(volumes);\n    return -1;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirStoragePoolObjAddVol(virStoragePoolObjPtr obj,\n                        virStorageVolDefPtr voldef)\n{\n    virStorageVolObjPtr volobj = NULL;\n    virStorageVolObjListPtr volumes = obj->volumes;\n\n    virObjectRWLockWrite(volumes);\n\n    if (!(volobj = virStorageVolObjNew()))\n        goto error;\n\n    if (virHashAddEntry(volumes->objsKey, voldef->key, volobj) < 0)\n        goto error;\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsName, voldef->name, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    if (virHashAddEntry(volumes->objsPath, voldef->target.path, volobj) < 0) {\n        virHashRemoveEntry(volumes->objsKey, voldef->key);\n        virHashRemoveEntry(volumes->objsName, voldef->name);\n        goto error;\n    }\n    virObjectRef(volobj);\n\n    volobj->voldef = voldef;\n    virObjectRWUnlock(volumes);\n    virStorageVolObjEndAPI(&volobj);\n    return 0;\n\n error:\n    virStorageVolObjEndAPI(&volobj);\n    virObjectRWUnlock(volumes);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSheepdogRefreshVol",
          "args": [
            "pool",
            "vol"
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSheepdogRefreshVol",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
          "lines": "321-347",
          "snippet": "static int\nvirStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                    virStorageVolDefPtr vol)\n{\n    char *output = NULL;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"list\", vol->name, \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    if (virStorageBackendSheepdogParseVdiList(vol, output) < 0)\n        return -1;\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup(vol->name);\n\n    return 0;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_backend_sheepdog_priv.h\"",
            "#include \"storage_backend_sheepdog.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);",
            "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                    virStorageVolDefPtr vol)\n{\n    char *output = NULL;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHEEPDOGCLI, \"vdi\", \"list\", vol->name, \"-r\", NULL);\n    virStorageBackendSheepdogAddHostArg(cmd, pool);\n    virCommandSetOutputBuffer(cmd, &output);\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    if (virStorageBackendSheepdogParseVdiList(vol, output) < 0)\n        return -1;\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    VIR_FREE(vol->key);\n    vol->key = g_strdup_printf(\"%s/%s\", def->source.name, vol->name);\n\n    VIR_FREE(vol->target.path);\n    vol->target.path = g_strdup(vol->name);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "diskInfo"
          ],
          "line": 124
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "vol"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing disk info when adding volume\")"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nstatic int virStorageBackendSheepdogRefreshVol(virStoragePoolObjPtr pool,\n                                               virStorageVolDefPtr vol);\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nstatic int\nvirStorageBackendSheepdogAddVolume(virStoragePoolObjPtr pool, const char *diskInfo)\n{\n    g_autoptr(virStorageVolDef) vol = NULL;\n\n    if (diskInfo == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing disk info when adding volume\"));\n        return -1;\n    }\n\n    if (VIR_ALLOC(vol) < 0)\n        return -1;\n\n    vol->name = g_strdup(diskInfo);\n\n    vol->type = VIR_STORAGE_VOL_NETWORK;\n\n    if (virStorageBackendSheepdogRefreshVol(pool, vol) < 0)\n        return -1;\n\n    if (virStoragePoolObjAddVol(pool, vol) < 0)\n        return -1;\n    vol = NULL;\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogAddHostArg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "91-108",
    "snippet": "void\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandAddArgFormat",
          "args": [
            "cmd",
            "\"%d\"",
            "port"
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1569-1590",
          "snippet": "void\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArg",
          "args": [
            "cmd",
            "\"-p\""
          ],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nvoid\nvirStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                    virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *address = \"localhost\";\n    int port = 7000;\n    if (def->source.nhost > 0) {\n        if (def->source.hosts[0].name != NULL)\n            address = def->source.hosts[0].name;\n        if (def->source.hosts[0].port)\n            port = def->source.hosts[0].port;\n    }\n    virCommandAddArg(cmd, \"-a\");\n    virCommandAddArgFormat(cmd, \"%s\", address);\n    virCommandAddArg(cmd, \"-p\");\n    virCommandAddArgFormat(cmd, \"%d\", port);\n}"
  },
  {
    "function_name": "virStorageBackendSheepdogParseNodeInfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_sheepdog.c",
    "lines": "44-89",
    "snippet": "int\nvirStorageBackendSheepdogParseNodeInfo(virStoragePoolDefPtr pool,\n                                       char *output)\n{\n    /* fields:\n     * node id/total, size, used, use%, [total vdi size]\n     *\n     * example output:\n     * 0 15245667872 117571104 0%\n     * Total 15245667872 117571104 0% 20972341\n     */\n\n    const char *p, *next;\n\n    pool->allocation = pool->capacity = pool->available = 0;\n\n    p = output;\n    do {\n        char *end;\n\n        if ((next = strchr(p, '\\n')))\n            ++next;\n        else\n            break;\n\n        if (!STRPREFIX(p, \"Total \"))\n            continue;\n\n        p = p + 6;\n\n        if (virStrToLong_ull(p, &end, 10, &pool->capacity) < 0)\n            break;\n\n        if ((p = end + 1) > next)\n            break;\n\n        if (virStrToLong_ull(p, &end, 10, &pool->allocation) < 0)\n            break;\n\n        pool->available = pool->capacity - pool->allocation;\n        return 0;\n\n    } while ((p = next));\n\n    return -1;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_backend_sheepdog_priv.h\"",
      "#include \"storage_backend_sheepdog.h\"",
      "#include \"virerror.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "void virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStrToLong_ull",
          "args": [
            "p",
            "&end",
            "10",
            "&pool->allocation"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_ullp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "568-586",
          "snippet": "int\nvirStrToLong_ullp(char const *s, char **end_ptr, int base,\n                  unsigned long long *result)\n{\n    unsigned long long val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtoull(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_ullp(char const *s, char **end_ptr, int base,\n                  unsigned long long *result)\n{\n    unsigned long long val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtoull(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "p",
            "\"Total \""
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "p",
            "'\\n'"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_backend_sheepdog_priv.h\"\n#include \"storage_backend_sheepdog.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid virStorageBackendSheepdogAddHostArg(virCommandPtr cmd,\n                                         virStoragePoolObjPtr pool);\n\nint\nvirStorageBackendSheepdogParseNodeInfo(virStoragePoolDefPtr pool,\n                                       char *output)\n{\n    /* fields:\n     * node id/total, size, used, use%, [total vdi size]\n     *\n     * example output:\n     * 0 15245667872 117571104 0%\n     * Total 15245667872 117571104 0% 20972341\n     */\n\n    const char *p, *next;\n\n    pool->allocation = pool->capacity = pool->available = 0;\n\n    p = output;\n    do {\n        char *end;\n\n        if ((next = strchr(p, '\\n')))\n            ++next;\n        else\n            break;\n\n        if (!STRPREFIX(p, \"Total \"))\n            continue;\n\n        p = p + 6;\n\n        if (virStrToLong_ull(p, &end, 10, &pool->capacity) < 0)\n            break;\n\n        if ((p = end + 1) > next)\n            break;\n\n        if (virStrToLong_ull(p, &end, 10, &pool->allocation) < 0)\n            break;\n\n        pool->available = pool->capacity - pool->allocation;\n        return 0;\n\n    } while ((p = next));\n\n    return -1;\n}"
  }
]