[
  {
    "function_name": "virDomainLockLeaseDetach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "340-365",
    "snippet": "int virDomainLockLeaseDetach(virLockManagerPluginPtr plugin,\n                             virDomainObjPtr dom,\n                             virDomainLeaseDefPtr lease)\n{\n    virLockManagerPtr lock;\n    int ret = -1;\n\n    VIR_DEBUG(\"plugin=%p dom=%p lease=%p\",\n              plugin, dom, lease);\n\n    if (!(lock = virDomainLockManagerNew(plugin, NULL, dom, false, 0)))\n        return -1;\n\n    if (virDomainLockManagerAddLease(lock, lease) < 0)\n        goto cleanup;\n\n    if (virLockManagerRelease(lock, NULL, 0) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virLockManagerFree(lock);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 362
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockManagerRelease",
          "args": [
            "lock",
            "NULL",
            "0"
          ],
          "line": 356
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerRelease",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "357-366",
          "snippet": "int virLockManagerRelease(virLockManagerPtr lock,\n                          char **state,\n                          unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p state=%p flags=0x%x\", lock, state, flags);\n\n    CHECK_MANAGER(drvRelease, -1);\n\n    return lock->driver->drvRelease(lock, state, flags);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerRelease(virLockManagerPtr lock,\n                          char **state,\n                          unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p state=%p flags=0x%x\", lock, state, flags);\n\n    CHECK_MANAGER(drvRelease, -1);\n\n    return lock->driver->drvRelease(lock, state, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerAddLease",
          "args": [
            "lock",
            "lease"
          ],
          "line": 353
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerAddLease",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "35-68",
          "snippet": "static int virDomainLockManagerAddLease(virLockManagerPtr lock,\n                                        virDomainLeaseDefPtr lease)\n{\n    unsigned int leaseFlags = 0;\n    virLockManagerParam lparams[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"path\",\n          .value = { .str = lease->path },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_ULONG,\n          .key = \"offset\",\n          .value = { .ul = lease->offset },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"lockspace\",\n          .value = { .str = lease->lockspace },\n        },\n    };\n    size_t nparams = G_N_ELEMENTS(lparams);\n    if (!lease->lockspace)\n        nparams--;\n\n    VIR_DEBUG(\"Add lease %s\", lease->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE,\n                                  lease->key,\n                                  nparams,\n                                  lparams,\n                                  leaseFlags) < 0) {\n        VIR_DEBUG(\"Failed to add lease %s\", lease->path);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic int virDomainLockManagerAddLease(virLockManagerPtr lock,\n                                        virDomainLeaseDefPtr lease)\n{\n    unsigned int leaseFlags = 0;\n    virLockManagerParam lparams[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"path\",\n          .value = { .str = lease->path },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_ULONG,\n          .key = \"offset\",\n          .value = { .ul = lease->offset },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"lockspace\",\n          .value = { .str = lease->lockspace },\n        },\n    };\n    size_t nparams = G_N_ELEMENTS(lparams);\n    if (!lease->lockspace)\n        nparams--;\n\n    VIR_DEBUG(\"Add lease %s\", lease->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE,\n                                  lease->key,\n                                  nparams,\n                                  lparams,\n                                  leaseFlags) < 0) {\n        VIR_DEBUG(\"Failed to add lease %s\", lease->path);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerNew",
          "args": [
            "plugin",
            "NULL",
            "dom",
            "false",
            "0"
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "104-165",
          "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p lease=%p\"",
            "plugin",
            "dom",
            "lease"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nint virDomainLockLeaseDetach(virLockManagerPluginPtr plugin,\n                             virDomainObjPtr dom,\n                             virDomainLeaseDefPtr lease)\n{\n    virLockManagerPtr lock;\n    int ret = -1;\n\n    VIR_DEBUG(\"plugin=%p dom=%p lease=%p\",\n              plugin, dom, lease);\n\n    if (!(lock = virDomainLockManagerNew(plugin, NULL, dom, false, 0)))\n        return -1;\n\n    if (virDomainLockManagerAddLease(lock, lease) < 0)\n        goto cleanup;\n\n    if (virLockManagerRelease(lock, NULL, 0) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virLockManagerFree(lock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virDomainLockLeaseAttach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "311-338",
    "snippet": "int virDomainLockLeaseAttach(virLockManagerPluginPtr plugin,\n                             const char *uri,\n                             virDomainObjPtr dom,\n                             virDomainLeaseDefPtr lease)\n{\n    virLockManagerPtr lock;\n    int ret = -1;\n\n    VIR_DEBUG(\"plugin=%p dom=%p lease=%p\",\n              plugin, dom, lease);\n\n    if (!(lock = virDomainLockManagerNew(plugin, uri, dom, false, 0)))\n        return -1;\n\n    if (virDomainLockManagerAddLease(lock, lease) < 0)\n        goto cleanup;\n\n    if (virLockManagerAcquire(lock, NULL, 0,\n                              dom->def->onLockFailure, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virLockManagerFree(lock);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 335
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockManagerAcquire",
          "args": [
            "lock",
            "NULL",
            "0",
            "dom->def->onLockFailure",
            "NULL"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerAcquire",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "339-354",
          "snippet": "int virLockManagerAcquire(virLockManagerPtr lock,\n                          const char *state,\n                          unsigned int flags,\n                          virDomainLockFailureAction action,\n                          int *fd)\n{\n    VIR_DEBUG(\"lock=%p state='%s' flags=0x%x action=%d fd=%p\",\n              lock, NULLSTR(state), flags, action, fd);\n\n    CHECK_MANAGER(drvAcquire, -1);\n\n    if (fd)\n        *fd = -1;\n\n    return lock->driver->drvAcquire(lock, state, flags, action, fd);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerAcquire(virLockManagerPtr lock,\n                          const char *state,\n                          unsigned int flags,\n                          virDomainLockFailureAction action,\n                          int *fd)\n{\n    VIR_DEBUG(\"lock=%p state='%s' flags=0x%x action=%d fd=%p\",\n              lock, NULLSTR(state), flags, action, fd);\n\n    CHECK_MANAGER(drvAcquire, -1);\n\n    if (fd)\n        *fd = -1;\n\n    return lock->driver->drvAcquire(lock, state, flags, action, fd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerAddLease",
          "args": [
            "lock",
            "lease"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerAddLease",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "35-68",
          "snippet": "static int virDomainLockManagerAddLease(virLockManagerPtr lock,\n                                        virDomainLeaseDefPtr lease)\n{\n    unsigned int leaseFlags = 0;\n    virLockManagerParam lparams[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"path\",\n          .value = { .str = lease->path },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_ULONG,\n          .key = \"offset\",\n          .value = { .ul = lease->offset },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"lockspace\",\n          .value = { .str = lease->lockspace },\n        },\n    };\n    size_t nparams = G_N_ELEMENTS(lparams);\n    if (!lease->lockspace)\n        nparams--;\n\n    VIR_DEBUG(\"Add lease %s\", lease->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE,\n                                  lease->key,\n                                  nparams,\n                                  lparams,\n                                  leaseFlags) < 0) {\n        VIR_DEBUG(\"Failed to add lease %s\", lease->path);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic int virDomainLockManagerAddLease(virLockManagerPtr lock,\n                                        virDomainLeaseDefPtr lease)\n{\n    unsigned int leaseFlags = 0;\n    virLockManagerParam lparams[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"path\",\n          .value = { .str = lease->path },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_ULONG,\n          .key = \"offset\",\n          .value = { .ul = lease->offset },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"lockspace\",\n          .value = { .str = lease->lockspace },\n        },\n    };\n    size_t nparams = G_N_ELEMENTS(lparams);\n    if (!lease->lockspace)\n        nparams--;\n\n    VIR_DEBUG(\"Add lease %s\", lease->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE,\n                                  lease->key,\n                                  nparams,\n                                  lparams,\n                                  leaseFlags) < 0) {\n        VIR_DEBUG(\"Failed to add lease %s\", lease->path);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerNew",
          "args": [
            "plugin",
            "uri",
            "dom",
            "false",
            "0"
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "104-165",
          "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p lease=%p\"",
            "plugin",
            "dom",
            "lease"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nint virDomainLockLeaseAttach(virLockManagerPluginPtr plugin,\n                             const char *uri,\n                             virDomainObjPtr dom,\n                             virDomainLeaseDefPtr lease)\n{\n    virLockManagerPtr lock;\n    int ret = -1;\n\n    VIR_DEBUG(\"plugin=%p dom=%p lease=%p\",\n              plugin, dom, lease);\n\n    if (!(lock = virDomainLockManagerNew(plugin, uri, dom, false, 0)))\n        return -1;\n\n    if (virDomainLockManagerAddLease(lock, lease) < 0)\n        goto cleanup;\n\n    if (virLockManagerAcquire(lock, NULL, 0,\n                              dom->def->onLockFailure, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virLockManagerFree(lock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virDomainLockImageDetach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "284-308",
    "snippet": "int virDomainLockImageDetach(virLockManagerPluginPtr plugin,\n                             virDomainObjPtr dom,\n                             virStorageSourcePtr src)\n{\n    virLockManagerPtr lock;\n    int ret = -1;\n\n    VIR_DEBUG(\"plugin=%p dom=%p src=%p\", plugin, dom, src);\n\n    if (!(lock = virDomainLockManagerNew(plugin, NULL, dom, false, 0)))\n        return -1;\n\n    if (virDomainLockManagerAddImage(lock, src) < 0)\n        goto cleanup;\n\n    if (virLockManagerRelease(lock, NULL, 0) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virLockManagerFree(lock);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockManagerRelease",
          "args": [
            "lock",
            "NULL",
            "0"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerRelease",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "357-366",
          "snippet": "int virLockManagerRelease(virLockManagerPtr lock,\n                          char **state,\n                          unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p state=%p flags=0x%x\", lock, state, flags);\n\n    CHECK_MANAGER(drvRelease, -1);\n\n    return lock->driver->drvRelease(lock, state, flags);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerRelease(virLockManagerPtr lock,\n                          char **state,\n                          unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p state=%p flags=0x%x\", lock, state, flags);\n\n    CHECK_MANAGER(drvRelease, -1);\n\n    return lock->driver->drvRelease(lock, state, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerAddImage",
          "args": [
            "lock",
            "src"
          ],
          "line": 296
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerAddImage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "71-101",
          "snippet": "static int virDomainLockManagerAddImage(virLockManagerPtr lock,\n                                        virStorageSourcePtr src)\n{\n    unsigned int diskFlags = 0;\n    int type = virStorageSourceGetActualType(src);\n\n    if (!src->path)\n        return 0;\n\n    if (!(type == VIR_STORAGE_TYPE_BLOCK ||\n          type == VIR_STORAGE_TYPE_FILE ||\n          type == VIR_STORAGE_TYPE_DIR))\n        return 0;\n\n    if (src->readonly)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_READONLY;\n    if (src->shared)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_SHARED;\n\n    VIR_DEBUG(\"Add disk %s\", src->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK,\n                                  src->path,\n                                  0,\n                                  NULL,\n                                  diskFlags) < 0) {\n        VIR_DEBUG(\"Failed add disk %s\", src->path);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic int virDomainLockManagerAddImage(virLockManagerPtr lock,\n                                        virStorageSourcePtr src)\n{\n    unsigned int diskFlags = 0;\n    int type = virStorageSourceGetActualType(src);\n\n    if (!src->path)\n        return 0;\n\n    if (!(type == VIR_STORAGE_TYPE_BLOCK ||\n          type == VIR_STORAGE_TYPE_FILE ||\n          type == VIR_STORAGE_TYPE_DIR))\n        return 0;\n\n    if (src->readonly)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_READONLY;\n    if (src->shared)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_SHARED;\n\n    VIR_DEBUG(\"Add disk %s\", src->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK,\n                                  src->path,\n                                  0,\n                                  NULL,\n                                  diskFlags) < 0) {\n        VIR_DEBUG(\"Failed add disk %s\", src->path);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerNew",
          "args": [
            "plugin",
            "NULL",
            "dom",
            "false",
            "0"
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "104-165",
          "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p src=%p\"",
            "plugin",
            "dom",
            "src"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nint virDomainLockImageDetach(virLockManagerPluginPtr plugin,\n                             virDomainObjPtr dom,\n                             virStorageSourcePtr src)\n{\n    virLockManagerPtr lock;\n    int ret = -1;\n\n    VIR_DEBUG(\"plugin=%p dom=%p src=%p\", plugin, dom, src);\n\n    if (!(lock = virDomainLockManagerNew(plugin, NULL, dom, false, 0)))\n        return -1;\n\n    if (virDomainLockManagerAddImage(lock, src) < 0)\n        goto cleanup;\n\n    if (virLockManagerRelease(lock, NULL, 0) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virLockManagerFree(lock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virDomainLockImageAttach",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "255-281",
    "snippet": "int virDomainLockImageAttach(virLockManagerPluginPtr plugin,\n                             const char *uri,\n                             virDomainObjPtr dom,\n                             virStorageSourcePtr src)\n{\n    virLockManagerPtr lock;\n    int ret = -1;\n\n    VIR_DEBUG(\"plugin=%p dom=%p src=%p\", plugin, dom, src);\n\n    if (!(lock = virDomainLockManagerNew(plugin, uri, dom, false, 0)))\n        return -1;\n\n    if (virDomainLockManagerAddImage(lock, src) < 0)\n        goto cleanup;\n\n    if (virLockManagerAcquire(lock, NULL, 0,\n                              dom->def->onLockFailure, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virLockManagerFree(lock);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockManagerAcquire",
          "args": [
            "lock",
            "NULL",
            "0",
            "dom->def->onLockFailure",
            "NULL"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerAcquire",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "339-354",
          "snippet": "int virLockManagerAcquire(virLockManagerPtr lock,\n                          const char *state,\n                          unsigned int flags,\n                          virDomainLockFailureAction action,\n                          int *fd)\n{\n    VIR_DEBUG(\"lock=%p state='%s' flags=0x%x action=%d fd=%p\",\n              lock, NULLSTR(state), flags, action, fd);\n\n    CHECK_MANAGER(drvAcquire, -1);\n\n    if (fd)\n        *fd = -1;\n\n    return lock->driver->drvAcquire(lock, state, flags, action, fd);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerAcquire(virLockManagerPtr lock,\n                          const char *state,\n                          unsigned int flags,\n                          virDomainLockFailureAction action,\n                          int *fd)\n{\n    VIR_DEBUG(\"lock=%p state='%s' flags=0x%x action=%d fd=%p\",\n              lock, NULLSTR(state), flags, action, fd);\n\n    CHECK_MANAGER(drvAcquire, -1);\n\n    if (fd)\n        *fd = -1;\n\n    return lock->driver->drvAcquire(lock, state, flags, action, fd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerAddImage",
          "args": [
            "lock",
            "src"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerAddImage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "71-101",
          "snippet": "static int virDomainLockManagerAddImage(virLockManagerPtr lock,\n                                        virStorageSourcePtr src)\n{\n    unsigned int diskFlags = 0;\n    int type = virStorageSourceGetActualType(src);\n\n    if (!src->path)\n        return 0;\n\n    if (!(type == VIR_STORAGE_TYPE_BLOCK ||\n          type == VIR_STORAGE_TYPE_FILE ||\n          type == VIR_STORAGE_TYPE_DIR))\n        return 0;\n\n    if (src->readonly)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_READONLY;\n    if (src->shared)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_SHARED;\n\n    VIR_DEBUG(\"Add disk %s\", src->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK,\n                                  src->path,\n                                  0,\n                                  NULL,\n                                  diskFlags) < 0) {\n        VIR_DEBUG(\"Failed add disk %s\", src->path);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic int virDomainLockManagerAddImage(virLockManagerPtr lock,\n                                        virStorageSourcePtr src)\n{\n    unsigned int diskFlags = 0;\n    int type = virStorageSourceGetActualType(src);\n\n    if (!src->path)\n        return 0;\n\n    if (!(type == VIR_STORAGE_TYPE_BLOCK ||\n          type == VIR_STORAGE_TYPE_FILE ||\n          type == VIR_STORAGE_TYPE_DIR))\n        return 0;\n\n    if (src->readonly)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_READONLY;\n    if (src->shared)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_SHARED;\n\n    VIR_DEBUG(\"Add disk %s\", src->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK,\n                                  src->path,\n                                  0,\n                                  NULL,\n                                  diskFlags) < 0) {\n        VIR_DEBUG(\"Failed add disk %s\", src->path);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerNew",
          "args": [
            "plugin",
            "uri",
            "dom",
            "false",
            "0"
          ],
          "line": 265
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "104-165",
          "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p src=%p\"",
            "plugin",
            "dom",
            "src"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nint virDomainLockImageAttach(virLockManagerPluginPtr plugin,\n                             const char *uri,\n                             virDomainObjPtr dom,\n                             virStorageSourcePtr src)\n{\n    virLockManagerPtr lock;\n    int ret = -1;\n\n    VIR_DEBUG(\"plugin=%p dom=%p src=%p\", plugin, dom, src);\n\n    if (!(lock = virDomainLockManagerNew(plugin, uri, dom, false, 0)))\n        return -1;\n\n    if (virDomainLockManagerAddImage(lock, src) < 0)\n        goto cleanup;\n\n    if (virLockManagerAcquire(lock, NULL, 0,\n                              dom->def->onLockFailure, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virLockManagerFree(lock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virDomainLockProcessInquire",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "235-252",
    "snippet": "int virDomainLockProcessInquire(virLockManagerPluginPtr plugin,\n                                virDomainObjPtr dom,\n                                char **state)\n{\n    virLockManagerPtr lock;\n    int ret;\n\n    VIR_DEBUG(\"plugin=%p dom=%p state=%p\",\n              plugin, dom, state);\n\n    if (!(lock = virDomainLockManagerNew(plugin, NULL, dom, true, 0)))\n        return -1;\n\n    ret = virLockManagerInquire(lock, state, 0);\n    virLockManagerFree(lock);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockManagerInquire",
          "args": [
            "lock",
            "state",
            "0"
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerInquire",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "369-378",
          "snippet": "int virLockManagerInquire(virLockManagerPtr lock,\n                          char **state,\n                          unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p state=%p flags=0x%x\", lock, state, flags);\n\n    CHECK_MANAGER(drvInquire, -1);\n\n    return lock->driver->drvInquire(lock, state, flags);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerInquire(virLockManagerPtr lock,\n                          char **state,\n                          unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p state=%p flags=0x%x\", lock, state, flags);\n\n    CHECK_MANAGER(drvInquire, -1);\n\n    return lock->driver->drvInquire(lock, state, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerNew",
          "args": [
            "plugin",
            "NULL",
            "dom",
            "true",
            "0"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "104-165",
          "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p state=%p\"",
            "plugin",
            "dom",
            "state"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nint virDomainLockProcessInquire(virLockManagerPluginPtr plugin,\n                                virDomainObjPtr dom,\n                                char **state)\n{\n    virLockManagerPtr lock;\n    int ret;\n\n    VIR_DEBUG(\"plugin=%p dom=%p state=%p\",\n              plugin, dom, state);\n\n    if (!(lock = virDomainLockManagerNew(plugin, NULL, dom, true, 0)))\n        return -1;\n\n    ret = virLockManagerInquire(lock, state, 0);\n    virLockManagerFree(lock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virDomainLockProcessResume",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "215-233",
    "snippet": "int virDomainLockProcessResume(virLockManagerPluginPtr plugin,\n                               const char *uri,\n                               virDomainObjPtr dom,\n                               const char *state)\n{\n    virLockManagerPtr lock;\n    int ret;\n\n    VIR_DEBUG(\"plugin=%p dom=%p state=%s\",\n              plugin, dom, NULLSTR(state));\n\n    if (!(lock = virDomainLockManagerNew(plugin, uri, dom, true, 0)))\n        return -1;\n\n    ret = virLockManagerAcquire(lock, state, 0, dom->def->onLockFailure, NULL);\n    virLockManagerFree(lock);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 230
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockManagerAcquire",
          "args": [
            "lock",
            "state",
            "0",
            "dom->def->onLockFailure",
            "NULL"
          ],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerAcquire",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "339-354",
          "snippet": "int virLockManagerAcquire(virLockManagerPtr lock,\n                          const char *state,\n                          unsigned int flags,\n                          virDomainLockFailureAction action,\n                          int *fd)\n{\n    VIR_DEBUG(\"lock=%p state='%s' flags=0x%x action=%d fd=%p\",\n              lock, NULLSTR(state), flags, action, fd);\n\n    CHECK_MANAGER(drvAcquire, -1);\n\n    if (fd)\n        *fd = -1;\n\n    return lock->driver->drvAcquire(lock, state, flags, action, fd);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerAcquire(virLockManagerPtr lock,\n                          const char *state,\n                          unsigned int flags,\n                          virDomainLockFailureAction action,\n                          int *fd)\n{\n    VIR_DEBUG(\"lock=%p state='%s' flags=0x%x action=%d fd=%p\",\n              lock, NULLSTR(state), flags, action, fd);\n\n    CHECK_MANAGER(drvAcquire, -1);\n\n    if (fd)\n        *fd = -1;\n\n    return lock->driver->drvAcquire(lock, state, flags, action, fd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerNew",
          "args": [
            "plugin",
            "uri",
            "dom",
            "true",
            "0"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "104-165",
          "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p state=%s\"",
            "plugin",
            "dom",
            "NULLSTR(state)"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "state"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nint virDomainLockProcessResume(virLockManagerPluginPtr plugin,\n                               const char *uri,\n                               virDomainObjPtr dom,\n                               const char *state)\n{\n    virLockManagerPtr lock;\n    int ret;\n\n    VIR_DEBUG(\"plugin=%p dom=%p state=%s\",\n              plugin, dom, NULLSTR(state));\n\n    if (!(lock = virDomainLockManagerNew(plugin, uri, dom, true, 0)))\n        return -1;\n\n    ret = virLockManagerAcquire(lock, state, 0, dom->def->onLockFailure, NULL);\n    virLockManagerFree(lock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virDomainLockProcessPause",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "196-213",
    "snippet": "int virDomainLockProcessPause(virLockManagerPluginPtr plugin,\n                              virDomainObjPtr dom,\n                              char **state)\n{\n    virLockManagerPtr lock;\n    int ret;\n\n    VIR_DEBUG(\"plugin=%p dom=%p state=%p\",\n              plugin, dom, state);\n\n    if (!(lock = virDomainLockManagerNew(plugin, NULL, dom, true, 0)))\n        return -1;\n\n    ret = virLockManagerRelease(lock, state, 0);\n    virLockManagerFree(lock);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockManagerRelease",
          "args": [
            "lock",
            "state",
            "0"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerRelease",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "357-366",
          "snippet": "int virLockManagerRelease(virLockManagerPtr lock,\n                          char **state,\n                          unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p state=%p flags=0x%x\", lock, state, flags);\n\n    CHECK_MANAGER(drvRelease, -1);\n\n    return lock->driver->drvRelease(lock, state, flags);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerRelease(virLockManagerPtr lock,\n                          char **state,\n                          unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p state=%p flags=0x%x\", lock, state, flags);\n\n    CHECK_MANAGER(drvRelease, -1);\n\n    return lock->driver->drvRelease(lock, state, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerNew",
          "args": [
            "plugin",
            "NULL",
            "dom",
            "true",
            "0"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "104-165",
          "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p state=%p\"",
            "plugin",
            "dom",
            "state"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nint virDomainLockProcessPause(virLockManagerPluginPtr plugin,\n                              virDomainObjPtr dom,\n                              char **state)\n{\n    virLockManagerPtr lock;\n    int ret;\n\n    VIR_DEBUG(\"plugin=%p dom=%p state=%p\",\n              plugin, dom, state);\n\n    if (!(lock = virDomainLockManagerNew(plugin, NULL, dom, true, 0)))\n        return -1;\n\n    ret = virLockManagerRelease(lock, state, 0);\n    virLockManagerFree(lock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virDomainLockProcessStart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "168-194",
    "snippet": "int virDomainLockProcessStart(virLockManagerPluginPtr plugin,\n                              const char *uri,\n                              virDomainObjPtr dom,\n                              bool paused,\n                              int *fd)\n{\n    virLockManagerPtr lock;\n    int ret;\n    int flags = VIR_LOCK_MANAGER_ACQUIRE_RESTRICT;\n\n    VIR_DEBUG(\"plugin=%p dom=%p paused=%d fd=%p\",\n              plugin, dom, paused, fd);\n\n    if (!(lock = virDomainLockManagerNew(plugin, uri, dom, true,\n                                         VIR_LOCK_MANAGER_NEW_STARTED)))\n        return -1;\n\n    if (paused)\n        flags |= VIR_LOCK_MANAGER_ACQUIRE_REGISTER_ONLY;\n\n    ret = virLockManagerAcquire(lock, NULL, flags,\n                                dom->def->onLockFailure, fd);\n\n    virLockManagerFree(lock);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockManagerAcquire",
          "args": [
            "lock",
            "NULL",
            "flags",
            "dom->def->onLockFailure",
            "fd"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerAcquire",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "339-354",
          "snippet": "int virLockManagerAcquire(virLockManagerPtr lock,\n                          const char *state,\n                          unsigned int flags,\n                          virDomainLockFailureAction action,\n                          int *fd)\n{\n    VIR_DEBUG(\"lock=%p state='%s' flags=0x%x action=%d fd=%p\",\n              lock, NULLSTR(state), flags, action, fd);\n\n    CHECK_MANAGER(drvAcquire, -1);\n\n    if (fd)\n        *fd = -1;\n\n    return lock->driver->drvAcquire(lock, state, flags, action, fd);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerAcquire(virLockManagerPtr lock,\n                          const char *state,\n                          unsigned int flags,\n                          virDomainLockFailureAction action,\n                          int *fd)\n{\n    VIR_DEBUG(\"lock=%p state='%s' flags=0x%x action=%d fd=%p\",\n              lock, NULLSTR(state), flags, action, fd);\n\n    CHECK_MANAGER(drvAcquire, -1);\n\n    if (fd)\n        *fd = -1;\n\n    return lock->driver->drvAcquire(lock, state, flags, action, fd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerNew",
          "args": [
            "plugin",
            "uri",
            "dom",
            "true",
            "VIR_LOCK_MANAGER_NEW_STARTED"
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "104-165",
          "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p paused=%d fd=%p\"",
            "plugin",
            "dom",
            "paused",
            "fd"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nint virDomainLockProcessStart(virLockManagerPluginPtr plugin,\n                              const char *uri,\n                              virDomainObjPtr dom,\n                              bool paused,\n                              int *fd)\n{\n    virLockManagerPtr lock;\n    int ret;\n    int flags = VIR_LOCK_MANAGER_ACQUIRE_RESTRICT;\n\n    VIR_DEBUG(\"plugin=%p dom=%p paused=%d fd=%p\",\n              plugin, dom, paused, fd);\n\n    if (!(lock = virDomainLockManagerNew(plugin, uri, dom, true,\n                                         VIR_LOCK_MANAGER_NEW_STARTED)))\n        return -1;\n\n    if (paused)\n        flags |= VIR_LOCK_MANAGER_ACQUIRE_REGISTER_ONLY;\n\n    ret = virLockManagerAcquire(lock, NULL, flags,\n                                dom->def->onLockFailure, fd);\n\n    virLockManagerFree(lock);\n\n    return ret;\n}"
  },
  {
    "function_name": "virDomainLockManagerNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "104-165",
    "snippet": "static virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockManagerFree",
          "args": [
            "lock"
          ],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "381-395",
          "snippet": "int virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerFree(virLockManagerPtr lock)\n{\n    VIR_DEBUG(\"lock=%p\", lock);\n\n    if (!lock)\n        return 0;\n\n    CHECK_MANAGER(drvFree, -1);\n\n    lock->driver->drvFree(lock);\n\n    VIR_FREE(lock);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerAddImage",
          "args": [
            "lock",
            "disk->src"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerAddImage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "71-101",
          "snippet": "static int virDomainLockManagerAddImage(virLockManagerPtr lock,\n                                        virStorageSourcePtr src)\n{\n    unsigned int diskFlags = 0;\n    int type = virStorageSourceGetActualType(src);\n\n    if (!src->path)\n        return 0;\n\n    if (!(type == VIR_STORAGE_TYPE_BLOCK ||\n          type == VIR_STORAGE_TYPE_FILE ||\n          type == VIR_STORAGE_TYPE_DIR))\n        return 0;\n\n    if (src->readonly)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_READONLY;\n    if (src->shared)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_SHARED;\n\n    VIR_DEBUG(\"Add disk %s\", src->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK,\n                                  src->path,\n                                  0,\n                                  NULL,\n                                  diskFlags) < 0) {\n        VIR_DEBUG(\"Failed add disk %s\", src->path);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic int virDomainLockManagerAddImage(virLockManagerPtr lock,\n                                        virStorageSourcePtr src)\n{\n    unsigned int diskFlags = 0;\n    int type = virStorageSourceGetActualType(src);\n\n    if (!src->path)\n        return 0;\n\n    if (!(type == VIR_STORAGE_TYPE_BLOCK ||\n          type == VIR_STORAGE_TYPE_FILE ||\n          type == VIR_STORAGE_TYPE_DIR))\n        return 0;\n\n    if (src->readonly)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_READONLY;\n    if (src->shared)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_SHARED;\n\n    VIR_DEBUG(\"Add disk %s\", src->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK,\n                                  src->path,\n                                  0,\n                                  NULL,\n                                  diskFlags) < 0) {\n        VIR_DEBUG(\"Failed add disk %s\", src->path);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Adding disks\""
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainLockManagerAddLease",
          "args": [
            "lock",
            "dom->def->leases[i]"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLockManagerAddLease",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
          "lines": "35-68",
          "snippet": "static int virDomainLockManagerAddLease(virLockManagerPtr lock,\n                                        virDomainLeaseDefPtr lease)\n{\n    unsigned int leaseFlags = 0;\n    virLockManagerParam lparams[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"path\",\n          .value = { .str = lease->path },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_ULONG,\n          .key = \"offset\",\n          .value = { .ul = lease->offset },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"lockspace\",\n          .value = { .str = lease->lockspace },\n        },\n    };\n    size_t nparams = G_N_ELEMENTS(lparams);\n    if (!lease->lockspace)\n        nparams--;\n\n    VIR_DEBUG(\"Add lease %s\", lease->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE,\n                                  lease->key,\n                                  nparams,\n                                  lparams,\n                                  leaseFlags) < 0) {\n        VIR_DEBUG(\"Failed to add lease %s\", lease->path);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_lock.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic int virDomainLockManagerAddLease(virLockManagerPtr lock,\n                                        virDomainLeaseDefPtr lease)\n{\n    unsigned int leaseFlags = 0;\n    virLockManagerParam lparams[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"path\",\n          .value = { .str = lease->path },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_ULONG,\n          .key = \"offset\",\n          .value = { .ul = lease->offset },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"lockspace\",\n          .value = { .str = lease->lockspace },\n        },\n    };\n    size_t nparams = G_N_ELEMENTS(lparams);\n    if (!lease->lockspace)\n        nparams--;\n\n    VIR_DEBUG(\"Add lease %s\", lease->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE,\n                                  lease->key,\n                                  nparams,\n                                  lparams,\n                                  leaseFlags) < 0) {\n        VIR_DEBUG(\"Failed to add lease %s\", lease->path);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Adding leases\""
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLockManagerNew",
          "args": [
            "virLockManagerPluginGetDriver(plugin)",
            "VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN",
            "G_N_ELEMENTS(params)",
            "params",
            "flags"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "293-317",
          "snippet": "virLockManagerPtr virLockManagerNew(virLockDriverPtr driver,\n                                    unsigned int type,\n                                    size_t nparams,\n                                    virLockManagerParamPtr params,\n                                    unsigned int flags)\n{\n    virLockManagerPtr lock;\n    VIR_DEBUG(\"driver=%p type=%u nparams=%zu params=%p flags=0x%x\",\n              driver, type, nparams, params, flags);\n    virLockManagerLogParams(nparams, params);\n\n    CHECK_DRIVER(drvNew, NULL);\n\n    if (VIR_ALLOC(lock) < 0)\n        return NULL;\n\n    lock->driver = driver;\n\n    if (driver->drvNew(lock, type, nparams, params, flags) < 0) {\n        VIR_FREE(lock);\n        return NULL;\n    }\n\n    return lock;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nvirLockManagerPtr virLockManagerNew(virLockDriverPtr driver,\n                                    unsigned int type,\n                                    size_t nparams,\n                                    virLockManagerParamPtr params,\n                                    unsigned int flags)\n{\n    virLockManagerPtr lock;\n    VIR_DEBUG(\"driver=%p type=%u nparams=%zu params=%p flags=0x%x\",\n              driver, type, nparams, params, flags);\n    virLockManagerLogParams(nparams, params);\n\n    CHECK_DRIVER(drvNew, NULL);\n\n    if (VIR_ALLOC(lock) < 0)\n        return NULL;\n\n    lock->driver = driver;\n\n    if (driver->drvNew(lock, type, nparams, params, flags) < 0) {\n        VIR_FREE(lock);\n        return NULL;\n    }\n\n    return lock;\n}"
        }
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "params"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLockManagerPluginGetDriver",
          "args": [
            "plugin"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerPluginGetDriver",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "275-280",
          "snippet": "virLockDriverPtr virLockManagerPluginGetDriver(virLockManagerPluginPtr plugin)\n{\n    VIR_DEBUG(\"plugin=%p\", plugin);\n\n    return plugin->driver;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nvirLockDriverPtr virLockManagerPluginGetDriver(virLockManagerPluginPtr plugin)\n{\n    VIR_DEBUG(\"plugin=%p\", plugin);\n\n    return plugin->driver;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "params[0].value.uuid",
            "dom->def->uuid",
            "VIR_UUID_BUFLEN"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"plugin=%p dom=%p withResources=%d\"",
            "plugin",
            "dom",
            "withResources"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic virLockManagerPtr virDomainLockManagerNew(virLockManagerPluginPtr plugin,\n                                                 const char *uri,\n                                                 virDomainObjPtr dom,\n                                                 bool withResources,\n                                                 unsigned int flags)\n{\n    virLockManagerPtr lock;\n    size_t i;\n    virLockManagerParam params[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UUID,\n          .key = \"uuid\",\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"name\",\n          .value = { .str = dom->def->name },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"id\",\n          .value = { .iv = dom->def->id },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_UINT,\n          .key = \"pid\",\n          .value = { .iv = dom->pid },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_CSTRING,\n          .key = \"uri\",\n          .value = { .cstr = uri },\n        },\n    };\n    VIR_DEBUG(\"plugin=%p dom=%p withResources=%d\",\n              plugin, dom, withResources);\n\n    memcpy(params[0].value.uuid, dom->def->uuid, VIR_UUID_BUFLEN);\n\n    if (!(lock = virLockManagerNew(virLockManagerPluginGetDriver(plugin),\n                                   VIR_LOCK_MANAGER_OBJECT_TYPE_DOMAIN,\n                                   G_N_ELEMENTS(params),\n                                   params,\n                                   flags)))\n        goto error;\n\n    if (withResources) {\n        VIR_DEBUG(\"Adding leases\");\n        for (i = 0; i < dom->def->nleases; i++)\n            if (virDomainLockManagerAddLease(lock, dom->def->leases[i]) < 0)\n                goto error;\n\n        VIR_DEBUG(\"Adding disks\");\n        for (i = 0; i < dom->def->ndisks; i++) {\n            virDomainDiskDefPtr disk = dom->def->disks[i];\n\n            if (virDomainLockManagerAddImage(lock, disk->src) < 0)\n                goto error;\n        }\n    }\n\n    return lock;\n\n error:\n    virLockManagerFree(lock);\n    return NULL;\n}"
  },
  {
    "function_name": "virDomainLockManagerAddImage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "71-101",
    "snippet": "static int virDomainLockManagerAddImage(virLockManagerPtr lock,\n                                        virStorageSourcePtr src)\n{\n    unsigned int diskFlags = 0;\n    int type = virStorageSourceGetActualType(src);\n\n    if (!src->path)\n        return 0;\n\n    if (!(type == VIR_STORAGE_TYPE_BLOCK ||\n          type == VIR_STORAGE_TYPE_FILE ||\n          type == VIR_STORAGE_TYPE_DIR))\n        return 0;\n\n    if (src->readonly)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_READONLY;\n    if (src->shared)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_SHARED;\n\n    VIR_DEBUG(\"Add disk %s\", src->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK,\n                                  src->path,\n                                  0,\n                                  NULL,\n                                  diskFlags) < 0) {\n        VIR_DEBUG(\"Failed add disk %s\", src->path);\n        return -1;\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Failed add disk %s\"",
            "src->path"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLockManagerAddResource",
          "args": [
            "lock",
            "VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK",
            "src->path",
            "0",
            "NULL",
            "diskFlags"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerAddResource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "320-337",
          "snippet": "int virLockManagerAddResource(virLockManagerPtr lock,\n                              unsigned int type,\n                              const char *name,\n                              size_t nparams,\n                              virLockManagerParamPtr params,\n                              unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p type=%u name=%s nparams=%zu params=%p flags=0x%x\",\n              lock, type, name, nparams, params, flags);\n    virLockManagerLogParams(nparams, params);\n\n    CHECK_MANAGER(drvAddResource, -1);\n\n    return lock->driver->drvAddResource(lock,\n                                        type, name,\n                                        nparams, params,\n                                        flags);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerAddResource(virLockManagerPtr lock,\n                              unsigned int type,\n                              const char *name,\n                              size_t nparams,\n                              virLockManagerParamPtr params,\n                              unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p type=%u name=%s nparams=%zu params=%p flags=0x%x\",\n              lock, type, name, nparams, params, flags);\n    virLockManagerLogParams(nparams, params);\n\n    CHECK_MANAGER(drvAddResource, -1);\n\n    return lock->driver->drvAddResource(lock,\n                                        type, name,\n                                        nparams, params,\n                                        flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Add disk %s\"",
            "src->path"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageSourceGetActualType",
          "args": [
            "src"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageSourceGetActualType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstoragefile.c",
          "lines": "2574-2583",
          "snippet": "int\nvirStorageSourceGetActualType(const virStorageSource *def)\n{\n    if (def->type == VIR_STORAGE_TYPE_VOLUME &&\n        def->srcpool &&\n        def->srcpool->actualtype != VIR_STORAGE_TYPE_NONE)\n        return def->srcpool->actualtype;\n\n    return def->type;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsecret.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"virjson.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruri.h\"",
            "#include \"virstring.h\"",
            "#include \"virendian.h\"",
            "#include \"virhash.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virstoragefilebackend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsecret.h\"\n#include \"virstorageencryption.h\"\n#include \"virjson.h\"\n#include \"virbuffer.h\"\n#include \"viruri.h\"\n#include \"virstring.h\"\n#include \"virendian.h\"\n#include \"virhash.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virstoragefilebackend.h\"\n#include <config.h>\n\nint\nvirStorageSourceGetActualType(const virStorageSource *def)\n{\n    if (def->type == VIR_STORAGE_TYPE_VOLUME &&\n        def->srcpool &&\n        def->srcpool->actualtype != VIR_STORAGE_TYPE_NONE)\n        return def->srcpool->actualtype;\n\n    return def->type;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic int virDomainLockManagerAddImage(virLockManagerPtr lock,\n                                        virStorageSourcePtr src)\n{\n    unsigned int diskFlags = 0;\n    int type = virStorageSourceGetActualType(src);\n\n    if (!src->path)\n        return 0;\n\n    if (!(type == VIR_STORAGE_TYPE_BLOCK ||\n          type == VIR_STORAGE_TYPE_FILE ||\n          type == VIR_STORAGE_TYPE_DIR))\n        return 0;\n\n    if (src->readonly)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_READONLY;\n    if (src->shared)\n        diskFlags |= VIR_LOCK_MANAGER_RESOURCE_SHARED;\n\n    VIR_DEBUG(\"Add disk %s\", src->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_DISK,\n                                  src->path,\n                                  0,\n                                  NULL,\n                                  diskFlags) < 0) {\n        VIR_DEBUG(\"Failed add disk %s\", src->path);\n        return -1;\n    }\n    return 0;\n}"
  },
  {
    "function_name": "virDomainLockManagerAddLease",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/domain_lock.c",
    "lines": "35-68",
    "snippet": "static int virDomainLockManagerAddLease(virLockManagerPtr lock,\n                                        virDomainLeaseDefPtr lease)\n{\n    unsigned int leaseFlags = 0;\n    virLockManagerParam lparams[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"path\",\n          .value = { .str = lease->path },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_ULONG,\n          .key = \"offset\",\n          .value = { .ul = lease->offset },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"lockspace\",\n          .value = { .str = lease->lockspace },\n        },\n    };\n    size_t nparams = G_N_ELEMENTS(lparams);\n    if (!lease->lockspace)\n        nparams--;\n\n    VIR_DEBUG(\"Add lease %s\", lease->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE,\n                                  lease->key,\n                                  nparams,\n                                  lparams,\n                                  leaseFlags) < 0) {\n        VIR_DEBUG(\"Failed to add lease %s\", lease->path);\n        return -1;\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"viralloc.h\"",
      "#include \"domain_lock.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Failed to add lease %s\"",
            "lease->path"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLockManagerAddResource",
          "args": [
            "lock",
            "VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE",
            "lease->key",
            "nparams",
            "lparams",
            "leaseFlags"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "virLockManagerAddResource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_manager.c",
          "lines": "320-337",
          "snippet": "int virLockManagerAddResource(virLockManagerPtr lock,\n                              unsigned int type,\n                              const char *name,\n                              size_t nparams,\n                              virLockManagerParamPtr params,\n                              unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p type=%u name=%s nparams=%zu params=%p flags=0x%x\",\n              lock, type, name, nparams, params, flags);\n    virLockManagerLogParams(nparams, params);\n\n    CHECK_MANAGER(drvAddResource, -1);\n\n    return lock->driver->drvAddResource(lock,\n                                        type, name,\n                                        nparams, params,\n                                        flags);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "# include <dlfcn.h>",
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"lock_driver_nop.h\"",
            "#include \"lock_manager.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include <unistd.h>\n# include <dlfcn.h>\n#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"lock_driver_nop.h\"\n#include \"lock_manager.h\"\n#include <config.h>\n\nint virLockManagerAddResource(virLockManagerPtr lock,\n                              unsigned int type,\n                              const char *name,\n                              size_t nparams,\n                              virLockManagerParamPtr params,\n                              unsigned int flags)\n{\n    VIR_DEBUG(\"lock=%p type=%u name=%s nparams=%zu params=%p flags=0x%x\",\n              lock, type, name, nparams, params, flags);\n    virLockManagerLogParams(nparams, params);\n\n    CHECK_MANAGER(drvAddResource, -1);\n\n    return lock->driver->drvAddResource(lock,\n                                        type, name,\n                                        nparams, params,\n                                        flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Add lease %s\"",
            "lease->path"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "lparams"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"domain_lock.h\"\n#include <config.h>\n\nstatic int virDomainLockManagerAddLease(virLockManagerPtr lock,\n                                        virDomainLeaseDefPtr lease)\n{\n    unsigned int leaseFlags = 0;\n    virLockManagerParam lparams[] = {\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"path\",\n          .value = { .str = lease->path },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_ULONG,\n          .key = \"offset\",\n          .value = { .ul = lease->offset },\n        },\n        { .type = VIR_LOCK_MANAGER_PARAM_TYPE_STRING,\n          .key = \"lockspace\",\n          .value = { .str = lease->lockspace },\n        },\n    };\n    size_t nparams = G_N_ELEMENTS(lparams);\n    if (!lease->lockspace)\n        nparams--;\n\n    VIR_DEBUG(\"Add lease %s\", lease->path);\n    if (virLockManagerAddResource(lock,\n                                  VIR_LOCK_MANAGER_RESOURCE_TYPE_LEASE,\n                                  lease->key,\n                                  nparams,\n                                  lparams,\n                                  leaseFlags) < 0) {\n        VIR_DEBUG(\"Failed to add lease %s\", lease->path);\n        return -1;\n    }\n    return 0;\n}"
  }
]