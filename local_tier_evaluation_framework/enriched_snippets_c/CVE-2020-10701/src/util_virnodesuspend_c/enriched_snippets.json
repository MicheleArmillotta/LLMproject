[
  {
    "function_name": "virNodeSuspendGetTargetMask",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "358-397",
    "snippet": "int\nvirNodeSuspendGetTargetMask(unsigned int *bitmask)\n{\n    int ret = -1;\n\n    *bitmask = 0;\n\n    virNodeSuspendLock();\n    /* Get the power management capabilities supported by the host */\n    if (!nodeSuspendTargetMaskInit) {\n        bool supported;\n        nodeSuspendTargetMask = 0;\n\n        /* Check support for Suspend-to-RAM (S3) */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_MEM, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_MEM);\n\n        /* Check support for Suspend-to-Disk (S4) */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_DISK, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_DISK);\n\n        /* Check support for Hybrid-Suspend */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_HYBRID, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_HYBRID);\n\n        nodeSuspendTargetMaskInit = true;\n    }\n\n    *bitmask = nodeSuspendTargetMask;\n    ret = 0;\n cleanup:\n    virNodeSuspendUnlock();\n    return ret;\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static unsigned int nodeSuspendTargetMask;",
      "static bool nodeSuspendTargetMaskInit;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeSuspendUnlock",
          "args": [],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "61-64",
          "snippet": "static void virNodeSuspendUnlock(void)\n{\n    virMutexUnlock(&virNodeSuspendMutex);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;\n\nstatic void virNodeSuspendUnlock(void)\n{\n    virMutexUnlock(&virNodeSuspendMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeSuspendSupportsTarget",
          "args": [
            "VIR_NODE_SUSPEND_TARGET_HYBRID",
            "&supported"
          ],
          "line": 384
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendSupportsTarget",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "326-344",
          "snippet": "static int\nvirNodeSuspendSupportsTarget(unsigned int target, bool *supported)\n{\n    int ret;\n\n    ret = virNodeSuspendSupportsTargetSystemd(target, supported);\n\n    /* If just unavailable, try other options */\n    if (ret == -2)\n        ret = virNodeSuspendSupportsTargetPMUtils(target, supported);\n\n    /* If still unavailable, then report unsupported */\n    if (ret == -2) {\n        *supported = false;\n        ret = 0;\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic int\nvirNodeSuspendSupportsTarget(unsigned int target, bool *supported)\n{\n    int ret;\n\n    ret = virNodeSuspendSupportsTargetSystemd(target, supported);\n\n    /* If just unavailable, try other options */\n    if (ret == -2)\n        ret = virNodeSuspendSupportsTargetPMUtils(target, supported);\n\n    /* If still unavailable, then report unsupported */\n    if (ret == -2) {\n        *supported = false;\n        ret = 0;\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeSuspendLock",
          "args": [],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "56-59",
          "snippet": "static void virNodeSuspendLock(void)\n{\n    virMutexLock(&virNodeSuspendMutex);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;\n\nstatic void virNodeSuspendLock(void)\n{\n    virMutexLock(&virNodeSuspendMutex);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic unsigned int nodeSuspendTargetMask;\nstatic bool nodeSuspendTargetMaskInit;\n\nint\nvirNodeSuspendGetTargetMask(unsigned int *bitmask)\n{\n    int ret = -1;\n\n    *bitmask = 0;\n\n    virNodeSuspendLock();\n    /* Get the power management capabilities supported by the host */\n    if (!nodeSuspendTargetMaskInit) {\n        bool supported;\n        nodeSuspendTargetMask = 0;\n\n        /* Check support for Suspend-to-RAM (S3) */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_MEM, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_MEM);\n\n        /* Check support for Suspend-to-Disk (S4) */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_DISK, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_DISK);\n\n        /* Check support for Hybrid-Suspend */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_HYBRID, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_HYBRID);\n\n        nodeSuspendTargetMaskInit = true;\n    }\n\n    *bitmask = nodeSuspendTargetMask;\n    ret = 0;\n cleanup:\n    virNodeSuspendUnlock();\n    return ret;\n}"
  },
  {
    "function_name": "virNodeSuspendSupportsTarget",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "326-344",
    "snippet": "static int\nvirNodeSuspendSupportsTarget(unsigned int target, bool *supported)\n{\n    int ret;\n\n    ret = virNodeSuspendSupportsTargetSystemd(target, supported);\n\n    /* If just unavailable, try other options */\n    if (ret == -2)\n        ret = virNodeSuspendSupportsTargetPMUtils(target, supported);\n\n    /* If still unavailable, then report unsupported */\n    if (ret == -2) {\n        *supported = false;\n        ret = 0;\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeSuspendSupportsTargetPMUtils",
          "args": [
            "target",
            "supported"
          ],
          "line": 335
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendSupportsTargetPMUtils",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "280-285",
          "snippet": "static int\nvirNodeSuspendSupportsTargetPMUtils(unsigned int target G_GNUC_UNUSED,\n                                    bool *supported G_GNUC_UNUSED)\n{\n    return -2;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic int\nvirNodeSuspendSupportsTargetPMUtils(unsigned int target G_GNUC_UNUSED,\n                                    bool *supported G_GNUC_UNUSED)\n{\n    return -2;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeSuspendSupportsTargetSystemd",
          "args": [
            "target",
            "supported"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendSupportsTargetSystemd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "288-310",
          "snippet": "static int\nvirNodeSuspendSupportsTargetSystemd(unsigned int target, bool *supported)\n{\n    int ret = -1;\n\n    *supported = false;\n\n    switch (target) {\n    case VIR_NODE_SUSPEND_TARGET_MEM:\n        ret = virSystemdCanSuspend(supported);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_DISK:\n        ret = virSystemdCanHibernate(supported);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_HYBRID:\n        ret = virSystemdCanHybridSleep(supported);\n        break;\n    default:\n        return ret;\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic int\nvirNodeSuspendSupportsTargetSystemd(unsigned int target, bool *supported)\n{\n    int ret = -1;\n\n    *supported = false;\n\n    switch (target) {\n    case VIR_NODE_SUSPEND_TARGET_MEM:\n        ret = virSystemdCanSuspend(supported);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_DISK:\n        ret = virSystemdCanHibernate(supported);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_HYBRID:\n        ret = virSystemdCanHybridSleep(supported);\n        break;\n    default:\n        return ret;\n    }\n\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic int\nvirNodeSuspendSupportsTarget(unsigned int target, bool *supported)\n{\n    int ret;\n\n    ret = virNodeSuspendSupportsTargetSystemd(target, supported);\n\n    /* If just unavailable, try other options */\n    if (ret == -2)\n        ret = virNodeSuspendSupportsTargetPMUtils(target, supported);\n\n    /* If still unavailable, then report unsupported */\n    if (ret == -2) {\n        *supported = false;\n        ret = 0;\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virNodeSuspendSupportsTargetSystemd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "288-310",
    "snippet": "static int\nvirNodeSuspendSupportsTargetSystemd(unsigned int target, bool *supported)\n{\n    int ret = -1;\n\n    *supported = false;\n\n    switch (target) {\n    case VIR_NODE_SUSPEND_TARGET_MEM:\n        ret = virSystemdCanSuspend(supported);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_DISK:\n        ret = virSystemdCanHibernate(supported);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_HYBRID:\n        ret = virSystemdCanHybridSleep(supported);\n        break;\n    default:\n        return ret;\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSystemdCanHybridSleep",
          "args": [
            "supported"
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdCanHybridSleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "609-612",
          "snippet": "int virSystemdCanHybridSleep(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanHybridSleep\", result);\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint virSystemdCanHybridSleep(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanHybridSleep\", result);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdCanHibernate",
          "args": [
            "supported"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdCanHibernate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "604-607",
          "snippet": "int virSystemdCanHibernate(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanHibernate\", result);\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint virSystemdCanHibernate(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanHibernate\", result);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSystemdCanSuspend",
          "args": [
            "supported"
          ],
          "line": 297
        },
        "resolved": true,
        "details": {
          "function_name": "virSystemdCanSuspend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsystemd.c",
          "lines": "599-602",
          "snippet": "int virSystemdCanSuspend(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanSuspend\", result);\n}",
          "includes": [
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virsystemdpriv.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virbuffer.h\"\n#include \"virsystemd.h\"\n#include \"virsystemdpriv.h\"\n#include <config.h>\n\nint virSystemdCanSuspend(bool *result)\n{\n    return virSystemdPMSupportTarget(\"CanSuspend\", result);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic int\nvirNodeSuspendSupportsTargetSystemd(unsigned int target, bool *supported)\n{\n    int ret = -1;\n\n    *supported = false;\n\n    switch (target) {\n    case VIR_NODE_SUSPEND_TARGET_MEM:\n        ret = virSystemdCanSuspend(supported);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_DISK:\n        ret = virSystemdCanHibernate(supported);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_HYBRID:\n        ret = virSystemdCanHybridSleep(supported);\n        break;\n    default:\n        return ret;\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virNodeSuspendSupportsTargetPMUtils",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "280-285",
    "snippet": "static int\nvirNodeSuspendSupportsTargetPMUtils(unsigned int target G_GNUC_UNUSED,\n                                    bool *supported G_GNUC_UNUSED)\n{\n    return -2;\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic int\nvirNodeSuspendSupportsTargetPMUtils(unsigned int target G_GNUC_UNUSED,\n                                    bool *supported G_GNUC_UNUSED)\n{\n    return -2;\n}"
  },
  {
    "function_name": "virNodeSuspendSupportsTargetPMUtils",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "241-278",
    "snippet": "static int\nvirNodeSuspendSupportsTargetPMUtils(unsigned int target, bool *supported)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *binary = NULL;\n    int status;\n\n    *supported = false;\n\n    binary = virFindFileInPath(\"pm-is-supported\");\n    if (!binary)\n        return -2;\n\n    switch (target) {\n    case VIR_NODE_SUSPEND_TARGET_MEM:\n        cmd = virCommandNewArgList(binary, \"--suspend\", NULL);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_DISK:\n        cmd = virCommandNewArgList(binary, \"--hibernate\", NULL);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_HYBRID:\n        cmd = virCommandNewArgList(binary, \"--suspend-hybrid\", NULL);\n        break;\n    default:\n        return -1;\n    }\n\n    if (virCommandRun(cmd, &status) < 0)\n        return -1;\n\n   /*\n    * Check return code of command == 0 for success\n    * (i.e., the PM capability is supported)\n    */\n    *supported = (status == 0);\n\n    return 0;\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "&status"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "binary",
            "\"--suspend-hybrid\"",
            "NULL"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFindFileInPath",
          "args": [
            "\"pm-is-supported\""
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "virFindFileInPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1657-1709",
          "snippet": "char *\nvirFindFileInPath(const char *file)\n{\n    const char *origpath = NULL;\n    VIR_AUTOSTRINGLIST paths = NULL;\n    char **pathiter;\n\n    if (file == NULL)\n        return NULL;\n\n    /* if we are passed an absolute path (starting with /), return a\n     * copy of that path, after validating that it is executable\n     */\n    if (g_path_is_absolute(file)) {\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        return g_strdup(file);\n    }\n\n    /* If we are passed an anchored path (containing a /), then there\n     * is no path search - it must exist in the current directory\n     */\n    if (strchr(file, '/')) {\n        char *abspath = NULL;\n\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        ignore_value(virFileAbsPath(file, &abspath));\n        return abspath;\n    }\n\n    /* copy PATH env so we can tweak it */\n    origpath = getenv(\"PATH\");\n    if (!origpath)\n        origpath = \"/bin:/usr/bin\";\n\n    /* for each path segment, append the file to search for and test for\n     * it. return it if found.\n     */\n\n    if (!(paths = virStringSplit(origpath, \":\", 0)))\n        return NULL;\n\n    for (pathiter = paths; *pathiter; pathiter++) {\n        g_autofree char *fullpath = g_strdup_printf(\"%s/%s\", *pathiter, file);\n        if (virFileIsExecutable(fullpath))\n            return g_steal_pointer(&fullpath);\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirFindFileInPath(const char *file)\n{\n    const char *origpath = NULL;\n    VIR_AUTOSTRINGLIST paths = NULL;\n    char **pathiter;\n\n    if (file == NULL)\n        return NULL;\n\n    /* if we are passed an absolute path (starting with /), return a\n     * copy of that path, after validating that it is executable\n     */\n    if (g_path_is_absolute(file)) {\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        return g_strdup(file);\n    }\n\n    /* If we are passed an anchored path (containing a /), then there\n     * is no path search - it must exist in the current directory\n     */\n    if (strchr(file, '/')) {\n        char *abspath = NULL;\n\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        ignore_value(virFileAbsPath(file, &abspath));\n        return abspath;\n    }\n\n    /* copy PATH env so we can tweak it */\n    origpath = getenv(\"PATH\");\n    if (!origpath)\n        origpath = \"/bin:/usr/bin\";\n\n    /* for each path segment, append the file to search for and test for\n     * it. return it if found.\n     */\n\n    if (!(paths = virStringSplit(origpath, \":\", 0)))\n        return NULL;\n\n    for (pathiter = paths; *pathiter; pathiter++) {\n        g_autofree char *fullpath = g_strdup_printf(\"%s/%s\", *pathiter, file);\n        if (virFileIsExecutable(fullpath))\n            return g_steal_pointer(&fullpath);\n    }\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic int\nvirNodeSuspendSupportsTargetPMUtils(unsigned int target, bool *supported)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *binary = NULL;\n    int status;\n\n    *supported = false;\n\n    binary = virFindFileInPath(\"pm-is-supported\");\n    if (!binary)\n        return -2;\n\n    switch (target) {\n    case VIR_NODE_SUSPEND_TARGET_MEM:\n        cmd = virCommandNewArgList(binary, \"--suspend\", NULL);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_DISK:\n        cmd = virCommandNewArgList(binary, \"--hibernate\", NULL);\n        break;\n    case VIR_NODE_SUSPEND_TARGET_HYBRID:\n        cmd = virCommandNewArgList(binary, \"--suspend-hybrid\", NULL);\n        break;\n    default:\n        return -1;\n    }\n\n    if (virCommandRun(cmd, &status) < 0)\n        return -1;\n\n   /*\n    * Check return code of command == 0 for success\n    * (i.e., the PM capability is supported)\n    */\n    *supported = (status == 0);\n\n    return 0;\n}"
  },
  {
    "function_name": "virNodeSuspend",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "161-238",
    "snippet": "int virNodeSuspend(unsigned int target,\n                   unsigned long long duration,\n                   unsigned int flags)\n{\n    static virThread thread;\n    const char *cmdString = NULL;\n    int ret = -1;\n    unsigned int supported;\n\n    virCheckFlags(0, -1);\n\n    if (virNodeSuspendGetTargetMask(&supported) < 0)\n        return -1;\n\n    /*\n     * Ensure that we are the only ones trying to suspend.\n     * Fail if somebody has already initiated a suspend.\n     */\n    virNodeSuspendLock();\n\n    if (aboutToSuspend) {\n        /* A suspend operation is already in progress */\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"Suspend operation already in progress\"));\n        goto cleanup;\n    }\n\n    /* Check if the host supports the requested suspend target */\n    switch (target) {\n    case VIR_NODE_SUSPEND_TARGET_MEM:\n        if (!(supported & (1 << VIR_NODE_SUSPEND_TARGET_MEM))) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, \"%s\", _(\"Suspend-to-RAM\"));\n            goto cleanup;\n        }\n        cmdString = \"pm-suspend\";\n        break;\n\n    case VIR_NODE_SUSPEND_TARGET_DISK:\n        if (!(supported & (1 << VIR_NODE_SUSPEND_TARGET_DISK))) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, \"%s\", _(\"Suspend-to-Disk\"));\n            goto cleanup;\n        }\n        cmdString = \"pm-hibernate\";\n        break;\n\n    case VIR_NODE_SUSPEND_TARGET_HYBRID:\n        if (!(supported & (1 << VIR_NODE_SUSPEND_TARGET_HYBRID))) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, \"%s\", _(\"Hybrid-Suspend\"));\n            goto cleanup;\n        }\n        cmdString = \"pm-suspend-hybrid\";\n        break;\n\n    default:\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\", _(\"Invalid suspend target\"));\n        goto cleanup;\n    }\n\n    /* Just set the RTC alarm. Don't suspend yet. */\n    if (virNodeSuspendSetNodeWakeup(duration) < 0)\n        goto cleanup;\n\n    if (virThreadCreateFull(&thread, false,\n                            virNodeSuspendHelper,\n                            \"node-suspend\",\n                            false,\n                            (void *)cmdString) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Failed to create thread to suspend the host\"));\n        goto cleanup;\n    }\n\n    aboutToSuspend = true;\n    ret = 0;\n cleanup:\n    virNodeSuspendUnlock();\n    return ret;\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bool aboutToSuspend;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeSuspendUnlock",
          "args": [],
          "line": 236
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "61-64",
          "snippet": "static void virNodeSuspendUnlock(void)\n{\n    virMutexUnlock(&virNodeSuspendMutex);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;\n\nstatic void virNodeSuspendUnlock(void)\n{\n    virMutexUnlock(&virNodeSuspendMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Failed to create thread to suspend the host\")"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to create thread to suspend the host\""
          ],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virThreadCreateFull",
          "args": [
            "&thread",
            "false",
            "virNodeSuspendHelper",
            "\"node-suspend\"",
            "false",
            "(void *)cmdString"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadCreateFull",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "242-283",
          "snippet": "int virThreadCreateFull(virThreadPtr thread,\n                        bool joinable,\n                        virThreadFunc func,\n                        const char *name,\n                        bool worker,\n                        void *opaque)\n{\n    struct virThreadArgs *args;\n    pthread_attr_t attr;\n    int ret = -1;\n    int err;\n\n    if ((err = pthread_attr_init(&attr)) != 0)\n        goto cleanup;\n    if (VIR_ALLOC_QUIET(args) < 0) {\n        err = ENOMEM;\n        goto cleanup;\n    }\n\n    args->func = func;\n    args->name = g_strdup(name);\n    args->worker = worker;\n    args->opaque = opaque;\n\n    if (!joinable)\n        pthread_attr_setdetachstate(&attr, 1);\n\n    err = pthread_create(&thread->thread, &attr, virThreadHelper, args);\n    if (err != 0) {\n        g_free(args->name);\n        g_free(args);\n        goto cleanup;\n    }\n    /* New thread owns 'args' in success case, so don't free */\n\n    ret = 0;\n cleanup:\n    pthread_attr_destroy(&attr);\n    if (ret < 0)\n        errno = err;\n    return ret;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadCreateFull(virThreadPtr thread,\n                        bool joinable,\n                        virThreadFunc func,\n                        const char *name,\n                        bool worker,\n                        void *opaque)\n{\n    struct virThreadArgs *args;\n    pthread_attr_t attr;\n    int ret = -1;\n    int err;\n\n    if ((err = pthread_attr_init(&attr)) != 0)\n        goto cleanup;\n    if (VIR_ALLOC_QUIET(args) < 0) {\n        err = ENOMEM;\n        goto cleanup;\n    }\n\n    args->func = func;\n    args->name = g_strdup(name);\n    args->worker = worker;\n    args->opaque = opaque;\n\n    if (!joinable)\n        pthread_attr_setdetachstate(&attr, 1);\n\n    err = pthread_create(&thread->thread, &attr, virThreadHelper, args);\n    if (err != 0) {\n        g_free(args->name);\n        g_free(args);\n        goto cleanup;\n    }\n    /* New thread owns 'args' in success case, so don't free */\n\n    ret = 0;\n cleanup:\n    pthread_attr_destroy(&attr);\n    if (ret < 0)\n        errno = err;\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeSuspendSetNodeWakeup",
          "args": [
            "duration"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendSetNodeWakeup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "74-97",
          "snippet": "static int virNodeSuspendSetNodeWakeup(unsigned long long alarmTime)\n{\n    virCommandPtr setAlarmCmd;\n    int ret = -1;\n\n    if (alarmTime < MIN_TIME_REQ_FOR_SUSPEND) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Suspend duration is too short, must be at least %u seconds\"),\n                       MIN_TIME_REQ_FOR_SUSPEND);\n        return -1;\n    }\n\n    setAlarmCmd = virCommandNewArgList(\"rtcwake\", \"-m\", \"no\", \"-s\", NULL);\n    virCommandAddArgFormat(setAlarmCmd, \"%lld\", alarmTime);\n\n    if (virCommandRun(setAlarmCmd, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virCommandFree(setAlarmCmd);\n    return ret;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MIN_TIME_REQ_FOR_SUSPEND 60 /* in seconds */"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\n#define MIN_TIME_REQ_FOR_SUSPEND 60 /* in seconds */\n\nstatic int virNodeSuspendSetNodeWakeup(unsigned long long alarmTime)\n{\n    virCommandPtr setAlarmCmd;\n    int ret = -1;\n\n    if (alarmTime < MIN_TIME_REQ_FOR_SUSPEND) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Suspend duration is too short, must be at least %u seconds\"),\n                       MIN_TIME_REQ_FOR_SUSPEND);\n        return -1;\n    }\n\n    setAlarmCmd = virCommandNewArgList(\"rtcwake\", \"-m\", \"no\", \"-s\", NULL);\n    virCommandAddArgFormat(setAlarmCmd, \"%lld\", alarmTime);\n\n    if (virCommandRun(setAlarmCmd, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virCommandFree(setAlarmCmd);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "\"%s\"",
            "_(\"Invalid suspend target\")"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_ARGUMENT_UNSUPPORTED",
            "\"%s\"",
            "_(\"Hybrid-Suspend\")"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_ARGUMENT_UNSUPPORTED",
            "\"%s\"",
            "_(\"Suspend-to-Disk\")"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_ARGUMENT_UNSUPPORTED",
            "\"%s\"",
            "_(\"Suspend-to-RAM\")"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "\"%s\"",
            "_(\"Suspend operation already in progress\")"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeSuspendLock",
          "args": [],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "56-59",
          "snippet": "static void virNodeSuspendLock(void)\n{\n    virMutexLock(&virNodeSuspendMutex);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;\n\nstatic void virNodeSuspendLock(void)\n{\n    virMutexLock(&virNodeSuspendMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeSuspendGetTargetMask",
          "args": [
            "&supported"
          ],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendGetTargetMask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "358-397",
          "snippet": "int\nvirNodeSuspendGetTargetMask(unsigned int *bitmask)\n{\n    int ret = -1;\n\n    *bitmask = 0;\n\n    virNodeSuspendLock();\n    /* Get the power management capabilities supported by the host */\n    if (!nodeSuspendTargetMaskInit) {\n        bool supported;\n        nodeSuspendTargetMask = 0;\n\n        /* Check support for Suspend-to-RAM (S3) */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_MEM, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_MEM);\n\n        /* Check support for Suspend-to-Disk (S4) */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_DISK, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_DISK);\n\n        /* Check support for Hybrid-Suspend */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_HYBRID, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_HYBRID);\n\n        nodeSuspendTargetMaskInit = true;\n    }\n\n    *bitmask = nodeSuspendTargetMask;\n    ret = 0;\n cleanup:\n    virNodeSuspendUnlock();\n    return ret;\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static unsigned int nodeSuspendTargetMask;",
            "static bool nodeSuspendTargetMaskInit;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic unsigned int nodeSuspendTargetMask;\nstatic bool nodeSuspendTargetMaskInit;\n\nint\nvirNodeSuspendGetTargetMask(unsigned int *bitmask)\n{\n    int ret = -1;\n\n    *bitmask = 0;\n\n    virNodeSuspendLock();\n    /* Get the power management capabilities supported by the host */\n    if (!nodeSuspendTargetMaskInit) {\n        bool supported;\n        nodeSuspendTargetMask = 0;\n\n        /* Check support for Suspend-to-RAM (S3) */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_MEM, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_MEM);\n\n        /* Check support for Suspend-to-Disk (S4) */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_DISK, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_DISK);\n\n        /* Check support for Hybrid-Suspend */\n        if (virNodeSuspendSupportsTarget(VIR_NODE_SUSPEND_TARGET_HYBRID, &supported) < 0)\n            goto cleanup;\n        if (supported)\n            nodeSuspendTargetMask |= (1 << VIR_NODE_SUSPEND_TARGET_HYBRID);\n\n        nodeSuspendTargetMaskInit = true;\n    }\n\n    *bitmask = nodeSuspendTargetMask;\n    ret = 0;\n cleanup:\n    virNodeSuspendUnlock();\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic bool aboutToSuspend;\n\nint virNodeSuspend(unsigned int target,\n                   unsigned long long duration,\n                   unsigned int flags)\n{\n    static virThread thread;\n    const char *cmdString = NULL;\n    int ret = -1;\n    unsigned int supported;\n\n    virCheckFlags(0, -1);\n\n    if (virNodeSuspendGetTargetMask(&supported) < 0)\n        return -1;\n\n    /*\n     * Ensure that we are the only ones trying to suspend.\n     * Fail if somebody has already initiated a suspend.\n     */\n    virNodeSuspendLock();\n\n    if (aboutToSuspend) {\n        /* A suspend operation is already in progress */\n        virReportError(VIR_ERR_OPERATION_INVALID, \"%s\",\n                       _(\"Suspend operation already in progress\"));\n        goto cleanup;\n    }\n\n    /* Check if the host supports the requested suspend target */\n    switch (target) {\n    case VIR_NODE_SUSPEND_TARGET_MEM:\n        if (!(supported & (1 << VIR_NODE_SUSPEND_TARGET_MEM))) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, \"%s\", _(\"Suspend-to-RAM\"));\n            goto cleanup;\n        }\n        cmdString = \"pm-suspend\";\n        break;\n\n    case VIR_NODE_SUSPEND_TARGET_DISK:\n        if (!(supported & (1 << VIR_NODE_SUSPEND_TARGET_DISK))) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, \"%s\", _(\"Suspend-to-Disk\"));\n            goto cleanup;\n        }\n        cmdString = \"pm-hibernate\";\n        break;\n\n    case VIR_NODE_SUSPEND_TARGET_HYBRID:\n        if (!(supported & (1 << VIR_NODE_SUSPEND_TARGET_HYBRID))) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED, \"%s\", _(\"Hybrid-Suspend\"));\n            goto cleanup;\n        }\n        cmdString = \"pm-suspend-hybrid\";\n        break;\n\n    default:\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\", _(\"Invalid suspend target\"));\n        goto cleanup;\n    }\n\n    /* Just set the RTC alarm. Don't suspend yet. */\n    if (virNodeSuspendSetNodeWakeup(duration) < 0)\n        goto cleanup;\n\n    if (virThreadCreateFull(&thread, false,\n                            virNodeSuspendHelper,\n                            \"node-suspend\",\n                            false,\n                            (void *)cmdString) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Failed to create thread to suspend the host\"));\n        goto cleanup;\n    }\n\n    aboutToSuspend = true;\n    ret = 0;\n cleanup:\n    virNodeSuspendUnlock();\n    return ret;\n}"
  },
  {
    "function_name": "virNodeSuspendHelper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "111-132",
    "snippet": "static void virNodeSuspendHelper(void *cmdString)\n{\n    virCommandPtr suspendCmd = virCommandNew((const char *)cmdString);\n\n    /*\n     * Delay for sometime so that the function virNodeSuspend()\n     * can return the status to the caller.\n     */\n    sleep(SUSPEND_DELAY);\n    if (virCommandRun(suspendCmd, NULL) < 0)\n        VIR_WARN(\"Failed to suspend the host\");\n\n    virCommandFree(suspendCmd);\n\n    /*\n     * Now that we have resumed from suspend or the suspend failed,\n     * reset 'aboutToSuspend' flag.\n     */\n    virNodeSuspendLock();\n    aboutToSuspend = false;\n    virNodeSuspendUnlock();\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SUSPEND_DELAY 10 /* in seconds */"
    ],
    "globals_used": [
      "static bool aboutToSuspend;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeSuspendUnlock",
          "args": [],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "61-64",
          "snippet": "static void virNodeSuspendUnlock(void)\n{\n    virMutexUnlock(&virNodeSuspendMutex);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;\n\nstatic void virNodeSuspendUnlock(void)\n{\n    virMutexUnlock(&virNodeSuspendMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeSuspendLock",
          "args": [],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeSuspendLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
          "lines": "56-59",
          "snippet": "static void virNodeSuspendLock(void)\n{\n    virMutexLock(&virNodeSuspendMutex);\n}",
          "includes": [
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virthread.h\"",
            "#include \"vircommand.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virnodesuspend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;\n\nstatic void virNodeSuspendLock(void)\n{\n    virMutexLock(&virNodeSuspendMutex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "suspendCmd"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to suspend the host\""
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "suspendCmd",
            "NULL"
          ],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "SUSPEND_DELAY"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "(const char *)cmdString"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\n#define SUSPEND_DELAY 10 /* in seconds */\n\nstatic bool aboutToSuspend;\n\nstatic void virNodeSuspendHelper(void *cmdString)\n{\n    virCommandPtr suspendCmd = virCommandNew((const char *)cmdString);\n\n    /*\n     * Delay for sometime so that the function virNodeSuspend()\n     * can return the status to the caller.\n     */\n    sleep(SUSPEND_DELAY);\n    if (virCommandRun(suspendCmd, NULL) < 0)\n        VIR_WARN(\"Failed to suspend the host\");\n\n    virCommandFree(suspendCmd);\n\n    /*\n     * Now that we have resumed from suspend or the suspend failed,\n     * reset 'aboutToSuspend' flag.\n     */\n    virNodeSuspendLock();\n    aboutToSuspend = false;\n    virNodeSuspendUnlock();\n}"
  },
  {
    "function_name": "virNodeSuspendSetNodeWakeup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "74-97",
    "snippet": "static int virNodeSuspendSetNodeWakeup(unsigned long long alarmTime)\n{\n    virCommandPtr setAlarmCmd;\n    int ret = -1;\n\n    if (alarmTime < MIN_TIME_REQ_FOR_SUSPEND) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Suspend duration is too short, must be at least %u seconds\"),\n                       MIN_TIME_REQ_FOR_SUSPEND);\n        return -1;\n    }\n\n    setAlarmCmd = virCommandNewArgList(\"rtcwake\", \"-m\", \"no\", \"-s\", NULL);\n    virCommandAddArgFormat(setAlarmCmd, \"%lld\", alarmTime);\n\n    if (virCommandRun(setAlarmCmd, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virCommandFree(setAlarmCmd);\n    return ret;\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define MIN_TIME_REQ_FOR_SUSPEND 60 /* in seconds */"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "setAlarmCmd"
          ],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "setAlarmCmd",
            "NULL"
          ],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgFormat",
          "args": [
            "setAlarmCmd",
            "\"%lld\"",
            "alarmTime"
          ],
          "line": 87
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1569-1590",
          "snippet": "void\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "\"rtcwake\"",
            "\"-m\"",
            "\"no\"",
            "\"-s\"",
            "NULL"
          ],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "_(\"Suspend duration is too short, must be at least %u seconds\")",
            "MIN_TIME_REQ_FOR_SUSPEND"
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Suspend duration is too short, must be at least %u seconds\""
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\n#define MIN_TIME_REQ_FOR_SUSPEND 60 /* in seconds */\n\nstatic int virNodeSuspendSetNodeWakeup(unsigned long long alarmTime)\n{\n    virCommandPtr setAlarmCmd;\n    int ret = -1;\n\n    if (alarmTime < MIN_TIME_REQ_FOR_SUSPEND) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"Suspend duration is too short, must be at least %u seconds\"),\n                       MIN_TIME_REQ_FOR_SUSPEND);\n        return -1;\n    }\n\n    setAlarmCmd = virCommandNewArgList(\"rtcwake\", \"-m\", \"no\", \"-s\", NULL);\n    virCommandAddArgFormat(setAlarmCmd, \"%lld\", alarmTime);\n\n    if (virCommandRun(setAlarmCmd, NULL) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virCommandFree(setAlarmCmd);\n    return ret;\n}"
  },
  {
    "function_name": "virNodeSuspendUnlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "61-64",
    "snippet": "static void virNodeSuspendUnlock(void)\n{\n    virMutexUnlock(&virNodeSuspendMutex);\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&virNodeSuspendMutex"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;\n\nstatic void virNodeSuspendUnlock(void)\n{\n    virMutexUnlock(&virNodeSuspendMutex);\n}"
  },
  {
    "function_name": "virNodeSuspendLock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnodesuspend.c",
    "lines": "56-59",
    "snippet": "static void virNodeSuspendLock(void)\n{\n    virMutexLock(&virNodeSuspendMutex);\n}",
    "includes": [
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virthread.h\"",
      "#include \"vircommand.h\"",
      "#include \"virsystemd.h\"",
      "#include \"virnodesuspend.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&virNodeSuspendMutex"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virthread.h\"\n#include \"vircommand.h\"\n#include \"virsystemd.h\"\n#include \"virnodesuspend.h\"\n#include <config.h>\n\nstatic virMutex virNodeSuspendMutex = VIR_MUTEX_INITIALIZER;\n\nstatic void virNodeSuspendLock(void)\n{\n    virMutexLock(&virNodeSuspendMutex);\n}"
  }
]