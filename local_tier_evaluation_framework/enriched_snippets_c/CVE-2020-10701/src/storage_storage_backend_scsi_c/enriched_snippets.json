[
  {
    "function_name": "virStorageBackendSCSIRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "458-462",
    "snippet": "int\nvirStorageBackendSCSIRegister(void)\n{\n    return virStorageBackendRegister(&virStorageBackendSCSI);\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virStorageBackend virStorageBackendSCSI = {\n    .type = VIR_STORAGE_POOL_SCSI,\n\n    .checkPool = virStorageBackendSCSICheckPool,\n    .refreshPool = virStorageBackendSCSIRefreshPool,\n    .startPool = virStorageBackendSCSIStartPool,\n    .stopPool = virStorageBackendSCSIStopPool,\n    .uploadVol = virStorageBackendVolUploadLocal,\n    .downloadVol = virStorageBackendVolDownloadLocal,\n    .wipeVol = virStorageBackendVolWipeLocal,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRegister",
          "args": [
            "&virStorageBackendSCSI"
          ],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend.c",
          "lines": "153-169",
          "snippet": "int\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}",
          "includes": [
            "# include \"storage_backend_vstorage.h\"",
            "# include \"storage_backend_zfs.h\"",
            "# include \"storage_backend_gluster.h\"",
            "# include \"storage_backend_sheepdog.h\"",
            "# include \"storage_backend_rbd.h\"",
            "# include \"storage_backend_fs.h\"",
            "# include \"storage_backend_disk.h\"",
            "# include \"storage_backend_mpath.h\"",
            "# include \"storage_backend_scsi.h\"",
            "# include \"storage_backend_iscsi_direct.h\"",
            "# include \"storage_backend_iscsi.h\"",
            "# include \"storage_backend_logical.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_STORAGE_BACKENDS_MAX 20"
          ],
          "globals_used": [
            "static virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];",
            "static size_t virStorageBackendsCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include \"storage_backend_vstorage.h\"\n# include \"storage_backend_zfs.h\"\n# include \"storage_backend_gluster.h\"\n# include \"storage_backend_sheepdog.h\"\n# include \"storage_backend_rbd.h\"\n# include \"storage_backend_fs.h\"\n# include \"storage_backend_disk.h\"\n# include \"storage_backend_mpath.h\"\n# include \"storage_backend_scsi.h\"\n# include \"storage_backend_iscsi_direct.h\"\n# include \"storage_backend_iscsi.h\"\n# include \"storage_backend_logical.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"storage_backend.h\"\n#include \"virstoragefile.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\n#define VIR_STORAGE_BACKENDS_MAX 20\n\nstatic virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];\nstatic size_t virStorageBackendsCount;\n\nint\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirStorageBackend virStorageBackendSCSI = {\n    .type = VIR_STORAGE_POOL_SCSI,\n\n    .checkPool = virStorageBackendSCSICheckPool,\n    .refreshPool = virStorageBackendSCSIRefreshPool,\n    .startPool = virStorageBackendSCSIStartPool,\n    .stopPool = virStorageBackendSCSIStopPool,\n    .uploadVol = virStorageBackendVolUploadLocal,\n    .downloadVol = virStorageBackendVolDownloadLocal,\n    .wipeVol = virStorageBackendVolWipeLocal,\n};\n\nint\nvirStorageBackendSCSIRegister(void)\n{\n    return virStorageBackendRegister(&virStorageBackendSCSI);\n}"
  },
  {
    "function_name": "virStorageBackendSCSIStopPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "424-443",
    "snippet": "static int\nvirStorageBackendSCSIStopPool(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->source.adapter.type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n        virConnectPtr conn;\n        int ret;\n        conn = virGetConnectNodeDev();\n        if (!conn)\n            return -1;\n\n        ret = virNodeDeviceDeleteVport(conn,\n                                       &def->source.adapter.data.fchost);\n        virObjectUnref(conn);\n        return ret;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "conn"
          ],
          "line": 438
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceDeleteVport",
          "args": [
            "conn",
            "&def->source.adapter.data.fchost"
          ],
          "line": 436
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceDeleteVport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_util.c",
          "lines": "160-229",
          "snippet": "int\nvirNodeDeviceDeleteVport(virConnectPtr conn,\n                         virStorageAdapterFCHostPtr fchost)\n{\n    char *name = NULL;\n    char *scsi_host_name = NULL;\n    unsigned int parent_host;\n    char *vhba_parent = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"conn=%p parent='%s', managed='%d' wwnn='%s' wwpn='%s'\",\n              conn, NULLSTR(fchost->parent), fchost->managed,\n              fchost->wwnn, fchost->wwpn);\n\n    /* If we're not managing the deletion of the vHBA, then just return */\n    if (fchost->managed != VIR_TRISTATE_BOOL_YES)\n        return 0;\n\n    /* Find our vHBA by searching the fc_host sysfs tree for our wwnn/wwpn */\n    if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to find fc_host for wwnn='%s' and wwpn='%s'\"),\n                       fchost->wwnn, fchost->wwpn);\n        goto cleanup;\n    }\n\n    scsi_host_name = g_strdup_printf(\"scsi_%s\", name);\n\n    /* If at startup time we provided a parent, then use that to\n     * get the parent_host value; otherwise, we have to determine\n     * the parent scsi_host which we did not save at startup time\n     */\n    if (fchost->parent) {\n        /* Someone provided a parent string at startup time that\n         * was the same as the scsi_host - meaning we have a pool\n         * backed to an HBA, so there won't be a vHBA to delete */\n        if (STREQ(scsi_host_name, fchost->parent)) {\n            ret = 0;\n            goto cleanup;\n        }\n\n        if (virSCSIHostGetNumber(fchost->parent, &parent_host) < 0)\n            goto cleanup;\n    } else {\n        if (!(vhba_parent = virNodeDeviceGetParentName(conn, scsi_host_name)))\n            goto cleanup;\n\n        /* If the parent is not a scsi_host, then this is a pool backed\n         * directly to an HBA and there's no vHBA to remove - so we're done */\n        if (!STRPREFIX(vhba_parent, \"scsi_host\")) {\n            ret = 0;\n            goto cleanup;\n        }\n\n        if (virSCSIHostGetNumber(vhba_parent, &parent_host) < 0)\n            goto cleanup;\n    }\n\n    if (virVHBAManageVport(parent_host, fchost->wwpn, fchost->wwnn,\n                           VPORT_DELETE) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(name);\n    VIR_FREE(vhba_parent);\n    VIR_FREE(scsi_host_name);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"node_device_util.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"node_device_util.h\"\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirNodeDeviceDeleteVport(virConnectPtr conn,\n                         virStorageAdapterFCHostPtr fchost)\n{\n    char *name = NULL;\n    char *scsi_host_name = NULL;\n    unsigned int parent_host;\n    char *vhba_parent = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"conn=%p parent='%s', managed='%d' wwnn='%s' wwpn='%s'\",\n              conn, NULLSTR(fchost->parent), fchost->managed,\n              fchost->wwnn, fchost->wwpn);\n\n    /* If we're not managing the deletion of the vHBA, then just return */\n    if (fchost->managed != VIR_TRISTATE_BOOL_YES)\n        return 0;\n\n    /* Find our vHBA by searching the fc_host sysfs tree for our wwnn/wwpn */\n    if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to find fc_host for wwnn='%s' and wwpn='%s'\"),\n                       fchost->wwnn, fchost->wwpn);\n        goto cleanup;\n    }\n\n    scsi_host_name = g_strdup_printf(\"scsi_%s\", name);\n\n    /* If at startup time we provided a parent, then use that to\n     * get the parent_host value; otherwise, we have to determine\n     * the parent scsi_host which we did not save at startup time\n     */\n    if (fchost->parent) {\n        /* Someone provided a parent string at startup time that\n         * was the same as the scsi_host - meaning we have a pool\n         * backed to an HBA, so there won't be a vHBA to delete */\n        if (STREQ(scsi_host_name, fchost->parent)) {\n            ret = 0;\n            goto cleanup;\n        }\n\n        if (virSCSIHostGetNumber(fchost->parent, &parent_host) < 0)\n            goto cleanup;\n    } else {\n        if (!(vhba_parent = virNodeDeviceGetParentName(conn, scsi_host_name)))\n            goto cleanup;\n\n        /* If the parent is not a scsi_host, then this is a pool backed\n         * directly to an HBA and there's no vHBA to remove - so we're done */\n        if (!STRPREFIX(vhba_parent, \"scsi_host\")) {\n            ret = 0;\n            goto cleanup;\n        }\n\n        if (virSCSIHostGetNumber(vhba_parent, &parent_host) < 0)\n            goto cleanup;\n    }\n\n    if (virVHBAManageVport(parent_host, fchost->wwpn, fchost->wwnn,\n                           VPORT_DELETE) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(name);\n    VIR_FREE(vhba_parent);\n    VIR_FREE(scsi_host_name);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetConnectNodeDev",
          "args": [],
          "line": 432
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectNodeDev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "179-182",
          "snippet": "virConnectPtr virGetConnectNodeDev(void)\n{\n    return virGetConnectGeneric(&connectNodeDev, \"nodedev\");\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virThreadLocal connectNodeDev;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectNodeDev;\n\nvirConnectPtr virGetConnectNodeDev(void)\n{\n    return virGetConnectGeneric(&connectNodeDev, \"nodedev\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendSCSIStopPool(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->source.adapter.type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n        virConnectPtr conn;\n        int ret;\n        conn = virGetConnectNodeDev();\n        if (!conn)\n            return -1;\n\n        ret = virNodeDeviceDeleteVport(conn,\n                                       &def->source.adapter.data.fchost);\n        virObjectUnref(conn);\n        return ret;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendSCSIStartPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "410-421",
    "snippet": "static int\nvirStorageBackendSCSIStartPool(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *configFile = virStoragePoolObjGetConfigFile(pool);\n\n    if (def->source.adapter.type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST)\n        return createVport(def, configFile,\n                           &def->source.adapter.data.fchost);\n\n    return 0;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "createVport",
          "args": [
            "def",
            "configFile",
            "&def->source.adapter.data.fchost"
          ],
          "line": 417
        },
        "resolved": true,
        "details": {
          "function_name": "createVport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "283-346",
          "snippet": "static int\ncreateVport(virStoragePoolDefPtr def,\n            const char *configFile,\n            virStorageAdapterFCHostPtr fchost)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = NULL;\n    virThread thread;\n    g_autofree char *name = NULL;\n\n    VIR_DEBUG(\"configFile='%s' parent='%s', wwnn='%s' wwpn='%s'\",\n              NULLSTR(configFile), NULLSTR(fchost->parent),\n              fchost->wwnn, fchost->wwpn);\n\n    /* If we find an existing HBA/vHBA within the fc_host sysfs\n     * using the wwnn/wwpn, then a nodedev is already created for\n     * this pool and we don't have to create the vHBA\n     */\n    if ((name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n        if (!(checkName(name)))\n            return -1;\n\n        /* If a parent was provided, let's make sure the 'name' we've\n         * retrieved has the same parent. If not this will cause failure. */\n        if (!fchost->parent || checkParent(name, fchost->parent))\n            return 0;\n\n        return -1;\n    }\n\n    /* Since we're creating the vHBA, then we need to manage removing it\n     * as well. Since we need this setting to \"live\" through a libvirtd\n     * restart, we need to save the persistent configuration. So if not\n     * already defined as YES, then force the issue.\n     */\n    if (fchost->managed != VIR_TRISTATE_BOOL_YES) {\n        fchost->managed = VIR_TRISTATE_BOOL_YES;\n        if (configFile) {\n            if (virStoragePoolSaveConfig(configFile, def) < 0)\n                return -1;\n        }\n    }\n\n    if (!(name = virNodeDeviceCreateVport(fchost)))\n        return -1;\n\n    /* Creating our own VPORT didn't leave enough time to find any LUN's,\n     * so, let's create a thread whose job it is to call the FindLU's with\n     * retry logic set to true. If the thread isn't created, then no big\n     * deal since it's still possible to refresh the pool later.\n     */\n    if (VIR_ALLOC(cbdata) == 0) {\n        memcpy(cbdata->pool_uuid, def->uuid, VIR_UUID_BUFLEN);\n        cbdata->fchost_name = g_steal_pointer(&name);\n\n        if (virThreadCreateFull(&thread, false, virStoragePoolFCRefreshThread,\n                                \"scsi-refresh\", false, cbdata) < 0) {\n            /* Oh well - at least someone can still refresh afterwards */\n            VIR_DEBUG(\"Failed to create FC Pool Refresh Thread\");\n            virStoragePoolFCRefreshDataFree(cbdata);\n        }\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\ncreateVport(virStoragePoolDefPtr def,\n            const char *configFile,\n            virStorageAdapterFCHostPtr fchost)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = NULL;\n    virThread thread;\n    g_autofree char *name = NULL;\n\n    VIR_DEBUG(\"configFile='%s' parent='%s', wwnn='%s' wwpn='%s'\",\n              NULLSTR(configFile), NULLSTR(fchost->parent),\n              fchost->wwnn, fchost->wwpn);\n\n    /* If we find an existing HBA/vHBA within the fc_host sysfs\n     * using the wwnn/wwpn, then a nodedev is already created for\n     * this pool and we don't have to create the vHBA\n     */\n    if ((name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n        if (!(checkName(name)))\n            return -1;\n\n        /* If a parent was provided, let's make sure the 'name' we've\n         * retrieved has the same parent. If not this will cause failure. */\n        if (!fchost->parent || checkParent(name, fchost->parent))\n            return 0;\n\n        return -1;\n    }\n\n    /* Since we're creating the vHBA, then we need to manage removing it\n     * as well. Since we need this setting to \"live\" through a libvirtd\n     * restart, we need to save the persistent configuration. So if not\n     * already defined as YES, then force the issue.\n     */\n    if (fchost->managed != VIR_TRISTATE_BOOL_YES) {\n        fchost->managed = VIR_TRISTATE_BOOL_YES;\n        if (configFile) {\n            if (virStoragePoolSaveConfig(configFile, def) < 0)\n                return -1;\n        }\n    }\n\n    if (!(name = virNodeDeviceCreateVport(fchost)))\n        return -1;\n\n    /* Creating our own VPORT didn't leave enough time to find any LUN's,\n     * so, let's create a thread whose job it is to call the FindLU's with\n     * retry logic set to true. If the thread isn't created, then no big\n     * deal since it's still possible to refresh the pool later.\n     */\n    if (VIR_ALLOC(cbdata) == 0) {\n        memcpy(cbdata->pool_uuid, def->uuid, VIR_UUID_BUFLEN);\n        cbdata->fchost_name = g_steal_pointer(&name);\n\n        if (virThreadCreateFull(&thread, false, virStoragePoolFCRefreshThread,\n                                \"scsi-refresh\", false, cbdata) < 0) {\n            /* Oh well - at least someone can still refresh afterwards */\n            VIR_DEBUG(\"Failed to create FC Pool Refresh Thread\");\n            virStoragePoolFCRefreshDataFree(cbdata);\n        }\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetConfigFile",
          "args": [
            "pool"
          ],
          "line": 414
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetConfigFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "278-282",
          "snippet": "const char *\nvirStoragePoolObjGetConfigFile(virStoragePoolObjPtr obj)\n{\n    return obj->configFile;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nconst char *\nvirStoragePoolObjGetConfigFile(virStoragePoolObjPtr obj)\n{\n    return obj->configFile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendSCSIStartPool(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *configFile = virStoragePoolObjGetConfigFile(pool);\n\n    if (def->source.adapter.type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST)\n        return createVport(def, configFile,\n                           &def->source.adapter.data.fchost);\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendSCSIRefreshPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "383-407",
    "snippet": "static int\nvirStorageBackendSCSIRefreshPool(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    unsigned int host;\n    g_autofree char *name = NULL;\n\n    def->allocation = def->capacity = def->available = 0;\n\n    if (!(name = getAdapterName(&def->source.adapter)))\n        return -1;\n\n    if (virSCSIHostGetNumber(name, &host) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Scanning host%u\", host);\n\n    if (virStorageBackendSCSITriggerRescan(host) < 0)\n        return -1;\n\n    if (virStorageBackendSCSIFindLUs(pool, host) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendSCSIFindLUs",
          "args": [
            "pool",
            "host"
          ],
          "line": 403
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSCSIFindLUs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "3953-4002",
          "snippet": "int\nvirStorageBackendSCSIFindLUs(virStoragePoolObjPtr pool,\n                              uint32_t scanhost)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int retval = 0;\n    uint32_t bus, target, lun;\n    const char *device_path = \"/sys/bus/scsi/devices\";\n    DIR *devicedir = NULL;\n    struct dirent *lun_dirent = NULL;\n    char devicepattern[64];\n    int found = 0;\n\n    VIR_DEBUG(\"Discovering LUs on host %u\", scanhost);\n\n    virWaitForDevices();\n\n    if (virDirOpen(&devicedir, device_path) < 0)\n        return -1;\n\n    g_snprintf(devicepattern, sizeof(devicepattern), \"%u:%%u:%%u:%%u\\n\", scanhost);\n\n    while ((retval = virDirRead(devicedir, &lun_dirent, device_path)) > 0) {\n        int rc;\n\n        if (sscanf(lun_dirent->d_name, devicepattern,\n                   &bus, &target, &lun) != 3) {\n            continue;\n        }\n\n        VIR_DEBUG(\"Found possible LU '%s'\", lun_dirent->d_name);\n\n        rc = processLU(pool, scanhost, bus, target, lun);\n        if (rc == -1) {\n            retval = -1;\n            break;\n        }\n        if (rc == 0)\n            found++;\n    }\n\n    VIR_DIR_CLOSE(devicedir);\n\n    if (retval < 0)\n        return -1;\n\n    VIR_DEBUG(\"Found %d LUs for pool %s\", found, def->name);\n\n    return found;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStorageBackendSCSIFindLUs(virStoragePoolObjPtr pool,\n                              uint32_t scanhost)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int retval = 0;\n    uint32_t bus, target, lun;\n    const char *device_path = \"/sys/bus/scsi/devices\";\n    DIR *devicedir = NULL;\n    struct dirent *lun_dirent = NULL;\n    char devicepattern[64];\n    int found = 0;\n\n    VIR_DEBUG(\"Discovering LUs on host %u\", scanhost);\n\n    virWaitForDevices();\n\n    if (virDirOpen(&devicedir, device_path) < 0)\n        return -1;\n\n    g_snprintf(devicepattern, sizeof(devicepattern), \"%u:%%u:%%u:%%u\\n\", scanhost);\n\n    while ((retval = virDirRead(devicedir, &lun_dirent, device_path)) > 0) {\n        int rc;\n\n        if (sscanf(lun_dirent->d_name, devicepattern,\n                   &bus, &target, &lun) != 3) {\n            continue;\n        }\n\n        VIR_DEBUG(\"Found possible LU '%s'\", lun_dirent->d_name);\n\n        rc = processLU(pool, scanhost, bus, target, lun);\n        if (rc == -1) {\n            retval = -1;\n            break;\n        }\n        if (rc == 0)\n            found++;\n    }\n\n    VIR_DIR_CLOSE(devicedir);\n\n    if (retval < 0)\n        return -1;\n\n    VIR_DEBUG(\"Found %d LUs for pool %s\", found, def->name);\n\n    return found;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSCSITriggerRescan",
          "args": [
            "host"
          ],
          "line": 400
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSCSITriggerRescan",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "55-87",
          "snippet": "static int\nvirStorageBackendSCSITriggerRescan(uint32_t host)\n{\n    VIR_AUTOCLOSE fd = -1;\n    g_autofree char *path = NULL;\n\n    VIR_DEBUG(\"Triggering rescan of host %d\", host);\n\n    path = g_strdup_printf(\"%s/host%u/scan\", LINUX_SYSFS_SCSI_HOST_PREFIX, host);\n\n    VIR_DEBUG(\"Scan trigger path is '%s'\", path);\n\n    fd = open(path, O_WRONLY);\n\n    if (fd < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not open '%s' to trigger host scan\"),\n                             path);\n        return -1;\n    }\n\n    if (safewrite(fd,\n                  LINUX_SYSFS_SCSI_HOST_SCAN_STRING,\n                  sizeof(LINUX_SYSFS_SCSI_HOST_SCAN_STRING)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Write to '%s' to trigger host scan failed\"),\n                             path);\n        return -1;\n    }\n\n    VIR_DEBUG(\"Rescan of host %d complete\", host);\n    return 0;\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINUX_SYSFS_SCSI_HOST_SCAN_STRING \"- - -\"",
            "#define LINUX_SYSFS_SCSI_HOST_PREFIX \"/sys/class/scsi_host\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\n#define LINUX_SYSFS_SCSI_HOST_SCAN_STRING \"- - -\"\n#define LINUX_SYSFS_SCSI_HOST_PREFIX \"/sys/class/scsi_host\"\n\nstatic int\nvirStorageBackendSCSITriggerRescan(uint32_t host)\n{\n    VIR_AUTOCLOSE fd = -1;\n    g_autofree char *path = NULL;\n\n    VIR_DEBUG(\"Triggering rescan of host %d\", host);\n\n    path = g_strdup_printf(\"%s/host%u/scan\", LINUX_SYSFS_SCSI_HOST_PREFIX, host);\n\n    VIR_DEBUG(\"Scan trigger path is '%s'\", path);\n\n    fd = open(path, O_WRONLY);\n\n    if (fd < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not open '%s' to trigger host scan\"),\n                             path);\n        return -1;\n    }\n\n    if (safewrite(fd,\n                  LINUX_SYSFS_SCSI_HOST_SCAN_STRING,\n                  sizeof(LINUX_SYSFS_SCSI_HOST_SCAN_STRING)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Write to '%s' to trigger host scan failed\"),\n                             path);\n        return -1;\n    }\n\n    VIR_DEBUG(\"Rescan of host %d complete\", host);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Scanning host%u\"",
            "host"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSCSIHostGetNumber",
          "args": [
            "name",
            "&host"
          ],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIHostGetNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsihost.c",
          "lines": "272-278",
          "snippet": "int\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getAdapterName",
          "args": [
            "&def->source.adapter"
          ],
          "line": 392
        },
        "resolved": true,
        "details": {
          "function_name": "getAdapterName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "166-198",
          "snippet": "static char *\ngetAdapterName(virStorageAdapterPtr adapter)\n{\n    char *name = NULL;\n\n    if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_SCSI_HOST) {\n        virStorageAdapterSCSIHostPtr scsi_host = &adapter->data.scsi_host;\n\n        if (scsi_host->has_parent) {\n            virPCIDeviceAddressPtr addr = &scsi_host->parentaddr;\n            unsigned int unique_id = scsi_host->unique_id;\n\n            if (!(name = virSCSIHostGetNameByParentaddr(addr->domain,\n                                                        addr->bus,\n                                                        addr->slot,\n                                                        addr->function,\n                                                        unique_id)))\n                return NULL;\n        } else {\n            name = g_strdup(scsi_host->name);\n        }\n    } else if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n        virStorageAdapterFCHostPtr fchost = &adapter->data.fchost;\n\n        if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"Failed to find SCSI host with wwnn='%s', \"\n                             \"wwpn='%s'\"), fchost->wwnn, fchost->wwpn);\n        }\n    }\n\n    return name;\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic char *\ngetAdapterName(virStorageAdapterPtr adapter)\n{\n    char *name = NULL;\n\n    if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_SCSI_HOST) {\n        virStorageAdapterSCSIHostPtr scsi_host = &adapter->data.scsi_host;\n\n        if (scsi_host->has_parent) {\n            virPCIDeviceAddressPtr addr = &scsi_host->parentaddr;\n            unsigned int unique_id = scsi_host->unique_id;\n\n            if (!(name = virSCSIHostGetNameByParentaddr(addr->domain,\n                                                        addr->bus,\n                                                        addr->slot,\n                                                        addr->function,\n                                                        unique_id)))\n                return NULL;\n        } else {\n            name = g_strdup(scsi_host->name);\n        }\n    } else if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n        virStorageAdapterFCHostPtr fchost = &adapter->data.fchost;\n\n        if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"Failed to find SCSI host with wwnn='%s', \"\n                             \"wwpn='%s'\"), fchost->wwnn, fchost->wwpn);\n        }\n    }\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 386
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendSCSIRefreshPool(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    unsigned int host;\n    g_autofree char *name = NULL;\n\n    def->allocation = def->capacity = def->available = 0;\n\n    if (!(name = getAdapterName(&def->source.adapter)))\n        return -1;\n\n    if (virSCSIHostGetNumber(name, &host) < 0)\n        return -1;\n\n    VIR_DEBUG(\"Scanning host%u\", host);\n\n    if (virStorageBackendSCSITriggerRescan(host) < 0)\n        return -1;\n\n    if (virStorageBackendSCSIFindLUs(pool, host) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendSCSICheckPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "349-381",
    "snippet": "static int\nvirStorageBackendSCSICheckPool(virStoragePoolObjPtr pool,\n                               bool *isActive)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    unsigned int host;\n    g_autofree char *path = NULL;\n    g_autofree char *name = NULL;\n\n    *isActive = false;\n\n    if (!(name = getAdapterName(&def->source.adapter))) {\n        /* It's normal for the pool with \"fc_host\" type source\n         * adapter fails to get the adapter name, since the vHBA\n         * the adapter based on might be not created yet.\n         */\n        if (def->source.adapter.type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n            virResetLastError();\n            return 0;\n        } else {\n            return -1;\n        }\n    }\n\n    if (virSCSIHostGetNumber(name, &host) < 0)\n        return -1;\n\n    path = g_strdup_printf(\"%s/host%d\", LINUX_SYSFS_SCSI_HOST_PREFIX, host);\n\n    *isActive = virFileExists(path);\n\n    return 0;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define LINUX_SYSFS_SCSI_HOST_PREFIX \"/sys/class/scsi_host\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "path"
          ],
          "line": 378
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/host%d\"",
            "LINUX_SYSFS_SCSI_HOST_PREFIX",
            "host"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIHostGetNumber",
          "args": [
            "name",
            "&host"
          ],
          "line": 373
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIHostGetNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsihost.c",
          "lines": "272-278",
          "snippet": "int\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 366
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getAdapterName",
          "args": [
            "&def->source.adapter"
          ],
          "line": 360
        },
        "resolved": true,
        "details": {
          "function_name": "getAdapterName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "166-198",
          "snippet": "static char *\ngetAdapterName(virStorageAdapterPtr adapter)\n{\n    char *name = NULL;\n\n    if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_SCSI_HOST) {\n        virStorageAdapterSCSIHostPtr scsi_host = &adapter->data.scsi_host;\n\n        if (scsi_host->has_parent) {\n            virPCIDeviceAddressPtr addr = &scsi_host->parentaddr;\n            unsigned int unique_id = scsi_host->unique_id;\n\n            if (!(name = virSCSIHostGetNameByParentaddr(addr->domain,\n                                                        addr->bus,\n                                                        addr->slot,\n                                                        addr->function,\n                                                        unique_id)))\n                return NULL;\n        } else {\n            name = g_strdup(scsi_host->name);\n        }\n    } else if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n        virStorageAdapterFCHostPtr fchost = &adapter->data.fchost;\n\n        if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"Failed to find SCSI host with wwnn='%s', \"\n                             \"wwpn='%s'\"), fchost->wwnn, fchost->wwpn);\n        }\n    }\n\n    return name;\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic char *\ngetAdapterName(virStorageAdapterPtr adapter)\n{\n    char *name = NULL;\n\n    if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_SCSI_HOST) {\n        virStorageAdapterSCSIHostPtr scsi_host = &adapter->data.scsi_host;\n\n        if (scsi_host->has_parent) {\n            virPCIDeviceAddressPtr addr = &scsi_host->parentaddr;\n            unsigned int unique_id = scsi_host->unique_id;\n\n            if (!(name = virSCSIHostGetNameByParentaddr(addr->domain,\n                                                        addr->bus,\n                                                        addr->slot,\n                                                        addr->function,\n                                                        unique_id)))\n                return NULL;\n        } else {\n            name = g_strdup(scsi_host->name);\n        }\n    } else if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n        virStorageAdapterFCHostPtr fchost = &adapter->data.fchost;\n\n        if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"Failed to find SCSI host with wwnn='%s', \"\n                             \"wwpn='%s'\"), fchost->wwnn, fchost->wwpn);\n        }\n    }\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 353
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\n#define LINUX_SYSFS_SCSI_HOST_PREFIX \"/sys/class/scsi_host\"\n\nstatic int\nvirStorageBackendSCSICheckPool(virStoragePoolObjPtr pool,\n                               bool *isActive)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    unsigned int host;\n    g_autofree char *path = NULL;\n    g_autofree char *name = NULL;\n\n    *isActive = false;\n\n    if (!(name = getAdapterName(&def->source.adapter))) {\n        /* It's normal for the pool with \"fc_host\" type source\n         * adapter fails to get the adapter name, since the vHBA\n         * the adapter based on might be not created yet.\n         */\n        if (def->source.adapter.type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n            virResetLastError();\n            return 0;\n        } else {\n            return -1;\n        }\n    }\n\n    if (virSCSIHostGetNumber(name, &host) < 0)\n        return -1;\n\n    path = g_strdup_printf(\"%s/host%d\", LINUX_SYSFS_SCSI_HOST_PREFIX, host);\n\n    *isActive = virFileExists(path);\n\n    return 0;\n}"
  },
  {
    "function_name": "createVport",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "283-346",
    "snippet": "static int\ncreateVport(virStoragePoolDefPtr def,\n            const char *configFile,\n            virStorageAdapterFCHostPtr fchost)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = NULL;\n    virThread thread;\n    g_autofree char *name = NULL;\n\n    VIR_DEBUG(\"configFile='%s' parent='%s', wwnn='%s' wwpn='%s'\",\n              NULLSTR(configFile), NULLSTR(fchost->parent),\n              fchost->wwnn, fchost->wwpn);\n\n    /* If we find an existing HBA/vHBA within the fc_host sysfs\n     * using the wwnn/wwpn, then a nodedev is already created for\n     * this pool and we don't have to create the vHBA\n     */\n    if ((name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n        if (!(checkName(name)))\n            return -1;\n\n        /* If a parent was provided, let's make sure the 'name' we've\n         * retrieved has the same parent. If not this will cause failure. */\n        if (!fchost->parent || checkParent(name, fchost->parent))\n            return 0;\n\n        return -1;\n    }\n\n    /* Since we're creating the vHBA, then we need to manage removing it\n     * as well. Since we need this setting to \"live\" through a libvirtd\n     * restart, we need to save the persistent configuration. So if not\n     * already defined as YES, then force the issue.\n     */\n    if (fchost->managed != VIR_TRISTATE_BOOL_YES) {\n        fchost->managed = VIR_TRISTATE_BOOL_YES;\n        if (configFile) {\n            if (virStoragePoolSaveConfig(configFile, def) < 0)\n                return -1;\n        }\n    }\n\n    if (!(name = virNodeDeviceCreateVport(fchost)))\n        return -1;\n\n    /* Creating our own VPORT didn't leave enough time to find any LUN's,\n     * so, let's create a thread whose job it is to call the FindLU's with\n     * retry logic set to true. If the thread isn't created, then no big\n     * deal since it's still possible to refresh the pool later.\n     */\n    if (VIR_ALLOC(cbdata) == 0) {\n        memcpy(cbdata->pool_uuid, def->uuid, VIR_UUID_BUFLEN);\n        cbdata->fchost_name = g_steal_pointer(&name);\n\n        if (virThreadCreateFull(&thread, false, virStoragePoolFCRefreshThread,\n                                \"scsi-refresh\", false, cbdata) < 0) {\n            /* Oh well - at least someone can still refresh afterwards */\n            VIR_DEBUG(\"Failed to create FC Pool Refresh Thread\");\n            virStoragePoolFCRefreshDataFree(cbdata);\n        }\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStoragePoolFCRefreshDataFree",
          "args": [
            "cbdata"
          ],
          "line": 341
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolFCRefreshDataFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "94-101",
          "snippet": "static void\nvirStoragePoolFCRefreshDataFree(void *opaque)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = opaque;\n\n    VIR_FREE(cbdata->fchost_name);\n    VIR_FREE(cbdata);\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirStoragePoolFCRefreshDataFree(void *opaque)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = opaque;\n\n    VIR_FREE(cbdata->fchost_name);\n    VIR_FREE(cbdata);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Failed to create FC Pool Refresh Thread\""
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virThreadCreateFull",
          "args": [
            "&thread",
            "false",
            "virStoragePoolFCRefreshThread",
            "\"scsi-refresh\"",
            "false",
            "cbdata"
          ],
          "line": 337
        },
        "resolved": true,
        "details": {
          "function_name": "virThreadCreateFull",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "242-283",
          "snippet": "int virThreadCreateFull(virThreadPtr thread,\n                        bool joinable,\n                        virThreadFunc func,\n                        const char *name,\n                        bool worker,\n                        void *opaque)\n{\n    struct virThreadArgs *args;\n    pthread_attr_t attr;\n    int ret = -1;\n    int err;\n\n    if ((err = pthread_attr_init(&attr)) != 0)\n        goto cleanup;\n    if (VIR_ALLOC_QUIET(args) < 0) {\n        err = ENOMEM;\n        goto cleanup;\n    }\n\n    args->func = func;\n    args->name = g_strdup(name);\n    args->worker = worker;\n    args->opaque = opaque;\n\n    if (!joinable)\n        pthread_attr_setdetachstate(&attr, 1);\n\n    err = pthread_create(&thread->thread, &attr, virThreadHelper, args);\n    if (err != 0) {\n        g_free(args->name);\n        g_free(args);\n        goto cleanup;\n    }\n    /* New thread owns 'args' in success case, so don't free */\n\n    ret = 0;\n cleanup:\n    pthread_attr_destroy(&attr);\n    if (ret < 0)\n        errno = err;\n    return ret;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virThreadCreateFull(virThreadPtr thread,\n                        bool joinable,\n                        virThreadFunc func,\n                        const char *name,\n                        bool worker,\n                        void *opaque)\n{\n    struct virThreadArgs *args;\n    pthread_attr_t attr;\n    int ret = -1;\n    int err;\n\n    if ((err = pthread_attr_init(&attr)) != 0)\n        goto cleanup;\n    if (VIR_ALLOC_QUIET(args) < 0) {\n        err = ENOMEM;\n        goto cleanup;\n    }\n\n    args->func = func;\n    args->name = g_strdup(name);\n    args->worker = worker;\n    args->opaque = opaque;\n\n    if (!joinable)\n        pthread_attr_setdetachstate(&attr, 1);\n\n    err = pthread_create(&thread->thread, &attr, virThreadHelper, args);\n    if (err != 0) {\n        g_free(args->name);\n        g_free(args);\n        goto cleanup;\n    }\n    /* New thread owns 'args' in success case, so don't free */\n\n    ret = 0;\n cleanup:\n    pthread_attr_destroy(&attr);\n    if (ret < 0)\n        errno = err;\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&name"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "cbdata->pool_uuid",
            "def->uuid",
            "VIR_UUID_BUFLEN"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "cbdata"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceCreateVport",
          "args": [
            "fchost"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceCreateVport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_util.c",
          "lines": "77-147",
          "snippet": "char *\nvirNodeDeviceCreateVport(virStorageAdapterFCHostPtr fchost)\n{\n    unsigned int parent_host;\n    char *name = NULL;\n    char *parent_hoststr = NULL;\n    bool skip_capable_check = false;\n\n    VIR_DEBUG(\"parent='%s', wwnn='%s' wwpn='%s'\",\n              NULLSTR(fchost->parent), fchost->wwnn, fchost->wwpn);\n\n    if (fchost->parent) {\n        parent_hoststr = g_strdup(fchost->parent);\n    } else if (fchost->parent_wwnn && fchost->parent_wwpn) {\n        if (!(parent_hoststr = virVHBAGetHostByWWN(NULL, fchost->parent_wwnn,\n                                                   fchost->parent_wwpn))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"cannot find parent using provided wwnn/wwpn\"));\n            goto cleanup;\n        }\n    } else if (fchost->parent_fabric_wwn) {\n        if (!(parent_hoststr =\n              virVHBAGetHostByFabricWWN(NULL, fchost->parent_fabric_wwn))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"cannot find parent using provided fabric_wwn\"));\n            goto cleanup;\n        }\n    } else {\n        if (!(parent_hoststr = virVHBAFindVportHost(NULL))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"'parent' for vHBA not specified, and \"\n                             \"cannot find one on this host\"));\n            goto cleanup;\n        }\n        skip_capable_check = true;\n    }\n\n    if (virSCSIHostGetNumber(parent_hoststr, &parent_host) < 0)\n        goto cleanup;\n\n    /* NOTE:\n     * We do not save the parent_hoststr in fchost->parent since\n     * we could be writing out the 'def' to the saved XML config.\n     * If we wrote out the name in the XML, then future starts would\n     * always use the same parent rather than finding the \"best available\"\n     * parent. Besides we have a way to determine the parent based on\n     * the 'name' field.\n     */\n    if (!skip_capable_check && !virVHBAPathExists(NULL, parent_host)) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"parent '%s' specified for vHBA does not exist\"),\n                       parent_hoststr);\n        goto cleanup;\n    }\n\n    if (virVHBAManageVport(parent_host, fchost->wwpn, fchost->wwnn,\n                           VPORT_CREATE) < 0)\n        goto cleanup;\n\n    /* Let's ensure the device was created */\n    virWaitForDevices();\n    if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n        ignore_value(virVHBAManageVport(parent_host, fchost->wwpn, fchost->wwnn,\n                                        VPORT_DELETE));\n        goto cleanup;\n    }\n\n cleanup:\n    VIR_FREE(parent_hoststr);\n    return name;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"node_device_util.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"node_device_util.h\"\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirNodeDeviceCreateVport(virStorageAdapterFCHostPtr fchost)\n{\n    unsigned int parent_host;\n    char *name = NULL;\n    char *parent_hoststr = NULL;\n    bool skip_capable_check = false;\n\n    VIR_DEBUG(\"parent='%s', wwnn='%s' wwpn='%s'\",\n              NULLSTR(fchost->parent), fchost->wwnn, fchost->wwpn);\n\n    if (fchost->parent) {\n        parent_hoststr = g_strdup(fchost->parent);\n    } else if (fchost->parent_wwnn && fchost->parent_wwpn) {\n        if (!(parent_hoststr = virVHBAGetHostByWWN(NULL, fchost->parent_wwnn,\n                                                   fchost->parent_wwpn))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"cannot find parent using provided wwnn/wwpn\"));\n            goto cleanup;\n        }\n    } else if (fchost->parent_fabric_wwn) {\n        if (!(parent_hoststr =\n              virVHBAGetHostByFabricWWN(NULL, fchost->parent_fabric_wwn))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"cannot find parent using provided fabric_wwn\"));\n            goto cleanup;\n        }\n    } else {\n        if (!(parent_hoststr = virVHBAFindVportHost(NULL))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"'parent' for vHBA not specified, and \"\n                             \"cannot find one on this host\"));\n            goto cleanup;\n        }\n        skip_capable_check = true;\n    }\n\n    if (virSCSIHostGetNumber(parent_hoststr, &parent_host) < 0)\n        goto cleanup;\n\n    /* NOTE:\n     * We do not save the parent_hoststr in fchost->parent since\n     * we could be writing out the 'def' to the saved XML config.\n     * If we wrote out the name in the XML, then future starts would\n     * always use the same parent rather than finding the \"best available\"\n     * parent. Besides we have a way to determine the parent based on\n     * the 'name' field.\n     */\n    if (!skip_capable_check && !virVHBAPathExists(NULL, parent_host)) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"parent '%s' specified for vHBA does not exist\"),\n                       parent_hoststr);\n        goto cleanup;\n    }\n\n    if (virVHBAManageVport(parent_host, fchost->wwpn, fchost->wwnn,\n                           VPORT_CREATE) < 0)\n        goto cleanup;\n\n    /* Let's ensure the device was created */\n    virWaitForDevices();\n    if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n        ignore_value(virVHBAManageVport(parent_host, fchost->wwpn, fchost->wwnn,\n                                        VPORT_DELETE));\n        goto cleanup;\n    }\n\n cleanup:\n    VIR_FREE(parent_hoststr);\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolSaveConfig",
          "args": [
            "configFile",
            "def"
          ],
          "line": 320
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolSaveConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/storage_conf.c",
          "lines": "1713-1726",
          "snippet": "int\nvirStoragePoolSaveConfig(const char *configFile,\n                         virStoragePoolDefPtr def)\n{\n    g_autofree char *xml = NULL;\n\n    if (!(xml = virStoragePoolDefFormat(def))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"failed to generate XML\"));\n        return -1;\n    }\n\n    return virStoragePoolSaveXML(configFile, def, xml);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virvhba.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_adapter_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virvhba.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"storage_adapter_conf.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStoragePoolSaveConfig(const char *configFile,\n                         virStoragePoolDefPtr def)\n{\n    g_autofree char *xml = NULL;\n\n    if (!(xml = virStoragePoolDefFormat(def))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"failed to generate XML\"));\n        return -1;\n    }\n\n    return virStoragePoolSaveXML(configFile, def, xml);\n}"
        }
      },
      {
        "call_info": {
          "callee": "checkParent",
          "args": [
            "name",
            "fchost->parent"
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "checkParent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "232-280",
          "snippet": "static bool\ncheckParent(const char *name,\n            const char *parent_name)\n{\n    unsigned int host_num;\n    bool retval = false;\n    virConnectPtr conn = NULL;\n    g_autofree char *scsi_host_name = NULL;\n    g_autofree char *vhba_parent = NULL;\n\n    VIR_DEBUG(\"name=%s, parent_name=%s\", name, parent_name);\n\n    conn = virGetConnectNodeDev();\n    if (!conn)\n        goto cleanup;\n\n    if (virSCSIHostGetNumber(parent_name, &host_num) < 0) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"parent '%s' is not properly formatted\"),\n                       parent_name);\n        goto cleanup;\n    }\n\n    if (!virVHBAPathExists(NULL, host_num)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"parent '%s' is not an fc_host for the wwnn/wwpn\"),\n                       parent_name);\n        goto cleanup;\n    }\n\n    scsi_host_name = g_strdup_printf(\"scsi_%s\", name);\n\n    if (!(vhba_parent = virNodeDeviceGetParentName(conn, scsi_host_name)))\n        goto cleanup;\n\n    if (STRNEQ(parent_name, vhba_parent)) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"Parent attribute '%s' does not match parent '%s' \"\n                         \"determined for the '%s' wwnn/wwpn lookup.\"),\n                       parent_name, vhba_parent, name);\n        goto cleanup;\n    }\n\n    retval = true;\n\n cleanup:\n    virObjectUnref(conn);\n    return retval;\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic bool\ncheckParent(const char *name,\n            const char *parent_name)\n{\n    unsigned int host_num;\n    bool retval = false;\n    virConnectPtr conn = NULL;\n    g_autofree char *scsi_host_name = NULL;\n    g_autofree char *vhba_parent = NULL;\n\n    VIR_DEBUG(\"name=%s, parent_name=%s\", name, parent_name);\n\n    conn = virGetConnectNodeDev();\n    if (!conn)\n        goto cleanup;\n\n    if (virSCSIHostGetNumber(parent_name, &host_num) < 0) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"parent '%s' is not properly formatted\"),\n                       parent_name);\n        goto cleanup;\n    }\n\n    if (!virVHBAPathExists(NULL, host_num)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"parent '%s' is not an fc_host for the wwnn/wwpn\"),\n                       parent_name);\n        goto cleanup;\n    }\n\n    scsi_host_name = g_strdup_printf(\"scsi_%s\", name);\n\n    if (!(vhba_parent = virNodeDeviceGetParentName(conn, scsi_host_name)))\n        goto cleanup;\n\n    if (STRNEQ(parent_name, vhba_parent)) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"Parent attribute '%s' does not match parent '%s' \"\n                         \"determined for the '%s' wwnn/wwpn lookup.\"),\n                       parent_name, vhba_parent, name);\n        goto cleanup;\n    }\n\n    retval = true;\n\n cleanup:\n    virObjectUnref(conn);\n    return retval;\n}"
        }
      },
      {
        "call_info": {
          "callee": "checkName",
          "args": [
            "name"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "checkName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "213-225",
          "snippet": "static bool\ncheckName(const char *name)\n{\n    unsigned int host_num;\n\n    if (virSCSIHostGetNumber(name, &host_num) &&\n        virVHBAIsVportCapable(NULL, host_num))\n        return true;\n\n    virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                   _(\"the wwnn/wwpn for '%s' are assigned to an HBA\"), name);\n    return false;\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic bool\ncheckName(const char *name)\n{\n    unsigned int host_num;\n\n    if (virSCSIHostGetNumber(name, &host_num) &&\n        virVHBAIsVportCapable(NULL, host_num))\n        return true;\n\n    virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                   _(\"the wwnn/wwpn for '%s' are assigned to an HBA\"), name);\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virVHBAGetHostByWWN",
          "args": [
            "NULL",
            "fchost->wwnn",
            "fchost->wwpn"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "virVHBAGetHostByWWN",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvhba.c",
          "lines": "500-507",
          "snippet": "char *\nvirVHBAGetHostByWWN(const char *sysfs_prefix G_GNUC_UNUSED,\n                    const char *wwnn G_GNUC_UNUSED,\n                    const char *wwpn G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nchar *\nvirVHBAGetHostByWWN(const char *sysfs_prefix G_GNUC_UNUSED,\n                    const char *wwnn G_GNUC_UNUSED,\n                    const char *wwpn G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"configFile='%s' parent='%s', wwnn='%s' wwpn='%s'\"",
            "NULLSTR(configFile)",
            "NULLSTR(fchost->parent)",
            "fchost->wwnn",
            "fchost->wwpn"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "fchost->parent"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "configFile"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\ncreateVport(virStoragePoolDefPtr def,\n            const char *configFile,\n            virStorageAdapterFCHostPtr fchost)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = NULL;\n    virThread thread;\n    g_autofree char *name = NULL;\n\n    VIR_DEBUG(\"configFile='%s' parent='%s', wwnn='%s' wwpn='%s'\",\n              NULLSTR(configFile), NULLSTR(fchost->parent),\n              fchost->wwnn, fchost->wwpn);\n\n    /* If we find an existing HBA/vHBA within the fc_host sysfs\n     * using the wwnn/wwpn, then a nodedev is already created for\n     * this pool and we don't have to create the vHBA\n     */\n    if ((name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n        if (!(checkName(name)))\n            return -1;\n\n        /* If a parent was provided, let's make sure the 'name' we've\n         * retrieved has the same parent. If not this will cause failure. */\n        if (!fchost->parent || checkParent(name, fchost->parent))\n            return 0;\n\n        return -1;\n    }\n\n    /* Since we're creating the vHBA, then we need to manage removing it\n     * as well. Since we need this setting to \"live\" through a libvirtd\n     * restart, we need to save the persistent configuration. So if not\n     * already defined as YES, then force the issue.\n     */\n    if (fchost->managed != VIR_TRISTATE_BOOL_YES) {\n        fchost->managed = VIR_TRISTATE_BOOL_YES;\n        if (configFile) {\n            if (virStoragePoolSaveConfig(configFile, def) < 0)\n                return -1;\n        }\n    }\n\n    if (!(name = virNodeDeviceCreateVport(fchost)))\n        return -1;\n\n    /* Creating our own VPORT didn't leave enough time to find any LUN's,\n     * so, let's create a thread whose job it is to call the FindLU's with\n     * retry logic set to true. If the thread isn't created, then no big\n     * deal since it's still possible to refresh the pool later.\n     */\n    if (VIR_ALLOC(cbdata) == 0) {\n        memcpy(cbdata->pool_uuid, def->uuid, VIR_UUID_BUFLEN);\n        cbdata->fchost_name = g_steal_pointer(&name);\n\n        if (virThreadCreateFull(&thread, false, virStoragePoolFCRefreshThread,\n                                \"scsi-refresh\", false, cbdata) < 0) {\n            /* Oh well - at least someone can still refresh afterwards */\n            VIR_DEBUG(\"Failed to create FC Pool Refresh Thread\");\n            virStoragePoolFCRefreshDataFree(cbdata);\n        }\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "checkParent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "232-280",
    "snippet": "static bool\ncheckParent(const char *name,\n            const char *parent_name)\n{\n    unsigned int host_num;\n    bool retval = false;\n    virConnectPtr conn = NULL;\n    g_autofree char *scsi_host_name = NULL;\n    g_autofree char *vhba_parent = NULL;\n\n    VIR_DEBUG(\"name=%s, parent_name=%s\", name, parent_name);\n\n    conn = virGetConnectNodeDev();\n    if (!conn)\n        goto cleanup;\n\n    if (virSCSIHostGetNumber(parent_name, &host_num) < 0) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"parent '%s' is not properly formatted\"),\n                       parent_name);\n        goto cleanup;\n    }\n\n    if (!virVHBAPathExists(NULL, host_num)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"parent '%s' is not an fc_host for the wwnn/wwpn\"),\n                       parent_name);\n        goto cleanup;\n    }\n\n    scsi_host_name = g_strdup_printf(\"scsi_%s\", name);\n\n    if (!(vhba_parent = virNodeDeviceGetParentName(conn, scsi_host_name)))\n        goto cleanup;\n\n    if (STRNEQ(parent_name, vhba_parent)) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"Parent attribute '%s' does not match parent '%s' \"\n                         \"determined for the '%s' wwnn/wwpn lookup.\"),\n                       parent_name, vhba_parent, name);\n        goto cleanup;\n    }\n\n    retval = true;\n\n cleanup:\n    virObjectUnref(conn);\n    return retval;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "conn"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "_(\"Parent attribute '%s' does not match parent '%s' \"\n                         \"determined for the '%s' wwnn/wwpn lookup.\")",
            "parent_name",
            "vhba_parent",
            "name"
          ],
          "line": 268
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Parent attribute '%s' does not match parent '%s' \"\n                         \"determined for the '%s' wwnn/wwpn lookup.\""
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "parent_name",
            "vhba_parent"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceGetParentName",
          "args": [
            "conn",
            "scsi_host_name"
          ],
          "line": 264
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceGetParentName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_util.c",
          "lines": "44-62",
          "snippet": "char *\nvirNodeDeviceGetParentName(virConnectPtr conn,\n                           const char *nodedev_name)\n{\n    virNodeDevicePtr device = NULL;\n    char *parent;\n\n    if (!(device = virNodeDeviceLookupByName(conn, nodedev_name))) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"Cannot find '%s' in node device database\"),\n                       nodedev_name);\n        return NULL;\n    }\n\n    parent = g_strdup(virNodeDeviceGetParent(device));\n    virObjectUnref(device);\n\n    return parent;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"node_device_util.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"node_device_util.h\"\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirNodeDeviceGetParentName(virConnectPtr conn,\n                           const char *nodedev_name)\n{\n    virNodeDevicePtr device = NULL;\n    char *parent;\n\n    if (!(device = virNodeDeviceLookupByName(conn, nodedev_name))) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"Cannot find '%s' in node device database\"),\n                       nodedev_name);\n        return NULL;\n    }\n\n    parent = g_strdup(virNodeDeviceGetParent(device));\n    virObjectUnref(device);\n\n    return parent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"parent '%s' is not an fc_host for the wwnn/wwpn\")",
            "parent_name"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virVHBAPathExists",
          "args": [
            "NULL",
            "host_num"
          ],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "virVHBAPathExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvhba.c",
          "lines": "453-459",
          "snippet": "bool\nvirVHBAPathExists(const char *sysfs_prefix G_GNUC_UNUSED,\n                  int host G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return false;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nbool\nvirVHBAPathExists(const char *sysfs_prefix G_GNUC_UNUSED,\n                  int host G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "_(\"parent '%s' is not properly formatted\")",
            "parent_name"
          ],
          "line": 249
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSCSIHostGetNumber",
          "args": [
            "parent_name",
            "&host_num"
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIHostGetNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsihost.c",
          "lines": "272-278",
          "snippet": "int\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetConnectNodeDev",
          "args": [],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectNodeDev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "179-182",
          "snippet": "virConnectPtr virGetConnectNodeDev(void)\n{\n    return virGetConnectGeneric(&connectNodeDev, \"nodedev\");\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virThreadLocal connectNodeDev;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectNodeDev;\n\nvirConnectPtr virGetConnectNodeDev(void)\n{\n    return virGetConnectGeneric(&connectNodeDev, \"nodedev\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"name=%s, parent_name=%s\"",
            "name",
            "parent_name"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic bool\ncheckParent(const char *name,\n            const char *parent_name)\n{\n    unsigned int host_num;\n    bool retval = false;\n    virConnectPtr conn = NULL;\n    g_autofree char *scsi_host_name = NULL;\n    g_autofree char *vhba_parent = NULL;\n\n    VIR_DEBUG(\"name=%s, parent_name=%s\", name, parent_name);\n\n    conn = virGetConnectNodeDev();\n    if (!conn)\n        goto cleanup;\n\n    if (virSCSIHostGetNumber(parent_name, &host_num) < 0) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"parent '%s' is not properly formatted\"),\n                       parent_name);\n        goto cleanup;\n    }\n\n    if (!virVHBAPathExists(NULL, host_num)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"parent '%s' is not an fc_host for the wwnn/wwpn\"),\n                       parent_name);\n        goto cleanup;\n    }\n\n    scsi_host_name = g_strdup_printf(\"scsi_%s\", name);\n\n    if (!(vhba_parent = virNodeDeviceGetParentName(conn, scsi_host_name)))\n        goto cleanup;\n\n    if (STRNEQ(parent_name, vhba_parent)) {\n        virReportError(VIR_ERR_XML_ERROR,\n                       _(\"Parent attribute '%s' does not match parent '%s' \"\n                         \"determined for the '%s' wwnn/wwpn lookup.\"),\n                       parent_name, vhba_parent, name);\n        goto cleanup;\n    }\n\n    retval = true;\n\n cleanup:\n    virObjectUnref(conn);\n    return retval;\n}"
  },
  {
    "function_name": "checkName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "213-225",
    "snippet": "static bool\ncheckName(const char *name)\n{\n    unsigned int host_num;\n\n    if (virSCSIHostGetNumber(name, &host_num) &&\n        virVHBAIsVportCapable(NULL, host_num))\n        return true;\n\n    virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                   _(\"the wwnn/wwpn for '%s' are assigned to an HBA\"), name);\n    return false;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"the wwnn/wwpn for '%s' are assigned to an HBA\")",
            "name"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"the wwnn/wwpn for '%s' are assigned to an HBA\""
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virVHBAIsVportCapable",
          "args": [
            "NULL",
            "host_num"
          ],
          "line": 219
        },
        "resolved": true,
        "details": {
          "function_name": "virVHBAIsVportCapable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvhba.c",
          "lines": "462-468",
          "snippet": "bool\nvirVHBAIsVportCapable(const char *sysfs_prefix G_GNUC_UNUSED,\n                      int host G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return false;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nbool\nvirVHBAIsVportCapable(const char *sysfs_prefix G_GNUC_UNUSED,\n                      int host G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIHostGetNumber",
          "args": [
            "name",
            "&host_num"
          ],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIHostGetNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsihost.c",
          "lines": "272-278",
          "snippet": "int\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic bool\ncheckName(const char *name)\n{\n    unsigned int host_num;\n\n    if (virSCSIHostGetNumber(name, &host_num) &&\n        virVHBAIsVportCapable(NULL, host_num))\n        return true;\n\n    virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                   _(\"the wwnn/wwpn for '%s' are assigned to an HBA\"), name);\n    return false;\n}"
  },
  {
    "function_name": "getAdapterName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "166-198",
    "snippet": "static char *\ngetAdapterName(virStorageAdapterPtr adapter)\n{\n    char *name = NULL;\n\n    if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_SCSI_HOST) {\n        virStorageAdapterSCSIHostPtr scsi_host = &adapter->data.scsi_host;\n\n        if (scsi_host->has_parent) {\n            virPCIDeviceAddressPtr addr = &scsi_host->parentaddr;\n            unsigned int unique_id = scsi_host->unique_id;\n\n            if (!(name = virSCSIHostGetNameByParentaddr(addr->domain,\n                                                        addr->bus,\n                                                        addr->slot,\n                                                        addr->function,\n                                                        unique_id)))\n                return NULL;\n        } else {\n            name = g_strdup(scsi_host->name);\n        }\n    } else if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n        virStorageAdapterFCHostPtr fchost = &adapter->data.fchost;\n\n        if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"Failed to find SCSI host with wwnn='%s', \"\n                             \"wwpn='%s'\"), fchost->wwnn, fchost->wwpn);\n        }\n    }\n\n    return name;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "_(\"Failed to find SCSI host with wwnn='%s', \"\n                             \"wwpn='%s'\")",
            "fchost->wwnn",
            "fchost->wwpn"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to find SCSI host with wwnn='%s', \"\n                             \"wwpn='%s'\""
          ],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virVHBAGetHostByWWN",
          "args": [
            "NULL",
            "fchost->wwnn",
            "fchost->wwpn"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "virVHBAGetHostByWWN",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvhba.c",
          "lines": "500-507",
          "snippet": "char *\nvirVHBAGetHostByWWN(const char *sysfs_prefix G_GNUC_UNUSED,\n                    const char *wwnn G_GNUC_UNUSED,\n                    const char *wwpn G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nchar *\nvirVHBAGetHostByWWN(const char *sysfs_prefix G_GNUC_UNUSED,\n                    const char *wwnn G_GNUC_UNUSED,\n                    const char *wwpn G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIHostGetNameByParentaddr",
          "args": [
            "addr->domain",
            "addr->bus",
            "addr->slot",
            "addr->function",
            "unique_id"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIHostGetNameByParentaddr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsihost.c",
          "lines": "280-289",
          "snippet": "char *\nvirSCSIHostGetNameByParentaddr(unsigned int domain G_GNUC_UNUSED,\n                               unsigned int bus G_GNUC_UNUSED,\n                               unsigned int slot G_GNUC_UNUSED,\n                               unsigned int function G_GNUC_UNUSED,\n                               unsigned int unique_id G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <dirent.h>\n#include <config.h>\n\nchar *\nvirSCSIHostGetNameByParentaddr(unsigned int domain G_GNUC_UNUSED,\n                               unsigned int bus G_GNUC_UNUSED,\n                               unsigned int slot G_GNUC_UNUSED,\n                               unsigned int function G_GNUC_UNUSED,\n                               unsigned int unique_id G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic char *\ngetAdapterName(virStorageAdapterPtr adapter)\n{\n    char *name = NULL;\n\n    if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_SCSI_HOST) {\n        virStorageAdapterSCSIHostPtr scsi_host = &adapter->data.scsi_host;\n\n        if (scsi_host->has_parent) {\n            virPCIDeviceAddressPtr addr = &scsi_host->parentaddr;\n            unsigned int unique_id = scsi_host->unique_id;\n\n            if (!(name = virSCSIHostGetNameByParentaddr(addr->domain,\n                                                        addr->bus,\n                                                        addr->slot,\n                                                        addr->function,\n                                                        unique_id)))\n                return NULL;\n        } else {\n            name = g_strdup(scsi_host->name);\n        }\n    } else if (adapter->type == VIR_STORAGE_ADAPTER_TYPE_FC_HOST) {\n        virStorageAdapterFCHostPtr fchost = &adapter->data.fchost;\n\n        if (!(name = virVHBAGetHostByWWN(NULL, fchost->wwnn, fchost->wwpn))) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"Failed to find SCSI host with wwnn='%s', \"\n                             \"wwpn='%s'\"), fchost->wwnn, fchost->wwpn);\n        }\n    }\n\n    return name;\n}"
  },
  {
    "function_name": "virStoragePoolFCRefreshThread",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "123-164",
    "snippet": "static void\nvirStoragePoolFCRefreshThread(void *opaque)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = opaque;\n    const char *fchost_name = cbdata->fchost_name;\n    const unsigned char *pool_uuid = cbdata->pool_uuid;\n    virStoragePoolObjPtr pool = NULL;\n    virStoragePoolDefPtr def;\n    unsigned int host;\n    int found = 0;\n    int tries = 2;\n\n    do {\n        sleep(5); /* Give it time */\n\n        /* Let's see if the pool still exists -  */\n        if (!(pool = virStoragePoolObjFindPoolByUUID(pool_uuid)))\n            break;\n        def = virStoragePoolObjGetDef(pool);\n\n        /* Return with pool lock, if active, we can get the host number,\n         * successfully, rescan, and find LUN's, then we are happy\n         */\n        VIR_DEBUG(\"Attempt FC Refresh for pool='%s' name='%s' tries='%d'\",\n                  def->name, fchost_name, tries);\n\n        def->allocation = def->capacity = def->available = 0;\n\n        if (virStoragePoolObjIsActive(pool) &&\n            virSCSIHostGetNumber(fchost_name, &host) == 0 &&\n            virStorageBackendSCSITriggerRescan(host) == 0) {\n            virStoragePoolObjClearVols(pool);\n            found = virStorageBackendSCSIFindLUs(pool, host);\n        }\n        virStoragePoolObjEndAPI(&pool);\n    } while (!found && --tries);\n\n    if (pool && !found)\n        VIR_DEBUG(\"FC Refresh Thread failed to find LU's\");\n\n    virStoragePoolFCRefreshDataFree(cbdata);\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStoragePoolFCRefreshDataFree",
          "args": [
            "cbdata"
          ],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolFCRefreshDataFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "94-101",
          "snippet": "static void\nvirStoragePoolFCRefreshDataFree(void *opaque)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = opaque;\n\n    VIR_FREE(cbdata->fchost_name);\n    VIR_FREE(cbdata);\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirStoragePoolFCRefreshDataFree(void *opaque)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = opaque;\n\n    VIR_FREE(cbdata->fchost_name);\n    VIR_FREE(cbdata);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"FC Refresh Thread failed to find LU's\""
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjEndAPI",
          "args": [
            "&pool"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "234-243",
          "snippet": "void\nvirStoragePoolObjEndAPI(virStoragePoolObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirStoragePoolObjEndAPI(virStoragePoolObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSCSIFindLUs",
          "args": [
            "pool",
            "host"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSCSIFindLUs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "3953-4002",
          "snippet": "int\nvirStorageBackendSCSIFindLUs(virStoragePoolObjPtr pool,\n                              uint32_t scanhost)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int retval = 0;\n    uint32_t bus, target, lun;\n    const char *device_path = \"/sys/bus/scsi/devices\";\n    DIR *devicedir = NULL;\n    struct dirent *lun_dirent = NULL;\n    char devicepattern[64];\n    int found = 0;\n\n    VIR_DEBUG(\"Discovering LUs on host %u\", scanhost);\n\n    virWaitForDevices();\n\n    if (virDirOpen(&devicedir, device_path) < 0)\n        return -1;\n\n    g_snprintf(devicepattern, sizeof(devicepattern), \"%u:%%u:%%u:%%u\\n\", scanhost);\n\n    while ((retval = virDirRead(devicedir, &lun_dirent, device_path)) > 0) {\n        int rc;\n\n        if (sscanf(lun_dirent->d_name, devicepattern,\n                   &bus, &target, &lun) != 3) {\n            continue;\n        }\n\n        VIR_DEBUG(\"Found possible LU '%s'\", lun_dirent->d_name);\n\n        rc = processLU(pool, scanhost, bus, target, lun);\n        if (rc == -1) {\n            retval = -1;\n            break;\n        }\n        if (rc == 0)\n            found++;\n    }\n\n    VIR_DIR_CLOSE(devicedir);\n\n    if (retval < 0)\n        return -1;\n\n    VIR_DEBUG(\"Found %d LUs for pool %s\", found, def->name);\n\n    return found;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStorageBackendSCSIFindLUs(virStoragePoolObjPtr pool,\n                              uint32_t scanhost)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int retval = 0;\n    uint32_t bus, target, lun;\n    const char *device_path = \"/sys/bus/scsi/devices\";\n    DIR *devicedir = NULL;\n    struct dirent *lun_dirent = NULL;\n    char devicepattern[64];\n    int found = 0;\n\n    VIR_DEBUG(\"Discovering LUs on host %u\", scanhost);\n\n    virWaitForDevices();\n\n    if (virDirOpen(&devicedir, device_path) < 0)\n        return -1;\n\n    g_snprintf(devicepattern, sizeof(devicepattern), \"%u:%%u:%%u:%%u\\n\", scanhost);\n\n    while ((retval = virDirRead(devicedir, &lun_dirent, device_path)) > 0) {\n        int rc;\n\n        if (sscanf(lun_dirent->d_name, devicepattern,\n                   &bus, &target, &lun) != 3) {\n            continue;\n        }\n\n        VIR_DEBUG(\"Found possible LU '%s'\", lun_dirent->d_name);\n\n        rc = processLU(pool, scanhost, bus, target, lun);\n        if (rc == -1) {\n            retval = -1;\n            break;\n        }\n        if (rc == 0)\n            found++;\n    }\n\n    VIR_DIR_CLOSE(devicedir);\n\n    if (retval < 0)\n        return -1;\n\n    VIR_DEBUG(\"Found %d LUs for pool %s\", found, def->name);\n\n    return found;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjClearVols",
          "args": [
            "pool"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjClearVols",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "629-638",
          "snippet": "void\nvirStoragePoolObjClearVols(virStoragePoolObjPtr obj)\n{\n    if (!obj->volumes)\n        return;\n\n    virHashRemoveAll(obj->volumes->objsKey);\n    virHashRemoveAll(obj->volumes->objsName);\n    virHashRemoveAll(obj->volumes->objsPath);\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirStoragePoolObjClearVols(virStoragePoolObjPtr obj)\n{\n    if (!obj->volumes)\n        return;\n\n    virHashRemoveAll(obj->volumes->objsKey);\n    virHashRemoveAll(obj->volumes->objsName);\n    virHashRemoveAll(obj->volumes->objsPath);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendSCSITriggerRescan",
          "args": [
            "host"
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendSCSITriggerRescan",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
          "lines": "55-87",
          "snippet": "static int\nvirStorageBackendSCSITriggerRescan(uint32_t host)\n{\n    VIR_AUTOCLOSE fd = -1;\n    g_autofree char *path = NULL;\n\n    VIR_DEBUG(\"Triggering rescan of host %d\", host);\n\n    path = g_strdup_printf(\"%s/host%u/scan\", LINUX_SYSFS_SCSI_HOST_PREFIX, host);\n\n    VIR_DEBUG(\"Scan trigger path is '%s'\", path);\n\n    fd = open(path, O_WRONLY);\n\n    if (fd < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not open '%s' to trigger host scan\"),\n                             path);\n        return -1;\n    }\n\n    if (safewrite(fd,\n                  LINUX_SYSFS_SCSI_HOST_SCAN_STRING,\n                  sizeof(LINUX_SYSFS_SCSI_HOST_SCAN_STRING)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Write to '%s' to trigger host scan failed\"),\n                             path);\n        return -1;\n    }\n\n    VIR_DEBUG(\"Rescan of host %d complete\", host);\n    return 0;\n}",
          "includes": [
            "#include \"driver.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstring.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_backend_scsi.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINUX_SYSFS_SCSI_HOST_SCAN_STRING \"- - -\"",
            "#define LINUX_SYSFS_SCSI_HOST_PREFIX \"/sys/class/scsi_host\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\n#define LINUX_SYSFS_SCSI_HOST_SCAN_STRING \"- - -\"\n#define LINUX_SYSFS_SCSI_HOST_PREFIX \"/sys/class/scsi_host\"\n\nstatic int\nvirStorageBackendSCSITriggerRescan(uint32_t host)\n{\n    VIR_AUTOCLOSE fd = -1;\n    g_autofree char *path = NULL;\n\n    VIR_DEBUG(\"Triggering rescan of host %d\", host);\n\n    path = g_strdup_printf(\"%s/host%u/scan\", LINUX_SYSFS_SCSI_HOST_PREFIX, host);\n\n    VIR_DEBUG(\"Scan trigger path is '%s'\", path);\n\n    fd = open(path, O_WRONLY);\n\n    if (fd < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not open '%s' to trigger host scan\"),\n                             path);\n        return -1;\n    }\n\n    if (safewrite(fd,\n                  LINUX_SYSFS_SCSI_HOST_SCAN_STRING,\n                  sizeof(LINUX_SYSFS_SCSI_HOST_SCAN_STRING)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Write to '%s' to trigger host scan failed\"),\n                             path);\n        return -1;\n    }\n\n    VIR_DEBUG(\"Rescan of host %d complete\", host);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIHostGetNumber",
          "args": [
            "fchost_name",
            "&host"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIHostGetNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsihost.c",
          "lines": "272-278",
          "snippet": "int\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjIsActive",
          "args": [
            "pool"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjIsActive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "301-305",
          "snippet": "bool\nvirStoragePoolObjIsActive(virStoragePoolObjPtr obj)\n{\n    return obj->active;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nbool\nvirStoragePoolObjIsActive(virStoragePoolObjPtr obj)\n{\n    return obj->active;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Attempt FC Refresh for pool='%s' name='%s' tries='%d'\"",
            "def->name",
            "fchost_name",
            "tries"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjFindPoolByUUID",
          "args": [
            "pool_uuid"
          ],
          "line": 139
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjFindPoolByUUID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_driver.c",
          "lines": "2818-2822",
          "snippet": "virStoragePoolObjPtr\nvirStoragePoolObjFindPoolByUUID(const unsigned char *uuid)\n{\n    return virStoragePoolObjFindByUUID(driver->pools, uuid);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"storage_util.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_event.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_capabilities.h\"",
            "#include \"storage_driver.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "# include <pwd.h>",
            "#include <fcntl.h>",
            "#include <sys/param.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virStorageDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"storage_util.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_backend.h\"\n#include \"viralloc.h\"\n#include \"storage_event.h\"\n#include \"storage_conf.h\"\n#include \"storage_capabilities.h\"\n#include \"storage_driver.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n# include <pwd.h>\n#include <fcntl.h>\n#include <sys/param.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virStorageDriverStatePtr driver;\n\nvirStoragePoolObjPtr\nvirStoragePoolObjFindPoolByUUID(const unsigned char *uuid)\n{\n    return virStoragePoolObjFindByUUID(driver->pools, uuid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "5"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirStoragePoolFCRefreshThread(void *opaque)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = opaque;\n    const char *fchost_name = cbdata->fchost_name;\n    const unsigned char *pool_uuid = cbdata->pool_uuid;\n    virStoragePoolObjPtr pool = NULL;\n    virStoragePoolDefPtr def;\n    unsigned int host;\n    int found = 0;\n    int tries = 2;\n\n    do {\n        sleep(5); /* Give it time */\n\n        /* Let's see if the pool still exists -  */\n        if (!(pool = virStoragePoolObjFindPoolByUUID(pool_uuid)))\n            break;\n        def = virStoragePoolObjGetDef(pool);\n\n        /* Return with pool lock, if active, we can get the host number,\n         * successfully, rescan, and find LUN's, then we are happy\n         */\n        VIR_DEBUG(\"Attempt FC Refresh for pool='%s' name='%s' tries='%d'\",\n                  def->name, fchost_name, tries);\n\n        def->allocation = def->capacity = def->available = 0;\n\n        if (virStoragePoolObjIsActive(pool) &&\n            virSCSIHostGetNumber(fchost_name, &host) == 0 &&\n            virStorageBackendSCSITriggerRescan(host) == 0) {\n            virStoragePoolObjClearVols(pool);\n            found = virStorageBackendSCSIFindLUs(pool, host);\n        }\n        virStoragePoolObjEndAPI(&pool);\n    } while (!found && --tries);\n\n    if (pool && !found)\n        VIR_DEBUG(\"FC Refresh Thread failed to find LU's\");\n\n    virStoragePoolFCRefreshDataFree(cbdata);\n}"
  },
  {
    "function_name": "virStoragePoolFCRefreshDataFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "94-101",
    "snippet": "static void\nvirStoragePoolFCRefreshDataFree(void *opaque)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = opaque;\n\n    VIR_FREE(cbdata->fchost_name);\n    VIR_FREE(cbdata);\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cbdata"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cbdata->fchost_name"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic void\nvirStoragePoolFCRefreshDataFree(void *opaque)\n{\n    virStoragePoolFCRefreshInfoPtr cbdata = opaque;\n\n    VIR_FREE(cbdata->fchost_name);\n    VIR_FREE(cbdata);\n}"
  },
  {
    "function_name": "virStorageBackendSCSITriggerRescan",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_scsi.c",
    "lines": "55-87",
    "snippet": "static int\nvirStorageBackendSCSITriggerRescan(uint32_t host)\n{\n    VIR_AUTOCLOSE fd = -1;\n    g_autofree char *path = NULL;\n\n    VIR_DEBUG(\"Triggering rescan of host %d\", host);\n\n    path = g_strdup_printf(\"%s/host%u/scan\", LINUX_SYSFS_SCSI_HOST_PREFIX, host);\n\n    VIR_DEBUG(\"Scan trigger path is '%s'\", path);\n\n    fd = open(path, O_WRONLY);\n\n    if (fd < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not open '%s' to trigger host scan\"),\n                             path);\n        return -1;\n    }\n\n    if (safewrite(fd,\n                  LINUX_SYSFS_SCSI_HOST_SCAN_STRING,\n                  sizeof(LINUX_SYSFS_SCSI_HOST_SCAN_STRING)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Write to '%s' to trigger host scan failed\"),\n                             path);\n        return -1;\n    }\n\n    VIR_DEBUG(\"Rescan of host %d complete\", host);\n    return 0;\n}",
    "includes": [
      "#include \"driver.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"virstring.h\"",
      "#include \"vircommand.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"storage_backend_scsi.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define LINUX_SYSFS_SCSI_HOST_SCAN_STRING \"- - -\"",
      "#define LINUX_SYSFS_SCSI_HOST_PREFIX \"/sys/class/scsi_host\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Rescan of host %d complete\"",
            "host"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Write to '%s' to trigger host scan failed\")",
            "path"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Write to '%s' to trigger host scan failed\""
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "safewrite",
          "args": [
            "fd",
            "LINUX_SYSFS_SCSI_HOST_SCAN_STRING",
            "sizeof(LINUX_SYSFS_SCSI_HOST_SCAN_STRING)"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "safewrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1093-1111",
          "snippet": "ssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Could not open '%s' to trigger host scan\")",
            "path"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "path",
            "O_WRONLY"
          ],
          "line": 67
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Scan trigger path is '%s'\"",
            "path"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Triggering rescan of host %d\"",
            "host"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"driver.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"storage_util.h\"\n#include \"virstring.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"storage_backend_scsi.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\n#define LINUX_SYSFS_SCSI_HOST_SCAN_STRING \"- - -\"\n#define LINUX_SYSFS_SCSI_HOST_PREFIX \"/sys/class/scsi_host\"\n\nstatic int\nvirStorageBackendSCSITriggerRescan(uint32_t host)\n{\n    VIR_AUTOCLOSE fd = -1;\n    g_autofree char *path = NULL;\n\n    VIR_DEBUG(\"Triggering rescan of host %d\", host);\n\n    path = g_strdup_printf(\"%s/host%u/scan\", LINUX_SYSFS_SCSI_HOST_PREFIX, host);\n\n    VIR_DEBUG(\"Scan trigger path is '%s'\", path);\n\n    fd = open(path, O_WRONLY);\n\n    if (fd < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not open '%s' to trigger host scan\"),\n                             path);\n        return -1;\n    }\n\n    if (safewrite(fd,\n                  LINUX_SYSFS_SCSI_HOST_SCAN_STRING,\n                  sizeof(LINUX_SYSFS_SCSI_HOST_SCAN_STRING)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Write to '%s' to trigger host scan failed\"),\n                             path);\n        return -1;\n    }\n\n    VIR_DEBUG(\"Rescan of host %d complete\", host);\n    return 0;\n}"
  }
]