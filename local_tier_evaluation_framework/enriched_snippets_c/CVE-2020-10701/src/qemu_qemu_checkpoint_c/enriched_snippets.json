[
  {
    "function_name": "qemuCheckpointDelete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "752-840",
    "snippet": "int\nqemuCheckpointDelete(virDomainObjPtr vm,\n                     virDomainCheckpointPtr checkpoint,\n                     unsigned int flags)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    int ret = -1;\n    virDomainMomentObjPtr chk = NULL;\n    virQEMUMomentRemove rem;\n    struct virQEMUCheckpointReparent rep;\n    bool metadata_only = !!(flags & VIR_DOMAIN_CHECKPOINT_DELETE_METADATA_ONLY);\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN |\n                  VIR_DOMAIN_CHECKPOINT_DELETE_METADATA_ONLY |\n                  VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY, -1);\n\n    if (qemuDomainObjBeginJob(driver, vm, QEMU_JOB_MODIFY) < 0)\n        return -1;\n\n    if (!metadata_only) {\n        if (!virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_INCREMENTAL_BACKUP)) {\n            virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                           _(\"incremental backup is not supported yet\"));\n            goto endjob;\n        }\n\n        if (!virDomainObjIsActive(vm)) {\n            virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                           _(\"cannot delete checkpoint for inactive domain\"));\n            goto endjob;\n        }\n    }\n\n    if (!(chk = qemuCheckpointObjFromCheckpoint(vm, checkpoint)))\n        goto endjob;\n\n    if (flags & (VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN |\n                 VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY)) {\n        rem.driver = driver;\n        rem.vm = vm;\n        rem.metadata_only = metadata_only;\n        rem.err = 0;\n        rem.current = virDomainCheckpointGetCurrent(vm->checkpoints);\n        rem.found = false;\n        rem.momentDiscard = qemuCheckpointDiscard;\n        virDomainMomentForEachDescendant(chk, qemuDomainMomentDiscardAll,\n                                         &rem);\n        if (rem.err < 0)\n            goto endjob;\n        if (rem.found) {\n            virDomainCheckpointSetCurrent(vm->checkpoints, chk);\n            if (flags & VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY) {\n                if (qemuCheckpointWriteMetadata(vm, chk,\n                                                driver->xmlopt,\n                                                cfg->checkpointDir) < 0) {\n                    virReportError(VIR_ERR_INTERNAL_ERROR,\n                                   _(\"failed to set checkpoint '%s' as current\"),\n                                   chk->def->name);\n                    virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n                    goto endjob;\n                }\n            }\n        }\n    } else if (chk->nchildren) {\n        rep.dir = cfg->checkpointDir;\n        rep.parent = chk->parent;\n        rep.vm = vm;\n        rep.err = 0;\n        rep.xmlopt = driver->xmlopt;\n        virDomainMomentForEachChild(chk, qemuCheckpointReparentChildren,\n                                    &rep);\n        if (rep.err < 0)\n            goto endjob;\n        virDomainMomentMoveChildren(chk, chk->parent);\n    }\n\n    if (flags & VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY) {\n        virDomainMomentDropChildren(chk);\n        ret = 0;\n    } else {\n        ret = qemuCheckpointDiscard(driver, vm, chk, true, metadata_only);\n    }\n\n endjob:\n    qemuDomainObjEndJob(driver, vm);\n    return ret;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuDomainObjEndJob",
          "args": [
            "driver",
            "vm"
          ],
          "line": 838
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjEndJob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10032-10051",
          "snippet": "void\nqemuDomainObjEndJob(virQEMUDriverPtr driver, virDomainObjPtr obj)\n{\n    qemuDomainObjPrivatePtr priv = obj->privateData;\n    qemuDomainJob job = priv->job.active;\n\n    priv->jobs_queued--;\n\n    VIR_DEBUG(\"Stopping job: %s (async=%s vm=%p name=%s)\",\n              qemuDomainJobTypeToString(job),\n              qemuDomainAsyncJobTypeToString(priv->job.asyncJob),\n              obj, obj->def->name);\n\n    qemuDomainObjResetJob(priv);\n    if (qemuDomainTrackJob(job))\n        qemuDomainObjSaveStatus(driver, obj);\n    /* We indeed need to wake up ALL threads waiting because\n     * grabbing a job requires checking more variables. */\n    virCondBroadcast(&priv->job.cond);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuDomainLogContextFinalize(GObject *obj);",
            "static void qemuDomainSaveCookieDispose(void *obj);",
            "static void qemuDomainDiskPrivateDispose(void *obj);",
            "static void qemuDomainStorageSourcePrivateDispose(void *obj);",
            "static void qemuDomainVcpuPrivateDispose(void *obj);",
            "static void qemuDomainChrSourcePrivateDispose(void *obj);",
            "static void qemuDomainVsockPrivateDispose(void *obj);",
            "static void qemuDomainGraphicsPrivateDispose(void *obj);",
            "static void qemuDomainNetworkPrivateDispose(void *obj);",
            "static void qemuDomainFSPrivateDispose(void *obj);",
            "static void qemuDomainVideoPrivateDispose(void *obj);",
            "qemuDomainJobTypeToString(job),\n              qemuDomainAgentJobTypeToString(agentJob),\n              qemuDomainAsyncJobTypeToString(asyncJob),\n              obj, obj->def->name,\n              qemuDomainJobTypeToString(priv->job.active),\n              qemuDomainAgentJobTypeToString(priv->job.agentActive),\n              qemuDomainAsyncJobTypeToString(priv->job.asyncJob));",
            "obj, obj->def->name);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nstatic void qemuDomainLogContextFinalize(GObject *obj);\nstatic void qemuDomainSaveCookieDispose(void *obj);\nstatic void qemuDomainDiskPrivateDispose(void *obj);\nstatic void qemuDomainStorageSourcePrivateDispose(void *obj);\nstatic void qemuDomainVcpuPrivateDispose(void *obj);\nstatic void qemuDomainChrSourcePrivateDispose(void *obj);\nstatic void qemuDomainVsockPrivateDispose(void *obj);\nstatic void qemuDomainGraphicsPrivateDispose(void *obj);\nstatic void qemuDomainNetworkPrivateDispose(void *obj);\nstatic void qemuDomainFSPrivateDispose(void *obj);\nstatic void qemuDomainVideoPrivateDispose(void *obj);\nqemuDomainJobTypeToString(job),\n              qemuDomainAgentJobTypeToString(agentJob),\n              qemuDomainAsyncJobTypeToString(asyncJob),\n              obj, obj->def->name,\n              qemuDomainJobTypeToString(priv->job.active),\n              qemuDomainAgentJobTypeToString(priv->job.agentActive),\n              qemuDomainAsyncJobTypeToString(priv->job.asyncJob));\nobj, obj->def->name);\n\nvoid\nqemuDomainObjEndJob(virQEMUDriverPtr driver, virDomainObjPtr obj)\n{\n    qemuDomainObjPrivatePtr priv = obj->privateData;\n    qemuDomainJob job = priv->job.active;\n\n    priv->jobs_queued--;\n\n    VIR_DEBUG(\"Stopping job: %s (async=%s vm=%p name=%s)\",\n              qemuDomainJobTypeToString(job),\n              qemuDomainAsyncJobTypeToString(priv->job.asyncJob),\n              obj, obj->def->name);\n\n    qemuDomainObjResetJob(priv);\n    if (qemuDomainTrackJob(job))\n        qemuDomainObjSaveStatus(driver, obj);\n    /* We indeed need to wake up ALL threads waiting because\n     * grabbing a job requires checking more variables. */\n    virCondBroadcast(&priv->job.cond);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointDiscard",
          "args": [
            "driver",
            "vm",
            "chk",
            "true",
            "metadata_only"
          ],
          "line": 834
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointDiscard",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "330-380",
          "snippet": "static int\nqemuCheckpointDiscard(virQEMUDriverPtr driver,\n                      virDomainObjPtr vm,\n                      virDomainMomentObjPtr chk,\n                      bool update_parent,\n                      bool metadata_only)\n{\n    virDomainMomentObjPtr parent = NULL;\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *chkFile = NULL;\n    bool chkcurrent = chk == virDomainCheckpointGetCurrent(vm->checkpoints);\n\n    if (!metadata_only && !virDomainObjIsActive(vm)) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                       _(\"cannot remove checkpoint from inactive domain\"));\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s/%s.xml\", cfg->checkpointDir, vm->def->name,\n                              chk->def->name);\n\n    if (!metadata_only) {\n        virDomainCheckpointDefPtr chkdef = virDomainCheckpointObjGetDef(chk);\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               chk->def->parent_name);\n        if (qemuCheckpointDiscardBitmaps(vm, chkdef, parent) < 0)\n            return -1;\n    }\n\n    if (chkcurrent) {\n        virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n        if (update_parent && parent) {\n            virDomainCheckpointSetCurrent(vm->checkpoints, parent);\n            if (qemuCheckpointWriteMetadata(vm, parent,\n                                            driver->xmlopt,\n                                            cfg->checkpointDir) < 0) {\n                VIR_WARN(\"failed to set parent checkpoint '%s' as current\",\n                         chk->def->parent_name);\n                virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n            }\n        }\n    }\n\n    if (unlink(chkFile) < 0)\n        VIR_WARN(\"Failed to unlink %s\", chkFile);\n    if (update_parent)\n        virDomainMomentDropParent(chk);\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n\n    return 0;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointDiscard(virQEMUDriverPtr driver,\n                      virDomainObjPtr vm,\n                      virDomainMomentObjPtr chk,\n                      bool update_parent,\n                      bool metadata_only)\n{\n    virDomainMomentObjPtr parent = NULL;\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *chkFile = NULL;\n    bool chkcurrent = chk == virDomainCheckpointGetCurrent(vm->checkpoints);\n\n    if (!metadata_only && !virDomainObjIsActive(vm)) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                       _(\"cannot remove checkpoint from inactive domain\"));\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s/%s.xml\", cfg->checkpointDir, vm->def->name,\n                              chk->def->name);\n\n    if (!metadata_only) {\n        virDomainCheckpointDefPtr chkdef = virDomainCheckpointObjGetDef(chk);\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               chk->def->parent_name);\n        if (qemuCheckpointDiscardBitmaps(vm, chkdef, parent) < 0)\n            return -1;\n    }\n\n    if (chkcurrent) {\n        virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n        if (update_parent && parent) {\n            virDomainCheckpointSetCurrent(vm->checkpoints, parent);\n            if (qemuCheckpointWriteMetadata(vm, parent,\n                                            driver->xmlopt,\n                                            cfg->checkpointDir) < 0) {\n                VIR_WARN(\"failed to set parent checkpoint '%s' as current\",\n                         chk->def->parent_name);\n                virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n            }\n        }\n    }\n\n    if (unlink(chkFile) < 0)\n        VIR_WARN(\"Failed to unlink %s\", chkFile);\n    if (update_parent)\n        virDomainMomentDropParent(chk);\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainMomentDropChildren",
          "args": [
            "chk"
          ],
          "line": 831
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainMomentDropChildren",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomainmomentobjlist.c",
          "lines": "145-150",
          "snippet": "void\nvirDomainMomentDropChildren(virDomainMomentObjPtr moment)\n{\n    moment->nchildren = 0;\n    moment->first_child = NULL;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"viralloc.h\"",
            "#include \"moment_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"viralloc.h\"\n#include \"moment_conf.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirDomainMomentDropChildren(virDomainMomentObjPtr moment)\n{\n    moment->nchildren = 0;\n    moment->first_child = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainMomentMoveChildren",
          "args": [
            "chk",
            "chk->parent"
          ],
          "line": 827
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainMomentMoveChildren",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomainmomentobjlist.c",
          "lines": "187-207",
          "snippet": "void\nvirDomainMomentMoveChildren(virDomainMomentObjPtr from,\n                            virDomainMomentObjPtr to)\n{\n    virDomainMomentObjPtr child = from->first_child;\n\n    if (!from->nchildren)\n        return;\n    while (child) {\n        child->parent = to;\n        if (!child->sibling) {\n            child->sibling = to->first_child;\n            break;\n        }\n        child = child->sibling;\n    }\n    to->nchildren += from->nchildren;\n    to->first_child = from->first_child;\n    from->nchildren = 0;\n    from->first_child = NULL;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"viralloc.h\"",
            "#include \"moment_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"viralloc.h\"\n#include \"moment_conf.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirDomainMomentMoveChildren(virDomainMomentObjPtr from,\n                            virDomainMomentObjPtr to)\n{\n    virDomainMomentObjPtr child = from->first_child;\n\n    if (!from->nchildren)\n        return;\n    while (child) {\n        child->parent = to;\n        if (!child->sibling) {\n            child->sibling = to->first_child;\n            break;\n        }\n        child = child->sibling;\n    }\n    to->nchildren += from->nchildren;\n    to->first_child = from->first_child;\n    from->nchildren = 0;\n    from->first_child = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainMomentForEachChild",
          "args": [
            "chk",
            "qemuCheckpointReparentChildren",
            "&rep"
          ],
          "line": 823
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainMomentForEachChild",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomainmomentobjlist.c",
          "lines": "55-69",
          "snippet": "int\nvirDomainMomentForEachChild(virDomainMomentObjPtr moment,\n                            virHashIterator iter,\n                            void *data)\n{\n    virDomainMomentObjPtr child = moment->first_child;\n\n    while (child) {\n        virDomainMomentObjPtr next = child->sibling;\n        (iter)(child, child->def->name, data);\n        child = next;\n    }\n\n    return moment->nchildren;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"viralloc.h\"",
            "#include \"moment_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"viralloc.h\"\n#include \"moment_conf.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDomainMomentForEachChild(virDomainMomentObjPtr moment,\n                            virHashIterator iter,\n                            void *data)\n{\n    virDomainMomentObjPtr child = moment->first_child;\n\n    while (child) {\n        virDomainMomentObjPtr next = child->sibling;\n        (iter)(child, child->def->name, data);\n        child = next;\n    }\n\n    return moment->nchildren;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointSetCurrent",
          "args": [
            "vm->checkpoints",
            "NULL"
          ],
          "line": 812
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointSetCurrent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "134-139",
          "snippet": "void\nvirDomainCheckpointSetCurrent(virDomainCheckpointObjListPtr checkpoints,\n                              virDomainMomentObjPtr checkpoint)\n{\n    virDomainMomentSetCurrent(checkpoints->base, checkpoint);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirDomainCheckpointSetCurrent(virDomainCheckpointObjListPtr checkpoints,\n                              virDomainMomentObjPtr checkpoint)\n{\n    virDomainMomentSetCurrent(checkpoints->base, checkpoint);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"failed to set checkpoint '%s' as current\")",
            "chk->def->name"
          ],
          "line": 809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to set checkpoint '%s' as current\""
          ],
          "line": 810
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointWriteMetadata",
          "args": [
            "vm",
            "chk",
            "driver->xmlopt",
            "cfg->checkpointDir"
          ],
          "line": 806
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointWriteMetadata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "79-105",
          "snippet": "static int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainMomentForEachDescendant",
          "args": [
            "chk",
            "qemuDomainMomentDiscardAll",
            "&rem"
          ],
          "line": 799
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainMomentForEachDescendant",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomainmomentobjlist.c",
          "lines": "98-112",
          "snippet": "int\nvirDomainMomentForEachDescendant(virDomainMomentObjPtr moment,\n                                 virHashIterator iter,\n                                 void *data)\n{\n    struct moment_act_on_descendant act;\n\n    act.number = 0;\n    act.iter = iter;\n    act.data = data;\n    virDomainMomentForEachChild(moment,\n                                virDomainMomentActOnDescendant, &act);\n\n    return act.number;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"viralloc.h\"",
            "#include \"moment_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"viralloc.h\"\n#include \"moment_conf.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDomainMomentForEachDescendant(virDomainMomentObjPtr moment,\n                                 virHashIterator iter,\n                                 void *data)\n{\n    struct moment_act_on_descendant act;\n\n    act.number = 0;\n    act.iter = iter;\n    act.data = data;\n    virDomainMomentForEachChild(moment,\n                                virDomainMomentActOnDescendant, &act);\n\n    return act.number;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointGetCurrent",
          "args": [
            "vm->checkpoints"
          ],
          "line": 796
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointGetCurrentName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "126-130",
          "snippet": "const char *\nvirDomainCheckpointGetCurrentName(virDomainCheckpointObjListPtr checkpoints)\n{\n    return virDomainMomentGetCurrentName(checkpoints->base);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nconst char *\nvirDomainCheckpointGetCurrentName(virDomainCheckpointObjListPtr checkpoints)\n{\n    return virDomainMomentGetCurrentName(checkpoints->base);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointObjFromCheckpoint",
          "args": [
            "vm",
            "checkpoint"
          ],
          "line": 787
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointObjFromCheckpoint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "71-76",
          "snippet": "virDomainMomentObjPtr\nqemuCheckpointObjFromCheckpoint(virDomainObjPtr vm,\n                                virDomainCheckpointPtr checkpoint)\n{\n    return qemuCheckpointObjFromName(vm, checkpoint->name);\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirDomainMomentObjPtr\nqemuCheckpointObjFromCheckpoint(virDomainObjPtr vm,\n                                virDomainCheckpointPtr checkpoint)\n{\n    return qemuCheckpointObjFromName(vm, checkpoint->name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_UNSUPPORTED",
            "\"%s\"",
            "_(\"cannot delete checkpoint for inactive domain\")"
          ],
          "line": 781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainObjIsActive",
          "args": [
            "vm"
          ],
          "line": 780
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainObjIsActive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.h",
          "lines": "2845-2849",
          "snippet": "static inline bool\nvirDomainObjIsActive(virDomainObjPtr dom)\n{\n    return dom->def->id != -1;\n}",
          "includes": [
            "#include \"virenum.h\"",
            "#include \"virresctrl.h\"",
            "#include \"virsavecookie.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virperf.h\"",
            "#include \"virgic.h\"",
            "#include \"virprocess.h\"",
            "#include \"virseclabel.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virbitmap.h\"",
            "#include \"device_conf.h\"",
            "#include \"virobject.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"virnetdevvlan.h\"",
            "#include \"virnetdevbandwidth.h\"",
            "#include \"virnetdevvportprofile.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"numa_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"networkcommon_conf.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virthread.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"capabilities.h\"",
            "#include \"virconftypes.h\"",
            "#include \"internal.h\"",
            "#include <libxml/xpath.h>",
            "#include <libxml/tree.h>",
            "#include <libxml/parser.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virDomainMemoryDefFree(virDomainMemoryDefPtr def);",
            "void virDomainIOThreadIDDefFree(virDomainIOThreadIDDefPtr def);",
            "unsigned long long virDomainDefGetMemoryInitial(const virDomainDef *def);",
            "unsigned long long virDomainDefGetMemoryTotal(const virDomainDef *def);",
            "bool virDomainDefHasMemoryHotplug(const virDomainDef *def);",
            "int virDomainXMLOptionRunMomentPostParse(virDomainXMLOptionPtr xmlopt,\n                                         virDomainMomentDefPtr def);",
            "bool virDomainDefHasUSB(const virDomainDef *def);",
            "int virDomainObjCheckActive(virDomainObjPtr dom);",
            "bool virDomainDefHasVcpusOffline(const virDomainDef *def);",
            "unsigned int virDomainDefGetVcpusMax(const virDomainDef *def);",
            "unsigned int virDomainDefGetVcpus(const virDomainDef *def);",
            "virBitmapPtr virDomainDefGetOnlineVcpumap(const virDomainDef *def);",
            "void virDomainDefVcpuOrderClear(virDomainDefPtr def);",
            "void virDomainGraphicsDefFree(virDomainGraphicsDefPtr def);",
            "void virDomainInputDefFree(virDomainInputDefPtr def);",
            "void virDomainDiskDefFree(virDomainDiskDefPtr def);",
            "void virDomainLeaseDefFree(virDomainLeaseDefPtr def);",
            "int virDomainDiskGetType(virDomainDiskDefPtr def);",
            "const char *virDomainDiskGetSource(virDomainDiskDef const *def);",
            "void virDomainDiskEmptySource(virDomainDiskDefPtr def);",
            "const char *virDomainDiskGetDriver(const virDomainDiskDef *def);",
            "int virDomainDiskGetFormat(virDomainDiskDefPtr def);",
            "void virDomainControllerDefFree(virDomainControllerDefPtr def);",
            "void virDomainFSDefFree(virDomainFSDefPtr def);",
            "void virDomainActualNetDefFree(virDomainActualNetDefPtr def);",
            "void virDomainNetDefClear(virDomainNetDefPtr def);",
            "void virDomainNetDefFree(virDomainNetDefPtr def);",
            "void virDomainSmartcardDefFree(virDomainSmartcardDefPtr def);",
            "void virDomainChrDefFree(virDomainChrDefPtr def);",
            "void virDomainSoundCodecDefFree(virDomainSoundCodecDefPtr def);",
            "void virDomainSoundDefFree(virDomainSoundDefPtr def);",
            "void virDomainMemballoonDefFree(virDomainMemballoonDefPtr def);",
            "void virDomainNVRAMDefFree(virDomainNVRAMDefPtr def);",
            "void virDomainWatchdogDefFree(virDomainWatchdogDefPtr def);",
            "void virDomainVideoDefFree(virDomainVideoDefPtr def);",
            "void virDomainVideoDefClear(virDomainVideoDefPtr def);",
            "void virDomainHostdevDefClear(virDomainHostdevDefPtr def);",
            "void virDomainHostdevDefFree(virDomainHostdevDefPtr def);",
            "void virDomainHubDefFree(virDomainHubDefPtr def);",
            "void virDomainRedirdevDefFree(virDomainRedirdevDefPtr def);",
            "void virDomainRedirFilterDefFree(virDomainRedirFilterDefPtr def);",
            "void virDomainShmemDefFree(virDomainShmemDefPtr def);",
            "void virDomainDeviceDefFree(virDomainDeviceDefPtr def);",
            "void virDomainTPMDefFree(virDomainTPMDefPtr def);",
            "void virDomainRNGDefFree(virDomainRNGDefPtr def);",
            "int virDomainDeleteConfig(const char *configDir,\n                          const char *autostartDir,\n                          virDomainObjPtr dom);",
            "int virDomainVideoDefaultType(const virDomainDef *def);",
            "void virDomainChrSourceDefClear(virDomainChrSourceDefPtr def);",
            "int virDomainDiskTranslateSourcePool(virDomainDiskDefPtr def);",
            "bool\nvirDomainDefHasManagedPR(const virDomainDef *def);",
            "bool\nvirDomainDefHasNVMeDisk(const virDomainDef *def);",
            "bool\nvirDomainDefHasVFIOHostdev(const virDomainDef *def);",
            "bool\nvirDomainDefHasMdevHostdev(const virDomainDef *def);",
            "bool\nvirDomainDefHasOldStyleUEFI(const virDomainDef *def);",
            "bool\nvirDomainDefHasOldStyleROUEFI(const virDomainDef *def);",
            "bool\nvirDomainGraphicsDefHasOpenGL(const virDomainDef *def);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virenum.h\"\n#include \"virresctrl.h\"\n#include \"virsavecookie.h\"\n#include \"virtypedparam.h\"\n#include \"virperf.h\"\n#include \"virgic.h\"\n#include \"virprocess.h\"\n#include \"virseclabel.h\"\n#include \"virstoragefile.h\"\n#include \"virbitmap.h\"\n#include \"device_conf.h\"\n#include \"virobject.h\"\n#include \"virnetworkportdef.h\"\n#include \"virnetdevvlan.h\"\n#include \"virnetdevbandwidth.h\"\n#include \"virnetdevvportprofile.h\"\n#include \"virnetdevip.h\"\n#include \"virnetdev.h\"\n#include \"virsysinfo.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"numa_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"networkcommon_conf.h\"\n#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virthread.h\"\n#include \"cpu_conf.h\"\n#include \"virstorageencryption.h\"\n#include \"capabilities.h\"\n#include \"virconftypes.h\"\n#include \"internal.h\"\n#include <libxml/xpath.h>\n#include <libxml/tree.h>\n#include <libxml/parser.h>\n\nvoid virDomainMemoryDefFree(virDomainMemoryDefPtr def);\nvoid virDomainIOThreadIDDefFree(virDomainIOThreadIDDefPtr def);\nunsigned long long virDomainDefGetMemoryInitial(const virDomainDef *def);\nunsigned long long virDomainDefGetMemoryTotal(const virDomainDef *def);\nbool virDomainDefHasMemoryHotplug(const virDomainDef *def);\nint virDomainXMLOptionRunMomentPostParse(virDomainXMLOptionPtr xmlopt,\n                                         virDomainMomentDefPtr def);\nbool virDomainDefHasUSB(const virDomainDef *def);\nint virDomainObjCheckActive(virDomainObjPtr dom);\nbool virDomainDefHasVcpusOffline(const virDomainDef *def);\nunsigned int virDomainDefGetVcpusMax(const virDomainDef *def);\nunsigned int virDomainDefGetVcpus(const virDomainDef *def);\nvirBitmapPtr virDomainDefGetOnlineVcpumap(const virDomainDef *def);\nvoid virDomainDefVcpuOrderClear(virDomainDefPtr def);\nvoid virDomainGraphicsDefFree(virDomainGraphicsDefPtr def);\nvoid virDomainInputDefFree(virDomainInputDefPtr def);\nvoid virDomainDiskDefFree(virDomainDiskDefPtr def);\nvoid virDomainLeaseDefFree(virDomainLeaseDefPtr def);\nint virDomainDiskGetType(virDomainDiskDefPtr def);\nconst char *virDomainDiskGetSource(virDomainDiskDef const *def);\nvoid virDomainDiskEmptySource(virDomainDiskDefPtr def);\nconst char *virDomainDiskGetDriver(const virDomainDiskDef *def);\nint virDomainDiskGetFormat(virDomainDiskDefPtr def);\nvoid virDomainControllerDefFree(virDomainControllerDefPtr def);\nvoid virDomainFSDefFree(virDomainFSDefPtr def);\nvoid virDomainActualNetDefFree(virDomainActualNetDefPtr def);\nvoid virDomainNetDefClear(virDomainNetDefPtr def);\nvoid virDomainNetDefFree(virDomainNetDefPtr def);\nvoid virDomainSmartcardDefFree(virDomainSmartcardDefPtr def);\nvoid virDomainChrDefFree(virDomainChrDefPtr def);\nvoid virDomainSoundCodecDefFree(virDomainSoundCodecDefPtr def);\nvoid virDomainSoundDefFree(virDomainSoundDefPtr def);\nvoid virDomainMemballoonDefFree(virDomainMemballoonDefPtr def);\nvoid virDomainNVRAMDefFree(virDomainNVRAMDefPtr def);\nvoid virDomainWatchdogDefFree(virDomainWatchdogDefPtr def);\nvoid virDomainVideoDefFree(virDomainVideoDefPtr def);\nvoid virDomainVideoDefClear(virDomainVideoDefPtr def);\nvoid virDomainHostdevDefClear(virDomainHostdevDefPtr def);\nvoid virDomainHostdevDefFree(virDomainHostdevDefPtr def);\nvoid virDomainHubDefFree(virDomainHubDefPtr def);\nvoid virDomainRedirdevDefFree(virDomainRedirdevDefPtr def);\nvoid virDomainRedirFilterDefFree(virDomainRedirFilterDefPtr def);\nvoid virDomainShmemDefFree(virDomainShmemDefPtr def);\nvoid virDomainDeviceDefFree(virDomainDeviceDefPtr def);\nvoid virDomainTPMDefFree(virDomainTPMDefPtr def);\nvoid virDomainRNGDefFree(virDomainRNGDefPtr def);\nint virDomainDeleteConfig(const char *configDir,\n                          const char *autostartDir,\n                          virDomainObjPtr dom);\nint virDomainVideoDefaultType(const virDomainDef *def);\nvoid virDomainChrSourceDefClear(virDomainChrSourceDefPtr def);\nint virDomainDiskTranslateSourcePool(virDomainDiskDefPtr def);\nbool\nvirDomainDefHasManagedPR(const virDomainDef *def);\nbool\nvirDomainDefHasNVMeDisk(const virDomainDef *def);\nbool\nvirDomainDefHasVFIOHostdev(const virDomainDef *def);\nbool\nvirDomainDefHasMdevHostdev(const virDomainDef *def);\nbool\nvirDomainDefHasOldStyleUEFI(const virDomainDef *def);\nbool\nvirDomainDefHasOldStyleROUEFI(const virDomainDef *def);\nbool\nvirDomainGraphicsDefHasOpenGL(const virDomainDef *def);\n\nstatic inline bool\nvirDomainObjIsActive(virDomainObjPtr dom)\n{\n    return dom->def->id != -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_UNSUPPORTED",
            "\"%s\"",
            "_(\"incremental backup is not supported yet\")"
          ],
          "line": 775
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virQEMUCapsGet",
          "args": [
            "priv->qemuCaps",
            "QEMU_CAPS_INCREMENTAL_BACKUP"
          ],
          "line": 774
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUCapsGetPreferredMachine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_capabilities.c",
          "lines": "5555-5564",
          "snippet": "const char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <stdarg.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"virutil.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_qapi.h\"",
            "#include \"qemu_capspriv.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"virstring.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virnuma.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu_x86.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfilecache.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vircrypto.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <stdarg.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"virutil.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_process.h\"\n#include \"qemu_qapi.h\"\n#include \"qemu_capspriv.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_hostdev.h\"\n#include \"virstring.h\"\n#include \"qemu_monitor.h\"\n#include \"virhostcpu.h\"\n#include \"virnuma.h\"\n#include \"virnodesuspend.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu_x86.h\"\n#include \"cpu/cpu.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfilecache.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vircrypto.h\"\n#include \"viralloc.h\"\n#include \"qemu_capabilities.h\"\n#include <config.h>\n\nconst char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainObjBeginJob",
          "args": [
            "driver",
            "vm",
            "QEMU_JOB_MODIFY"
          ],
          "line": 770
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjBeginJobNowait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10016-10024",
          "snippet": "int\nqemuDomainObjBeginJobNowait(virQEMUDriverPtr driver,\n                            virDomainObjPtr obj,\n                            qemuDomainJob job)\n{\n    return qemuDomainObjBeginJobInternal(driver, obj, job,\n                                         QEMU_AGENT_JOB_NONE,\n                                         QEMU_ASYNC_JOB_NONE, true);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuDomainLogContextFinalize(GObject *obj);",
            "static void qemuDomainSaveCookieDispose(void *obj);",
            "static void qemuDomainDiskPrivateDispose(void *obj);",
            "static void qemuDomainStorageSourcePrivateDispose(void *obj);",
            "static void qemuDomainVcpuPrivateDispose(void *obj);",
            "static void qemuDomainChrSourcePrivateDispose(void *obj);",
            "static void qemuDomainVsockPrivateDispose(void *obj);",
            "static void qemuDomainGraphicsPrivateDispose(void *obj);",
            "static void qemuDomainNetworkPrivateDispose(void *obj);",
            "static void qemuDomainFSPrivateDispose(void *obj);",
            "static void qemuDomainVideoPrivateDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nstatic void qemuDomainLogContextFinalize(GObject *obj);\nstatic void qemuDomainSaveCookieDispose(void *obj);\nstatic void qemuDomainDiskPrivateDispose(void *obj);\nstatic void qemuDomainStorageSourcePrivateDispose(void *obj);\nstatic void qemuDomainVcpuPrivateDispose(void *obj);\nstatic void qemuDomainChrSourcePrivateDispose(void *obj);\nstatic void qemuDomainVsockPrivateDispose(void *obj);\nstatic void qemuDomainGraphicsPrivateDispose(void *obj);\nstatic void qemuDomainNetworkPrivateDispose(void *obj);\nstatic void qemuDomainFSPrivateDispose(void *obj);\nstatic void qemuDomainVideoPrivateDispose(void *obj);\n\nint\nqemuDomainObjBeginJobNowait(virQEMUDriverPtr driver,\n                            virDomainObjPtr obj,\n                            qemuDomainJob job)\n{\n    return qemuDomainObjBeginJobInternal(driver, obj, job,\n                                         QEMU_AGENT_JOB_NONE,\n                                         QEMU_ASYNC_JOB_NONE, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN |\n                  VIR_DOMAIN_CHECKPOINT_DELETE_METADATA_ONLY |\n                  VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY",
            "-1"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virQEMUDriverGetConfig",
          "args": [
            "driver"
          ],
          "line": 759
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_conf.c",
          "lines": "1211-1218",
          "snippet": "virQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virsocket.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virlog.h\"",
            "#include \"virxml.h\"",
            "#include \"datatypes.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"storage_conf.h\"\n#include \"virstring.h\"\n#include \"virsocket.h\"\n#include \"virfile.h\"\n#include \"domain_nwfilter.h\"\n#include \"cpu/cpu.h\"\n#include \"virlog.h\"\n#include \"virxml.h\"\n#include \"datatypes.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"qemu_security.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nqemuCheckpointDelete(virDomainObjPtr vm,\n                     virDomainCheckpointPtr checkpoint,\n                     unsigned int flags)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    int ret = -1;\n    virDomainMomentObjPtr chk = NULL;\n    virQEMUMomentRemove rem;\n    struct virQEMUCheckpointReparent rep;\n    bool metadata_only = !!(flags & VIR_DOMAIN_CHECKPOINT_DELETE_METADATA_ONLY);\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN |\n                  VIR_DOMAIN_CHECKPOINT_DELETE_METADATA_ONLY |\n                  VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY, -1);\n\n    if (qemuDomainObjBeginJob(driver, vm, QEMU_JOB_MODIFY) < 0)\n        return -1;\n\n    if (!metadata_only) {\n        if (!virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_INCREMENTAL_BACKUP)) {\n            virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                           _(\"incremental backup is not supported yet\"));\n            goto endjob;\n        }\n\n        if (!virDomainObjIsActive(vm)) {\n            virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                           _(\"cannot delete checkpoint for inactive domain\"));\n            goto endjob;\n        }\n    }\n\n    if (!(chk = qemuCheckpointObjFromCheckpoint(vm, checkpoint)))\n        goto endjob;\n\n    if (flags & (VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN |\n                 VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY)) {\n        rem.driver = driver;\n        rem.vm = vm;\n        rem.metadata_only = metadata_only;\n        rem.err = 0;\n        rem.current = virDomainCheckpointGetCurrent(vm->checkpoints);\n        rem.found = false;\n        rem.momentDiscard = qemuCheckpointDiscard;\n        virDomainMomentForEachDescendant(chk, qemuDomainMomentDiscardAll,\n                                         &rem);\n        if (rem.err < 0)\n            goto endjob;\n        if (rem.found) {\n            virDomainCheckpointSetCurrent(vm->checkpoints, chk);\n            if (flags & VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY) {\n                if (qemuCheckpointWriteMetadata(vm, chk,\n                                                driver->xmlopt,\n                                                cfg->checkpointDir) < 0) {\n                    virReportError(VIR_ERR_INTERNAL_ERROR,\n                                   _(\"failed to set checkpoint '%s' as current\"),\n                                   chk->def->name);\n                    virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n                    goto endjob;\n                }\n            }\n        }\n    } else if (chk->nchildren) {\n        rep.dir = cfg->checkpointDir;\n        rep.parent = chk->parent;\n        rep.vm = vm;\n        rep.err = 0;\n        rep.xmlopt = driver->xmlopt;\n        virDomainMomentForEachChild(chk, qemuCheckpointReparentChildren,\n                                    &rep);\n        if (rep.err < 0)\n            goto endjob;\n        virDomainMomentMoveChildren(chk, chk->parent);\n    }\n\n    if (flags & VIR_DOMAIN_CHECKPOINT_DELETE_CHILDREN_ONLY) {\n        virDomainMomentDropChildren(chk);\n        ret = 0;\n    } else {\n        ret = qemuCheckpointDiscard(driver, vm, chk, true, metadata_only);\n    }\n\n endjob:\n    qemuDomainObjEndJob(driver, vm);\n    return ret;\n}"
  },
  {
    "function_name": "qemuCheckpointReparentChildren",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "730-749",
    "snippet": "static int\nqemuCheckpointReparentChildren(void *payload,\n                               const void *name G_GNUC_UNUSED,\n                               void *data)\n{\n    virDomainMomentObjPtr moment = payload;\n    struct virQEMUCheckpointReparent *rep = data;\n\n    if (rep->err < 0)\n        return 0;\n\n    VIR_FREE(moment->def->parent_name);\n\n    if (rep->parent->def)\n        moment->def->parent_name = g_strdup(rep->parent->def->name);\n\n    rep->err = qemuCheckpointWriteMetadata(rep->vm, moment,\n                                           rep->xmlopt, rep->dir);\n    return 0;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuCheckpointWriteMetadata",
          "args": [
            "rep->vm",
            "moment",
            "rep->xmlopt",
            "rep->dir"
          ],
          "line": 746
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointWriteMetadata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "79-105",
          "snippet": "static int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "rep->parent->def->name"
          ],
          "line": 744
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "moment->def->parent_name"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointReparentChildren(void *payload,\n                               const void *name G_GNUC_UNUSED,\n                               void *data)\n{\n    virDomainMomentObjPtr moment = payload;\n    struct virQEMUCheckpointReparent *rep = data;\n\n    if (rep->err < 0)\n        return 0;\n\n    VIR_FREE(moment->def->parent_name);\n\n    if (rep->parent->def)\n        moment->def->parent_name = g_strdup(rep->parent->def->name);\n\n    rep->err = qemuCheckpointWriteMetadata(rep->vm, moment,\n                                           rep->xmlopt, rep->dir);\n    return 0;\n}"
  },
  {
    "function_name": "qemuCheckpointGetXMLDesc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "696-718",
    "snippet": "char *\nqemuCheckpointGetXMLDesc(virDomainObjPtr vm,\n                         virDomainCheckpointPtr checkpoint,\n                         unsigned int flags)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    virDomainMomentObjPtr chk = NULL;\n    virDomainCheckpointDefPtr chkdef;\n    unsigned int format_flags;\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_XML_SECURE |\n                  VIR_DOMAIN_CHECKPOINT_XML_NO_DOMAIN, NULL);\n\n    if (!(chk = qemuCheckpointObjFromCheckpoint(vm, checkpoint)))\n        return NULL;\n\n    chkdef = virDomainCheckpointObjGetDef(chk);\n\n    format_flags = virDomainCheckpointFormatConvertXMLFlags(flags);\n    return virDomainCheckpointDefFormat(chkdef, driver->xmlopt,\n                                        format_flags);\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainCheckpointDefFormat",
          "args": [
            "chkdef",
            "driver->xmlopt",
            "format_flags"
          ],
          "line": 716
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointDefFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/checkpoint_conf.c",
          "lines": "500-515",
          "snippet": "char *\nvirDomainCheckpointDefFormat(virDomainCheckpointDefPtr def,\n                             virDomainXMLOptionPtr xmlopt,\n                             unsigned int flags)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE |\n                  VIR_DOMAIN_CHECKPOINT_FORMAT_NO_DOMAIN |\n                  VIR_DOMAIN_CHECKPOINT_FORMAT_SIZE, NULL);\n    if (virDomainCheckpointDefFormatInternal(&buf, def, xmlopt,\n                                             flags) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virbitmap.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virstoragefile.h\"\n#include \"checkpoint_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"virbitmap.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <config.h>\n\nchar *\nvirDomainCheckpointDefFormat(virDomainCheckpointDefPtr def,\n                             virDomainXMLOptionPtr xmlopt,\n                             unsigned int flags)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE |\n                  VIR_DOMAIN_CHECKPOINT_FORMAT_NO_DOMAIN |\n                  VIR_DOMAIN_CHECKPOINT_FORMAT_SIZE, NULL);\n    if (virDomainCheckpointDefFormatInternal(&buf, def, xmlopt,\n                                             flags) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointFormatConvertXMLFlags",
          "args": [
            "flags"
          ],
          "line": 715
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointFormatConvertXMLFlags",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/checkpoint_conf.c",
          "lines": "404-416",
          "snippet": "unsigned int virDomainCheckpointFormatConvertXMLFlags(unsigned int flags)\n{\n    unsigned int formatFlags = 0;\n\n    if (flags & VIR_DOMAIN_CHECKPOINT_XML_SECURE)\n        formatFlags |= VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    if (flags & VIR_DOMAIN_CHECKPOINT_XML_NO_DOMAIN)\n        formatFlags |= VIR_DOMAIN_CHECKPOINT_FORMAT_NO_DOMAIN;\n    if (flags & VIR_DOMAIN_CHECKPOINT_XML_SIZE)\n        formatFlags |= VIR_DOMAIN_CHECKPOINT_FORMAT_SIZE;\n\n    return formatFlags;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virbitmap.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virstoragefile.h\"\n#include \"checkpoint_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"virbitmap.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <config.h>\n\nunsigned int virDomainCheckpointFormatConvertXMLFlags(unsigned int flags)\n{\n    unsigned int formatFlags = 0;\n\n    if (flags & VIR_DOMAIN_CHECKPOINT_XML_SECURE)\n        formatFlags |= VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    if (flags & VIR_DOMAIN_CHECKPOINT_XML_NO_DOMAIN)\n        formatFlags |= VIR_DOMAIN_CHECKPOINT_FORMAT_NO_DOMAIN;\n    if (flags & VIR_DOMAIN_CHECKPOINT_XML_SIZE)\n        formatFlags |= VIR_DOMAIN_CHECKPOINT_FORMAT_SIZE;\n\n    return formatFlags;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointObjGetDef",
          "args": [
            "chk"
          ],
          "line": 713
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.h",
          "lines": "92-96",
          "snippet": "static inline virDomainCheckpointDefPtr\nvirDomainCheckpointObjGetDef(virDomainMomentObjPtr obj)\n{\n    return (virDomainCheckpointDefPtr) obj->def;\n}",
          "includes": [
            "#include \"virbuffer.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "virDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virbuffer.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n\nvirDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def);\n\nstatic inline virDomainCheckpointDefPtr\nvirDomainCheckpointObjGetDef(virDomainMomentObjPtr obj)\n{\n    return (virDomainCheckpointDefPtr) obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointObjFromCheckpoint",
          "args": [
            "vm",
            "checkpoint"
          ],
          "line": 710
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointObjFromCheckpoint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "71-76",
          "snippet": "virDomainMomentObjPtr\nqemuCheckpointObjFromCheckpoint(virDomainObjPtr vm,\n                                virDomainCheckpointPtr checkpoint)\n{\n    return qemuCheckpointObjFromName(vm, checkpoint->name);\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirDomainMomentObjPtr\nqemuCheckpointObjFromCheckpoint(virDomainObjPtr vm,\n                                virDomainCheckpointPtr checkpoint)\n{\n    return qemuCheckpointObjFromName(vm, checkpoint->name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_DOMAIN_CHECKPOINT_XML_SECURE |\n                  VIR_DOMAIN_CHECKPOINT_XML_NO_DOMAIN",
            "NULL"
          ],
          "line": 707
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nchar *\nqemuCheckpointGetXMLDesc(virDomainObjPtr vm,\n                         virDomainCheckpointPtr checkpoint,\n                         unsigned int flags)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    virDomainMomentObjPtr chk = NULL;\n    virDomainCheckpointDefPtr chkdef;\n    unsigned int format_flags;\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_XML_SECURE |\n                  VIR_DOMAIN_CHECKPOINT_XML_NO_DOMAIN, NULL);\n\n    if (!(chk = qemuCheckpointObjFromCheckpoint(vm, checkpoint)))\n        return NULL;\n\n    chkdef = virDomainCheckpointObjGetDef(chk);\n\n    format_flags = virDomainCheckpointFormatConvertXMLFlags(flags);\n    return virDomainCheckpointDefFormat(chkdef, driver->xmlopt,\n                                        format_flags);\n}"
  },
  {
    "function_name": "qemuCheckpointCreateXML",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "627-693",
    "snippet": "virDomainCheckpointPtr\nqemuCheckpointCreateXML(virDomainPtr domain,\n                        virDomainObjPtr vm,\n                        const char *xmlDesc,\n                        unsigned int flags)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    virDomainMomentObjPtr chk = NULL;\n    virDomainCheckpointPtr checkpoint = NULL;\n    bool update_current = true;\n    bool redefine = flags & VIR_DOMAIN_CHECKPOINT_CREATE_REDEFINE;\n    unsigned int parse_flags = 0;\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autoptr(virDomainCheckpointDef) def = NULL;\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_CREATE_REDEFINE, NULL);\n\n    if (redefine) {\n        parse_flags |= VIR_DOMAIN_CHECKPOINT_PARSE_REDEFINE;\n        update_current = false;\n    }\n\n    if (!virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_INCREMENTAL_BACKUP)) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                       _(\"incremental backup is not supported yet\"));\n        return NULL;\n    }\n\n    if (!virDomainObjIsActive(vm)) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                       _(\"cannot create checkpoint for inactive domain\"));\n        return NULL;\n    }\n\n    if (!(def = virDomainCheckpointDefParseString(xmlDesc, driver->xmlopt,\n                                                  priv->qemuCaps, parse_flags)))\n        return NULL;\n    /* Unlike snapshots, the RNG schema already ensured a sane filename. */\n\n    /* We are going to modify the domain below. */\n    if (qemuDomainObjBeginJob(driver, vm, QEMU_JOB_MODIFY) < 0)\n        return NULL;\n\n    if (redefine) {\n        chk = qemuCheckpointRedefine(driver, vm, &def, &update_current);\n    } else {\n        chk = qemuCheckpointCreate(driver, vm, &def);\n    }\n\n    if (!chk)\n        goto endjob;\n\n    if (qemuCheckpointCreateFinalize(driver, vm, cfg, chk, update_current) < 0)\n        goto endjob;\n\n    /* If we fail after this point, there's not a whole lot we can do;\n     * we've successfully created the checkpoint, so we have to go\n     * forward the best we can.\n     */\n    checkpoint = virGetDomainCheckpoint(domain, chk->def->name);\n\n endjob:\n    qemuDomainObjEndJob(driver, vm);\n\n    return checkpoint;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuDomainObjEndJob",
          "args": [
            "driver",
            "vm"
          ],
          "line": 690
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjEndJob",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10032-10051",
          "snippet": "void\nqemuDomainObjEndJob(virQEMUDriverPtr driver, virDomainObjPtr obj)\n{\n    qemuDomainObjPrivatePtr priv = obj->privateData;\n    qemuDomainJob job = priv->job.active;\n\n    priv->jobs_queued--;\n\n    VIR_DEBUG(\"Stopping job: %s (async=%s vm=%p name=%s)\",\n              qemuDomainJobTypeToString(job),\n              qemuDomainAsyncJobTypeToString(priv->job.asyncJob),\n              obj, obj->def->name);\n\n    qemuDomainObjResetJob(priv);\n    if (qemuDomainTrackJob(job))\n        qemuDomainObjSaveStatus(driver, obj);\n    /* We indeed need to wake up ALL threads waiting because\n     * grabbing a job requires checking more variables. */\n    virCondBroadcast(&priv->job.cond);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuDomainLogContextFinalize(GObject *obj);",
            "static void qemuDomainSaveCookieDispose(void *obj);",
            "static void qemuDomainDiskPrivateDispose(void *obj);",
            "static void qemuDomainStorageSourcePrivateDispose(void *obj);",
            "static void qemuDomainVcpuPrivateDispose(void *obj);",
            "static void qemuDomainChrSourcePrivateDispose(void *obj);",
            "static void qemuDomainVsockPrivateDispose(void *obj);",
            "static void qemuDomainGraphicsPrivateDispose(void *obj);",
            "static void qemuDomainNetworkPrivateDispose(void *obj);",
            "static void qemuDomainFSPrivateDispose(void *obj);",
            "static void qemuDomainVideoPrivateDispose(void *obj);",
            "qemuDomainJobTypeToString(job),\n              qemuDomainAgentJobTypeToString(agentJob),\n              qemuDomainAsyncJobTypeToString(asyncJob),\n              obj, obj->def->name,\n              qemuDomainJobTypeToString(priv->job.active),\n              qemuDomainAgentJobTypeToString(priv->job.agentActive),\n              qemuDomainAsyncJobTypeToString(priv->job.asyncJob));",
            "obj, obj->def->name);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nstatic void qemuDomainLogContextFinalize(GObject *obj);\nstatic void qemuDomainSaveCookieDispose(void *obj);\nstatic void qemuDomainDiskPrivateDispose(void *obj);\nstatic void qemuDomainStorageSourcePrivateDispose(void *obj);\nstatic void qemuDomainVcpuPrivateDispose(void *obj);\nstatic void qemuDomainChrSourcePrivateDispose(void *obj);\nstatic void qemuDomainVsockPrivateDispose(void *obj);\nstatic void qemuDomainGraphicsPrivateDispose(void *obj);\nstatic void qemuDomainNetworkPrivateDispose(void *obj);\nstatic void qemuDomainFSPrivateDispose(void *obj);\nstatic void qemuDomainVideoPrivateDispose(void *obj);\nqemuDomainJobTypeToString(job),\n              qemuDomainAgentJobTypeToString(agentJob),\n              qemuDomainAsyncJobTypeToString(asyncJob),\n              obj, obj->def->name,\n              qemuDomainJobTypeToString(priv->job.active),\n              qemuDomainAgentJobTypeToString(priv->job.agentActive),\n              qemuDomainAsyncJobTypeToString(priv->job.asyncJob));\nobj, obj->def->name);\n\nvoid\nqemuDomainObjEndJob(virQEMUDriverPtr driver, virDomainObjPtr obj)\n{\n    qemuDomainObjPrivatePtr priv = obj->privateData;\n    qemuDomainJob job = priv->job.active;\n\n    priv->jobs_queued--;\n\n    VIR_DEBUG(\"Stopping job: %s (async=%s vm=%p name=%s)\",\n              qemuDomainJobTypeToString(job),\n              qemuDomainAsyncJobTypeToString(priv->job.asyncJob),\n              obj, obj->def->name);\n\n    qemuDomainObjResetJob(priv);\n    if (qemuDomainTrackJob(job))\n        qemuDomainObjSaveStatus(driver, obj);\n    /* We indeed need to wake up ALL threads waiting because\n     * grabbing a job requires checking more variables. */\n    virCondBroadcast(&priv->job.cond);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetDomainCheckpoint",
          "args": [
            "domain",
            "chk->def->name"
          ],
          "line": 687
        },
        "resolved": true,
        "details": {
          "function_name": "virGetDomainCheckpoint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/datatypes.c",
          "lines": "966-989",
          "snippet": "virDomainCheckpointPtr\nvirGetDomainCheckpoint(virDomainPtr domain,\n                       const char *name)\n{\n    virDomainCheckpointPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckDomainGoto(domain, error);\n    virCheckNonNullArgGoto(name, error);\n\n    if (!(ret = virObjectNew(virDomainCheckpointClass)))\n        goto error;\n    ret->name = g_strdup(name);\n\n    ret->domain = virObjectRef(domain);\n\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virClassPtr virDomainCheckpointClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirClassPtr virDomainCheckpointClass;\n\nvirDomainCheckpointPtr\nvirGetDomainCheckpoint(virDomainPtr domain,\n                       const char *name)\n{\n    virDomainCheckpointPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckDomainGoto(domain, error);\n    virCheckNonNullArgGoto(name, error);\n\n    if (!(ret = virObjectNew(virDomainCheckpointClass)))\n        goto error;\n    ret->name = g_strdup(name);\n\n    ret->domain = virObjectRef(domain);\n\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointCreateFinalize",
          "args": [
            "driver",
            "vm",
            "cfg",
            "chk",
            "update_current"
          ],
          "line": 680
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointCreateFinalize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "599-624",
          "snippet": "int\nqemuCheckpointCreateFinalize(virQEMUDriverPtr driver,\n                             virDomainObjPtr vm,\n                             virQEMUDriverConfigPtr cfg,\n                             virDomainMomentObjPtr chk,\n                             bool update_current)\n{\n    if (update_current)\n        virDomainCheckpointSetCurrent(vm->checkpoints, chk);\n\n    if (qemuCheckpointWriteMetadata(vm, chk,\n                                    driver->xmlopt,\n                                    cfg->checkpointDir) < 0) {\n        /* if writing of metadata fails, error out rather than trying\n         * to silently carry on without completing the checkpoint */\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to save metadata for checkpoint %s\"),\n                       chk->def->name);\n        qemuCheckpointRollbackMetadata(vm, chk);\n        return -1;\n    }\n\n    virDomainCheckpointLinkParent(vm->checkpoints, chk);\n\n    return 0;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nqemuCheckpointCreateFinalize(virQEMUDriverPtr driver,\n                             virDomainObjPtr vm,\n                             virQEMUDriverConfigPtr cfg,\n                             virDomainMomentObjPtr chk,\n                             bool update_current)\n{\n    if (update_current)\n        virDomainCheckpointSetCurrent(vm->checkpoints, chk);\n\n    if (qemuCheckpointWriteMetadata(vm, chk,\n                                    driver->xmlopt,\n                                    cfg->checkpointDir) < 0) {\n        /* if writing of metadata fails, error out rather than trying\n         * to silently carry on without completing the checkpoint */\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to save metadata for checkpoint %s\"),\n                       chk->def->name);\n        qemuCheckpointRollbackMetadata(vm, chk);\n        return -1;\n    }\n\n    virDomainCheckpointLinkParent(vm->checkpoints, chk);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointCreate",
          "args": [
            "driver",
            "vm",
            "&def"
          ],
          "line": 674
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "576-596",
          "snippet": "static virDomainMomentObjPtr\nqemuCheckpointCreate(virQEMUDriverPtr driver,\n                     virDomainObjPtr vm,\n                     virDomainCheckpointDefPtr *def)\n{\n    g_autoptr(virJSONValue) actions = NULL;\n    virDomainMomentObjPtr chk = NULL;\n    int rc;\n\n    if (qemuCheckpointCreateCommon(driver, vm, def, &actions, &chk) < 0)\n        return NULL;\n\n    qemuDomainObjEnterMonitor(driver, vm);\n    rc = qemuMonitorTransaction(qemuDomainGetMonitor(vm), &actions);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0 || rc < 0) {\n        qemuCheckpointRollbackMetadata(vm, chk);\n        return NULL;\n    }\n\n    return chk;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic virDomainMomentObjPtr\nqemuCheckpointCreate(virQEMUDriverPtr driver,\n                     virDomainObjPtr vm,\n                     virDomainCheckpointDefPtr *def)\n{\n    g_autoptr(virJSONValue) actions = NULL;\n    virDomainMomentObjPtr chk = NULL;\n    int rc;\n\n    if (qemuCheckpointCreateCommon(driver, vm, def, &actions, &chk) < 0)\n        return NULL;\n\n    qemuDomainObjEnterMonitor(driver, vm);\n    rc = qemuMonitorTransaction(qemuDomainGetMonitor(vm), &actions);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0 || rc < 0) {\n        qemuCheckpointRollbackMetadata(vm, chk);\n        return NULL;\n    }\n\n    return chk;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointRedefine",
          "args": [
            "driver",
            "vm",
            "&def",
            "&update_current"
          ],
          "line": 672
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointRedefine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "502-524",
          "snippet": "static virDomainMomentObjPtr\nqemuCheckpointRedefine(virQEMUDriverPtr driver,\n                       virDomainObjPtr vm,\n                       virDomainCheckpointDefPtr *def,\n                       bool *update_current)\n{\n    virDomainMomentObjPtr chk = NULL;\n\n    if (virDomainCheckpointRedefinePrep(vm, def, &chk, driver->xmlopt,\n                                        update_current) < 0)\n        return NULL;\n\n    /* XXX Should we validate that the redefined checkpoint even\n     * makes sense, such as checking that qemu-img recognizes the\n     * checkpoint bitmap name in at least one of the domain's disks?  */\n\n    if (chk)\n        return chk;\n\n    chk = virDomainCheckpointAssignDef(vm->checkpoints, *def);\n    *def = NULL;\n    return chk;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic virDomainMomentObjPtr\nqemuCheckpointRedefine(virQEMUDriverPtr driver,\n                       virDomainObjPtr vm,\n                       virDomainCheckpointDefPtr *def,\n                       bool *update_current)\n{\n    virDomainMomentObjPtr chk = NULL;\n\n    if (virDomainCheckpointRedefinePrep(vm, def, &chk, driver->xmlopt,\n                                        update_current) < 0)\n        return NULL;\n\n    /* XXX Should we validate that the redefined checkpoint even\n     * makes sense, such as checking that qemu-img recognizes the\n     * checkpoint bitmap name in at least one of the domain's disks?  */\n\n    if (chk)\n        return chk;\n\n    chk = virDomainCheckpointAssignDef(vm->checkpoints, *def);\n    *def = NULL;\n    return chk;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainObjBeginJob",
          "args": [
            "driver",
            "vm",
            "QEMU_JOB_MODIFY"
          ],
          "line": 668
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjBeginJobNowait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10016-10024",
          "snippet": "int\nqemuDomainObjBeginJobNowait(virQEMUDriverPtr driver,\n                            virDomainObjPtr obj,\n                            qemuDomainJob job)\n{\n    return qemuDomainObjBeginJobInternal(driver, obj, job,\n                                         QEMU_AGENT_JOB_NONE,\n                                         QEMU_ASYNC_JOB_NONE, true);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuDomainLogContextFinalize(GObject *obj);",
            "static void qemuDomainSaveCookieDispose(void *obj);",
            "static void qemuDomainDiskPrivateDispose(void *obj);",
            "static void qemuDomainStorageSourcePrivateDispose(void *obj);",
            "static void qemuDomainVcpuPrivateDispose(void *obj);",
            "static void qemuDomainChrSourcePrivateDispose(void *obj);",
            "static void qemuDomainVsockPrivateDispose(void *obj);",
            "static void qemuDomainGraphicsPrivateDispose(void *obj);",
            "static void qemuDomainNetworkPrivateDispose(void *obj);",
            "static void qemuDomainFSPrivateDispose(void *obj);",
            "static void qemuDomainVideoPrivateDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nstatic void qemuDomainLogContextFinalize(GObject *obj);\nstatic void qemuDomainSaveCookieDispose(void *obj);\nstatic void qemuDomainDiskPrivateDispose(void *obj);\nstatic void qemuDomainStorageSourcePrivateDispose(void *obj);\nstatic void qemuDomainVcpuPrivateDispose(void *obj);\nstatic void qemuDomainChrSourcePrivateDispose(void *obj);\nstatic void qemuDomainVsockPrivateDispose(void *obj);\nstatic void qemuDomainGraphicsPrivateDispose(void *obj);\nstatic void qemuDomainNetworkPrivateDispose(void *obj);\nstatic void qemuDomainFSPrivateDispose(void *obj);\nstatic void qemuDomainVideoPrivateDispose(void *obj);\n\nint\nqemuDomainObjBeginJobNowait(virQEMUDriverPtr driver,\n                            virDomainObjPtr obj,\n                            qemuDomainJob job)\n{\n    return qemuDomainObjBeginJobInternal(driver, obj, job,\n                                         QEMU_AGENT_JOB_NONE,\n                                         QEMU_ASYNC_JOB_NONE, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointDefParseString",
          "args": [
            "xmlDesc",
            "driver->xmlopt",
            "priv->qemuCaps",
            "parse_flags"
          ],
          "line": 662
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointDefParseString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/checkpoint_conf.c",
          "lines": "229-248",
          "snippet": "virDomainCheckpointDefPtr\nvirDomainCheckpointDefParseString(const char *xmlStr,\n                                  virDomainXMLOptionPtr xmlopt,\n                                  void *parseOpaque,\n                                  unsigned int flags)\n{\n    virDomainCheckpointDefPtr ret = NULL;\n    xmlDocPtr xml;\n    int keepBlanksDefault = xmlKeepBlanksDefault(0);\n\n    if ((xml = virXMLParse(NULL, xmlStr, _(\"(domain_checkpoint)\")))) {\n        xmlKeepBlanksDefault(keepBlanksDefault);\n        ret = virDomainCheckpointDefParseNode(xml, xmlDocGetRootElement(xml),\n                                              xmlopt, parseOpaque, flags);\n        xmlFreeDoc(xml);\n    }\n    xmlKeepBlanksDefault(keepBlanksDefault);\n\n    return ret;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virbitmap.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virstoragefile.h\"\n#include \"checkpoint_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"virbitmap.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <config.h>\n\nvirDomainCheckpointDefPtr\nvirDomainCheckpointDefParseString(const char *xmlStr,\n                                  virDomainXMLOptionPtr xmlopt,\n                                  void *parseOpaque,\n                                  unsigned int flags)\n{\n    virDomainCheckpointDefPtr ret = NULL;\n    xmlDocPtr xml;\n    int keepBlanksDefault = xmlKeepBlanksDefault(0);\n\n    if ((xml = virXMLParse(NULL, xmlStr, _(\"(domain_checkpoint)\")))) {\n        xmlKeepBlanksDefault(keepBlanksDefault);\n        ret = virDomainCheckpointDefParseNode(xml, xmlDocGetRootElement(xml),\n                                              xmlopt, parseOpaque, flags);\n        xmlFreeDoc(xml);\n    }\n    xmlKeepBlanksDefault(keepBlanksDefault);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_UNSUPPORTED",
            "\"%s\"",
            "_(\"cannot create checkpoint for inactive domain\")"
          ],
          "line": 657
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot create checkpoint for inactive domain\""
          ],
          "line": 658
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainObjIsActive",
          "args": [
            "vm"
          ],
          "line": 656
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainObjIsActive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.h",
          "lines": "2845-2849",
          "snippet": "static inline bool\nvirDomainObjIsActive(virDomainObjPtr dom)\n{\n    return dom->def->id != -1;\n}",
          "includes": [
            "#include \"virenum.h\"",
            "#include \"virresctrl.h\"",
            "#include \"virsavecookie.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virperf.h\"",
            "#include \"virgic.h\"",
            "#include \"virprocess.h\"",
            "#include \"virseclabel.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virbitmap.h\"",
            "#include \"device_conf.h\"",
            "#include \"virobject.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"virnetdevvlan.h\"",
            "#include \"virnetdevbandwidth.h\"",
            "#include \"virnetdevvportprofile.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"numa_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"networkcommon_conf.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virthread.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"capabilities.h\"",
            "#include \"virconftypes.h\"",
            "#include \"internal.h\"",
            "#include <libxml/xpath.h>",
            "#include <libxml/tree.h>",
            "#include <libxml/parser.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virDomainMemoryDefFree(virDomainMemoryDefPtr def);",
            "void virDomainIOThreadIDDefFree(virDomainIOThreadIDDefPtr def);",
            "unsigned long long virDomainDefGetMemoryInitial(const virDomainDef *def);",
            "unsigned long long virDomainDefGetMemoryTotal(const virDomainDef *def);",
            "bool virDomainDefHasMemoryHotplug(const virDomainDef *def);",
            "int virDomainXMLOptionRunMomentPostParse(virDomainXMLOptionPtr xmlopt,\n                                         virDomainMomentDefPtr def);",
            "bool virDomainDefHasUSB(const virDomainDef *def);",
            "int virDomainObjCheckActive(virDomainObjPtr dom);",
            "bool virDomainDefHasVcpusOffline(const virDomainDef *def);",
            "unsigned int virDomainDefGetVcpusMax(const virDomainDef *def);",
            "unsigned int virDomainDefGetVcpus(const virDomainDef *def);",
            "virBitmapPtr virDomainDefGetOnlineVcpumap(const virDomainDef *def);",
            "void virDomainDefVcpuOrderClear(virDomainDefPtr def);",
            "void virDomainGraphicsDefFree(virDomainGraphicsDefPtr def);",
            "void virDomainInputDefFree(virDomainInputDefPtr def);",
            "void virDomainDiskDefFree(virDomainDiskDefPtr def);",
            "void virDomainLeaseDefFree(virDomainLeaseDefPtr def);",
            "int virDomainDiskGetType(virDomainDiskDefPtr def);",
            "const char *virDomainDiskGetSource(virDomainDiskDef const *def);",
            "void virDomainDiskEmptySource(virDomainDiskDefPtr def);",
            "const char *virDomainDiskGetDriver(const virDomainDiskDef *def);",
            "int virDomainDiskGetFormat(virDomainDiskDefPtr def);",
            "void virDomainControllerDefFree(virDomainControllerDefPtr def);",
            "void virDomainFSDefFree(virDomainFSDefPtr def);",
            "void virDomainActualNetDefFree(virDomainActualNetDefPtr def);",
            "void virDomainNetDefClear(virDomainNetDefPtr def);",
            "void virDomainNetDefFree(virDomainNetDefPtr def);",
            "void virDomainSmartcardDefFree(virDomainSmartcardDefPtr def);",
            "void virDomainChrDefFree(virDomainChrDefPtr def);",
            "void virDomainSoundCodecDefFree(virDomainSoundCodecDefPtr def);",
            "void virDomainSoundDefFree(virDomainSoundDefPtr def);",
            "void virDomainMemballoonDefFree(virDomainMemballoonDefPtr def);",
            "void virDomainNVRAMDefFree(virDomainNVRAMDefPtr def);",
            "void virDomainWatchdogDefFree(virDomainWatchdogDefPtr def);",
            "void virDomainVideoDefFree(virDomainVideoDefPtr def);",
            "void virDomainVideoDefClear(virDomainVideoDefPtr def);",
            "void virDomainHostdevDefClear(virDomainHostdevDefPtr def);",
            "void virDomainHostdevDefFree(virDomainHostdevDefPtr def);",
            "void virDomainHubDefFree(virDomainHubDefPtr def);",
            "void virDomainRedirdevDefFree(virDomainRedirdevDefPtr def);",
            "void virDomainRedirFilterDefFree(virDomainRedirFilterDefPtr def);",
            "void virDomainShmemDefFree(virDomainShmemDefPtr def);",
            "void virDomainDeviceDefFree(virDomainDeviceDefPtr def);",
            "void virDomainTPMDefFree(virDomainTPMDefPtr def);",
            "void virDomainRNGDefFree(virDomainRNGDefPtr def);",
            "int virDomainDeleteConfig(const char *configDir,\n                          const char *autostartDir,\n                          virDomainObjPtr dom);",
            "int virDomainVideoDefaultType(const virDomainDef *def);",
            "void virDomainChrSourceDefClear(virDomainChrSourceDefPtr def);",
            "int virDomainDiskTranslateSourcePool(virDomainDiskDefPtr def);",
            "bool\nvirDomainDefHasManagedPR(const virDomainDef *def);",
            "bool\nvirDomainDefHasNVMeDisk(const virDomainDef *def);",
            "bool\nvirDomainDefHasVFIOHostdev(const virDomainDef *def);",
            "bool\nvirDomainDefHasMdevHostdev(const virDomainDef *def);",
            "bool\nvirDomainDefHasOldStyleUEFI(const virDomainDef *def);",
            "bool\nvirDomainDefHasOldStyleROUEFI(const virDomainDef *def);",
            "bool\nvirDomainGraphicsDefHasOpenGL(const virDomainDef *def);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virenum.h\"\n#include \"virresctrl.h\"\n#include \"virsavecookie.h\"\n#include \"virtypedparam.h\"\n#include \"virperf.h\"\n#include \"virgic.h\"\n#include \"virprocess.h\"\n#include \"virseclabel.h\"\n#include \"virstoragefile.h\"\n#include \"virbitmap.h\"\n#include \"device_conf.h\"\n#include \"virobject.h\"\n#include \"virnetworkportdef.h\"\n#include \"virnetdevvlan.h\"\n#include \"virnetdevbandwidth.h\"\n#include \"virnetdevvportprofile.h\"\n#include \"virnetdevip.h\"\n#include \"virnetdev.h\"\n#include \"virsysinfo.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"numa_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"networkcommon_conf.h\"\n#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virthread.h\"\n#include \"cpu_conf.h\"\n#include \"virstorageencryption.h\"\n#include \"capabilities.h\"\n#include \"virconftypes.h\"\n#include \"internal.h\"\n#include <libxml/xpath.h>\n#include <libxml/tree.h>\n#include <libxml/parser.h>\n\nvoid virDomainMemoryDefFree(virDomainMemoryDefPtr def);\nvoid virDomainIOThreadIDDefFree(virDomainIOThreadIDDefPtr def);\nunsigned long long virDomainDefGetMemoryInitial(const virDomainDef *def);\nunsigned long long virDomainDefGetMemoryTotal(const virDomainDef *def);\nbool virDomainDefHasMemoryHotplug(const virDomainDef *def);\nint virDomainXMLOptionRunMomentPostParse(virDomainXMLOptionPtr xmlopt,\n                                         virDomainMomentDefPtr def);\nbool virDomainDefHasUSB(const virDomainDef *def);\nint virDomainObjCheckActive(virDomainObjPtr dom);\nbool virDomainDefHasVcpusOffline(const virDomainDef *def);\nunsigned int virDomainDefGetVcpusMax(const virDomainDef *def);\nunsigned int virDomainDefGetVcpus(const virDomainDef *def);\nvirBitmapPtr virDomainDefGetOnlineVcpumap(const virDomainDef *def);\nvoid virDomainDefVcpuOrderClear(virDomainDefPtr def);\nvoid virDomainGraphicsDefFree(virDomainGraphicsDefPtr def);\nvoid virDomainInputDefFree(virDomainInputDefPtr def);\nvoid virDomainDiskDefFree(virDomainDiskDefPtr def);\nvoid virDomainLeaseDefFree(virDomainLeaseDefPtr def);\nint virDomainDiskGetType(virDomainDiskDefPtr def);\nconst char *virDomainDiskGetSource(virDomainDiskDef const *def);\nvoid virDomainDiskEmptySource(virDomainDiskDefPtr def);\nconst char *virDomainDiskGetDriver(const virDomainDiskDef *def);\nint virDomainDiskGetFormat(virDomainDiskDefPtr def);\nvoid virDomainControllerDefFree(virDomainControllerDefPtr def);\nvoid virDomainFSDefFree(virDomainFSDefPtr def);\nvoid virDomainActualNetDefFree(virDomainActualNetDefPtr def);\nvoid virDomainNetDefClear(virDomainNetDefPtr def);\nvoid virDomainNetDefFree(virDomainNetDefPtr def);\nvoid virDomainSmartcardDefFree(virDomainSmartcardDefPtr def);\nvoid virDomainChrDefFree(virDomainChrDefPtr def);\nvoid virDomainSoundCodecDefFree(virDomainSoundCodecDefPtr def);\nvoid virDomainSoundDefFree(virDomainSoundDefPtr def);\nvoid virDomainMemballoonDefFree(virDomainMemballoonDefPtr def);\nvoid virDomainNVRAMDefFree(virDomainNVRAMDefPtr def);\nvoid virDomainWatchdogDefFree(virDomainWatchdogDefPtr def);\nvoid virDomainVideoDefFree(virDomainVideoDefPtr def);\nvoid virDomainVideoDefClear(virDomainVideoDefPtr def);\nvoid virDomainHostdevDefClear(virDomainHostdevDefPtr def);\nvoid virDomainHostdevDefFree(virDomainHostdevDefPtr def);\nvoid virDomainHubDefFree(virDomainHubDefPtr def);\nvoid virDomainRedirdevDefFree(virDomainRedirdevDefPtr def);\nvoid virDomainRedirFilterDefFree(virDomainRedirFilterDefPtr def);\nvoid virDomainShmemDefFree(virDomainShmemDefPtr def);\nvoid virDomainDeviceDefFree(virDomainDeviceDefPtr def);\nvoid virDomainTPMDefFree(virDomainTPMDefPtr def);\nvoid virDomainRNGDefFree(virDomainRNGDefPtr def);\nint virDomainDeleteConfig(const char *configDir,\n                          const char *autostartDir,\n                          virDomainObjPtr dom);\nint virDomainVideoDefaultType(const virDomainDef *def);\nvoid virDomainChrSourceDefClear(virDomainChrSourceDefPtr def);\nint virDomainDiskTranslateSourcePool(virDomainDiskDefPtr def);\nbool\nvirDomainDefHasManagedPR(const virDomainDef *def);\nbool\nvirDomainDefHasNVMeDisk(const virDomainDef *def);\nbool\nvirDomainDefHasVFIOHostdev(const virDomainDef *def);\nbool\nvirDomainDefHasMdevHostdev(const virDomainDef *def);\nbool\nvirDomainDefHasOldStyleUEFI(const virDomainDef *def);\nbool\nvirDomainDefHasOldStyleROUEFI(const virDomainDef *def);\nbool\nvirDomainGraphicsDefHasOpenGL(const virDomainDef *def);\n\nstatic inline bool\nvirDomainObjIsActive(virDomainObjPtr dom)\n{\n    return dom->def->id != -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_UNSUPPORTED",
            "\"%s\"",
            "_(\"incremental backup is not supported yet\")"
          ],
          "line": 651
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virQEMUCapsGet",
          "args": [
            "priv->qemuCaps",
            "QEMU_CAPS_INCREMENTAL_BACKUP"
          ],
          "line": 650
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUCapsGetPreferredMachine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_capabilities.c",
          "lines": "5555-5564",
          "snippet": "const char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <stdarg.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"virutil.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_qapi.h\"",
            "#include \"qemu_capspriv.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"virstring.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virnuma.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu_x86.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfilecache.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vircrypto.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <stdarg.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"virutil.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_process.h\"\n#include \"qemu_qapi.h\"\n#include \"qemu_capspriv.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_hostdev.h\"\n#include \"virstring.h\"\n#include \"qemu_monitor.h\"\n#include \"virhostcpu.h\"\n#include \"virnuma.h\"\n#include \"virnodesuspend.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu_x86.h\"\n#include \"cpu/cpu.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfilecache.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vircrypto.h\"\n#include \"viralloc.h\"\n#include \"qemu_capabilities.h\"\n#include <config.h>\n\nconst char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_DOMAIN_CHECKPOINT_CREATE_REDEFINE",
            "NULL"
          ],
          "line": 643
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virQEMUDriverGetConfig",
          "args": [
            "driver"
          ],
          "line": 640
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_conf.c",
          "lines": "1211-1218",
          "snippet": "virQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virsocket.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virlog.h\"",
            "#include \"virxml.h\"",
            "#include \"datatypes.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"storage_conf.h\"\n#include \"virstring.h\"\n#include \"virsocket.h\"\n#include \"virfile.h\"\n#include \"domain_nwfilter.h\"\n#include \"cpu/cpu.h\"\n#include \"virlog.h\"\n#include \"virxml.h\"\n#include \"datatypes.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"qemu_security.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirDomainCheckpointPtr\nqemuCheckpointCreateXML(virDomainPtr domain,\n                        virDomainObjPtr vm,\n                        const char *xmlDesc,\n                        unsigned int flags)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    virDomainMomentObjPtr chk = NULL;\n    virDomainCheckpointPtr checkpoint = NULL;\n    bool update_current = true;\n    bool redefine = flags & VIR_DOMAIN_CHECKPOINT_CREATE_REDEFINE;\n    unsigned int parse_flags = 0;\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autoptr(virDomainCheckpointDef) def = NULL;\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_CREATE_REDEFINE, NULL);\n\n    if (redefine) {\n        parse_flags |= VIR_DOMAIN_CHECKPOINT_PARSE_REDEFINE;\n        update_current = false;\n    }\n\n    if (!virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_INCREMENTAL_BACKUP)) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                       _(\"incremental backup is not supported yet\"));\n        return NULL;\n    }\n\n    if (!virDomainObjIsActive(vm)) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                       _(\"cannot create checkpoint for inactive domain\"));\n        return NULL;\n    }\n\n    if (!(def = virDomainCheckpointDefParseString(xmlDesc, driver->xmlopt,\n                                                  priv->qemuCaps, parse_flags)))\n        return NULL;\n    /* Unlike snapshots, the RNG schema already ensured a sane filename. */\n\n    /* We are going to modify the domain below. */\n    if (qemuDomainObjBeginJob(driver, vm, QEMU_JOB_MODIFY) < 0)\n        return NULL;\n\n    if (redefine) {\n        chk = qemuCheckpointRedefine(driver, vm, &def, &update_current);\n    } else {\n        chk = qemuCheckpointCreate(driver, vm, &def);\n    }\n\n    if (!chk)\n        goto endjob;\n\n    if (qemuCheckpointCreateFinalize(driver, vm, cfg, chk, update_current) < 0)\n        goto endjob;\n\n    /* If we fail after this point, there's not a whole lot we can do;\n     * we've successfully created the checkpoint, so we have to go\n     * forward the best we can.\n     */\n    checkpoint = virGetDomainCheckpoint(domain, chk->def->name);\n\n endjob:\n    qemuDomainObjEndJob(driver, vm);\n\n    return checkpoint;\n}"
  },
  {
    "function_name": "qemuCheckpointCreateFinalize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "599-624",
    "snippet": "int\nqemuCheckpointCreateFinalize(virQEMUDriverPtr driver,\n                             virDomainObjPtr vm,\n                             virQEMUDriverConfigPtr cfg,\n                             virDomainMomentObjPtr chk,\n                             bool update_current)\n{\n    if (update_current)\n        virDomainCheckpointSetCurrent(vm->checkpoints, chk);\n\n    if (qemuCheckpointWriteMetadata(vm, chk,\n                                    driver->xmlopt,\n                                    cfg->checkpointDir) < 0) {\n        /* if writing of metadata fails, error out rather than trying\n         * to silently carry on without completing the checkpoint */\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to save metadata for checkpoint %s\"),\n                       chk->def->name);\n        qemuCheckpointRollbackMetadata(vm, chk);\n        return -1;\n    }\n\n    virDomainCheckpointLinkParent(vm->checkpoints, chk);\n\n    return 0;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainCheckpointLinkParent",
          "args": [
            "vm->checkpoints",
            "chk"
          ],
          "line": 621
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointLinkParent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "169-174",
          "snippet": "void\nvirDomainCheckpointLinkParent(virDomainCheckpointObjListPtr checkpoints,\n                              virDomainMomentObjPtr chk)\n{\n    return virDomainMomentLinkParent(checkpoints->base, chk);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirDomainCheckpointLinkParent(virDomainCheckpointObjListPtr checkpoints,\n                              virDomainMomentObjPtr chk)\n{\n    return virDomainMomentLinkParent(checkpoints->base, chk);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointRollbackMetadata",
          "args": [
            "vm",
            "chk"
          ],
          "line": 617
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointRollbackMetadata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "565-573",
          "snippet": "void\nqemuCheckpointRollbackMetadata(virDomainObjPtr vm,\n                               virDomainMomentObjPtr chk)\n{\n    if (!chk)\n        return;\n\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nqemuCheckpointRollbackMetadata(virDomainObjPtr vm,\n                               virDomainMomentObjPtr chk)\n{\n    if (!chk)\n        return;\n\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"unable to save metadata for checkpoint %s\")",
            "chk->def->name"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unable to save metadata for checkpoint %s\""
          ],
          "line": 615
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointWriteMetadata",
          "args": [
            "vm",
            "chk",
            "driver->xmlopt",
            "cfg->checkpointDir"
          ],
          "line": 609
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointWriteMetadata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "79-105",
          "snippet": "static int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointSetCurrent",
          "args": [
            "vm->checkpoints",
            "chk"
          ],
          "line": 607
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointSetCurrent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "134-139",
          "snippet": "void\nvirDomainCheckpointSetCurrent(virDomainCheckpointObjListPtr checkpoints,\n                              virDomainMomentObjPtr checkpoint)\n{\n    virDomainMomentSetCurrent(checkpoints->base, checkpoint);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirDomainCheckpointSetCurrent(virDomainCheckpointObjListPtr checkpoints,\n                              virDomainMomentObjPtr checkpoint)\n{\n    virDomainMomentSetCurrent(checkpoints->base, checkpoint);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nqemuCheckpointCreateFinalize(virQEMUDriverPtr driver,\n                             virDomainObjPtr vm,\n                             virQEMUDriverConfigPtr cfg,\n                             virDomainMomentObjPtr chk,\n                             bool update_current)\n{\n    if (update_current)\n        virDomainCheckpointSetCurrent(vm->checkpoints, chk);\n\n    if (qemuCheckpointWriteMetadata(vm, chk,\n                                    driver->xmlopt,\n                                    cfg->checkpointDir) < 0) {\n        /* if writing of metadata fails, error out rather than trying\n         * to silently carry on without completing the checkpoint */\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to save metadata for checkpoint %s\"),\n                       chk->def->name);\n        qemuCheckpointRollbackMetadata(vm, chk);\n        return -1;\n    }\n\n    virDomainCheckpointLinkParent(vm->checkpoints, chk);\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuCheckpointCreate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "576-596",
    "snippet": "static virDomainMomentObjPtr\nqemuCheckpointCreate(virQEMUDriverPtr driver,\n                     virDomainObjPtr vm,\n                     virDomainCheckpointDefPtr *def)\n{\n    g_autoptr(virJSONValue) actions = NULL;\n    virDomainMomentObjPtr chk = NULL;\n    int rc;\n\n    if (qemuCheckpointCreateCommon(driver, vm, def, &actions, &chk) < 0)\n        return NULL;\n\n    qemuDomainObjEnterMonitor(driver, vm);\n    rc = qemuMonitorTransaction(qemuDomainGetMonitor(vm), &actions);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0 || rc < 0) {\n        qemuCheckpointRollbackMetadata(vm, chk);\n        return NULL;\n    }\n\n    return chk;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuCheckpointRollbackMetadata",
          "args": [
            "vm",
            "chk"
          ],
          "line": 591
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointRollbackMetadata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "565-573",
          "snippet": "void\nqemuCheckpointRollbackMetadata(virDomainObjPtr vm,\n                               virDomainMomentObjPtr chk)\n{\n    if (!chk)\n        return;\n\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nqemuCheckpointRollbackMetadata(virDomainObjPtr vm,\n                               virDomainMomentObjPtr chk)\n{\n    if (!chk)\n        return;\n\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainObjExitMonitor",
          "args": [
            "driver",
            "vm"
          ],
          "line": 590
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjExitMonitor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10189-10200",
          "snippet": "int qemuDomainObjExitMonitor(virQEMUDriverPtr driver,\n                             virDomainObjPtr obj)\n{\n    qemuDomainObjExitMonitorInternal(driver, obj);\n    if (!virDomainObjIsActive(obj)) {\n        if (virGetLastErrorCode() == VIR_ERR_OK)\n            virReportError(VIR_ERR_OPERATION_FAILED, \"%s\",\n                           _(\"domain is no longer running\"));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuDomainLogContextFinalize(GObject *obj);",
            "static void qemuDomainSaveCookieDispose(void *obj);",
            "static void qemuDomainDiskPrivateDispose(void *obj);",
            "static void qemuDomainStorageSourcePrivateDispose(void *obj);",
            "static void qemuDomainVcpuPrivateDispose(void *obj);",
            "static void qemuDomainChrSourcePrivateDispose(void *obj);",
            "static void qemuDomainVsockPrivateDispose(void *obj);",
            "static void qemuDomainGraphicsPrivateDispose(void *obj);",
            "static void qemuDomainNetworkPrivateDispose(void *obj);",
            "static void qemuDomainFSPrivateDispose(void *obj);",
            "static void qemuDomainVideoPrivateDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nstatic void qemuDomainLogContextFinalize(GObject *obj);\nstatic void qemuDomainSaveCookieDispose(void *obj);\nstatic void qemuDomainDiskPrivateDispose(void *obj);\nstatic void qemuDomainStorageSourcePrivateDispose(void *obj);\nstatic void qemuDomainVcpuPrivateDispose(void *obj);\nstatic void qemuDomainChrSourcePrivateDispose(void *obj);\nstatic void qemuDomainVsockPrivateDispose(void *obj);\nstatic void qemuDomainGraphicsPrivateDispose(void *obj);\nstatic void qemuDomainNetworkPrivateDispose(void *obj);\nstatic void qemuDomainFSPrivateDispose(void *obj);\nstatic void qemuDomainVideoPrivateDispose(void *obj);\n\nint qemuDomainObjExitMonitor(virQEMUDriverPtr driver,\n                             virDomainObjPtr obj)\n{\n    qemuDomainObjExitMonitorInternal(driver, obj);\n    if (!virDomainObjIsActive(obj)) {\n        if (virGetLastErrorCode() == VIR_ERR_OK)\n            virReportError(VIR_ERR_OPERATION_FAILED, \"%s\",\n                           _(\"domain is no longer running\"));\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuMonitorTransaction",
          "args": [
            "qemuDomainGetMonitor(vm)",
            "&actions"
          ],
          "line": 589
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransaction",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "3073-3081",
          "snippet": "int\nqemuMonitorTransaction(qemuMonitorPtr mon, virJSONValuePtr *actions)\n{\n    VIR_DEBUG(\"actions=%p\", *actions);\n\n    QEMU_CHECK_MONITOR(mon);\n\n    return qemuMonitorJSONTransaction(mon, actions);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransaction(qemuMonitorPtr mon, virJSONValuePtr *actions)\n{\n    VIR_DEBUG(\"actions=%p\", *actions);\n\n    QEMU_CHECK_MONITOR(mon);\n\n    return qemuMonitorJSONTransaction(mon, actions);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainGetMonitor",
          "args": [
            "vm"
          ],
          "line": 589
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainGetMonitor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "12703-12707",
          "snippet": "qemuMonitorPtr\nqemuDomainGetMonitor(virDomainObjPtr vm)\n{\n    return ((qemuDomainObjPrivatePtr) vm->privateData)->mon;\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nqemuMonitorPtr\nqemuDomainGetMonitor(virDomainObjPtr vm)\n{\n    return ((qemuDomainObjPrivatePtr) vm->privateData)->mon;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainObjEnterMonitor",
          "args": [
            "driver",
            "vm"
          ],
          "line": 588
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjEnterMonitor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10172-10177",
          "snippet": "void qemuDomainObjEnterMonitor(virQEMUDriverPtr driver,\n                               virDomainObjPtr obj)\n{\n    ignore_value(qemuDomainObjEnterMonitorInternal(driver, obj,\n                                                   QEMU_ASYNC_JOB_NONE));\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuDomainLogContextFinalize(GObject *obj);",
            "static void qemuDomainSaveCookieDispose(void *obj);",
            "static void qemuDomainDiskPrivateDispose(void *obj);",
            "static void qemuDomainStorageSourcePrivateDispose(void *obj);",
            "static void qemuDomainVcpuPrivateDispose(void *obj);",
            "static void qemuDomainChrSourcePrivateDispose(void *obj);",
            "static void qemuDomainVsockPrivateDispose(void *obj);",
            "static void qemuDomainGraphicsPrivateDispose(void *obj);",
            "static void qemuDomainNetworkPrivateDispose(void *obj);",
            "static void qemuDomainFSPrivateDispose(void *obj);",
            "static void qemuDomainVideoPrivateDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nstatic void qemuDomainLogContextFinalize(GObject *obj);\nstatic void qemuDomainSaveCookieDispose(void *obj);\nstatic void qemuDomainDiskPrivateDispose(void *obj);\nstatic void qemuDomainStorageSourcePrivateDispose(void *obj);\nstatic void qemuDomainVcpuPrivateDispose(void *obj);\nstatic void qemuDomainChrSourcePrivateDispose(void *obj);\nstatic void qemuDomainVsockPrivateDispose(void *obj);\nstatic void qemuDomainGraphicsPrivateDispose(void *obj);\nstatic void qemuDomainNetworkPrivateDispose(void *obj);\nstatic void qemuDomainFSPrivateDispose(void *obj);\nstatic void qemuDomainVideoPrivateDispose(void *obj);\n\nvoid qemuDomainObjEnterMonitor(virQEMUDriverPtr driver,\n                               virDomainObjPtr obj)\n{\n    ignore_value(qemuDomainObjEnterMonitorInternal(driver, obj,\n                                                   QEMU_ASYNC_JOB_NONE));\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointCreateCommon",
          "args": [
            "driver",
            "vm",
            "def",
            "&actions",
            "&chk"
          ],
          "line": 585
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointCreateCommon",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "527-555",
          "snippet": "int\nqemuCheckpointCreateCommon(virQEMUDriverPtr driver,\n                           virDomainObjPtr vm,\n                           virDomainCheckpointDefPtr *def,\n                           virJSONValuePtr *actions,\n                           virDomainMomentObjPtr *chk)\n{\n    g_autoptr(virJSONValue) tmpactions = NULL;\n    virDomainMomentObjPtr parent;\n\n    if (qemuCheckpointPrepare(driver, vm, *def) < 0)\n        return -1;\n\n    if ((parent = virDomainCheckpointGetCurrent(vm->checkpoints)))\n        (*def)->parent.parent_name = g_strdup(parent->def->name);\n\n    tmpactions = virJSONValueNewArray();\n\n    if (qemuCheckpointAddActions(vm, tmpactions, parent, *def) < 0)\n        return -1;\n\n    if (!(*chk = virDomainCheckpointAssignDef(vm->checkpoints, *def)))\n        return -1;\n\n    *def = NULL;\n\n    *actions = g_steal_pointer(&tmpactions);\n    return 0;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nqemuCheckpointCreateCommon(virQEMUDriverPtr driver,\n                           virDomainObjPtr vm,\n                           virDomainCheckpointDefPtr *def,\n                           virJSONValuePtr *actions,\n                           virDomainMomentObjPtr *chk)\n{\n    g_autoptr(virJSONValue) tmpactions = NULL;\n    virDomainMomentObjPtr parent;\n\n    if (qemuCheckpointPrepare(driver, vm, *def) < 0)\n        return -1;\n\n    if ((parent = virDomainCheckpointGetCurrent(vm->checkpoints)))\n        (*def)->parent.parent_name = g_strdup(parent->def->name);\n\n    tmpactions = virJSONValueNewArray();\n\n    if (qemuCheckpointAddActions(vm, tmpactions, parent, *def) < 0)\n        return -1;\n\n    if (!(*chk = virDomainCheckpointAssignDef(vm->checkpoints, *def)))\n        return -1;\n\n    *def = NULL;\n\n    *actions = g_steal_pointer(&tmpactions);\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic virDomainMomentObjPtr\nqemuCheckpointCreate(virQEMUDriverPtr driver,\n                     virDomainObjPtr vm,\n                     virDomainCheckpointDefPtr *def)\n{\n    g_autoptr(virJSONValue) actions = NULL;\n    virDomainMomentObjPtr chk = NULL;\n    int rc;\n\n    if (qemuCheckpointCreateCommon(driver, vm, def, &actions, &chk) < 0)\n        return NULL;\n\n    qemuDomainObjEnterMonitor(driver, vm);\n    rc = qemuMonitorTransaction(qemuDomainGetMonitor(vm), &actions);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0 || rc < 0) {\n        qemuCheckpointRollbackMetadata(vm, chk);\n        return NULL;\n    }\n\n    return chk;\n}"
  },
  {
    "function_name": "qemuCheckpointRollbackMetadata",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "565-573",
    "snippet": "void\nqemuCheckpointRollbackMetadata(virDomainObjPtr vm,\n                               virDomainMomentObjPtr chk)\n{\n    if (!chk)\n        return;\n\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainCheckpointObjListRemove",
          "args": [
            "vm->checkpoints",
            "chk"
          ],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointObjListRemove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "143-148",
          "snippet": "bool\nvirDomainCheckpointObjListRemove(virDomainCheckpointObjListPtr checkpoints,\n                                 virDomainMomentObjPtr checkpoint)\n{\n    return virDomainMomentObjListRemove(checkpoints->base, checkpoint);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirDomainCheckpointObjListRemove(virDomainCheckpointObjListPtr checkpoints,\n                                 virDomainMomentObjPtr checkpoint)\n{\n    return virDomainMomentObjListRemove(checkpoints->base, checkpoint);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nqemuCheckpointRollbackMetadata(virDomainObjPtr vm,\n                               virDomainMomentObjPtr chk)\n{\n    if (!chk)\n        return;\n\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n}"
  },
  {
    "function_name": "qemuCheckpointCreateCommon",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "527-555",
    "snippet": "int\nqemuCheckpointCreateCommon(virQEMUDriverPtr driver,\n                           virDomainObjPtr vm,\n                           virDomainCheckpointDefPtr *def,\n                           virJSONValuePtr *actions,\n                           virDomainMomentObjPtr *chk)\n{\n    g_autoptr(virJSONValue) tmpactions = NULL;\n    virDomainMomentObjPtr parent;\n\n    if (qemuCheckpointPrepare(driver, vm, *def) < 0)\n        return -1;\n\n    if ((parent = virDomainCheckpointGetCurrent(vm->checkpoints)))\n        (*def)->parent.parent_name = g_strdup(parent->def->name);\n\n    tmpactions = virJSONValueNewArray();\n\n    if (qemuCheckpointAddActions(vm, tmpactions, parent, *def) < 0)\n        return -1;\n\n    if (!(*chk = virDomainCheckpointAssignDef(vm->checkpoints, *def)))\n        return -1;\n\n    *def = NULL;\n\n    *actions = g_steal_pointer(&tmpactions);\n    return 0;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&tmpactions"
          ],
          "line": 553
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointAssignDef",
          "args": [
            "vm->checkpoints",
            "*def"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointAssignDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "42-47",
          "snippet": "virDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def)\n{\n    return virDomainMomentAssignDef(checkpoints->base, &def->parent);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvirDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def)\n{\n    return virDomainMomentAssignDef(checkpoints->base, &def->parent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointAddActions",
          "args": [
            "vm",
            "tmpactions",
            "parent",
            "*def"
          ],
          "line": 545
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointAddActions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "458-499",
          "snippet": "static int\nqemuCheckpointAddActions(virDomainObjPtr vm,\n                         virJSONValuePtr actions,\n                         virDomainMomentObjPtr old_current,\n                         virDomainCheckpointDefPtr def)\n{\n    size_t i;\n\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDef *chkdisk = &def->disks[i];\n        virDomainDiskDefPtr domdisk = virDomainDiskByTarget(vm->def, chkdisk->name);\n        virDomainCheckpointDiskDef *parentchkdisk = NULL;\n\n        /* checkpoint definition validator mandates that the corresponding\n         * domdisk should exist */\n        if (!domdisk ||\n            chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        if (qemuMonitorTransactionBitmapAdd(actions, domdisk->src->nodeformat,\n                                            chkdisk->bitmap, true, false, 0) < 0)\n            return -1;\n\n        /* We only want one active bitmap for a disk along the\n         * checkpoint chain, then later differential backups will\n         * merge the bitmaps (only one active) between the bounding\n         * checkpoint and the leaf checkpoint.  If the same disks are\n         * involved in each checkpoint, this search terminates in one\n         * iteration; but it is also possible to have to search\n         * further than the immediate parent to find another\n         * checkpoint with a bitmap on the same disk.  */\n        if ((parentchkdisk = qemuCheckpointFindActiveDiskInParent(vm, old_current,\n                                                                  chkdisk->name))) {\n\n            if (qemuMonitorTransactionBitmapDisable(actions,\n                                                    domdisk->src->nodeformat,\n                                                    parentchkdisk->bitmap) < 0)\n                return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointAddActions(virDomainObjPtr vm,\n                         virJSONValuePtr actions,\n                         virDomainMomentObjPtr old_current,\n                         virDomainCheckpointDefPtr def)\n{\n    size_t i;\n\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDef *chkdisk = &def->disks[i];\n        virDomainDiskDefPtr domdisk = virDomainDiskByTarget(vm->def, chkdisk->name);\n        virDomainCheckpointDiskDef *parentchkdisk = NULL;\n\n        /* checkpoint definition validator mandates that the corresponding\n         * domdisk should exist */\n        if (!domdisk ||\n            chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        if (qemuMonitorTransactionBitmapAdd(actions, domdisk->src->nodeformat,\n                                            chkdisk->bitmap, true, false, 0) < 0)\n            return -1;\n\n        /* We only want one active bitmap for a disk along the\n         * checkpoint chain, then later differential backups will\n         * merge the bitmaps (only one active) between the bounding\n         * checkpoint and the leaf checkpoint.  If the same disks are\n         * involved in each checkpoint, this search terminates in one\n         * iteration; but it is also possible to have to search\n         * further than the immediate parent to find another\n         * checkpoint with a bitmap on the same disk.  */\n        if ((parentchkdisk = qemuCheckpointFindActiveDiskInParent(vm, old_current,\n                                                                  chkdisk->name))) {\n\n            if (qemuMonitorTransactionBitmapDisable(actions,\n                                                    domdisk->src->nodeformat,\n                                                    parentchkdisk->bitmap) < 0)\n                return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewArray",
          "args": [],
          "line": 543
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "560-568",
          "snippet": "virJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "parent->def->name"
          ],
          "line": 541
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointGetCurrent",
          "args": [
            "vm->checkpoints"
          ],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointGetCurrentName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "126-130",
          "snippet": "const char *\nvirDomainCheckpointGetCurrentName(virDomainCheckpointObjListPtr checkpoints)\n{\n    return virDomainMomentGetCurrentName(checkpoints->base);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nconst char *\nvirDomainCheckpointGetCurrentName(virDomainCheckpointObjListPtr checkpoints)\n{\n    return virDomainMomentGetCurrentName(checkpoints->base);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointPrepare",
          "args": [
            "driver",
            "vm",
            "*def"
          ],
          "line": 537
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointPrepare",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "403-456",
          "snippet": "static int\nqemuCheckpointPrepare(virQEMUDriverPtr driver,\n                      virDomainObjPtr vm,\n                      virDomainCheckpointDefPtr def)\n{\n    int ret = -1;\n    size_t i;\n    char *xml = NULL;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    /* Easiest way to clone inactive portion of vm->def is via\n     * conversion in and back out of xml.  */\n    if (!(xml = qemuDomainDefFormatLive(driver, priv->qemuCaps,\n                                        vm->def, priv->origCPU,\n                                        true, true)) ||\n        !(def->parent.dom = virDomainDefParseString(xml, driver->xmlopt,\n                                                    priv->qemuCaps,\n                                                    VIR_DOMAIN_DEF_PARSE_INACTIVE |\n                                                    VIR_DOMAIN_DEF_PARSE_SKIP_VALIDATE)))\n        goto cleanup;\n\n    if (virDomainCheckpointAlignDisks(def) < 0)\n        goto cleanup;\n\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDefPtr disk = &def->disks[i];\n\n        if (disk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        if (STRNEQ(disk->bitmap, def->parent.name)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"bitmap for disk '%s' must match checkpoint name '%s'\"),\n                           disk->name, def->parent.name);\n            goto cleanup;\n        }\n\n        if (vm->def->disks[i]->src->format != VIR_STORAGE_FILE_QCOW2) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"checkpoint for disk %s unsupported \"\n                             \"for storage type %s\"),\n                           disk->name,\n                           virStorageFileFormatTypeToString(\n                               vm->def->disks[i]->src->format));\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(xml);\n    return ret;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointPrepare(virQEMUDriverPtr driver,\n                      virDomainObjPtr vm,\n                      virDomainCheckpointDefPtr def)\n{\n    int ret = -1;\n    size_t i;\n    char *xml = NULL;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    /* Easiest way to clone inactive portion of vm->def is via\n     * conversion in and back out of xml.  */\n    if (!(xml = qemuDomainDefFormatLive(driver, priv->qemuCaps,\n                                        vm->def, priv->origCPU,\n                                        true, true)) ||\n        !(def->parent.dom = virDomainDefParseString(xml, driver->xmlopt,\n                                                    priv->qemuCaps,\n                                                    VIR_DOMAIN_DEF_PARSE_INACTIVE |\n                                                    VIR_DOMAIN_DEF_PARSE_SKIP_VALIDATE)))\n        goto cleanup;\n\n    if (virDomainCheckpointAlignDisks(def) < 0)\n        goto cleanup;\n\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDefPtr disk = &def->disks[i];\n\n        if (disk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        if (STRNEQ(disk->bitmap, def->parent.name)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"bitmap for disk '%s' must match checkpoint name '%s'\"),\n                           disk->name, def->parent.name);\n            goto cleanup;\n        }\n\n        if (vm->def->disks[i]->src->format != VIR_STORAGE_FILE_QCOW2) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"checkpoint for disk %s unsupported \"\n                             \"for storage type %s\"),\n                           disk->name,\n                           virStorageFileFormatTypeToString(\n                               vm->def->disks[i]->src->format));\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(xml);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nqemuCheckpointCreateCommon(virQEMUDriverPtr driver,\n                           virDomainObjPtr vm,\n                           virDomainCheckpointDefPtr *def,\n                           virJSONValuePtr *actions,\n                           virDomainMomentObjPtr *chk)\n{\n    g_autoptr(virJSONValue) tmpactions = NULL;\n    virDomainMomentObjPtr parent;\n\n    if (qemuCheckpointPrepare(driver, vm, *def) < 0)\n        return -1;\n\n    if ((parent = virDomainCheckpointGetCurrent(vm->checkpoints)))\n        (*def)->parent.parent_name = g_strdup(parent->def->name);\n\n    tmpactions = virJSONValueNewArray();\n\n    if (qemuCheckpointAddActions(vm, tmpactions, parent, *def) < 0)\n        return -1;\n\n    if (!(*chk = virDomainCheckpointAssignDef(vm->checkpoints, *def)))\n        return -1;\n\n    *def = NULL;\n\n    *actions = g_steal_pointer(&tmpactions);\n    return 0;\n}"
  },
  {
    "function_name": "qemuCheckpointRedefine",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "502-524",
    "snippet": "static virDomainMomentObjPtr\nqemuCheckpointRedefine(virQEMUDriverPtr driver,\n                       virDomainObjPtr vm,\n                       virDomainCheckpointDefPtr *def,\n                       bool *update_current)\n{\n    virDomainMomentObjPtr chk = NULL;\n\n    if (virDomainCheckpointRedefinePrep(vm, def, &chk, driver->xmlopt,\n                                        update_current) < 0)\n        return NULL;\n\n    /* XXX Should we validate that the redefined checkpoint even\n     * makes sense, such as checking that qemu-img recognizes the\n     * checkpoint bitmap name in at least one of the domain's disks?  */\n\n    if (chk)\n        return chk;\n\n    chk = virDomainCheckpointAssignDef(vm->checkpoints, *def);\n    *def = NULL;\n    return chk;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainCheckpointAssignDef",
          "args": [
            "vm->checkpoints",
            "*def"
          ],
          "line": 521
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointAssignDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "42-47",
          "snippet": "virDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def)\n{\n    return virDomainMomentAssignDef(checkpoints->base, &def->parent);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvirDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def)\n{\n    return virDomainMomentAssignDef(checkpoints->base, &def->parent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointRedefinePrep",
          "args": [
            "vm",
            "def",
            "&chk",
            "driver->xmlopt",
            "update_current"
          ],
          "line": 510
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointRedefinePrep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/checkpoint_conf.c",
          "lines": "518-570",
          "snippet": "int\nvirDomainCheckpointRedefinePrep(virDomainObjPtr vm,\n                                virDomainCheckpointDefPtr *defptr,\n                                virDomainMomentObjPtr *chk,\n                                virDomainXMLOptionPtr xmlopt,\n                                bool *update_current)\n{\n    virDomainCheckpointDefPtr def = *defptr;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virDomainMomentObjPtr parent = NULL;\n    virDomainMomentObjPtr other = NULL;\n    virDomainCheckpointDefPtr otherdef = NULL;\n\n    virUUIDFormat(vm->def->uuid, uuidstr);\n\n    if (virDomainCheckpointCheckCycles(vm->checkpoints, def, vm->def->name) < 0)\n        return -1;\n\n    if (!def->parent.dom ||\n        memcmp(def->parent.dom->uuid, vm->def->uuid, VIR_UUID_BUFLEN)) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"definition for checkpoint %s must use uuid %s\"),\n                       def->parent.name, uuidstr);\n        return -1;\n    }\n    if (virDomainCheckpointAlignDisks(def) < 0)\n        return -1;\n\n    if (def->parent.parent_name &&\n         (parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                                 def->parent.parent_name))) {\n        if (parent == virDomainCheckpointGetCurrent(vm->checkpoints))\n            *update_current = true;\n    }\n\n    other = virDomainCheckpointFindByName(vm->checkpoints, def->parent.name);\n    if (other) {\n        otherdef = virDomainCheckpointObjGetDef(other);\n        if (!virDomainDefCheckABIStability(otherdef->parent.dom,\n                                           def->parent.dom, xmlopt))\n            return -1;\n\n        /* Drop and rebuild the parent relationship, but keep all\n         * child relations by reusing chk.  */\n        virDomainMomentDropParent(other);\n        virObjectUnref(otherdef);\n        other->def = &(*defptr)->parent;\n        *defptr = NULL;\n        *chk = other;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virbitmap.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virstoragefile.h\"\n#include \"checkpoint_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"virbitmap.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <config.h>\n\nint\nvirDomainCheckpointRedefinePrep(virDomainObjPtr vm,\n                                virDomainCheckpointDefPtr *defptr,\n                                virDomainMomentObjPtr *chk,\n                                virDomainXMLOptionPtr xmlopt,\n                                bool *update_current)\n{\n    virDomainCheckpointDefPtr def = *defptr;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virDomainMomentObjPtr parent = NULL;\n    virDomainMomentObjPtr other = NULL;\n    virDomainCheckpointDefPtr otherdef = NULL;\n\n    virUUIDFormat(vm->def->uuid, uuidstr);\n\n    if (virDomainCheckpointCheckCycles(vm->checkpoints, def, vm->def->name) < 0)\n        return -1;\n\n    if (!def->parent.dom ||\n        memcmp(def->parent.dom->uuid, vm->def->uuid, VIR_UUID_BUFLEN)) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"definition for checkpoint %s must use uuid %s\"),\n                       def->parent.name, uuidstr);\n        return -1;\n    }\n    if (virDomainCheckpointAlignDisks(def) < 0)\n        return -1;\n\n    if (def->parent.parent_name &&\n         (parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                                 def->parent.parent_name))) {\n        if (parent == virDomainCheckpointGetCurrent(vm->checkpoints))\n            *update_current = true;\n    }\n\n    other = virDomainCheckpointFindByName(vm->checkpoints, def->parent.name);\n    if (other) {\n        otherdef = virDomainCheckpointObjGetDef(other);\n        if (!virDomainDefCheckABIStability(otherdef->parent.dom,\n                                           def->parent.dom, xmlopt))\n            return -1;\n\n        /* Drop and rebuild the parent relationship, but keep all\n         * child relations by reusing chk.  */\n        virDomainMomentDropParent(other);\n        virObjectUnref(otherdef);\n        other->def = &(*defptr)->parent;\n        *defptr = NULL;\n        *chk = other;\n    }\n\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic virDomainMomentObjPtr\nqemuCheckpointRedefine(virQEMUDriverPtr driver,\n                       virDomainObjPtr vm,\n                       virDomainCheckpointDefPtr *def,\n                       bool *update_current)\n{\n    virDomainMomentObjPtr chk = NULL;\n\n    if (virDomainCheckpointRedefinePrep(vm, def, &chk, driver->xmlopt,\n                                        update_current) < 0)\n        return NULL;\n\n    /* XXX Should we validate that the redefined checkpoint even\n     * makes sense, such as checking that qemu-img recognizes the\n     * checkpoint bitmap name in at least one of the domain's disks?  */\n\n    if (chk)\n        return chk;\n\n    chk = virDomainCheckpointAssignDef(vm->checkpoints, *def);\n    *def = NULL;\n    return chk;\n}"
  },
  {
    "function_name": "qemuCheckpointAddActions",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "458-499",
    "snippet": "static int\nqemuCheckpointAddActions(virDomainObjPtr vm,\n                         virJSONValuePtr actions,\n                         virDomainMomentObjPtr old_current,\n                         virDomainCheckpointDefPtr def)\n{\n    size_t i;\n\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDef *chkdisk = &def->disks[i];\n        virDomainDiskDefPtr domdisk = virDomainDiskByTarget(vm->def, chkdisk->name);\n        virDomainCheckpointDiskDef *parentchkdisk = NULL;\n\n        /* checkpoint definition validator mandates that the corresponding\n         * domdisk should exist */\n        if (!domdisk ||\n            chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        if (qemuMonitorTransactionBitmapAdd(actions, domdisk->src->nodeformat,\n                                            chkdisk->bitmap, true, false, 0) < 0)\n            return -1;\n\n        /* We only want one active bitmap for a disk along the\n         * checkpoint chain, then later differential backups will\n         * merge the bitmaps (only one active) between the bounding\n         * checkpoint and the leaf checkpoint.  If the same disks are\n         * involved in each checkpoint, this search terminates in one\n         * iteration; but it is also possible to have to search\n         * further than the immediate parent to find another\n         * checkpoint with a bitmap on the same disk.  */\n        if ((parentchkdisk = qemuCheckpointFindActiveDiskInParent(vm, old_current,\n                                                                  chkdisk->name))) {\n\n            if (qemuMonitorTransactionBitmapDisable(actions,\n                                                    domdisk->src->nodeformat,\n                                                    parentchkdisk->bitmap) < 0)\n                return -1;\n        }\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuMonitorTransactionBitmapDisable",
          "args": [
            "actions",
            "domdisk->src->nodeformat",
            "parentchkdisk->bitmap"
          ],
          "line": 492
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransactionBitmapDisable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "4529-4535",
          "snippet": "int\nqemuMonitorTransactionBitmapDisable(virJSONValuePtr actions,\n                                    const char *node,\n                                    const char *name)\n{\n    return qemuMonitorJSONTransactionBitmapDisable(actions, node, name);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransactionBitmapDisable(virJSONValuePtr actions,\n                                    const char *node,\n                                    const char *name)\n{\n    return qemuMonitorJSONTransactionBitmapDisable(actions, node, name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointFindActiveDiskInParent",
          "args": [
            "vm",
            "old_current",
            "chkdisk->name"
          ],
          "line": 489
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointFindActiveDiskInParent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "118-149",
          "snippet": "static virDomainCheckpointDiskDef *\nqemuCheckpointFindActiveDiskInParent(virDomainObjPtr vm,\n                                     virDomainMomentObjPtr from,\n                                     const char *diskname)\n{\n    virDomainMomentObjPtr parent = from;\n    virDomainCheckpointDefPtr parentdef = NULL;\n    size_t i;\n\n    while (parent) {\n        parentdef = virDomainCheckpointObjGetDef(parent);\n\n        for (i = 0; i < parentdef->ndisks; i++) {\n            virDomainCheckpointDiskDef *chkdisk = &parentdef->disks[i];\n\n            if (STRNEQ(chkdisk->name, diskname))\n                continue;\n\n            /* currently inspected checkpoint doesn't describe the disk,\n             * continue into parent checkpoint */\n            if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n                break;\n\n            return chkdisk;\n        }\n\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               parentdef->parent.parent_name);\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic virDomainCheckpointDiskDef *\nqemuCheckpointFindActiveDiskInParent(virDomainObjPtr vm,\n                                     virDomainMomentObjPtr from,\n                                     const char *diskname)\n{\n    virDomainMomentObjPtr parent = from;\n    virDomainCheckpointDefPtr parentdef = NULL;\n    size_t i;\n\n    while (parent) {\n        parentdef = virDomainCheckpointObjGetDef(parent);\n\n        for (i = 0; i < parentdef->ndisks; i++) {\n            virDomainCheckpointDiskDef *chkdisk = &parentdef->disks[i];\n\n            if (STRNEQ(chkdisk->name, diskname))\n                continue;\n\n            /* currently inspected checkpoint doesn't describe the disk,\n             * continue into parent checkpoint */\n            if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n                break;\n\n            return chkdisk;\n        }\n\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               parentdef->parent.parent_name);\n    }\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuMonitorTransactionBitmapAdd",
          "args": [
            "actions",
            "domdisk->src->nodeformat",
            "chkdisk->bitmap",
            "true",
            "false",
            "0"
          ],
          "line": 477
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransactionBitmapAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "4498-4508",
          "snippet": "int\nqemuMonitorTransactionBitmapAdd(virJSONValuePtr actions,\n                                const char *node,\n                                const char *name,\n                                bool persistent,\n                                bool disabled,\n                                unsigned long long granularity)\n{\n    return qemuMonitorJSONTransactionBitmapAdd(actions, node, name, persistent,\n                                               disabled, granularity);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransactionBitmapAdd(virJSONValuePtr actions,\n                                const char *node,\n                                const char *name,\n                                bool persistent,\n                                bool disabled,\n                                unsigned long long granularity)\n{\n    return qemuMonitorJSONTransactionBitmapAdd(actions, node, name, persistent,\n                                               disabled, granularity);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskByTarget",
          "args": [
            "vm->def",
            "chkdisk->name"
          ],
          "line": 468
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskByTarget",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "17337-17349",
          "snippet": "virDomainDiskDefPtr\nvirDomainDiskByTarget(virDomainDefPtr def,\n                      const char *dst)\n{\n    size_t i;\n\n    for (i = 0; i < def->ndisks; i++) {\n        if (STREQ(def->disks[i]->dst, dst))\n            return def->disks[i];\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirDomainDiskDefPtr\nvirDomainDiskByTarget(virDomainDefPtr def,\n                      const char *dst)\n{\n    size_t i;\n\n    for (i = 0; i < def->ndisks; i++) {\n        if (STREQ(def->disks[i]->dst, dst))\n            return def->disks[i];\n    }\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointAddActions(virDomainObjPtr vm,\n                         virJSONValuePtr actions,\n                         virDomainMomentObjPtr old_current,\n                         virDomainCheckpointDefPtr def)\n{\n    size_t i;\n\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDef *chkdisk = &def->disks[i];\n        virDomainDiskDefPtr domdisk = virDomainDiskByTarget(vm->def, chkdisk->name);\n        virDomainCheckpointDiskDef *parentchkdisk = NULL;\n\n        /* checkpoint definition validator mandates that the corresponding\n         * domdisk should exist */\n        if (!domdisk ||\n            chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        if (qemuMonitorTransactionBitmapAdd(actions, domdisk->src->nodeformat,\n                                            chkdisk->bitmap, true, false, 0) < 0)\n            return -1;\n\n        /* We only want one active bitmap for a disk along the\n         * checkpoint chain, then later differential backups will\n         * merge the bitmaps (only one active) between the bounding\n         * checkpoint and the leaf checkpoint.  If the same disks are\n         * involved in each checkpoint, this search terminates in one\n         * iteration; but it is also possible to have to search\n         * further than the immediate parent to find another\n         * checkpoint with a bitmap on the same disk.  */\n        if ((parentchkdisk = qemuCheckpointFindActiveDiskInParent(vm, old_current,\n                                                                  chkdisk->name))) {\n\n            if (qemuMonitorTransactionBitmapDisable(actions,\n                                                    domdisk->src->nodeformat,\n                                                    parentchkdisk->bitmap) < 0)\n                return -1;\n        }\n    }\n    return 0;\n}"
  },
  {
    "function_name": "qemuCheckpointPrepare",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "403-456",
    "snippet": "static int\nqemuCheckpointPrepare(virQEMUDriverPtr driver,\n                      virDomainObjPtr vm,\n                      virDomainCheckpointDefPtr def)\n{\n    int ret = -1;\n    size_t i;\n    char *xml = NULL;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    /* Easiest way to clone inactive portion of vm->def is via\n     * conversion in and back out of xml.  */\n    if (!(xml = qemuDomainDefFormatLive(driver, priv->qemuCaps,\n                                        vm->def, priv->origCPU,\n                                        true, true)) ||\n        !(def->parent.dom = virDomainDefParseString(xml, driver->xmlopt,\n                                                    priv->qemuCaps,\n                                                    VIR_DOMAIN_DEF_PARSE_INACTIVE |\n                                                    VIR_DOMAIN_DEF_PARSE_SKIP_VALIDATE)))\n        goto cleanup;\n\n    if (virDomainCheckpointAlignDisks(def) < 0)\n        goto cleanup;\n\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDefPtr disk = &def->disks[i];\n\n        if (disk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        if (STRNEQ(disk->bitmap, def->parent.name)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"bitmap for disk '%s' must match checkpoint name '%s'\"),\n                           disk->name, def->parent.name);\n            goto cleanup;\n        }\n\n        if (vm->def->disks[i]->src->format != VIR_STORAGE_FILE_QCOW2) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"checkpoint for disk %s unsupported \"\n                             \"for storage type %s\"),\n                           disk->name,\n                           virStorageFileFormatTypeToString(\n                               vm->def->disks[i]->src->format));\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(xml);\n    return ret;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "xml"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"checkpoint for disk %s unsupported \"\n                             \"for storage type %s\")",
            "disk->name",
            "virStorageFileFormatTypeToString(\n                               vm->def->disks[i]->src->format)"
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageFileFormatTypeToString",
          "args": [
            "vm->def->disks[i]->src->format"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"checkpoint for disk %s unsupported \"\n                             \"for storage type %s\""
          ],
          "line": 442
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"bitmap for disk '%s' must match checkpoint name '%s'\")",
            "disk->name",
            "def->parent.name"
          ],
          "line": 434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "disk->bitmap",
            "def->parent.name"
          ],
          "line": 433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointAlignDisks",
          "args": [
            "def"
          ],
          "line": 424
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointAlignDisks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/checkpoint_conf.c",
          "lines": "292-398",
          "snippet": "int\nvirDomainCheckpointAlignDisks(virDomainCheckpointDefPtr def)\n{\n    int ret = -1;\n    virBitmapPtr map = NULL;\n    size_t i;\n    int ndisks;\n    int checkpoint_default = VIR_DOMAIN_CHECKPOINT_TYPE_NONE;\n\n    if (!def->parent.dom) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"missing domain in checkpoint\"));\n        goto cleanup;\n    }\n\n    if (def->ndisks > def->parent.dom->ndisks) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"too many disk checkpoint requests for domain\"));\n        goto cleanup;\n    }\n\n    /* Unlikely to have a guest without disks but technically possible.  */\n    if (!def->parent.dom->ndisks) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"domain must have at least one disk to perform \"\n                         \"checkpoints\"));\n        goto cleanup;\n    }\n\n    /* If <disks> omitted, do bitmap on all writeable disks;\n     * otherwise, do nothing for omitted disks */\n    if (!def->ndisks)\n        checkpoint_default = VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP;\n\n    if (!(map = virBitmapNew(def->parent.dom->ndisks)))\n        goto cleanup;\n\n    /* Double check requested disks.  */\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDefPtr disk = &def->disks[i];\n        int idx = virDomainDiskIndexByName(def->parent.dom, disk->name, false);\n\n        if (idx < 0) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"no disk named '%s'\"), disk->name);\n            goto cleanup;\n        }\n\n        if (virBitmapIsBitSet(map, idx)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"disk '%s' specified twice\"),\n                           disk->name);\n            goto cleanup;\n        }\n        if ((virStorageSourceIsEmpty(def->parent.dom->disks[idx]->src) ||\n             def->parent.dom->disks[idx]->src->readonly) &&\n            disk->type != VIR_DOMAIN_CHECKPOINT_TYPE_NONE) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"disk '%s' is empty or readonly\"),\n                           disk->name);\n            goto cleanup;\n        }\n        ignore_value(virBitmapSetBit(map, idx));\n        disk->idx = idx;\n\n        if (STRNEQ(disk->name, def->parent.dom->disks[idx]->dst)) {\n            VIR_FREE(disk->name);\n            disk->name = g_strdup(def->parent.dom->disks[idx]->dst);\n        }\n    }\n\n    /* Provide defaults for all remaining disks.  */\n    ndisks = def->ndisks;\n    if (VIR_EXPAND_N(def->disks, def->ndisks,\n                     def->parent.dom->ndisks - def->ndisks) < 0)\n        goto cleanup;\n\n    for (i = 0; i < def->parent.dom->ndisks; i++) {\n        virDomainCheckpointDiskDefPtr disk;\n\n        if (virBitmapIsBitSet(map, i))\n            continue;\n        disk = &def->disks[ndisks++];\n        disk->name = g_strdup(def->parent.dom->disks[i]->dst);\n        disk->idx = i;\n\n        /* Don't checkpoint empty or readonly drives */\n        if (virStorageSourceIsEmpty(def->parent.dom->disks[i]->src) ||\n            def->parent.dom->disks[i]->src->readonly)\n            disk->type = VIR_DOMAIN_CHECKPOINT_TYPE_NONE;\n        else\n            disk->type = checkpoint_default;\n    }\n\n    qsort(&def->disks[0], def->ndisks, sizeof(def->disks[0]),\n          virDomainCheckpointCompareDiskIndex);\n\n    /* Generate default bitmap names for checkpoint */\n    if (virDomainCheckpointDefAssignBitmapNames(def) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virBitmapFree(map);\n    return ret;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virbitmap.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virstoragefile.h\"\n#include \"checkpoint_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"virbitmap.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <config.h>\n\nint\nvirDomainCheckpointAlignDisks(virDomainCheckpointDefPtr def)\n{\n    int ret = -1;\n    virBitmapPtr map = NULL;\n    size_t i;\n    int ndisks;\n    int checkpoint_default = VIR_DOMAIN_CHECKPOINT_TYPE_NONE;\n\n    if (!def->parent.dom) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"missing domain in checkpoint\"));\n        goto cleanup;\n    }\n\n    if (def->ndisks > def->parent.dom->ndisks) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"too many disk checkpoint requests for domain\"));\n        goto cleanup;\n    }\n\n    /* Unlikely to have a guest without disks but technically possible.  */\n    if (!def->parent.dom->ndisks) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"domain must have at least one disk to perform \"\n                         \"checkpoints\"));\n        goto cleanup;\n    }\n\n    /* If <disks> omitted, do bitmap on all writeable disks;\n     * otherwise, do nothing for omitted disks */\n    if (!def->ndisks)\n        checkpoint_default = VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP;\n\n    if (!(map = virBitmapNew(def->parent.dom->ndisks)))\n        goto cleanup;\n\n    /* Double check requested disks.  */\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDefPtr disk = &def->disks[i];\n        int idx = virDomainDiskIndexByName(def->parent.dom, disk->name, false);\n\n        if (idx < 0) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"no disk named '%s'\"), disk->name);\n            goto cleanup;\n        }\n\n        if (virBitmapIsBitSet(map, idx)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"disk '%s' specified twice\"),\n                           disk->name);\n            goto cleanup;\n        }\n        if ((virStorageSourceIsEmpty(def->parent.dom->disks[idx]->src) ||\n             def->parent.dom->disks[idx]->src->readonly) &&\n            disk->type != VIR_DOMAIN_CHECKPOINT_TYPE_NONE) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"disk '%s' is empty or readonly\"),\n                           disk->name);\n            goto cleanup;\n        }\n        ignore_value(virBitmapSetBit(map, idx));\n        disk->idx = idx;\n\n        if (STRNEQ(disk->name, def->parent.dom->disks[idx]->dst)) {\n            VIR_FREE(disk->name);\n            disk->name = g_strdup(def->parent.dom->disks[idx]->dst);\n        }\n    }\n\n    /* Provide defaults for all remaining disks.  */\n    ndisks = def->ndisks;\n    if (VIR_EXPAND_N(def->disks, def->ndisks,\n                     def->parent.dom->ndisks - def->ndisks) < 0)\n        goto cleanup;\n\n    for (i = 0; i < def->parent.dom->ndisks; i++) {\n        virDomainCheckpointDiskDefPtr disk;\n\n        if (virBitmapIsBitSet(map, i))\n            continue;\n        disk = &def->disks[ndisks++];\n        disk->name = g_strdup(def->parent.dom->disks[i]->dst);\n        disk->idx = i;\n\n        /* Don't checkpoint empty or readonly drives */\n        if (virStorageSourceIsEmpty(def->parent.dom->disks[i]->src) ||\n            def->parent.dom->disks[i]->src->readonly)\n            disk->type = VIR_DOMAIN_CHECKPOINT_TYPE_NONE;\n        else\n            disk->type = checkpoint_default;\n    }\n\n    qsort(&def->disks[0], def->ndisks, sizeof(def->disks[0]),\n          virDomainCheckpointCompareDiskIndex);\n\n    /* Generate default bitmap names for checkpoint */\n    if (virDomainCheckpointDefAssignBitmapNames(def) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virBitmapFree(map);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefParseString",
          "args": [
            "xml",
            "driver->xmlopt",
            "priv->qemuCaps",
            "VIR_DOMAIN_DEF_PARSE_INACTIVE |\n                                                    VIR_DOMAIN_DEF_PARSE_SKIP_VALIDATE"
          ],
          "line": 418
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefParseString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "22134-22141",
          "snippet": "virDomainDefPtr\nvirDomainDefParseString(const char *xmlStr,\n                        virDomainXMLOptionPtr xmlopt,\n                        void *parseOpaque,\n                        unsigned int flags)\n{\n    return virDomainDefParse(xmlStr, NULL, xmlopt, parseOpaque, flags);\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirDomainDefPtr\nvirDomainDefParseString(const char *xmlStr,\n                        virDomainXMLOptionPtr xmlopt,\n                        void *parseOpaque,\n                        unsigned int flags)\n{\n    return virDomainDefParse(xmlStr, NULL, xmlopt, parseOpaque, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainDefFormatLive",
          "args": [
            "driver",
            "priv->qemuCaps",
            "vm->def",
            "priv->origCPU",
            "true",
            "true"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainDefFormatLive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10593-10609",
          "snippet": "char *\nqemuDomainDefFormatLive(virQEMUDriverPtr driver,\n                        virQEMUCapsPtr qemuCaps,\n                        virDomainDefPtr def,\n                        virCPUDefPtr origCPU,\n                        bool inactive,\n                        bool compatible)\n{\n    unsigned int flags = QEMU_DOMAIN_FORMAT_LIVE_FLAGS;\n\n    if (inactive)\n        flags |= VIR_DOMAIN_XML_INACTIVE;\n    if (compatible)\n        flags |= VIR_DOMAIN_XML_MIGRATABLE;\n\n    return qemuDomainDefFormatXMLInternal(driver, qemuCaps, def, origCPU, flags);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nchar *\nqemuDomainDefFormatLive(virQEMUDriverPtr driver,\n                        virQEMUCapsPtr qemuCaps,\n                        virDomainDefPtr def,\n                        virCPUDefPtr origCPU,\n                        bool inactive,\n                        bool compatible)\n{\n    unsigned int flags = QEMU_DOMAIN_FORMAT_LIVE_FLAGS;\n\n    if (inactive)\n        flags |= VIR_DOMAIN_XML_INACTIVE;\n    if (compatible)\n        flags |= VIR_DOMAIN_XML_MIGRATABLE;\n\n    return qemuDomainDefFormatXMLInternal(driver, qemuCaps, def, origCPU, flags);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointPrepare(virQEMUDriverPtr driver,\n                      virDomainObjPtr vm,\n                      virDomainCheckpointDefPtr def)\n{\n    int ret = -1;\n    size_t i;\n    char *xml = NULL;\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    /* Easiest way to clone inactive portion of vm->def is via\n     * conversion in and back out of xml.  */\n    if (!(xml = qemuDomainDefFormatLive(driver, priv->qemuCaps,\n                                        vm->def, priv->origCPU,\n                                        true, true)) ||\n        !(def->parent.dom = virDomainDefParseString(xml, driver->xmlopt,\n                                                    priv->qemuCaps,\n                                                    VIR_DOMAIN_DEF_PARSE_INACTIVE |\n                                                    VIR_DOMAIN_DEF_PARSE_SKIP_VALIDATE)))\n        goto cleanup;\n\n    if (virDomainCheckpointAlignDisks(def) < 0)\n        goto cleanup;\n\n    for (i = 0; i < def->ndisks; i++) {\n        virDomainCheckpointDiskDefPtr disk = &def->disks[i];\n\n        if (disk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        if (STRNEQ(disk->bitmap, def->parent.name)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"bitmap for disk '%s' must match checkpoint name '%s'\"),\n                           disk->name, def->parent.name);\n            goto cleanup;\n        }\n\n        if (vm->def->disks[i]->src->format != VIR_STORAGE_FILE_QCOW2) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"checkpoint for disk %s unsupported \"\n                             \"for storage type %s\"),\n                           disk->name,\n                           virStorageFileFormatTypeToString(\n                               vm->def->disks[i]->src->format));\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(xml);\n    return ret;\n}"
  },
  {
    "function_name": "qemuCheckpointDiscardAllMetadata",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "383-399",
    "snippet": "int\nqemuCheckpointDiscardAllMetadata(virQEMUDriverPtr driver,\n                                       virDomainObjPtr vm)\n{\n    virQEMUMomentRemove rem = {\n        .driver = driver,\n        .vm = vm,\n        .metadata_only = true,\n        .momentDiscard = qemuCheckpointDiscard,\n    };\n\n    virDomainCheckpointForEach(vm->checkpoints, qemuDomainMomentDiscardAll,\n                               &rem);\n    virDomainCheckpointObjListRemoveAll(vm->checkpoints);\n\n    return rem.err;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainCheckpointObjListRemoveAll",
          "args": [
            "vm->checkpoints"
          ],
          "line": 396
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointObjListRemoveAll",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "152-156",
          "snippet": "void\nvirDomainCheckpointObjListRemoveAll(virDomainCheckpointObjListPtr checkpoints)\n{\n    return virDomainMomentObjListRemoveAll(checkpoints->base);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirDomainCheckpointObjListRemoveAll(virDomainCheckpointObjListPtr checkpoints)\n{\n    return virDomainMomentObjListRemoveAll(checkpoints->base);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointForEach",
          "args": [
            "vm->checkpoints",
            "qemuDomainMomentDiscardAll",
            "&rem"
          ],
          "line": 394
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointForEach",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "159-165",
          "snippet": "int\nvirDomainCheckpointForEach(virDomainCheckpointObjListPtr checkpoints,\n                           virHashIterator iter,\n                           void *data)\n{\n    return virDomainMomentForEach(checkpoints->base, iter, data);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDomainCheckpointForEach(virDomainCheckpointObjListPtr checkpoints,\n                           virHashIterator iter,\n                           void *data)\n{\n    return virDomainMomentForEach(checkpoints->base, iter, data);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nqemuCheckpointDiscardAllMetadata(virQEMUDriverPtr driver,\n                                       virDomainObjPtr vm)\n{\n    virQEMUMomentRemove rem = {\n        .driver = driver,\n        .vm = vm,\n        .metadata_only = true,\n        .momentDiscard = qemuCheckpointDiscard,\n    };\n\n    virDomainCheckpointForEach(vm->checkpoints, qemuDomainMomentDiscardAll,\n                               &rem);\n    virDomainCheckpointObjListRemoveAll(vm->checkpoints);\n\n    return rem.err;\n}"
  },
  {
    "function_name": "qemuCheckpointDiscard",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "330-380",
    "snippet": "static int\nqemuCheckpointDiscard(virQEMUDriverPtr driver,\n                      virDomainObjPtr vm,\n                      virDomainMomentObjPtr chk,\n                      bool update_parent,\n                      bool metadata_only)\n{\n    virDomainMomentObjPtr parent = NULL;\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *chkFile = NULL;\n    bool chkcurrent = chk == virDomainCheckpointGetCurrent(vm->checkpoints);\n\n    if (!metadata_only && !virDomainObjIsActive(vm)) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                       _(\"cannot remove checkpoint from inactive domain\"));\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s/%s.xml\", cfg->checkpointDir, vm->def->name,\n                              chk->def->name);\n\n    if (!metadata_only) {\n        virDomainCheckpointDefPtr chkdef = virDomainCheckpointObjGetDef(chk);\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               chk->def->parent_name);\n        if (qemuCheckpointDiscardBitmaps(vm, chkdef, parent) < 0)\n            return -1;\n    }\n\n    if (chkcurrent) {\n        virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n        if (update_parent && parent) {\n            virDomainCheckpointSetCurrent(vm->checkpoints, parent);\n            if (qemuCheckpointWriteMetadata(vm, parent,\n                                            driver->xmlopt,\n                                            cfg->checkpointDir) < 0) {\n                VIR_WARN(\"failed to set parent checkpoint '%s' as current\",\n                         chk->def->parent_name);\n                virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n            }\n        }\n    }\n\n    if (unlink(chkFile) < 0)\n        VIR_WARN(\"Failed to unlink %s\", chkFile);\n    if (update_parent)\n        virDomainMomentDropParent(chk);\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n\n    return 0;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainCheckpointObjListRemove",
          "args": [
            "vm->checkpoints",
            "chk"
          ],
          "line": 377
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointObjListRemove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "143-148",
          "snippet": "bool\nvirDomainCheckpointObjListRemove(virDomainCheckpointObjListPtr checkpoints,\n                                 virDomainMomentObjPtr checkpoint)\n{\n    return virDomainMomentObjListRemove(checkpoints->base, checkpoint);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirDomainCheckpointObjListRemove(virDomainCheckpointObjListPtr checkpoints,\n                                 virDomainMomentObjPtr checkpoint)\n{\n    return virDomainMomentObjListRemove(checkpoints->base, checkpoint);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainMomentDropParent",
          "args": [
            "chk"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainMomentDropParent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomainmomentobjlist.c",
          "lines": "119-141",
          "snippet": "void\nvirDomainMomentDropParent(virDomainMomentObjPtr moment)\n{\n    virDomainMomentObjPtr prev = NULL;\n    virDomainMomentObjPtr curr = NULL;\n\n    moment->parent->nchildren--;\n    curr = moment->parent->first_child;\n    while (curr != moment) {\n        if (!curr) {\n            VIR_WARN(\"inconsistent moment relations\");\n            return;\n        }\n        prev = curr;\n        curr = curr->sibling;\n    }\n    if (prev)\n        prev->sibling = moment->sibling;\n    else\n        moment->parent->first_child = moment->sibling;\n    moment->parent = NULL;\n    moment->sibling = NULL;\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"viralloc.h\"",
            "#include \"moment_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"viralloc.h\"\n#include \"moment_conf.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirDomainMomentDropParent(virDomainMomentObjPtr moment)\n{\n    virDomainMomentObjPtr prev = NULL;\n    virDomainMomentObjPtr curr = NULL;\n\n    moment->parent->nchildren--;\n    curr = moment->parent->first_child;\n    while (curr != moment) {\n        if (!curr) {\n            VIR_WARN(\"inconsistent moment relations\");\n            return;\n        }\n        prev = curr;\n        curr = curr->sibling;\n    }\n    if (prev)\n        prev->sibling = moment->sibling;\n    else\n        moment->parent->first_child = moment->sibling;\n    moment->parent = NULL;\n    moment->sibling = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to unlink %s\"",
            "chkFile"
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "chkFile"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointSetCurrent",
          "args": [
            "vm->checkpoints",
            "NULL"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointSetCurrent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "134-139",
          "snippet": "void\nvirDomainCheckpointSetCurrent(virDomainCheckpointObjListPtr checkpoints,\n                              virDomainMomentObjPtr checkpoint)\n{\n    virDomainMomentSetCurrent(checkpoints->base, checkpoint);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirDomainCheckpointSetCurrent(virDomainCheckpointObjListPtr checkpoints,\n                              virDomainMomentObjPtr checkpoint)\n{\n    virDomainMomentSetCurrent(checkpoints->base, checkpoint);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"failed to set parent checkpoint '%s' as current\"",
            "chk->def->parent_name"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuCheckpointWriteMetadata",
          "args": [
            "vm",
            "parent",
            "driver->xmlopt",
            "cfg->checkpointDir"
          ],
          "line": 363
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointWriteMetadata",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "79-105",
          "snippet": "static int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointDiscardBitmaps",
          "args": [
            "vm",
            "chkdef",
            "parent"
          ],
          "line": 355
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointDiscardBitmaps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "248-327",
          "snippet": "static int\nqemuCheckpointDiscardBitmaps(virDomainObjPtr vm,\n                             virDomainCheckpointDefPtr chkdef,\n                             virDomainMomentObjPtr parent)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    g_autoptr(virHashTable) blockNamedNodeData = NULL;\n    int rc = -1;\n    g_autoptr(virJSONValue) actions = NULL;\n    size_t i;\n    g_autoptr(GSList) reopenimages = NULL;\n    g_autoptr(GSList) relabelimages = NULL;\n    GSList *next;\n\n    actions = virJSONValueNewArray();\n\n    if (!(blockNamedNodeData = qemuBlockGetNamedNodeData(vm, QEMU_ASYNC_JOB_NONE)))\n        return -1;\n\n    for (i = 0; i < chkdef->ndisks; i++) {\n        virDomainCheckpointDiskDef *chkdisk = &chkdef->disks[i];\n        virDomainDiskDefPtr domdisk = virDomainDiskByTarget(vm->def, chkdisk->name);\n        virDomainCheckpointDiskDef *parentchkdisk = NULL;\n        const char *parentbitmap = NULL;\n\n        /* domdisk can be missing e.g. when it was unplugged */\n        if (!domdisk)\n            continue;\n\n        if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        /* If any ancestor checkpoint has a bitmap for the same\n         * disk, then this bitmap must be merged to the\n         * ancestor. */\n        if ((parentchkdisk = qemuCheckpointFindActiveDiskInParent(vm, parent,\n                                                                  chkdisk->name)))\n            parentbitmap = parentchkdisk->bitmap;\n\n        if (qemuCheckpointDiscardDiskBitmaps(domdisk->src, blockNamedNodeData,\n                                             chkdisk->bitmap, parentbitmap,\n                                             actions, domdisk->dst,\n                                             &reopenimages) < 0)\n            return -1;\n    }\n\n    /* label any non-top images for read-write access */\n    for (next = reopenimages; next; next = next->next) {\n        virStorageSourcePtr src = next->data;\n\n        if (qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                               false, false, false) < 0)\n            goto relabel;\n\n        if (virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_BLOCKDEV_REOPEN) &&\n            qemuBlockReopenReadWrite(vm, src, QEMU_ASYNC_JOB_NONE) < 0)\n            goto relabel;\n\n        relabelimages = g_slist_prepend(relabelimages, src);\n    }\n\n    qemuDomainObjEnterMonitor(driver, vm);\n    rc = qemuMonitorTransaction(priv->mon, &actions);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        return -1;\n\n relabel:\n    for (next = relabelimages; next; next = next->next) {\n        virStorageSourcePtr src = next->data;\n\n        if (virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_BLOCKDEV_REOPEN))\n            ignore_value(qemuBlockReopenReadOnly(vm, src, QEMU_ASYNC_JOB_NONE));\n\n        ignore_value(qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                                        true, false, false));\n    }\n\n    return rc;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointDiscardBitmaps(virDomainObjPtr vm,\n                             virDomainCheckpointDefPtr chkdef,\n                             virDomainMomentObjPtr parent)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    g_autoptr(virHashTable) blockNamedNodeData = NULL;\n    int rc = -1;\n    g_autoptr(virJSONValue) actions = NULL;\n    size_t i;\n    g_autoptr(GSList) reopenimages = NULL;\n    g_autoptr(GSList) relabelimages = NULL;\n    GSList *next;\n\n    actions = virJSONValueNewArray();\n\n    if (!(blockNamedNodeData = qemuBlockGetNamedNodeData(vm, QEMU_ASYNC_JOB_NONE)))\n        return -1;\n\n    for (i = 0; i < chkdef->ndisks; i++) {\n        virDomainCheckpointDiskDef *chkdisk = &chkdef->disks[i];\n        virDomainDiskDefPtr domdisk = virDomainDiskByTarget(vm->def, chkdisk->name);\n        virDomainCheckpointDiskDef *parentchkdisk = NULL;\n        const char *parentbitmap = NULL;\n\n        /* domdisk can be missing e.g. when it was unplugged */\n        if (!domdisk)\n            continue;\n\n        if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        /* If any ancestor checkpoint has a bitmap for the same\n         * disk, then this bitmap must be merged to the\n         * ancestor. */\n        if ((parentchkdisk = qemuCheckpointFindActiveDiskInParent(vm, parent,\n                                                                  chkdisk->name)))\n            parentbitmap = parentchkdisk->bitmap;\n\n        if (qemuCheckpointDiscardDiskBitmaps(domdisk->src, blockNamedNodeData,\n                                             chkdisk->bitmap, parentbitmap,\n                                             actions, domdisk->dst,\n                                             &reopenimages) < 0)\n            return -1;\n    }\n\n    /* label any non-top images for read-write access */\n    for (next = reopenimages; next; next = next->next) {\n        virStorageSourcePtr src = next->data;\n\n        if (qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                               false, false, false) < 0)\n            goto relabel;\n\n        if (virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_BLOCKDEV_REOPEN) &&\n            qemuBlockReopenReadWrite(vm, src, QEMU_ASYNC_JOB_NONE) < 0)\n            goto relabel;\n\n        relabelimages = g_slist_prepend(relabelimages, src);\n    }\n\n    qemuDomainObjEnterMonitor(driver, vm);\n    rc = qemuMonitorTransaction(priv->mon, &actions);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        return -1;\n\n relabel:\n    for (next = relabelimages; next; next = next->next) {\n        virStorageSourcePtr src = next->data;\n\n        if (virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_BLOCKDEV_REOPEN))\n            ignore_value(qemuBlockReopenReadOnly(vm, src, QEMU_ASYNC_JOB_NONE));\n\n        ignore_value(qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                                        true, false, false));\n    }\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointFindByName",
          "args": [
            "vm->checkpoints",
            "chk->def->parent_name"
          ],
          "line": 353
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "109-114",
          "snippet": "virDomainMomentObjPtr\nvirDomainCheckpointFindByName(virDomainCheckpointObjListPtr checkpoints,\n                              const char *name)\n{\n    return virDomainMomentFindByName(checkpoints->base, name);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvirDomainMomentObjPtr\nvirDomainCheckpointFindByName(virDomainCheckpointObjListPtr checkpoints,\n                              const char *name)\n{\n    return virDomainMomentFindByName(checkpoints->base, name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointObjGetDef",
          "args": [
            "chk"
          ],
          "line": 352
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.h",
          "lines": "92-96",
          "snippet": "static inline virDomainCheckpointDefPtr\nvirDomainCheckpointObjGetDef(virDomainMomentObjPtr obj)\n{\n    return (virDomainCheckpointDefPtr) obj->def;\n}",
          "includes": [
            "#include \"virbuffer.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "virDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virbuffer.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n\nvirDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def);\n\nstatic inline virDomainCheckpointDefPtr\nvirDomainCheckpointObjGetDef(virDomainMomentObjPtr obj)\n{\n    return (virDomainCheckpointDefPtr) obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s/%s.xml\"",
            "cfg->checkpointDir",
            "vm->def->name",
            "chk->def->name"
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_UNSUPPORTED",
            "\"%s\"",
            "_(\"cannot remove checkpoint from inactive domain\")"
          ],
          "line": 343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot remove checkpoint from inactive domain\""
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainObjIsActive",
          "args": [
            "vm"
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainObjIsActive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.h",
          "lines": "2845-2849",
          "snippet": "static inline bool\nvirDomainObjIsActive(virDomainObjPtr dom)\n{\n    return dom->def->id != -1;\n}",
          "includes": [
            "#include \"virenum.h\"",
            "#include \"virresctrl.h\"",
            "#include \"virsavecookie.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virperf.h\"",
            "#include \"virgic.h\"",
            "#include \"virprocess.h\"",
            "#include \"virseclabel.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virbitmap.h\"",
            "#include \"device_conf.h\"",
            "#include \"virobject.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"virnetdevvlan.h\"",
            "#include \"virnetdevbandwidth.h\"",
            "#include \"virnetdevvportprofile.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"numa_conf.h\"",
            "#include \"nwfilter_params.h\"",
            "#include \"networkcommon_conf.h\"",
            "#include \"virsocketaddr.h\"",
            "#include \"virhash.h\"",
            "#include \"virthread.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"capabilities.h\"",
            "#include \"virconftypes.h\"",
            "#include \"internal.h\"",
            "#include <libxml/xpath.h>",
            "#include <libxml/tree.h>",
            "#include <libxml/parser.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void virDomainMemoryDefFree(virDomainMemoryDefPtr def);",
            "void virDomainIOThreadIDDefFree(virDomainIOThreadIDDefPtr def);",
            "unsigned long long virDomainDefGetMemoryInitial(const virDomainDef *def);",
            "unsigned long long virDomainDefGetMemoryTotal(const virDomainDef *def);",
            "bool virDomainDefHasMemoryHotplug(const virDomainDef *def);",
            "int virDomainXMLOptionRunMomentPostParse(virDomainXMLOptionPtr xmlopt,\n                                         virDomainMomentDefPtr def);",
            "bool virDomainDefHasUSB(const virDomainDef *def);",
            "int virDomainObjCheckActive(virDomainObjPtr dom);",
            "bool virDomainDefHasVcpusOffline(const virDomainDef *def);",
            "unsigned int virDomainDefGetVcpusMax(const virDomainDef *def);",
            "unsigned int virDomainDefGetVcpus(const virDomainDef *def);",
            "virBitmapPtr virDomainDefGetOnlineVcpumap(const virDomainDef *def);",
            "void virDomainDefVcpuOrderClear(virDomainDefPtr def);",
            "void virDomainGraphicsDefFree(virDomainGraphicsDefPtr def);",
            "void virDomainInputDefFree(virDomainInputDefPtr def);",
            "void virDomainDiskDefFree(virDomainDiskDefPtr def);",
            "void virDomainLeaseDefFree(virDomainLeaseDefPtr def);",
            "int virDomainDiskGetType(virDomainDiskDefPtr def);",
            "const char *virDomainDiskGetSource(virDomainDiskDef const *def);",
            "void virDomainDiskEmptySource(virDomainDiskDefPtr def);",
            "const char *virDomainDiskGetDriver(const virDomainDiskDef *def);",
            "int virDomainDiskGetFormat(virDomainDiskDefPtr def);",
            "void virDomainControllerDefFree(virDomainControllerDefPtr def);",
            "void virDomainFSDefFree(virDomainFSDefPtr def);",
            "void virDomainActualNetDefFree(virDomainActualNetDefPtr def);",
            "void virDomainNetDefClear(virDomainNetDefPtr def);",
            "void virDomainNetDefFree(virDomainNetDefPtr def);",
            "void virDomainSmartcardDefFree(virDomainSmartcardDefPtr def);",
            "void virDomainChrDefFree(virDomainChrDefPtr def);",
            "void virDomainSoundCodecDefFree(virDomainSoundCodecDefPtr def);",
            "void virDomainSoundDefFree(virDomainSoundDefPtr def);",
            "void virDomainMemballoonDefFree(virDomainMemballoonDefPtr def);",
            "void virDomainNVRAMDefFree(virDomainNVRAMDefPtr def);",
            "void virDomainWatchdogDefFree(virDomainWatchdogDefPtr def);",
            "void virDomainVideoDefFree(virDomainVideoDefPtr def);",
            "void virDomainVideoDefClear(virDomainVideoDefPtr def);",
            "void virDomainHostdevDefClear(virDomainHostdevDefPtr def);",
            "void virDomainHostdevDefFree(virDomainHostdevDefPtr def);",
            "void virDomainHubDefFree(virDomainHubDefPtr def);",
            "void virDomainRedirdevDefFree(virDomainRedirdevDefPtr def);",
            "void virDomainRedirFilterDefFree(virDomainRedirFilterDefPtr def);",
            "void virDomainShmemDefFree(virDomainShmemDefPtr def);",
            "void virDomainDeviceDefFree(virDomainDeviceDefPtr def);",
            "void virDomainTPMDefFree(virDomainTPMDefPtr def);",
            "void virDomainRNGDefFree(virDomainRNGDefPtr def);",
            "int virDomainDeleteConfig(const char *configDir,\n                          const char *autostartDir,\n                          virDomainObjPtr dom);",
            "int virDomainVideoDefaultType(const virDomainDef *def);",
            "void virDomainChrSourceDefClear(virDomainChrSourceDefPtr def);",
            "int virDomainDiskTranslateSourcePool(virDomainDiskDefPtr def);",
            "bool\nvirDomainDefHasManagedPR(const virDomainDef *def);",
            "bool\nvirDomainDefHasNVMeDisk(const virDomainDef *def);",
            "bool\nvirDomainDefHasVFIOHostdev(const virDomainDef *def);",
            "bool\nvirDomainDefHasMdevHostdev(const virDomainDef *def);",
            "bool\nvirDomainDefHasOldStyleUEFI(const virDomainDef *def);",
            "bool\nvirDomainDefHasOldStyleROUEFI(const virDomainDef *def);",
            "bool\nvirDomainGraphicsDefHasOpenGL(const virDomainDef *def);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virenum.h\"\n#include \"virresctrl.h\"\n#include \"virsavecookie.h\"\n#include \"virtypedparam.h\"\n#include \"virperf.h\"\n#include \"virgic.h\"\n#include \"virprocess.h\"\n#include \"virseclabel.h\"\n#include \"virstoragefile.h\"\n#include \"virbitmap.h\"\n#include \"device_conf.h\"\n#include \"virobject.h\"\n#include \"virnetworkportdef.h\"\n#include \"virnetdevvlan.h\"\n#include \"virnetdevbandwidth.h\"\n#include \"virnetdevvportprofile.h\"\n#include \"virnetdevip.h\"\n#include \"virnetdev.h\"\n#include \"virsysinfo.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"numa_conf.h\"\n#include \"nwfilter_params.h\"\n#include \"networkcommon_conf.h\"\n#include \"virsocketaddr.h\"\n#include \"virhash.h\"\n#include \"virthread.h\"\n#include \"cpu_conf.h\"\n#include \"virstorageencryption.h\"\n#include \"capabilities.h\"\n#include \"virconftypes.h\"\n#include \"internal.h\"\n#include <libxml/xpath.h>\n#include <libxml/tree.h>\n#include <libxml/parser.h>\n\nvoid virDomainMemoryDefFree(virDomainMemoryDefPtr def);\nvoid virDomainIOThreadIDDefFree(virDomainIOThreadIDDefPtr def);\nunsigned long long virDomainDefGetMemoryInitial(const virDomainDef *def);\nunsigned long long virDomainDefGetMemoryTotal(const virDomainDef *def);\nbool virDomainDefHasMemoryHotplug(const virDomainDef *def);\nint virDomainXMLOptionRunMomentPostParse(virDomainXMLOptionPtr xmlopt,\n                                         virDomainMomentDefPtr def);\nbool virDomainDefHasUSB(const virDomainDef *def);\nint virDomainObjCheckActive(virDomainObjPtr dom);\nbool virDomainDefHasVcpusOffline(const virDomainDef *def);\nunsigned int virDomainDefGetVcpusMax(const virDomainDef *def);\nunsigned int virDomainDefGetVcpus(const virDomainDef *def);\nvirBitmapPtr virDomainDefGetOnlineVcpumap(const virDomainDef *def);\nvoid virDomainDefVcpuOrderClear(virDomainDefPtr def);\nvoid virDomainGraphicsDefFree(virDomainGraphicsDefPtr def);\nvoid virDomainInputDefFree(virDomainInputDefPtr def);\nvoid virDomainDiskDefFree(virDomainDiskDefPtr def);\nvoid virDomainLeaseDefFree(virDomainLeaseDefPtr def);\nint virDomainDiskGetType(virDomainDiskDefPtr def);\nconst char *virDomainDiskGetSource(virDomainDiskDef const *def);\nvoid virDomainDiskEmptySource(virDomainDiskDefPtr def);\nconst char *virDomainDiskGetDriver(const virDomainDiskDef *def);\nint virDomainDiskGetFormat(virDomainDiskDefPtr def);\nvoid virDomainControllerDefFree(virDomainControllerDefPtr def);\nvoid virDomainFSDefFree(virDomainFSDefPtr def);\nvoid virDomainActualNetDefFree(virDomainActualNetDefPtr def);\nvoid virDomainNetDefClear(virDomainNetDefPtr def);\nvoid virDomainNetDefFree(virDomainNetDefPtr def);\nvoid virDomainSmartcardDefFree(virDomainSmartcardDefPtr def);\nvoid virDomainChrDefFree(virDomainChrDefPtr def);\nvoid virDomainSoundCodecDefFree(virDomainSoundCodecDefPtr def);\nvoid virDomainSoundDefFree(virDomainSoundDefPtr def);\nvoid virDomainMemballoonDefFree(virDomainMemballoonDefPtr def);\nvoid virDomainNVRAMDefFree(virDomainNVRAMDefPtr def);\nvoid virDomainWatchdogDefFree(virDomainWatchdogDefPtr def);\nvoid virDomainVideoDefFree(virDomainVideoDefPtr def);\nvoid virDomainVideoDefClear(virDomainVideoDefPtr def);\nvoid virDomainHostdevDefClear(virDomainHostdevDefPtr def);\nvoid virDomainHostdevDefFree(virDomainHostdevDefPtr def);\nvoid virDomainHubDefFree(virDomainHubDefPtr def);\nvoid virDomainRedirdevDefFree(virDomainRedirdevDefPtr def);\nvoid virDomainRedirFilterDefFree(virDomainRedirFilterDefPtr def);\nvoid virDomainShmemDefFree(virDomainShmemDefPtr def);\nvoid virDomainDeviceDefFree(virDomainDeviceDefPtr def);\nvoid virDomainTPMDefFree(virDomainTPMDefPtr def);\nvoid virDomainRNGDefFree(virDomainRNGDefPtr def);\nint virDomainDeleteConfig(const char *configDir,\n                          const char *autostartDir,\n                          virDomainObjPtr dom);\nint virDomainVideoDefaultType(const virDomainDef *def);\nvoid virDomainChrSourceDefClear(virDomainChrSourceDefPtr def);\nint virDomainDiskTranslateSourcePool(virDomainDiskDefPtr def);\nbool\nvirDomainDefHasManagedPR(const virDomainDef *def);\nbool\nvirDomainDefHasNVMeDisk(const virDomainDef *def);\nbool\nvirDomainDefHasVFIOHostdev(const virDomainDef *def);\nbool\nvirDomainDefHasMdevHostdev(const virDomainDef *def);\nbool\nvirDomainDefHasOldStyleUEFI(const virDomainDef *def);\nbool\nvirDomainDefHasOldStyleROUEFI(const virDomainDef *def);\nbool\nvirDomainGraphicsDefHasOpenGL(const virDomainDef *def);\n\nstatic inline bool\nvirDomainObjIsActive(virDomainObjPtr dom)\n{\n    return dom->def->id != -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointGetCurrent",
          "args": [
            "vm->checkpoints"
          ],
          "line": 340
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointGetCurrentName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "126-130",
          "snippet": "const char *\nvirDomainCheckpointGetCurrentName(virDomainCheckpointObjListPtr checkpoints)\n{\n    return virDomainMomentGetCurrentName(checkpoints->base);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nconst char *\nvirDomainCheckpointGetCurrentName(virDomainCheckpointObjListPtr checkpoints)\n{\n    return virDomainMomentGetCurrentName(checkpoints->base);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUDriverGetConfig",
          "args": [
            "driver"
          ],
          "line": 338
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_conf.c",
          "lines": "1211-1218",
          "snippet": "virQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virsocket.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virlog.h\"",
            "#include \"virxml.h\"",
            "#include \"datatypes.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"storage_conf.h\"\n#include \"virstring.h\"\n#include \"virsocket.h\"\n#include \"virfile.h\"\n#include \"domain_nwfilter.h\"\n#include \"cpu/cpu.h\"\n#include \"virlog.h\"\n#include \"virxml.h\"\n#include \"datatypes.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"qemu_security.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointDiscard(virQEMUDriverPtr driver,\n                      virDomainObjPtr vm,\n                      virDomainMomentObjPtr chk,\n                      bool update_parent,\n                      bool metadata_only)\n{\n    virDomainMomentObjPtr parent = NULL;\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *chkFile = NULL;\n    bool chkcurrent = chk == virDomainCheckpointGetCurrent(vm->checkpoints);\n\n    if (!metadata_only && !virDomainObjIsActive(vm)) {\n        virReportError(VIR_ERR_OPERATION_UNSUPPORTED, \"%s\",\n                       _(\"cannot remove checkpoint from inactive domain\"));\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s/%s.xml\", cfg->checkpointDir, vm->def->name,\n                              chk->def->name);\n\n    if (!metadata_only) {\n        virDomainCheckpointDefPtr chkdef = virDomainCheckpointObjGetDef(chk);\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               chk->def->parent_name);\n        if (qemuCheckpointDiscardBitmaps(vm, chkdef, parent) < 0)\n            return -1;\n    }\n\n    if (chkcurrent) {\n        virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n        if (update_parent && parent) {\n            virDomainCheckpointSetCurrent(vm->checkpoints, parent);\n            if (qemuCheckpointWriteMetadata(vm, parent,\n                                            driver->xmlopt,\n                                            cfg->checkpointDir) < 0) {\n                VIR_WARN(\"failed to set parent checkpoint '%s' as current\",\n                         chk->def->parent_name);\n                virDomainCheckpointSetCurrent(vm->checkpoints, NULL);\n            }\n        }\n    }\n\n    if (unlink(chkFile) < 0)\n        VIR_WARN(\"Failed to unlink %s\", chkFile);\n    if (update_parent)\n        virDomainMomentDropParent(chk);\n    virDomainCheckpointObjListRemove(vm->checkpoints, chk);\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuCheckpointDiscardBitmaps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "248-327",
    "snippet": "static int\nqemuCheckpointDiscardBitmaps(virDomainObjPtr vm,\n                             virDomainCheckpointDefPtr chkdef,\n                             virDomainMomentObjPtr parent)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    g_autoptr(virHashTable) blockNamedNodeData = NULL;\n    int rc = -1;\n    g_autoptr(virJSONValue) actions = NULL;\n    size_t i;\n    g_autoptr(GSList) reopenimages = NULL;\n    g_autoptr(GSList) relabelimages = NULL;\n    GSList *next;\n\n    actions = virJSONValueNewArray();\n\n    if (!(blockNamedNodeData = qemuBlockGetNamedNodeData(vm, QEMU_ASYNC_JOB_NONE)))\n        return -1;\n\n    for (i = 0; i < chkdef->ndisks; i++) {\n        virDomainCheckpointDiskDef *chkdisk = &chkdef->disks[i];\n        virDomainDiskDefPtr domdisk = virDomainDiskByTarget(vm->def, chkdisk->name);\n        virDomainCheckpointDiskDef *parentchkdisk = NULL;\n        const char *parentbitmap = NULL;\n\n        /* domdisk can be missing e.g. when it was unplugged */\n        if (!domdisk)\n            continue;\n\n        if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        /* If any ancestor checkpoint has a bitmap for the same\n         * disk, then this bitmap must be merged to the\n         * ancestor. */\n        if ((parentchkdisk = qemuCheckpointFindActiveDiskInParent(vm, parent,\n                                                                  chkdisk->name)))\n            parentbitmap = parentchkdisk->bitmap;\n\n        if (qemuCheckpointDiscardDiskBitmaps(domdisk->src, blockNamedNodeData,\n                                             chkdisk->bitmap, parentbitmap,\n                                             actions, domdisk->dst,\n                                             &reopenimages) < 0)\n            return -1;\n    }\n\n    /* label any non-top images for read-write access */\n    for (next = reopenimages; next; next = next->next) {\n        virStorageSourcePtr src = next->data;\n\n        if (qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                               false, false, false) < 0)\n            goto relabel;\n\n        if (virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_BLOCKDEV_REOPEN) &&\n            qemuBlockReopenReadWrite(vm, src, QEMU_ASYNC_JOB_NONE) < 0)\n            goto relabel;\n\n        relabelimages = g_slist_prepend(relabelimages, src);\n    }\n\n    qemuDomainObjEnterMonitor(driver, vm);\n    rc = qemuMonitorTransaction(priv->mon, &actions);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        return -1;\n\n relabel:\n    for (next = relabelimages; next; next = next->next) {\n        virStorageSourcePtr src = next->data;\n\n        if (virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_BLOCKDEV_REOPEN))\n            ignore_value(qemuBlockReopenReadOnly(vm, src, QEMU_ASYNC_JOB_NONE));\n\n        ignore_value(qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                                        true, false, false));\n    }\n\n    return rc;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                                        true, false, false)"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuDomainStorageSourceAccessAllow",
          "args": [
            "driver",
            "vm",
            "src",
            "true",
            "false",
            "false"
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainStorageSourceAccessAllow",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "12115-12137",
          "snippet": "int\nqemuDomainStorageSourceAccessAllow(virQEMUDriverPtr driver,\n                                   virDomainObjPtr vm,\n                                   virStorageSourcePtr elem,\n                                   bool readonly,\n                                   bool newSource,\n                                   bool chainTop)\n{\n    qemuDomainStorageSourceAccessFlags flags = QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_SKIP_REVOKE;\n\n    if (readonly)\n        flags |= QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_FORCE_READ_ONLY;\n    else\n        flags |= QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_FORCE_READ_WRITE;\n\n    if (!newSource)\n        flags |= QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_MODIFY_ACCESS;\n\n    if (chainTop)\n        flags |= QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_CHAIN_TOP;\n\n    return qemuDomainStorageSourceAccessModify(driver, vm, elem, flags);\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuDomainStorageSourceAccessAllow(virQEMUDriverPtr driver,\n                                   virDomainObjPtr vm,\n                                   virStorageSourcePtr elem,\n                                   bool readonly,\n                                   bool newSource,\n                                   bool chainTop)\n{\n    qemuDomainStorageSourceAccessFlags flags = QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_SKIP_REVOKE;\n\n    if (readonly)\n        flags |= QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_FORCE_READ_ONLY;\n    else\n        flags |= QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_FORCE_READ_WRITE;\n\n    if (!newSource)\n        flags |= QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_MODIFY_ACCESS;\n\n    if (chainTop)\n        flags |= QEMU_DOMAIN_STORAGE_SOURCE_ACCESS_CHAIN_TOP;\n\n    return qemuDomainStorageSourceAccessModify(driver, vm, elem, flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "qemuBlockReopenReadOnly(vm, src, QEMU_ASYNC_JOB_NONE)"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuBlockReopenReadOnly",
          "args": [
            "vm",
            "src",
            "QEMU_ASYNC_JOB_NONE"
          ],
          "line": 320
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockReopenReadOnly",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "3308-3323",
          "snippet": "int\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nint\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUCapsGet",
          "args": [
            "priv->qemuCaps",
            "QEMU_CAPS_BLOCKDEV_REOPEN"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUCapsGetPreferredMachine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_capabilities.c",
          "lines": "5555-5564",
          "snippet": "const char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <stdarg.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"virutil.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_qapi.h\"",
            "#include \"qemu_capspriv.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"virstring.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virnuma.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu_x86.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfilecache.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vircrypto.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <stdarg.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"virutil.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_process.h\"\n#include \"qemu_qapi.h\"\n#include \"qemu_capspriv.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_hostdev.h\"\n#include \"virstring.h\"\n#include \"qemu_monitor.h\"\n#include \"virhostcpu.h\"\n#include \"virnuma.h\"\n#include \"virnodesuspend.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu_x86.h\"\n#include \"cpu/cpu.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfilecache.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vircrypto.h\"\n#include \"viralloc.h\"\n#include \"qemu_capabilities.h\"\n#include <config.h>\n\nconst char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainObjExitMonitor",
          "args": [
            "driver",
            "vm"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjExitMonitor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10189-10200",
          "snippet": "int qemuDomainObjExitMonitor(virQEMUDriverPtr driver,\n                             virDomainObjPtr obj)\n{\n    qemuDomainObjExitMonitorInternal(driver, obj);\n    if (!virDomainObjIsActive(obj)) {\n        if (virGetLastErrorCode() == VIR_ERR_OK)\n            virReportError(VIR_ERR_OPERATION_FAILED, \"%s\",\n                           _(\"domain is no longer running\"));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuDomainLogContextFinalize(GObject *obj);",
            "static void qemuDomainSaveCookieDispose(void *obj);",
            "static void qemuDomainDiskPrivateDispose(void *obj);",
            "static void qemuDomainStorageSourcePrivateDispose(void *obj);",
            "static void qemuDomainVcpuPrivateDispose(void *obj);",
            "static void qemuDomainChrSourcePrivateDispose(void *obj);",
            "static void qemuDomainVsockPrivateDispose(void *obj);",
            "static void qemuDomainGraphicsPrivateDispose(void *obj);",
            "static void qemuDomainNetworkPrivateDispose(void *obj);",
            "static void qemuDomainFSPrivateDispose(void *obj);",
            "static void qemuDomainVideoPrivateDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nstatic void qemuDomainLogContextFinalize(GObject *obj);\nstatic void qemuDomainSaveCookieDispose(void *obj);\nstatic void qemuDomainDiskPrivateDispose(void *obj);\nstatic void qemuDomainStorageSourcePrivateDispose(void *obj);\nstatic void qemuDomainVcpuPrivateDispose(void *obj);\nstatic void qemuDomainChrSourcePrivateDispose(void *obj);\nstatic void qemuDomainVsockPrivateDispose(void *obj);\nstatic void qemuDomainGraphicsPrivateDispose(void *obj);\nstatic void qemuDomainNetworkPrivateDispose(void *obj);\nstatic void qemuDomainFSPrivateDispose(void *obj);\nstatic void qemuDomainVideoPrivateDispose(void *obj);\n\nint qemuDomainObjExitMonitor(virQEMUDriverPtr driver,\n                             virDomainObjPtr obj)\n{\n    qemuDomainObjExitMonitorInternal(driver, obj);\n    if (!virDomainObjIsActive(obj)) {\n        if (virGetLastErrorCode() == VIR_ERR_OK)\n            virReportError(VIR_ERR_OPERATION_FAILED, \"%s\",\n                           _(\"domain is no longer running\"));\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuMonitorTransaction",
          "args": [
            "priv->mon",
            "&actions"
          ],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransaction",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "3073-3081",
          "snippet": "int\nqemuMonitorTransaction(qemuMonitorPtr mon, virJSONValuePtr *actions)\n{\n    VIR_DEBUG(\"actions=%p\", *actions);\n\n    QEMU_CHECK_MONITOR(mon);\n\n    return qemuMonitorJSONTransaction(mon, actions);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransaction(qemuMonitorPtr mon, virJSONValuePtr *actions)\n{\n    VIR_DEBUG(\"actions=%p\", *actions);\n\n    QEMU_CHECK_MONITOR(mon);\n\n    return qemuMonitorJSONTransaction(mon, actions);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainObjEnterMonitor",
          "args": [
            "driver",
            "vm"
          ],
          "line": 310
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjEnterMonitor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "10172-10177",
          "snippet": "void qemuDomainObjEnterMonitor(virQEMUDriverPtr driver,\n                               virDomainObjPtr obj)\n{\n    ignore_value(qemuDomainObjEnterMonitorInternal(driver, obj,\n                                                   QEMU_ASYNC_JOB_NONE));\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuDomainLogContextFinalize(GObject *obj);",
            "static void qemuDomainSaveCookieDispose(void *obj);",
            "static void qemuDomainDiskPrivateDispose(void *obj);",
            "static void qemuDomainStorageSourcePrivateDispose(void *obj);",
            "static void qemuDomainVcpuPrivateDispose(void *obj);",
            "static void qemuDomainChrSourcePrivateDispose(void *obj);",
            "static void qemuDomainVsockPrivateDispose(void *obj);",
            "static void qemuDomainGraphicsPrivateDispose(void *obj);",
            "static void qemuDomainNetworkPrivateDispose(void *obj);",
            "static void qemuDomainFSPrivateDispose(void *obj);",
            "static void qemuDomainVideoPrivateDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nstatic void qemuDomainLogContextFinalize(GObject *obj);\nstatic void qemuDomainSaveCookieDispose(void *obj);\nstatic void qemuDomainDiskPrivateDispose(void *obj);\nstatic void qemuDomainStorageSourcePrivateDispose(void *obj);\nstatic void qemuDomainVcpuPrivateDispose(void *obj);\nstatic void qemuDomainChrSourcePrivateDispose(void *obj);\nstatic void qemuDomainVsockPrivateDispose(void *obj);\nstatic void qemuDomainGraphicsPrivateDispose(void *obj);\nstatic void qemuDomainNetworkPrivateDispose(void *obj);\nstatic void qemuDomainFSPrivateDispose(void *obj);\nstatic void qemuDomainVideoPrivateDispose(void *obj);\n\nvoid qemuDomainObjEnterMonitor(virQEMUDriverPtr driver,\n                               virDomainObjPtr obj)\n{\n    ignore_value(qemuDomainObjEnterMonitorInternal(driver, obj,\n                                                   QEMU_ASYNC_JOB_NONE));\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_slist_prepend",
          "args": [
            "relabelimages",
            "src"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuBlockReopenReadWrite",
          "args": [
            "vm",
            "src",
            "QEMU_ASYNC_JOB_NONE"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockReopenReadWrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "3279-3294",
          "snippet": "int\nqemuBlockReopenReadWrite(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (!src->readonly)\n        return 0;\n\n    src->readonly = false;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = true;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nint\nqemuBlockReopenReadWrite(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (!src->readonly)\n        return 0;\n\n    src->readonly = false;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = true;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointDiscardDiskBitmaps",
          "args": [
            "domdisk->src",
            "blockNamedNodeData",
            "chkdisk->bitmap",
            "parentbitmap",
            "actions",
            "domdisk->dst",
            "&reopenimages"
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointDiscardDiskBitmaps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "152-245",
          "snippet": "int\nqemuCheckpointDiscardDiskBitmaps(virStorageSourcePtr src,\n                                 virHashTablePtr blockNamedNodeData,\n                                 const char *delbitmap,\n                                 const char *parentbitmap,\n                                 virJSONValuePtr actions,\n                                 const char *diskdst,\n                                 GSList **reopenimages)\n{\n    virStorageSourcePtr n = src;\n\n    /* find the backing chain entry with bitmap named '@delbitmap' */\n    while (n) {\n        qemuBlockNamedNodeDataBitmapPtr tmp;\n\n        if ((tmp = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                         n, delbitmap))) {\n            break;\n        }\n\n        n = n->backingStore;\n    }\n\n    if (!n) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"bitmap '%s' not found in backing chain of '%s'\"),\n                       delbitmap, diskdst);\n        return -1;\n    }\n\n    while (n) {\n        qemuBlockNamedNodeDataBitmapPtr srcbitmap;\n\n        if (!(srcbitmap = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                                n, delbitmap)))\n            break;\n\n        /* For the actual checkpoint deletion we will merge any bitmap into the\n         * bitmap of the parent checkpoint (@parentbitmap) or for any image\n         * where the parent checkpoint bitmap is not present we must rename\n         * the bitmap of the deleted checkpoint into the bitmap of the parent\n         * checkpoint as qemu can't currently take the allocation map and turn\n         * it into a bitmap and thus we wouldn't be able to do a backup. */\n        if (parentbitmap) {\n            qemuBlockNamedNodeDataBitmapPtr dstbitmap;\n            g_autoptr(virJSONValue) arr = NULL;\n\n            dstbitmap = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                              n, parentbitmap);\n\n            if (dstbitmap) {\n                if (srcbitmap->recording && !dstbitmap->recording) {\n                    if (qemuMonitorTransactionBitmapEnable(actions,\n                                                           n->nodeformat,\n                                                           dstbitmap->name) < 0)\n                        return -1;\n                }\n\n            } else {\n                if (qemuMonitorTransactionBitmapAdd(actions,\n                                                    n->nodeformat,\n                                                    parentbitmap,\n                                                    true,\n                                                    !srcbitmap->recording,\n                                                    srcbitmap->granularity) < 0)\n                    return -1;\n            }\n\n            arr = virJSONValueNewArray();\n\n            if (qemuMonitorTransactionBitmapMergeSourceAddBitmap(arr,\n                                                                 n->nodeformat,\n                                                                 srcbitmap->name) < 0)\n                return -1;\n\n            if (qemuMonitorTransactionBitmapMerge(actions,\n                                                  n->nodeformat,\n                                                  parentbitmap, &arr) < 0)\n                return -1;\n        }\n\n        if (qemuMonitorTransactionBitmapRemove(actions,\n                                               n->nodeformat,\n                                               srcbitmap->name) < 0)\n            return -1;\n\n        if (n != src)\n            *reopenimages = g_slist_prepend(*reopenimages, n);\n\n        n = n->backingStore;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nqemuCheckpointDiscardDiskBitmaps(virStorageSourcePtr src,\n                                 virHashTablePtr blockNamedNodeData,\n                                 const char *delbitmap,\n                                 const char *parentbitmap,\n                                 virJSONValuePtr actions,\n                                 const char *diskdst,\n                                 GSList **reopenimages)\n{\n    virStorageSourcePtr n = src;\n\n    /* find the backing chain entry with bitmap named '@delbitmap' */\n    while (n) {\n        qemuBlockNamedNodeDataBitmapPtr tmp;\n\n        if ((tmp = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                         n, delbitmap))) {\n            break;\n        }\n\n        n = n->backingStore;\n    }\n\n    if (!n) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"bitmap '%s' not found in backing chain of '%s'\"),\n                       delbitmap, diskdst);\n        return -1;\n    }\n\n    while (n) {\n        qemuBlockNamedNodeDataBitmapPtr srcbitmap;\n\n        if (!(srcbitmap = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                                n, delbitmap)))\n            break;\n\n        /* For the actual checkpoint deletion we will merge any bitmap into the\n         * bitmap of the parent checkpoint (@parentbitmap) or for any image\n         * where the parent checkpoint bitmap is not present we must rename\n         * the bitmap of the deleted checkpoint into the bitmap of the parent\n         * checkpoint as qemu can't currently take the allocation map and turn\n         * it into a bitmap and thus we wouldn't be able to do a backup. */\n        if (parentbitmap) {\n            qemuBlockNamedNodeDataBitmapPtr dstbitmap;\n            g_autoptr(virJSONValue) arr = NULL;\n\n            dstbitmap = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                              n, parentbitmap);\n\n            if (dstbitmap) {\n                if (srcbitmap->recording && !dstbitmap->recording) {\n                    if (qemuMonitorTransactionBitmapEnable(actions,\n                                                           n->nodeformat,\n                                                           dstbitmap->name) < 0)\n                        return -1;\n                }\n\n            } else {\n                if (qemuMonitorTransactionBitmapAdd(actions,\n                                                    n->nodeformat,\n                                                    parentbitmap,\n                                                    true,\n                                                    !srcbitmap->recording,\n                                                    srcbitmap->granularity) < 0)\n                    return -1;\n            }\n\n            arr = virJSONValueNewArray();\n\n            if (qemuMonitorTransactionBitmapMergeSourceAddBitmap(arr,\n                                                                 n->nodeformat,\n                                                                 srcbitmap->name) < 0)\n                return -1;\n\n            if (qemuMonitorTransactionBitmapMerge(actions,\n                                                  n->nodeformat,\n                                                  parentbitmap, &arr) < 0)\n                return -1;\n        }\n\n        if (qemuMonitorTransactionBitmapRemove(actions,\n                                               n->nodeformat,\n                                               srcbitmap->name) < 0)\n            return -1;\n\n        if (n != src)\n            *reopenimages = g_slist_prepend(*reopenimages, n);\n\n        n = n->backingStore;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuCheckpointFindActiveDiskInParent",
          "args": [
            "vm",
            "parent",
            "chkdisk->name"
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointFindActiveDiskInParent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "118-149",
          "snippet": "static virDomainCheckpointDiskDef *\nqemuCheckpointFindActiveDiskInParent(virDomainObjPtr vm,\n                                     virDomainMomentObjPtr from,\n                                     const char *diskname)\n{\n    virDomainMomentObjPtr parent = from;\n    virDomainCheckpointDefPtr parentdef = NULL;\n    size_t i;\n\n    while (parent) {\n        parentdef = virDomainCheckpointObjGetDef(parent);\n\n        for (i = 0; i < parentdef->ndisks; i++) {\n            virDomainCheckpointDiskDef *chkdisk = &parentdef->disks[i];\n\n            if (STRNEQ(chkdisk->name, diskname))\n                continue;\n\n            /* currently inspected checkpoint doesn't describe the disk,\n             * continue into parent checkpoint */\n            if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n                break;\n\n            return chkdisk;\n        }\n\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               parentdef->parent.parent_name);\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic virDomainCheckpointDiskDef *\nqemuCheckpointFindActiveDiskInParent(virDomainObjPtr vm,\n                                     virDomainMomentObjPtr from,\n                                     const char *diskname)\n{\n    virDomainMomentObjPtr parent = from;\n    virDomainCheckpointDefPtr parentdef = NULL;\n    size_t i;\n\n    while (parent) {\n        parentdef = virDomainCheckpointObjGetDef(parent);\n\n        for (i = 0; i < parentdef->ndisks; i++) {\n            virDomainCheckpointDiskDef *chkdisk = &parentdef->disks[i];\n\n            if (STRNEQ(chkdisk->name, diskname))\n                continue;\n\n            /* currently inspected checkpoint doesn't describe the disk,\n             * continue into parent checkpoint */\n            if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n                break;\n\n            return chkdisk;\n        }\n\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               parentdef->parent.parent_name);\n    }\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDiskByTarget",
          "args": [
            "vm->def",
            "chkdisk->name"
          ],
          "line": 270
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDiskByTarget",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "17337-17349",
          "snippet": "virDomainDiskDefPtr\nvirDomainDiskByTarget(virDomainDefPtr def,\n                      const char *dst)\n{\n    size_t i;\n\n    for (i = 0; i < def->ndisks; i++) {\n        if (STREQ(def->disks[i]->dst, dst))\n            return def->disks[i];\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirDomainDiskDefPtr\nvirDomainDiskByTarget(virDomainDefPtr def,\n                      const char *dst)\n{\n    size_t i;\n\n    for (i = 0; i < def->ndisks; i++) {\n        if (STREQ(def->disks[i]->dst, dst))\n            return def->disks[i];\n    }\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuBlockGetNamedNodeData",
          "args": [
            "vm",
            "QEMU_ASYNC_JOB_NONE"
          ],
          "line": 265
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockGetNamedNodeData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "2805-2824",
          "snippet": "virHashTablePtr\nqemuBlockGetNamedNodeData(virDomainObjPtr vm,\n                          qemuDomainAsyncJob asyncJob)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    g_autoptr(virHashTable) blockNamedNodeData = NULL;\n    bool supports_flat = virQEMUCapsGet(priv->qemuCaps,\n                                        QEMU_CAPS_QMP_QUERY_NAMED_BLOCK_NODES_FLAT);\n\n    if (qemuDomainObjEnterMonitorAsync(driver, vm, asyncJob) < 0)\n        return NULL;\n\n    blockNamedNodeData = qemuMonitorBlockGetNamedNodeData(priv->mon, supports_flat);\n\n    if (qemuDomainObjExitMonitor(driver, vm) < 0 || !blockNamedNodeData)\n        return NULL;\n\n    return g_steal_pointer(&blockNamedNodeData);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nvirHashTablePtr\nqemuBlockGetNamedNodeData(virDomainObjPtr vm,\n                          qemuDomainAsyncJob asyncJob)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    g_autoptr(virHashTable) blockNamedNodeData = NULL;\n    bool supports_flat = virQEMUCapsGet(priv->qemuCaps,\n                                        QEMU_CAPS_QMP_QUERY_NAMED_BLOCK_NODES_FLAT);\n\n    if (qemuDomainObjEnterMonitorAsync(driver, vm, asyncJob) < 0)\n        return NULL;\n\n    blockNamedNodeData = qemuMonitorBlockGetNamedNodeData(priv->mon, supports_flat);\n\n    if (qemuDomainObjExitMonitor(driver, vm) < 0 || !blockNamedNodeData)\n        return NULL;\n\n    return g_steal_pointer(&blockNamedNodeData);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewArray",
          "args": [],
          "line": 263
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "560-568",
          "snippet": "virJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointDiscardBitmaps(virDomainObjPtr vm,\n                             virDomainCheckpointDefPtr chkdef,\n                             virDomainMomentObjPtr parent)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    virQEMUDriverPtr driver = priv->driver;\n    g_autoptr(virHashTable) blockNamedNodeData = NULL;\n    int rc = -1;\n    g_autoptr(virJSONValue) actions = NULL;\n    size_t i;\n    g_autoptr(GSList) reopenimages = NULL;\n    g_autoptr(GSList) relabelimages = NULL;\n    GSList *next;\n\n    actions = virJSONValueNewArray();\n\n    if (!(blockNamedNodeData = qemuBlockGetNamedNodeData(vm, QEMU_ASYNC_JOB_NONE)))\n        return -1;\n\n    for (i = 0; i < chkdef->ndisks; i++) {\n        virDomainCheckpointDiskDef *chkdisk = &chkdef->disks[i];\n        virDomainDiskDefPtr domdisk = virDomainDiskByTarget(vm->def, chkdisk->name);\n        virDomainCheckpointDiskDef *parentchkdisk = NULL;\n        const char *parentbitmap = NULL;\n\n        /* domdisk can be missing e.g. when it was unplugged */\n        if (!domdisk)\n            continue;\n\n        if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n            continue;\n\n        /* If any ancestor checkpoint has a bitmap for the same\n         * disk, then this bitmap must be merged to the\n         * ancestor. */\n        if ((parentchkdisk = qemuCheckpointFindActiveDiskInParent(vm, parent,\n                                                                  chkdisk->name)))\n            parentbitmap = parentchkdisk->bitmap;\n\n        if (qemuCheckpointDiscardDiskBitmaps(domdisk->src, blockNamedNodeData,\n                                             chkdisk->bitmap, parentbitmap,\n                                             actions, domdisk->dst,\n                                             &reopenimages) < 0)\n            return -1;\n    }\n\n    /* label any non-top images for read-write access */\n    for (next = reopenimages; next; next = next->next) {\n        virStorageSourcePtr src = next->data;\n\n        if (qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                               false, false, false) < 0)\n            goto relabel;\n\n        if (virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_BLOCKDEV_REOPEN) &&\n            qemuBlockReopenReadWrite(vm, src, QEMU_ASYNC_JOB_NONE) < 0)\n            goto relabel;\n\n        relabelimages = g_slist_prepend(relabelimages, src);\n    }\n\n    qemuDomainObjEnterMonitor(driver, vm);\n    rc = qemuMonitorTransaction(priv->mon, &actions);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        return -1;\n\n relabel:\n    for (next = relabelimages; next; next = next->next) {\n        virStorageSourcePtr src = next->data;\n\n        if (virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_BLOCKDEV_REOPEN))\n            ignore_value(qemuBlockReopenReadOnly(vm, src, QEMU_ASYNC_JOB_NONE));\n\n        ignore_value(qemuDomainStorageSourceAccessAllow(driver, vm, src,\n                                                        true, false, false));\n    }\n\n    return rc;\n}"
  },
  {
    "function_name": "qemuCheckpointDiscardDiskBitmaps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "152-245",
    "snippet": "int\nqemuCheckpointDiscardDiskBitmaps(virStorageSourcePtr src,\n                                 virHashTablePtr blockNamedNodeData,\n                                 const char *delbitmap,\n                                 const char *parentbitmap,\n                                 virJSONValuePtr actions,\n                                 const char *diskdst,\n                                 GSList **reopenimages)\n{\n    virStorageSourcePtr n = src;\n\n    /* find the backing chain entry with bitmap named '@delbitmap' */\n    while (n) {\n        qemuBlockNamedNodeDataBitmapPtr tmp;\n\n        if ((tmp = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                         n, delbitmap))) {\n            break;\n        }\n\n        n = n->backingStore;\n    }\n\n    if (!n) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"bitmap '%s' not found in backing chain of '%s'\"),\n                       delbitmap, diskdst);\n        return -1;\n    }\n\n    while (n) {\n        qemuBlockNamedNodeDataBitmapPtr srcbitmap;\n\n        if (!(srcbitmap = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                                n, delbitmap)))\n            break;\n\n        /* For the actual checkpoint deletion we will merge any bitmap into the\n         * bitmap of the parent checkpoint (@parentbitmap) or for any image\n         * where the parent checkpoint bitmap is not present we must rename\n         * the bitmap of the deleted checkpoint into the bitmap of the parent\n         * checkpoint as qemu can't currently take the allocation map and turn\n         * it into a bitmap and thus we wouldn't be able to do a backup. */\n        if (parentbitmap) {\n            qemuBlockNamedNodeDataBitmapPtr dstbitmap;\n            g_autoptr(virJSONValue) arr = NULL;\n\n            dstbitmap = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                              n, parentbitmap);\n\n            if (dstbitmap) {\n                if (srcbitmap->recording && !dstbitmap->recording) {\n                    if (qemuMonitorTransactionBitmapEnable(actions,\n                                                           n->nodeformat,\n                                                           dstbitmap->name) < 0)\n                        return -1;\n                }\n\n            } else {\n                if (qemuMonitorTransactionBitmapAdd(actions,\n                                                    n->nodeformat,\n                                                    parentbitmap,\n                                                    true,\n                                                    !srcbitmap->recording,\n                                                    srcbitmap->granularity) < 0)\n                    return -1;\n            }\n\n            arr = virJSONValueNewArray();\n\n            if (qemuMonitorTransactionBitmapMergeSourceAddBitmap(arr,\n                                                                 n->nodeformat,\n                                                                 srcbitmap->name) < 0)\n                return -1;\n\n            if (qemuMonitorTransactionBitmapMerge(actions,\n                                                  n->nodeformat,\n                                                  parentbitmap, &arr) < 0)\n                return -1;\n        }\n\n        if (qemuMonitorTransactionBitmapRemove(actions,\n                                               n->nodeformat,\n                                               srcbitmap->name) < 0)\n            return -1;\n\n        if (n != src)\n            *reopenimages = g_slist_prepend(*reopenimages, n);\n\n        n = n->backingStore;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_slist_prepend",
          "args": [
            "*reopenimages",
            "n"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuMonitorTransactionBitmapRemove",
          "args": [
            "actions",
            "n->nodeformat",
            "srcbitmap->name"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransactionBitmapRemove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "4511-4517",
          "snippet": "int\nqemuMonitorTransactionBitmapRemove(virJSONValuePtr actions,\n                                   const char *node,\n                                   const char *name)\n{\n    return qemuMonitorJSONTransactionBitmapRemove(actions, node, name);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransactionBitmapRemove(virJSONValuePtr actions,\n                                   const char *node,\n                                   const char *name)\n{\n    return qemuMonitorJSONTransactionBitmapRemove(actions, node, name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuMonitorTransactionBitmapMerge",
          "args": [
            "actions",
            "n->nodeformat",
            "parentbitmap",
            "&arr"
          ],
          "line": 227
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransactionBitmapMerge",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "4538-4545",
          "snippet": "int\nqemuMonitorTransactionBitmapMerge(virJSONValuePtr actions,\n                                  const char *node,\n                                  const char *target,\n                                  virJSONValuePtr *sources)\n{\n    return qemuMonitorJSONTransactionBitmapMerge(actions, node, target, sources);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransactionBitmapMerge(virJSONValuePtr actions,\n                                  const char *node,\n                                  const char *target,\n                                  virJSONValuePtr *sources)\n{\n    return qemuMonitorJSONTransactionBitmapMerge(actions, node, target, sources);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuMonitorTransactionBitmapMergeSourceAddBitmap",
          "args": [
            "arr",
            "n->nodeformat",
            "srcbitmap->name"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransactionBitmapMergeSourceAddBitmap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "4548-4554",
          "snippet": "int\nqemuMonitorTransactionBitmapMergeSourceAddBitmap(virJSONValuePtr sources,\n                                                 const char *sourcenode,\n                                                 const char *sourcebitmap)\n{\n    return qemuMonitorJSONTransactionBitmapMergeSourceAddBitmap(sources, sourcenode, sourcebitmap);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransactionBitmapMergeSourceAddBitmap(virJSONValuePtr sources,\n                                                 const char *sourcenode,\n                                                 const char *sourcebitmap)\n{\n    return qemuMonitorJSONTransactionBitmapMergeSourceAddBitmap(sources, sourcenode, sourcebitmap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewArray",
          "args": [],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "560-568",
          "snippet": "virJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuMonitorTransactionBitmapAdd",
          "args": [
            "actions",
            "n->nodeformat",
            "parentbitmap",
            "true",
            "!srcbitmap->recording",
            "srcbitmap->granularity"
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransactionBitmapAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "4498-4508",
          "snippet": "int\nqemuMonitorTransactionBitmapAdd(virJSONValuePtr actions,\n                                const char *node,\n                                const char *name,\n                                bool persistent,\n                                bool disabled,\n                                unsigned long long granularity)\n{\n    return qemuMonitorJSONTransactionBitmapAdd(actions, node, name, persistent,\n                                               disabled, granularity);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransactionBitmapAdd(virJSONValuePtr actions,\n                                const char *node,\n                                const char *name,\n                                bool persistent,\n                                bool disabled,\n                                unsigned long long granularity)\n{\n    return qemuMonitorJSONTransactionBitmapAdd(actions, node, name, persistent,\n                                               disabled, granularity);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuMonitorTransactionBitmapEnable",
          "args": [
            "actions",
            "n->nodeformat",
            "dstbitmap->name"
          ],
          "line": 204
        },
        "resolved": true,
        "details": {
          "function_name": "qemuMonitorTransactionBitmapEnable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_monitor.c",
          "lines": "4520-4526",
          "snippet": "int\nqemuMonitorTransactionBitmapEnable(virJSONValuePtr actions,\n                                   const char *node,\n                                   const char *name)\n{\n    return qemuMonitorJSONTransactionBitmapEnable(actions, node, name);\n}",
          "includes": [
            "#include \"qemu_monitor_priv.h\"",
            "# include \"libvirt_qemu_probes.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virobject.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor_json.h\"",
            "#include \"qemu_monitor_text.h\"",
            "#include \"qemu_monitor.h\"",
            "#include <gio/gio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_monitor_priv.h\"\n# include \"libvirt_qemu_probes.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virobject.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"qemu_process.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor_json.h\"\n#include \"qemu_monitor_text.h\"\n#include \"qemu_monitor.h\"\n#include <gio/gio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuMonitorTransactionBitmapEnable(virJSONValuePtr actions,\n                                   const char *node,\n                                   const char *name)\n{\n    return qemuMonitorJSONTransactionBitmapEnable(actions, node, name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuBlockNamedNodeDataGetBitmapByName",
          "args": [
            "blockNamedNodeData",
            "n",
            "parentbitmap"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockNamedNodeDataGetBitmapByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "2781-2802",
          "snippet": "qemuBlockNamedNodeDataBitmapPtr\nqemuBlockNamedNodeDataGetBitmapByName(virHashTablePtr blockNamedNodeData,\n                                      virStorageSourcePtr src,\n                                      const char *bitmap)\n{\n    qemuBlockNamedNodeDataPtr nodedata;\n    size_t i;\n\n    if (!(nodedata = virHashLookup(blockNamedNodeData, src->nodeformat)))\n        return NULL;\n\n    for (i = 0; i < nodedata->nbitmaps; i++) {\n        qemuBlockNamedNodeDataBitmapPtr bitmapdata = nodedata->bitmaps[i];\n\n        if (STRNEQ(bitmapdata->name, bitmap))\n            continue;\n\n        return bitmapdata;\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nqemuBlockNamedNodeDataBitmapPtr\nqemuBlockNamedNodeDataGetBitmapByName(virHashTablePtr blockNamedNodeData,\n                                      virStorageSourcePtr src,\n                                      const char *bitmap)\n{\n    qemuBlockNamedNodeDataPtr nodedata;\n    size_t i;\n\n    if (!(nodedata = virHashLookup(blockNamedNodeData, src->nodeformat)))\n        return NULL;\n\n    for (i = 0; i < nodedata->nbitmaps; i++) {\n        qemuBlockNamedNodeDataBitmapPtr bitmapdata = nodedata->bitmaps[i];\n\n        if (STRNEQ(bitmapdata->name, bitmap))\n            continue;\n\n        return bitmapdata;\n    }\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"bitmap '%s' not found in backing chain of '%s'\")",
            "delbitmap",
            "diskdst"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"bitmap '%s' not found in backing chain of '%s'\""
          ],
          "line": 177
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nint\nqemuCheckpointDiscardDiskBitmaps(virStorageSourcePtr src,\n                                 virHashTablePtr blockNamedNodeData,\n                                 const char *delbitmap,\n                                 const char *parentbitmap,\n                                 virJSONValuePtr actions,\n                                 const char *diskdst,\n                                 GSList **reopenimages)\n{\n    virStorageSourcePtr n = src;\n\n    /* find the backing chain entry with bitmap named '@delbitmap' */\n    while (n) {\n        qemuBlockNamedNodeDataBitmapPtr tmp;\n\n        if ((tmp = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                         n, delbitmap))) {\n            break;\n        }\n\n        n = n->backingStore;\n    }\n\n    if (!n) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"bitmap '%s' not found in backing chain of '%s'\"),\n                       delbitmap, diskdst);\n        return -1;\n    }\n\n    while (n) {\n        qemuBlockNamedNodeDataBitmapPtr srcbitmap;\n\n        if (!(srcbitmap = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                                n, delbitmap)))\n            break;\n\n        /* For the actual checkpoint deletion we will merge any bitmap into the\n         * bitmap of the parent checkpoint (@parentbitmap) or for any image\n         * where the parent checkpoint bitmap is not present we must rename\n         * the bitmap of the deleted checkpoint into the bitmap of the parent\n         * checkpoint as qemu can't currently take the allocation map and turn\n         * it into a bitmap and thus we wouldn't be able to do a backup. */\n        if (parentbitmap) {\n            qemuBlockNamedNodeDataBitmapPtr dstbitmap;\n            g_autoptr(virJSONValue) arr = NULL;\n\n            dstbitmap = qemuBlockNamedNodeDataGetBitmapByName(blockNamedNodeData,\n                                                              n, parentbitmap);\n\n            if (dstbitmap) {\n                if (srcbitmap->recording && !dstbitmap->recording) {\n                    if (qemuMonitorTransactionBitmapEnable(actions,\n                                                           n->nodeformat,\n                                                           dstbitmap->name) < 0)\n                        return -1;\n                }\n\n            } else {\n                if (qemuMonitorTransactionBitmapAdd(actions,\n                                                    n->nodeformat,\n                                                    parentbitmap,\n                                                    true,\n                                                    !srcbitmap->recording,\n                                                    srcbitmap->granularity) < 0)\n                    return -1;\n            }\n\n            arr = virJSONValueNewArray();\n\n            if (qemuMonitorTransactionBitmapMergeSourceAddBitmap(arr,\n                                                                 n->nodeformat,\n                                                                 srcbitmap->name) < 0)\n                return -1;\n\n            if (qemuMonitorTransactionBitmapMerge(actions,\n                                                  n->nodeformat,\n                                                  parentbitmap, &arr) < 0)\n                return -1;\n        }\n\n        if (qemuMonitorTransactionBitmapRemove(actions,\n                                               n->nodeformat,\n                                               srcbitmap->name) < 0)\n            return -1;\n\n        if (n != src)\n            *reopenimages = g_slist_prepend(*reopenimages, n);\n\n        n = n->backingStore;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuCheckpointFindActiveDiskInParent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "118-149",
    "snippet": "static virDomainCheckpointDiskDef *\nqemuCheckpointFindActiveDiskInParent(virDomainObjPtr vm,\n                                     virDomainMomentObjPtr from,\n                                     const char *diskname)\n{\n    virDomainMomentObjPtr parent = from;\n    virDomainCheckpointDefPtr parentdef = NULL;\n    size_t i;\n\n    while (parent) {\n        parentdef = virDomainCheckpointObjGetDef(parent);\n\n        for (i = 0; i < parentdef->ndisks; i++) {\n            virDomainCheckpointDiskDef *chkdisk = &parentdef->disks[i];\n\n            if (STRNEQ(chkdisk->name, diskname))\n                continue;\n\n            /* currently inspected checkpoint doesn't describe the disk,\n             * continue into parent checkpoint */\n            if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n                break;\n\n            return chkdisk;\n        }\n\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               parentdef->parent.parent_name);\n    }\n\n    return NULL;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virDomainCheckpointFindByName",
          "args": [
            "vm->checkpoints",
            "parentdef->parent.parent_name"
          ],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "109-114",
          "snippet": "virDomainMomentObjPtr\nvirDomainCheckpointFindByName(virDomainCheckpointObjListPtr checkpoints,\n                              const char *name)\n{\n    return virDomainMomentFindByName(checkpoints->base, name);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvirDomainMomentObjPtr\nvirDomainCheckpointFindByName(virDomainCheckpointObjListPtr checkpoints,\n                              const char *name)\n{\n    return virDomainMomentFindByName(checkpoints->base, name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "chkdisk->name",
            "diskname"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointObjGetDef",
          "args": [
            "parent"
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.h",
          "lines": "92-96",
          "snippet": "static inline virDomainCheckpointDefPtr\nvirDomainCheckpointObjGetDef(virDomainMomentObjPtr obj)\n{\n    return (virDomainCheckpointDefPtr) obj->def;\n}",
          "includes": [
            "#include \"virbuffer.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "virDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virbuffer.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n\nvirDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def);\n\nstatic inline virDomainCheckpointDefPtr\nvirDomainCheckpointObjGetDef(virDomainMomentObjPtr obj)\n{\n    return (virDomainCheckpointDefPtr) obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic virDomainCheckpointDiskDef *\nqemuCheckpointFindActiveDiskInParent(virDomainObjPtr vm,\n                                     virDomainMomentObjPtr from,\n                                     const char *diskname)\n{\n    virDomainMomentObjPtr parent = from;\n    virDomainCheckpointDefPtr parentdef = NULL;\n    size_t i;\n\n    while (parent) {\n        parentdef = virDomainCheckpointObjGetDef(parent);\n\n        for (i = 0; i < parentdef->ndisks; i++) {\n            virDomainCheckpointDiskDef *chkdisk = &parentdef->disks[i];\n\n            if (STRNEQ(chkdisk->name, diskname))\n                continue;\n\n            /* currently inspected checkpoint doesn't describe the disk,\n             * continue into parent checkpoint */\n            if (chkdisk->type != VIR_DOMAIN_CHECKPOINT_TYPE_BITMAP)\n                break;\n\n            return chkdisk;\n        }\n\n        parent = virDomainCheckpointFindByName(vm->checkpoints,\n                                               parentdef->parent.parent_name);\n    }\n\n    return NULL;\n}"
  },
  {
    "function_name": "qemuCheckpointWriteMetadata",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "79-105",
    "snippet": "static int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virXMLSaveFile",
          "args": [
            "chkFile",
            "NULL",
            "\"checkpoint-edit\"",
            "newxml"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "virXMLSaveFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "941-950",
          "snippet": "int\nvirXMLSaveFile(const char *path,\n               const char *warnName,\n               const char *warnCommand,\n               const char *xml)\n{\n    struct virXMLRewriteFileData data = { warnName, warnCommand, xml };\n\n    return virFileRewrite(path, S_IRUSR | S_IWUSR, virXMLRewriteFile, &data);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirXMLSaveFile(const char *path,\n               const char *warnName,\n               const char *warnCommand,\n               const char *xml)\n{\n    struct virXMLRewriteFileData data = { warnName, warnCommand, xml };\n\n    return virFileRewrite(path, S_IRUSR | S_IWUSR, virXMLRewriteFile, &data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s.xml\"",
            "chkDir",
            "def->parent.name"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot create checkpoint directory '%s'\")",
            "chkDir"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot create checkpoint directory '%s'\""
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "chkDir"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointDefFormat",
          "args": [
            "def",
            "xmlopt",
            "flags"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointDefFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/checkpoint_conf.c",
          "lines": "500-515",
          "snippet": "char *\nvirDomainCheckpointDefFormat(virDomainCheckpointDefPtr def,\n                             virDomainXMLOptionPtr xmlopt,\n                             unsigned int flags)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE |\n                  VIR_DOMAIN_CHECKPOINT_FORMAT_NO_DOMAIN |\n                  VIR_DOMAIN_CHECKPOINT_FORMAT_SIZE, NULL);\n    if (virDomainCheckpointDefFormatInternal(&buf, def, xmlopt,\n                                             flags) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virbitmap.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virstoragefile.h\"\n#include \"checkpoint_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"domain_conf.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"virbitmap.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <config.h>\n\nchar *\nvirDomainCheckpointDefFormat(virDomainCheckpointDefPtr def,\n                             virDomainXMLOptionPtr xmlopt,\n                             unsigned int flags)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virCheckFlags(VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE |\n                  VIR_DOMAIN_CHECKPOINT_FORMAT_NO_DOMAIN |\n                  VIR_DOMAIN_CHECKPOINT_FORMAT_SIZE, NULL);\n    if (virDomainCheckpointDefFormatInternal(&buf, def, xmlopt,\n                                             flags) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointObjGetDef",
          "args": [
            "checkpoint"
          ],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.h",
          "lines": "92-96",
          "snippet": "static inline virDomainCheckpointDefPtr\nvirDomainCheckpointObjGetDef(virDomainMomentObjPtr obj)\n{\n    return (virDomainCheckpointDefPtr) obj->def;\n}",
          "includes": [
            "#include \"virbuffer.h\"",
            "#include \"virdomainmomentobjlist.h\"",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "virDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virbuffer.h\"\n#include \"virdomainmomentobjlist.h\"\n#include \"internal.h\"\n\nvirDomainMomentObjPtr\nvirDomainCheckpointAssignDef(virDomainCheckpointObjListPtr checkpoints,\n                             virDomainCheckpointDefPtr def);\n\nstatic inline virDomainCheckpointDefPtr\nvirDomainCheckpointObjGetDef(virDomainMomentObjPtr obj)\n{\n    return (virDomainCheckpointDefPtr) obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nqemuCheckpointWriteMetadata(virDomainObjPtr vm,\n                            virDomainMomentObjPtr checkpoint,\n                            virDomainXMLOptionPtr xmlopt,\n                            const char *checkpointDir)\n{\n    unsigned int flags = VIR_DOMAIN_CHECKPOINT_FORMAT_SECURE;\n    virDomainCheckpointDefPtr def = virDomainCheckpointObjGetDef(checkpoint);\n    g_autofree char *newxml = NULL;\n    g_autofree char *chkDir = NULL;\n    g_autofree char *chkFile = NULL;\n\n    newxml = virDomainCheckpointDefFormat(def, xmlopt, flags);\n    if (newxml == NULL)\n        return -1;\n\n    chkDir = g_strdup_printf(\"%s/%s\", checkpointDir, vm->def->name);\n    if (virFileMakePath(chkDir) < 0) {\n        virReportSystemError(errno, _(\"cannot create checkpoint directory '%s'\"),\n                             chkDir);\n        return -1;\n    }\n\n    chkFile = g_strdup_printf(\"%s/%s.xml\", chkDir, def->parent.name);\n\n    return virXMLSaveFile(chkFile, NULL, \"checkpoint-edit\", newxml);\n}"
  },
  {
    "function_name": "qemuCheckpointObjFromCheckpoint",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "71-76",
    "snippet": "virDomainMomentObjPtr\nqemuCheckpointObjFromCheckpoint(virDomainObjPtr vm,\n                                virDomainCheckpointPtr checkpoint)\n{\n    return qemuCheckpointObjFromName(vm, checkpoint->name);\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuCheckpointObjFromName",
          "args": [
            "vm",
            "checkpoint->name"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "qemuCheckpointObjFromName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
          "lines": "55-67",
          "snippet": "virDomainMomentObjPtr\nqemuCheckpointObjFromName(virDomainObjPtr vm,\n                          const char *name)\n{\n    virDomainMomentObjPtr chk = NULL;\n    chk = virDomainCheckpointFindByName(vm->checkpoints, name);\n    if (!chk)\n        virReportError(VIR_ERR_NO_DOMAIN_CHECKPOINT,\n                       _(\"no domain checkpoint with matching name '%s'\"),\n                       name);\n\n    return chk;\n}",
          "includes": [
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virstring.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirDomainMomentObjPtr\nqemuCheckpointObjFromName(virDomainObjPtr vm,\n                          const char *name)\n{\n    virDomainMomentObjPtr chk = NULL;\n    chk = virDomainCheckpointFindByName(vm->checkpoints, name);\n    if (!chk)\n        virReportError(VIR_ERR_NO_DOMAIN_CHECKPOINT,\n                       _(\"no domain checkpoint with matching name '%s'\"),\n                       name);\n\n    return chk;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirDomainMomentObjPtr\nqemuCheckpointObjFromCheckpoint(virDomainObjPtr vm,\n                                virDomainCheckpointPtr checkpoint)\n{\n    return qemuCheckpointObjFromName(vm, checkpoint->name);\n}"
  },
  {
    "function_name": "qemuCheckpointObjFromName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "55-67",
    "snippet": "virDomainMomentObjPtr\nqemuCheckpointObjFromName(virDomainObjPtr vm,\n                          const char *name)\n{\n    virDomainMomentObjPtr chk = NULL;\n    chk = virDomainCheckpointFindByName(vm->checkpoints, name);\n    if (!chk)\n        virReportError(VIR_ERR_NO_DOMAIN_CHECKPOINT,\n                       _(\"no domain checkpoint with matching name '%s'\"),\n                       name);\n\n    return chk;\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_DOMAIN_CHECKPOINT",
            "_(\"no domain checkpoint with matching name '%s'\")",
            "name"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no domain checkpoint with matching name '%s'\""
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCheckpointFindByName",
          "args": [
            "vm->checkpoints",
            "name"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCheckpointFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virdomaincheckpointobjlist.c",
          "lines": "109-114",
          "snippet": "virDomainMomentObjPtr\nvirDomainCheckpointFindByName(virDomainCheckpointObjListPtr checkpoints,\n                              const char *name)\n{\n    return virDomainMomentFindByName(checkpoints->base, name);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"checkpoint_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvirDomainMomentObjPtr\nvirDomainCheckpointFindByName(virDomainCheckpointObjListPtr checkpoints,\n                              const char *name)\n{\n    return virDomainMomentFindByName(checkpoints->base, name);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirDomainMomentObjPtr\nqemuCheckpointObjFromName(virDomainObjPtr vm,\n                          const char *name)\n{\n    virDomainMomentObjPtr chk = NULL;\n    chk = virDomainCheckpointFindByName(vm->checkpoints, name);\n    if (!chk)\n        virReportError(VIR_ERR_NO_DOMAIN_CHECKPOINT,\n                       _(\"no domain checkpoint with matching name '%s'\"),\n                       name);\n\n    return chk;\n}"
  },
  {
    "function_name": "qemuDomObjFromCheckpoint",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_checkpoint.c",
    "lines": "47-51",
    "snippet": "virDomainObjPtr\nqemuDomObjFromCheckpoint(virDomainCheckpointPtr checkpoint)\n{\n    return qemuDomainObjFromDomain(checkpoint->domain);\n}",
    "includes": [
      "#include \"virdomainsnapshotobjlist.h\"",
      "#include \"virdomaincheckpointobjlist.h\"",
      "#include \"virstring.h\"",
      "#include \"virxml.h\"",
      "#include \"libvirt_internal.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"qemu_block.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_monitor.h\"",
      "#include \"qemu_capabilities.h\"",
      "#include \"qemu_checkpoint.h\"",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuDomainObjFromDomain",
          "args": [
            "checkpoint->domain"
          ],
          "line": 50
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainObjFromDomain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_domain.c",
          "lines": "133-150",
          "snippet": "virDomainObjPtr\nqemuDomainObjFromDomain(virDomainPtr domain)\n{\n    virDomainObjPtr vm;\n    virQEMUDriverPtr driver = domain->conn->privateData;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    vm = virDomainObjListFindByUUID(driver->domains, domain->uuid);\n    if (!vm) {\n        virUUIDFormat(domain->uuid, uuidstr);\n        virReportError(VIR_ERR_NO_DOMAIN,\n                       _(\"no domain with matching uuid '%s' (%s)\"),\n                       uuidstr, domain->name);\n        return NULL;\n    }\n\n    return vm;\n}",
          "includes": [
            "# include <selinux/selinux.h>",
            "# include <sys/mount.h>",
            "#include <fcntl.h>",
            "#include <sys/time.h>",
            "# include <sys/sysmacros.h>",
            "#include \"virdevmapper.h\"",
            "#include \"virutil.h\"",
            "#include \"backup_conf.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"logging/log_manager.h\"",
            "#include \"virsecret.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virrandom.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virprocess.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virtime.h\"",
            "#include \"domain_event.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"domain_addr.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "obj, obj->def->name);"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <selinux/selinux.h>\n# include <sys/mount.h>\n#include <fcntl.h>\n#include <sys/time.h>\n# include <sys/sysmacros.h>\n#include \"virdevmapper.h\"\n#include \"virutil.h\"\n#include \"backup_conf.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"locking/domain_lock.h\"\n#include \"logging/log_manager.h\"\n#include \"virsecret.h\"\n#include \"virsystemd.h\"\n#include \"virrandom.h\"\n#include \"vircrypto.h\"\n#include \"virprocess.h\"\n#include \"virthreadjob.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virtime.h\"\n#include \"domain_event.h\"\n#include \"domain_capabilities.h\"\n#include \"domain_addr.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"cpu/cpu.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_security.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_process.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_command.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nobj, obj->def->name);\n\nvirDomainObjPtr\nqemuDomainObjFromDomain(virDomainPtr domain)\n{\n    virDomainObjPtr vm;\n    virQEMUDriverPtr driver = domain->conn->privateData;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    vm = virDomainObjListFindByUUID(driver->domains, domain->uuid);\n    if (!vm) {\n        virUUIDFormat(domain->uuid, uuidstr);\n        virReportError(VIR_ERR_NO_DOMAIN,\n                       _(\"no domain with matching uuid '%s' (%s)\"),\n                       uuidstr, domain->name);\n        return NULL;\n    }\n\n    return vm;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virdomainsnapshotobjlist.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virstring.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_block.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_checkpoint.h\"\n#include <sys/types.h>\n#include <config.h>\n\nvirDomainObjPtr\nqemuDomObjFromCheckpoint(virDomainCheckpointPtr checkpoint)\n{\n    return qemuDomainObjFromDomain(checkpoint->domain);\n}"
  }
]