[
  {
    "function_name": "virCPUs390ValidateFeatures",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_s390.c",
    "lines": "95-111",
    "snippet": "static int\nvirCPUs390ValidateFeatures(virCPUDefPtr cpu)\n{\n    size_t i;\n\n    for (i = 0; i < cpu->nfeatures; i++) {\n        if (cpu->features[i].policy == VIR_CPU_FEATURE_OPTIONAL) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"only cpu feature policies 'require' and \"\n                             \"'disable' are supported for %s\"),\n                           cpu->features[i].name);\n            return -1;\n        }\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"only cpu feature policies 'require' and \"\n                             \"'disable' are supported for %s\")",
            "cpu->features[i].name"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"only cpu feature policies 'require' and \"\n                             \"'disable' are supported for %s\""
          ],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"cpu.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirCPUs390ValidateFeatures(virCPUDefPtr cpu)\n{\n    size_t i;\n\n    for (i = 0; i < cpu->nfeatures; i++) {\n        if (cpu->features[i].policy == VIR_CPU_FEATURE_OPTIONAL) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"only cpu feature policies 'require' and \"\n                             \"'disable' are supported for %s\"),\n                           cpu->features[i].name);\n            return -1;\n        }\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virCPUs390Update",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_s390.c",
    "lines": "44-92",
    "snippet": "static int\nvirCPUs390Update(virCPUDefPtr guest,\n                 const virCPUDef *host)\n{\n    virCPUDefPtr updated = NULL;\n    int ret = -1;\n    size_t i;\n\n    if (guest->mode == VIR_CPU_MODE_CUSTOM) {\n        if (guest->match == VIR_CPU_MATCH_MINIMUM) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"match mode %s not supported\"),\n                           virCPUMatchTypeToString(guest->match));\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"optional CPU features are not supported\"));\n        }\n        goto cleanup;\n    }\n\n    if (!host) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"unknown host CPU model\"));\n        goto cleanup;\n    }\n\n    if (!(updated = virCPUDefCopyWithoutModel(guest)))\n        goto cleanup;\n\n    updated->mode = VIR_CPU_MODE_CUSTOM;\n    if (virCPUDefCopyModel(updated, host, true) < 0)\n        goto cleanup;\n\n    for (i = 0; i < guest->nfeatures; i++) {\n       if (virCPUDefUpdateFeature(updated,\n                                  guest->features[i].name,\n                                  guest->features[i].policy) < 0)\n           goto cleanup;\n    }\n\n    virCPUDefStealModel(guest, updated, false);\n    guest->mode = VIR_CPU_MODE_CUSTOM;\n    guest->match = VIR_CPU_MATCH_EXACT;\n    ret = 0;\n\n cleanup:\n    virCPUDefFree(updated);\n    return ret;\n}",
    "includes": [
      "#include \"cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCPUDefFree",
          "args": [
            "updated"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "virCPUDefFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/cpu_conf.c",
          "lines": "120-132",
          "snippet": "void\nvirCPUDefFree(virCPUDefPtr def)\n{\n    if (!def)\n        return;\n\n    if (g_atomic_int_dec_and_test(&def->refs)) {\n        virCPUDefFreeModel(def);\n        VIR_FREE(def->cache);\n        VIR_FREE(def->tsc);\n        VIR_FREE(def);\n    }\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"domain_conf.h\"\n#include \"cpu_conf.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirCPUDefFree(virCPUDefPtr def)\n{\n    if (!def)\n        return;\n\n    if (g_atomic_int_dec_and_test(&def->refs)) {\n        virCPUDefFreeModel(def);\n        VIR_FREE(def->cache);\n        VIR_FREE(def->tsc);\n        VIR_FREE(def);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCPUDefStealModel",
          "args": [
            "guest",
            "updated",
            "false"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "virCPUDefStealModel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/cpu_conf.c",
          "lines": "194-224",
          "snippet": "void\nvirCPUDefStealModel(virCPUDefPtr dst,\n                    virCPUDefPtr src,\n                    bool keepVendor)\n{\n    char *vendor = NULL;\n    char *vendor_id = NULL;\n\n    if (keepVendor) {\n        vendor = g_steal_pointer(&dst->vendor);\n        vendor_id = g_steal_pointer(&dst->vendor_id);\n    }\n\n    virCPUDefFreeModel(dst);\n\n    dst->model = g_steal_pointer(&src->model);\n    dst->features = g_steal_pointer(&src->features);\n    dst->microcodeVersion = src->microcodeVersion;\n    dst->nfeatures_max = src->nfeatures_max;\n    src->nfeatures_max = 0;\n    dst->nfeatures = src->nfeatures;\n    src->nfeatures = 0;\n\n    if (keepVendor) {\n        dst->vendor = vendor;\n        dst->vendor_id = vendor_id;\n    } else {\n        dst->vendor = g_steal_pointer(&src->vendor);\n        dst->vendor_id = g_steal_pointer(&src->vendor_id);\n    }\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"domain_conf.h\"\n#include \"cpu_conf.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirCPUDefStealModel(virCPUDefPtr dst,\n                    virCPUDefPtr src,\n                    bool keepVendor)\n{\n    char *vendor = NULL;\n    char *vendor_id = NULL;\n\n    if (keepVendor) {\n        vendor = g_steal_pointer(&dst->vendor);\n        vendor_id = g_steal_pointer(&dst->vendor_id);\n    }\n\n    virCPUDefFreeModel(dst);\n\n    dst->model = g_steal_pointer(&src->model);\n    dst->features = g_steal_pointer(&src->features);\n    dst->microcodeVersion = src->microcodeVersion;\n    dst->nfeatures_max = src->nfeatures_max;\n    src->nfeatures_max = 0;\n    dst->nfeatures = src->nfeatures;\n    src->nfeatures = 0;\n\n    if (keepVendor) {\n        dst->vendor = vendor;\n        dst->vendor_id = vendor_id;\n    } else {\n        dst->vendor = g_steal_pointer(&src->vendor);\n        dst->vendor_id = g_steal_pointer(&src->vendor_id);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCPUDefUpdateFeature",
          "args": [
            "updated",
            "guest->features[i].name",
            "guest->features[i].policy"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "virCPUDefUpdateFeature",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/cpu_conf.c",
          "lines": "920-926",
          "snippet": "int\nvirCPUDefUpdateFeature(virCPUDefPtr def,\n                       const char *name,\n                       int policy)\n{\n    return virCPUDefUpdateFeatureInternal(def, name, policy, true);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"domain_conf.h\"\n#include \"cpu_conf.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirCPUDefUpdateFeature(virCPUDefPtr def,\n                       const char *name,\n                       int policy)\n{\n    return virCPUDefUpdateFeatureInternal(def, name, policy, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCPUDefCopyModel",
          "args": [
            "updated",
            "host",
            "true"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCPUDefCopyWithoutModel",
          "args": [
            "guest"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "virCPUDefCopyWithoutModel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/cpu_conf.c",
          "lines": "227-266",
          "snippet": "virCPUDefPtr\nvirCPUDefCopyWithoutModel(const virCPUDef *cpu)\n{\n    virCPUDefPtr copy;\n\n    if (!cpu)\n        return NULL;\n\n    copy = virCPUDefNew();\n    copy->type = cpu->type;\n    copy->mode = cpu->mode;\n    copy->match = cpu->match;\n    copy->check = cpu->check;\n    copy->fallback = cpu->fallback;\n    copy->sockets = cpu->sockets;\n    copy->dies = cpu->dies;\n    copy->cores = cpu->cores;\n    copy->threads = cpu->threads;\n    copy->arch = cpu->arch;\n\n    if (cpu->cache) {\n        if (VIR_ALLOC(copy->cache) < 0)\n            goto error;\n\n        *copy->cache = *cpu->cache;\n    }\n\n    if (cpu->tsc) {\n        if (VIR_ALLOC(copy->tsc) < 0)\n            goto error;\n\n        *copy->tsc = *cpu->tsc;\n    }\n\n    return copy;\n\n error:\n    virCPUDefFree(copy);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"domain_conf.h\"\n#include \"cpu_conf.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirCPUDefPtr\nvirCPUDefCopyWithoutModel(const virCPUDef *cpu)\n{\n    virCPUDefPtr copy;\n\n    if (!cpu)\n        return NULL;\n\n    copy = virCPUDefNew();\n    copy->type = cpu->type;\n    copy->mode = cpu->mode;\n    copy->match = cpu->match;\n    copy->check = cpu->check;\n    copy->fallback = cpu->fallback;\n    copy->sockets = cpu->sockets;\n    copy->dies = cpu->dies;\n    copy->cores = cpu->cores;\n    copy->threads = cpu->threads;\n    copy->arch = cpu->arch;\n\n    if (cpu->cache) {\n        if (VIR_ALLOC(copy->cache) < 0)\n            goto error;\n\n        *copy->cache = *cpu->cache;\n    }\n\n    if (cpu->tsc) {\n        if (VIR_ALLOC(copy->tsc) < 0)\n            goto error;\n\n        *copy->tsc = *cpu->tsc;\n    }\n\n    return copy;\n\n error:\n    virCPUDefFree(copy);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"unknown host CPU model\")"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unknown host CPU model\""
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"optional CPU features are not supported\")"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"match mode %s not supported\")",
            "virCPUMatchTypeToString(guest->match)"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCPUMatchTypeToString",
          "args": [
            "guest->match"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"cpu.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirCPUs390Update(virCPUDefPtr guest,\n                 const virCPUDef *host)\n{\n    virCPUDefPtr updated = NULL;\n    int ret = -1;\n    size_t i;\n\n    if (guest->mode == VIR_CPU_MODE_CUSTOM) {\n        if (guest->match == VIR_CPU_MATCH_MINIMUM) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                           _(\"match mode %s not supported\"),\n                           virCPUMatchTypeToString(guest->match));\n        } else {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"optional CPU features are not supported\"));\n        }\n        goto cleanup;\n    }\n\n    if (!host) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"unknown host CPU model\"));\n        goto cleanup;\n    }\n\n    if (!(updated = virCPUDefCopyWithoutModel(guest)))\n        goto cleanup;\n\n    updated->mode = VIR_CPU_MODE_CUSTOM;\n    if (virCPUDefCopyModel(updated, host, true) < 0)\n        goto cleanup;\n\n    for (i = 0; i < guest->nfeatures; i++) {\n       if (virCPUDefUpdateFeature(updated,\n                                  guest->features[i].name,\n                                  guest->features[i].policy) < 0)\n           goto cleanup;\n    }\n\n    virCPUDefStealModel(guest, updated, false);\n    guest->mode = VIR_CPU_MODE_CUSTOM;\n    guest->match = VIR_CPU_MATCH_EXACT;\n    ret = 0;\n\n cleanup:\n    virCPUDefFree(updated);\n    return ret;\n}"
  },
  {
    "function_name": "virCPUs390Compare",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_s390.c",
    "lines": "33-42",
    "snippet": "static virCPUCompareResult\nvirCPUs390Compare(virCPUDefPtr host G_GNUC_UNUSED,\n                  virCPUDefPtr cpu G_GNUC_UNUSED,\n                  bool failMessages G_GNUC_UNUSED)\n{\n    /* s390 relies on QEMU to perform all runability checking. Return\n     * VIR_CPU_COMPARE_IDENTICAL to bypass Libvirt checking.\n     */\n    return VIR_CPU_COMPARE_IDENTICAL;\n}",
    "includes": [
      "#include \"cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"cpu.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic virCPUCompareResult\nvirCPUs390Compare(virCPUDefPtr host G_GNUC_UNUSED,\n                  virCPUDefPtr cpu G_GNUC_UNUSED,\n                  bool failMessages G_GNUC_UNUSED)\n{\n    /* s390 relies on QEMU to perform all runability checking. Return\n     * VIR_CPU_COMPARE_IDENTICAL to bypass Libvirt checking.\n     */\n    return VIR_CPU_COMPARE_IDENTICAL;\n}"
  }
]