[
  {
    "function_name": "virRotatingFileReaderFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "625-637",
    "snippet": "void\nvirRotatingFileReaderFree(virRotatingFileReaderPtr file)\n{\n    size_t i;\n\n    if (!file)\n        return;\n\n    for (i = 0; i < file->nentries; i++)\n        virRotatingFileReaderEntryFree(file->entries[i]);\n    VIR_FREE(file->entries);\n    VIR_FREE(file);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "file"
          ],
          "line": 636
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "file->entries"
          ],
          "line": 635
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileReaderEntryFree",
          "args": [
            "file->entries[i]"
          ],
          "line": 634
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileReaderEntryFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "87-96",
          "snippet": "static void\nvirRotatingFileReaderEntryFree(virRotatingFileReaderEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FREE(entry->path);\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic void\nvirRotatingFileReaderEntryFree(virRotatingFileReaderEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FREE(entry->path);\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirRotatingFileReaderFree(virRotatingFileReaderPtr file)\n{\n    size_t i;\n\n    if (!file)\n        return;\n\n    for (i = 0; i < file->nentries; i++)\n        virRotatingFileReaderEntryFree(file->entries[i]);\n    VIR_FREE(file->entries);\n    VIR_FREE(file);\n}"
  },
  {
    "function_name": "virRotatingFileWriterFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "607-616",
    "snippet": "void\nvirRotatingFileWriterFree(virRotatingFileWriterPtr file)\n{\n    if (!file)\n        return;\n\n    virRotatingFileWriterEntryFree(file->entry);\n    VIR_FREE(file->basepath);\n    VIR_FREE(file);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "file"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "file->basepath"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterEntryFree",
          "args": [
            "file->entry"
          ],
          "line": 613
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterEntryFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "76-84",
          "snippet": "static void\nvirRotatingFileWriterEntryFree(virRotatingFileWriterEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic void\nvirRotatingFileWriterEntryFree(virRotatingFileWriterEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirRotatingFileWriterFree(virRotatingFileWriterPtr file)\n{\n    if (!file)\n        return;\n\n    virRotatingFileWriterEntryFree(file->entry);\n    VIR_FREE(file->basepath);\n    VIR_FREE(file);\n}"
  },
  {
    "function_name": "virRotatingFileReaderConsume",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "559-598",
    "snippet": "ssize_t\nvirRotatingFileReaderConsume(virRotatingFileReaderPtr file,\n                             char *buf,\n                             size_t len)\n{\n    ssize_t ret = 0;\n\n    VIR_DEBUG(\"Consume %p %zu\", buf, len);\n    while (len) {\n        virRotatingFileReaderEntryPtr entry;\n        ssize_t got;\n\n        if (file->current >= file->nentries)\n            break;\n\n        entry = file->entries[file->current];\n        if (entry->fd == -1) {\n            file->current++;\n            continue;\n        }\n\n        got = saferead(entry->fd, buf + ret, len);\n        if (got < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to read from file %s\"),\n                                 entry->path);\n            return -1;\n        }\n\n        if (got == 0) {\n            file->current++;\n            continue;\n        }\n\n        ret += got;\n        len -= got;\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to read from file %s\")",
            "entry->path"
          ],
          "line": 582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to read from file %s\""
          ],
          "line": 583
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "saferead",
          "args": [
            "entry->fd",
            "buf + ret",
            "len"
          ],
          "line": 580
        },
        "resolved": true,
        "details": {
          "function_name": "saferead_lim",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1330-1372",
          "snippet": "static char *\nsaferead_lim(int fd, size_t max_len, size_t *length)\n{\n    char *buf = NULL;\n    size_t alloc = 0;\n    size_t size = 0;\n    int save_errno;\n\n    for (;;) {\n        int count;\n        int requested;\n\n        if (size + BUFSIZ + 1 > alloc) {\n            alloc += alloc / 2;\n            if (alloc < size + BUFSIZ + 1)\n                alloc = size + BUFSIZ + 1;\n\n            if (VIR_REALLOC_N(buf, alloc) < 0) {\n                save_errno = errno;\n                break;\n            }\n        }\n\n        /* Ensure that (size + requested <= max_len); */\n        requested = MIN(size < max_len ? max_len - size : 0,\n                        alloc - size - 1);\n        count = saferead(fd, buf + size, requested);\n        size += count;\n\n        if (count != requested || requested == 0) {\n            save_errno = errno;\n            if (count < 0)\n                break;\n            buf[size] = '\\0';\n            *length = size;\n            return buf;\n        }\n    }\n\n    VIR_FREE(buf);\n    errno = save_errno;\n    return NULL;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic char *\nsaferead_lim(int fd, size_t max_len, size_t *length)\n{\n    char *buf = NULL;\n    size_t alloc = 0;\n    size_t size = 0;\n    int save_errno;\n\n    for (;;) {\n        int count;\n        int requested;\n\n        if (size + BUFSIZ + 1 > alloc) {\n            alloc += alloc / 2;\n            if (alloc < size + BUFSIZ + 1)\n                alloc = size + BUFSIZ + 1;\n\n            if (VIR_REALLOC_N(buf, alloc) < 0) {\n                save_errno = errno;\n                break;\n            }\n        }\n\n        /* Ensure that (size + requested <= max_len); */\n        requested = MIN(size < max_len ? max_len - size : 0,\n                        alloc - size - 1);\n        count = saferead(fd, buf + size, requested);\n        size += count;\n\n        if (count != requested || requested == 0) {\n            save_errno = errno;\n            if (count < 0)\n                break;\n            buf[size] = '\\0';\n            *length = size;\n            return buf;\n        }\n    }\n\n    VIR_FREE(buf);\n    errno = save_errno;\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Consume %p %zu\"",
            "buf",
            "len"
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nssize_t\nvirRotatingFileReaderConsume(virRotatingFileReaderPtr file,\n                             char *buf,\n                             size_t len)\n{\n    ssize_t ret = 0;\n\n    VIR_DEBUG(\"Consume %p %zu\", buf, len);\n    while (len) {\n        virRotatingFileReaderEntryPtr entry;\n        ssize_t got;\n\n        if (file->current >= file->nentries)\n            break;\n\n        entry = file->entries[file->current];\n        if (entry->fd == -1) {\n            file->current++;\n            continue;\n        }\n\n        got = saferead(entry->fd, buf + ret, len);\n        if (got < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to read from file %s\"),\n                                 entry->path);\n            return -1;\n        }\n\n        if (got == 0) {\n            file->current++;\n            continue;\n        }\n\n        ret += got;\n        len -= got;\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virRotatingFileReaderSeek",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "510-545",
    "snippet": "int\nvirRotatingFileReaderSeek(virRotatingFileReaderPtr file,\n                          ino_t inode,\n                          off_t offset)\n{\n    size_t i;\n    off_t ret;\n\n    for (i = 0; i < file->nentries; i++) {\n        virRotatingFileReaderEntryPtr entry = file->entries[i];\n        if (entry->inode != inode ||\n            entry->fd == -1)\n            continue;\n\n        ret = lseek(entry->fd, offset, SEEK_SET);\n        if (ret == (off_t)-1) {\n            virReportSystemError(errno,\n                                 _(\"Unable to seek to inode %llu offset %llu\"),\n                                 (unsigned long long)inode, (unsigned long long)offset);\n            return -1;\n        }\n\n        file->current = i;\n        return 0;\n    }\n\n    file->current = 0;\n    ret = lseek(file->entries[0]->fd, offset, SEEK_SET);\n    if (ret == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to seek to inode %llu offset %llu\"),\n                             (unsigned long long)inode, (unsigned long long)offset);\n        return -1;\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to seek to inode %llu offset %llu\")",
            "(unsigned long long)inode",
            "(unsigned long long)offset"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to seek to inode %llu offset %llu\""
          ],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "file->entries[0]->fd",
            "offset",
            "SEEK_SET"
          ],
          "line": 537
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to seek to inode %llu offset %llu\")",
            "(unsigned long long)inode",
            "(unsigned long long)offset"
          ],
          "line": 526
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "entry->fd",
            "offset",
            "SEEK_SET"
          ],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirRotatingFileReaderSeek(virRotatingFileReaderPtr file,\n                          ino_t inode,\n                          off_t offset)\n{\n    size_t i;\n    off_t ret;\n\n    for (i = 0; i < file->nentries; i++) {\n        virRotatingFileReaderEntryPtr entry = file->entries[i];\n        if (entry->inode != inode ||\n            entry->fd == -1)\n            continue;\n\n        ret = lseek(entry->fd, offset, SEEK_SET);\n        if (ret == (off_t)-1) {\n            virReportSystemError(errno,\n                                 _(\"Unable to seek to inode %llu offset %llu\"),\n                                 (unsigned long long)inode, (unsigned long long)offset);\n            return -1;\n        }\n\n        file->current = i;\n        return 0;\n    }\n\n    file->current = 0;\n    ret = lseek(file->entries[0]->fd, offset, SEEK_SET);\n    if (ret == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to seek to inode %llu offset %llu\"),\n                             (unsigned long long)inode, (unsigned long long)offset);\n        return -1;\n    }\n    return 0;\n}"
  },
  {
    "function_name": "virRotatingFileWriterAppend",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "427-495",
    "snippet": "ssize_t\nvirRotatingFileWriterAppend(virRotatingFileWriterPtr file,\n                            const char *buf,\n                            size_t len)\n{\n    ssize_t ret = 0;\n    size_t i;\n    while (len) {\n        size_t towrite = len;\n        bool forceRollover = false;\n\n        if (file->entry->pos > file->maxlen) {\n            /* If existing file is for some reason larger then max length we\n             * won't write to this file anymore, but we rollover this file.*/\n            forceRollover = true;\n            towrite = 0;\n        } else if ((file->entry->pos + towrite) > file->maxlen) {\n            towrite = file->maxlen - file->entry->pos;\n\n            /*\n             * If there's a newline in the last 80 chars\n             * we're about to write, then break at that\n             * point to avoid splitting lines across\n             * separate files\n             */\n            for (i = 0; i < towrite && i < 80; i++) {\n                if (buf[towrite - i - 1] == '\\n') {\n                    towrite -= i;\n                    forceRollover = true;\n                    break;\n                }\n            }\n        }\n\n        if (towrite) {\n            if (safewrite(file->entry->fd, buf, towrite) != towrite) {\n                virReportSystemError(errno,\n                                     _(\"Unable to write to file %s\"),\n                                     file->basepath);\n                return -1;\n            }\n\n            len -= towrite;\n            buf += towrite;\n            ret += towrite;\n            file->entry->pos += towrite;\n            file->entry->len += towrite;\n        }\n\n        if ((file->entry->pos == file->maxlen && len) ||\n            forceRollover) {\n            virRotatingFileWriterEntryPtr tmp;\n            VIR_DEBUG(\"Hit max size %zu on %s (force=%d)\",\n                      file->maxlen, file->basepath, forceRollover);\n\n            if (virRotatingFileWriterRollover(file) < 0)\n                return -1;\n\n            if (!(tmp = virRotatingFileWriterEntryNew(file->basepath,\n                                                      file->mode)))\n                return -1;\n\n            virRotatingFileWriterEntryFree(file->entry);\n            file->entry = tmp;\n        }\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virRotatingFileWriterEntryFree",
          "args": [
            "file->entry"
          ],
          "line": 489
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterEntryFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "76-84",
          "snippet": "static void\nvirRotatingFileWriterEntryFree(virRotatingFileWriterEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic void\nvirRotatingFileWriterEntryFree(virRotatingFileWriterEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterEntryNew",
          "args": [
            "file->basepath",
            "file->mode"
          ],
          "line": 485
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterEntryNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "99-140",
          "snippet": "static virRotatingFileWriterEntryPtr\nvirRotatingFileWriterEntryNew(const char *path,\n                              mode_t mode)\n{\n    virRotatingFileWriterEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s mode=0%02o\", path, mode);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_CREAT|O_APPEND|O_WRONLY|O_CLOEXEC, mode)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open file: %s\"), path);\n        goto error;\n    }\n\n    entry->pos = lseek(entry->fd, 0, SEEK_END);\n    if (entry->pos == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file offset: %s\"),\n                             path);\n        goto error;\n    }\n\n    if (fstat(entry->fd, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file inode: %s\"),\n                             path);\n        goto error;\n    }\n\n    entry->len = sb.st_size;\n    entry->inode = sb.st_ino;\n\n    return entry;\n\n error:\n    virRotatingFileWriterEntryFree(entry);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virRotatingFileWriterEntryPtr\nvirRotatingFileWriterEntryNew(const char *path,\n                              mode_t mode)\n{\n    virRotatingFileWriterEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s mode=0%02o\", path, mode);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_CREAT|O_APPEND|O_WRONLY|O_CLOEXEC, mode)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open file: %s\"), path);\n        goto error;\n    }\n\n    entry->pos = lseek(entry->fd, 0, SEEK_END);\n    if (entry->pos == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file offset: %s\"),\n                             path);\n        goto error;\n    }\n\n    if (fstat(entry->fd, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file inode: %s\"),\n                             path);\n        goto error;\n    }\n\n    entry->len = sb.st_size;\n    entry->inode = sb.st_ino;\n\n    return entry;\n\n error:\n    virRotatingFileWriterEntryFree(entry);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterRollover",
          "args": [
            "file"
          ],
          "line": 482
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterRollover",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "365-413",
          "snippet": "static int\nvirRotatingFileWriterRollover(virRotatingFileWriterPtr file)\n{\n    size_t i;\n    char *nextpath = NULL;\n    char *thispath = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Rollover %s\", file->basepath);\n    if (file->maxbackup == 0) {\n        if (unlink(file->basepath) < 0 &&\n            errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to remove %s\"),\n                                 file->basepath);\n            goto cleanup;\n        }\n    } else {\n        nextpath = g_strdup_printf(\"%s.%zu\", file->basepath, file->maxbackup - 1);\n\n        for (i = file->maxbackup; i > 0; i--) {\n            if (i == 1) {\n                thispath = g_strdup(file->basepath);\n            } else {\n                thispath = g_strdup_printf(\"%s.%zu\", file->basepath, i - 2);\n            }\n            VIR_DEBUG(\"Rollover %s -> %s\", thispath, nextpath);\n\n            if (rename(thispath, nextpath) < 0 &&\n                errno != ENOENT) {\n                virReportSystemError(errno,\n                                     _(\"Unable to rename %s to %s\"),\n                                     thispath, nextpath);\n                goto cleanup;\n            }\n\n            VIR_FREE(nextpath);\n            nextpath = g_steal_pointer(&thispath);\n        }\n    }\n\n    VIR_DEBUG(\"Rollover done %s\", file->basepath);\n\n    ret = 0;\n cleanup:\n    VIR_FREE(nextpath);\n    VIR_FREE(thispath);\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirRotatingFileWriterRollover(virRotatingFileWriterPtr file)\n{\n    size_t i;\n    char *nextpath = NULL;\n    char *thispath = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Rollover %s\", file->basepath);\n    if (file->maxbackup == 0) {\n        if (unlink(file->basepath) < 0 &&\n            errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to remove %s\"),\n                                 file->basepath);\n            goto cleanup;\n        }\n    } else {\n        nextpath = g_strdup_printf(\"%s.%zu\", file->basepath, file->maxbackup - 1);\n\n        for (i = file->maxbackup; i > 0; i--) {\n            if (i == 1) {\n                thispath = g_strdup(file->basepath);\n            } else {\n                thispath = g_strdup_printf(\"%s.%zu\", file->basepath, i - 2);\n            }\n            VIR_DEBUG(\"Rollover %s -> %s\", thispath, nextpath);\n\n            if (rename(thispath, nextpath) < 0 &&\n                errno != ENOENT) {\n                virReportSystemError(errno,\n                                     _(\"Unable to rename %s to %s\"),\n                                     thispath, nextpath);\n                goto cleanup;\n            }\n\n            VIR_FREE(nextpath);\n            nextpath = g_steal_pointer(&thispath);\n        }\n    }\n\n    VIR_DEBUG(\"Rollover done %s\", file->basepath);\n\n    ret = 0;\n cleanup:\n    VIR_FREE(nextpath);\n    VIR_FREE(thispath);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Hit max size %zu on %s (force=%d)\"",
            "file->maxlen",
            "file->basepath",
            "forceRollover"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to write to file %s\")",
            "file->basepath"
          ],
          "line": 463
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to write to file %s\""
          ],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "safewrite",
          "args": [
            "file->entry->fd",
            "buf",
            "towrite"
          ],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "safewrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1093-1111",
          "snippet": "ssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nssize_t\nvirRotatingFileWriterAppend(virRotatingFileWriterPtr file,\n                            const char *buf,\n                            size_t len)\n{\n    ssize_t ret = 0;\n    size_t i;\n    while (len) {\n        size_t towrite = len;\n        bool forceRollover = false;\n\n        if (file->entry->pos > file->maxlen) {\n            /* If existing file is for some reason larger then max length we\n             * won't write to this file anymore, but we rollover this file.*/\n            forceRollover = true;\n            towrite = 0;\n        } else if ((file->entry->pos + towrite) > file->maxlen) {\n            towrite = file->maxlen - file->entry->pos;\n\n            /*\n             * If there's a newline in the last 80 chars\n             * we're about to write, then break at that\n             * point to avoid splitting lines across\n             * separate files\n             */\n            for (i = 0; i < towrite && i < 80; i++) {\n                if (buf[towrite - i - 1] == '\\n') {\n                    towrite -= i;\n                    forceRollover = true;\n                    break;\n                }\n            }\n        }\n\n        if (towrite) {\n            if (safewrite(file->entry->fd, buf, towrite) != towrite) {\n                virReportSystemError(errno,\n                                     _(\"Unable to write to file %s\"),\n                                     file->basepath);\n                return -1;\n            }\n\n            len -= towrite;\n            buf += towrite;\n            ret += towrite;\n            file->entry->pos += towrite;\n            file->entry->len += towrite;\n        }\n\n        if ((file->entry->pos == file->maxlen && len) ||\n            forceRollover) {\n            virRotatingFileWriterEntryPtr tmp;\n            VIR_DEBUG(\"Hit max size %zu on %s (force=%d)\",\n                      file->maxlen, file->basepath, forceRollover);\n\n            if (virRotatingFileWriterRollover(file) < 0)\n                return -1;\n\n            if (!(tmp = virRotatingFileWriterEntryNew(file->basepath,\n                                                      file->mode)))\n                return -1;\n\n            virRotatingFileWriterEntryFree(file->entry);\n            file->entry = tmp;\n        }\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "virRotatingFileWriterRollover",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "365-413",
    "snippet": "static int\nvirRotatingFileWriterRollover(virRotatingFileWriterPtr file)\n{\n    size_t i;\n    char *nextpath = NULL;\n    char *thispath = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Rollover %s\", file->basepath);\n    if (file->maxbackup == 0) {\n        if (unlink(file->basepath) < 0 &&\n            errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to remove %s\"),\n                                 file->basepath);\n            goto cleanup;\n        }\n    } else {\n        nextpath = g_strdup_printf(\"%s.%zu\", file->basepath, file->maxbackup - 1);\n\n        for (i = file->maxbackup; i > 0; i--) {\n            if (i == 1) {\n                thispath = g_strdup(file->basepath);\n            } else {\n                thispath = g_strdup_printf(\"%s.%zu\", file->basepath, i - 2);\n            }\n            VIR_DEBUG(\"Rollover %s -> %s\", thispath, nextpath);\n\n            if (rename(thispath, nextpath) < 0 &&\n                errno != ENOENT) {\n                virReportSystemError(errno,\n                                     _(\"Unable to rename %s to %s\"),\n                                     thispath, nextpath);\n                goto cleanup;\n            }\n\n            VIR_FREE(nextpath);\n            nextpath = g_steal_pointer(&thispath);\n        }\n    }\n\n    VIR_DEBUG(\"Rollover done %s\", file->basepath);\n\n    ret = 0;\n cleanup:\n    VIR_FREE(nextpath);\n    VIR_FREE(thispath);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "thispath"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "nextpath"
          ],
          "line": 410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Rollover done %s\"",
            "file->basepath"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&thispath"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "nextpath"
          ],
          "line": 401
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to rename %s to %s\")",
            "thispath",
            "nextpath"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to rename %s to %s\""
          ],
          "line": 396
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "thispath",
            "nextpath"
          ],
          "line": 393
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Rollover %s -> %s\"",
            "thispath",
            "nextpath"
          ],
          "line": 391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to remove %s\")",
            "file->basepath"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "file->basepath"
          ],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Rollover %s\"",
            "file->basepath"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirRotatingFileWriterRollover(virRotatingFileWriterPtr file)\n{\n    size_t i;\n    char *nextpath = NULL;\n    char *thispath = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Rollover %s\", file->basepath);\n    if (file->maxbackup == 0) {\n        if (unlink(file->basepath) < 0 &&\n            errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to remove %s\"),\n                                 file->basepath);\n            goto cleanup;\n        }\n    } else {\n        nextpath = g_strdup_printf(\"%s.%zu\", file->basepath, file->maxbackup - 1);\n\n        for (i = file->maxbackup; i > 0; i--) {\n            if (i == 1) {\n                thispath = g_strdup(file->basepath);\n            } else {\n                thispath = g_strdup_printf(\"%s.%zu\", file->basepath, i - 2);\n            }\n            VIR_DEBUG(\"Rollover %s -> %s\", thispath, nextpath);\n\n            if (rename(thispath, nextpath) < 0 &&\n                errno != ENOENT) {\n                virReportSystemError(errno,\n                                     _(\"Unable to rename %s to %s\"),\n                                     thispath, nextpath);\n                goto cleanup;\n            }\n\n            VIR_FREE(nextpath);\n            nextpath = g_steal_pointer(&thispath);\n        }\n    }\n\n    VIR_DEBUG(\"Rollover done %s\", file->basepath);\n\n    ret = 0;\n cleanup:\n    VIR_FREE(nextpath);\n    VIR_FREE(thispath);\n    return ret;\n}"
  },
  {
    "function_name": "virRotatingFileWriterGetOffset",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "358-362",
    "snippet": "off_t\nvirRotatingFileWriterGetOffset(virRotatingFileWriterPtr file)\n{\n    return file->entry->pos;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\noff_t\nvirRotatingFileWriterGetOffset(virRotatingFileWriterPtr file)\n{\n    return file->entry->pos;\n}"
  },
  {
    "function_name": "virRotatingFileWriterGetINode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "345-349",
    "snippet": "ino_t\nvirRotatingFileWriterGetINode(virRotatingFileWriterPtr file)\n{\n    return file->entry->inode;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nino_t\nvirRotatingFileWriterGetINode(virRotatingFileWriterPtr file)\n{\n    return file->entry->inode;\n}"
  },
  {
    "function_name": "virRotatingFileWriterGetPath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "332-336",
    "snippet": "const char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nconst char *\nvirRotatingFileWriterGetPath(virRotatingFileWriterPtr file)\n{\n    return file->basepath;\n}"
  },
  {
    "function_name": "virRotatingFileReaderNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "284-323",
    "snippet": "virRotatingFileReaderPtr\nvirRotatingFileReaderNew(const char *path,\n                         size_t maxbackup)\n{\n    virRotatingFileReaderPtr file;\n    size_t i;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->nentries = maxbackup + 1;\n    if (VIR_ALLOC_N(file->entries, file->nentries) < 0)\n        goto error;\n\n    if (!(file->entries[file->nentries - 1] = virRotatingFileReaderEntryNew(path)))\n        goto error;\n\n    for (i = 0; i < maxbackup; i++) {\n        char *tmppath;\n        tmppath = g_strdup_printf(\"%s.%zu\", path, i);\n\n        file->entries[file->nentries - (i + 2)] = virRotatingFileReaderEntryNew(tmppath);\n        VIR_FREE(tmppath);\n        if (!file->entries[file->nentries - (i + 2)])\n            goto error;\n    }\n\n    return file;\n\n error:\n    virRotatingFileReaderFree(file);\n    return NULL;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIR_MAX_MAX_BACKUP 32"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virRotatingFileReaderFree",
          "args": [
            "file"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileReaderFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "625-637",
          "snippet": "void\nvirRotatingFileReaderFree(virRotatingFileReaderPtr file)\n{\n    size_t i;\n\n    if (!file)\n        return;\n\n    for (i = 0; i < file->nentries; i++)\n        virRotatingFileReaderEntryFree(file->entries[i]);\n    VIR_FREE(file->entries);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirRotatingFileReaderFree(virRotatingFileReaderPtr file)\n{\n    size_t i;\n\n    if (!file)\n        return;\n\n    for (i = 0; i < file->nentries; i++)\n        virRotatingFileReaderEntryFree(file->entries[i]);\n    VIR_FREE(file->entries);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmppath"
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virRotatingFileReaderEntryNew",
          "args": [
            "tmppath"
          ],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileReaderEntryNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "143-180",
          "snippet": "static virRotatingFileReaderEntryPtr\nvirRotatingFileReaderEntryNew(const char *path)\n{\n    virRotatingFileReaderEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s\", path);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_RDONLY|O_CLOEXEC)) < 0) {\n        if (errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open file: %s\"), path);\n            goto error;\n        }\n    }\n\n    if (entry->fd != -1) {\n        if (fstat(entry->fd, &sb) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to determine current file inode: %s\"),\n                                 path);\n            goto error;\n        }\n\n        entry->inode = sb.st_ino;\n    }\n\n    entry->path = g_strdup(path);\n\n    return entry;\n\n error:\n    virRotatingFileReaderEntryFree(entry);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virRotatingFileReaderEntryPtr\nvirRotatingFileReaderEntryNew(const char *path)\n{\n    virRotatingFileReaderEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s\", path);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_RDONLY|O_CLOEXEC)) < 0) {\n        if (errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open file: %s\"), path);\n            goto error;\n        }\n    }\n\n    if (entry->fd != -1) {\n        if (fstat(entry->fd, &sb) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to determine current file inode: %s\"),\n                                 path);\n            goto error;\n        }\n\n        entry->inode = sb.st_ino;\n    }\n\n    entry->path = g_strdup(path);\n\n    return entry;\n\n error:\n    virRotatingFileReaderEntryFree(entry);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s.%zu\"",
            "path",
            "i"
          ],
          "line": 310
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "file->entries",
            "file->nentries"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Max backup %zu must be less than or equal to %d\")",
            "maxbackup",
            "VIR_MAX_MAX_BACKUP"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "file"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_MAX_MAX_BACKUP 32\n\nvirRotatingFileReaderPtr\nvirRotatingFileReaderNew(const char *path,\n                         size_t maxbackup)\n{\n    virRotatingFileReaderPtr file;\n    size_t i;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->nentries = maxbackup + 1;\n    if (VIR_ALLOC_N(file->entries, file->nentries) < 0)\n        goto error;\n\n    if (!(file->entries[file->nentries - 1] = virRotatingFileReaderEntryNew(path)))\n        goto error;\n\n    for (i = 0; i < maxbackup; i++) {\n        char *tmppath;\n        tmppath = g_strdup_printf(\"%s.%zu\", path, i);\n\n        file->entries[file->nentries - (i + 2)] = virRotatingFileReaderEntryNew(tmppath);\n        VIR_FREE(tmppath);\n        if (!file->entries[file->nentries - (i + 2)])\n            goto error;\n    }\n\n    return file;\n\n error:\n    virRotatingFileReaderFree(file);\n    return NULL;\n}"
  },
  {
    "function_name": "virRotatingFileWriterNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "232-270",
    "snippet": "virRotatingFileWriterPtr\nvirRotatingFileWriterNew(const char *path,\n                         off_t maxlen,\n                         size_t maxbackup,\n                         bool trunc,\n                         mode_t mode)\n{\n    virRotatingFileWriterPtr file;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->basepath = g_strdup(path);\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->mode = mode;\n    file->maxbackup = maxbackup;\n    file->maxlen = maxlen;\n\n    if (trunc &&\n        virRotatingFileWriterDelete(file) < 0)\n        goto error;\n\n    if (!(file->entry = virRotatingFileWriterEntryNew(file->basepath,\n                                                      mode)))\n        goto error;\n\n    return file;\n\n error:\n    virRotatingFileWriterFree(file);\n    return NULL;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIR_MAX_MAX_BACKUP 32"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virRotatingFileWriterFree",
          "args": [
            "file"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "607-616",
          "snippet": "void\nvirRotatingFileWriterFree(virRotatingFileWriterPtr file)\n{\n    if (!file)\n        return;\n\n    virRotatingFileWriterEntryFree(file->entry);\n    VIR_FREE(file->basepath);\n    VIR_FREE(file);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirRotatingFileWriterFree(virRotatingFileWriterPtr file)\n{\n    if (!file)\n        return;\n\n    virRotatingFileWriterEntryFree(file->entry);\n    VIR_FREE(file->basepath);\n    VIR_FREE(file);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterEntryNew",
          "args": [
            "file->basepath",
            "mode"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterEntryNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "99-140",
          "snippet": "static virRotatingFileWriterEntryPtr\nvirRotatingFileWriterEntryNew(const char *path,\n                              mode_t mode)\n{\n    virRotatingFileWriterEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s mode=0%02o\", path, mode);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_CREAT|O_APPEND|O_WRONLY|O_CLOEXEC, mode)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open file: %s\"), path);\n        goto error;\n    }\n\n    entry->pos = lseek(entry->fd, 0, SEEK_END);\n    if (entry->pos == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file offset: %s\"),\n                             path);\n        goto error;\n    }\n\n    if (fstat(entry->fd, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file inode: %s\"),\n                             path);\n        goto error;\n    }\n\n    entry->len = sb.st_size;\n    entry->inode = sb.st_ino;\n\n    return entry;\n\n error:\n    virRotatingFileWriterEntryFree(entry);\n    return NULL;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virRotatingFileWriterEntryPtr\nvirRotatingFileWriterEntryNew(const char *path,\n                              mode_t mode)\n{\n    virRotatingFileWriterEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s mode=0%02o\", path, mode);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_CREAT|O_APPEND|O_WRONLY|O_CLOEXEC, mode)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open file: %s\"), path);\n        goto error;\n    }\n\n    entry->pos = lseek(entry->fd, 0, SEEK_END);\n    if (entry->pos == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file offset: %s\"),\n                             path);\n        goto error;\n    }\n\n    if (fstat(entry->fd, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file inode: %s\"),\n                             path);\n        goto error;\n    }\n\n    entry->len = sb.st_size;\n    entry->inode = sb.st_ino;\n\n    return entry;\n\n error:\n    virRotatingFileWriterEntryFree(entry);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRotatingFileWriterDelete",
          "args": [
            "file"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterDelete",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "183-212",
          "snippet": "static int\nvirRotatingFileWriterDelete(virRotatingFileWriterPtr file)\n{\n    size_t i;\n\n    if (unlink(file->basepath) < 0 &&\n        errno != ENOENT) {\n        virReportSystemError(errno,\n                             _(\"Unable to delete file %s\"),\n                             file->basepath);\n        return -1;\n    }\n\n    for (i = 0; i < file->maxbackup; i++) {\n        char *oldpath;\n        oldpath = g_strdup_printf(\"%s.%zu\", file->basepath, i);\n\n        if (unlink(oldpath) < 0 &&\n            errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to delete file %s\"),\n                                 oldpath);\n            VIR_FREE(oldpath);\n            return -1;\n        }\n        VIR_FREE(oldpath);\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirRotatingFileWriterDelete(virRotatingFileWriterPtr file)\n{\n    size_t i;\n\n    if (unlink(file->basepath) < 0 &&\n        errno != ENOENT) {\n        virReportSystemError(errno,\n                             _(\"Unable to delete file %s\"),\n                             file->basepath);\n        return -1;\n    }\n\n    for (i = 0; i < file->maxbackup; i++) {\n        char *oldpath;\n        oldpath = g_strdup_printf(\"%s.%zu\", file->basepath, i);\n\n        if (unlink(oldpath) < 0 &&\n            errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to delete file %s\"),\n                                 oldpath);\n            VIR_FREE(oldpath);\n            return -1;\n        }\n        VIR_FREE(oldpath);\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Max backup %zu must be less than or equal to %d\")",
            "maxbackup",
            "VIR_MAX_MAX_BACKUP"
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Max backup %zu must be less than or equal to %d\""
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "file"
          ],
          "line": 241
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_MAX_MAX_BACKUP 32\n\nvirRotatingFileWriterPtr\nvirRotatingFileWriterNew(const char *path,\n                         off_t maxlen,\n                         size_t maxbackup,\n                         bool trunc,\n                         mode_t mode)\n{\n    virRotatingFileWriterPtr file;\n\n    if (VIR_ALLOC(file) < 0)\n        goto error;\n\n    file->basepath = g_strdup(path);\n\n    if (maxbackup > VIR_MAX_MAX_BACKUP) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Max backup %zu must be less than or equal to %d\"),\n                       maxbackup, VIR_MAX_MAX_BACKUP);\n        goto error;\n    }\n\n    file->mode = mode;\n    file->maxbackup = maxbackup;\n    file->maxlen = maxlen;\n\n    if (trunc &&\n        virRotatingFileWriterDelete(file) < 0)\n        goto error;\n\n    if (!(file->entry = virRotatingFileWriterEntryNew(file->basepath,\n                                                      mode)))\n        goto error;\n\n    return file;\n\n error:\n    virRotatingFileWriterFree(file);\n    return NULL;\n}"
  },
  {
    "function_name": "virRotatingFileWriterDelete",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "183-212",
    "snippet": "static int\nvirRotatingFileWriterDelete(virRotatingFileWriterPtr file)\n{\n    size_t i;\n\n    if (unlink(file->basepath) < 0 &&\n        errno != ENOENT) {\n        virReportSystemError(errno,\n                             _(\"Unable to delete file %s\"),\n                             file->basepath);\n        return -1;\n    }\n\n    for (i = 0; i < file->maxbackup; i++) {\n        char *oldpath;\n        oldpath = g_strdup_printf(\"%s.%zu\", file->basepath, i);\n\n        if (unlink(oldpath) < 0 &&\n            errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to delete file %s\"),\n                                 oldpath);\n            VIR_FREE(oldpath);\n            return -1;\n        }\n        VIR_FREE(oldpath);\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "oldpath"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "oldpath"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to delete file %s\")",
            "oldpath"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to delete file %s\""
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "oldpath"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to delete file %s\")",
            "file->basepath"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "file->basepath"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirRotatingFileWriterDelete(virRotatingFileWriterPtr file)\n{\n    size_t i;\n\n    if (unlink(file->basepath) < 0 &&\n        errno != ENOENT) {\n        virReportSystemError(errno,\n                             _(\"Unable to delete file %s\"),\n                             file->basepath);\n        return -1;\n    }\n\n    for (i = 0; i < file->maxbackup; i++) {\n        char *oldpath;\n        oldpath = g_strdup_printf(\"%s.%zu\", file->basepath, i);\n\n        if (unlink(oldpath) < 0 &&\n            errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to delete file %s\"),\n                                 oldpath);\n            VIR_FREE(oldpath);\n            return -1;\n        }\n        VIR_FREE(oldpath);\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virRotatingFileReaderEntryNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "143-180",
    "snippet": "static virRotatingFileReaderEntryPtr\nvirRotatingFileReaderEntryNew(const char *path)\n{\n    virRotatingFileReaderEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s\", path);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_RDONLY|O_CLOEXEC)) < 0) {\n        if (errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open file: %s\"), path);\n            goto error;\n        }\n    }\n\n    if (entry->fd != -1) {\n        if (fstat(entry->fd, &sb) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to determine current file inode: %s\"),\n                                 path);\n            goto error;\n        }\n\n        entry->inode = sb.st_ino;\n    }\n\n    entry->path = g_strdup(path);\n\n    return entry;\n\n error:\n    virRotatingFileReaderEntryFree(entry);\n    return NULL;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virRotatingFileReaderEntryFree",
          "args": [
            "entry"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileReaderEntryFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "87-96",
          "snippet": "static void\nvirRotatingFileReaderEntryFree(virRotatingFileReaderEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FREE(entry->path);\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic void\nvirRotatingFileReaderEntryFree(virRotatingFileReaderEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FREE(entry->path);\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "path"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to determine current file inode: %s\")",
            "path"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "entry->fd",
            "&sb"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to open file: %s\")",
            "path"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "path",
            "O_RDONLY|O_CLOEXEC"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "entry"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Opening %s\"",
            "path"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virRotatingFileReaderEntryPtr\nvirRotatingFileReaderEntryNew(const char *path)\n{\n    virRotatingFileReaderEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s\", path);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_RDONLY|O_CLOEXEC)) < 0) {\n        if (errno != ENOENT) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open file: %s\"), path);\n            goto error;\n        }\n    }\n\n    if (entry->fd != -1) {\n        if (fstat(entry->fd, &sb) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to determine current file inode: %s\"),\n                                 path);\n            goto error;\n        }\n\n        entry->inode = sb.st_ino;\n    }\n\n    entry->path = g_strdup(path);\n\n    return entry;\n\n error:\n    virRotatingFileReaderEntryFree(entry);\n    return NULL;\n}"
  },
  {
    "function_name": "virRotatingFileWriterEntryNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "99-140",
    "snippet": "static virRotatingFileWriterEntryPtr\nvirRotatingFileWriterEntryNew(const char *path,\n                              mode_t mode)\n{\n    virRotatingFileWriterEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s mode=0%02o\", path, mode);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_CREAT|O_APPEND|O_WRONLY|O_CLOEXEC, mode)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open file: %s\"), path);\n        goto error;\n    }\n\n    entry->pos = lseek(entry->fd, 0, SEEK_END);\n    if (entry->pos == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file offset: %s\"),\n                             path);\n        goto error;\n    }\n\n    if (fstat(entry->fd, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file inode: %s\"),\n                             path);\n        goto error;\n    }\n\n    entry->len = sb.st_size;\n    entry->inode = sb.st_ino;\n\n    return entry;\n\n error:\n    virRotatingFileWriterEntryFree(entry);\n    return NULL;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virRotatingFileWriterEntryFree",
          "args": [
            "entry"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "virRotatingFileWriterEntryFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
          "lines": "76-84",
          "snippet": "static void\nvirRotatingFileWriterEntryFree(virRotatingFileWriterEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virrotatingfile.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic void\nvirRotatingFileWriterEntryFree(virRotatingFileWriterEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to determine current file inode: %s\")",
            "path"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to determine current file inode: %s\""
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "entry->fd",
            "&sb"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to determine current file offset: %s\")",
            "path"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lseek",
          "args": [
            "entry->fd",
            "0",
            "SEEK_END"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to open file: %s\")",
            "path"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "path",
            "O_CREAT|O_APPEND|O_WRONLY|O_CLOEXEC",
            "mode"
          ],
          "line": 111
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockReopenReadOnly",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "3308-3323",
          "snippet": "int\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nint\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "entry"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Opening %s mode=0%02o\"",
            "path",
            "mode"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virRotatingFileWriterEntryPtr\nvirRotatingFileWriterEntryNew(const char *path,\n                              mode_t mode)\n{\n    virRotatingFileWriterEntryPtr entry;\n    struct stat sb;\n\n    VIR_DEBUG(\"Opening %s mode=0%02o\", path, mode);\n\n    if (VIR_ALLOC(entry) < 0)\n        return NULL;\n\n    if ((entry->fd = open(path, O_CREAT|O_APPEND|O_WRONLY|O_CLOEXEC, mode)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open file: %s\"), path);\n        goto error;\n    }\n\n    entry->pos = lseek(entry->fd, 0, SEEK_END);\n    if (entry->pos == (off_t)-1) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file offset: %s\"),\n                             path);\n        goto error;\n    }\n\n    if (fstat(entry->fd, &sb) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to determine current file inode: %s\"),\n                             path);\n        goto error;\n    }\n\n    entry->len = sb.st_size;\n    entry->inode = sb.st_ino;\n\n    return entry;\n\n error:\n    virRotatingFileWriterEntryFree(entry);\n    return NULL;\n}"
  },
  {
    "function_name": "virRotatingFileReaderEntryFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "87-96",
    "snippet": "static void\nvirRotatingFileReaderEntryFree(virRotatingFileReaderEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FREE(entry->path);\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "entry"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "entry->fd"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "entry->path"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic void\nvirRotatingFileReaderEntryFree(virRotatingFileReaderEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FREE(entry->path);\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}"
  },
  {
    "function_name": "virRotatingFileWriterEntryFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virrotatingfile.c",
    "lines": "76-84",
    "snippet": "static void\nvirRotatingFileWriterEntryFree(virRotatingFileWriterEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virrotatingfile.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "entry"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "entry->fd"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virrotatingfile.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic void\nvirRotatingFileWriterEntryFree(virRotatingFileWriterEntryPtr entry)\n{\n    if (!entry)\n        return;\n\n    VIR_FORCE_CLOSE(entry->fd);\n    VIR_FREE(entry);\n}"
  }
]