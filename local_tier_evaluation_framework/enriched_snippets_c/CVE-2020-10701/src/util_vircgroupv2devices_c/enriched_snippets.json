[
  {
    "function_name": "virCgroupV2DevicesGetKey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "638-643",
    "snippet": "uint64_t\nvirCgroupV2DevicesGetKey(int major,\n                         int minor)\n{\n    return (uint64_t)major << 32 | ((uint64_t)minor & 0x00000000ffffffff);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nuint64_t\nvirCgroupV2DevicesGetKey(int major,\n                         int minor)\n{\n    return (uint64_t)major << 32 | ((uint64_t)minor & 0x00000000ffffffff);\n}"
  },
  {
    "function_name": "virCgroupV2DevicesGetPerms",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "629-634",
    "snippet": "uint32_t\nvirCgroupV2DevicesGetPerms(int perms G_GNUC_UNUSED,\n                           char type G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nuint32_t\nvirCgroupV2DevicesGetPerms(int perms G_GNUC_UNUSED,\n                           char type G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesRemoveProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "622-626",
    "snippet": "int\nvirCgroupV2DevicesRemoveProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesRemoveProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesPrepareProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "612-619",
    "snippet": "int\nvirCgroupV2DevicesPrepareProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENOSYS",
            "\"%s\"",
            "_(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\")"
          ],
          "line": 615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\""
          ],
          "line": 616
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesPrepareProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesCreateProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "602-609",
    "snippet": "int\nvirCgroupV2DevicesCreateProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENOSYS",
            "\"%s\"",
            "_(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\")"
          ],
          "line": 605
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\""
          ],
          "line": 606
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesCreateProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesDetectProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "592-599",
    "snippet": "int\nvirCgroupV2DevicesDetectProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENOSYS",
            "\"%s\"",
            "_(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\")"
          ],
          "line": 595
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\""
          ],
          "line": 596
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesDetectProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesAvailable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "585-589",
    "snippet": "bool\nvirCgroupV2DevicesAvailable(virCgroupPtr group G_GNUC_UNUSED)\n{\n    return false;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nbool\nvirCgroupV2DevicesAvailable(virCgroupPtr group G_GNUC_UNUSED)\n{\n    return false;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesGetPerms",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "560-583",
    "snippet": "uint32_t\nvirCgroupV2DevicesGetPerms(int perms,\n                           char type)\n{\n    uint32_t ret = 0;\n\n    if (perms & VIR_CGROUP_DEVICE_MKNOD)\n        ret |= BPF_DEVCG_ACC_MKNOD << 16;\n\n    if (perms & VIR_CGROUP_DEVICE_READ)\n        ret |= BPF_DEVCG_ACC_READ << 16;\n\n    if (perms & VIR_CGROUP_DEVICE_WRITE)\n        ret |= BPF_DEVCG_ACC_WRITE << 16;\n\n    if (type == 'b')\n        ret |= BPF_DEVCG_DEV_BLOCK;\n    else if (type == 'c')\n        ret |= BPF_DEVCG_DEV_CHAR;\n    else\n        ret |= BPF_DEVCG_DEV_BLOCK | BPF_DEVCG_DEV_CHAR;\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nuint32_t\nvirCgroupV2DevicesGetPerms(int perms,\n                           char type)\n{\n    uint32_t ret = 0;\n\n    if (perms & VIR_CGROUP_DEVICE_MKNOD)\n        ret |= BPF_DEVCG_ACC_MKNOD << 16;\n\n    if (perms & VIR_CGROUP_DEVICE_READ)\n        ret |= BPF_DEVCG_ACC_READ << 16;\n\n    if (perms & VIR_CGROUP_DEVICE_WRITE)\n        ret |= BPF_DEVCG_ACC_WRITE << 16;\n\n    if (type == 'b')\n        ret |= BPF_DEVCG_DEV_BLOCK;\n    else if (type == 'c')\n        ret |= BPF_DEVCG_DEV_CHAR;\n    else\n        ret |= BPF_DEVCG_DEV_BLOCK | BPF_DEVCG_DEV_CHAR;\n\n    return ret;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesRemoveProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "541-557",
    "snippet": "int\nvirCgroupV2DevicesRemoveProg(virCgroupPtr group)\n{\n    if (virCgroupV2DevicesDetectProg(group) < 0)\n        return -1;\n\n    if (group->unified.devices.progfd <= 0 && group->unified.devices.mapfd <= 0)\n        return 0;\n\n    if (group->unified.devices.mapfd >= 0)\n        VIR_FORCE_CLOSE(group->unified.devices.mapfd);\n\n    if (group->unified.devices.progfd >= 0)\n        VIR_FORCE_CLOSE(group->unified.devices.progfd);\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "group->unified.devices.progfd"
          ],
          "line": 554
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "group->unified.devices.mapfd"
          ],
          "line": 551
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCgroupV2DevicesDetectProg",
          "args": [
            "group"
          ],
          "line": 544
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesDetectProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "592-599",
          "snippet": "int\nvirCgroupV2DevicesDetectProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesDetectProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesRemoveProg(virCgroupPtr group)\n{\n    if (virCgroupV2DevicesDetectProg(group) < 0)\n        return -1;\n\n    if (group->unified.devices.progfd <= 0 && group->unified.devices.mapfd <= 0)\n        return 0;\n\n    if (group->unified.devices.mapfd >= 0)\n        VIR_FORCE_CLOSE(group->unified.devices.mapfd);\n\n    if (group->unified.devices.progfd >= 0)\n        VIR_FORCE_CLOSE(group->unified.devices.progfd);\n\n    return 0;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesPrepareProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "516-538",
    "snippet": "int\nvirCgroupV2DevicesPrepareProg(virCgroupPtr group)\n{\n    if (virCgroupV2DevicesDetectProg(group) < 0)\n        return -1;\n\n    if (virCgroupV2DevicesCreateProg(group) < 0)\n        return -1;\n\n    if (group->unified.devices.count >= group->unified.devices.max) {\n        size_t max = group->unified.devices.max * 2;\n        int newmapfd = virCgroupV2DevicesReallocMap(group->unified.devices.mapfd,\n                                                    max);\n\n        if (newmapfd < 0)\n            return -1;\n\n        if (virCgroupV2DevicesAttachProg(group, newmapfd, max) < 0)\n            return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCgroupV2DevicesAttachProg",
          "args": [
            "group",
            "newmapfd",
            "max"
          ],
          "line": 533
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesAttachProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "277-329",
          "snippet": "static int\nvirCgroupV2DevicesAttachProg(virCgroupPtr group,\n                             int mapfd,\n                             size_t max)\n{\n    int ret = -1;\n    VIR_AUTOCLOSE progfd = -1;\n    VIR_AUTOCLOSE cgroupfd = -1;\n    g_autofree char *path = NULL;\n\n    if (virCgroupPathOfController(group, VIR_CGROUP_CONTROLLER_DEVICES,\n                                  NULL, &path) < 0) {\n        goto cleanup;\n    }\n\n    progfd = virCgroupV2DevicesLoadProg(mapfd);\n    if (progfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to load cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    cgroupfd = open(path, O_RDONLY);\n    if (cgroupfd < 0) {\n        virReportSystemError(errno, _(\"unable to open '%s'\"), path);\n        goto cleanup;\n    }\n\n    if (virBPFAttachProg(progfd, cgroupfd, BPF_CGROUP_DEVICE) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to attach cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    if (group->unified.devices.progfd > 0) {\n        VIR_DEBUG(\"Closing existing program that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.progfd);\n    }\n\n    if (group->unified.devices.mapfd > 0) {\n        VIR_DEBUG(\"Closing existing map that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.mapfd);\n    }\n\n    group->unified.devices.progfd = progfd;\n    group->unified.devices.mapfd = mapfd;\n    group->unified.devices.max = max;\n    progfd = -1;\n    mapfd = -1;\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(mapfd);\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesAttachProg(virCgroupPtr group,\n                             int mapfd,\n                             size_t max)\n{\n    int ret = -1;\n    VIR_AUTOCLOSE progfd = -1;\n    VIR_AUTOCLOSE cgroupfd = -1;\n    g_autofree char *path = NULL;\n\n    if (virCgroupPathOfController(group, VIR_CGROUP_CONTROLLER_DEVICES,\n                                  NULL, &path) < 0) {\n        goto cleanup;\n    }\n\n    progfd = virCgroupV2DevicesLoadProg(mapfd);\n    if (progfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to load cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    cgroupfd = open(path, O_RDONLY);\n    if (cgroupfd < 0) {\n        virReportSystemError(errno, _(\"unable to open '%s'\"), path);\n        goto cleanup;\n    }\n\n    if (virBPFAttachProg(progfd, cgroupfd, BPF_CGROUP_DEVICE) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to attach cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    if (group->unified.devices.progfd > 0) {\n        VIR_DEBUG(\"Closing existing program that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.progfd);\n    }\n\n    if (group->unified.devices.mapfd > 0) {\n        VIR_DEBUG(\"Closing existing map that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.mapfd);\n    }\n\n    group->unified.devices.progfd = progfd;\n    group->unified.devices.mapfd = mapfd;\n    group->unified.devices.max = max;\n    progfd = -1;\n    mapfd = -1;\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(mapfd);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupV2DevicesReallocMap",
          "args": [
            "group->unified.devices.mapfd",
            "max"
          ],
          "line": 527
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesReallocMap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "454-496",
          "snippet": "static int\nvirCgroupV2DevicesReallocMap(int mapfd,\n                             size_t size)\n{\n    uint64_t key = 0;\n    uint64_t prevKey = 0;\n    int rc;\n    int ret = -1;\n    VIR_AUTOCLOSE newmapfd = virCgroupV2DevicesCreateMap(size);\n\n    VIR_DEBUG(\"realloc devices map mapfd:%d, size:%zu\", mapfd, size);\n\n    if (newmapfd < 0)\n        return -1;\n\n    while ((rc = virBPFGetNextElem(mapfd, &prevKey, &key)) == 0) {\n        uint32_t val = 0;\n\n        if (virBPFLookupElem(mapfd, &key, &val) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to lookup device in old map\"));\n            return -1;\n        }\n\n        if (virBPFUpdateElem(newmapfd, &key, &val) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to add device into new map\"));\n            return -1;\n        }\n\n        prevKey = key;\n    }\n\n    if (rc < 0 && errno != ENOENT) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to copy all device rules\"));\n        return -1;\n    }\n\n    ret = newmapfd;\n    newmapfd = -1;\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesReallocMap(int mapfd,\n                             size_t size)\n{\n    uint64_t key = 0;\n    uint64_t prevKey = 0;\n    int rc;\n    int ret = -1;\n    VIR_AUTOCLOSE newmapfd = virCgroupV2DevicesCreateMap(size);\n\n    VIR_DEBUG(\"realloc devices map mapfd:%d, size:%zu\", mapfd, size);\n\n    if (newmapfd < 0)\n        return -1;\n\n    while ((rc = virBPFGetNextElem(mapfd, &prevKey, &key)) == 0) {\n        uint32_t val = 0;\n\n        if (virBPFLookupElem(mapfd, &key, &val) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to lookup device in old map\"));\n            return -1;\n        }\n\n        if (virBPFUpdateElem(newmapfd, &key, &val) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to add device into new map\"));\n            return -1;\n        }\n\n        prevKey = key;\n    }\n\n    if (rc < 0 && errno != ENOENT) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to copy all device rules\"));\n        return -1;\n    }\n\n    ret = newmapfd;\n    newmapfd = -1;\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupV2DevicesCreateProg",
          "args": [
            "group"
          ],
          "line": 522
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesCreateProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "602-609",
          "snippet": "int\nvirCgroupV2DevicesCreateProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesCreateProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupV2DevicesDetectProg",
          "args": [
            "group"
          ],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesDetectProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "592-599",
          "snippet": "int\nvirCgroupV2DevicesDetectProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesDetectProg(virCgroupPtr group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"cgroups v2 BPF devices not supported \"\n                           \"with this kernel\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesPrepareProg(virCgroupPtr group)\n{\n    if (virCgroupV2DevicesDetectProg(group) < 0)\n        return -1;\n\n    if (virCgroupV2DevicesCreateProg(group) < 0)\n        return -1;\n\n    if (group->unified.devices.count >= group->unified.devices.max) {\n        size_t max = group->unified.devices.max * 2;\n        int newmapfd = virCgroupV2DevicesReallocMap(group->unified.devices.mapfd,\n                                                    max);\n\n        if (newmapfd < 0)\n            return -1;\n\n        if (virCgroupV2DevicesAttachProg(group, newmapfd, max) < 0)\n            return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesCreateProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "499-513",
    "snippet": "int\nvirCgroupV2DevicesCreateProg(virCgroupPtr group)\n{\n    int mapfd = -1;\n\n    if (group->unified.devices.progfd > 0 && group->unified.devices.mapfd > 0)\n        return 0;\n\n    mapfd = virCgroupV2DevicesCreateMap(VIR_CGROUP_V2_INITIAL_BPF_MAP_SIZE);\n    if (mapfd < 0)\n        return -1;\n\n    return virCgroupV2DevicesAttachProg(group, mapfd,\n                                        VIR_CGROUP_V2_INITIAL_BPF_MAP_SIZE);\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCgroupV2DevicesAttachProg",
          "args": [
            "group",
            "mapfd",
            "VIR_CGROUP_V2_INITIAL_BPF_MAP_SIZE"
          ],
          "line": 511
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesAttachProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "277-329",
          "snippet": "static int\nvirCgroupV2DevicesAttachProg(virCgroupPtr group,\n                             int mapfd,\n                             size_t max)\n{\n    int ret = -1;\n    VIR_AUTOCLOSE progfd = -1;\n    VIR_AUTOCLOSE cgroupfd = -1;\n    g_autofree char *path = NULL;\n\n    if (virCgroupPathOfController(group, VIR_CGROUP_CONTROLLER_DEVICES,\n                                  NULL, &path) < 0) {\n        goto cleanup;\n    }\n\n    progfd = virCgroupV2DevicesLoadProg(mapfd);\n    if (progfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to load cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    cgroupfd = open(path, O_RDONLY);\n    if (cgroupfd < 0) {\n        virReportSystemError(errno, _(\"unable to open '%s'\"), path);\n        goto cleanup;\n    }\n\n    if (virBPFAttachProg(progfd, cgroupfd, BPF_CGROUP_DEVICE) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to attach cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    if (group->unified.devices.progfd > 0) {\n        VIR_DEBUG(\"Closing existing program that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.progfd);\n    }\n\n    if (group->unified.devices.mapfd > 0) {\n        VIR_DEBUG(\"Closing existing map that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.mapfd);\n    }\n\n    group->unified.devices.progfd = progfd;\n    group->unified.devices.mapfd = mapfd;\n    group->unified.devices.max = max;\n    progfd = -1;\n    mapfd = -1;\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(mapfd);\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesAttachProg(virCgroupPtr group,\n                             int mapfd,\n                             size_t max)\n{\n    int ret = -1;\n    VIR_AUTOCLOSE progfd = -1;\n    VIR_AUTOCLOSE cgroupfd = -1;\n    g_autofree char *path = NULL;\n\n    if (virCgroupPathOfController(group, VIR_CGROUP_CONTROLLER_DEVICES,\n                                  NULL, &path) < 0) {\n        goto cleanup;\n    }\n\n    progfd = virCgroupV2DevicesLoadProg(mapfd);\n    if (progfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to load cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    cgroupfd = open(path, O_RDONLY);\n    if (cgroupfd < 0) {\n        virReportSystemError(errno, _(\"unable to open '%s'\"), path);\n        goto cleanup;\n    }\n\n    if (virBPFAttachProg(progfd, cgroupfd, BPF_CGROUP_DEVICE) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to attach cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    if (group->unified.devices.progfd > 0) {\n        VIR_DEBUG(\"Closing existing program that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.progfd);\n    }\n\n    if (group->unified.devices.mapfd > 0) {\n        VIR_DEBUG(\"Closing existing map that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.mapfd);\n    }\n\n    group->unified.devices.progfd = progfd;\n    group->unified.devices.mapfd = mapfd;\n    group->unified.devices.max = max;\n    progfd = -1;\n    mapfd = -1;\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(mapfd);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupV2DevicesCreateMap",
          "args": [
            "VIR_CGROUP_V2_INITIAL_BPF_MAP_SIZE"
          ],
          "line": 507
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesCreateMap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "438-451",
          "snippet": "static int\nvirCgroupV2DevicesCreateMap(size_t size)\n{\n    int mapfd = virBPFCreateMap(BPF_MAP_TYPE_HASH, sizeof(uint64_t),\n                                sizeof(uint32_t), size);\n\n    if (mapfd < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to initialize device BPF map\"));\n        return -1;\n    }\n\n    return mapfd;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesCreateMap(size_t size)\n{\n    int mapfd = virBPFCreateMap(BPF_MAP_TYPE_HASH, sizeof(uint64_t),\n                                sizeof(uint32_t), size);\n\n    if (mapfd < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to initialize device BPF map\"));\n        return -1;\n    }\n\n    return mapfd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesCreateProg(virCgroupPtr group)\n{\n    int mapfd = -1;\n\n    if (group->unified.devices.progfd > 0 && group->unified.devices.mapfd > 0)\n        return 0;\n\n    mapfd = virCgroupV2DevicesCreateMap(VIR_CGROUP_V2_INITIAL_BPF_MAP_SIZE);\n    if (mapfd < 0)\n        return -1;\n\n    return virCgroupV2DevicesAttachProg(group, mapfd,\n                                        VIR_CGROUP_V2_INITIAL_BPF_MAP_SIZE);\n}"
  },
  {
    "function_name": "virCgroupV2DevicesReallocMap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "454-496",
    "snippet": "static int\nvirCgroupV2DevicesReallocMap(int mapfd,\n                             size_t size)\n{\n    uint64_t key = 0;\n    uint64_t prevKey = 0;\n    int rc;\n    int ret = -1;\n    VIR_AUTOCLOSE newmapfd = virCgroupV2DevicesCreateMap(size);\n\n    VIR_DEBUG(\"realloc devices map mapfd:%d, size:%zu\", mapfd, size);\n\n    if (newmapfd < 0)\n        return -1;\n\n    while ((rc = virBPFGetNextElem(mapfd, &prevKey, &key)) == 0) {\n        uint32_t val = 0;\n\n        if (virBPFLookupElem(mapfd, &key, &val) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to lookup device in old map\"));\n            return -1;\n        }\n\n        if (virBPFUpdateElem(newmapfd, &key, &val) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to add device into new map\"));\n            return -1;\n        }\n\n        prevKey = key;\n    }\n\n    if (rc < 0 && errno != ENOENT) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to copy all device rules\"));\n        return -1;\n    }\n\n    ret = newmapfd;\n    newmapfd = -1;\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to copy all device rules\")"
          ],
          "line": 488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to copy all device rules\""
          ],
          "line": 489
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to add device into new map\")"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBPFUpdateElem",
          "args": [
            "newmapfd",
            "&key",
            "&val"
          ],
          "line": 478
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFUpdateElem",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "407-414",
          "snippet": "int\nvirBPFUpdateElem(int mapfd G_GNUC_UNUSED,\n                 void *key G_GNUC_UNUSED,\n                 void *val G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFUpdateElem(int mapfd G_GNUC_UNUSED,\n                 void *key G_GNUC_UNUSED,\n                 void *val G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to lookup device in old map\")"
          ],
          "line": 473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBPFLookupElem",
          "args": [
            "mapfd",
            "&key",
            "&val"
          ],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFLookupElem",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "387-394",
          "snippet": "int\nvirBPFLookupElem(int mapfd G_GNUC_UNUSED,\n                 void *key G_GNUC_UNUSED,\n                 void *val G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFLookupElem(int mapfd G_GNUC_UNUSED,\n                 void *key G_GNUC_UNUSED,\n                 void *val G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBPFGetNextElem",
          "args": [
            "mapfd",
            "&prevKey",
            "&key"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFGetNextElem",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "397-404",
          "snippet": "int\nvirBPFGetNextElem(int mapfd G_GNUC_UNUSED,\n                  void *key G_GNUC_UNUSED,\n                  void *nextKey G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFGetNextElem(int mapfd G_GNUC_UNUSED,\n                  void *key G_GNUC_UNUSED,\n                  void *nextKey G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"realloc devices map mapfd:%d, size:%zu\"",
            "mapfd",
            "size"
          ],
          "line": 464
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCgroupV2DevicesCreateMap",
          "args": [
            "size"
          ],
          "line": 462
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesCreateMap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "438-451",
          "snippet": "static int\nvirCgroupV2DevicesCreateMap(size_t size)\n{\n    int mapfd = virBPFCreateMap(BPF_MAP_TYPE_HASH, sizeof(uint64_t),\n                                sizeof(uint32_t), size);\n\n    if (mapfd < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to initialize device BPF map\"));\n        return -1;\n    }\n\n    return mapfd;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesCreateMap(size_t size)\n{\n    int mapfd = virBPFCreateMap(BPF_MAP_TYPE_HASH, sizeof(uint64_t),\n                                sizeof(uint32_t), size);\n\n    if (mapfd < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to initialize device BPF map\"));\n        return -1;\n    }\n\n    return mapfd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesReallocMap(int mapfd,\n                             size_t size)\n{\n    uint64_t key = 0;\n    uint64_t prevKey = 0;\n    int rc;\n    int ret = -1;\n    VIR_AUTOCLOSE newmapfd = virCgroupV2DevicesCreateMap(size);\n\n    VIR_DEBUG(\"realloc devices map mapfd:%d, size:%zu\", mapfd, size);\n\n    if (newmapfd < 0)\n        return -1;\n\n    while ((rc = virBPFGetNextElem(mapfd, &prevKey, &key)) == 0) {\n        uint32_t val = 0;\n\n        if (virBPFLookupElem(mapfd, &key, &val) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to lookup device in old map\"));\n            return -1;\n        }\n\n        if (virBPFUpdateElem(newmapfd, &key, &val) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to add device into new map\"));\n            return -1;\n        }\n\n        prevKey = key;\n    }\n\n    if (rc < 0 && errno != ENOENT) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to copy all device rules\"));\n        return -1;\n    }\n\n    ret = newmapfd;\n    newmapfd = -1;\n    return ret;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesCreateMap",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "438-451",
    "snippet": "static int\nvirCgroupV2DevicesCreateMap(size_t size)\n{\n    int mapfd = virBPFCreateMap(BPF_MAP_TYPE_HASH, sizeof(uint64_t),\n                                sizeof(uint32_t), size);\n\n    if (mapfd < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to initialize device BPF map\"));\n        return -1;\n    }\n\n    return mapfd;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to initialize device BPF map\")"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to initialize device BPF map\""
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBPFCreateMap",
          "args": [
            "BPF_MAP_TYPE_HASH",
            "sizeof(uint64_t)",
            "sizeof(uint32_t)",
            "size"
          ],
          "line": 441
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFCreateMap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "299-307",
          "snippet": "int\nvirBPFCreateMap(unsigned int mapType G_GNUC_UNUSED,\n                unsigned int keySize G_GNUC_UNUSED,\n                unsigned int valSize G_GNUC_UNUSED,\n                unsigned int maxEntries G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFCreateMap(unsigned int mapType G_GNUC_UNUSED,\n                unsigned int keySize G_GNUC_UNUSED,\n                unsigned int valSize G_GNUC_UNUSED,\n                unsigned int maxEntries G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesCreateMap(size_t size)\n{\n    int mapfd = virBPFCreateMap(BPF_MAP_TYPE_HASH, sizeof(uint64_t),\n                                sizeof(uint32_t), size);\n\n    if (mapfd < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to initialize device BPF map\"));\n        return -1;\n    }\n\n    return mapfd;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesDetectProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "354-433",
    "snippet": "int\nvirCgroupV2DevicesDetectProg(virCgroupPtr group)\n{\n    g_autofree char *path = NULL;\n    VIR_AUTOCLOSE cgroupfd = -1;\n    unsigned int progcnt = 0;\n    unsigned int progids[MAX_PROG_IDS] = { 0 };\n    int progfd = -1;\n    int mapfd = -1;\n    int nitems = -1;\n    struct bpf_prog_info progInfo = { 0 };\n    struct bpf_map_info mapInfo = { 0 };\n    g_autofree unsigned int *mapIDs = NULL;\n\n    if (group->unified.devices.progfd > 0 && group->unified.devices.mapfd > 0)\n        return 0;\n\n    if (virCgroupPathOfController(group, VIR_CGROUP_CONTROLLER_DEVICES,\n                                  NULL, &path) < 0) {\n        return -1;\n    }\n\n    cgroupfd = open(path, O_RDONLY);\n    if (cgroupfd < 0) {\n        virReportSystemError(errno, _(\"unable to open '%s'\"), path);\n        return -1;\n    }\n\n    if (virBPFQueryProg(cgroupfd, MAX_PROG_IDS, BPF_CGROUP_DEVICE,\n                        &progcnt, progids) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"unable to query cgroup BPF progs\"));\n        return -1;\n    }\n\n    if (progcnt == 0)\n        return 0;\n\n    /* No need to have alternate code, this function will not be called\n     * if compiled with old kernel. */\n    progfd = virBPFGetProg(progids[0]);\n    if (progfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to get cgroup BPF prog FD\"));\n        return -1;\n    }\n\n    if (virBPFGetProgInfo(progfd, &progInfo, &mapIDs) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to get cgroup BPF prog info\"));\n        return -1;\n    }\n\n    if (progInfo.nr_map_ids == 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"no map for cgroup BPF prog\"));\n        return -1;\n    }\n\n    mapfd = virBPFGetMap(mapIDs[0]);\n    if (mapfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to get cgroup BPF map FD\"));\n        return -1;\n    }\n\n    if (virBPFGetMapInfo(mapfd, &mapInfo) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to get cgroup BPF map info\"));\n        return -1;\n    }\n\n    nitems = virCgroupV2DevicesCountMapEntries(mapfd);\n    if (nitems < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to count cgroup BPF map items\"));\n        return -1;\n    }\n\n    group->unified.devices.progfd = progfd;\n    group->unified.devices.mapfd = mapfd;\n    group->unified.devices.max = mapInfo.max_entries;\n    group->unified.devices.count = nitems;\n\n    return 0;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to count cgroup BPF map items\")"
          ],
          "line": 423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to count cgroup BPF map items\""
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupV2DevicesCountMapEntries",
          "args": [
            "mapfd"
          ],
          "line": 421
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesCountMapEntries",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "332-349",
          "snippet": "static int\nvirCgroupV2DevicesCountMapEntries(int mapfd)\n{\n    int ret = 0;\n    int rc;\n    uint64_t key = 0;\n    uint64_t prevKey = 0;\n\n    while ((rc = virBPFGetNextElem(mapfd, &prevKey, &key)) == 0) {\n        ret++;\n        prevKey = key;\n    }\n\n    if (rc < 0)\n        return -1;\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesCountMapEntries(int mapfd)\n{\n    int ret = 0;\n    int rc;\n    uint64_t key = 0;\n    uint64_t prevKey = 0;\n\n    while ((rc = virBPFGetNextElem(mapfd, &prevKey, &key)) == 0) {\n        ret++;\n        prevKey = key;\n    }\n\n    if (rc < 0)\n        return -1;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to get cgroup BPF map info\")"
          ],
          "line": 417
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBPFGetMapInfo",
          "args": [
            "mapfd",
            "&mapInfo"
          ],
          "line": 416
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFGetMapInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "378-384",
          "snippet": "int\nvirBPFGetMapInfo(int mapfd G_GNUC_UNUSED,\n                 struct bpf_map_info *info G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFGetMapInfo(int mapfd G_GNUC_UNUSED,\n                 struct bpf_map_info *info G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to get cgroup BPF map FD\")"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBPFGetMap",
          "args": [
            "mapIDs[0]"
          ],
          "line": 410
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFGetMap",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "370-375",
          "snippet": "int\nvirBPFGetMap(unsigned int id G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFGetMap(unsigned int id G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"no map for cgroup BPF prog\")"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to get cgroup BPF prog info\")"
          ],
          "line": 400
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBPFGetProgInfo",
          "args": [
            "progfd",
            "&progInfo",
            "&mapIDs"
          ],
          "line": 399
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFGetProgInfo",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "360-367",
          "snippet": "int\nvirBPFGetProgInfo(int progfd G_GNUC_UNUSED,\n                  struct bpf_prog_info *info G_GNUC_UNUSED,\n                  unsigned int **mapIDs G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFGetProgInfo(int progfd G_GNUC_UNUSED,\n                  struct bpf_prog_info *info G_GNUC_UNUSED,\n                  unsigned int **mapIDs G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to get cgroup BPF prog FD\")"
          ],
          "line": 395
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBPFGetProg",
          "args": [
            "progids[0]"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFGetProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "352-357",
          "snippet": "int\nvirBPFGetProg(unsigned int id G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFGetProg(unsigned int id G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"unable to query cgroup BPF progs\")"
          ],
          "line": 384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBPFQueryProg",
          "args": [
            "cgroupfd",
            "MAX_PROG_IDS",
            "BPF_CGROUP_DEVICE",
            "&progcnt",
            "progids"
          ],
          "line": 382
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFQueryProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "340-349",
          "snippet": "int\nvirBPFQueryProg(int targetfd G_GNUC_UNUSED,\n                unsigned int maxprogids G_GNUC_UNUSED,\n                int attachType G_GNUC_UNUSED,\n                unsigned int *progcnt G_GNUC_UNUSED,\n                void *progids G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFQueryProg(int targetfd G_GNUC_UNUSED,\n                unsigned int maxprogids G_GNUC_UNUSED,\n                int attachType G_GNUC_UNUSED,\n                unsigned int *progcnt G_GNUC_UNUSED,\n                void *progids G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unable to open '%s'\")",
            "path"
          ],
          "line": 378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "path",
            "O_RDONLY"
          ],
          "line": 376
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupPathOfController",
          "args": [
            "group",
            "VIR_CGROUP_CONTROLLER_DEVICES",
            "NULL",
            "&path"
          ],
          "line": 371
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupPathOfController",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "2907-2916",
          "snippet": "int\nvirCgroupPathOfController(virCgroupPtr group G_GNUC_UNUSED,\n                          unsigned int controller G_GNUC_UNUSED,\n                          const char *key G_GNUC_UNUSED,\n                          char **path G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nint\nvirCgroupPathOfController(virCgroupPtr group G_GNUC_UNUSED,\n                          unsigned int controller G_GNUC_UNUSED,\n                          const char *key G_GNUC_UNUSED,\n                          char **path G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nint\nvirCgroupV2DevicesDetectProg(virCgroupPtr group)\n{\n    g_autofree char *path = NULL;\n    VIR_AUTOCLOSE cgroupfd = -1;\n    unsigned int progcnt = 0;\n    unsigned int progids[MAX_PROG_IDS] = { 0 };\n    int progfd = -1;\n    int mapfd = -1;\n    int nitems = -1;\n    struct bpf_prog_info progInfo = { 0 };\n    struct bpf_map_info mapInfo = { 0 };\n    g_autofree unsigned int *mapIDs = NULL;\n\n    if (group->unified.devices.progfd > 0 && group->unified.devices.mapfd > 0)\n        return 0;\n\n    if (virCgroupPathOfController(group, VIR_CGROUP_CONTROLLER_DEVICES,\n                                  NULL, &path) < 0) {\n        return -1;\n    }\n\n    cgroupfd = open(path, O_RDONLY);\n    if (cgroupfd < 0) {\n        virReportSystemError(errno, _(\"unable to open '%s'\"), path);\n        return -1;\n    }\n\n    if (virBPFQueryProg(cgroupfd, MAX_PROG_IDS, BPF_CGROUP_DEVICE,\n                        &progcnt, progids) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"unable to query cgroup BPF progs\"));\n        return -1;\n    }\n\n    if (progcnt == 0)\n        return 0;\n\n    /* No need to have alternate code, this function will not be called\n     * if compiled with old kernel. */\n    progfd = virBPFGetProg(progids[0]);\n    if (progfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to get cgroup BPF prog FD\"));\n        return -1;\n    }\n\n    if (virBPFGetProgInfo(progfd, &progInfo, &mapIDs) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to get cgroup BPF prog info\"));\n        return -1;\n    }\n\n    if (progInfo.nr_map_ids == 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"no map for cgroup BPF prog\"));\n        return -1;\n    }\n\n    mapfd = virBPFGetMap(mapIDs[0]);\n    if (mapfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to get cgroup BPF map FD\"));\n        return -1;\n    }\n\n    if (virBPFGetMapInfo(mapfd, &mapInfo) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to get cgroup BPF map info\"));\n        return -1;\n    }\n\n    nitems = virCgroupV2DevicesCountMapEntries(mapfd);\n    if (nitems < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to count cgroup BPF map items\"));\n        return -1;\n    }\n\n    group->unified.devices.progfd = progfd;\n    group->unified.devices.mapfd = mapfd;\n    group->unified.devices.max = mapInfo.max_entries;\n    group->unified.devices.count = nitems;\n\n    return 0;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesCountMapEntries",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "332-349",
    "snippet": "static int\nvirCgroupV2DevicesCountMapEntries(int mapfd)\n{\n    int ret = 0;\n    int rc;\n    uint64_t key = 0;\n    uint64_t prevKey = 0;\n\n    while ((rc = virBPFGetNextElem(mapfd, &prevKey, &key)) == 0) {\n        ret++;\n        prevKey = key;\n    }\n\n    if (rc < 0)\n        return -1;\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBPFGetNextElem",
          "args": [
            "mapfd",
            "&prevKey",
            "&key"
          ],
          "line": 340
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFGetNextElem",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "397-404",
          "snippet": "int\nvirBPFGetNextElem(int mapfd G_GNUC_UNUSED,\n                  void *key G_GNUC_UNUSED,\n                  void *nextKey G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFGetNextElem(int mapfd G_GNUC_UNUSED,\n                  void *key G_GNUC_UNUSED,\n                  void *nextKey G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesCountMapEntries(int mapfd)\n{\n    int ret = 0;\n    int rc;\n    uint64_t key = 0;\n    uint64_t prevKey = 0;\n\n    while ((rc = virBPFGetNextElem(mapfd, &prevKey, &key)) == 0) {\n        ret++;\n        prevKey = key;\n    }\n\n    if (rc < 0)\n        return -1;\n\n    return ret;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesAttachProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "277-329",
    "snippet": "static int\nvirCgroupV2DevicesAttachProg(virCgroupPtr group,\n                             int mapfd,\n                             size_t max)\n{\n    int ret = -1;\n    VIR_AUTOCLOSE progfd = -1;\n    VIR_AUTOCLOSE cgroupfd = -1;\n    g_autofree char *path = NULL;\n\n    if (virCgroupPathOfController(group, VIR_CGROUP_CONTROLLER_DEVICES,\n                                  NULL, &path) < 0) {\n        goto cleanup;\n    }\n\n    progfd = virCgroupV2DevicesLoadProg(mapfd);\n    if (progfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to load cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    cgroupfd = open(path, O_RDONLY);\n    if (cgroupfd < 0) {\n        virReportSystemError(errno, _(\"unable to open '%s'\"), path);\n        goto cleanup;\n    }\n\n    if (virBPFAttachProg(progfd, cgroupfd, BPF_CGROUP_DEVICE) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to attach cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    if (group->unified.devices.progfd > 0) {\n        VIR_DEBUG(\"Closing existing program that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.progfd);\n    }\n\n    if (group->unified.devices.mapfd > 0) {\n        VIR_DEBUG(\"Closing existing map that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.mapfd);\n    }\n\n    group->unified.devices.progfd = progfd;\n    group->unified.devices.mapfd = mapfd;\n    group->unified.devices.max = max;\n    progfd = -1;\n    mapfd = -1;\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(mapfd);\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "mapfd"
          ],
          "line": 327
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "group->unified.devices.mapfd"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Closing existing map that was replaced by new one.\""
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "group->unified.devices.progfd"
          ],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Closing existing program that was replaced by new one.\""
          ],
          "line": 310
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to attach cgroup BPF prog\")"
          ],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to attach cgroup BPF prog\""
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBPFAttachProg",
          "args": [
            "progfd",
            "cgroupfd",
            "BPF_CGROUP_DEVICE"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFAttachProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "320-327",
          "snippet": "int\nvirBPFAttachProg(int progfd G_GNUC_UNUSED,\n                 int targetfd G_GNUC_UNUSED,\n                 int attachType G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFAttachProg(int progfd G_GNUC_UNUSED,\n                 int targetfd G_GNUC_UNUSED,\n                 int attachType G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unable to open '%s'\")",
            "path"
          ],
          "line": 300
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "path",
            "O_RDONLY"
          ],
          "line": 298
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to load cgroup BPF prog\")"
          ],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCgroupV2DevicesLoadProg",
          "args": [
            "mapfd"
          ],
          "line": 292
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupV2DevicesLoadProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
          "lines": "136-274",
          "snippet": "static int\nvirCgroupV2DevicesLoadProg(int mapfd)\n{\n    struct bpf_insn prog[] = {\n        /*  0:  r6 = r1 */\n        VIR_BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),\n        /*  1:  r1 = *(u32 *)(r6 + 8) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 8),\n        /*  2:  r2 = *(u32 *)(r6 + 4) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 4),\n        /*  3:  r2 <<= 32 */\n        VIR_BPF_ALU64_IMM(BPF_LSH, BPF_REG_2, 32),\n        /*  4:  r2 |= r1 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_2, BPF_REG_1),\n        /*  5:  *(u64 *)(r10 - 8) = r2 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_2, -8),\n        /*  6:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /*  7:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /*  8:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 10:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 11:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 12:  if r1 == 0 goto +5 <LBB0_2> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 13:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 14:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 15:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 16:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 17:  if r1 == r2 goto +50 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 50),\n        /* LBB0_2: */\n        /* 18:  r1 = *(u32 *)(r6 + 4) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 4),\n        /* 19:  r1 <<= 32 */\n        VIR_BPF_ALU64_IMM(BPF_LSH, BPF_REG_1, 32),\n        /* 20:  r2 = 4294967295 ll */\n        VIR_BPF_LD_IMM64(BPF_REG_2, 0xffffffff),\n        /* 22:  r1 |= r2 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_1, BPF_REG_2),\n        /* 23:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 24:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 25:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 26:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 28:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 29:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 30:  if r1 == 0 goto +5 <LBB0_4> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 31:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 32:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 33:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 34:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 35:  if r1 == r2 goto +32 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 32),\n        /* LBB0_4: */\n        /* 36:  r1 = *(u32 *)(r6 + 8) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 8),\n        /* 37:  r2 = -4294967296 ll */\n        VIR_BPF_LD_IMM64(BPF_REG_2, 0xffffffff00000000),\n        /* 39:  r1 |= r2 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_1, BPF_REG_2),\n        /* 40:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 41:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 42:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 43:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 45:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 46:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 47:  if r1 == 0 goto +5 <LBB0_6> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 48:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 49:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 50:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 51:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 52:  if r1 == r2 goto +15 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 15),\n        /* LBB0_6: */\n        /* 53:  r1 = -1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_1, -1),\n        /* 54:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 55:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 56:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 57:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 59:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 60:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 61:  if r1 == 0 goto +5 <LBB0_8> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 62:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 63:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 64:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 65:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 66:  if r1 == r2 goto +1 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 1),\n        /* LBB0_8: */\n        /* 67:  r0 = 0 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 0),\n        /* LBB0_9: */\n        /* 68:  exit */\n        VIR_BPF_EXIT_INSN(),\n    };\n\n    return virBPFLoadProg(prog, BPF_PROG_TYPE_CGROUP_DEVICE, G_N_ELEMENTS(prog));\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"vircgroupv2devices.h\"",
            "#include \"vircgroup.h\"",
            "#include \"virbpf.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircgrouppriv.h\"",
            "#include \"internal.h\"",
            "# include <sys/types.h>",
            "# include <sys/syscall.h>",
            "# include <sys/stat.h>",
            "# include <linux/bpf.h>",
            "# include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesLoadProg(int mapfd)\n{\n    struct bpf_insn prog[] = {\n        /*  0:  r6 = r1 */\n        VIR_BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),\n        /*  1:  r1 = *(u32 *)(r6 + 8) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 8),\n        /*  2:  r2 = *(u32 *)(r6 + 4) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 4),\n        /*  3:  r2 <<= 32 */\n        VIR_BPF_ALU64_IMM(BPF_LSH, BPF_REG_2, 32),\n        /*  4:  r2 |= r1 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_2, BPF_REG_1),\n        /*  5:  *(u64 *)(r10 - 8) = r2 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_2, -8),\n        /*  6:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /*  7:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /*  8:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 10:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 11:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 12:  if r1 == 0 goto +5 <LBB0_2> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 13:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 14:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 15:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 16:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 17:  if r1 == r2 goto +50 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 50),\n        /* LBB0_2: */\n        /* 18:  r1 = *(u32 *)(r6 + 4) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 4),\n        /* 19:  r1 <<= 32 */\n        VIR_BPF_ALU64_IMM(BPF_LSH, BPF_REG_1, 32),\n        /* 20:  r2 = 4294967295 ll */\n        VIR_BPF_LD_IMM64(BPF_REG_2, 0xffffffff),\n        /* 22:  r1 |= r2 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_1, BPF_REG_2),\n        /* 23:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 24:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 25:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 26:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 28:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 29:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 30:  if r1 == 0 goto +5 <LBB0_4> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 31:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 32:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 33:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 34:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 35:  if r1 == r2 goto +32 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 32),\n        /* LBB0_4: */\n        /* 36:  r1 = *(u32 *)(r6 + 8) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 8),\n        /* 37:  r2 = -4294967296 ll */\n        VIR_BPF_LD_IMM64(BPF_REG_2, 0xffffffff00000000),\n        /* 39:  r1 |= r2 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_1, BPF_REG_2),\n        /* 40:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 41:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 42:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 43:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 45:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 46:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 47:  if r1 == 0 goto +5 <LBB0_6> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 48:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 49:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 50:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 51:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 52:  if r1 == r2 goto +15 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 15),\n        /* LBB0_6: */\n        /* 53:  r1 = -1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_1, -1),\n        /* 54:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 55:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 56:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 57:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 59:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 60:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 61:  if r1 == 0 goto +5 <LBB0_8> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 62:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 63:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 64:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 65:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 66:  if r1 == r2 goto +1 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 1),\n        /* LBB0_8: */\n        /* 67:  r0 = 0 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 0),\n        /* LBB0_9: */\n        /* 68:  exit */\n        VIR_BPF_EXIT_INSN(),\n    };\n\n    return virBPFLoadProg(prog, BPF_PROG_TYPE_CGROUP_DEVICE, G_N_ELEMENTS(prog));\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupPathOfController",
          "args": [
            "group",
            "VIR_CGROUP_CONTROLLER_DEVICES",
            "NULL",
            "&path"
          ],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupPathOfController",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "2907-2916",
          "snippet": "int\nvirCgroupPathOfController(virCgroupPtr group G_GNUC_UNUSED,\n                          unsigned int controller G_GNUC_UNUSED,\n                          const char *key G_GNUC_UNUSED,\n                          char **path G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nint\nvirCgroupPathOfController(virCgroupPtr group G_GNUC_UNUSED,\n                          unsigned int controller G_GNUC_UNUSED,\n                          const char *key G_GNUC_UNUSED,\n                          char **path G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesAttachProg(virCgroupPtr group,\n                             int mapfd,\n                             size_t max)\n{\n    int ret = -1;\n    VIR_AUTOCLOSE progfd = -1;\n    VIR_AUTOCLOSE cgroupfd = -1;\n    g_autofree char *path = NULL;\n\n    if (virCgroupPathOfController(group, VIR_CGROUP_CONTROLLER_DEVICES,\n                                  NULL, &path) < 0) {\n        goto cleanup;\n    }\n\n    progfd = virCgroupV2DevicesLoadProg(mapfd);\n    if (progfd < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to load cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    cgroupfd = open(path, O_RDONLY);\n    if (cgroupfd < 0) {\n        virReportSystemError(errno, _(\"unable to open '%s'\"), path);\n        goto cleanup;\n    }\n\n    if (virBPFAttachProg(progfd, cgroupfd, BPF_CGROUP_DEVICE) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"failed to attach cgroup BPF prog\"));\n        goto cleanup;\n    }\n\n    if (group->unified.devices.progfd > 0) {\n        VIR_DEBUG(\"Closing existing program that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.progfd);\n    }\n\n    if (group->unified.devices.mapfd > 0) {\n        VIR_DEBUG(\"Closing existing map that was replaced by new one.\");\n        VIR_FORCE_CLOSE(group->unified.devices.mapfd);\n    }\n\n    group->unified.devices.progfd = progfd;\n    group->unified.devices.mapfd = mapfd;\n    group->unified.devices.max = max;\n    progfd = -1;\n    mapfd = -1;\n\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(mapfd);\n    return ret;\n}"
  },
  {
    "function_name": "virCgroupV2DevicesLoadProg",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "136-274",
    "snippet": "static int\nvirCgroupV2DevicesLoadProg(int mapfd)\n{\n    struct bpf_insn prog[] = {\n        /*  0:  r6 = r1 */\n        VIR_BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),\n        /*  1:  r1 = *(u32 *)(r6 + 8) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 8),\n        /*  2:  r2 = *(u32 *)(r6 + 4) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 4),\n        /*  3:  r2 <<= 32 */\n        VIR_BPF_ALU64_IMM(BPF_LSH, BPF_REG_2, 32),\n        /*  4:  r2 |= r1 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_2, BPF_REG_1),\n        /*  5:  *(u64 *)(r10 - 8) = r2 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_2, -8),\n        /*  6:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /*  7:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /*  8:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 10:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 11:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 12:  if r1 == 0 goto +5 <LBB0_2> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 13:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 14:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 15:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 16:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 17:  if r1 == r2 goto +50 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 50),\n        /* LBB0_2: */\n        /* 18:  r1 = *(u32 *)(r6 + 4) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 4),\n        /* 19:  r1 <<= 32 */\n        VIR_BPF_ALU64_IMM(BPF_LSH, BPF_REG_1, 32),\n        /* 20:  r2 = 4294967295 ll */\n        VIR_BPF_LD_IMM64(BPF_REG_2, 0xffffffff),\n        /* 22:  r1 |= r2 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_1, BPF_REG_2),\n        /* 23:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 24:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 25:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 26:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 28:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 29:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 30:  if r1 == 0 goto +5 <LBB0_4> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 31:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 32:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 33:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 34:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 35:  if r1 == r2 goto +32 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 32),\n        /* LBB0_4: */\n        /* 36:  r1 = *(u32 *)(r6 + 8) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 8),\n        /* 37:  r2 = -4294967296 ll */\n        VIR_BPF_LD_IMM64(BPF_REG_2, 0xffffffff00000000),\n        /* 39:  r1 |= r2 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_1, BPF_REG_2),\n        /* 40:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 41:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 42:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 43:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 45:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 46:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 47:  if r1 == 0 goto +5 <LBB0_6> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 48:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 49:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 50:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 51:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 52:  if r1 == r2 goto +15 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 15),\n        /* LBB0_6: */\n        /* 53:  r1 = -1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_1, -1),\n        /* 54:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 55:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 56:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 57:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 59:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 60:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 61:  if r1 == 0 goto +5 <LBB0_8> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 62:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 63:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 64:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 65:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 66:  if r1 == r2 goto +1 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 1),\n        /* LBB0_8: */\n        /* 67:  r0 = 0 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 0),\n        /* LBB0_9: */\n        /* 68:  exit */\n        VIR_BPF_EXIT_INSN(),\n    };\n\n    return virBPFLoadProg(prog, BPF_PROG_TYPE_CGROUP_DEVICE, G_N_ELEMENTS(prog));\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBPFLoadProg",
          "args": [
            "prog",
            "BPF_PROG_TYPE_CGROUP_DEVICE",
            "G_N_ELEMENTS(prog)"
          ],
          "line": 273
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFLoadProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "310-317",
          "snippet": "int\nvirBPFLoadProg(struct bpf_insn *insns G_GNUC_UNUSED,\n               int progType G_GNUC_UNUSED,\n               unsigned int insnCnt G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFLoadProg(struct bpf_insn *insns G_GNUC_UNUSED,\n               int progType G_GNUC_UNUSED,\n               unsigned int insnCnt G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "prog"
          ],
          "line": 273
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_EXIT_INSN",
          "args": [],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_IMM",
          "args": [
            "BPF_REG_0",
            "0"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_JMP_REG",
          "args": [
            "BPF_JEQ",
            "BPF_REG_1",
            "BPF_REG_2",
            "1"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_REG",
          "args": [
            "BPF_AND",
            "BPF_REG_1",
            "BPF_REG_2"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_1",
            "BPF_REG_1",
            "0"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_2",
            "BPF_REG_6",
            "0"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_IMM",
          "args": [
            "BPF_REG_0",
            "1"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_JMP_IMM",
          "args": [
            "BPF_JEQ",
            "BPF_REG_1",
            "0",
            "5"
          ],
          "line": 254
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_1",
            "BPF_REG_0"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_CALL_INSN",
          "args": [
            "BPF_FUNC_map_lookup_elem"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LD_MAP_FD",
          "args": [
            "BPF_REG_1",
            "mapfd"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_IMM",
          "args": [
            "BPF_ADD",
            "BPF_REG_2",
            "-8"
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_2",
            "BPF_REG_10"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_STX_MEM",
          "args": [
            "BPF_DW",
            "BPF_REG_10",
            "BPF_REG_1",
            "-8"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_IMM",
          "args": [
            "BPF_REG_1",
            "-1"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_JMP_REG",
          "args": [
            "BPF_JEQ",
            "BPF_REG_1",
            "BPF_REG_2",
            "15"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_REG",
          "args": [
            "BPF_AND",
            "BPF_REG_1",
            "BPF_REG_2"
          ],
          "line": 235
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_1",
            "BPF_REG_1",
            "0"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_2",
            "BPF_REG_6",
            "0"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_IMM",
          "args": [
            "BPF_REG_0",
            "1"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_JMP_IMM",
          "args": [
            "BPF_JEQ",
            "BPF_REG_1",
            "0",
            "5"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_1",
            "BPF_REG_0"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_CALL_INSN",
          "args": [
            "BPF_FUNC_map_lookup_elem"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LD_MAP_FD",
          "args": [
            "BPF_REG_1",
            "mapfd"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_IMM",
          "args": [
            "BPF_ADD",
            "BPF_REG_2",
            "-8"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_2",
            "BPF_REG_10"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_STX_MEM",
          "args": [
            "BPF_DW",
            "BPF_REG_10",
            "BPF_REG_1",
            "-8"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_REG",
          "args": [
            "BPF_OR",
            "BPF_REG_1",
            "BPF_REG_2"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LD_IMM64",
          "args": [
            "BPF_REG_2",
            "0xffffffff00000000"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_1",
            "BPF_REG_6",
            "8"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_JMP_REG",
          "args": [
            "BPF_JEQ",
            "BPF_REG_1",
            "BPF_REG_2",
            "32"
          ],
          "line": 206
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_REG",
          "args": [
            "BPF_AND",
            "BPF_REG_1",
            "BPF_REG_2"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_1",
            "BPF_REG_1",
            "0"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_2",
            "BPF_REG_6",
            "0"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_IMM",
          "args": [
            "BPF_REG_0",
            "1"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_JMP_IMM",
          "args": [
            "BPF_JEQ",
            "BPF_REG_1",
            "0",
            "5"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_1",
            "BPF_REG_0"
          ],
          "line": 194
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_CALL_INSN",
          "args": [
            "BPF_FUNC_map_lookup_elem"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LD_MAP_FD",
          "args": [
            "BPF_REG_1",
            "mapfd"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_IMM",
          "args": [
            "BPF_ADD",
            "BPF_REG_2",
            "-8"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_2",
            "BPF_REG_10"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_STX_MEM",
          "args": [
            "BPF_DW",
            "BPF_REG_10",
            "BPF_REG_1",
            "-8"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_REG",
          "args": [
            "BPF_OR",
            "BPF_REG_1",
            "BPF_REG_2"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LD_IMM64",
          "args": [
            "BPF_REG_2",
            "0xffffffff"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_IMM",
          "args": [
            "BPF_LSH",
            "BPF_REG_1",
            "32"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_1",
            "BPF_REG_6",
            "4"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_JMP_REG",
          "args": [
            "BPF_JEQ",
            "BPF_REG_1",
            "BPF_REG_2",
            "50"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_REG",
          "args": [
            "BPF_AND",
            "BPF_REG_1",
            "BPF_REG_2"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_1",
            "BPF_REG_1",
            "0"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_2",
            "BPF_REG_6",
            "0"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_IMM",
          "args": [
            "BPF_REG_0",
            "1"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_JMP_IMM",
          "args": [
            "BPF_JEQ",
            "BPF_REG_1",
            "0",
            "5"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_1",
            "BPF_REG_0"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_CALL_INSN",
          "args": [
            "BPF_FUNC_map_lookup_elem"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LD_MAP_FD",
          "args": [
            "BPF_REG_1",
            "mapfd"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_IMM",
          "args": [
            "BPF_ADD",
            "BPF_REG_2",
            "-8"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_2",
            "BPF_REG_10"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_STX_MEM",
          "args": [
            "BPF_DW",
            "BPF_REG_10",
            "BPF_REG_2",
            "-8"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_REG",
          "args": [
            "BPF_OR",
            "BPF_REG_2",
            "BPF_REG_1"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_ALU64_IMM",
          "args": [
            "BPF_LSH",
            "BPF_REG_2",
            "32"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_2",
            "BPF_REG_6",
            "4"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_LDX_MEM",
          "args": [
            "BPF_W",
            "BPF_REG_1",
            "BPF_REG_6",
            "8"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_BPF_MOV64_REG",
          "args": [
            "BPF_REG_6",
            "BPF_REG_1"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nstatic int\nvirCgroupV2DevicesLoadProg(int mapfd)\n{\n    struct bpf_insn prog[] = {\n        /*  0:  r6 = r1 */\n        VIR_BPF_MOV64_REG(BPF_REG_6, BPF_REG_1),\n        /*  1:  r1 = *(u32 *)(r6 + 8) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 8),\n        /*  2:  r2 = *(u32 *)(r6 + 4) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 4),\n        /*  3:  r2 <<= 32 */\n        VIR_BPF_ALU64_IMM(BPF_LSH, BPF_REG_2, 32),\n        /*  4:  r2 |= r1 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_2, BPF_REG_1),\n        /*  5:  *(u64 *)(r10 - 8) = r2 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_2, -8),\n        /*  6:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /*  7:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /*  8:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 10:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 11:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 12:  if r1 == 0 goto +5 <LBB0_2> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 13:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 14:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 15:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 16:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 17:  if r1 == r2 goto +50 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 50),\n        /* LBB0_2: */\n        /* 18:  r1 = *(u32 *)(r6 + 4) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 4),\n        /* 19:  r1 <<= 32 */\n        VIR_BPF_ALU64_IMM(BPF_LSH, BPF_REG_1, 32),\n        /* 20:  r2 = 4294967295 ll */\n        VIR_BPF_LD_IMM64(BPF_REG_2, 0xffffffff),\n        /* 22:  r1 |= r2 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_1, BPF_REG_2),\n        /* 23:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 24:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 25:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 26:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 28:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 29:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 30:  if r1 == 0 goto +5 <LBB0_4> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 31:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 32:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 33:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 34:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 35:  if r1 == r2 goto +32 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 32),\n        /* LBB0_4: */\n        /* 36:  r1 = *(u32 *)(r6 + 8) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_6, 8),\n        /* 37:  r2 = -4294967296 ll */\n        VIR_BPF_LD_IMM64(BPF_REG_2, 0xffffffff00000000),\n        /* 39:  r1 |= r2 */\n        VIR_BPF_ALU64_REG(BPF_OR, BPF_REG_1, BPF_REG_2),\n        /* 40:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 41:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 42:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 43:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 45:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 46:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 47:  if r1 == 0 goto +5 <LBB0_6> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 48:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 49:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 50:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 51:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 52:  if r1 == r2 goto +15 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 15),\n        /* LBB0_6: */\n        /* 53:  r1 = -1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_1, -1),\n        /* 54:  *(u64 *)(r10 - 8) = r1 */\n        VIR_BPF_STX_MEM(BPF_DW, BPF_REG_10, BPF_REG_1, -8),\n        /* 55:  r2 = r10 */\n        VIR_BPF_MOV64_REG(BPF_REG_2, BPF_REG_10),\n        /* 56:  r2 += -8 */\n        VIR_BPF_ALU64_IMM(BPF_ADD, BPF_REG_2, -8),\n        /* 57:  r1 = 0 ll */\n        VIR_BPF_LD_MAP_FD(BPF_REG_1, mapfd),\n        /* 59:  call 1 */\n        VIR_BPF_CALL_INSN(BPF_FUNC_map_lookup_elem),\n        /* 60:  r1 = r0 */\n        VIR_BPF_MOV64_REG(BPF_REG_1, BPF_REG_0),\n        /* 61:  if r1 == 0 goto +5 <LBB0_8> */\n        VIR_BPF_JMP_IMM(BPF_JEQ, BPF_REG_1, 0, 5),\n        /* 62:  r0 = 1 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 1),\n        /* 63:  r2 = *(u32 *)(r6 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_2, BPF_REG_6, 0),\n        /* 64:  r1 = *(u32 *)(r1 + 0) */\n        VIR_BPF_LDX_MEM(BPF_W, BPF_REG_1, BPF_REG_1, 0),\n        /* 65:  r1 &= r2 */\n        VIR_BPF_ALU64_REG(BPF_AND, BPF_REG_1, BPF_REG_2),\n        /* 66:  if r1 == r2 goto +1 <LBB0_9> */\n        VIR_BPF_JMP_REG(BPF_JEQ, BPF_REG_1, BPF_REG_2, 1),\n        /* LBB0_8: */\n        /* 67:  r0 = 0 */\n        VIR_BPF_MOV64_IMM(BPF_REG_0, 0),\n        /* LBB0_9: */\n        /* 68:  exit */\n        VIR_BPF_EXIT_INSN(),\n    };\n\n    return virBPFLoadProg(prog, BPF_PROG_TYPE_CGROUP_DEVICE, G_N_ELEMENTS(prog));\n}"
  },
  {
    "function_name": "virCgroupV2DevicesAvailable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroupv2devices.c",
    "lines": "45-63",
    "snippet": "bool\nvirCgroupV2DevicesAvailable(virCgroupPtr group)\n{\n    VIR_AUTOCLOSE cgroupfd = -1;\n    unsigned int progCnt = 0;\n\n    cgroupfd = open(group->unified.mountPoint, O_RDONLY);\n    if (cgroupfd < 0) {\n        VIR_DEBUG(\"failed to open cgroup '%s'\", group->unified.mountPoint);\n        return false;\n    }\n\n    if (virBPFQueryProg(cgroupfd, 0, BPF_CGROUP_DEVICE, &progCnt, NULL) < 0) {\n        VIR_DEBUG(\"failed to query cgroup progs: %s\", g_strerror(errno));\n        return false;\n    }\n\n    return true;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"vircgroupv2devices.h\"",
      "#include \"vircgroup.h\"",
      "#include \"virbpf.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircgrouppriv.h\"",
      "#include \"internal.h\"",
      "# include <sys/types.h>",
      "# include <sys/syscall.h>",
      "# include <sys/stat.h>",
      "# include <linux/bpf.h>",
      "# include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"failed to query cgroup progs: %s\"",
            "g_strerror(errno)"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBPFQueryProg",
          "args": [
            "cgroupfd",
            "0",
            "BPF_CGROUP_DEVICE",
            "&progCnt",
            "NULL"
          ],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "virBPFQueryProg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbpf.c",
          "lines": "340-349",
          "snippet": "int\nvirBPFQueryProg(int targetfd G_GNUC_UNUSED,\n                unsigned int maxprogids G_GNUC_UNUSED,\n                int attachType G_GNUC_UNUSED,\n                unsigned int *progcnt G_GNUC_UNUSED,\n                void *progids G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}",
          "includes": [
            "# include <unistd.h>",
            "# include <sys/syscall.h>",
            "#include \"virbpf.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <unistd.h>\n# include <sys/syscall.h>\n#include \"virbpf.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nint\nvirBPFQueryProg(int targetfd G_GNUC_UNUSED,\n                unsigned int maxprogids G_GNUC_UNUSED,\n                int attachType G_GNUC_UNUSED,\n                unsigned int *progcnt G_GNUC_UNUSED,\n                void *progids G_GNUC_UNUSED)\n{\n    errno = ENOSYS;\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"failed to open cgroup '%s'\"",
            "group->unified.mountPoint"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "group->unified.mountPoint",
            "O_RDONLY"
          ],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"vircgroupv2devices.h\"\n#include \"vircgroup.h\"\n#include \"virbpf.h\"\n#include \"viralloc.h\"\n#include \"vircgrouppriv.h\"\n#include \"internal.h\"\n# include <sys/types.h>\n# include <sys/syscall.h>\n# include <sys/stat.h>\n# include <linux/bpf.h>\n# include <fcntl.h>\n#include <config.h>\n\nbool\nvirCgroupV2DevicesAvailable(virCgroupPtr group)\n{\n    VIR_AUTOCLOSE cgroupfd = -1;\n    unsigned int progCnt = 0;\n\n    cgroupfd = open(group->unified.mountPoint, O_RDONLY);\n    if (cgroupfd < 0) {\n        VIR_DEBUG(\"failed to open cgroup '%s'\", group->unified.mountPoint);\n        return false;\n    }\n\n    if (virBPFQueryProg(cgroupfd, 0, BPF_CGROUP_DEVICE, &progCnt, NULL) < 0) {\n        VIR_DEBUG(\"failed to query cgroup progs: %s\", g_strerror(errno));\n        return false;\n    }\n\n    return true;\n}"
  }
]