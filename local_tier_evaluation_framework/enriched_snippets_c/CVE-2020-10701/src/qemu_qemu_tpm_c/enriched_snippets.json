[
  {
    "function_name": "qemuExtTPMSetupCgroup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "873-903",
    "snippet": "int\nqemuExtTPMSetupCgroup(virQEMUDriverPtr driver,\n                      virDomainDefPtr def,\n                      virCgroupPtr cgroup)\n{\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *shortName = NULL;\n    int rc;\n    pid_t pid;\n\n    switch (def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        shortName = virDomainDefGetShortName(def);\n        if (!shortName)\n            return -1;\n        rc = qemuTPMEmulatorGetPid(cfg->swtpmStateDir, shortName, &pid);\n        if (rc < 0 || (rc == 0 && pid == (pid_t)-1)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Could not get process id of swtpm\"));\n            return -1;\n        }\n        if (virCgroupAddProcess(cgroup, pid) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCgroupAddProcess",
          "args": [
            "cgroup",
            "pid"
          ],
          "line": 894
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupAddProcess",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "2919-2926",
          "snippet": "int\nvirCgroupAddProcess(virCgroupPtr group G_GNUC_UNUSED,\n                    pid_t pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nint\nvirCgroupAddProcess(virCgroupPtr group G_GNUC_UNUSED,\n                    pid_t pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Could not get process id of swtpm\")"
          ],
          "line": 890
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Could not get process id of swtpm\""
          ],
          "line": 891
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorGetPid",
          "args": [
            "cfg->swtpmStateDir",
            "shortName",
            "&pid"
          ],
          "line": 888
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorGetPid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "238-253",
          "snippet": "static int\nqemuTPMEmulatorGetPid(const char *swtpmStateDir,\n                      const char *shortName,\n                      pid_t *pid)\n{\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    g_autofree char *pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir,\n                                                                shortName);\n    if (!pidfile)\n        return -1;\n\n    if (virPidFileReadPathIfAlive(pidfile, pid, swtpm) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorGetPid(const char *swtpmStateDir,\n                      const char *shortName,\n                      pid_t *pid)\n{\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    g_autofree char *pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir,\n                                                                shortName);\n    if (!pidfile)\n        return -1;\n\n    if (virPidFileReadPathIfAlive(pidfile, pid, swtpm) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetShortName",
          "args": [
            "def"
          ],
          "line": 885
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetShortName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30900-30952",
          "snippet": "char *\nvirDomainDefGetShortName(const virDomainDef *def)\n{\n    wchar_t wshortname[VIR_DOMAIN_SHORT_NAME_MAX + 1] = {0};\n    size_t len = 0;\n    char *ret = NULL;\n    g_autofree char *shortname = NULL;\n\n    /* No need to do the whole conversion thing when there are no multibyte\n     * characters.  The same applies for illegal sequences as they can occur\n     * with incompatible locales. */\n    len = mbstowcs(NULL, def->name, 0);\n    if ((len == (size_t) -1 && errno == EILSEQ) ||\n        len == strlen(def->name)) {\n        ret = g_strdup_printf(\"%d-%.*s\", def->id, VIR_DOMAIN_SHORT_NAME_MAX, def->name);\n        return ret;\n    }\n\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    if (mbstowcs(wshortname, def->name, VIR_DOMAIN_SHORT_NAME_MAX) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    len = wcstombs(NULL, wshortname, 0);\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(shortname, len + 1) < 0)\n        return NULL;\n\n    if (wcstombs(shortname, wshortname, len) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    ret = g_strdup_printf(\"%d-%s\", def->id, shortname);\n    return ret;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_DOMAIN_SHORT_NAME_MAX 20"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_DOMAIN_SHORT_NAME_MAX 20\n\nchar *\nvirDomainDefGetShortName(const virDomainDef *def)\n{\n    wchar_t wshortname[VIR_DOMAIN_SHORT_NAME_MAX + 1] = {0};\n    size_t len = 0;\n    char *ret = NULL;\n    g_autofree char *shortname = NULL;\n\n    /* No need to do the whole conversion thing when there are no multibyte\n     * characters.  The same applies for illegal sequences as they can occur\n     * with incompatible locales. */\n    len = mbstowcs(NULL, def->name, 0);\n    if ((len == (size_t) -1 && errno == EILSEQ) ||\n        len == strlen(def->name)) {\n        ret = g_strdup_printf(\"%d-%.*s\", def->id, VIR_DOMAIN_SHORT_NAME_MAX, def->name);\n        return ret;\n    }\n\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    if (mbstowcs(wshortname, def->name, VIR_DOMAIN_SHORT_NAME_MAX) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    len = wcstombs(NULL, wshortname, 0);\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(shortname, len + 1) < 0)\n        return NULL;\n\n    if (wcstombs(shortname, wshortname, len) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    ret = g_strdup_printf(\"%d-%s\", def->id, shortname);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUDriverGetConfig",
          "args": [
            "driver"
          ],
          "line": 878
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_conf.c",
          "lines": "1211-1218",
          "snippet": "virQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virsocket.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virlog.h\"",
            "#include \"virxml.h\"",
            "#include \"datatypes.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"storage_conf.h\"\n#include \"virstring.h\"\n#include \"virsocket.h\"\n#include \"virfile.h\"\n#include \"domain_nwfilter.h\"\n#include \"cpu/cpu.h\"\n#include \"virlog.h\"\n#include \"virxml.h\"\n#include \"datatypes.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"qemu_security.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nint\nqemuExtTPMSetupCgroup(virQEMUDriverPtr driver,\n                      virDomainDefPtr def,\n                      virCgroupPtr cgroup)\n{\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *shortName = NULL;\n    int rc;\n    pid_t pid;\n\n    switch (def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        shortName = virDomainDefGetShortName(def);\n        if (!shortName)\n            return -1;\n        rc = qemuTPMEmulatorGetPid(cfg->swtpmStateDir, shortName, &pid);\n        if (rc < 0 || (rc == 0 && pid == (pid_t)-1)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Could not get process id of swtpm\"));\n            return -1;\n        }\n        if (virCgroupAddProcess(cgroup, pid) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuExtTPMStop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "848-870",
    "snippet": "void\nqemuExtTPMStop(virQEMUDriverPtr driver,\n               virDomainObjPtr vm)\n{\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *shortName = NULL;\n\n    switch (vm->def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        shortName = virDomainDefGetShortName(vm->def);\n        if (!shortName)\n            return;\n\n        qemuTPMEmulatorStop(cfg->swtpmStateDir, shortName);\n        qemuSecurityCleanupTPMEmulator(driver, vm);\n        break;\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuSecurityCleanupTPMEmulator",
          "args": [
            "driver",
            "vm"
          ],
          "line": 862
        },
        "resolved": true,
        "details": {
          "function_name": "qemuSecurityCleanupTPMEmulator",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
          "lines": "556-574",
          "snippet": "void\nqemuSecurityCleanupTPMEmulator(virQEMUDriverPtr driver,\n                               virDomainObjPtr vm)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    bool transactionStarted = false;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreTPMLabels(driver->securityManager, vm->def);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n    virSecurityManagerTransactionAbort(driver->securityManager);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nvoid\nqemuSecurityCleanupTPMEmulator(virQEMUDriverPtr driver,\n                               virDomainObjPtr vm)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    bool transactionStarted = false;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreTPMLabels(driver->securityManager, vm->def);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n    virSecurityManagerTransactionAbort(driver->securityManager);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorStop",
          "args": [
            "cfg->swtpmStateDir",
            "shortName"
          ],
          "line": 861
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorStop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "646-681",
          "snippet": "static void\nqemuTPMEmulatorStop(const char *swtpmStateDir,\n                    const char *shortName)\n{\n    virCommandPtr cmd;\n    g_autofree char *pathname = NULL;\n    g_autofree char *errbuf = NULL;\n    g_autofree char *swtpm_ioctl = virTPMGetSwtpmIoctl();\n\n    if (!swtpm_ioctl)\n        return;\n\n    if (virTPMEmulatorInit() < 0)\n        return;\n\n    if (!(pathname = qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return;\n\n    if (!virFileExists(pathname))\n        return;\n\n    cmd = virCommandNew(swtpm_ioctl);\n    if (!cmd)\n        return;\n\n    virCommandAddArgList(cmd, \"--unix\", pathname, \"-s\", NULL);\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    ignore_value(virCommandRun(cmd, NULL));\n\n    virCommandFree(cmd);\n\n    /* clean up the socket */\n    unlink(pathname);\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic void\nqemuTPMEmulatorStop(const char *swtpmStateDir,\n                    const char *shortName)\n{\n    virCommandPtr cmd;\n    g_autofree char *pathname = NULL;\n    g_autofree char *errbuf = NULL;\n    g_autofree char *swtpm_ioctl = virTPMGetSwtpmIoctl();\n\n    if (!swtpm_ioctl)\n        return;\n\n    if (virTPMEmulatorInit() < 0)\n        return;\n\n    if (!(pathname = qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return;\n\n    if (!virFileExists(pathname))\n        return;\n\n    cmd = virCommandNew(swtpm_ioctl);\n    if (!cmd)\n        return;\n\n    virCommandAddArgList(cmd, \"--unix\", pathname, \"-s\", NULL);\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    ignore_value(virCommandRun(cmd, NULL));\n\n    virCommandFree(cmd);\n\n    /* clean up the socket */\n    unlink(pathname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetShortName",
          "args": [
            "vm->def"
          ],
          "line": 857
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetShortName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30900-30952",
          "snippet": "char *\nvirDomainDefGetShortName(const virDomainDef *def)\n{\n    wchar_t wshortname[VIR_DOMAIN_SHORT_NAME_MAX + 1] = {0};\n    size_t len = 0;\n    char *ret = NULL;\n    g_autofree char *shortname = NULL;\n\n    /* No need to do the whole conversion thing when there are no multibyte\n     * characters.  The same applies for illegal sequences as they can occur\n     * with incompatible locales. */\n    len = mbstowcs(NULL, def->name, 0);\n    if ((len == (size_t) -1 && errno == EILSEQ) ||\n        len == strlen(def->name)) {\n        ret = g_strdup_printf(\"%d-%.*s\", def->id, VIR_DOMAIN_SHORT_NAME_MAX, def->name);\n        return ret;\n    }\n\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    if (mbstowcs(wshortname, def->name, VIR_DOMAIN_SHORT_NAME_MAX) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    len = wcstombs(NULL, wshortname, 0);\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(shortname, len + 1) < 0)\n        return NULL;\n\n    if (wcstombs(shortname, wshortname, len) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    ret = g_strdup_printf(\"%d-%s\", def->id, shortname);\n    return ret;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_DOMAIN_SHORT_NAME_MAX 20"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_DOMAIN_SHORT_NAME_MAX 20\n\nchar *\nvirDomainDefGetShortName(const virDomainDef *def)\n{\n    wchar_t wshortname[VIR_DOMAIN_SHORT_NAME_MAX + 1] = {0};\n    size_t len = 0;\n    char *ret = NULL;\n    g_autofree char *shortname = NULL;\n\n    /* No need to do the whole conversion thing when there are no multibyte\n     * characters.  The same applies for illegal sequences as they can occur\n     * with incompatible locales. */\n    len = mbstowcs(NULL, def->name, 0);\n    if ((len == (size_t) -1 && errno == EILSEQ) ||\n        len == strlen(def->name)) {\n        ret = g_strdup_printf(\"%d-%.*s\", def->id, VIR_DOMAIN_SHORT_NAME_MAX, def->name);\n        return ret;\n    }\n\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    if (mbstowcs(wshortname, def->name, VIR_DOMAIN_SHORT_NAME_MAX) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    len = wcstombs(NULL, wshortname, 0);\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(shortname, len + 1) < 0)\n        return NULL;\n\n    if (wcstombs(shortname, wshortname, len) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    ret = g_strdup_printf(\"%d-%s\", def->id, shortname);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUDriverGetConfig",
          "args": [
            "driver"
          ],
          "line": 852
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_conf.c",
          "lines": "1211-1218",
          "snippet": "virQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virsocket.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virlog.h\"",
            "#include \"virxml.h\"",
            "#include \"datatypes.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"storage_conf.h\"\n#include \"virstring.h\"\n#include \"virsocket.h\"\n#include \"virfile.h\"\n#include \"domain_nwfilter.h\"\n#include \"cpu/cpu.h\"\n#include \"virlog.h\"\n#include \"virxml.h\"\n#include \"datatypes.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"qemu_security.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nvoid\nqemuExtTPMStop(virQEMUDriverPtr driver,\n               virDomainObjPtr vm)\n{\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *shortName = NULL;\n\n    switch (vm->def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        shortName = virDomainDefGetShortName(vm->def);\n        if (!shortName)\n            return;\n\n        qemuTPMEmulatorStop(cfg->swtpmStateDir, shortName);\n        qemuSecurityCleanupTPMEmulator(driver, vm);\n        break;\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return;\n}"
  },
  {
    "function_name": "qemuExtTPMStart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "828-845",
    "snippet": "int\nqemuExtTPMStart(virQEMUDriverPtr driver,\n                virDomainObjPtr vm,\n                bool incomingMigration)\n{\n    virDomainTPMDefPtr tpm = vm->def->tpm;\n\n    switch (tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        return qemuExtTPMStartEmulator(driver, vm, incomingMigration);\n\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuExtTPMStartEmulator",
          "args": [
            "driver",
            "vm",
            "incomingMigration"
          ],
          "line": 837
        },
        "resolved": true,
        "details": {
          "function_name": "qemuExtTPMStartEmulator",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "756-825",
          "snippet": "static int\nqemuExtTPMStartEmulator(virQEMUDriverPtr driver,\n                        virDomainObjPtr vm,\n                        bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    int exitstatus = 0;\n    g_autofree char *errbuf = NULL;\n    g_autoptr(virQEMUDriverConfig) cfg = NULL;\n    virDomainTPMDefPtr tpm = vm->def->tpm;\n    g_autofree char *shortName = virDomainDefGetShortName(vm->def);\n    int cmdret = 0, timeout, rc;\n    pid_t pid;\n\n    if (!shortName)\n        return -1;\n\n    cfg = virQEMUDriverGetConfig(driver);\n\n    /* stop any left-over TPM emulator for this VM */\n    qemuTPMEmulatorStop(cfg->swtpmStateDir, shortName);\n\n    if (!(cmd = qemuTPMEmulatorBuildCommand(tpm, vm->def->name, vm->def->uuid,\n                                            driver->privileged,\n                                            cfg->swtpm_user,\n                                            cfg->swtpm_group,\n                                            cfg->swtpmStateDir, shortName,\n                                            incomingMigration)))\n        return -1;\n\n    if (qemuExtDeviceLogCommand(driver, vm, cmd, \"TPM Emulator\") < 0)\n        return -1;\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    if (qemuSecurityStartTPMEmulator(driver, vm, cmd,\n                                     cfg->swtpm_user, cfg->swtpm_group,\n                                     &exitstatus, &cmdret) < 0)\n        return -1;\n\n    if (cmdret < 0 || exitstatus != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not start 'swtpm'. exitstatus: %d, \"\n                         \"error: %s\"), exitstatus, errbuf);\n        return -1;\n    }\n\n    /* check that the swtpm has written its pid into the file */\n    timeout = 1000; /* ms */\n    while (timeout > 0) {\n        rc = qemuTPMEmulatorGetPid(cfg->swtpmStateDir, shortName, &pid);\n        if (rc < 0) {\n            timeout -= 50;\n            g_usleep(50 * 1000);\n            continue;\n        }\n        if (rc == 0 && pid == (pid_t)-1)\n            goto error;\n        break;\n    }\n    if (timeout <= 0)\n        goto error;\n\n    return 0;\n\n error:\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"swtpm failed to start\"));\n    return -1;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuExtTPMStartEmulator(virQEMUDriverPtr driver,\n                        virDomainObjPtr vm,\n                        bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    int exitstatus = 0;\n    g_autofree char *errbuf = NULL;\n    g_autoptr(virQEMUDriverConfig) cfg = NULL;\n    virDomainTPMDefPtr tpm = vm->def->tpm;\n    g_autofree char *shortName = virDomainDefGetShortName(vm->def);\n    int cmdret = 0, timeout, rc;\n    pid_t pid;\n\n    if (!shortName)\n        return -1;\n\n    cfg = virQEMUDriverGetConfig(driver);\n\n    /* stop any left-over TPM emulator for this VM */\n    qemuTPMEmulatorStop(cfg->swtpmStateDir, shortName);\n\n    if (!(cmd = qemuTPMEmulatorBuildCommand(tpm, vm->def->name, vm->def->uuid,\n                                            driver->privileged,\n                                            cfg->swtpm_user,\n                                            cfg->swtpm_group,\n                                            cfg->swtpmStateDir, shortName,\n                                            incomingMigration)))\n        return -1;\n\n    if (qemuExtDeviceLogCommand(driver, vm, cmd, \"TPM Emulator\") < 0)\n        return -1;\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    if (qemuSecurityStartTPMEmulator(driver, vm, cmd,\n                                     cfg->swtpm_user, cfg->swtpm_group,\n                                     &exitstatus, &cmdret) < 0)\n        return -1;\n\n    if (cmdret < 0 || exitstatus != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not start 'swtpm'. exitstatus: %d, \"\n                         \"error: %s\"), exitstatus, errbuf);\n        return -1;\n    }\n\n    /* check that the swtpm has written its pid into the file */\n    timeout = 1000; /* ms */\n    while (timeout > 0) {\n        rc = qemuTPMEmulatorGetPid(cfg->swtpmStateDir, shortName, &pid);\n        if (rc < 0) {\n            timeout -= 50;\n            g_usleep(50 * 1000);\n            continue;\n        }\n        if (rc == 0 && pid == (pid_t)-1)\n            goto error;\n        break;\n    }\n    if (timeout <= 0)\n        goto error;\n\n    return 0;\n\n error:\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"swtpm failed to start\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nint\nqemuExtTPMStart(virQEMUDriverPtr driver,\n                virDomainObjPtr vm,\n                bool incomingMigration)\n{\n    virDomainTPMDefPtr tpm = vm->def->tpm;\n\n    switch (tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        return qemuExtTPMStartEmulator(driver, vm, incomingMigration);\n\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuExtTPMStartEmulator",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "756-825",
    "snippet": "static int\nqemuExtTPMStartEmulator(virQEMUDriverPtr driver,\n                        virDomainObjPtr vm,\n                        bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    int exitstatus = 0;\n    g_autofree char *errbuf = NULL;\n    g_autoptr(virQEMUDriverConfig) cfg = NULL;\n    virDomainTPMDefPtr tpm = vm->def->tpm;\n    g_autofree char *shortName = virDomainDefGetShortName(vm->def);\n    int cmdret = 0, timeout, rc;\n    pid_t pid;\n\n    if (!shortName)\n        return -1;\n\n    cfg = virQEMUDriverGetConfig(driver);\n\n    /* stop any left-over TPM emulator for this VM */\n    qemuTPMEmulatorStop(cfg->swtpmStateDir, shortName);\n\n    if (!(cmd = qemuTPMEmulatorBuildCommand(tpm, vm->def->name, vm->def->uuid,\n                                            driver->privileged,\n                                            cfg->swtpm_user,\n                                            cfg->swtpm_group,\n                                            cfg->swtpmStateDir, shortName,\n                                            incomingMigration)))\n        return -1;\n\n    if (qemuExtDeviceLogCommand(driver, vm, cmd, \"TPM Emulator\") < 0)\n        return -1;\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    if (qemuSecurityStartTPMEmulator(driver, vm, cmd,\n                                     cfg->swtpm_user, cfg->swtpm_group,\n                                     &exitstatus, &cmdret) < 0)\n        return -1;\n\n    if (cmdret < 0 || exitstatus != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not start 'swtpm'. exitstatus: %d, \"\n                         \"error: %s\"), exitstatus, errbuf);\n        return -1;\n    }\n\n    /* check that the swtpm has written its pid into the file */\n    timeout = 1000; /* ms */\n    while (timeout > 0) {\n        rc = qemuTPMEmulatorGetPid(cfg->swtpmStateDir, shortName, &pid);\n        if (rc < 0) {\n            timeout -= 50;\n            g_usleep(50 * 1000);\n            continue;\n        }\n        if (rc == 0 && pid == (pid_t)-1)\n            goto error;\n        break;\n    }\n    if (timeout <= 0)\n        goto error;\n\n    return 0;\n\n error:\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"swtpm failed to start\"));\n    return -1;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"swtpm failed to start\")"
          ],
          "line": 822
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"swtpm failed to start\""
          ],
          "line": 823
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_usleep",
          "args": [
            "50 * 1000"
          ],
          "line": 809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorGetPid",
          "args": [
            "cfg->swtpmStateDir",
            "shortName",
            "&pid"
          ],
          "line": 806
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorGetPid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "238-253",
          "snippet": "static int\nqemuTPMEmulatorGetPid(const char *swtpmStateDir,\n                      const char *shortName,\n                      pid_t *pid)\n{\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    g_autofree char *pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir,\n                                                                shortName);\n    if (!pidfile)\n        return -1;\n\n    if (virPidFileReadPathIfAlive(pidfile, pid, swtpm) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorGetPid(const char *swtpmStateDir,\n                      const char *shortName,\n                      pid_t *pid)\n{\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    g_autofree char *pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir,\n                                                                shortName);\n    if (!pidfile)\n        return -1;\n\n    if (virPidFileReadPathIfAlive(pidfile, pid, swtpm) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Could not start 'swtpm'. exitstatus: %d, \"\n                         \"error: %s\")",
            "exitstatus",
            "errbuf"
          ],
          "line": 797
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuSecurityStartTPMEmulator",
          "args": [
            "driver",
            "vm",
            "cmd",
            "cfg->swtpm_user",
            "cfg->swtpm_group",
            "&exitstatus",
            "&cmdret"
          ],
          "line": 791
        },
        "resolved": true,
        "details": {
          "function_name": "qemuSecurityStartTPMEmulator",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_security.c",
          "lines": "500-553",
          "snippet": "int\nqemuSecurityStartTPMEmulator(virQEMUDriverPtr driver,\n                             virDomainObjPtr vm,\n                             virCommandPtr cmd,\n                             uid_t uid,\n                             gid_t gid,\n                             int *exitstatus,\n                             int *cmdret)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    int ret = -1;\n    bool transactionStarted = false;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        return -1;\n    transactionStarted = true;\n\n    if (virSecurityManagerSetTPMLabels(driver->securityManager,\n                                       vm->def) < 0) {\n        virSecurityManagerTransactionAbort(driver->securityManager);\n        return -1;\n    }\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        goto cleanup_abort;\n    transactionStarted = false;\n\n    if (qemuSecurityCommandRun(driver, vm, cmd, uid, gid, exitstatus, cmdret) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n    if (*cmdret < 0)\n        goto cleanup;\n\n    return 0;\n\n cleanup:\n    if (!transactionStarted &&\n        virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreTPMLabels(driver->securityManager, vm->def);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n cleanup_abort:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include <config.h>\n\nint\nqemuSecurityStartTPMEmulator(virQEMUDriverPtr driver,\n                             virDomainObjPtr vm,\n                             virCommandPtr cmd,\n                             uid_t uid,\n                             gid_t gid,\n                             int *exitstatus,\n                             int *cmdret)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    int ret = -1;\n    bool transactionStarted = false;\n\n    if (virSecurityManagerTransactionStart(driver->securityManager) < 0)\n        return -1;\n    transactionStarted = true;\n\n    if (virSecurityManagerSetTPMLabels(driver->securityManager,\n                                       vm->def) < 0) {\n        virSecurityManagerTransactionAbort(driver->securityManager);\n        return -1;\n    }\n\n    if (virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        goto cleanup_abort;\n    transactionStarted = false;\n\n    if (qemuSecurityCommandRun(driver, vm, cmd, uid, gid, exitstatus, cmdret) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n    if (*cmdret < 0)\n        goto cleanup;\n\n    return 0;\n\n cleanup:\n    if (!transactionStarted &&\n        virSecurityManagerTransactionStart(driver->securityManager) >= 0)\n        transactionStarted = true;\n\n    virSecurityManagerRestoreTPMLabels(driver->securityManager, vm->def);\n\n    if (transactionStarted &&\n        virSecurityManagerTransactionCommit(driver->securityManager,\n                                            -1, priv->rememberOwner) < 0)\n        VIR_WARN(\"Unable to run security manager transaction\");\n\n cleanup_abort:\n    virSecurityManagerTransactionAbort(driver->securityManager);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetErrorBuffer",
          "args": [
            "cmd",
            "&errbuf"
          ],
          "line": 789
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetErrorBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1903-1918",
          "snippet": "void\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuExtDeviceLogCommand",
          "args": [
            "driver",
            "vm",
            "cmd",
            "\"TPM Emulator\""
          ],
          "line": 786
        },
        "resolved": true,
        "details": {
          "function_name": "qemuExtDeviceLogCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_extdevice.c",
          "lines": "42-57",
          "snippet": "int\nqemuExtDeviceLogCommand(virQEMUDriverPtr driver,\n                        virDomainObjPtr vm,\n                        virCommandPtr cmd,\n                        const char *info)\n{\n    g_autofree char *timestamp = virTimeStringNow();\n    g_autofree char *cmds = virCommandToString(cmd, false);\n\n    if (!timestamp || !cmds)\n        return -1;\n\n    return qemuDomainLogAppendMessage(driver, vm,\n                                      _(\"%s: Starting external device: %s\\n%s\\n\"),\n                                      timestamp, info, cmds);\n}",
          "includes": [
            "#include \"virpidfile.h\"",
            "#include \"virtpm.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_virtiofs.h\"",
            "#include \"qemu_slirp.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_vhost_user_gpu.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_command.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virpidfile.h\"\n#include \"virtpm.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_virtiofs.h\"\n#include \"qemu_slirp.h\"\n#include \"qemu_tpm.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_vhost_user_gpu.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_command.h\"\n#include <config.h>\n\nint\nqemuExtDeviceLogCommand(virQEMUDriverPtr driver,\n                        virDomainObjPtr vm,\n                        virCommandPtr cmd,\n                        const char *info)\n{\n    g_autofree char *timestamp = virTimeStringNow();\n    g_autofree char *cmds = virCommandToString(cmd, false);\n\n    if (!timestamp || !cmds)\n        return -1;\n\n    return qemuDomainLogAppendMessage(driver, vm,\n                                      _(\"%s: Starting external device: %s\\n%s\\n\"),\n                                      timestamp, info, cmds);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorBuildCommand",
          "args": [
            "tpm",
            "vm->def->name",
            "vm->def->uuid",
            "driver->privileged",
            "cfg->swtpm_user",
            "cfg->swtpm_group",
            "cfg->swtpmStateDir",
            "shortName",
            "incomingMigration"
          ],
          "line": 778
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorBuildCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "526-636",
          "snippet": "static virCommandPtr\nqemuTPMEmulatorBuildCommand(virDomainTPMDefPtr tpm,\n                            const char *vmname,\n                            const unsigned char *vmuuid,\n                            bool privileged,\n                            uid_t swtpm_user,\n                            gid_t swtpm_group,\n                            const char *swtpmStateDir,\n                            const char *shortName,\n                            bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    bool created = false;\n    g_autofree char *pidfile = NULL;\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    VIR_AUTOCLOSE pwdfile_fd = -1;\n    VIR_AUTOCLOSE migpwdfile_fd = -1;\n    const unsigned char *secretuuid = NULL;\n\n    if (!swtpm)\n        return NULL;\n\n    if (qemuTPMCreateEmulatorStorage(tpm->data.emulator.storagepath,\n                                     &created, swtpm_user, swtpm_group) < 0)\n        return NULL;\n\n    if (tpm->data.emulator.hassecretuuid)\n        secretuuid = tpm->data.emulator.secretuuid;\n\n    if (created &&\n        qemuTPMEmulatorRunSetup(tpm->data.emulator.storagepath, vmname, vmuuid,\n                                privileged, swtpm_user, swtpm_group,\n                                tpm->data.emulator.logfile, tpm->version,\n                                secretuuid, incomingMigration) < 0)\n        goto error;\n\n    unlink(tpm->data.emulator.source.data.nix.path);\n\n    cmd = virCommandNew(swtpm);\n    if (!cmd)\n        goto error;\n\n    virCommandClearCaps(cmd);\n\n    virCommandAddArgList(cmd, \"socket\", \"--daemon\", \"--ctrl\", NULL);\n    virCommandAddArgFormat(cmd, \"type=unixio,path=%s,mode=0600\",\n                           tpm->data.emulator.source.data.nix.path);\n\n    virCommandAddArg(cmd, \"--tpmstate\");\n    virCommandAddArgFormat(cmd, \"dir=%s,mode=0600\",\n                           tpm->data.emulator.storagepath);\n\n    virCommandAddArg(cmd, \"--log\");\n    virCommandAddArgFormat(cmd, \"file=%s\", tpm->data.emulator.logfile);\n\n    virCommandSetUID(cmd, swtpm_user);\n    virCommandSetGID(cmd, swtpm_group);\n\n    switch (tpm->version) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        virCommandAddArg(cmd, \"--tpm2\");\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        break;\n    }\n\n    if (!(pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir, shortName)))\n        goto error;\n\n    virCommandAddArg(cmd, \"--pid\");\n    virCommandAddArgFormat(cmd, \"file=%s\", pidfile);\n\n    if (tpm->data.emulator.hassecretuuid) {\n        if (!virTPMSwtpmCapsGet(VIR_TPM_SWTPM_FEATURE_CMDARG_PWD_FD)) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                  _(\"%s does not support passing passphrase via file descriptor\"),\n                  swtpm);\n            goto error;\n        }\n\n        pwdfile_fd = qemuTPMSetupEncryption(tpm->data.emulator.secretuuid, cmd);\n        if (pwdfile_fd)\n        migpwdfile_fd = qemuTPMSetupEncryption(tpm->data.emulator.secretuuid,\n                                               cmd);\n        if (pwdfile_fd < 0 || migpwdfile_fd < 0)\n            goto error;\n\n        virCommandAddArg(cmd, \"--key\");\n        virCommandAddArgFormat(cmd, \"pwdfd=%d,mode=aes-256-cbc\",\n                               pwdfile_fd);\n        virCommandPassFD(cmd, pwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        pwdfile_fd = -1;\n\n        virCommandAddArg(cmd, \"--migration-key\");\n        virCommandAddArgFormat(cmd, \"pwdfd=%d,mode=aes-256-cbc\",\n                               migpwdfile_fd);\n        virCommandPassFD(cmd, migpwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        migpwdfile_fd = -1;\n    }\n\n    return g_steal_pointer(&cmd);\n\n error:\n    if (created)\n        qemuTPMDeleteEmulatorStorage(tpm);\n\n    return NULL;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virCommandPtr\nqemuTPMEmulatorBuildCommand(virDomainTPMDefPtr tpm,\n                            const char *vmname,\n                            const unsigned char *vmuuid,\n                            bool privileged,\n                            uid_t swtpm_user,\n                            gid_t swtpm_group,\n                            const char *swtpmStateDir,\n                            const char *shortName,\n                            bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    bool created = false;\n    g_autofree char *pidfile = NULL;\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    VIR_AUTOCLOSE pwdfile_fd = -1;\n    VIR_AUTOCLOSE migpwdfile_fd = -1;\n    const unsigned char *secretuuid = NULL;\n\n    if (!swtpm)\n        return NULL;\n\n    if (qemuTPMCreateEmulatorStorage(tpm->data.emulator.storagepath,\n                                     &created, swtpm_user, swtpm_group) < 0)\n        return NULL;\n\n    if (tpm->data.emulator.hassecretuuid)\n        secretuuid = tpm->data.emulator.secretuuid;\n\n    if (created &&\n        qemuTPMEmulatorRunSetup(tpm->data.emulator.storagepath, vmname, vmuuid,\n                                privileged, swtpm_user, swtpm_group,\n                                tpm->data.emulator.logfile, tpm->version,\n                                secretuuid, incomingMigration) < 0)\n        goto error;\n\n    unlink(tpm->data.emulator.source.data.nix.path);\n\n    cmd = virCommandNew(swtpm);\n    if (!cmd)\n        goto error;\n\n    virCommandClearCaps(cmd);\n\n    virCommandAddArgList(cmd, \"socket\", \"--daemon\", \"--ctrl\", NULL);\n    virCommandAddArgFormat(cmd, \"type=unixio,path=%s,mode=0600\",\n                           tpm->data.emulator.source.data.nix.path);\n\n    virCommandAddArg(cmd, \"--tpmstate\");\n    virCommandAddArgFormat(cmd, \"dir=%s,mode=0600\",\n                           tpm->data.emulator.storagepath);\n\n    virCommandAddArg(cmd, \"--log\");\n    virCommandAddArgFormat(cmd, \"file=%s\", tpm->data.emulator.logfile);\n\n    virCommandSetUID(cmd, swtpm_user);\n    virCommandSetGID(cmd, swtpm_group);\n\n    switch (tpm->version) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        virCommandAddArg(cmd, \"--tpm2\");\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        break;\n    }\n\n    if (!(pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir, shortName)))\n        goto error;\n\n    virCommandAddArg(cmd, \"--pid\");\n    virCommandAddArgFormat(cmd, \"file=%s\", pidfile);\n\n    if (tpm->data.emulator.hassecretuuid) {\n        if (!virTPMSwtpmCapsGet(VIR_TPM_SWTPM_FEATURE_CMDARG_PWD_FD)) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                  _(\"%s does not support passing passphrase via file descriptor\"),\n                  swtpm);\n            goto error;\n        }\n\n        pwdfile_fd = qemuTPMSetupEncryption(tpm->data.emulator.secretuuid, cmd);\n        if (pwdfile_fd)\n        migpwdfile_fd = qemuTPMSetupEncryption(tpm->data.emulator.secretuuid,\n                                               cmd);\n        if (pwdfile_fd < 0 || migpwdfile_fd < 0)\n            goto error;\n\n        virCommandAddArg(cmd, \"--key\");\n        virCommandAddArgFormat(cmd, \"pwdfd=%d,mode=aes-256-cbc\",\n                               pwdfile_fd);\n        virCommandPassFD(cmd, pwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        pwdfile_fd = -1;\n\n        virCommandAddArg(cmd, \"--migration-key\");\n        virCommandAddArgFormat(cmd, \"pwdfd=%d,mode=aes-256-cbc\",\n                               migpwdfile_fd);\n        virCommandPassFD(cmd, migpwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        migpwdfile_fd = -1;\n    }\n\n    return g_steal_pointer(&cmd);\n\n error:\n    if (created)\n        qemuTPMDeleteEmulatorStorage(tpm);\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorStop",
          "args": [
            "cfg->swtpmStateDir",
            "shortName"
          ],
          "line": 776
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorStop",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "646-681",
          "snippet": "static void\nqemuTPMEmulatorStop(const char *swtpmStateDir,\n                    const char *shortName)\n{\n    virCommandPtr cmd;\n    g_autofree char *pathname = NULL;\n    g_autofree char *errbuf = NULL;\n    g_autofree char *swtpm_ioctl = virTPMGetSwtpmIoctl();\n\n    if (!swtpm_ioctl)\n        return;\n\n    if (virTPMEmulatorInit() < 0)\n        return;\n\n    if (!(pathname = qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return;\n\n    if (!virFileExists(pathname))\n        return;\n\n    cmd = virCommandNew(swtpm_ioctl);\n    if (!cmd)\n        return;\n\n    virCommandAddArgList(cmd, \"--unix\", pathname, \"-s\", NULL);\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    ignore_value(virCommandRun(cmd, NULL));\n\n    virCommandFree(cmd);\n\n    /* clean up the socket */\n    unlink(pathname);\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic void\nqemuTPMEmulatorStop(const char *swtpmStateDir,\n                    const char *shortName)\n{\n    virCommandPtr cmd;\n    g_autofree char *pathname = NULL;\n    g_autofree char *errbuf = NULL;\n    g_autofree char *swtpm_ioctl = virTPMGetSwtpmIoctl();\n\n    if (!swtpm_ioctl)\n        return;\n\n    if (virTPMEmulatorInit() < 0)\n        return;\n\n    if (!(pathname = qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return;\n\n    if (!virFileExists(pathname))\n        return;\n\n    cmd = virCommandNew(swtpm_ioctl);\n    if (!cmd)\n        return;\n\n    virCommandAddArgList(cmd, \"--unix\", pathname, \"-s\", NULL);\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    ignore_value(virCommandRun(cmd, NULL));\n\n    virCommandFree(cmd);\n\n    /* clean up the socket */\n    unlink(pathname);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUDriverGetConfig",
          "args": [
            "driver"
          ],
          "line": 773
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_conf.c",
          "lines": "1211-1218",
          "snippet": "virQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virsocket.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virlog.h\"",
            "#include \"virxml.h\"",
            "#include \"datatypes.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"storage_conf.h\"\n#include \"virstring.h\"\n#include \"virsocket.h\"\n#include \"virfile.h\"\n#include \"domain_nwfilter.h\"\n#include \"cpu/cpu.h\"\n#include \"virlog.h\"\n#include \"virxml.h\"\n#include \"datatypes.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"qemu_security.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetShortName",
          "args": [
            "vm->def"
          ],
          "line": 766
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetShortName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30900-30952",
          "snippet": "char *\nvirDomainDefGetShortName(const virDomainDef *def)\n{\n    wchar_t wshortname[VIR_DOMAIN_SHORT_NAME_MAX + 1] = {0};\n    size_t len = 0;\n    char *ret = NULL;\n    g_autofree char *shortname = NULL;\n\n    /* No need to do the whole conversion thing when there are no multibyte\n     * characters.  The same applies for illegal sequences as they can occur\n     * with incompatible locales. */\n    len = mbstowcs(NULL, def->name, 0);\n    if ((len == (size_t) -1 && errno == EILSEQ) ||\n        len == strlen(def->name)) {\n        ret = g_strdup_printf(\"%d-%.*s\", def->id, VIR_DOMAIN_SHORT_NAME_MAX, def->name);\n        return ret;\n    }\n\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    if (mbstowcs(wshortname, def->name, VIR_DOMAIN_SHORT_NAME_MAX) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    len = wcstombs(NULL, wshortname, 0);\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(shortname, len + 1) < 0)\n        return NULL;\n\n    if (wcstombs(shortname, wshortname, len) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    ret = g_strdup_printf(\"%d-%s\", def->id, shortname);\n    return ret;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_DOMAIN_SHORT_NAME_MAX 20"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_DOMAIN_SHORT_NAME_MAX 20\n\nchar *\nvirDomainDefGetShortName(const virDomainDef *def)\n{\n    wchar_t wshortname[VIR_DOMAIN_SHORT_NAME_MAX + 1] = {0};\n    size_t len = 0;\n    char *ret = NULL;\n    g_autofree char *shortname = NULL;\n\n    /* No need to do the whole conversion thing when there are no multibyte\n     * characters.  The same applies for illegal sequences as they can occur\n     * with incompatible locales. */\n    len = mbstowcs(NULL, def->name, 0);\n    if ((len == (size_t) -1 && errno == EILSEQ) ||\n        len == strlen(def->name)) {\n        ret = g_strdup_printf(\"%d-%.*s\", def->id, VIR_DOMAIN_SHORT_NAME_MAX, def->name);\n        return ret;\n    }\n\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    if (mbstowcs(wshortname, def->name, VIR_DOMAIN_SHORT_NAME_MAX) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    len = wcstombs(NULL, wshortname, 0);\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(shortname, len + 1) < 0)\n        return NULL;\n\n    if (wcstombs(shortname, wshortname, len) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    ret = g_strdup_printf(\"%d-%s\", def->id, shortname);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuExtTPMStartEmulator(virQEMUDriverPtr driver,\n                        virDomainObjPtr vm,\n                        bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    int exitstatus = 0;\n    g_autofree char *errbuf = NULL;\n    g_autoptr(virQEMUDriverConfig) cfg = NULL;\n    virDomainTPMDefPtr tpm = vm->def->tpm;\n    g_autofree char *shortName = virDomainDefGetShortName(vm->def);\n    int cmdret = 0, timeout, rc;\n    pid_t pid;\n\n    if (!shortName)\n        return -1;\n\n    cfg = virQEMUDriverGetConfig(driver);\n\n    /* stop any left-over TPM emulator for this VM */\n    qemuTPMEmulatorStop(cfg->swtpmStateDir, shortName);\n\n    if (!(cmd = qemuTPMEmulatorBuildCommand(tpm, vm->def->name, vm->def->uuid,\n                                            driver->privileged,\n                                            cfg->swtpm_user,\n                                            cfg->swtpm_group,\n                                            cfg->swtpmStateDir, shortName,\n                                            incomingMigration)))\n        return -1;\n\n    if (qemuExtDeviceLogCommand(driver, vm, cmd, \"TPM Emulator\") < 0)\n        return -1;\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    if (qemuSecurityStartTPMEmulator(driver, vm, cmd,\n                                     cfg->swtpm_user, cfg->swtpm_group,\n                                     &exitstatus, &cmdret) < 0)\n        return -1;\n\n    if (cmdret < 0 || exitstatus != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not start 'swtpm'. exitstatus: %d, \"\n                         \"error: %s\"), exitstatus, errbuf);\n        return -1;\n    }\n\n    /* check that the swtpm has written its pid into the file */\n    timeout = 1000; /* ms */\n    while (timeout > 0) {\n        rc = qemuTPMEmulatorGetPid(cfg->swtpmStateDir, shortName, &pid);\n        if (rc < 0) {\n            timeout -= 50;\n            g_usleep(50 * 1000);\n            continue;\n        }\n        if (rc == 0 && pid == (pid_t)-1)\n            goto error;\n        break;\n    }\n    if (timeout <= 0)\n        goto error;\n\n    return 0;\n\n error:\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"swtpm failed to start\"));\n    return -1;\n}"
  },
  {
    "function_name": "qemuExtTPMCleanupHost",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "730-742",
    "snippet": "void\nqemuExtTPMCleanupHost(virDomainDefPtr def)\n{\n    switch (def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        qemuTPMDeleteEmulatorStorage(def->tpm);\n        break;\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        /* nothing to do */\n        break;\n    }\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuTPMDeleteEmulatorStorage",
          "args": [
            "def->tpm"
          ],
          "line": 735
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMDeleteEmulatorStorage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "153-159",
          "snippet": "static void\nqemuTPMDeleteEmulatorStorage(virDomainTPMDefPtr tpm)\n{\n    g_autofree char *path =  g_path_get_dirname(tpm->data.emulator.storagepath);\n\n    ignore_value(virFileDeleteTree(path));\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic void\nqemuTPMDeleteEmulatorStorage(virDomainTPMDefPtr tpm)\n{\n    g_autofree char *path =  g_path_get_dirname(tpm->data.emulator.storagepath);\n\n    ignore_value(virFileDeleteTree(path));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nvoid\nqemuExtTPMCleanupHost(virDomainDefPtr def)\n{\n    switch (def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        qemuTPMDeleteEmulatorStorage(def->tpm);\n        break;\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        /* nothing to do */\n        break;\n    }\n}"
  },
  {
    "function_name": "qemuExtTPMPrepareHost",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "703-727",
    "snippet": "int\nqemuExtTPMPrepareHost(virQEMUDriverPtr driver,\n                      virDomainDefPtr def)\n{\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *shortName = NULL;\n\n    switch (def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        shortName = virDomainDefGetShortName(def);\n        if (!shortName)\n            return -1;\n\n        return qemuTPMEmulatorPrepareHost(def->tpm, cfg->swtpmLogDir,\n                                          def->name, cfg->swtpm_user,\n                                          cfg->swtpm_group,\n                                          cfg->swtpmStateDir, cfg->user,\n                                          shortName);\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuTPMEmulatorPrepareHost",
          "args": [
            "def->tpm",
            "cfg->swtpmLogDir",
            "def->name",
            "cfg->swtpm_user",
            "cfg->swtpm_group",
            "cfg->swtpmStateDir",
            "cfg->user",
            "shortName"
          ],
          "line": 716
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorPrepareHost",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "272-330",
          "snippet": "static int\nqemuTPMEmulatorPrepareHost(virDomainTPMDefPtr tpm,\n                           const char *logDir,\n                           const char *vmname,\n                           uid_t swtpm_user,\n                           gid_t swtpm_group,\n                           const char *swtpmStateDir,\n                           uid_t qemu_user,\n                           const char *shortName)\n{\n    if (virTPMEmulatorInit() < 0)\n        return -1;\n\n    /* create log dir ... allow 'tss' user to cd into it */\n    if (virFileMakePathWithMode(logDir, 0711) < 0)\n        return -1;\n\n    /* ... and adjust ownership */\n    if (virDirCreate(logDir, 0730, swtpm_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0)\n        return -1;\n\n    /* create logfile name ... */\n    if (!tpm->data.emulator.logfile)\n        tpm->data.emulator.logfile = g_strdup_printf(\"%s/%s-swtpm.log\", logDir, vmname);\n\n    if (!virFileExists(tpm->data.emulator.logfile) &&\n        virFileTouch(tpm->data.emulator.logfile, 0644) < 0) {\n        return -1;\n    }\n\n    /* ... and make sure it can be accessed by swtpm_user */\n    if (chown(tpm->data.emulator.logfile, swtpm_user, swtpm_group) < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not chown on swtpm logfile %s\"),\n                             tpm->data.emulator.logfile);\n        return -1;\n    }\n\n    /*\n      create our swtpm state dir ...\n      - QEMU user needs to be able to access the socket there\n      - swtpm group needs to be able to create files there\n      - in privileged mode 0570 would be enough, for non-privileged mode\n        we need 0770\n    */\n    if (virDirCreate(swtpmStateDir, 0770, qemu_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0)\n        return -1;\n\n    /* create the socket filename */\n    if (!tpm->data.emulator.source.data.nix.path &&\n        !(tpm->data.emulator.source.data.nix.path =\n          qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return -1;\n    tpm->data.emulator.source.type = VIR_DOMAIN_CHR_TYPE_UNIX;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorPrepareHost(virDomainTPMDefPtr tpm,\n                           const char *logDir,\n                           const char *vmname,\n                           uid_t swtpm_user,\n                           gid_t swtpm_group,\n                           const char *swtpmStateDir,\n                           uid_t qemu_user,\n                           const char *shortName)\n{\n    if (virTPMEmulatorInit() < 0)\n        return -1;\n\n    /* create log dir ... allow 'tss' user to cd into it */\n    if (virFileMakePathWithMode(logDir, 0711) < 0)\n        return -1;\n\n    /* ... and adjust ownership */\n    if (virDirCreate(logDir, 0730, swtpm_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0)\n        return -1;\n\n    /* create logfile name ... */\n    if (!tpm->data.emulator.logfile)\n        tpm->data.emulator.logfile = g_strdup_printf(\"%s/%s-swtpm.log\", logDir, vmname);\n\n    if (!virFileExists(tpm->data.emulator.logfile) &&\n        virFileTouch(tpm->data.emulator.logfile, 0644) < 0) {\n        return -1;\n    }\n\n    /* ... and make sure it can be accessed by swtpm_user */\n    if (chown(tpm->data.emulator.logfile, swtpm_user, swtpm_group) < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not chown on swtpm logfile %s\"),\n                             tpm->data.emulator.logfile);\n        return -1;\n    }\n\n    /*\n      create our swtpm state dir ...\n      - QEMU user needs to be able to access the socket there\n      - swtpm group needs to be able to create files there\n      - in privileged mode 0570 would be enough, for non-privileged mode\n        we need 0770\n    */\n    if (virDirCreate(swtpmStateDir, 0770, qemu_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0)\n        return -1;\n\n    /* create the socket filename */\n    if (!tpm->data.emulator.source.data.nix.path &&\n        !(tpm->data.emulator.source.data.nix.path =\n          qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return -1;\n    tpm->data.emulator.source.type = VIR_DOMAIN_CHR_TYPE_UNIX;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetShortName",
          "args": [
            "def"
          ],
          "line": 712
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetShortName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30900-30952",
          "snippet": "char *\nvirDomainDefGetShortName(const virDomainDef *def)\n{\n    wchar_t wshortname[VIR_DOMAIN_SHORT_NAME_MAX + 1] = {0};\n    size_t len = 0;\n    char *ret = NULL;\n    g_autofree char *shortname = NULL;\n\n    /* No need to do the whole conversion thing when there are no multibyte\n     * characters.  The same applies for illegal sequences as they can occur\n     * with incompatible locales. */\n    len = mbstowcs(NULL, def->name, 0);\n    if ((len == (size_t) -1 && errno == EILSEQ) ||\n        len == strlen(def->name)) {\n        ret = g_strdup_printf(\"%d-%.*s\", def->id, VIR_DOMAIN_SHORT_NAME_MAX, def->name);\n        return ret;\n    }\n\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    if (mbstowcs(wshortname, def->name, VIR_DOMAIN_SHORT_NAME_MAX) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    len = wcstombs(NULL, wshortname, 0);\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(shortname, len + 1) < 0)\n        return NULL;\n\n    if (wcstombs(shortname, wshortname, len) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    ret = g_strdup_printf(\"%d-%s\", def->id, shortname);\n    return ret;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_DOMAIN_SHORT_NAME_MAX 20"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_DOMAIN_SHORT_NAME_MAX 20\n\nchar *\nvirDomainDefGetShortName(const virDomainDef *def)\n{\n    wchar_t wshortname[VIR_DOMAIN_SHORT_NAME_MAX + 1] = {0};\n    size_t len = 0;\n    char *ret = NULL;\n    g_autofree char *shortname = NULL;\n\n    /* No need to do the whole conversion thing when there are no multibyte\n     * characters.  The same applies for illegal sequences as they can occur\n     * with incompatible locales. */\n    len = mbstowcs(NULL, def->name, 0);\n    if ((len == (size_t) -1 && errno == EILSEQ) ||\n        len == strlen(def->name)) {\n        ret = g_strdup_printf(\"%d-%.*s\", def->id, VIR_DOMAIN_SHORT_NAME_MAX, def->name);\n        return ret;\n    }\n\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    if (mbstowcs(wshortname, def->name, VIR_DOMAIN_SHORT_NAME_MAX) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert domain name to \"\n                               \"wide character string\"));\n        return NULL;\n    }\n\n    len = wcstombs(NULL, wshortname, 0);\n    if (len == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    if (VIR_ALLOC_N(shortname, len + 1) < 0)\n        return NULL;\n\n    if (wcstombs(shortname, wshortname, len) == (size_t) -1) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot convert wide character string \"\n                               \"back to multi-byte domain name\"));\n        return NULL;\n    }\n\n    ret = g_strdup_printf(\"%d-%s\", def->id, shortname);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUDriverGetConfig",
          "args": [
            "driver"
          ],
          "line": 707
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_conf.c",
          "lines": "1211-1218",
          "snippet": "virQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virsocket.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virlog.h\"",
            "#include \"virxml.h\"",
            "#include \"datatypes.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"storage_conf.h\"\n#include \"virstring.h\"\n#include \"virsocket.h\"\n#include \"virfile.h\"\n#include \"domain_nwfilter.h\"\n#include \"cpu/cpu.h\"\n#include \"virlog.h\"\n#include \"virxml.h\"\n#include \"datatypes.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"qemu_security.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nint\nqemuExtTPMPrepareHost(virQEMUDriverPtr driver,\n                      virDomainDefPtr def)\n{\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n    g_autofree char *shortName = NULL;\n\n    switch (def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        shortName = virDomainDefGetShortName(def);\n        if (!shortName)\n            return -1;\n\n        return qemuTPMEmulatorPrepareHost(def->tpm, cfg->swtpmLogDir,\n                                          def->name, cfg->swtpm_user,\n                                          cfg->swtpm_group,\n                                          cfg->swtpmStateDir, cfg->user,\n                                          shortName);\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuExtTPMInitPaths",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "684-700",
    "snippet": "int\nqemuExtTPMInitPaths(virQEMUDriverPtr driver,\n                    virDomainDefPtr def)\n{\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n\n    switch (def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        return qemuTPMEmulatorInitPaths(def->tpm, cfg->swtpmStorageDir,\n                                        def->uuid);\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuTPMEmulatorInitPaths",
          "args": [
            "def->tpm",
            "cfg->swtpmStorageDir",
            "def->uuid"
          ],
          "line": 692
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorInitPaths",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "190-206",
          "snippet": "static int\nqemuTPMEmulatorInitPaths(virDomainTPMDefPtr tpm,\n                         const char *swtpmStorageDir,\n                         const unsigned char *uuid)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(uuid, uuidstr);\n\n    if (!tpm->data.emulator.storagepath &&\n        !(tpm->data.emulator.storagepath =\n            qemuTPMCreateEmulatorStoragePath(swtpmStorageDir, uuidstr,\n                                             tpm->version)))\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorInitPaths(virDomainTPMDefPtr tpm,\n                         const char *swtpmStorageDir,\n                         const unsigned char *uuid)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(uuid, uuidstr);\n\n    if (!tpm->data.emulator.storagepath &&\n        !(tpm->data.emulator.storagepath =\n            qemuTPMCreateEmulatorStoragePath(swtpmStorageDir, uuidstr,\n                                             tpm->version)))\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUDriverGetConfig",
          "args": [
            "driver"
          ],
          "line": 688
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_conf.c",
          "lines": "1211-1218",
          "snippet": "virQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virsocket.h\"",
            "#include \"virfile.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virlog.h\"",
            "#include \"virxml.h\"",
            "#include \"datatypes.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"storage_conf.h\"\n#include \"virstring.h\"\n#include \"virsocket.h\"\n#include \"virfile.h\"\n#include \"domain_nwfilter.h\"\n#include \"cpu/cpu.h\"\n#include \"virlog.h\"\n#include \"virxml.h\"\n#include \"datatypes.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"qemu_security.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirQEMUDriverConfigPtr virQEMUDriverGetConfig(virQEMUDriverPtr driver)\n{\n    virQEMUDriverConfigPtr conf;\n    qemuDriverLock(driver);\n    conf = virObjectRef(driver->config);\n    qemuDriverUnlock(driver);\n    return conf;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nint\nqemuExtTPMInitPaths(virQEMUDriverPtr driver,\n                    virDomainDefPtr def)\n{\n    g_autoptr(virQEMUDriverConfig) cfg = virQEMUDriverGetConfig(driver);\n\n    switch (def->tpm->type) {\n    case VIR_DOMAIN_TPM_TYPE_EMULATOR:\n        return qemuTPMEmulatorInitPaths(def->tpm, cfg->swtpmStorageDir,\n                                        def->uuid);\n    case VIR_DOMAIN_TPM_TYPE_PASSTHROUGH:\n    case VIR_DOMAIN_TPM_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuTPMEmulatorStop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "646-681",
    "snippet": "static void\nqemuTPMEmulatorStop(const char *swtpmStateDir,\n                    const char *shortName)\n{\n    virCommandPtr cmd;\n    g_autofree char *pathname = NULL;\n    g_autofree char *errbuf = NULL;\n    g_autofree char *swtpm_ioctl = virTPMGetSwtpmIoctl();\n\n    if (!swtpm_ioctl)\n        return;\n\n    if (virTPMEmulatorInit() < 0)\n        return;\n\n    if (!(pathname = qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return;\n\n    if (!virFileExists(pathname))\n        return;\n\n    cmd = virCommandNew(swtpm_ioctl);\n    if (!cmd)\n        return;\n\n    virCommandAddArgList(cmd, \"--unix\", pathname, \"-s\", NULL);\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    ignore_value(virCommandRun(cmd, NULL));\n\n    virCommandFree(cmd);\n\n    /* clean up the socket */\n    unlink(pathname);\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "pathname"
          ],
          "line": 680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "cmd"
          ],
          "line": 677
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virCommandRun(cmd, NULL)"
          ],
          "line": 675
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 675
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetErrorBuffer",
          "args": [
            "cmd",
            "&errbuf"
          ],
          "line": 673
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetErrorBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1903-1918",
          "snippet": "void\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgList",
          "args": [
            "cmd",
            "\"--unix\"",
            "pathname",
            "\"-s\"",
            "NULL"
          ],
          "line": 671
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "swtpm_ioctl"
          ],
          "line": 667
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "pathname"
          ],
          "line": 664
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMCreateEmulatorSocket",
          "args": [
            "swtpmStateDir",
            "shortName"
          ],
          "line": 661
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMCreateEmulatorSocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "170-179",
          "snippet": "static char *\nqemuTPMCreateEmulatorSocket(const char *swtpmStateDir,\n                            const char *shortName)\n{\n    char *path = NULL;\n\n    path = g_strdup_printf(\"%s/%s-swtpm.sock\", swtpmStateDir, shortName);\n\n    return path;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic char *\nqemuTPMCreateEmulatorSocket(const char *swtpmStateDir,\n                            const char *shortName)\n{\n    char *path = NULL;\n\n    path = g_strdup_printf(\"%s/%s-swtpm.sock\", swtpmStateDir, shortName);\n\n    return path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTPMEmulatorInit",
          "args": [],
          "line": 658
        },
        "resolved": true,
        "details": {
          "function_name": "virTPMEmulatorInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtpm.c",
          "lines": "252-347",
          "snippet": "int\nvirTPMEmulatorInit(void)\n{\n    int ret = -1;\n    static const struct {\n        const char *name;\n        char **path;\n        struct stat *stat;\n        const char *parm;\n        virBitmapPtr *caps;\n        TypeFromStringFn typeFromStringFn;\n    } prgs[] = {\n        {\n            .name = \"swtpm\",\n            .path = &swtpm_path,\n            .stat = &swtpm_stat,\n            .parm = \"socket\",\n            .caps = &swtpm_caps,\n            .typeFromStringFn = virTPMSwtpmFeatureTypeFromString,\n        },\n        {\n            .name = \"swtpm_setup\",\n            .path = &swtpm_setup,\n            .stat = &swtpm_setup_stat,\n            .caps = &swtpm_setup_caps,\n            .typeFromStringFn = virTPMSwtpmSetupFeatureTypeFromString,\n        },\n        {\n            .name = \"swtpm_ioctl\",\n            .path = &swtpm_ioctl,\n            .stat = &swtpm_ioctl_stat,\n        }\n    };\n    size_t i;\n\n    virMutexLock(&swtpm_tools_lock);\n\n    for (i = 0; i < G_N_ELEMENTS(prgs); i++) {\n        g_autofree char *path = NULL;\n        bool findit = *prgs[i].path == NULL;\n        struct stat statbuf;\n        char *tmp;\n\n        if (!findit) {\n            /* has executables changed? */\n            if (stat(*prgs[i].path, &statbuf) < 0)\n                findit = true;\n\n            if (!findit &&\n                &statbuf.st_mtime != &prgs[i].stat->st_mtime)\n                findit = true;\n        }\n\n        if (findit) {\n            tmp = *prgs[i].path;\n            VIR_FREE(tmp);\n            *prgs[i].path = NULL;\n\n            path = virFindFileInPath(prgs[i].name);\n            if (!path) {\n                virReportSystemError(ENOENT,\n                                _(\"Unable to find '%s' binary in $PATH\"),\n                                prgs[i].name);\n                goto cleanup;\n            }\n            if (!virFileIsExecutable(path)) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"%s is not an executable\"),\n                               path);\n                goto cleanup;\n            }\n            if (stat(path, prgs[i].stat) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Could not stat %s\"), path);\n                goto cleanup;\n            }\n            *prgs[i].path = path;\n\n            if (prgs[i].caps) {\n                *prgs[i].caps = virTPMGetCaps(prgs[i].typeFromStringFn,\n                                              path, prgs[i].parm);\n                path = NULL;\n                if (!*prgs[i].caps)\n                    goto cleanup;\n            }\n            path = NULL;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virjson.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"virtpm.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;",
            "static char *swtpm_path;",
            "static struct stat swtpm_stat;",
            "static virBitmapPtr swtpm_caps;",
            "static char *swtpm_setup;",
            "static struct stat swtpm_setup_stat;",
            "static virBitmapPtr swtpm_setup_caps;",
            "static char *swtpm_ioctl;",
            "static struct stat swtpm_ioctl_stat;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virjson.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"virtpm.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;\nstatic char *swtpm_path;\nstatic struct stat swtpm_stat;\nstatic virBitmapPtr swtpm_caps;\nstatic char *swtpm_setup;\nstatic struct stat swtpm_setup_stat;\nstatic virBitmapPtr swtpm_setup_caps;\nstatic char *swtpm_ioctl;\nstatic struct stat swtpm_ioctl_stat;\n\nint\nvirTPMEmulatorInit(void)\n{\n    int ret = -1;\n    static const struct {\n        const char *name;\n        char **path;\n        struct stat *stat;\n        const char *parm;\n        virBitmapPtr *caps;\n        TypeFromStringFn typeFromStringFn;\n    } prgs[] = {\n        {\n            .name = \"swtpm\",\n            .path = &swtpm_path,\n            .stat = &swtpm_stat,\n            .parm = \"socket\",\n            .caps = &swtpm_caps,\n            .typeFromStringFn = virTPMSwtpmFeatureTypeFromString,\n        },\n        {\n            .name = \"swtpm_setup\",\n            .path = &swtpm_setup,\n            .stat = &swtpm_setup_stat,\n            .caps = &swtpm_setup_caps,\n            .typeFromStringFn = virTPMSwtpmSetupFeatureTypeFromString,\n        },\n        {\n            .name = \"swtpm_ioctl\",\n            .path = &swtpm_ioctl,\n            .stat = &swtpm_ioctl_stat,\n        }\n    };\n    size_t i;\n\n    virMutexLock(&swtpm_tools_lock);\n\n    for (i = 0; i < G_N_ELEMENTS(prgs); i++) {\n        g_autofree char *path = NULL;\n        bool findit = *prgs[i].path == NULL;\n        struct stat statbuf;\n        char *tmp;\n\n        if (!findit) {\n            /* has executables changed? */\n            if (stat(*prgs[i].path, &statbuf) < 0)\n                findit = true;\n\n            if (!findit &&\n                &statbuf.st_mtime != &prgs[i].stat->st_mtime)\n                findit = true;\n        }\n\n        if (findit) {\n            tmp = *prgs[i].path;\n            VIR_FREE(tmp);\n            *prgs[i].path = NULL;\n\n            path = virFindFileInPath(prgs[i].name);\n            if (!path) {\n                virReportSystemError(ENOENT,\n                                _(\"Unable to find '%s' binary in $PATH\"),\n                                prgs[i].name);\n                goto cleanup;\n            }\n            if (!virFileIsExecutable(path)) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"%s is not an executable\"),\n                               path);\n                goto cleanup;\n            }\n            if (stat(path, prgs[i].stat) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Could not stat %s\"), path);\n                goto cleanup;\n            }\n            *prgs[i].path = path;\n\n            if (prgs[i].caps) {\n                *prgs[i].caps = virTPMGetCaps(prgs[i].typeFromStringFn,\n                                              path, prgs[i].parm);\n                path = NULL;\n                if (!*prgs[i].caps)\n                    goto cleanup;\n            }\n            path = NULL;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTPMGetSwtpmIoctl",
          "args": [],
          "line": 653
        },
        "resolved": true,
        "details": {
          "function_name": "virTPMGetSwtpmIoctl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtpm.c",
          "lines": "138-151",
          "snippet": "char *\nvirTPMGetSwtpmIoctl(void)\n{\n    char *s;\n\n    if (!swtpm_ioctl && virTPMEmulatorInit() < 0)\n        return NULL;\n\n    virMutexLock(&swtpm_tools_lock);\n    s = g_strdup(swtpm_ioctl);\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return s;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virjson.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"virtpm.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;",
            "static char *swtpm_ioctl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virjson.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"virtpm.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;\nstatic char *swtpm_ioctl;\n\nchar *\nvirTPMGetSwtpmIoctl(void)\n{\n    char *s;\n\n    if (!swtpm_ioctl && virTPMEmulatorInit() < 0)\n        return NULL;\n\n    virMutexLock(&swtpm_tools_lock);\n    s = g_strdup(swtpm_ioctl);\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return s;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic void\nqemuTPMEmulatorStop(const char *swtpmStateDir,\n                    const char *shortName)\n{\n    virCommandPtr cmd;\n    g_autofree char *pathname = NULL;\n    g_autofree char *errbuf = NULL;\n    g_autofree char *swtpm_ioctl = virTPMGetSwtpmIoctl();\n\n    if (!swtpm_ioctl)\n        return;\n\n    if (virTPMEmulatorInit() < 0)\n        return;\n\n    if (!(pathname = qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return;\n\n    if (!virFileExists(pathname))\n        return;\n\n    cmd = virCommandNew(swtpm_ioctl);\n    if (!cmd)\n        return;\n\n    virCommandAddArgList(cmd, \"--unix\", pathname, \"-s\", NULL);\n\n    virCommandSetErrorBuffer(cmd, &errbuf);\n\n    ignore_value(virCommandRun(cmd, NULL));\n\n    virCommandFree(cmd);\n\n    /* clean up the socket */\n    unlink(pathname);\n}"
  },
  {
    "function_name": "qemuTPMEmulatorBuildCommand",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "526-636",
    "snippet": "static virCommandPtr\nqemuTPMEmulatorBuildCommand(virDomainTPMDefPtr tpm,\n                            const char *vmname,\n                            const unsigned char *vmuuid,\n                            bool privileged,\n                            uid_t swtpm_user,\n                            gid_t swtpm_group,\n                            const char *swtpmStateDir,\n                            const char *shortName,\n                            bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    bool created = false;\n    g_autofree char *pidfile = NULL;\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    VIR_AUTOCLOSE pwdfile_fd = -1;\n    VIR_AUTOCLOSE migpwdfile_fd = -1;\n    const unsigned char *secretuuid = NULL;\n\n    if (!swtpm)\n        return NULL;\n\n    if (qemuTPMCreateEmulatorStorage(tpm->data.emulator.storagepath,\n                                     &created, swtpm_user, swtpm_group) < 0)\n        return NULL;\n\n    if (tpm->data.emulator.hassecretuuid)\n        secretuuid = tpm->data.emulator.secretuuid;\n\n    if (created &&\n        qemuTPMEmulatorRunSetup(tpm->data.emulator.storagepath, vmname, vmuuid,\n                                privileged, swtpm_user, swtpm_group,\n                                tpm->data.emulator.logfile, tpm->version,\n                                secretuuid, incomingMigration) < 0)\n        goto error;\n\n    unlink(tpm->data.emulator.source.data.nix.path);\n\n    cmd = virCommandNew(swtpm);\n    if (!cmd)\n        goto error;\n\n    virCommandClearCaps(cmd);\n\n    virCommandAddArgList(cmd, \"socket\", \"--daemon\", \"--ctrl\", NULL);\n    virCommandAddArgFormat(cmd, \"type=unixio,path=%s,mode=0600\",\n                           tpm->data.emulator.source.data.nix.path);\n\n    virCommandAddArg(cmd, \"--tpmstate\");\n    virCommandAddArgFormat(cmd, \"dir=%s,mode=0600\",\n                           tpm->data.emulator.storagepath);\n\n    virCommandAddArg(cmd, \"--log\");\n    virCommandAddArgFormat(cmd, \"file=%s\", tpm->data.emulator.logfile);\n\n    virCommandSetUID(cmd, swtpm_user);\n    virCommandSetGID(cmd, swtpm_group);\n\n    switch (tpm->version) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        virCommandAddArg(cmd, \"--tpm2\");\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        break;\n    }\n\n    if (!(pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir, shortName)))\n        goto error;\n\n    virCommandAddArg(cmd, \"--pid\");\n    virCommandAddArgFormat(cmd, \"file=%s\", pidfile);\n\n    if (tpm->data.emulator.hassecretuuid) {\n        if (!virTPMSwtpmCapsGet(VIR_TPM_SWTPM_FEATURE_CMDARG_PWD_FD)) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                  _(\"%s does not support passing passphrase via file descriptor\"),\n                  swtpm);\n            goto error;\n        }\n\n        pwdfile_fd = qemuTPMSetupEncryption(tpm->data.emulator.secretuuid, cmd);\n        if (pwdfile_fd)\n        migpwdfile_fd = qemuTPMSetupEncryption(tpm->data.emulator.secretuuid,\n                                               cmd);\n        if (pwdfile_fd < 0 || migpwdfile_fd < 0)\n            goto error;\n\n        virCommandAddArg(cmd, \"--key\");\n        virCommandAddArgFormat(cmd, \"pwdfd=%d,mode=aes-256-cbc\",\n                               pwdfile_fd);\n        virCommandPassFD(cmd, pwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        pwdfile_fd = -1;\n\n        virCommandAddArg(cmd, \"--migration-key\");\n        virCommandAddArgFormat(cmd, \"pwdfd=%d,mode=aes-256-cbc\",\n                               migpwdfile_fd);\n        virCommandPassFD(cmd, migpwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        migpwdfile_fd = -1;\n    }\n\n    return g_steal_pointer(&cmd);\n\n error:\n    if (created)\n        qemuTPMDeleteEmulatorStorage(tpm);\n\n    return NULL;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuTPMDeleteEmulatorStorage",
          "args": [
            "tpm"
          ],
          "line": 633
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMDeleteEmulatorStorage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "153-159",
          "snippet": "static void\nqemuTPMDeleteEmulatorStorage(virDomainTPMDefPtr tpm)\n{\n    g_autofree char *path =  g_path_get_dirname(tpm->data.emulator.storagepath);\n\n    ignore_value(virFileDeleteTree(path));\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic void\nqemuTPMDeleteEmulatorStorage(virDomainTPMDefPtr tpm)\n{\n    g_autofree char *path =  g_path_get_dirname(tpm->data.emulator.storagepath);\n\n    ignore_value(virFileDeleteTree(path));\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&cmd"
          ],
          "line": 629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandPassFD",
          "args": [
            "cmd",
            "migpwdfile_fd",
            "VIR_COMMAND_PASS_FD_CLOSE_PARENT"
          ],
          "line": 625
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandPassFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1024-1049",
          "snippet": "void\nvirCommandPassFD(virCommandPtr cmd, int fd, unsigned int flags)\n{\n    int ret = 0;\n\n    if (!cmd) {\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n\n    if (fd <= STDERR_FILENO) {\n        VIR_DEBUG(\"invalid fd %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        if (!cmd->has_error)\n            cmd->has_error = -1;\n        return;\n    }\n\n    if ((ret = virCommandFDSet(cmd, fd, flags)) != 0) {\n        if (!cmd->has_error)\n            cmd->has_error = ret;\n        VIR_DEBUG(\"cannot preserve %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandPassFD(virCommandPtr cmd, int fd, unsigned int flags)\n{\n    int ret = 0;\n\n    if (!cmd) {\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n\n    if (fd <= STDERR_FILENO) {\n        VIR_DEBUG(\"invalid fd %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        if (!cmd->has_error)\n            cmd->has_error = -1;\n        return;\n    }\n\n    if ((ret = virCommandFDSet(cmd, fd, flags)) != 0) {\n        if (!cmd->has_error)\n            cmd->has_error = ret;\n        VIR_DEBUG(\"cannot preserve %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgFormat",
          "args": [
            "cmd",
            "\"pwdfd=%d,mode=aes-256-cbc\"",
            "migpwdfile_fd"
          ],
          "line": 623
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1569-1590",
          "snippet": "void\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArg",
          "args": [
            "cmd",
            "\"--migration-key\""
          ],
          "line": 622
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMSetupEncryption",
          "args": [
            "tpm->data.emulator.secretuuid",
            "cmd"
          ],
          "line": 611
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMSetupEncryption",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "346-388",
          "snippet": "static int\nqemuTPMSetupEncryption(const unsigned char *secretuuid,\n                       virCommandPtr cmd)\n{\n    int ret = -1;\n    int pipefd[2] = { -1, -1 };\n    virConnectPtr conn;\n    g_autofree uint8_t *secret = NULL;\n    size_t secret_len;\n    virSecretLookupTypeDef seclookupdef = {\n         .type = VIR_SECRET_LOOKUP_TYPE_UUID,\n    };\n\n    conn = virGetConnectSecret();\n    if (!conn)\n        return -1;\n\n    memcpy(seclookupdef.u.uuid, secretuuid, sizeof(seclookupdef.u.uuid));\n    if (virSecretGetSecretString(conn, &seclookupdef,\n                                 VIR_SECRET_USAGE_TYPE_VTPM,\n                                 &secret, &secret_len) < 0)\n        goto error;\n\n    if (virPipe(pipefd) < 0)\n        goto error;\n\n    if (virCommandSetSendBuffer(cmd, pipefd[1], secret, secret_len) < 0)\n        goto error;\n\n    secret = NULL;\n    ret = pipefd[0];\n\n cleanup:\n    virObjectUnref(conn);\n\n    return ret;\n\n error:\n    VIR_FORCE_CLOSE(pipefd[1]);\n    VIR_FORCE_CLOSE(pipefd[0]);\n\n    goto cleanup;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMSetupEncryption(const unsigned char *secretuuid,\n                       virCommandPtr cmd)\n{\n    int ret = -1;\n    int pipefd[2] = { -1, -1 };\n    virConnectPtr conn;\n    g_autofree uint8_t *secret = NULL;\n    size_t secret_len;\n    virSecretLookupTypeDef seclookupdef = {\n         .type = VIR_SECRET_LOOKUP_TYPE_UUID,\n    };\n\n    conn = virGetConnectSecret();\n    if (!conn)\n        return -1;\n\n    memcpy(seclookupdef.u.uuid, secretuuid, sizeof(seclookupdef.u.uuid));\n    if (virSecretGetSecretString(conn, &seclookupdef,\n                                 VIR_SECRET_USAGE_TYPE_VTPM,\n                                 &secret, &secret_len) < 0)\n        goto error;\n\n    if (virPipe(pipefd) < 0)\n        goto error;\n\n    if (virCommandSetSendBuffer(cmd, pipefd[1], secret, secret_len) < 0)\n        goto error;\n\n    secret = NULL;\n    ret = pipefd[0];\n\n cleanup:\n    virObjectUnref(conn);\n\n    return ret;\n\n error:\n    VIR_FORCE_CLOSE(pipefd[1]);\n    VIR_FORCE_CLOSE(pipefd[0]);\n\n    goto cleanup;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_ARGUMENT_UNSUPPORTED",
            "_(\"%s does not support passing passphrase via file descriptor\")",
            "swtpm"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"%s does not support passing passphrase via file descriptor\""
          ],
          "line": 604
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTPMSwtpmCapsGet",
          "args": [
            "VIR_TPM_SWTPM_FEATURE_CMDARG_PWD_FD"
          ],
          "line": 602
        },
        "resolved": true,
        "details": {
          "function_name": "virTPMSwtpmCapsGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtpm.c",
          "lines": "349-355",
          "snippet": "bool\nvirTPMSwtpmCapsGet(unsigned int cap)\n{\n    if (virTPMEmulatorInit() < 0)\n        return false;\n    return virBitmapIsBitSet(swtpm_caps, cap);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virjson.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"virtpm.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virBitmapPtr swtpm_caps;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virjson.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"virtpm.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virBitmapPtr swtpm_caps;\n\nbool\nvirTPMSwtpmCapsGet(unsigned int cap)\n{\n    if (virTPMEmulatorInit() < 0)\n        return false;\n    return virBitmapIsBitSet(swtpm_caps, cap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorCreatePidFilename",
          "args": [
            "swtpmStateDir",
            "shortName"
          ],
          "line": 595
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorCreatePidFilename",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "212-224",
          "snippet": "static char *\nqemuTPMEmulatorCreatePidFilename(const char *swtpmStateDir,\n                                 const char *shortName)\n{\n    char *pidfile = NULL;\n    g_autofree char *devicename = NULL;\n\n    devicename = g_strdup_printf(\"%s-swtpm\", shortName);\n\n    pidfile = virPidFileBuildPath(swtpmStateDir, devicename);\n\n    return pidfile;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic char *\nqemuTPMEmulatorCreatePidFilename(const char *swtpmStateDir,\n                                 const char *shortName)\n{\n    char *pidfile = NULL;\n    g_autofree char *devicename = NULL;\n\n    devicename = g_strdup_printf(\"%s-swtpm\", shortName);\n\n    pidfile = virPidFileBuildPath(swtpmStateDir, devicename);\n\n    return pidfile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetGID",
          "args": [
            "cmd",
            "swtpm_group"
          ],
          "line": 582
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetGID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1111-1118",
          "snippet": "void\nvirCommandSetGID(virCommandPtr cmd, gid_t gid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->gid = gid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetGID(virCommandPtr cmd, gid_t gid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->gid = gid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetUID",
          "args": [
            "cmd",
            "swtpm_user"
          ],
          "line": 581
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetUID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1120-1127",
          "snippet": "void\nvirCommandSetUID(virCommandPtr cmd, uid_t uid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->uid = uid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetUID(virCommandPtr cmd, uid_t uid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->uid = uid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandClearCaps",
          "args": [
            "cmd"
          ],
          "line": 568
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandClearCaps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1179-1186",
          "snippet": "void\nvirCommandClearCaps(virCommandPtr cmd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->flags |= VIR_EXEC_CLEAR_CAPS;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandClearCaps(virCommandPtr cmd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->flags |= VIR_EXEC_CLEAR_CAPS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "swtpm"
          ],
          "line": 564
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "tpm->data.emulator.source.data.nix.path"
          ],
          "line": 562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorRunSetup",
          "args": [
            "tpm->data.emulator.storagepath",
            "vmname",
            "vmuuid",
            "privileged",
            "swtpm_user",
            "swtpm_group",
            "tpm->data.emulator.logfile",
            "tpm->version",
            "secretuuid",
            "incomingMigration"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorRunSetup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "409-505",
          "snippet": "static int\nqemuTPMEmulatorRunSetup(const char *storagepath,\n                        const char *vmname,\n                        const unsigned char *vmuuid,\n                        bool privileged,\n                        uid_t swtpm_user,\n                        gid_t swtpm_group,\n                        const char *logfile,\n                        const virDomainTPMVersion tpmversion,\n                        const unsigned char *secretuuid,\n                        bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    int exitstatus;\n    char uuid[VIR_UUID_STRING_BUFLEN];\n    g_autofree char *vmid = NULL;\n    g_autofree char *swtpm_setup = virTPMGetSwtpmSetup();\n    VIR_AUTOCLOSE pwdfile_fd = -1;\n\n    if (!swtpm_setup)\n        return -1;\n\n    if (!privileged && tpmversion == VIR_DOMAIN_TPM_VERSION_1_2)\n        return virFileWriteStr(logfile,\n                               _(\"Did not create EK and certificates since \"\n                                 \"this requires privileged mode for a \"\n                                 \"TPM 1.2\\n\"), 0600);\n\n    cmd = virCommandNew(swtpm_setup);\n    if (!cmd)\n        return -1;\n\n    virUUIDFormat(vmuuid, uuid);\n    vmid = g_strdup_printf(\"%s:%s\", vmname, uuid);\n\n    virCommandSetUID(cmd, swtpm_user);\n    virCommandSetGID(cmd, swtpm_group);\n\n    switch (tpmversion) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        virCommandAddArgList(cmd, \"--tpm2\", NULL);\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        break;\n    }\n\n    if (secretuuid) {\n        if (!virTPMSwtpmSetupCapsGet(\n                VIR_TPM_SWTPM_SETUP_FEATURE_CMDARG_PWDFILE_FD)) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                _(\"%s does not support passing a passphrase using a file \"\n                  \"descriptor\"), swtpm_setup);\n            return -1;\n        }\n        if ((pwdfile_fd = qemuTPMSetupEncryption(secretuuid, cmd)) < 0)\n            return -1;\n\n        virCommandAddArg(cmd, \"--pwdfile-fd\");\n        virCommandAddArgFormat(cmd, \"%d\", pwdfile_fd);\n        virCommandAddArgList(cmd, \"--cipher\", \"aes-256-cbc\", NULL);\n        virCommandPassFD(cmd, pwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        pwdfile_fd = -1;\n    }\n\n    if (!incomingMigration) {\n        virCommandAddArgList(cmd,\n                             \"--tpm-state\", storagepath,\n                             \"--vmid\", vmid,\n                             \"--logfile\", logfile,\n                             \"--createek\",\n                             \"--create-ek-cert\",\n                             \"--create-platform-cert\",\n                             \"--lock-nvram\",\n                             \"--not-overwrite\",\n                             NULL);\n    } else {\n        virCommandAddArgList(cmd,\n                             \"--tpm-state\", storagepath,\n                             \"--overwrite\",\n                             NULL);\n    }\n\n    virCommandClearCaps(cmd);\n\n    if (virCommandRun(cmd, &exitstatus) < 0 || exitstatus != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not run '%s'. exitstatus: %d; \"\n                         \"Check error log '%s' for details.\"),\n                          swtpm_setup, exitstatus, logfile);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorRunSetup(const char *storagepath,\n                        const char *vmname,\n                        const unsigned char *vmuuid,\n                        bool privileged,\n                        uid_t swtpm_user,\n                        gid_t swtpm_group,\n                        const char *logfile,\n                        const virDomainTPMVersion tpmversion,\n                        const unsigned char *secretuuid,\n                        bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    int exitstatus;\n    char uuid[VIR_UUID_STRING_BUFLEN];\n    g_autofree char *vmid = NULL;\n    g_autofree char *swtpm_setup = virTPMGetSwtpmSetup();\n    VIR_AUTOCLOSE pwdfile_fd = -1;\n\n    if (!swtpm_setup)\n        return -1;\n\n    if (!privileged && tpmversion == VIR_DOMAIN_TPM_VERSION_1_2)\n        return virFileWriteStr(logfile,\n                               _(\"Did not create EK and certificates since \"\n                                 \"this requires privileged mode for a \"\n                                 \"TPM 1.2\\n\"), 0600);\n\n    cmd = virCommandNew(swtpm_setup);\n    if (!cmd)\n        return -1;\n\n    virUUIDFormat(vmuuid, uuid);\n    vmid = g_strdup_printf(\"%s:%s\", vmname, uuid);\n\n    virCommandSetUID(cmd, swtpm_user);\n    virCommandSetGID(cmd, swtpm_group);\n\n    switch (tpmversion) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        virCommandAddArgList(cmd, \"--tpm2\", NULL);\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        break;\n    }\n\n    if (secretuuid) {\n        if (!virTPMSwtpmSetupCapsGet(\n                VIR_TPM_SWTPM_SETUP_FEATURE_CMDARG_PWDFILE_FD)) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                _(\"%s does not support passing a passphrase using a file \"\n                  \"descriptor\"), swtpm_setup);\n            return -1;\n        }\n        if ((pwdfile_fd = qemuTPMSetupEncryption(secretuuid, cmd)) < 0)\n            return -1;\n\n        virCommandAddArg(cmd, \"--pwdfile-fd\");\n        virCommandAddArgFormat(cmd, \"%d\", pwdfile_fd);\n        virCommandAddArgList(cmd, \"--cipher\", \"aes-256-cbc\", NULL);\n        virCommandPassFD(cmd, pwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        pwdfile_fd = -1;\n    }\n\n    if (!incomingMigration) {\n        virCommandAddArgList(cmd,\n                             \"--tpm-state\", storagepath,\n                             \"--vmid\", vmid,\n                             \"--logfile\", logfile,\n                             \"--createek\",\n                             \"--create-ek-cert\",\n                             \"--create-platform-cert\",\n                             \"--lock-nvram\",\n                             \"--not-overwrite\",\n                             NULL);\n    } else {\n        virCommandAddArgList(cmd,\n                             \"--tpm-state\", storagepath,\n                             \"--overwrite\",\n                             NULL);\n    }\n\n    virCommandClearCaps(cmd);\n\n    if (virCommandRun(cmd, &exitstatus) < 0 || exitstatus != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not run '%s'. exitstatus: %d; \"\n                         \"Check error log '%s' for details.\"),\n                          swtpm_setup, exitstatus, logfile);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMCreateEmulatorStorage",
          "args": [
            "tpm->data.emulator.storagepath",
            "&created",
            "swtpm_user",
            "swtpm_group"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMCreateEmulatorStorage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "122-150",
          "snippet": "static int\nqemuTPMCreateEmulatorStorage(const char *storagepath,\n                             bool *created,\n                             uid_t swtpm_user,\n                             gid_t swtpm_group)\n{\n    g_autofree char *swtpmStorageDir = g_path_get_dirname(storagepath);\n\n    if (qemuTPMEmulatorInitStorage(swtpmStorageDir) < 0)\n        return -1;\n\n    *created = false;\n\n    if (!virFileExists(storagepath))\n        *created = true;\n\n    if (virDirCreate(storagepath, 0700, swtpm_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not create directory %s as %u:%d\"),\n                       storagepath, swtpm_user, swtpm_group);\n        return -1;\n    }\n\n    if (virFileChownFiles(storagepath, swtpm_user, swtpm_group) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMCreateEmulatorStorage(const char *storagepath,\n                             bool *created,\n                             uid_t swtpm_user,\n                             gid_t swtpm_group)\n{\n    g_autofree char *swtpmStorageDir = g_path_get_dirname(storagepath);\n\n    if (qemuTPMEmulatorInitStorage(swtpmStorageDir) < 0)\n        return -1;\n\n    *created = false;\n\n    if (!virFileExists(storagepath))\n        *created = true;\n\n    if (virDirCreate(storagepath, 0700, swtpm_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not create directory %s as %u:%d\"),\n                       storagepath, swtpm_user, swtpm_group);\n        return -1;\n    }\n\n    if (virFileChownFiles(storagepath, swtpm_user, swtpm_group) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTPMGetSwtpm",
          "args": [],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "virTPMGetSwtpmIoctl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtpm.c",
          "lines": "138-151",
          "snippet": "char *\nvirTPMGetSwtpmIoctl(void)\n{\n    char *s;\n\n    if (!swtpm_ioctl && virTPMEmulatorInit() < 0)\n        return NULL;\n\n    virMutexLock(&swtpm_tools_lock);\n    s = g_strdup(swtpm_ioctl);\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return s;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virjson.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"virtpm.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;",
            "static char *swtpm_ioctl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virjson.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"virtpm.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;\nstatic char *swtpm_ioctl;\n\nchar *\nvirTPMGetSwtpmIoctl(void)\n{\n    char *s;\n\n    if (!swtpm_ioctl && virTPMEmulatorInit() < 0)\n        return NULL;\n\n    virMutexLock(&swtpm_tools_lock);\n    s = g_strdup(swtpm_ioctl);\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return s;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virCommandPtr\nqemuTPMEmulatorBuildCommand(virDomainTPMDefPtr tpm,\n                            const char *vmname,\n                            const unsigned char *vmuuid,\n                            bool privileged,\n                            uid_t swtpm_user,\n                            gid_t swtpm_group,\n                            const char *swtpmStateDir,\n                            const char *shortName,\n                            bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    bool created = false;\n    g_autofree char *pidfile = NULL;\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    VIR_AUTOCLOSE pwdfile_fd = -1;\n    VIR_AUTOCLOSE migpwdfile_fd = -1;\n    const unsigned char *secretuuid = NULL;\n\n    if (!swtpm)\n        return NULL;\n\n    if (qemuTPMCreateEmulatorStorage(tpm->data.emulator.storagepath,\n                                     &created, swtpm_user, swtpm_group) < 0)\n        return NULL;\n\n    if (tpm->data.emulator.hassecretuuid)\n        secretuuid = tpm->data.emulator.secretuuid;\n\n    if (created &&\n        qemuTPMEmulatorRunSetup(tpm->data.emulator.storagepath, vmname, vmuuid,\n                                privileged, swtpm_user, swtpm_group,\n                                tpm->data.emulator.logfile, tpm->version,\n                                secretuuid, incomingMigration) < 0)\n        goto error;\n\n    unlink(tpm->data.emulator.source.data.nix.path);\n\n    cmd = virCommandNew(swtpm);\n    if (!cmd)\n        goto error;\n\n    virCommandClearCaps(cmd);\n\n    virCommandAddArgList(cmd, \"socket\", \"--daemon\", \"--ctrl\", NULL);\n    virCommandAddArgFormat(cmd, \"type=unixio,path=%s,mode=0600\",\n                           tpm->data.emulator.source.data.nix.path);\n\n    virCommandAddArg(cmd, \"--tpmstate\");\n    virCommandAddArgFormat(cmd, \"dir=%s,mode=0600\",\n                           tpm->data.emulator.storagepath);\n\n    virCommandAddArg(cmd, \"--log\");\n    virCommandAddArgFormat(cmd, \"file=%s\", tpm->data.emulator.logfile);\n\n    virCommandSetUID(cmd, swtpm_user);\n    virCommandSetGID(cmd, swtpm_group);\n\n    switch (tpm->version) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        virCommandAddArg(cmd, \"--tpm2\");\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        break;\n    }\n\n    if (!(pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir, shortName)))\n        goto error;\n\n    virCommandAddArg(cmd, \"--pid\");\n    virCommandAddArgFormat(cmd, \"file=%s\", pidfile);\n\n    if (tpm->data.emulator.hassecretuuid) {\n        if (!virTPMSwtpmCapsGet(VIR_TPM_SWTPM_FEATURE_CMDARG_PWD_FD)) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                  _(\"%s does not support passing passphrase via file descriptor\"),\n                  swtpm);\n            goto error;\n        }\n\n        pwdfile_fd = qemuTPMSetupEncryption(tpm->data.emulator.secretuuid, cmd);\n        if (pwdfile_fd)\n        migpwdfile_fd = qemuTPMSetupEncryption(tpm->data.emulator.secretuuid,\n                                               cmd);\n        if (pwdfile_fd < 0 || migpwdfile_fd < 0)\n            goto error;\n\n        virCommandAddArg(cmd, \"--key\");\n        virCommandAddArgFormat(cmd, \"pwdfd=%d,mode=aes-256-cbc\",\n                               pwdfile_fd);\n        virCommandPassFD(cmd, pwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        pwdfile_fd = -1;\n\n        virCommandAddArg(cmd, \"--migration-key\");\n        virCommandAddArgFormat(cmd, \"pwdfd=%d,mode=aes-256-cbc\",\n                               migpwdfile_fd);\n        virCommandPassFD(cmd, migpwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        migpwdfile_fd = -1;\n    }\n\n    return g_steal_pointer(&cmd);\n\n error:\n    if (created)\n        qemuTPMDeleteEmulatorStorage(tpm);\n\n    return NULL;\n}"
  },
  {
    "function_name": "qemuTPMEmulatorRunSetup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "409-505",
    "snippet": "static int\nqemuTPMEmulatorRunSetup(const char *storagepath,\n                        const char *vmname,\n                        const unsigned char *vmuuid,\n                        bool privileged,\n                        uid_t swtpm_user,\n                        gid_t swtpm_group,\n                        const char *logfile,\n                        const virDomainTPMVersion tpmversion,\n                        const unsigned char *secretuuid,\n                        bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    int exitstatus;\n    char uuid[VIR_UUID_STRING_BUFLEN];\n    g_autofree char *vmid = NULL;\n    g_autofree char *swtpm_setup = virTPMGetSwtpmSetup();\n    VIR_AUTOCLOSE pwdfile_fd = -1;\n\n    if (!swtpm_setup)\n        return -1;\n\n    if (!privileged && tpmversion == VIR_DOMAIN_TPM_VERSION_1_2)\n        return virFileWriteStr(logfile,\n                               _(\"Did not create EK and certificates since \"\n                                 \"this requires privileged mode for a \"\n                                 \"TPM 1.2\\n\"), 0600);\n\n    cmd = virCommandNew(swtpm_setup);\n    if (!cmd)\n        return -1;\n\n    virUUIDFormat(vmuuid, uuid);\n    vmid = g_strdup_printf(\"%s:%s\", vmname, uuid);\n\n    virCommandSetUID(cmd, swtpm_user);\n    virCommandSetGID(cmd, swtpm_group);\n\n    switch (tpmversion) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        virCommandAddArgList(cmd, \"--tpm2\", NULL);\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        break;\n    }\n\n    if (secretuuid) {\n        if (!virTPMSwtpmSetupCapsGet(\n                VIR_TPM_SWTPM_SETUP_FEATURE_CMDARG_PWDFILE_FD)) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                _(\"%s does not support passing a passphrase using a file \"\n                  \"descriptor\"), swtpm_setup);\n            return -1;\n        }\n        if ((pwdfile_fd = qemuTPMSetupEncryption(secretuuid, cmd)) < 0)\n            return -1;\n\n        virCommandAddArg(cmd, \"--pwdfile-fd\");\n        virCommandAddArgFormat(cmd, \"%d\", pwdfile_fd);\n        virCommandAddArgList(cmd, \"--cipher\", \"aes-256-cbc\", NULL);\n        virCommandPassFD(cmd, pwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        pwdfile_fd = -1;\n    }\n\n    if (!incomingMigration) {\n        virCommandAddArgList(cmd,\n                             \"--tpm-state\", storagepath,\n                             \"--vmid\", vmid,\n                             \"--logfile\", logfile,\n                             \"--createek\",\n                             \"--create-ek-cert\",\n                             \"--create-platform-cert\",\n                             \"--lock-nvram\",\n                             \"--not-overwrite\",\n                             NULL);\n    } else {\n        virCommandAddArgList(cmd,\n                             \"--tpm-state\", storagepath,\n                             \"--overwrite\",\n                             NULL);\n    }\n\n    virCommandClearCaps(cmd);\n\n    if (virCommandRun(cmd, &exitstatus) < 0 || exitstatus != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not run '%s'. exitstatus: %d; \"\n                         \"Check error log '%s' for details.\"),\n                          swtpm_setup, exitstatus, logfile);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Could not run '%s'. exitstatus: %d; \"\n                         \"Check error log '%s' for details.\")",
            "swtpm_setup",
            "exitstatus",
            "logfile"
          ],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Could not run '%s'. exitstatus: %d; \"\n                         \"Check error log '%s' for details.\""
          ],
          "line": 498
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "&exitstatus"
          ],
          "line": 496
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandClearCaps",
          "args": [
            "cmd"
          ],
          "line": 494
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandClearCaps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1179-1186",
          "snippet": "void\nvirCommandClearCaps(virCommandPtr cmd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->flags |= VIR_EXEC_CLEAR_CAPS;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandClearCaps(virCommandPtr cmd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->flags |= VIR_EXEC_CLEAR_CAPS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgList",
          "args": [
            "cmd",
            "\"--tpm-state\"",
            "storagepath",
            "\"--overwrite\"",
            "NULL"
          ],
          "line": 488
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandPassFD",
          "args": [
            "cmd",
            "pwdfile_fd",
            "VIR_COMMAND_PASS_FD_CLOSE_PARENT"
          ],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandPassFD",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1024-1049",
          "snippet": "void\nvirCommandPassFD(virCommandPtr cmd, int fd, unsigned int flags)\n{\n    int ret = 0;\n\n    if (!cmd) {\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n\n    if (fd <= STDERR_FILENO) {\n        VIR_DEBUG(\"invalid fd %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        if (!cmd->has_error)\n            cmd->has_error = -1;\n        return;\n    }\n\n    if ((ret = virCommandFDSet(cmd, fd, flags)) != 0) {\n        if (!cmd->has_error)\n            cmd->has_error = ret;\n        VIR_DEBUG(\"cannot preserve %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandPassFD(virCommandPtr cmd, int fd, unsigned int flags)\n{\n    int ret = 0;\n\n    if (!cmd) {\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n\n    if (fd <= STDERR_FILENO) {\n        VIR_DEBUG(\"invalid fd %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        if (!cmd->has_error)\n            cmd->has_error = -1;\n        return;\n    }\n\n    if ((ret = virCommandFDSet(cmd, fd, flags)) != 0) {\n        if (!cmd->has_error)\n            cmd->has_error = ret;\n        VIR_DEBUG(\"cannot preserve %d\", fd);\n        VIR_COMMAND_MAYBE_CLOSE_FD(fd, flags);\n        return;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgFormat",
          "args": [
            "cmd",
            "\"%d\"",
            "pwdfile_fd"
          ],
          "line": 470
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1569-1590",
          "snippet": "void\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *arg;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    arg = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    /* Arg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, 1 + 1) < 0) {\n        VIR_FREE(arg);\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    cmd->args[cmd->nargs++] = arg;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMSetupEncryption",
          "args": [
            "secretuuid",
            "cmd"
          ],
          "line": 466
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMSetupEncryption",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "346-388",
          "snippet": "static int\nqemuTPMSetupEncryption(const unsigned char *secretuuid,\n                       virCommandPtr cmd)\n{\n    int ret = -1;\n    int pipefd[2] = { -1, -1 };\n    virConnectPtr conn;\n    g_autofree uint8_t *secret = NULL;\n    size_t secret_len;\n    virSecretLookupTypeDef seclookupdef = {\n         .type = VIR_SECRET_LOOKUP_TYPE_UUID,\n    };\n\n    conn = virGetConnectSecret();\n    if (!conn)\n        return -1;\n\n    memcpy(seclookupdef.u.uuid, secretuuid, sizeof(seclookupdef.u.uuid));\n    if (virSecretGetSecretString(conn, &seclookupdef,\n                                 VIR_SECRET_USAGE_TYPE_VTPM,\n                                 &secret, &secret_len) < 0)\n        goto error;\n\n    if (virPipe(pipefd) < 0)\n        goto error;\n\n    if (virCommandSetSendBuffer(cmd, pipefd[1], secret, secret_len) < 0)\n        goto error;\n\n    secret = NULL;\n    ret = pipefd[0];\n\n cleanup:\n    virObjectUnref(conn);\n\n    return ret;\n\n error:\n    VIR_FORCE_CLOSE(pipefd[1]);\n    VIR_FORCE_CLOSE(pipefd[0]);\n\n    goto cleanup;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMSetupEncryption(const unsigned char *secretuuid,\n                       virCommandPtr cmd)\n{\n    int ret = -1;\n    int pipefd[2] = { -1, -1 };\n    virConnectPtr conn;\n    g_autofree uint8_t *secret = NULL;\n    size_t secret_len;\n    virSecretLookupTypeDef seclookupdef = {\n         .type = VIR_SECRET_LOOKUP_TYPE_UUID,\n    };\n\n    conn = virGetConnectSecret();\n    if (!conn)\n        return -1;\n\n    memcpy(seclookupdef.u.uuid, secretuuid, sizeof(seclookupdef.u.uuid));\n    if (virSecretGetSecretString(conn, &seclookupdef,\n                                 VIR_SECRET_USAGE_TYPE_VTPM,\n                                 &secret, &secret_len) < 0)\n        goto error;\n\n    if (virPipe(pipefd) < 0)\n        goto error;\n\n    if (virCommandSetSendBuffer(cmd, pipefd[1], secret, secret_len) < 0)\n        goto error;\n\n    secret = NULL;\n    ret = pipefd[0];\n\n cleanup:\n    virObjectUnref(conn);\n\n    return ret;\n\n error:\n    VIR_FORCE_CLOSE(pipefd[1]);\n    VIR_FORCE_CLOSE(pipefd[0]);\n\n    goto cleanup;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_ARGUMENT_UNSUPPORTED",
            "_(\"%s does not support passing a passphrase using a file \"\n                  \"descriptor\")",
            "swtpm_setup"
          ],
          "line": 461
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virTPMSwtpmSetupCapsGet",
          "args": [
            "VIR_TPM_SWTPM_SETUP_FEATURE_CMDARG_PWDFILE_FD"
          ],
          "line": 459
        },
        "resolved": true,
        "details": {
          "function_name": "virTPMSwtpmSetupCapsGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtpm.c",
          "lines": "357-363",
          "snippet": "bool\nvirTPMSwtpmSetupCapsGet(unsigned int cap)\n{\n    if (virTPMEmulatorInit() < 0)\n        return false;\n    return virBitmapIsBitSet(swtpm_setup_caps, cap);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virjson.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"virtpm.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virBitmapPtr swtpm_setup_caps;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virjson.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"virtpm.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virBitmapPtr swtpm_setup_caps;\n\nbool\nvirTPMSwtpmSetupCapsGet(unsigned int cap)\n{\n    if (virTPMEmulatorInit() < 0)\n        return false;\n    return virBitmapIsBitSet(swtpm_setup_caps, cap);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetGID",
          "args": [
            "cmd",
            "swtpm_group"
          ],
          "line": 445
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetGID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1111-1118",
          "snippet": "void\nvirCommandSetGID(virCommandPtr cmd, gid_t gid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->gid = gid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetGID(virCommandPtr cmd, gid_t gid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->gid = gid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetUID",
          "args": [
            "cmd",
            "swtpm_user"
          ],
          "line": 444
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetUID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1120-1127",
          "snippet": "void\nvirCommandSetUID(virCommandPtr cmd, uid_t uid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->uid = uid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetUID(virCommandPtr cmd, uid_t uid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->uid = uid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s:%s\"",
            "vmname",
            "uuid"
          ],
          "line": 442
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "vmuuid",
            "uuid"
          ],
          "line": 441
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "swtpm_setup"
          ],
          "line": 437
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileWriteStr",
          "args": [
            "logfile",
            "_(\"Did not create EK and certificates since \"\n                                 \"this requires privileged mode for a \"\n                                 \"TPM 1.2\\n\")",
            "0600"
          ],
          "line": 432
        },
        "resolved": true,
        "details": {
          "function_name": "virFileWriteStr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1502-1524",
          "snippet": "int\nvirFileWriteStr(const char *path, const char *str, mode_t mode)\n{\n    int fd;\n\n    if (mode)\n        fd = open(path, O_WRONLY|O_TRUNC|O_CREAT, mode);\n    else\n        fd = open(path, O_WRONLY|O_TRUNC);\n    if (fd == -1)\n        return -1;\n\n    if (safewrite(fd, str, strlen(str)) < 0) {\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    /* Use errno from failed close only if there was no write error.  */\n    if (VIR_CLOSE(fd) != 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileWriteStr(const char *path, const char *str, mode_t mode)\n{\n    int fd;\n\n    if (mode)\n        fd = open(path, O_WRONLY|O_TRUNC|O_CREAT, mode);\n    else\n        fd = open(path, O_WRONLY|O_TRUNC);\n    if (fd == -1)\n        return -1;\n\n    if (safewrite(fd, str, strlen(str)) < 0) {\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    /* Use errno from failed close only if there was no write error.  */\n    if (VIR_CLOSE(fd) != 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTPMGetSwtpmSetup",
          "args": [],
          "line": 425
        },
        "resolved": true,
        "details": {
          "function_name": "virTPMGetSwtpmSetup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtpm.c",
          "lines": "123-136",
          "snippet": "char *\nvirTPMGetSwtpmSetup(void)\n{\n    char *s;\n\n    if (!swtpm_setup && virTPMEmulatorInit() < 0)\n        return NULL;\n\n    virMutexLock(&swtpm_tools_lock);\n    s = g_strdup(swtpm_setup);\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return s;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virjson.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"virtpm.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;",
            "static char *swtpm_setup;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virjson.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"virtpm.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;\nstatic char *swtpm_setup;\n\nchar *\nvirTPMGetSwtpmSetup(void)\n{\n    char *s;\n\n    if (!swtpm_setup && virTPMEmulatorInit() < 0)\n        return NULL;\n\n    virMutexLock(&swtpm_tools_lock);\n    s = g_strdup(swtpm_setup);\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return s;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorRunSetup(const char *storagepath,\n                        const char *vmname,\n                        const unsigned char *vmuuid,\n                        bool privileged,\n                        uid_t swtpm_user,\n                        gid_t swtpm_group,\n                        const char *logfile,\n                        const virDomainTPMVersion tpmversion,\n                        const unsigned char *secretuuid,\n                        bool incomingMigration)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    int exitstatus;\n    char uuid[VIR_UUID_STRING_BUFLEN];\n    g_autofree char *vmid = NULL;\n    g_autofree char *swtpm_setup = virTPMGetSwtpmSetup();\n    VIR_AUTOCLOSE pwdfile_fd = -1;\n\n    if (!swtpm_setup)\n        return -1;\n\n    if (!privileged && tpmversion == VIR_DOMAIN_TPM_VERSION_1_2)\n        return virFileWriteStr(logfile,\n                               _(\"Did not create EK and certificates since \"\n                                 \"this requires privileged mode for a \"\n                                 \"TPM 1.2\\n\"), 0600);\n\n    cmd = virCommandNew(swtpm_setup);\n    if (!cmd)\n        return -1;\n\n    virUUIDFormat(vmuuid, uuid);\n    vmid = g_strdup_printf(\"%s:%s\", vmname, uuid);\n\n    virCommandSetUID(cmd, swtpm_user);\n    virCommandSetGID(cmd, swtpm_group);\n\n    switch (tpmversion) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        virCommandAddArgList(cmd, \"--tpm2\", NULL);\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        break;\n    }\n\n    if (secretuuid) {\n        if (!virTPMSwtpmSetupCapsGet(\n                VIR_TPM_SWTPM_SETUP_FEATURE_CMDARG_PWDFILE_FD)) {\n            virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                _(\"%s does not support passing a passphrase using a file \"\n                  \"descriptor\"), swtpm_setup);\n            return -1;\n        }\n        if ((pwdfile_fd = qemuTPMSetupEncryption(secretuuid, cmd)) < 0)\n            return -1;\n\n        virCommandAddArg(cmd, \"--pwdfile-fd\");\n        virCommandAddArgFormat(cmd, \"%d\", pwdfile_fd);\n        virCommandAddArgList(cmd, \"--cipher\", \"aes-256-cbc\", NULL);\n        virCommandPassFD(cmd, pwdfile_fd, VIR_COMMAND_PASS_FD_CLOSE_PARENT);\n        pwdfile_fd = -1;\n    }\n\n    if (!incomingMigration) {\n        virCommandAddArgList(cmd,\n                             \"--tpm-state\", storagepath,\n                             \"--vmid\", vmid,\n                             \"--logfile\", logfile,\n                             \"--createek\",\n                             \"--create-ek-cert\",\n                             \"--create-platform-cert\",\n                             \"--lock-nvram\",\n                             \"--not-overwrite\",\n                             NULL);\n    } else {\n        virCommandAddArgList(cmd,\n                             \"--tpm-state\", storagepath,\n                             \"--overwrite\",\n                             NULL);\n    }\n\n    virCommandClearCaps(cmd);\n\n    if (virCommandRun(cmd, &exitstatus) < 0 || exitstatus != 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not run '%s'. exitstatus: %d; \"\n                         \"Check error log '%s' for details.\"),\n                          swtpm_setup, exitstatus, logfile);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuTPMSetupEncryption",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "346-388",
    "snippet": "static int\nqemuTPMSetupEncryption(const unsigned char *secretuuid,\n                       virCommandPtr cmd)\n{\n    int ret = -1;\n    int pipefd[2] = { -1, -1 };\n    virConnectPtr conn;\n    g_autofree uint8_t *secret = NULL;\n    size_t secret_len;\n    virSecretLookupTypeDef seclookupdef = {\n         .type = VIR_SECRET_LOOKUP_TYPE_UUID,\n    };\n\n    conn = virGetConnectSecret();\n    if (!conn)\n        return -1;\n\n    memcpy(seclookupdef.u.uuid, secretuuid, sizeof(seclookupdef.u.uuid));\n    if (virSecretGetSecretString(conn, &seclookupdef,\n                                 VIR_SECRET_USAGE_TYPE_VTPM,\n                                 &secret, &secret_len) < 0)\n        goto error;\n\n    if (virPipe(pipefd) < 0)\n        goto error;\n\n    if (virCommandSetSendBuffer(cmd, pipefd[1], secret, secret_len) < 0)\n        goto error;\n\n    secret = NULL;\n    ret = pipefd[0];\n\n cleanup:\n    virObjectUnref(conn);\n\n    return ret;\n\n error:\n    VIR_FORCE_CLOSE(pipefd[1]);\n    VIR_FORCE_CLOSE(pipefd[0]);\n\n    goto cleanup;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "pipefd[0]"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "pipefd[1]"
          ],
          "line": 384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "conn"
          ],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetSendBuffer",
          "args": [
            "cmd",
            "pipefd[1]",
            "secret",
            "secret_len"
          ],
          "line": 372
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetSendBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2897-2909",
          "snippet": "int\nvirCommandSetSendBuffer(virCommandPtr cmd,\n                        int fd G_GNUC_UNUSED,\n                        unsigned char *buffer G_GNUC_UNUSED,\n                        size_t buflen G_GNUC_UNUSED)\n{\n    if (!cmd || cmd->has_error)\n        return -1;\n\n    cmd->has_error = ENOTSUP;\n\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandSetSendBuffer(virCommandPtr cmd,\n                        int fd G_GNUC_UNUSED,\n                        unsigned char *buffer G_GNUC_UNUSED,\n                        size_t buflen G_GNUC_UNUSED)\n{\n    if (!cmd || cmd->has_error)\n        return -1;\n\n    cmd->has_error = ENOTSUP;\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPipe",
          "args": [
            "pipefd"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "virPipeNonBlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1813-1817",
          "snippet": "int\nvirPipeNonBlock(int fds[2])\n{\n    return virPipeImpl(fds, true, true);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPipeNonBlock(int fds[2])\n{\n    return virPipeImpl(fds, true, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretGetSecretString",
          "args": [
            "conn",
            "&seclookupdef",
            "VIR_SECRET_USAGE_TYPE_VTPM",
            "&secret",
            "&secret_len"
          ],
          "line": 364
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretGetSecretString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsecret.c",
          "lines": "143-195",
          "snippet": "int\nvirSecretGetSecretString(virConnectPtr conn,\n                         virSecretLookupTypeDefPtr seclookupdef,\n                         virSecretUsageType secretUsageType,\n                         uint8_t **secret,\n                         size_t *secret_size)\n{\n    virSecretPtr sec = NULL;\n    int ret = -1;\n\n    switch (seclookupdef->type) {\n    case VIR_SECRET_LOOKUP_TYPE_UUID:\n        sec = conn->secretDriver->secretLookupByUUID(conn, seclookupdef->u.uuid);\n        break;\n\n    case VIR_SECRET_LOOKUP_TYPE_USAGE:\n        sec = conn->secretDriver->secretLookupByUsage(conn, secretUsageType,\n                                                      seclookupdef->u.usage);\n        break;\n    }\n\n    if (!sec)\n        goto cleanup;\n\n    /* NB: NONE is a byproduct of the qemuxml2argvtest test mocking\n     * for UUID lookups. Normal secret XML processing would fail if\n     * the usage type was NONE and since we have no way to set the\n     * expected usage in that environment, let's just accept NONE */\n    if (sec->usageType != VIR_SECRET_USAGE_TYPE_NONE &&\n        sec->usageType != secretUsageType) {\n        char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n        virUUIDFormat(seclookupdef->u.uuid, uuidstr);\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"secret with uuid %s is of type '%s' not \"\n                         \"expected '%s' type\"),\n                       uuidstr, virSecretUsageTypeToString(sec->usageType),\n                       virSecretUsageTypeToString(secretUsageType));\n        goto cleanup;\n    }\n\n    *secret = conn->secretDriver->secretGetValue(sec, secret_size, 0,\n                                                 VIR_SECRET_GET_VALUE_INTERNAL_CALL);\n\n    if (!*secret)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virObjectUnref(sec);\n    return ret;\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirSecretGetSecretString(virConnectPtr conn,\n                         virSecretLookupTypeDefPtr seclookupdef,\n                         virSecretUsageType secretUsageType,\n                         uint8_t **secret,\n                         size_t *secret_size)\n{\n    virSecretPtr sec = NULL;\n    int ret = -1;\n\n    switch (seclookupdef->type) {\n    case VIR_SECRET_LOOKUP_TYPE_UUID:\n        sec = conn->secretDriver->secretLookupByUUID(conn, seclookupdef->u.uuid);\n        break;\n\n    case VIR_SECRET_LOOKUP_TYPE_USAGE:\n        sec = conn->secretDriver->secretLookupByUsage(conn, secretUsageType,\n                                                      seclookupdef->u.usage);\n        break;\n    }\n\n    if (!sec)\n        goto cleanup;\n\n    /* NB: NONE is a byproduct of the qemuxml2argvtest test mocking\n     * for UUID lookups. Normal secret XML processing would fail if\n     * the usage type was NONE and since we have no way to set the\n     * expected usage in that environment, let's just accept NONE */\n    if (sec->usageType != VIR_SECRET_USAGE_TYPE_NONE &&\n        sec->usageType != secretUsageType) {\n        char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n        virUUIDFormat(seclookupdef->u.uuid, uuidstr);\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"secret with uuid %s is of type '%s' not \"\n                         \"expected '%s' type\"),\n                       uuidstr, virSecretUsageTypeToString(sec->usageType),\n                       virSecretUsageTypeToString(secretUsageType));\n        goto cleanup;\n    }\n\n    *secret = conn->secretDriver->secretGetValue(sec, secret_size, 0,\n                                                 VIR_SECRET_GET_VALUE_INTERNAL_CALL);\n\n    if (!*secret)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virObjectUnref(sec);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcpy",
          "args": [
            "seclookupdef.u.uuid",
            "secretuuid",
            "sizeof(seclookupdef.u.uuid)"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetConnectSecret",
          "args": [],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "virGetConnectSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "184-187",
          "snippet": "virConnectPtr virGetConnectSecret(void)\n{\n    return virGetConnectGeneric(&connectSecret, \"secret\");\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virThreadLocal connectSecret;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectSecret;\n\nvirConnectPtr virGetConnectSecret(void)\n{\n    return virGetConnectGeneric(&connectSecret, \"secret\");\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMSetupEncryption(const unsigned char *secretuuid,\n                       virCommandPtr cmd)\n{\n    int ret = -1;\n    int pipefd[2] = { -1, -1 };\n    virConnectPtr conn;\n    g_autofree uint8_t *secret = NULL;\n    size_t secret_len;\n    virSecretLookupTypeDef seclookupdef = {\n         .type = VIR_SECRET_LOOKUP_TYPE_UUID,\n    };\n\n    conn = virGetConnectSecret();\n    if (!conn)\n        return -1;\n\n    memcpy(seclookupdef.u.uuid, secretuuid, sizeof(seclookupdef.u.uuid));\n    if (virSecretGetSecretString(conn, &seclookupdef,\n                                 VIR_SECRET_USAGE_TYPE_VTPM,\n                                 &secret, &secret_len) < 0)\n        goto error;\n\n    if (virPipe(pipefd) < 0)\n        goto error;\n\n    if (virCommandSetSendBuffer(cmd, pipefd[1], secret, secret_len) < 0)\n        goto error;\n\n    secret = NULL;\n    ret = pipefd[0];\n\n cleanup:\n    virObjectUnref(conn);\n\n    return ret;\n\n error:\n    VIR_FORCE_CLOSE(pipefd[1]);\n    VIR_FORCE_CLOSE(pipefd[0]);\n\n    goto cleanup;\n}"
  },
  {
    "function_name": "qemuTPMEmulatorPrepareHost",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "272-330",
    "snippet": "static int\nqemuTPMEmulatorPrepareHost(virDomainTPMDefPtr tpm,\n                           const char *logDir,\n                           const char *vmname,\n                           uid_t swtpm_user,\n                           gid_t swtpm_group,\n                           const char *swtpmStateDir,\n                           uid_t qemu_user,\n                           const char *shortName)\n{\n    if (virTPMEmulatorInit() < 0)\n        return -1;\n\n    /* create log dir ... allow 'tss' user to cd into it */\n    if (virFileMakePathWithMode(logDir, 0711) < 0)\n        return -1;\n\n    /* ... and adjust ownership */\n    if (virDirCreate(logDir, 0730, swtpm_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0)\n        return -1;\n\n    /* create logfile name ... */\n    if (!tpm->data.emulator.logfile)\n        tpm->data.emulator.logfile = g_strdup_printf(\"%s/%s-swtpm.log\", logDir, vmname);\n\n    if (!virFileExists(tpm->data.emulator.logfile) &&\n        virFileTouch(tpm->data.emulator.logfile, 0644) < 0) {\n        return -1;\n    }\n\n    /* ... and make sure it can be accessed by swtpm_user */\n    if (chown(tpm->data.emulator.logfile, swtpm_user, swtpm_group) < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not chown on swtpm logfile %s\"),\n                             tpm->data.emulator.logfile);\n        return -1;\n    }\n\n    /*\n      create our swtpm state dir ...\n      - QEMU user needs to be able to access the socket there\n      - swtpm group needs to be able to create files there\n      - in privileged mode 0570 would be enough, for non-privileged mode\n        we need 0770\n    */\n    if (virDirCreate(swtpmStateDir, 0770, qemu_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0)\n        return -1;\n\n    /* create the socket filename */\n    if (!tpm->data.emulator.source.data.nix.path &&\n        !(tpm->data.emulator.source.data.nix.path =\n          qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return -1;\n    tpm->data.emulator.source.type = VIR_DOMAIN_CHR_TYPE_UNIX;\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuTPMCreateEmulatorSocket",
          "args": [
            "swtpmStateDir",
            "shortName"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMCreateEmulatorSocket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "170-179",
          "snippet": "static char *\nqemuTPMCreateEmulatorSocket(const char *swtpmStateDir,\n                            const char *shortName)\n{\n    char *path = NULL;\n\n    path = g_strdup_printf(\"%s/%s-swtpm.sock\", swtpmStateDir, shortName);\n\n    return path;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic char *\nqemuTPMCreateEmulatorSocket(const char *swtpmStateDir,\n                            const char *shortName)\n{\n    char *path = NULL;\n\n    path = g_strdup_printf(\"%s/%s-swtpm.sock\", swtpmStateDir, shortName);\n\n    return path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDirCreate",
          "args": [
            "swtpmStateDir",
            "0770",
            "qemu_user",
            "swtpm_group",
            "VIR_DIR_CREATE_ALLOW_EXIST"
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "virDirCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2831-2842",
          "snippet": "int\nvirDirCreate(const char *path G_GNUC_UNUSED,\n             mode_t mode G_GNUC_UNUSED,\n             uid_t uid G_GNUC_UNUSED,\n             gid_t gid G_GNUC_UNUSED,\n             unsigned int flags_unused G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virDirCreate is not implemented for WIN32\"));\n\n    return -ENOSYS;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDirCreate(const char *path G_GNUC_UNUSED,\n             mode_t mode G_GNUC_UNUSED,\n             uid_t uid G_GNUC_UNUSED,\n             gid_t gid G_GNUC_UNUSED,\n             unsigned int flags_unused G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virDirCreate is not implemented for WIN32\"));\n\n    return -ENOSYS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Could not chown on swtpm logfile %s\")",
            "tpm->data.emulator.logfile"
          ],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Could not chown on swtpm logfile %s\""
          ],
          "line": 306
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "chown",
          "args": [
            "tpm->data.emulator.logfile",
            "swtpm_user",
            "swtpm_group"
          ],
          "line": 304
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileTouch",
          "args": [
            "tpm->data.emulator.logfile",
            "0644"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "virFileTouch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "591-609",
          "snippet": "int virFileTouch(const char *path, mode_t mode)\n{\n    int fd = -1;\n\n    if ((fd = open(path, O_WRONLY | O_CREAT, mode)) < 0) {\n        virReportSystemError(errno, _(\"cannot create file '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (VIR_CLOSE(fd) < 0) {\n        virReportSystemError(errno, _(\"cannot save file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileTouch(const char *path, mode_t mode)\n{\n    int fd = -1;\n\n    if ((fd = open(path, O_WRONLY | O_CREAT, mode)) < 0) {\n        virReportSystemError(errno, _(\"cannot create file '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (VIR_CLOSE(fd) < 0) {\n        virReportSystemError(errno, _(\"cannot save file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "tpm->data.emulator.logfile"
          ],
          "line": 298
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s-swtpm.log\"",
            "logDir",
            "vmname"
          ],
          "line": 296
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileMakePathWithMode",
          "args": [
            "logDir",
            "0711"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePathWithMode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3082-3091",
          "snippet": "int\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTPMEmulatorInit",
          "args": [],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "virTPMEmulatorInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtpm.c",
          "lines": "252-347",
          "snippet": "int\nvirTPMEmulatorInit(void)\n{\n    int ret = -1;\n    static const struct {\n        const char *name;\n        char **path;\n        struct stat *stat;\n        const char *parm;\n        virBitmapPtr *caps;\n        TypeFromStringFn typeFromStringFn;\n    } prgs[] = {\n        {\n            .name = \"swtpm\",\n            .path = &swtpm_path,\n            .stat = &swtpm_stat,\n            .parm = \"socket\",\n            .caps = &swtpm_caps,\n            .typeFromStringFn = virTPMSwtpmFeatureTypeFromString,\n        },\n        {\n            .name = \"swtpm_setup\",\n            .path = &swtpm_setup,\n            .stat = &swtpm_setup_stat,\n            .caps = &swtpm_setup_caps,\n            .typeFromStringFn = virTPMSwtpmSetupFeatureTypeFromString,\n        },\n        {\n            .name = \"swtpm_ioctl\",\n            .path = &swtpm_ioctl,\n            .stat = &swtpm_ioctl_stat,\n        }\n    };\n    size_t i;\n\n    virMutexLock(&swtpm_tools_lock);\n\n    for (i = 0; i < G_N_ELEMENTS(prgs); i++) {\n        g_autofree char *path = NULL;\n        bool findit = *prgs[i].path == NULL;\n        struct stat statbuf;\n        char *tmp;\n\n        if (!findit) {\n            /* has executables changed? */\n            if (stat(*prgs[i].path, &statbuf) < 0)\n                findit = true;\n\n            if (!findit &&\n                &statbuf.st_mtime != &prgs[i].stat->st_mtime)\n                findit = true;\n        }\n\n        if (findit) {\n            tmp = *prgs[i].path;\n            VIR_FREE(tmp);\n            *prgs[i].path = NULL;\n\n            path = virFindFileInPath(prgs[i].name);\n            if (!path) {\n                virReportSystemError(ENOENT,\n                                _(\"Unable to find '%s' binary in $PATH\"),\n                                prgs[i].name);\n                goto cleanup;\n            }\n            if (!virFileIsExecutable(path)) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"%s is not an executable\"),\n                               path);\n                goto cleanup;\n            }\n            if (stat(path, prgs[i].stat) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Could not stat %s\"), path);\n                goto cleanup;\n            }\n            *prgs[i].path = path;\n\n            if (prgs[i].caps) {\n                *prgs[i].caps = virTPMGetCaps(prgs[i].typeFromStringFn,\n                                              path, prgs[i].parm);\n                path = NULL;\n                if (!*prgs[i].caps)\n                    goto cleanup;\n            }\n            path = NULL;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virjson.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"virtpm.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;",
            "static char *swtpm_path;",
            "static struct stat swtpm_stat;",
            "static virBitmapPtr swtpm_caps;",
            "static char *swtpm_setup;",
            "static struct stat swtpm_setup_stat;",
            "static virBitmapPtr swtpm_setup_caps;",
            "static char *swtpm_ioctl;",
            "static struct stat swtpm_ioctl_stat;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virjson.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"virtpm.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;\nstatic char *swtpm_path;\nstatic struct stat swtpm_stat;\nstatic virBitmapPtr swtpm_caps;\nstatic char *swtpm_setup;\nstatic struct stat swtpm_setup_stat;\nstatic virBitmapPtr swtpm_setup_caps;\nstatic char *swtpm_ioctl;\nstatic struct stat swtpm_ioctl_stat;\n\nint\nvirTPMEmulatorInit(void)\n{\n    int ret = -1;\n    static const struct {\n        const char *name;\n        char **path;\n        struct stat *stat;\n        const char *parm;\n        virBitmapPtr *caps;\n        TypeFromStringFn typeFromStringFn;\n    } prgs[] = {\n        {\n            .name = \"swtpm\",\n            .path = &swtpm_path,\n            .stat = &swtpm_stat,\n            .parm = \"socket\",\n            .caps = &swtpm_caps,\n            .typeFromStringFn = virTPMSwtpmFeatureTypeFromString,\n        },\n        {\n            .name = \"swtpm_setup\",\n            .path = &swtpm_setup,\n            .stat = &swtpm_setup_stat,\n            .caps = &swtpm_setup_caps,\n            .typeFromStringFn = virTPMSwtpmSetupFeatureTypeFromString,\n        },\n        {\n            .name = \"swtpm_ioctl\",\n            .path = &swtpm_ioctl,\n            .stat = &swtpm_ioctl_stat,\n        }\n    };\n    size_t i;\n\n    virMutexLock(&swtpm_tools_lock);\n\n    for (i = 0; i < G_N_ELEMENTS(prgs); i++) {\n        g_autofree char *path = NULL;\n        bool findit = *prgs[i].path == NULL;\n        struct stat statbuf;\n        char *tmp;\n\n        if (!findit) {\n            /* has executables changed? */\n            if (stat(*prgs[i].path, &statbuf) < 0)\n                findit = true;\n\n            if (!findit &&\n                &statbuf.st_mtime != &prgs[i].stat->st_mtime)\n                findit = true;\n        }\n\n        if (findit) {\n            tmp = *prgs[i].path;\n            VIR_FREE(tmp);\n            *prgs[i].path = NULL;\n\n            path = virFindFileInPath(prgs[i].name);\n            if (!path) {\n                virReportSystemError(ENOENT,\n                                _(\"Unable to find '%s' binary in $PATH\"),\n                                prgs[i].name);\n                goto cleanup;\n            }\n            if (!virFileIsExecutable(path)) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"%s is not an executable\"),\n                               path);\n                goto cleanup;\n            }\n            if (stat(path, prgs[i].stat) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Could not stat %s\"), path);\n                goto cleanup;\n            }\n            *prgs[i].path = path;\n\n            if (prgs[i].caps) {\n                *prgs[i].caps = virTPMGetCaps(prgs[i].typeFromStringFn,\n                                              path, prgs[i].parm);\n                path = NULL;\n                if (!*prgs[i].caps)\n                    goto cleanup;\n            }\n            path = NULL;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorPrepareHost(virDomainTPMDefPtr tpm,\n                           const char *logDir,\n                           const char *vmname,\n                           uid_t swtpm_user,\n                           gid_t swtpm_group,\n                           const char *swtpmStateDir,\n                           uid_t qemu_user,\n                           const char *shortName)\n{\n    if (virTPMEmulatorInit() < 0)\n        return -1;\n\n    /* create log dir ... allow 'tss' user to cd into it */\n    if (virFileMakePathWithMode(logDir, 0711) < 0)\n        return -1;\n\n    /* ... and adjust ownership */\n    if (virDirCreate(logDir, 0730, swtpm_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0)\n        return -1;\n\n    /* create logfile name ... */\n    if (!tpm->data.emulator.logfile)\n        tpm->data.emulator.logfile = g_strdup_printf(\"%s/%s-swtpm.log\", logDir, vmname);\n\n    if (!virFileExists(tpm->data.emulator.logfile) &&\n        virFileTouch(tpm->data.emulator.logfile, 0644) < 0) {\n        return -1;\n    }\n\n    /* ... and make sure it can be accessed by swtpm_user */\n    if (chown(tpm->data.emulator.logfile, swtpm_user, swtpm_group) < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not chown on swtpm logfile %s\"),\n                             tpm->data.emulator.logfile);\n        return -1;\n    }\n\n    /*\n      create our swtpm state dir ...\n      - QEMU user needs to be able to access the socket there\n      - swtpm group needs to be able to create files there\n      - in privileged mode 0570 would be enough, for non-privileged mode\n        we need 0770\n    */\n    if (virDirCreate(swtpmStateDir, 0770, qemu_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0)\n        return -1;\n\n    /* create the socket filename */\n    if (!tpm->data.emulator.source.data.nix.path &&\n        !(tpm->data.emulator.source.data.nix.path =\n          qemuTPMCreateEmulatorSocket(swtpmStateDir, shortName)))\n        return -1;\n    tpm->data.emulator.source.type = VIR_DOMAIN_CHR_TYPE_UNIX;\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuTPMEmulatorGetPid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "238-253",
    "snippet": "static int\nqemuTPMEmulatorGetPid(const char *swtpmStateDir,\n                      const char *shortName,\n                      pid_t *pid)\n{\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    g_autofree char *pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir,\n                                                                shortName);\n    if (!pidfile)\n        return -1;\n\n    if (virPidFileReadPathIfAlive(pidfile, pid, swtpm) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virPidFileReadPathIfAlive",
          "args": [
            "pidfile",
            "pid",
            "swtpm"
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileReadPathIfAlive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "187-264",
          "snippet": "int virPidFileReadPathIfAlive(const char *path,\n                              pid_t *pid,\n                              const char *binPath)\n{\n    int rc;\n    bool isLink = false;\n    size_t procLinkLen;\n    const char deletedText[] = \" (deleted)\";\n    size_t deletedTextLen = strlen(deletedText);\n    pid_t retPid;\n    g_autofree char *procPath = NULL;\n    g_autofree char *procLink = NULL;\n    g_autofree char *resolvedBinPath = NULL;\n    g_autofree char *resolvedProcLink = NULL;\n\n    /* only set this at the very end on success */\n    *pid = -1;\n\n    if (virPidFileReadPath(path, &retPid) < 0)\n        return -1;\n\n#ifndef WIN32\n    /* Check that it's still alive.  Safe to skip this sanity check on\n     * mingw, which lacks kill().  */\n    if (kill(retPid, 0) < 0) {\n        *pid = -1;\n        return 0;\n    }\n#endif\n\n    if (!binPath) {\n        /* we only knew the pid, and that pid is alive, so we can\n         * return it.\n         */\n        *pid = retPid;\n        return 0;\n    }\n\n    procPath = g_strdup_printf(\"/proc/%lld/exe\", (long long)retPid);\n\n    if ((rc = virFileIsLink(procPath)) < 0)\n        return -1;\n\n    if (rc == 1)\n        isLink = true;\n\n    if (isLink && virFileLinkPointsTo(procPath, binPath)) {\n        /* the link in /proc/$pid/exe is a symlink to a file\n         * that has the same inode as the file at binpath.\n         */\n        *pid = retPid;\n        return 0;\n    }\n\n    /* Even if virFileLinkPointsTo returns a mismatch, it could be\n     * that the binary was deleted/replaced after it was executed. In\n     * that case the link in /proc/$pid/exe will contain\n     * \"$procpath (deleted)\".  Read that link, remove the \" (deleted)\"\n     * part, and see if it has the same canonicalized name as binpath.\n     */\n    if (!(procLink = g_file_read_link(procPath, NULL)))\n        return -1;\n\n    procLinkLen = strlen(procLink);\n    if (procLinkLen > deletedTextLen)\n        procLink[procLinkLen - deletedTextLen] = 0;\n\n    if (virFileResolveAllLinks(binPath, &resolvedBinPath) < 0)\n        return -1;\n    if (virFileResolveAllLinks(procLink, &resolvedProcLink) < 0)\n        return -1;\n\n    if (STRNEQ(resolvedBinPath, resolvedProcLink))\n        return -1;\n\n    *pid = retPid;\n    return 0;\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileReadPathIfAlive(const char *path,\n                              pid_t *pid,\n                              const char *binPath)\n{\n    int rc;\n    bool isLink = false;\n    size_t procLinkLen;\n    const char deletedText[] = \" (deleted)\";\n    size_t deletedTextLen = strlen(deletedText);\n    pid_t retPid;\n    g_autofree char *procPath = NULL;\n    g_autofree char *procLink = NULL;\n    g_autofree char *resolvedBinPath = NULL;\n    g_autofree char *resolvedProcLink = NULL;\n\n    /* only set this at the very end on success */\n    *pid = -1;\n\n    if (virPidFileReadPath(path, &retPid) < 0)\n        return -1;\n\n#ifndef WIN32\n    /* Check that it's still alive.  Safe to skip this sanity check on\n     * mingw, which lacks kill().  */\n    if (kill(retPid, 0) < 0) {\n        *pid = -1;\n        return 0;\n    }\n#endif\n\n    if (!binPath) {\n        /* we only knew the pid, and that pid is alive, so we can\n         * return it.\n         */\n        *pid = retPid;\n        return 0;\n    }\n\n    procPath = g_strdup_printf(\"/proc/%lld/exe\", (long long)retPid);\n\n    if ((rc = virFileIsLink(procPath)) < 0)\n        return -1;\n\n    if (rc == 1)\n        isLink = true;\n\n    if (isLink && virFileLinkPointsTo(procPath, binPath)) {\n        /* the link in /proc/$pid/exe is a symlink to a file\n         * that has the same inode as the file at binpath.\n         */\n        *pid = retPid;\n        return 0;\n    }\n\n    /* Even if virFileLinkPointsTo returns a mismatch, it could be\n     * that the binary was deleted/replaced after it was executed. In\n     * that case the link in /proc/$pid/exe will contain\n     * \"$procpath (deleted)\".  Read that link, remove the \" (deleted)\"\n     * part, and see if it has the same canonicalized name as binpath.\n     */\n    if (!(procLink = g_file_read_link(procPath, NULL)))\n        return -1;\n\n    procLinkLen = strlen(procLink);\n    if (procLinkLen > deletedTextLen)\n        procLink[procLinkLen - deletedTextLen] = 0;\n\n    if (virFileResolveAllLinks(binPath, &resolvedBinPath) < 0)\n        return -1;\n    if (virFileResolveAllLinks(procLink, &resolvedProcLink) < 0)\n        return -1;\n\n    if (STRNEQ(resolvedBinPath, resolvedProcLink))\n        return -1;\n\n    *pid = retPid;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorCreatePidFilename",
          "args": [
            "swtpmStateDir",
            "shortName"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorCreatePidFilename",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "212-224",
          "snippet": "static char *\nqemuTPMEmulatorCreatePidFilename(const char *swtpmStateDir,\n                                 const char *shortName)\n{\n    char *pidfile = NULL;\n    g_autofree char *devicename = NULL;\n\n    devicename = g_strdup_printf(\"%s-swtpm\", shortName);\n\n    pidfile = virPidFileBuildPath(swtpmStateDir, devicename);\n\n    return pidfile;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic char *\nqemuTPMEmulatorCreatePidFilename(const char *swtpmStateDir,\n                                 const char *shortName)\n{\n    char *pidfile = NULL;\n    g_autofree char *devicename = NULL;\n\n    devicename = g_strdup_printf(\"%s-swtpm\", shortName);\n\n    pidfile = virPidFileBuildPath(swtpmStateDir, devicename);\n\n    return pidfile;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTPMGetSwtpm",
          "args": [],
          "line": 243
        },
        "resolved": true,
        "details": {
          "function_name": "virTPMGetSwtpmIoctl",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtpm.c",
          "lines": "138-151",
          "snippet": "char *\nvirTPMGetSwtpmIoctl(void)\n{\n    char *s;\n\n    if (!swtpm_ioctl && virTPMEmulatorInit() < 0)\n        return NULL;\n\n    virMutexLock(&swtpm_tools_lock);\n    s = g_strdup(swtpm_ioctl);\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return s;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virjson.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"virtpm.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;",
            "static char *swtpm_ioctl;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virjson.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"virtpm.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nstatic virMutex swtpm_tools_lock = VIR_MUTEX_INITIALIZER;\nstatic char *swtpm_ioctl;\n\nchar *\nvirTPMGetSwtpmIoctl(void)\n{\n    char *s;\n\n    if (!swtpm_ioctl && virTPMEmulatorInit() < 0)\n        return NULL;\n\n    virMutexLock(&swtpm_tools_lock);\n    s = g_strdup(swtpm_ioctl);\n    virMutexUnlock(&swtpm_tools_lock);\n\n    return s;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorGetPid(const char *swtpmStateDir,\n                      const char *shortName,\n                      pid_t *pid)\n{\n    g_autofree char *swtpm = virTPMGetSwtpm();\n    g_autofree char *pidfile = qemuTPMEmulatorCreatePidFilename(swtpmStateDir,\n                                                                shortName);\n    if (!pidfile)\n        return -1;\n\n    if (virPidFileReadPathIfAlive(pidfile, pid, swtpm) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuTPMEmulatorCreatePidFilename",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "212-224",
    "snippet": "static char *\nqemuTPMEmulatorCreatePidFilename(const char *swtpmStateDir,\n                                 const char *shortName)\n{\n    char *pidfile = NULL;\n    g_autofree char *devicename = NULL;\n\n    devicename = g_strdup_printf(\"%s-swtpm\", shortName);\n\n    pidfile = virPidFileBuildPath(swtpmStateDir, devicename);\n\n    return pidfile;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virPidFileBuildPath",
          "args": [
            "swtpmStateDir",
            "devicename"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileBuildPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "43-51",
          "snippet": "char *virPidFileBuildPath(const char *dir, const char* name)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virBufferAsprintf(&buf, \"%s\", dir);\n    virBufferEscapeString(&buf, \"/%s.pid\", name);\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nchar *virPidFileBuildPath(const char *dir, const char* name)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virBufferAsprintf(&buf, \"%s\", dir);\n    virBufferEscapeString(&buf, \"/%s.pid\", name);\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s-swtpm\"",
            "shortName"
          ],
          "line": 219
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic char *\nqemuTPMEmulatorCreatePidFilename(const char *swtpmStateDir,\n                                 const char *shortName)\n{\n    char *pidfile = NULL;\n    g_autofree char *devicename = NULL;\n\n    devicename = g_strdup_printf(\"%s-swtpm\", shortName);\n\n    pidfile = virPidFileBuildPath(swtpmStateDir, devicename);\n\n    return pidfile;\n}"
  },
  {
    "function_name": "qemuTPMEmulatorInitPaths",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "190-206",
    "snippet": "static int\nqemuTPMEmulatorInitPaths(virDomainTPMDefPtr tpm,\n                         const char *swtpmStorageDir,\n                         const unsigned char *uuid)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(uuid, uuidstr);\n\n    if (!tpm->data.emulator.storagepath &&\n        !(tpm->data.emulator.storagepath =\n            qemuTPMCreateEmulatorStoragePath(swtpmStorageDir, uuidstr,\n                                             tpm->version)))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuTPMCreateEmulatorStoragePath",
          "args": [
            "swtpmStorageDir",
            "uuidstr",
            "tpm->version"
          ],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMCreateEmulatorStoragePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "60-82",
          "snippet": "static char *\nqemuTPMCreateEmulatorStoragePath(const char *swtpmStorageDir,\n                                 const char *uuidstr,\n                                 virDomainTPMVersion tpmversion)\n{\n    char *path = NULL;\n    const char *dir = \"\";\n\n    switch (tpmversion) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        dir = \"tpm1.2\";\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        dir = \"tpm2\";\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        return NULL;\n    }\n\n    path = g_strdup_printf(\"%s/%s/%s\", swtpmStorageDir, uuidstr, dir);\n    return path;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic char *\nqemuTPMCreateEmulatorStoragePath(const char *swtpmStorageDir,\n                                 const char *uuidstr,\n                                 virDomainTPMVersion tpmversion)\n{\n    char *path = NULL;\n    const char *dir = \"\";\n\n    switch (tpmversion) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        dir = \"tpm1.2\";\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        dir = \"tpm2\";\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        return NULL;\n    }\n\n    path = g_strdup_printf(\"%s/%s/%s\", swtpmStorageDir, uuidstr, dir);\n    return path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "uuid",
            "uuidstr"
          ],
          "line": 197
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorInitPaths(virDomainTPMDefPtr tpm,\n                         const char *swtpmStorageDir,\n                         const unsigned char *uuid)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(uuid, uuidstr);\n\n    if (!tpm->data.emulator.storagepath &&\n        !(tpm->data.emulator.storagepath =\n            qemuTPMCreateEmulatorStoragePath(swtpmStorageDir, uuidstr,\n                                             tpm->version)))\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuTPMCreateEmulatorSocket",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "170-179",
    "snippet": "static char *\nqemuTPMCreateEmulatorSocket(const char *swtpmStateDir,\n                            const char *shortName)\n{\n    char *path = NULL;\n\n    path = g_strdup_printf(\"%s/%s-swtpm.sock\", swtpmStateDir, shortName);\n\n    return path;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s-swtpm.sock\"",
            "swtpmStateDir",
            "shortName"
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic char *\nqemuTPMCreateEmulatorSocket(const char *swtpmStateDir,\n                            const char *shortName)\n{\n    char *path = NULL;\n\n    path = g_strdup_printf(\"%s/%s-swtpm.sock\", swtpmStateDir, shortName);\n\n    return path;\n}"
  },
  {
    "function_name": "qemuTPMDeleteEmulatorStorage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "153-159",
    "snippet": "static void\nqemuTPMDeleteEmulatorStorage(virDomainTPMDefPtr tpm)\n{\n    g_autofree char *path =  g_path_get_dirname(tpm->data.emulator.storagepath);\n\n    ignore_value(virFileDeleteTree(path));\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virFileDeleteTree(path)"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileDeleteTree",
          "args": [
            "path"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "virFileDeleteTree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1009-1062",
          "snippet": "int virFileDeleteTree(const char *dir)\n{\n    DIR *dh;\n    struct dirent *de;\n    int ret = -1;\n    int direrr;\n\n    /* Silently return 0 if passed NULL or directory doesn't exist */\n    if (!dir || !virFileExists(dir))\n        return 0;\n\n    if (virDirOpen(&dh, dir) < 0)\n        return -1;\n\n    while ((direrr = virDirRead(dh, &de, dir)) > 0) {\n        g_autofree char *filepath = NULL;\n        GStatBuf sb;\n\n        filepath = g_strdup_printf(\"%s/%s\", dir, de->d_name);\n\n        if (g_lstat(filepath, &sb) < 0) {\n            virReportSystemError(errno, _(\"Cannot access '%s'\"),\n                                 filepath);\n            goto cleanup;\n        }\n\n        if (S_ISDIR(sb.st_mode)) {\n            if (virFileDeleteTree(filepath) < 0)\n                goto cleanup;\n        } else {\n            if (unlink(filepath) < 0 && errno != ENOENT) {\n                virReportSystemError(errno,\n                                     _(\"Cannot delete file '%s'\"),\n                                     filepath);\n                goto cleanup;\n            }\n        }\n    }\n    if (direrr < 0)\n        goto cleanup;\n\n    if (rmdir(dir) < 0 && errno != ENOENT) {\n        virReportSystemError(errno,\n                             _(\"Cannot delete directory '%s'\"),\n                             dir);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_DIR_CLOSE(dh);\n    return ret;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileDeleteTree(const char *dir)\n{\n    DIR *dh;\n    struct dirent *de;\n    int ret = -1;\n    int direrr;\n\n    /* Silently return 0 if passed NULL or directory doesn't exist */\n    if (!dir || !virFileExists(dir))\n        return 0;\n\n    if (virDirOpen(&dh, dir) < 0)\n        return -1;\n\n    while ((direrr = virDirRead(dh, &de, dir)) > 0) {\n        g_autofree char *filepath = NULL;\n        GStatBuf sb;\n\n        filepath = g_strdup_printf(\"%s/%s\", dir, de->d_name);\n\n        if (g_lstat(filepath, &sb) < 0) {\n            virReportSystemError(errno, _(\"Cannot access '%s'\"),\n                                 filepath);\n            goto cleanup;\n        }\n\n        if (S_ISDIR(sb.st_mode)) {\n            if (virFileDeleteTree(filepath) < 0)\n                goto cleanup;\n        } else {\n            if (unlink(filepath) < 0 && errno != ENOENT) {\n                virReportSystemError(errno,\n                                     _(\"Cannot delete file '%s'\"),\n                                     filepath);\n                goto cleanup;\n            }\n        }\n    }\n    if (direrr < 0)\n        goto cleanup;\n\n    if (rmdir(dir) < 0 && errno != ENOENT) {\n        virReportSystemError(errno,\n                             _(\"Cannot delete directory '%s'\"),\n                             dir);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_DIR_CLOSE(dh);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_path_get_dirname",
          "args": [
            "tpm->data.emulator.storagepath"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic void\nqemuTPMDeleteEmulatorStorage(virDomainTPMDefPtr tpm)\n{\n    g_autofree char *path =  g_path_get_dirname(tpm->data.emulator.storagepath);\n\n    ignore_value(virFileDeleteTree(path));\n}"
  },
  {
    "function_name": "qemuTPMCreateEmulatorStorage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "122-150",
    "snippet": "static int\nqemuTPMCreateEmulatorStorage(const char *storagepath,\n                             bool *created,\n                             uid_t swtpm_user,\n                             gid_t swtpm_group)\n{\n    g_autofree char *swtpmStorageDir = g_path_get_dirname(storagepath);\n\n    if (qemuTPMEmulatorInitStorage(swtpmStorageDir) < 0)\n        return -1;\n\n    *created = false;\n\n    if (!virFileExists(storagepath))\n        *created = true;\n\n    if (virDirCreate(storagepath, 0700, swtpm_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not create directory %s as %u:%d\"),\n                       storagepath, swtpm_user, swtpm_group);\n        return -1;\n    }\n\n    if (virFileChownFiles(storagepath, swtpm_user, swtpm_group) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virFileChownFiles",
          "args": [
            "storagepath",
            "swtpm_user",
            "swtpm_group"
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "virFileChownFiles",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3019-3028",
          "snippet": "int virFileChownFiles(const char *name,\n                      uid_t uid,\n                      gid_t gid)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"cannot chown '%s' to (%u, %u)\"),\n                         name, (unsigned int) uid,\n                         (unsigned int) gid);\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileChownFiles(const char *name,\n                      uid_t uid,\n                      gid_t gid)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"cannot chown '%s' to (%u, %u)\"),\n                         name, (unsigned int) uid,\n                         (unsigned int) gid);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Could not create directory %s as %u:%d\")",
            "storagepath",
            "swtpm_user",
            "swtpm_group"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Could not create directory %s as %u:%d\""
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDirCreate",
          "args": [
            "storagepath",
            "0700",
            "swtpm_user",
            "swtpm_group",
            "VIR_DIR_CREATE_ALLOW_EXIST"
          ],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "virDirCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2831-2842",
          "snippet": "int\nvirDirCreate(const char *path G_GNUC_UNUSED,\n             mode_t mode G_GNUC_UNUSED,\n             uid_t uid G_GNUC_UNUSED,\n             gid_t gid G_GNUC_UNUSED,\n             unsigned int flags_unused G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virDirCreate is not implemented for WIN32\"));\n\n    return -ENOSYS;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDirCreate(const char *path G_GNUC_UNUSED,\n             mode_t mode G_GNUC_UNUSED,\n             uid_t uid G_GNUC_UNUSED,\n             gid_t gid G_GNUC_UNUSED,\n             unsigned int flags_unused G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virDirCreate is not implemented for WIN32\"));\n\n    return -ENOSYS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "storagepath"
          ],
          "line": 135
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuTPMEmulatorInitStorage",
          "args": [
            "swtpmStorageDir"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "qemuTPMEmulatorInitStorage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
          "lines": "92-106",
          "snippet": "static int\nqemuTPMEmulatorInitStorage(const char *swtpmStorageDir)\n{\n    int rc = 0;\n\n    /* allow others to cd into this dir */\n    if (virFileMakePathWithMode(swtpmStorageDir, 0711) < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not create TPM directory %s\"),\n                             swtpmStorageDir);\n        rc = -1;\n    }\n\n    return rc;\n}",
          "includes": [
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"qemu_tpm.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorInitStorage(const char *swtpmStorageDir)\n{\n    int rc = 0;\n\n    /* allow others to cd into this dir */\n    if (virFileMakePathWithMode(swtpmStorageDir, 0711) < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not create TPM directory %s\"),\n                             swtpmStorageDir);\n        rc = -1;\n    }\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_path_get_dirname",
          "args": [
            "storagepath"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMCreateEmulatorStorage(const char *storagepath,\n                             bool *created,\n                             uid_t swtpm_user,\n                             gid_t swtpm_group)\n{\n    g_autofree char *swtpmStorageDir = g_path_get_dirname(storagepath);\n\n    if (qemuTPMEmulatorInitStorage(swtpmStorageDir) < 0)\n        return -1;\n\n    *created = false;\n\n    if (!virFileExists(storagepath))\n        *created = true;\n\n    if (virDirCreate(storagepath, 0700, swtpm_user, swtpm_group,\n                     VIR_DIR_CREATE_ALLOW_EXIST) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Could not create directory %s as %u:%d\"),\n                       storagepath, swtpm_user, swtpm_group);\n        return -1;\n    }\n\n    if (virFileChownFiles(storagepath, swtpm_user, swtpm_group) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuTPMEmulatorInitStorage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "92-106",
    "snippet": "static int\nqemuTPMEmulatorInitStorage(const char *swtpmStorageDir)\n{\n    int rc = 0;\n\n    /* allow others to cd into this dir */\n    if (virFileMakePathWithMode(swtpmStorageDir, 0711) < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not create TPM directory %s\"),\n                             swtpmStorageDir);\n        rc = -1;\n    }\n\n    return rc;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Could not create TPM directory %s\")",
            "swtpmStorageDir"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Could not create TPM directory %s\""
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileMakePathWithMode",
          "args": [
            "swtpmStorageDir",
            "0711"
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePathWithMode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3082-3091",
          "snippet": "int\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic int\nqemuTPMEmulatorInitStorage(const char *swtpmStorageDir)\n{\n    int rc = 0;\n\n    /* allow others to cd into this dir */\n    if (virFileMakePathWithMode(swtpmStorageDir, 0711) < 0) {\n        virReportSystemError(errno,\n                             _(\"Could not create TPM directory %s\"),\n                             swtpmStorageDir);\n        rc = -1;\n    }\n\n    return rc;\n}"
  },
  {
    "function_name": "qemuTPMCreateEmulatorStoragePath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_tpm.c",
    "lines": "60-82",
    "snippet": "static char *\nqemuTPMCreateEmulatorStoragePath(const char *swtpmStorageDir,\n                                 const char *uuidstr,\n                                 virDomainTPMVersion tpmversion)\n{\n    char *path = NULL;\n    const char *dir = \"\";\n\n    switch (tpmversion) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        dir = \"tpm1.2\";\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        dir = \"tpm2\";\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        return NULL;\n    }\n\n    path = g_strdup_printf(\"%s/%s/%s\", swtpmStorageDir, uuidstr, dir);\n    return path;\n}",
    "includes": [
      "#include \"virsecret.h\"",
      "#include \"virtpm.h\"",
      "#include \"qemu_tpm.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virutil.h\"",
      "#include \"virlog.h\"",
      "#include \"virkmod.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"conf/domain_conf.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/stat.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s/%s\"",
            "swtpmStorageDir",
            "uuidstr",
            "dir"
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"qemu_tpm.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_security.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_extdevice.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <config.h>\n\nstatic char *\nqemuTPMCreateEmulatorStoragePath(const char *swtpmStorageDir,\n                                 const char *uuidstr,\n                                 virDomainTPMVersion tpmversion)\n{\n    char *path = NULL;\n    const char *dir = \"\";\n\n    switch (tpmversion) {\n    case VIR_DOMAIN_TPM_VERSION_1_2:\n        dir = \"tpm1.2\";\n        break;\n    case VIR_DOMAIN_TPM_VERSION_2_0:\n        dir = \"tpm2\";\n        break;\n    case VIR_DOMAIN_TPM_VERSION_DEFAULT:\n    case VIR_DOMAIN_TPM_VERSION_LAST:\n        return NULL;\n    }\n\n    path = g_strdup_printf(\"%s/%s/%s\", swtpmStorageDir, uuidstr, dir);\n    return path;\n}"
  }
]