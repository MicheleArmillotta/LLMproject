[
  {
    "function_name": "qemuDBusVMStateRemove",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_dbus.c",
    "lines": "84-94",
    "snippet": "void\nqemuDBusVMStateRemove(virQEMUDriverPtr driver, virDomainObjPtr vm,\n                      const char *id, bool hot)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    if (virHashRemoveEntry(priv->dbusVMStates, id) < 0 ||\n        (hot && virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_DBUS_VMSTATE) &&\n         qemuDomainDetachDBusVMState(driver, vm, id, QEMU_ASYNC_JOB_NONE) < 0))\n        VIR_ERROR(_(\"Failed to remove vmstate id '%s'\"), vm->def->name);\n}",
    "includes": [
      "#include \"virpidfile.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_hotplug.h\"",
      "#include \"qemu_dbus.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Failed to remove vmstate id '%s'\")",
            "vm->def->name"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to remove vmstate id '%s'\""
          ],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDomainDetachDBusVMState",
          "args": [
            "driver",
            "vm",
            "id",
            "QEMU_ASYNC_JOB_NONE"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainDetachDBusVMState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_hotplug.c",
          "lines": "461-481",
          "snippet": "int\nqemuDomainDetachDBusVMState(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            const char *id,\n                            qemuDomainAsyncJob asyncJob)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    g_autofree char *alias = qemuAliasDBusVMStateFromId(id);\n    int ret;\n\n    if (!alias ||\n        qemuDomainObjEnterMonitorAsync(driver, vm, asyncJob) < 0)\n        return -1;\n\n    ret = qemuMonitorDelObject(priv->mon, alias, true);\n\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        return -1;\n\n    return ret;\n}",
          "includes": [
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"device_conf.h\"",
            "#include \"virnetdevmidonet.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include \"virnetdev.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virpci.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"domain_audit.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_interface.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_domain_address.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void\nqemuDomainResetDeviceRemoval(virDomainObjPtr vm);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"device_conf.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"locking/domain_lock.h\"\n#include \"qemu_cgroup.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virpci.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"domain_nwfilter.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"domain_audit.h\"\n#include \"qemu_block.h\"\n#include \"qemu_security.h\"\n#include \"qemu_process.h\"\n#include \"qemu_interface.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_command.h\"\n#include \"qemu_domain_address.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_hotplug.h\"\n#include <config.h>\n\nstatic void\nqemuDomainResetDeviceRemoval(virDomainObjPtr vm);\n\nint\nqemuDomainDetachDBusVMState(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            const char *id,\n                            qemuDomainAsyncJob asyncJob)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    g_autofree char *alias = qemuAliasDBusVMStateFromId(id);\n    int ret;\n\n    if (!alias ||\n        qemuDomainObjEnterMonitorAsync(driver, vm, asyncJob) < 0)\n        return -1;\n\n    ret = qemuMonitorDelObject(priv->mon, alias, true);\n\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        return -1;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUCapsGet",
          "args": [
            "priv->qemuCaps",
            "QEMU_CAPS_DBUS_VMSTATE"
          ],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUCapsGetPreferredMachine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_capabilities.c",
          "lines": "5555-5564",
          "snippet": "const char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <stdarg.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"virutil.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_qapi.h\"",
            "#include \"qemu_capspriv.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"virstring.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virnuma.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu_x86.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfilecache.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vircrypto.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <stdarg.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"virutil.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_process.h\"\n#include \"qemu_qapi.h\"\n#include \"qemu_capspriv.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_hostdev.h\"\n#include \"virstring.h\"\n#include \"qemu_monitor.h\"\n#include \"virhostcpu.h\"\n#include \"virnuma.h\"\n#include \"virnodesuspend.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu_x86.h\"\n#include \"cpu/cpu.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfilecache.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vircrypto.h\"\n#include \"viralloc.h\"\n#include \"qemu_capabilities.h\"\n#include <config.h>\n\nconst char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "priv->dbusVMStates",
            "id"
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virpidfile.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_extdevice.h\"\n#include <config.h>\n\nvoid\nqemuDBusVMStateRemove(virQEMUDriverPtr driver, virDomainObjPtr vm,\n                      const char *id, bool hot)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    if (virHashRemoveEntry(priv->dbusVMStates, id) < 0 ||\n        (hot && virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_DBUS_VMSTATE) &&\n         qemuDomainDetachDBusVMState(driver, vm, id, QEMU_ASYNC_JOB_NONE) < 0))\n        VIR_ERROR(_(\"Failed to remove vmstate id '%s'\"), vm->def->name);\n}"
  },
  {
    "function_name": "qemuDBusVMStateAdd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_dbus.c",
    "lines": "64-81",
    "snippet": "int\nqemuDBusVMStateAdd(virQEMUDriverPtr driver, virDomainObjPtr vm,\n                   const char *id, const char *addr, bool hot)\n{\n    qemuDBusVMStatePtr d = qemuDBusVMStateNew(id, addr);\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    if (virHashAddEntry(priv->dbusVMStates, id, d) < 0) {\n        qemuDBusVMStateFree(d);\n        return -1;\n    }\n\n    if (hot && virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_DBUS_VMSTATE) &&\n        qemuDomainAttachDBusVMState(driver, vm, id, addr, QEMU_ASYNC_JOB_NONE) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virpidfile.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_hotplug.h\"",
      "#include \"qemu_dbus.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuDomainAttachDBusVMState",
          "args": [
            "driver",
            "vm",
            "id",
            "addr",
            "QEMU_ASYNC_JOB_NONE"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDomainAttachDBusVMState",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_hotplug.c",
          "lines": "419-448",
          "snippet": "int\nqemuDomainAttachDBusVMState(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            const char *id,\n                            const char *addr,\n                            qemuDomainAsyncJob asyncJob)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    g_autoptr(virJSONValue) props = NULL;\n    int ret;\n\n    if (!virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_DBUS_VMSTATE)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"dbus-vmstate object is not supported by this QEMU binary\"));\n        return -1;\n    }\n\n    if (!(props = qemuBuildDBusVMStateInfoProps(id, addr)))\n        return -1;\n\n    if (qemuDomainObjEnterMonitorAsync(driver, vm, asyncJob) < 0)\n        return -1;\n\n    ret = qemuMonitorAddObject(priv->mon, &props, NULL);\n\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        return -1;\n\n    return ret;\n}",
          "includes": [
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"device_conf.h\"",
            "#include \"virnetdevmidonet.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdevbridge.h\"",
            "#include \"virnetdev.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virpci.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"domain_audit.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_interface.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_domain_address.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void\nqemuDomainResetDeviceRemoval(virDomainObjPtr vm);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virstoragefile.h\"\n#include \"device_conf.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdevbridge.h\"\n#include \"virnetdev.h\"\n#include \"locking/domain_lock.h\"\n#include \"qemu_cgroup.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virpci.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"domain_nwfilter.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"domain_audit.h\"\n#include \"qemu_block.h\"\n#include \"qemu_security.h\"\n#include \"qemu_process.h\"\n#include \"qemu_interface.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_command.h\"\n#include \"qemu_domain_address.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_hotplug.h\"\n#include <config.h>\n\nstatic void\nqemuDomainResetDeviceRemoval(virDomainObjPtr vm);\n\nint\nqemuDomainAttachDBusVMState(virQEMUDriverPtr driver,\n                            virDomainObjPtr vm,\n                            const char *id,\n                            const char *addr,\n                            qemuDomainAsyncJob asyncJob)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    g_autoptr(virJSONValue) props = NULL;\n    int ret;\n\n    if (!virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_DBUS_VMSTATE)) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"dbus-vmstate object is not supported by this QEMU binary\"));\n        return -1;\n    }\n\n    if (!(props = qemuBuildDBusVMStateInfoProps(id, addr)))\n        return -1;\n\n    if (qemuDomainObjEnterMonitorAsync(driver, vm, asyncJob) < 0)\n        return -1;\n\n    ret = qemuMonitorAddObject(priv->mon, &props, NULL);\n\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        return -1;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virQEMUCapsGet",
          "args": [
            "priv->qemuCaps",
            "QEMU_CAPS_DBUS_VMSTATE"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "virQEMUCapsGetPreferredMachine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_capabilities.c",
          "lines": "5555-5564",
          "snippet": "const char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}",
          "includes": [
            "#include <sys/utsname.h>",
            "#include <stdarg.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include \"virutil.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_qapi.h\"",
            "#include \"qemu_capspriv.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"virstring.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virnuma.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virbitmap.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu_x86.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfilecache.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"vircrypto.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/utsname.h>\n#include <stdarg.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include \"virutil.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_process.h\"\n#include \"qemu_qapi.h\"\n#include \"qemu_capspriv.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_hostdev.h\"\n#include \"virstring.h\"\n#include \"qemu_monitor.h\"\n#include \"virhostcpu.h\"\n#include \"virnuma.h\"\n#include \"virnodesuspend.h\"\n#include \"virbitmap.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu_x86.h\"\n#include \"cpu/cpu.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfilecache.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"vircrypto.h\"\n#include \"viralloc.h\"\n#include \"qemu_capabilities.h\"\n#include <config.h>\n\nconst char *\nvirQEMUCapsGetPreferredMachine(virQEMUCapsPtr qemuCaps,\n                               virDomainVirtType virtType)\n{\n    virQEMUCapsAccelPtr accel = virQEMUCapsGetAccel(qemuCaps, virtType);\n\n    if (!accel->nmachineTypes)\n        return NULL;\n    return accel->machineTypes[0].name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDBusVMStateFree",
          "args": [
            "d"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDBusVMStateFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_dbus.c",
          "lines": "52-61",
          "snippet": "void\nqemuDBusVMStateFree(qemuDBusVMStatePtr self)\n{\n    if (!self)\n        return;\n\n    VIR_FREE(self->id);\n    VIR_FREE(self->addr);\n    VIR_FREE(self);\n}",
          "includes": [
            "#include \"virpidfile.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virpidfile.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_extdevice.h\"\n#include <config.h>\n\nvoid\nqemuDBusVMStateFree(qemuDBusVMStatePtr self)\n{\n    if (!self)\n        return;\n\n    VIR_FREE(self->id);\n    VIR_FREE(self->addr);\n    VIR_FREE(self);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "priv->dbusVMStates",
            "id",
            "d"
          ],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuDBusVMStateNew",
          "args": [
            "id",
            "addr"
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "qemuDBusVMStateNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_dbus.c",
          "lines": "37-49",
          "snippet": "qemuDBusVMStatePtr\nqemuDBusVMStateNew(const char *id, const char *addr)\n{\n    g_autoptr(qemuDBusVMState) self = NULL;\n\n    if (VIR_ALLOC(self) < 0)\n        return NULL;\n\n    self->id = g_strdup(id);\n    self->addr = g_strdup(addr);\n\n    return g_steal_pointer(&self);\n}",
          "includes": [
            "#include \"virpidfile.h\"",
            "#include \"virtime.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_dbus.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virpidfile.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_extdevice.h\"\n#include <config.h>\n\nqemuDBusVMStatePtr\nqemuDBusVMStateNew(const char *id, const char *addr)\n{\n    g_autoptr(qemuDBusVMState) self = NULL;\n\n    if (VIR_ALLOC(self) < 0)\n        return NULL;\n\n    self->id = g_strdup(id);\n    self->addr = g_strdup(addr);\n\n    return g_steal_pointer(&self);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virpidfile.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_extdevice.h\"\n#include <config.h>\n\nint\nqemuDBusVMStateAdd(virQEMUDriverPtr driver, virDomainObjPtr vm,\n                   const char *id, const char *addr, bool hot)\n{\n    qemuDBusVMStatePtr d = qemuDBusVMStateNew(id, addr);\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n\n    if (virHashAddEntry(priv->dbusVMStates, id, d) < 0) {\n        qemuDBusVMStateFree(d);\n        return -1;\n    }\n\n    if (hot && virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_DBUS_VMSTATE) &&\n        qemuDomainAttachDBusVMState(driver, vm, id, addr, QEMU_ASYNC_JOB_NONE) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuDBusVMStateFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_dbus.c",
    "lines": "52-61",
    "snippet": "void\nqemuDBusVMStateFree(qemuDBusVMStatePtr self)\n{\n    if (!self)\n        return;\n\n    VIR_FREE(self->id);\n    VIR_FREE(self->addr);\n    VIR_FREE(self);\n}",
    "includes": [
      "#include \"virpidfile.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_hotplug.h\"",
      "#include \"qemu_dbus.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "self"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "self->addr"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "self->id"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virpidfile.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_extdevice.h\"\n#include <config.h>\n\nvoid\nqemuDBusVMStateFree(qemuDBusVMStatePtr self)\n{\n    if (!self)\n        return;\n\n    VIR_FREE(self->id);\n    VIR_FREE(self->addr);\n    VIR_FREE(self);\n}"
  },
  {
    "function_name": "qemuDBusVMStateNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_dbus.c",
    "lines": "37-49",
    "snippet": "qemuDBusVMStatePtr\nqemuDBusVMStateNew(const char *id, const char *addr)\n{\n    g_autoptr(qemuDBusVMState) self = NULL;\n\n    if (VIR_ALLOC(self) < 0)\n        return NULL;\n\n    self->id = g_strdup(id);\n    self->addr = g_strdup(addr);\n\n    return g_steal_pointer(&self);\n}",
    "includes": [
      "#include \"virpidfile.h\"",
      "#include \"virtime.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_security.h\"",
      "#include \"qemu_hotplug.h\"",
      "#include \"qemu_dbus.h\"",
      "#include \"qemu_extdevice.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&self"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "addr"
          ],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "self"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virpidfile.h\"\n#include \"virtime.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_dbus.h\"\n#include \"qemu_extdevice.h\"\n#include <config.h>\n\nqemuDBusVMStatePtr\nqemuDBusVMStateNew(const char *id, const char *addr)\n{\n    g_autoptr(qemuDBusVMState) self = NULL;\n\n    if (VIR_ALLOC(self) < 0)\n        return NULL;\n\n    self->id = g_strdup(id);\n    self->addr = g_strdup(addr);\n\n    return g_steal_pointer(&self);\n}"
  }
]