[
  {
    "function_name": "cpuMapLoad",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_map.c",
    "lines": "174-236",
    "snippet": "int cpuMapLoad(const char *arch,\n               cpuMapLoadCallback vendorCB,\n               cpuMapLoadCallback featureCB,\n               cpuMapLoadCallback modelCB,\n               void *data)\n{\n    xmlDocPtr xml = NULL;\n    xmlXPathContextPtr ctxt = NULL;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    char *xpath = NULL;\n    int ret = -1;\n    char *mapfile;\n\n    if (!(mapfile = virFileFindResource(\"index.xml\",\n                                        abs_top_srcdir \"/src/cpu_map\",\n                                        PKGDATADIR \"/cpu_map\")))\n        return -1;\n\n    VIR_DEBUG(\"Loading '%s' CPU map from %s\", NULLSTR(arch), mapfile);\n\n    if (arch == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"undefined hardware architecture\"));\n        goto cleanup;\n    }\n\n    if (!(xml = virXMLParseFileCtxt(mapfile, &ctxt)))\n        goto cleanup;\n\n    virBufferAsprintf(&buf, \"./arch[@name='%s']\", arch);\n\n    xpath = virBufferContentAndReset(&buf);\n\n    ctxt->node = xmlDocGetRootElement(xml);\n\n    if ((ctxt->node = virXPathNode(xpath, ctxt)) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"cannot find CPU map for %s architecture\"), arch);\n        goto cleanup;\n    }\n\n    if (loadData(mapfile, ctxt, \"vendor\", vendorCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"feature\", featureCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"model\", modelCB, data) < 0)\n        goto cleanup;\n\n    if (loadIncludes(ctxt, vendorCB, featureCB, modelCB, data) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    xmlXPathFreeContext(ctxt);\n    xmlFreeDoc(xml);\n    VIR_FREE(xpath);\n    VIR_FREE(mapfile);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"cpu_map.h\"",
      "#include \"cpu.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "mapfile"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "xpath"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmlFreeDoc",
          "args": [
            "xml"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmlXPathFreeContext",
          "args": [
            "ctxt"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "loadIncludes",
          "args": [
            "ctxt",
            "vendorCB",
            "featureCB",
            "modelCB",
            "data"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "loadIncludes",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_map.c",
          "lines": "130-171",
          "snippet": "static int\nloadIncludes(xmlXPathContextPtr ctxt,\n             cpuMapLoadCallback vendorCB,\n             cpuMapLoadCallback featureCB,\n             cpuMapLoadCallback modelCB,\n             void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n\n    ctxt_node = ctxt->node;\n\n    n = virXPathNodeSet(\"include\", ctxt, &nodes);\n    if (n < 0)\n        goto cleanup;\n\n    for (i = 0; i < n; i++) {\n        char *filename = virXMLPropString(nodes[i], \"filename\");\n        if (!filename) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing 'filename' in CPU map include\"));\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Finding CPU map include '%s'\", filename);\n        if (cpuMapLoadInclude(filename, vendorCB, featureCB, modelCB, data) < 0) {\n            VIR_FREE(filename);\n            goto cleanup;\n        }\n        VIR_FREE(filename);\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"cpu_map.h\"",
            "#include \"cpu.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nloadIncludes(xmlXPathContextPtr ctxt,\n             cpuMapLoadCallback vendorCB,\n             cpuMapLoadCallback featureCB,\n             cpuMapLoadCallback modelCB,\n             void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n\n    ctxt_node = ctxt->node;\n\n    n = virXPathNodeSet(\"include\", ctxt, &nodes);\n    if (n < 0)\n        goto cleanup;\n\n    for (i = 0; i < n; i++) {\n        char *filename = virXMLPropString(nodes[i], \"filename\");\n        if (!filename) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing 'filename' in CPU map include\"));\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Finding CPU map include '%s'\", filename);\n        if (cpuMapLoadInclude(filename, vendorCB, featureCB, modelCB, data) < 0) {\n            VIR_FREE(filename);\n            goto cleanup;\n        }\n        VIR_FREE(filename);\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "loadData",
          "args": [
            "mapfile",
            "ctxt",
            "\"model\"",
            "modelCB",
            "data"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "loadData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_map.c",
          "lines": "35-84",
          "snippet": "static int\nloadData(const char *mapfile,\n         xmlXPathContextPtr ctxt,\n         const char *element,\n         cpuMapLoadCallback callback,\n         void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n    int rv;\n\n    ctxt_node = ctxt->node;\n\n    if ((n = virXPathNodeSet(element, ctxt, &nodes)) < 0)\n        goto cleanup;\n\n    if (n > 0 && !callback) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected element '%s' in CPU map '%s'\"), element, mapfile);\n        goto cleanup;\n    }\n\n    for (i = 0; i < n; i++) {\n        xmlNodePtr old = ctxt->node;\n        char *name = virXMLPropString(nodes[i], \"name\");\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot find %s name in CPU map '%s'\"), element, mapfile);\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Load %s name %s\", element, name);\n        ctxt->node = nodes[i];\n        rv = callback(ctxt, name, data);\n        ctxt->node = old;\n        VIR_FREE(name);\n        if (rv < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"cpu_map.h\"",
            "#include \"cpu.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nloadData(const char *mapfile,\n         xmlXPathContextPtr ctxt,\n         const char *element,\n         cpuMapLoadCallback callback,\n         void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n    int rv;\n\n    ctxt_node = ctxt->node;\n\n    if ((n = virXPathNodeSet(element, ctxt, &nodes)) < 0)\n        goto cleanup;\n\n    if (n > 0 && !callback) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected element '%s' in CPU map '%s'\"), element, mapfile);\n        goto cleanup;\n    }\n\n    for (i = 0; i < n; i++) {\n        xmlNodePtr old = ctxt->node;\n        char *name = virXMLPropString(nodes[i], \"name\");\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot find %s name in CPU map '%s'\"), element, mapfile);\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Load %s name %s\", element, name);\n        ctxt->node = nodes[i];\n        rv = callback(ctxt, name, data);\n        ctxt->node = old;\n        VIR_FREE(name);\n        if (rv < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"cannot find CPU map for %s architecture\")",
            "arch"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot find CPU map for %s architecture\""
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virXPathNode",
          "args": [
            "xpath",
            "ctxt"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "virXPathNode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "608-634",
          "snippet": "xmlNodePtr\nvirXPathNode(const char *xpath,\n             xmlXPathContextPtr ctxt)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    xmlNodePtr ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNode()\"));\n        return NULL;\n    }\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if ((obj == NULL) || (obj->type != XPATH_NODESET) ||\n        (obj->nodesetval == NULL) || (obj->nodesetval->nodeNr <= 0) ||\n        (obj->nodesetval->nodeTab == NULL)) {\n        xmlXPathFreeObject(obj);\n        return NULL;\n    }\n\n    ret = obj->nodesetval->nodeTab[0];\n    xmlXPathFreeObject(obj);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nxmlNodePtr\nvirXPathNode(const char *xpath,\n             xmlXPathContextPtr ctxt)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    xmlNodePtr ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNode()\"));\n        return NULL;\n    }\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if ((obj == NULL) || (obj->type != XPATH_NODESET) ||\n        (obj->nodesetval == NULL) || (obj->nodesetval->nodeNr <= 0) ||\n        (obj->nodesetval->nodeTab == NULL)) {\n        xmlXPathFreeObject(obj);\n        return NULL;\n    }\n\n    ret = obj->nodesetval->nodeTab[0];\n    xmlXPathFreeObject(obj);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xmlDocGetRootElement",
          "args": [
            "xml"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferContentAndReset",
          "args": [
            "&buf"
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferContentAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "247-260",
          "snippet": "char *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAsprintf",
          "args": [
            "&buf",
            "\"./arch[@name='%s']\"",
            "arch"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAsprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "302-309",
          "snippet": "void\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virXMLParseFileCtxt",
          "args": [
            "mapfile",
            "&ctxt"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"undefined hardware architecture\")"
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Loading '%s' CPU map from %s\"",
            "NULLSTR(arch)",
            "mapfile"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "arch"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileFindResource",
          "args": [
            "\"index.xml\"",
            "abs_top_srcdir \"/src/cpu_map\"",
            "PKGDATADIR \"/cpu_map\""
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFindResource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1771-1777",
          "snippet": "char *\nvirFileFindResource(const char *filename,\n                    const char *builddir,\n                    const char *installdir)\n{\n    return virFileFindResourceFull(filename, NULL, NULL, builddir, installdir, NULL);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirFileFindResource(const char *filename,\n                    const char *builddir,\n                    const char *installdir)\n{\n    return virFileFindResourceFull(filename, NULL, NULL, builddir, installdir, NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nint cpuMapLoad(const char *arch,\n               cpuMapLoadCallback vendorCB,\n               cpuMapLoadCallback featureCB,\n               cpuMapLoadCallback modelCB,\n               void *data)\n{\n    xmlDocPtr xml = NULL;\n    xmlXPathContextPtr ctxt = NULL;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    char *xpath = NULL;\n    int ret = -1;\n    char *mapfile;\n\n    if (!(mapfile = virFileFindResource(\"index.xml\",\n                                        abs_top_srcdir \"/src/cpu_map\",\n                                        PKGDATADIR \"/cpu_map\")))\n        return -1;\n\n    VIR_DEBUG(\"Loading '%s' CPU map from %s\", NULLSTR(arch), mapfile);\n\n    if (arch == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"undefined hardware architecture\"));\n        goto cleanup;\n    }\n\n    if (!(xml = virXMLParseFileCtxt(mapfile, &ctxt)))\n        goto cleanup;\n\n    virBufferAsprintf(&buf, \"./arch[@name='%s']\", arch);\n\n    xpath = virBufferContentAndReset(&buf);\n\n    ctxt->node = xmlDocGetRootElement(xml);\n\n    if ((ctxt->node = virXPathNode(xpath, ctxt)) == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"cannot find CPU map for %s architecture\"), arch);\n        goto cleanup;\n    }\n\n    if (loadData(mapfile, ctxt, \"vendor\", vendorCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"feature\", featureCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"model\", modelCB, data) < 0)\n        goto cleanup;\n\n    if (loadIncludes(ctxt, vendorCB, featureCB, modelCB, data) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    xmlXPathFreeContext(ctxt);\n    xmlFreeDoc(xml);\n    VIR_FREE(xpath);\n    VIR_FREE(mapfile);\n\n    return ret;\n}"
  },
  {
    "function_name": "loadIncludes",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_map.c",
    "lines": "130-171",
    "snippet": "static int\nloadIncludes(xmlXPathContextPtr ctxt,\n             cpuMapLoadCallback vendorCB,\n             cpuMapLoadCallback featureCB,\n             cpuMapLoadCallback modelCB,\n             void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n\n    ctxt_node = ctxt->node;\n\n    n = virXPathNodeSet(\"include\", ctxt, &nodes);\n    if (n < 0)\n        goto cleanup;\n\n    for (i = 0; i < n; i++) {\n        char *filename = virXMLPropString(nodes[i], \"filename\");\n        if (!filename) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing 'filename' in CPU map include\"));\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Finding CPU map include '%s'\", filename);\n        if (cpuMapLoadInclude(filename, vendorCB, featureCB, modelCB, data) < 0) {\n            VIR_FREE(filename);\n            goto cleanup;\n        }\n        VIR_FREE(filename);\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"cpu_map.h\"",
      "#include \"cpu.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "nodes"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "filename"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "filename"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cpuMapLoadInclude",
          "args": [
            "filename",
            "vendorCB",
            "featureCB",
            "modelCB",
            "data"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "cpuMapLoadInclude",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_map.c",
          "lines": "86-127",
          "snippet": "static int\ncpuMapLoadInclude(const char *filename,\n                  cpuMapLoadCallback vendorCB,\n                  cpuMapLoadCallback featureCB,\n                  cpuMapLoadCallback modelCB,\n                  void *data)\n{\n    xmlDocPtr xml = NULL;\n    xmlXPathContextPtr ctxt = NULL;\n    int ret = -1;\n    char *mapfile;\n\n    if (!(mapfile = virFileFindResource(filename,\n                                        abs_top_srcdir \"/src/cpu_map\",\n                                        PKGDATADIR \"/cpu_map\")))\n        return -1;\n\n    VIR_DEBUG(\"Loading CPU map include from %s\", mapfile);\n\n    if (!(xml = virXMLParseFileCtxt(mapfile, &ctxt)))\n        goto cleanup;\n\n    ctxt->node = xmlDocGetRootElement(xml);\n\n    if (loadData(mapfile, ctxt, \"vendor\", vendorCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"feature\", featureCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"model\", modelCB, data) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    xmlXPathFreeContext(ctxt);\n    xmlFreeDoc(xml);\n    VIR_FREE(mapfile);\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"cpu_map.h\"",
            "#include \"cpu.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\ncpuMapLoadInclude(const char *filename,\n                  cpuMapLoadCallback vendorCB,\n                  cpuMapLoadCallback featureCB,\n                  cpuMapLoadCallback modelCB,\n                  void *data)\n{\n    xmlDocPtr xml = NULL;\n    xmlXPathContextPtr ctxt = NULL;\n    int ret = -1;\n    char *mapfile;\n\n    if (!(mapfile = virFileFindResource(filename,\n                                        abs_top_srcdir \"/src/cpu_map\",\n                                        PKGDATADIR \"/cpu_map\")))\n        return -1;\n\n    VIR_DEBUG(\"Loading CPU map include from %s\", mapfile);\n\n    if (!(xml = virXMLParseFileCtxt(mapfile, &ctxt)))\n        goto cleanup;\n\n    ctxt->node = xmlDocGetRootElement(xml);\n\n    if (loadData(mapfile, ctxt, \"vendor\", vendorCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"feature\", featureCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"model\", modelCB, data) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    xmlXPathFreeContext(ctxt);\n    xmlFreeDoc(xml);\n    VIR_FREE(mapfile);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Finding CPU map include '%s'\"",
            "filename"
          ],
          "line": 156
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing 'filename' in CPU map include\")"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Missing 'filename' in CPU map include\""
          ],
          "line": 153
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virXMLPropString",
          "args": [
            "nodes[i]",
            "\"filename\""
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "virXMLPropString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "515-520",
          "snippet": "char *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virXPathNodeSet",
          "args": [
            "\"include\"",
            "ctxt",
            "&nodes"
          ],
          "line": 145
        },
        "resolved": true,
        "details": {
          "function_name": "virXPathNodeSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "647-694",
          "snippet": "int\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nloadIncludes(xmlXPathContextPtr ctxt,\n             cpuMapLoadCallback vendorCB,\n             cpuMapLoadCallback featureCB,\n             cpuMapLoadCallback modelCB,\n             void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n\n    ctxt_node = ctxt->node;\n\n    n = virXPathNodeSet(\"include\", ctxt, &nodes);\n    if (n < 0)\n        goto cleanup;\n\n    for (i = 0; i < n; i++) {\n        char *filename = virXMLPropString(nodes[i], \"filename\");\n        if (!filename) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing 'filename' in CPU map include\"));\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Finding CPU map include '%s'\", filename);\n        if (cpuMapLoadInclude(filename, vendorCB, featureCB, modelCB, data) < 0) {\n            VIR_FREE(filename);\n            goto cleanup;\n        }\n        VIR_FREE(filename);\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}"
  },
  {
    "function_name": "cpuMapLoadInclude",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_map.c",
    "lines": "86-127",
    "snippet": "static int\ncpuMapLoadInclude(const char *filename,\n                  cpuMapLoadCallback vendorCB,\n                  cpuMapLoadCallback featureCB,\n                  cpuMapLoadCallback modelCB,\n                  void *data)\n{\n    xmlDocPtr xml = NULL;\n    xmlXPathContextPtr ctxt = NULL;\n    int ret = -1;\n    char *mapfile;\n\n    if (!(mapfile = virFileFindResource(filename,\n                                        abs_top_srcdir \"/src/cpu_map\",\n                                        PKGDATADIR \"/cpu_map\")))\n        return -1;\n\n    VIR_DEBUG(\"Loading CPU map include from %s\", mapfile);\n\n    if (!(xml = virXMLParseFileCtxt(mapfile, &ctxt)))\n        goto cleanup;\n\n    ctxt->node = xmlDocGetRootElement(xml);\n\n    if (loadData(mapfile, ctxt, \"vendor\", vendorCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"feature\", featureCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"model\", modelCB, data) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    xmlXPathFreeContext(ctxt);\n    xmlFreeDoc(xml);\n    VIR_FREE(mapfile);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"cpu_map.h\"",
      "#include \"cpu.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "mapfile"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmlFreeDoc",
          "args": [
            "xml"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "xmlXPathFreeContext",
          "args": [
            "ctxt"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "loadData",
          "args": [
            "mapfile",
            "ctxt",
            "\"model\"",
            "modelCB",
            "data"
          ],
          "line": 116
        },
        "resolved": true,
        "details": {
          "function_name": "loadData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_map.c",
          "lines": "35-84",
          "snippet": "static int\nloadData(const char *mapfile,\n         xmlXPathContextPtr ctxt,\n         const char *element,\n         cpuMapLoadCallback callback,\n         void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n    int rv;\n\n    ctxt_node = ctxt->node;\n\n    if ((n = virXPathNodeSet(element, ctxt, &nodes)) < 0)\n        goto cleanup;\n\n    if (n > 0 && !callback) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected element '%s' in CPU map '%s'\"), element, mapfile);\n        goto cleanup;\n    }\n\n    for (i = 0; i < n; i++) {\n        xmlNodePtr old = ctxt->node;\n        char *name = virXMLPropString(nodes[i], \"name\");\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot find %s name in CPU map '%s'\"), element, mapfile);\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Load %s name %s\", element, name);\n        ctxt->node = nodes[i];\n        rv = callback(ctxt, name, data);\n        ctxt->node = old;\n        VIR_FREE(name);\n        if (rv < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"cpu_map.h\"",
            "#include \"cpu.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nloadData(const char *mapfile,\n         xmlXPathContextPtr ctxt,\n         const char *element,\n         cpuMapLoadCallback callback,\n         void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n    int rv;\n\n    ctxt_node = ctxt->node;\n\n    if ((n = virXPathNodeSet(element, ctxt, &nodes)) < 0)\n        goto cleanup;\n\n    if (n > 0 && !callback) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected element '%s' in CPU map '%s'\"), element, mapfile);\n        goto cleanup;\n    }\n\n    for (i = 0; i < n; i++) {\n        xmlNodePtr old = ctxt->node;\n        char *name = virXMLPropString(nodes[i], \"name\");\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot find %s name in CPU map '%s'\"), element, mapfile);\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Load %s name %s\", element, name);\n        ctxt->node = nodes[i];\n        rv = callback(ctxt, name, data);\n        ctxt->node = old;\n        VIR_FREE(name);\n        if (rv < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "xmlDocGetRootElement",
          "args": [
            "xml"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virXMLParseFileCtxt",
          "args": [
            "mapfile",
            "&ctxt"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Loading CPU map include from %s\"",
            "mapfile"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileFindResource",
          "args": [
            "filename",
            "abs_top_srcdir \"/src/cpu_map\"",
            "PKGDATADIR \"/cpu_map\""
          ],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFindResource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1771-1777",
          "snippet": "char *\nvirFileFindResource(const char *filename,\n                    const char *builddir,\n                    const char *installdir)\n{\n    return virFileFindResourceFull(filename, NULL, NULL, builddir, installdir, NULL);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirFileFindResource(const char *filename,\n                    const char *builddir,\n                    const char *installdir)\n{\n    return virFileFindResourceFull(filename, NULL, NULL, builddir, installdir, NULL);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\ncpuMapLoadInclude(const char *filename,\n                  cpuMapLoadCallback vendorCB,\n                  cpuMapLoadCallback featureCB,\n                  cpuMapLoadCallback modelCB,\n                  void *data)\n{\n    xmlDocPtr xml = NULL;\n    xmlXPathContextPtr ctxt = NULL;\n    int ret = -1;\n    char *mapfile;\n\n    if (!(mapfile = virFileFindResource(filename,\n                                        abs_top_srcdir \"/src/cpu_map\",\n                                        PKGDATADIR \"/cpu_map\")))\n        return -1;\n\n    VIR_DEBUG(\"Loading CPU map include from %s\", mapfile);\n\n    if (!(xml = virXMLParseFileCtxt(mapfile, &ctxt)))\n        goto cleanup;\n\n    ctxt->node = xmlDocGetRootElement(xml);\n\n    if (loadData(mapfile, ctxt, \"vendor\", vendorCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"feature\", featureCB, data) < 0)\n        goto cleanup;\n\n    if (loadData(mapfile, ctxt, \"model\", modelCB, data) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    xmlXPathFreeContext(ctxt);\n    xmlFreeDoc(xml);\n    VIR_FREE(mapfile);\n\n    return ret;\n}"
  },
  {
    "function_name": "loadData",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu_map.c",
    "lines": "35-84",
    "snippet": "static int\nloadData(const char *mapfile,\n         xmlXPathContextPtr ctxt,\n         const char *element,\n         cpuMapLoadCallback callback,\n         void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n    int rv;\n\n    ctxt_node = ctxt->node;\n\n    if ((n = virXPathNodeSet(element, ctxt, &nodes)) < 0)\n        goto cleanup;\n\n    if (n > 0 && !callback) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected element '%s' in CPU map '%s'\"), element, mapfile);\n        goto cleanup;\n    }\n\n    for (i = 0; i < n; i++) {\n        xmlNodePtr old = ctxt->node;\n        char *name = virXMLPropString(nodes[i], \"name\");\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot find %s name in CPU map '%s'\"), element, mapfile);\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Load %s name %s\", element, name);\n        ctxt->node = nodes[i];\n        rv = callback(ctxt, name, data);\n        ctxt->node = old;\n        VIR_FREE(name);\n        if (rv < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}",
    "includes": [
      "#include \"virlog.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"cpu_map.h\"",
      "#include \"cpu.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "nodes"
          ],
          "line": 81
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "name"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "callback",
          "args": [
            "ctxt",
            "name",
            "data"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Load %s name %s\"",
            "element",
            "name"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"cannot find %s name in CPU map '%s'\")",
            "element",
            "mapfile"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot find %s name in CPU map '%s'\""
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virXMLPropString",
          "args": [
            "nodes[i]",
            "\"name\""
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "virXMLPropString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "515-520",
          "snippet": "char *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unexpected element '%s' in CPU map '%s'\")",
            "element",
            "mapfile"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virXPathNodeSet",
          "args": [
            "element",
            "ctxt",
            "&nodes"
          ],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "virXPathNodeSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "647-694",
          "snippet": "int\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nloadData(const char *mapfile,\n         xmlXPathContextPtr ctxt,\n         const char *element,\n         cpuMapLoadCallback callback,\n         void *data)\n{\n    int ret = -1;\n    xmlNodePtr ctxt_node;\n    xmlNodePtr *nodes = NULL;\n    int n;\n    size_t i;\n    int rv;\n\n    ctxt_node = ctxt->node;\n\n    if ((n = virXPathNodeSet(element, ctxt, &nodes)) < 0)\n        goto cleanup;\n\n    if (n > 0 && !callback) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected element '%s' in CPU map '%s'\"), element, mapfile);\n        goto cleanup;\n    }\n\n    for (i = 0; i < n; i++) {\n        xmlNodePtr old = ctxt->node;\n        char *name = virXMLPropString(nodes[i], \"name\");\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot find %s name in CPU map '%s'\"), element, mapfile);\n            goto cleanup;\n        }\n        VIR_DEBUG(\"Load %s name %s\", element, name);\n        ctxt->node = nodes[i];\n        rv = callback(ctxt, name, data);\n        ctxt->node = old;\n        VIR_FREE(name);\n        if (rv < 0)\n            goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    ctxt->node = ctxt_node;\n    VIR_FREE(nodes);\n\n    return ret;\n}"
  }
]