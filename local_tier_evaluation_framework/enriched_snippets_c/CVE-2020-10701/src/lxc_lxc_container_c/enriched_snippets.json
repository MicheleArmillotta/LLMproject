[
  {
    "function_name": "lxcContainerChown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2461-2480",
    "snippet": "int lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to change owner of %s to %u:%u\")",
            "path",
            "uid",
            "gid"
          ],
          "line": 2473
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to change owner of %s to %u:%u\""
          ],
          "line": 2474
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "chown",
          "args": [
            "path",
            "uid",
            "gid"
          ],
          "line": 2472
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerChown(virDomainDefPtr def, const char *path)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (!def->idmap.uidmap)\n        return 0;\n\n    uid = def->idmap.uidmap[0].target;\n    gid = def->idmap.gidmap[0].target;\n\n    if (chown(path, uid, gid) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to change owner of %s to %u:%u\"),\n                             path, uid, gid);\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerStart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2371-2459",
    "snippet": "int lxcContainerStart(virDomainDefPtr def,\n                      virSecurityManagerPtr securityDriver,\n                      size_t nveths,\n                      char **veths,\n                      size_t npassFDs,\n                      int *passFDs,\n                      int control,\n                      int handshakefd,\n                      int *nsInheritFDs,\n                      size_t nttyPaths,\n                      char **ttyPaths)\n{\n    pid_t pid;\n    int cflags;\n    int stacksize = getpagesize() * 4;\n    char *stack, *stacktop;\n    lxc_child_argv_t args = {\n        .config = def,\n        .securityDriver = securityDriver,\n        .nveths = nveths,\n        .veths = veths,\n        .npassFDs = npassFDs,\n        .passFDs = passFDs,\n        .monitor = control,\n        .nttyPaths = nttyPaths,\n        .ttyPaths = ttyPaths,\n        .handshakefd = handshakefd,\n        .nsInheritFDs = nsInheritFDs,\n    };\n\n    /* allocate a stack for the container */\n    if (VIR_ALLOC_N(stack, stacksize) < 0)\n        return -1;\n\n    stacktop = stack + stacksize;\n\n    cflags = CLONE_NEWPID|CLONE_NEWNS|SIGCHLD;\n\n    if (userns_required(def)) {\n        if (virProcessNamespaceAvailable(VIR_PROCESS_NAMESPACE_USER) < 0) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Kernel doesn't support user namespace\"));\n            VIR_FREE(stack);\n            return -1;\n        }\n        VIR_DEBUG(\"Enable user namespace\");\n        cflags |= CLONE_NEWUSER;\n    }\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHARENET] == -1) {\n        if (lxcNeedNetworkNamespace(def)) {\n            VIR_DEBUG(\"Enable network namespaces\");\n            cflags |= CLONE_NEWNET;\n        }\n    } else {\n        if (lxcNeedNetworkNamespace(def)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Config asks for inherit net namespace \"\n                             \"as well as private network interfaces\"));\n            VIR_FREE(stack);\n            return -1;\n        }\n        VIR_DEBUG(\"Inheriting a net namespace\");\n    }\n\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHAREIPC] == -1) {\n        cflags |= CLONE_NEWIPC;\n    } else {\n        VIR_DEBUG(\"Inheriting an IPC namespace\");\n    }\n\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHAREUTS] == -1) {\n        cflags |= CLONE_NEWUTS;\n    } else {\n        VIR_DEBUG(\"Inheriting a UTS namespace\");\n    }\n\n    VIR_DEBUG(\"Cloning container init process\");\n    pid = clone(lxcContainerChild, stacktop, cflags, &args);\n    VIR_FREE(stack);\n    VIR_DEBUG(\"clone() completed, new container PID is %d\", pid);\n\n    if (pid < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to run clone container\"));\n        return -1;\n    }\n\n    return pid;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Failed to run clone container\")"
          ],
          "line": 2453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to run clone container\""
          ],
          "line": 2454
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"clone() completed, new container PID is %d\"",
            "pid"
          ],
          "line": 2450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "stack"
          ],
          "line": 2449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clone",
          "args": [
            "lxcContainerChild",
            "stacktop",
            "cflags",
            "&args"
          ],
          "line": 2448
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Cloning container init process\""
          ],
          "line": 2447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Inheriting a UTS namespace\""
          ],
          "line": 2444
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Inheriting an IPC namespace\""
          ],
          "line": 2438
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Inheriting a net namespace\""
          ],
          "line": 2432
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "stack"
          ],
          "line": 2429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Config asks for inherit net namespace \"\n                             \"as well as private network interfaces\")"
          ],
          "line": 2426
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcNeedNetworkNamespace",
          "args": [
            "def"
          ],
          "line": 2425
        },
        "resolved": true,
        "details": {
          "function_name": "lxcNeedNetworkNamespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1678-1692",
          "snippet": "static bool\nlxcNeedNetworkNamespace(virDomainDefPtr def)\n{\n    size_t i;\n    if (def->nets != NULL)\n        return true;\n    if (def->features[VIR_DOMAIN_FEATURE_PRIVNET] == VIR_TRISTATE_SWITCH_ON)\n        return true;\n    for (i = 0; i < def->nhostdevs; i++) {\n        if (def->hostdevs[i]->mode == VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES &&\n            def->hostdevs[i]->source.caps.type == VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            return true;\n    }\n    return false;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic bool\nlxcNeedNetworkNamespace(virDomainDefPtr def)\n{\n    size_t i;\n    if (def->nets != NULL)\n        return true;\n    if (def->features[VIR_DOMAIN_FEATURE_PRIVNET] == VIR_TRISTATE_SWITCH_ON)\n        return true;\n    for (i = 0; i < def->nhostdevs; i++) {\n        if (def->hostdevs[i]->mode == VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES &&\n            def->hostdevs[i]->source.caps.type == VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            return true;\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Enable network namespaces\""
          ],
          "line": 2421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Enable user namespace\""
          ],
          "line": 2416
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "stack"
          ],
          "line": 2413
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Kernel doesn't support user namespace\")"
          ],
          "line": 2411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virProcessNamespaceAvailable",
          "args": [
            "VIR_PROCESS_NAMESPACE_USER"
          ],
          "line": 2410
        },
        "resolved": true,
        "details": {
          "function_name": "virProcessNamespaceAvailable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virprocess.c",
          "lines": "1370-1376",
          "snippet": "int\nvirProcessNamespaceAvailable(unsigned int ns G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Namespaces are not supported on this platform.\"));\n    return -1;\n}",
          "includes": [
            "#   include <sys/syscall.h>",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "# include <windows.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/user.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/param.h>",
            "# include <sched.h>",
            "# include <sys/resource.h>",
            "# include <sys/time.h>",
            "# include <sys/mount.h>",
            "#include <unistd.h>",
            "# include <sys/wait.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/syscall.h>\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n# include <windows.h>\n# include <sys/cpuset.h>\n# include <sys/user.h>\n# include <sys/sysctl.h>\n# include <sys/param.h>\n# include <sched.h>\n# include <sys/resource.h>\n# include <sys/time.h>\n# include <sys/mount.h>\n#include <unistd.h>\n# include <sys/wait.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirProcessNamespaceAvailable(unsigned int ns G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Namespaces are not supported on this platform.\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "stack",
            "stacksize"
          ],
          "line": 2402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpagesize",
          "args": [],
          "line": 2385
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerStart(virDomainDefPtr def,\n                      virSecurityManagerPtr securityDriver,\n                      size_t nveths,\n                      char **veths,\n                      size_t npassFDs,\n                      int *passFDs,\n                      int control,\n                      int handshakefd,\n                      int *nsInheritFDs,\n                      size_t nttyPaths,\n                      char **ttyPaths)\n{\n    pid_t pid;\n    int cflags;\n    int stacksize = getpagesize() * 4;\n    char *stack, *stacktop;\n    lxc_child_argv_t args = {\n        .config = def,\n        .securityDriver = securityDriver,\n        .nveths = nveths,\n        .veths = veths,\n        .npassFDs = npassFDs,\n        .passFDs = passFDs,\n        .monitor = control,\n        .nttyPaths = nttyPaths,\n        .ttyPaths = ttyPaths,\n        .handshakefd = handshakefd,\n        .nsInheritFDs = nsInheritFDs,\n    };\n\n    /* allocate a stack for the container */\n    if (VIR_ALLOC_N(stack, stacksize) < 0)\n        return -1;\n\n    stacktop = stack + stacksize;\n\n    cflags = CLONE_NEWPID|CLONE_NEWNS|SIGCHLD;\n\n    if (userns_required(def)) {\n        if (virProcessNamespaceAvailable(VIR_PROCESS_NAMESPACE_USER) < 0) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Kernel doesn't support user namespace\"));\n            VIR_FREE(stack);\n            return -1;\n        }\n        VIR_DEBUG(\"Enable user namespace\");\n        cflags |= CLONE_NEWUSER;\n    }\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHARENET] == -1) {\n        if (lxcNeedNetworkNamespace(def)) {\n            VIR_DEBUG(\"Enable network namespaces\");\n            cflags |= CLONE_NEWNET;\n        }\n    } else {\n        if (lxcNeedNetworkNamespace(def)) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"Config asks for inherit net namespace \"\n                             \"as well as private network interfaces\"));\n            VIR_FREE(stack);\n            return -1;\n        }\n        VIR_DEBUG(\"Inheriting a net namespace\");\n    }\n\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHAREIPC] == -1) {\n        cflags |= CLONE_NEWIPC;\n    } else {\n        VIR_DEBUG(\"Inheriting an IPC namespace\");\n    }\n\n    if (!nsInheritFDs || nsInheritFDs[VIR_LXC_DOMAIN_NAMESPACE_SHAREUTS] == -1) {\n        cflags |= CLONE_NEWUTS;\n    } else {\n        VIR_DEBUG(\"Inheriting a UTS namespace\");\n    }\n\n    VIR_DEBUG(\"Cloning container init process\");\n    pid = clone(lxcContainerChild, stacktop, cflags, &args);\n    VIR_FREE(stack);\n    VIR_DEBUG(\"clone() completed, new container PID is %d\", pid);\n\n    if (pid < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to run clone container\"));\n        return -1;\n    }\n\n    return pid;\n}"
  },
  {
    "function_name": "lxcContainerGetAlt32bitArch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2334-2356",
    "snippet": "virArch lxcContainerGetAlt32bitArch(virArch arch)\n{\n    /* Any Linux 64bit arch which has a 32bit\n     * personality available should be listed here */\n    if (arch == VIR_ARCH_X86_64)\n        return VIR_ARCH_I686;\n    if (arch == VIR_ARCH_S390X)\n        return VIR_ARCH_S390;\n    if (arch == VIR_ARCH_PPC64)\n        return VIR_ARCH_PPC;\n    if (arch == VIR_ARCH_PARISC64)\n        return VIR_ARCH_PARISC;\n    if (arch == VIR_ARCH_SPARC64)\n        return VIR_ARCH_SPARC;\n    if (arch == VIR_ARCH_MIPS64)\n        return VIR_ARCH_MIPS;\n    if (arch == VIR_ARCH_MIPS64EL)\n        return VIR_ARCH_MIPSEL;\n    if (arch == VIR_ARCH_AARCH64)\n        return VIR_ARCH_ARMV7L;\n\n    return VIR_ARCH_NONE;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirArch lxcContainerGetAlt32bitArch(virArch arch)\n{\n    /* Any Linux 64bit arch which has a 32bit\n     * personality available should be listed here */\n    if (arch == VIR_ARCH_X86_64)\n        return VIR_ARCH_I686;\n    if (arch == VIR_ARCH_S390X)\n        return VIR_ARCH_S390;\n    if (arch == VIR_ARCH_PPC64)\n        return VIR_ARCH_PPC;\n    if (arch == VIR_ARCH_PARISC64)\n        return VIR_ARCH_PARISC;\n    if (arch == VIR_ARCH_SPARC64)\n        return VIR_ARCH_SPARC;\n    if (arch == VIR_ARCH_MIPS64)\n        return VIR_ARCH_MIPS;\n    if (arch == VIR_ARCH_MIPS64EL)\n        return VIR_ARCH_MIPSEL;\n    if (arch == VIR_ARCH_AARCH64)\n        return VIR_ARCH_ARMV7L;\n\n    return VIR_ARCH_NONE;\n}"
  },
  {
    "function_name": "userns_required",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2329-2332",
    "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
  },
  {
    "function_name": "lxcContainerChild",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2167-2327",
    "snippet": "static int lxcContainerChild(void *data)\n{\n    lxc_child_argv_t *argv = data;\n    virDomainDefPtr vmDef = argv->config;\n    int ttyfd = -1;\n    int ret = -1;\n    char *ttyPath = NULL;\n    virDomainFSDefPtr root;\n    virCommandPtr cmd = NULL;\n    int hasReboot;\n    gid_t *groups = NULL;\n    int ngroups;\n\n    if (NULL == vmDef) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"lxcChild() passed invalid vm definition\"));\n        goto cleanup;\n    }\n\n    if (lxcAttachNS(argv->nsInheritFDs) < 0) {\n        virReportError(VIR_ERR_SYSTEM_ERROR, \"%s\",\n                       _(\"failed to attach the namespace\"));\n        return -1;\n    }\n\n    /* Wait for controller to finish setup tasks, including\n     * things like move of network interfaces, uid/gid mapping\n     */\n    if (lxcContainerWaitForContinue(argv->monitor) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to read the container continue message\"));\n        goto cleanup;\n    }\n    VIR_DEBUG(\"Received container continue message\");\n\n    if ((hasReboot = lxcContainerHasReboot()) < 0)\n        goto cleanup;\n\n    cmd = lxcContainerBuildInitCmd(vmDef,\n                                   argv->ttyPaths,\n                                   argv->nttyPaths);\n    virCommandWriteArgLog(cmd, 1);\n\n    if (lxcContainerSetID(vmDef) < 0)\n        goto cleanup;\n\n    root = virDomainGetFilesystemForTarget(vmDef, \"/\");\n\n    if (argv->nttyPaths) {\n        const char *tty = argv->ttyPaths[0];\n        if (STRPREFIX(tty, \"/dev/pts/\"))\n            tty += strlen(\"/dev/pts/\");\n        ttyPath = g_strdup_printf(\"%s/%s.devpts/%s\", LXC_STATE_DIR, vmDef->name,\n                                  tty);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"At least one tty is required\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Container TTY path: %s\", ttyPath);\n\n    ttyfd = open(ttyPath, O_RDWR);\n    if (ttyfd < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to open tty %s\"),\n                             ttyPath);\n        goto cleanup;\n    }\n\n    if (lxcContainerResolveAllSymlinks(vmDef) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Setting up pivot\");\n    if (lxcContainerSetupPivotRoot(vmDef, root,\n                                   argv->ttyPaths, argv->nttyPaths,\n                                   argv->securityDriver) < 0)\n        goto cleanup;\n\n    if (!virFileExists(vmDef->os.init)) {\n        virReportSystemError(errno,\n                             _(\"cannot find init path '%s' relative to container root\"),\n                             vmDef->os.init);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetUserGroup(cmd, vmDef, argv->ttyPaths[0]) < 0)\n        goto cleanup;\n\n    /* rename and enable interfaces */\n    if (lxcContainerRenameAndEnableInterfaces(vmDef,\n                                              argv->nveths,\n                                              argv->veths) < 0) {\n        goto cleanup;\n    }\n\n    if (lxcContainerSetHostname(vmDef) < 0)\n        goto cleanup;\n\n\n    /* drop a set of root capabilities */\n    if (lxcContainerDropCapabilities(vmDef, !!hasReboot) < 0)\n        goto cleanup;\n\n    if (lxcContainerSendContinue(argv->handshakefd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to send continue signal to controller\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Setting up security labeling\");\n    if (virSecurityManagerSetProcessLabel(argv->securityDriver, vmDef) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Setting up inherited FDs\");\n    VIR_FORCE_CLOSE(argv->handshakefd);\n    VIR_FORCE_CLOSE(argv->monitor);\n    if (lxcContainerSetupFDs(&ttyfd,\n                             argv->npassFDs, argv->passFDs) < 0)\n        goto cleanup;\n\n    /* Make init process of the container the leader of the new session.\n     * That is needed when checkpointing container.\n     */\n    if (setsid() < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to become session leader\"));\n        goto cleanup;\n    }\n\n    /* TODO is it safe to call it here or should this call be moved in\n     * front of the clone() as otherwise there might be a risk for a\n     * deadlock */\n    if ((ngroups = virGetGroupList(virCommandGetUID(cmd), virCommandGetGID(cmd),\n                                   &groups)) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(ttyPath);\n    VIR_FORCE_CLOSE(ttyfd);\n    VIR_FORCE_CLOSE(argv->monitor);\n    VIR_FORCE_CLOSE(argv->handshakefd);\n\n    if (ret == 0) {\n        VIR_DEBUG(\"Executing init binary\");\n        /* this function will only return if an error occurred */\n        ret = virCommandExec(cmd, groups, ngroups);\n    }\n\n    if (ret != 0) {\n        VIR_DEBUG(\"Tearing down container\");\n        fprintf(stderr,\n                _(\"Failure in libvirt_lxc startup: %s\\n\"),\n                virGetLastErrorMessage());\n    }\n\n    VIR_FREE(groups);\n    virCommandFree(cmd);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "cmd"
          ],
          "line": 2325
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "groups"
          ],
          "line": 2324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"Failure in libvirt_lxc startup: %s\\n\")",
            "virGetLastErrorMessage()"
          ],
          "line": 2319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetLastErrorMessage",
          "args": [],
          "line": 2321
        },
        "resolved": true,
        "details": {
          "function_name": "virGetLastErrorMessage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "316-325",
          "snippet": "const char *\nvirGetLastErrorMessage(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err && err->code == VIR_ERR_OK)\n        return _(\"no error\");\n    if (!err || !err->message)\n        return _(\"unknown error\");\n    return err->message;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nconst char *\nvirGetLastErrorMessage(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err && err->code == VIR_ERR_OK)\n        return _(\"no error\");\n    if (!err || !err->message)\n        return _(\"unknown error\");\n    return err->message;\n}"
        }
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failure in libvirt_lxc startup: %s\\n\""
          ],
          "line": 2320
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Tearing down container\""
          ],
          "line": 2318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandExec",
          "args": [
            "cmd",
            "groups",
            "ngroups"
          ],
          "line": 2314
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandExec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2912-2919",
          "snippet": "int\nvirCommandExec(virCommandPtr cmd G_GNUC_UNUSED, gid_t *groups G_GNUC_UNUSED,\n               int ngroups G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandExec(virCommandPtr cmd G_GNUC_UNUSED, gid_t *groups G_GNUC_UNUSED,\n               int ngroups G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Executing init binary\""
          ],
          "line": 2312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "argv->handshakefd"
          ],
          "line": 2309
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "argv->monitor"
          ],
          "line": 2308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "ttyfd"
          ],
          "line": 2307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ttyPath"
          ],
          "line": 2306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetGroupList",
          "args": [
            "virCommandGetUID(cmd)",
            "virCommandGetGID(cmd)",
            "&groups"
          ],
          "line": 2300
        },
        "resolved": true,
        "details": {
          "function_name": "virGetGroupList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1059-1065",
          "snippet": "int\nvirGetGroupList(uid_t uid G_GNUC_UNUSED, gid_t gid G_GNUC_UNUSED,\n                gid_t **list)\n{\n    *list = NULL;\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirGetGroupList(uid_t uid G_GNUC_UNUSED, gid_t gid G_GNUC_UNUSED,\n                gid_t **list)\n{\n    *list = NULL;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandGetGID",
          "args": [
            "cmd"
          ],
          "line": 2300
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandGetGID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1097-1101",
          "snippet": "gid_t\nvirCommandGetGID(virCommandPtr cmd)\n{\n    return cmd->gid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\ngid_t\nvirCommandGetGID(virCommandPtr cmd)\n{\n    return cmd->gid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandGetUID",
          "args": [
            "cmd"
          ],
          "line": 2300
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandGetUID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1104-1108",
          "snippet": "uid_t\nvirCommandGetUID(virCommandPtr cmd)\n{\n    return cmd->uid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nuid_t\nvirCommandGetUID(virCommandPtr cmd)\n{\n    return cmd->uid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to become session leader\")"
          ],
          "line": 2292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setsid",
          "args": [],
          "line": 2291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerSetupFDs",
          "args": [
            "&ttyfd",
            "argv->npassFDs",
            "argv->passFDs"
          ],
          "line": 2284
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetupFDs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "264-370",
          "snippet": "static int lxcContainerSetupFDs(int *ttyfd,\n                                size_t npassFDs, int *passFDs)\n{\n    int rc = -1;\n    int open_max;\n    int fd;\n    int last_fd;\n    size_t i;\n    size_t j;\n\n    VIR_DEBUG(\"Logging from the container init will now cease \"\n              \"as the FDs are about to be closed for exec of \"\n              \"the container init process\");\n\n    if (dup2(*ttyfd, STDIN_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stdin) failed\"));\n        goto cleanup;\n    }\n\n    if (dup2(*ttyfd, STDOUT_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stdout) failed\"));\n        goto cleanup;\n    }\n\n    if (dup2(*ttyfd, STDERR_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stderr) failed\"));\n        goto cleanup;\n    }\n\n    VIR_FORCE_CLOSE(*ttyfd);\n\n    /* Any FDs in @passFDs need to be moved around so that\n     * they are numbered, without gaps, starting from\n     * STDERR_FILENO + 1\n     */\n    for (i = 0; i < npassFDs; i++) {\n        int wantfd;\n\n        wantfd = STDERR_FILENO + i + 1;\n        VIR_DEBUG(\"Pass %d onto %d\", passFDs[i], wantfd);\n\n        /* If we already have desired FD number, life\n         * is easy. Nothing needs renumbering */\n        if (passFDs[i] == wantfd)\n            continue;\n\n        /*\n         * Lets check to see if any later FDs are occupying\n         * our desired FD number. If so, we must move them\n         * out of the way\n         */\n        for (j = i + 1; j < npassFDs; j++) {\n            if (passFDs[j] == wantfd) {\n                VIR_DEBUG(\"Clash %zu\", j);\n                int newfd = dup(passFDs[j]);\n                if (newfd < 0) {\n                    virReportSystemError(errno,\n                                         _(\"Cannot move fd %d out of the way\"),\n                                         passFDs[j]);\n                    goto cleanup;\n                }\n                /* We're intentionally not closing the\n                 * old value of passFDs[j], because we\n                 * don't want later iterations of the\n                 * loop to take it back. dup2() will\n                 * cause it to be closed shortly anyway\n                 */\n                VIR_DEBUG(\"Moved clash onto %d\", newfd);\n                passFDs[j] = newfd;\n            }\n        }\n\n        /* Finally we can move into our desired FD number */\n        if (dup2(passFDs[i], wantfd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Cannot duplicate fd %d onto fd %d\"),\n                                 passFDs[i], wantfd);\n            goto cleanup;\n        }\n        VIR_FORCE_CLOSE(passFDs[i]);\n    }\n\n    last_fd = STDERR_FILENO + npassFDs;\n\n    /* Just in case someone forget to set FD_CLOEXEC, explicitly\n     * close all remaining FDs before executing the container */\n    open_max = sysconf(_SC_OPEN_MAX);\n    if (open_max < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"sysconf(_SC_OPEN_MAX) failed\"));\n        goto cleanup;\n    }\n\n    for (fd = last_fd + 1; fd < open_max; fd++) {\n        int tmpfd = fd;\n        VIR_MASS_CLOSE(tmpfd);\n    }\n\n    rc = 0;\n\n cleanup:\n    VIR_DEBUG(\"rc=%d\", rc);\n    return rc;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetupFDs(int *ttyfd,\n                                size_t npassFDs, int *passFDs)\n{\n    int rc = -1;\n    int open_max;\n    int fd;\n    int last_fd;\n    size_t i;\n    size_t j;\n\n    VIR_DEBUG(\"Logging from the container init will now cease \"\n              \"as the FDs are about to be closed for exec of \"\n              \"the container init process\");\n\n    if (dup2(*ttyfd, STDIN_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stdin) failed\"));\n        goto cleanup;\n    }\n\n    if (dup2(*ttyfd, STDOUT_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stdout) failed\"));\n        goto cleanup;\n    }\n\n    if (dup2(*ttyfd, STDERR_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stderr) failed\"));\n        goto cleanup;\n    }\n\n    VIR_FORCE_CLOSE(*ttyfd);\n\n    /* Any FDs in @passFDs need to be moved around so that\n     * they are numbered, without gaps, starting from\n     * STDERR_FILENO + 1\n     */\n    for (i = 0; i < npassFDs; i++) {\n        int wantfd;\n\n        wantfd = STDERR_FILENO + i + 1;\n        VIR_DEBUG(\"Pass %d onto %d\", passFDs[i], wantfd);\n\n        /* If we already have desired FD number, life\n         * is easy. Nothing needs renumbering */\n        if (passFDs[i] == wantfd)\n            continue;\n\n        /*\n         * Lets check to see if any later FDs are occupying\n         * our desired FD number. If so, we must move them\n         * out of the way\n         */\n        for (j = i + 1; j < npassFDs; j++) {\n            if (passFDs[j] == wantfd) {\n                VIR_DEBUG(\"Clash %zu\", j);\n                int newfd = dup(passFDs[j]);\n                if (newfd < 0) {\n                    virReportSystemError(errno,\n                                         _(\"Cannot move fd %d out of the way\"),\n                                         passFDs[j]);\n                    goto cleanup;\n                }\n                /* We're intentionally not closing the\n                 * old value of passFDs[j], because we\n                 * don't want later iterations of the\n                 * loop to take it back. dup2() will\n                 * cause it to be closed shortly anyway\n                 */\n                VIR_DEBUG(\"Moved clash onto %d\", newfd);\n                passFDs[j] = newfd;\n            }\n        }\n\n        /* Finally we can move into our desired FD number */\n        if (dup2(passFDs[i], wantfd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Cannot duplicate fd %d onto fd %d\"),\n                                 passFDs[i], wantfd);\n            goto cleanup;\n        }\n        VIR_FORCE_CLOSE(passFDs[i]);\n    }\n\n    last_fd = STDERR_FILENO + npassFDs;\n\n    /* Just in case someone forget to set FD_CLOEXEC, explicitly\n     * close all remaining FDs before executing the container */\n    open_max = sysconf(_SC_OPEN_MAX);\n    if (open_max < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"sysconf(_SC_OPEN_MAX) failed\"));\n        goto cleanup;\n    }\n\n    for (fd = last_fd + 1; fd < open_max; fd++) {\n        int tmpfd = fd;\n        VIR_MASS_CLOSE(tmpfd);\n    }\n\n    rc = 0;\n\n cleanup:\n    VIR_DEBUG(\"rc=%d\", rc);\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "argv->monitor"
          ],
          "line": 2283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "argv->handshakefd"
          ],
          "line": 2282
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up inherited FDs\""
          ],
          "line": 2281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecurityManagerSetProcessLabel",
          "args": [
            "argv->securityDriver",
            "vmDef"
          ],
          "line": 2278
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerSetProcessLabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "918-932",
          "snippet": "int\nvirSecurityManagerSetProcessLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm)\n{\n    if (mgr->drv->domainSetSecurityProcessLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityProcessLabel(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirSecurityManagerSetProcessLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm)\n{\n    if (mgr->drv->domainSetSecurityProcessLabel) {\n        int ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainSetSecurityProcessLabel(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up security labeling\""
          ],
          "line": 2277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Failed to send continue signal to controller\")"
          ],
          "line": 2272
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerSendContinue",
          "args": [
            "argv->handshakefd"
          ],
          "line": 2271
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSendContinue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "381-392",
          "snippet": "int lxcContainerSendContinue(int control)\n{\n    lxc_message_t msg = LXC_CONTINUE_MSG;\n    int writeCount = 0;\n\n    VIR_DEBUG(\"Send continue on fd %d\", control);\n    writeCount = safewrite(control, &msg, sizeof(msg));\n    if (writeCount != sizeof(msg))\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LXC_CONTINUE_MSG 'c'"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define LXC_CONTINUE_MSG 'c'\n\nint lxcContainerSendContinue(int control)\n{\n    lxc_message_t msg = LXC_CONTINUE_MSG;\n    int writeCount = 0;\n\n    VIR_DEBUG(\"Send continue on fd %d\", control);\n    writeCount = safewrite(control, &msg, sizeof(msg));\n    if (writeCount != sizeof(msg))\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerDropCapabilities",
          "args": [
            "vmDef",
            "!!hasReboot"
          ],
          "line": 2268
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerDropCapabilities",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2053-2058",
          "snippet": "static int lxcContainerDropCapabilities(virDomainDefPtr def G_GNUC_UNUSED,\n                                        bool keepReboot G_GNUC_UNUSED)\n{\n    VIR_WARN(\"libcap-ng support not compiled in, unable to clear capabilities\");\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerDropCapabilities(virDomainDefPtr def G_GNUC_UNUSED,\n                                        bool keepReboot G_GNUC_UNUSED)\n{\n    VIR_WARN(\"libcap-ng support not compiled in, unable to clear capabilities\");\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerSetHostname",
          "args": [
            "vmDef"
          ],
          "line": 2263
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetHostname",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2129-2153",
          "snippet": "static int lxcContainerSetHostname(virDomainDefPtr def)\n{\n    int ret = -1;\n    char *name = NULL;\n    char *hostname = NULL;\n\n    /* Filter the VM name to get a valid hostname */\n    name = g_strdup(def->name);\n\n    /* RFC 1123 allows 0-9 digits as a first character in hostname */\n    virStringFilterChars(name, hostname_validchars);\n    hostname = name;\n    if (strlen(name) > 0 && name[0] == '-')\n        hostname = name + 1;\n\n    if (sethostname(hostname, strlen(hostname)) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"Failed to set hostname\"));\n        goto cleanup;\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(name);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const char hostname_validchars[] =\n    \"abcdefghijklmnopqrstuvwxyz\"\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    \"0123456789-\";"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic const char hostname_validchars[] =\n    \"abcdefghijklmnopqrstuvwxyz\"\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    \"0123456789-\";\n\nstatic int lxcContainerSetHostname(virDomainDefPtr def)\n{\n    int ret = -1;\n    char *name = NULL;\n    char *hostname = NULL;\n\n    /* Filter the VM name to get a valid hostname */\n    name = g_strdup(def->name);\n\n    /* RFC 1123 allows 0-9 digits as a first character in hostname */\n    virStringFilterChars(name, hostname_validchars);\n    hostname = name;\n    if (strlen(name) > 0 && name[0] == '-')\n        hostname = name + 1;\n\n    if (sethostname(hostname, strlen(hostname)) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"Failed to set hostname\"));\n        goto cleanup;\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(name);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerRenameAndEnableInterfaces",
          "args": [
            "vmDef",
            "argv->nveths",
            "argv->veths"
          ],
          "line": 2257
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerRenameAndEnableInterfaces",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "480-528",
          "snippet": "static int\nlxcContainerRenameAndEnableInterfaces(virDomainDefPtr vmDef,\n                                      size_t nveths,\n                                      char **veths)\n{\n    size_t i;\n    const char *newname;\n    virDomainNetDefPtr netDef;\n    bool privNet = vmDef->features[VIR_DOMAIN_FEATURE_PRIVNET] ==\n                   VIR_TRISTATE_SWITCH_ON;\n\n    for (i = 0; i < nveths; i++) {\n        if (!(netDef = lxcContainerGetNetDef(vmDef, veths[i])))\n            return -1;\n\n        newname = netDef->ifname_guest;\n        if (!newname) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing device name for container-side veth\"));\n            return -1;\n        }\n\n        VIR_DEBUG(\"Renaming %s to %s\", veths[i], newname);\n        if (virNetDevSetName(veths[i], newname) < 0)\n            return -1;\n\n        /* Only enable this device if there is a reason to do so (either\n         * at least one IP was specified, or link state was set to up in\n         * the config)\n         */\n        if (netDef->guestIP.nips ||\n            netDef->linkstate == VIR_DOMAIN_NET_INTERFACE_LINK_STATE_UP) {\n            VIR_DEBUG(\"Enabling %s\", newname);\n            if (virNetDevSetOnline(newname, true) < 0)\n                return -1;\n        }\n\n        /* set IP addresses and routes */\n        if (virNetDevIPInfoAddToDev(newname, &netDef->guestIP) < 0)\n            return -1;\n    }\n\n    /* enable lo device only if there were other net devices */\n    if ((veths || privNet) &&\n        virNetDevSetOnline(\"lo\", true) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nlxcContainerRenameAndEnableInterfaces(virDomainDefPtr vmDef,\n                                      size_t nveths,\n                                      char **veths)\n{\n    size_t i;\n    const char *newname;\n    virDomainNetDefPtr netDef;\n    bool privNet = vmDef->features[VIR_DOMAIN_FEATURE_PRIVNET] ==\n                   VIR_TRISTATE_SWITCH_ON;\n\n    for (i = 0; i < nveths; i++) {\n        if (!(netDef = lxcContainerGetNetDef(vmDef, veths[i])))\n            return -1;\n\n        newname = netDef->ifname_guest;\n        if (!newname) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing device name for container-side veth\"));\n            return -1;\n        }\n\n        VIR_DEBUG(\"Renaming %s to %s\", veths[i], newname);\n        if (virNetDevSetName(veths[i], newname) < 0)\n            return -1;\n\n        /* Only enable this device if there is a reason to do so (either\n         * at least one IP was specified, or link state was set to up in\n         * the config)\n         */\n        if (netDef->guestIP.nips ||\n            netDef->linkstate == VIR_DOMAIN_NET_INTERFACE_LINK_STATE_UP) {\n            VIR_DEBUG(\"Enabling %s\", newname);\n            if (virNetDevSetOnline(newname, true) < 0)\n                return -1;\n        }\n\n        /* set IP addresses and routes */\n        if (virNetDevIPInfoAddToDev(newname, &netDef->guestIP) < 0)\n            return -1;\n    }\n\n    /* enable lo device only if there were other net devices */\n    if ((veths || privNet) &&\n        virNetDevSetOnline(\"lo\", true) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerSetUserGroup",
          "args": [
            "cmd",
            "vmDef",
            "argv->ttyPaths[0]"
          ],
          "line": 2253
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetUserGroup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2087-2122",
          "snippet": "static int lxcContainerSetUserGroup(virCommandPtr cmd,\n                                    virDomainDefPtr vmDef,\n                                    const char *ttyPath)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (vmDef->os.inituser) {\n        if (virGetUserID(vmDef->os.inituser, &uid) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, _(\"User %s doesn't exist\"),\n                           vmDef->os.inituser);\n            return -1;\n        }\n        virCommandSetUID(cmd, uid);\n\n        /* Change the newly created tty owner to the inituid for\n         * shells to have job control. */\n        if (chown(ttyPath, uid, -1) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to change ownership of tty %s\"),\n                                 ttyPath);\n            return -1;\n        }\n    }\n\n    if (vmDef->os.initgroup) {\n        if (virGetGroupID(vmDef->os.initgroup, &gid) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, _(\"Group %s doesn't exist\"),\n                           vmDef->os.initgroup);\n            return -1;\n        }\n        virCommandSetGID(cmd, gid);\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetUserGroup(virCommandPtr cmd,\n                                    virDomainDefPtr vmDef,\n                                    const char *ttyPath)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (vmDef->os.inituser) {\n        if (virGetUserID(vmDef->os.inituser, &uid) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, _(\"User %s doesn't exist\"),\n                           vmDef->os.inituser);\n            return -1;\n        }\n        virCommandSetUID(cmd, uid);\n\n        /* Change the newly created tty owner to the inituid for\n         * shells to have job control. */\n        if (chown(ttyPath, uid, -1) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to change ownership of tty %s\"),\n                                 ttyPath);\n            return -1;\n        }\n    }\n\n    if (vmDef->os.initgroup) {\n        if (virGetGroupID(vmDef->os.initgroup, &gid) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, _(\"Group %s doesn't exist\"),\n                           vmDef->os.initgroup);\n            return -1;\n        }\n        virCommandSetGID(cmd, gid);\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot find init path '%s' relative to container root\")",
            "vmDef->os.init"
          ],
          "line": 2247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "vmDef->os.init"
          ],
          "line": 2246
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerSetupPivotRoot",
          "args": [
            "vmDef",
            "root",
            "argv->ttyPaths",
            "argv->nttyPaths",
            "argv->securityDriver"
          ],
          "line": 2241
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetupPivotRoot",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1699-1783",
          "snippet": "static int lxcContainerSetupPivotRoot(virDomainDefPtr vmDef,\n                                      virDomainFSDefPtr root,\n                                      char **ttyPaths,\n                                      size_t nttyPaths,\n                                      virSecurityManagerPtr securityDriver)\n{\n    virCgroupPtr cgroup = NULL;\n    int ret = -1;\n    char *sec_mount_options;\n    char *stateDir = NULL;\n\n    VIR_DEBUG(\"Setup pivot root\");\n\n    if (!(sec_mount_options = virSecurityManagerGetMountOptions(securityDriver, vmDef)))\n        return -1;\n\n    /* Before pivoting we need to identify any\n     * cgroups controllers that are mounted */\n    if (virCgroupNewSelf(&cgroup) < 0)\n        goto cleanup;\n\n    if (virFileResolveAllLinks(LXC_STATE_DIR, &stateDir) < 0)\n        goto cleanup;\n\n    /* Ensure the root filesystem is mounted */\n    if (lxcContainerPrepareRoot(vmDef, root, sec_mount_options) < 0)\n        goto cleanup;\n\n    /* Gives us a private root, leaving all parent OS mounts on /.oldroot */\n    if (lxcContainerPivotRoot(root) < 0)\n        goto cleanup;\n\n    /* FIXME: we should find a way to unmount these mounts for container\n     * even user namespace is enabled. */\n    if (STREQ(root->src->path, \"/\") && (!vmDef->idmap.nuidmap) &&\n        lxcContainerUnmountForSharedRoot(stateDir, vmDef->name) < 0)\n        goto cleanup;\n\n    /* Mounts the core /proc, /sys, etc filesystems */\n    if (lxcContainerMountBasicFS(vmDef->idmap.nuidmap,\n                                 !lxcNeedNetworkNamespace(vmDef)) < 0)\n        goto cleanup;\n\n    /* Ensure entire root filesystem (except /.oldroot) is readonly */\n    if (root->readonly &&\n        lxcContainerSetReadOnly() < 0)\n        goto cleanup;\n\n    /* Mounts /proc/meminfo etc sysinfo */\n    if (lxcContainerMountProcFuse(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Now we can re-mount the cgroups controllers in the\n     * same configuration as before */\n    if (virCgroupBindMount(cgroup, \"/.oldroot/\", sec_mount_options) < 0)\n        goto cleanup;\n\n    /* Mounts /dev */\n    if (lxcContainerMountFSDev(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Mounts /dev/pts */\n    if (lxcContainerMountFSDevPTS(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Setup device nodes in /dev/ */\n    if (lxcContainerSetupDevices(ttyPaths, nttyPaths) < 0)\n        goto cleanup;\n\n    /* Sets up any non-root mounts from guest config */\n    if (lxcContainerMountAllFS(vmDef, sec_mount_options) < 0)\n        goto cleanup;\n\n   /* Gets rid of all remaining mounts from host OS, including /.oldroot itself */\n    if (lxcContainerUnmountSubtree(\"/.oldroot\", true) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(stateDir);\n    virCgroupFree(&cgroup);\n    VIR_FREE(sec_mount_options);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerSetupPivotRoot(virDomainDefPtr vmDef,\n                                      virDomainFSDefPtr root,\n                                      char **ttyPaths,\n                                      size_t nttyPaths,\n                                      virSecurityManagerPtr securityDriver)\n{\n    virCgroupPtr cgroup = NULL;\n    int ret = -1;\n    char *sec_mount_options;\n    char *stateDir = NULL;\n\n    VIR_DEBUG(\"Setup pivot root\");\n\n    if (!(sec_mount_options = virSecurityManagerGetMountOptions(securityDriver, vmDef)))\n        return -1;\n\n    /* Before pivoting we need to identify any\n     * cgroups controllers that are mounted */\n    if (virCgroupNewSelf(&cgroup) < 0)\n        goto cleanup;\n\n    if (virFileResolveAllLinks(LXC_STATE_DIR, &stateDir) < 0)\n        goto cleanup;\n\n    /* Ensure the root filesystem is mounted */\n    if (lxcContainerPrepareRoot(vmDef, root, sec_mount_options) < 0)\n        goto cleanup;\n\n    /* Gives us a private root, leaving all parent OS mounts on /.oldroot */\n    if (lxcContainerPivotRoot(root) < 0)\n        goto cleanup;\n\n    /* FIXME: we should find a way to unmount these mounts for container\n     * even user namespace is enabled. */\n    if (STREQ(root->src->path, \"/\") && (!vmDef->idmap.nuidmap) &&\n        lxcContainerUnmountForSharedRoot(stateDir, vmDef->name) < 0)\n        goto cleanup;\n\n    /* Mounts the core /proc, /sys, etc filesystems */\n    if (lxcContainerMountBasicFS(vmDef->idmap.nuidmap,\n                                 !lxcNeedNetworkNamespace(vmDef)) < 0)\n        goto cleanup;\n\n    /* Ensure entire root filesystem (except /.oldroot) is readonly */\n    if (root->readonly &&\n        lxcContainerSetReadOnly() < 0)\n        goto cleanup;\n\n    /* Mounts /proc/meminfo etc sysinfo */\n    if (lxcContainerMountProcFuse(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Now we can re-mount the cgroups controllers in the\n     * same configuration as before */\n    if (virCgroupBindMount(cgroup, \"/.oldroot/\", sec_mount_options) < 0)\n        goto cleanup;\n\n    /* Mounts /dev */\n    if (lxcContainerMountFSDev(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Mounts /dev/pts */\n    if (lxcContainerMountFSDevPTS(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Setup device nodes in /dev/ */\n    if (lxcContainerSetupDevices(ttyPaths, nttyPaths) < 0)\n        goto cleanup;\n\n    /* Sets up any non-root mounts from guest config */\n    if (lxcContainerMountAllFS(vmDef, sec_mount_options) < 0)\n        goto cleanup;\n\n   /* Gets rid of all remaining mounts from host OS, including /.oldroot itself */\n    if (lxcContainerUnmountSubtree(\"/.oldroot\", true) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(stateDir);\n    virCgroupFree(&cgroup);\n    VIR_FREE(sec_mount_options);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting up pivot\""
          ],
          "line": 2240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerResolveAllSymlinks",
          "args": [
            "vmDef"
          ],
          "line": 2237
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerResolveAllSymlinks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1785-1801",
          "snippet": "static int lxcContainerResolveAllSymlinks(virDomainDefPtr vmDef)\n{\n    size_t i;\n\n    VIR_DEBUG(\"Resolving symlinks\");\n\n    for (i = 0; i < vmDef->nfss; i++) {\n        virDomainFSDefPtr fs = vmDef->fss[i];\n        /* In the first pass, be gentle as some files may\n           depend on other filesystems to be mounted */\n        if (lxcContainerResolveSymlinks(fs, true) < 0)\n            return -1;\n    }\n    VIR_DEBUG(\"Resolved all filesystem symlinks\");\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerResolveAllSymlinks(virDomainDefPtr vmDef)\n{\n    size_t i;\n\n    VIR_DEBUG(\"Resolving symlinks\");\n\n    for (i = 0; i < vmDef->nfss; i++) {\n        virDomainFSDefPtr fs = vmDef->fss[i];\n        /* In the first pass, be gentle as some files may\n           depend on other filesystems to be mounted */\n        if (lxcContainerResolveSymlinks(fs, true) < 0)\n            return -1;\n    }\n    VIR_DEBUG(\"Resolved all filesystem symlinks\");\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to open tty %s\")",
            "ttyPath"
          ],
          "line": 2231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "ttyPath",
            "O_RDWR"
          ],
          "line": 2229
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Container TTY path: %s\"",
            "ttyPath"
          ],
          "line": 2227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"At least one tty is required\")"
          ],
          "line": 2222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s.devpts/%s\"",
            "LXC_STATE_DIR",
            "vmDef->name",
            "tty"
          ],
          "line": 2219
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "\"/dev/pts/\""
          ],
          "line": 2218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "tty",
            "\"/dev/pts/\""
          ],
          "line": 2217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainGetFilesystemForTarget",
          "args": [
            "vmDef",
            "\"/\""
          ],
          "line": 2213
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainGetFilesystemForTarget",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "29820-29832",
          "snippet": "virDomainFSDefPtr\nvirDomainGetFilesystemForTarget(virDomainDefPtr def,\n                                const char *target)\n{\n    size_t i;\n\n    for (i = 0; i < def->nfss; i++) {\n        if (STREQ(def->fss[i]->dst, target))\n            return def->fss[i];\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirDomainFSDefPtr\nvirDomainGetFilesystemForTarget(virDomainDefPtr def,\n                                const char *target)\n{\n    size_t i;\n\n    for (i = 0; i < def->nfss; i++) {\n        if (STREQ(def->fss[i]->dst, target))\n            return def->fss[i];\n    }\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerSetID",
          "args": [
            "vmDef"
          ],
          "line": 2210
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "434-451",
          "snippet": "static int lxcContainerSetID(virDomainDefPtr def)\n{\n    /* Only call virSetUIDGID when user namespace is enabled\n     * for this container. And user namespace is only enabled\n     * when nuidmap&ngidmap is not zero */\n\n    if (!def->idmap.nuidmap)\n        return 0;\n\n    VIR_DEBUG(\"Setting UID/GID to 0/0\");\n    if (virSetUIDGID(0, 0, NULL, 0) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"setuid or setgid failed\"));\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetID(virDomainDefPtr def)\n{\n    /* Only call virSetUIDGID when user namespace is enabled\n     * for this container. And user namespace is only enabled\n     * when nuidmap&ngidmap is not zero */\n\n    if (!def->idmap.nuidmap)\n        return 0;\n\n    VIR_DEBUG(\"Setting UID/GID to 0/0\");\n    if (virSetUIDGID(0, 0, NULL, 0) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"setuid or setgid failed\"));\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandWriteArgLog",
          "args": [
            "cmd",
            "1"
          ],
          "line": 2208
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandWriteArgLog",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2039-2067",
          "snippet": "void\nvirCommandWriteArgLog(virCommandPtr cmd, int logfd)\n{\n    int ioError = 0;\n    size_t i;\n\n    /* Any errors will be reported later by virCommandRun, which means\n     * no command will be run, so there is nothing to log. */\n    if (!cmd || cmd->has_error)\n        return;\n\n    for (i = 0; i < cmd->nenv; i++) {\n        if (safewrite(logfd, cmd->env[i], strlen(cmd->env[i])) < 0)\n            ioError = errno;\n        if (safewrite(logfd, \" \", 1) < 0)\n            ioError = errno;\n    }\n    for (i = 0; i < cmd->nargs; i++) {\n        if (safewrite(logfd, cmd->args[i], strlen(cmd->args[i])) < 0)\n            ioError = errno;\n        if (safewrite(logfd, i == cmd->nargs - 1 ? \"\\n\" : \" \", 1) < 0)\n            ioError = errno;\n    }\n\n    if (ioError) {\n        VIR_WARN(\"Unable to write command %s args to logfile: %s\",\n                 cmd->args[0], g_strerror(ioError));\n    }\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandWriteArgLog(virCommandPtr cmd, int logfd)\n{\n    int ioError = 0;\n    size_t i;\n\n    /* Any errors will be reported later by virCommandRun, which means\n     * no command will be run, so there is nothing to log. */\n    if (!cmd || cmd->has_error)\n        return;\n\n    for (i = 0; i < cmd->nenv; i++) {\n        if (safewrite(logfd, cmd->env[i], strlen(cmd->env[i])) < 0)\n            ioError = errno;\n        if (safewrite(logfd, \" \", 1) < 0)\n            ioError = errno;\n    }\n    for (i = 0; i < cmd->nargs; i++) {\n        if (safewrite(logfd, cmd->args[i], strlen(cmd->args[i])) < 0)\n            ioError = errno;\n        if (safewrite(logfd, i == cmd->nargs - 1 ? \"\\n\" : \" \", 1) < 0)\n            ioError = errno;\n    }\n\n    if (ioError) {\n        VIR_WARN(\"Unable to write command %s args to logfile: %s\",\n                 cmd->args[0], g_strerror(ioError));\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerBuildInitCmd",
          "args": [
            "vmDef",
            "argv->ttyPaths",
            "argv->nttyPaths"
          ],
          "line": 2205
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerBuildInitCmd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "195-248",
          "snippet": "static virCommandPtr lxcContainerBuildInitCmd(virDomainDefPtr vmDef,\n                                              char **ttyPaths,\n                                              size_t nttyPaths)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virCommandPtr cmd;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    size_t i;\n\n    /* 'container_ptys' must exclude the PTY associated with\n     * the /dev/console device, hence start at 1 not 0\n     */\n    for (i = 1; i < nttyPaths; i++) {\n        if (!STRPREFIX(ttyPaths[i], \"/dev/\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Expected a /dev path for '%s'\"),\n                           ttyPaths[i]);\n            virBufferFreeAndReset(&buf);\n            return NULL;\n        }\n        virBufferAdd(&buf, ttyPaths[i] + 5, -1);\n        virBufferAddChar(&buf, ' ');\n    }\n    virBufferTrimLen(&buf, 1);\n\n    virUUIDFormat(vmDef->uuid, uuidstr);\n\n    cmd = virCommandNew(vmDef->os.init);\n\n    if (vmDef->os.initargv && vmDef->os.initargv[0])\n        virCommandAddArgSet(cmd, (const char **)vmDef->os.initargv);\n\n    virCommandAddEnvString(cmd, \"PATH=/bin:/sbin\");\n    virCommandAddEnvString(cmd, \"TERM=linux\");\n    virCommandAddEnvString(cmd, \"container=lxc-libvirt\");\n    virCommandAddEnvString(cmd, \"HOME=/\");\n    virCommandAddEnvPair(cmd, \"container_uuid\", uuidstr);\n    if (nttyPaths > 1)\n        virCommandAddEnvPair(cmd, \"container_ttys\", virBufferCurrentContent(&buf));\n    virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_UUID\", uuidstr);\n    virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_NAME\", vmDef->name);\n    if (vmDef->os.cmdline)\n        virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_CMDLINE\", vmDef->os.cmdline);\n    if (vmDef->os.initdir)\n        virCommandSetWorkingDirectory(cmd, vmDef->os.initdir);\n\n    for (i = 0; vmDef->os.initenv[i]; i++) {\n        virCommandAddEnvPair(cmd, vmDef->os.initenv[i]->name,\n                                  vmDef->os.initenv[i]->value);\n    }\n\n    virBufferFreeAndReset(&buf);\n    return cmd;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virCommandPtr lxcContainerBuildInitCmd(virDomainDefPtr vmDef,\n                                              char **ttyPaths,\n                                              size_t nttyPaths)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virCommandPtr cmd;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    size_t i;\n\n    /* 'container_ptys' must exclude the PTY associated with\n     * the /dev/console device, hence start at 1 not 0\n     */\n    for (i = 1; i < nttyPaths; i++) {\n        if (!STRPREFIX(ttyPaths[i], \"/dev/\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Expected a /dev path for '%s'\"),\n                           ttyPaths[i]);\n            virBufferFreeAndReset(&buf);\n            return NULL;\n        }\n        virBufferAdd(&buf, ttyPaths[i] + 5, -1);\n        virBufferAddChar(&buf, ' ');\n    }\n    virBufferTrimLen(&buf, 1);\n\n    virUUIDFormat(vmDef->uuid, uuidstr);\n\n    cmd = virCommandNew(vmDef->os.init);\n\n    if (vmDef->os.initargv && vmDef->os.initargv[0])\n        virCommandAddArgSet(cmd, (const char **)vmDef->os.initargv);\n\n    virCommandAddEnvString(cmd, \"PATH=/bin:/sbin\");\n    virCommandAddEnvString(cmd, \"TERM=linux\");\n    virCommandAddEnvString(cmd, \"container=lxc-libvirt\");\n    virCommandAddEnvString(cmd, \"HOME=/\");\n    virCommandAddEnvPair(cmd, \"container_uuid\", uuidstr);\n    if (nttyPaths > 1)\n        virCommandAddEnvPair(cmd, \"container_ttys\", virBufferCurrentContent(&buf));\n    virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_UUID\", uuidstr);\n    virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_NAME\", vmDef->name);\n    if (vmDef->os.cmdline)\n        virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_CMDLINE\", vmDef->os.cmdline);\n    if (vmDef->os.initdir)\n        virCommandSetWorkingDirectory(cmd, vmDef->os.initdir);\n\n    for (i = 0; vmDef->os.initenv[i]; i++) {\n        virCommandAddEnvPair(cmd, vmDef->os.initenv[i]->name,\n                                  vmDef->os.initenv[i]->value);\n    }\n\n    virBufferFreeAndReset(&buf);\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerHasReboot",
          "args": [],
          "line": 2202
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerHasReboot",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "132-184",
          "snippet": "static\nint lxcContainerHasReboot(void)\n{\n    int flags = CLONE_NEWPID|CLONE_NEWNS|CLONE_NEWUTS|\n        CLONE_NEWIPC|SIGCHLD;\n    int cpid;\n    char *childStack;\n    char *stack;\n    char *buf;\n    int cmd, v;\n    int status;\n    char *tmp;\n    int stacksize = getpagesize() * 4;\n\n    if (virFileReadAll(\"/proc/sys/kernel/ctrl-alt-del\", 10, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    if (virStrToLong_i(buf, NULL, 10, &v) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Malformed ctrl-alt-del setting '%s'\"), buf);\n        VIR_FREE(buf);\n        return -1;\n    }\n    VIR_FREE(buf);\n    cmd = v ? LINUX_REBOOT_CMD_CAD_ON : LINUX_REBOOT_CMD_CAD_OFF;\n\n    if (VIR_ALLOC_N(stack, stacksize) < 0)\n        return -1;\n\n    childStack = stack + stacksize;\n\n    cpid = clone(lxcContainerRebootChild, childStack, flags, &cmd);\n    VIR_FREE(stack);\n    if (cpid < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to clone to check reboot support\"));\n        return -1;\n    } else if (virProcessWait(cpid, &status, false) < 0) {\n        return -1;\n    }\n\n    if (status != 1) {\n        VIR_DEBUG(\"Containerized reboot support is missing \"\n                  \"(kernel probably too old < 3.4)\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"Containerized reboot support is available\");\n    return 1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic\nint lxcContainerHasReboot(void)\n{\n    int flags = CLONE_NEWPID|CLONE_NEWNS|CLONE_NEWUTS|\n        CLONE_NEWIPC|SIGCHLD;\n    int cpid;\n    char *childStack;\n    char *stack;\n    char *buf;\n    int cmd, v;\n    int status;\n    char *tmp;\n    int stacksize = getpagesize() * 4;\n\n    if (virFileReadAll(\"/proc/sys/kernel/ctrl-alt-del\", 10, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    if (virStrToLong_i(buf, NULL, 10, &v) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Malformed ctrl-alt-del setting '%s'\"), buf);\n        VIR_FREE(buf);\n        return -1;\n    }\n    VIR_FREE(buf);\n    cmd = v ? LINUX_REBOOT_CMD_CAD_ON : LINUX_REBOOT_CMD_CAD_OFF;\n\n    if (VIR_ALLOC_N(stack, stacksize) < 0)\n        return -1;\n\n    childStack = stack + stacksize;\n\n    cpid = clone(lxcContainerRebootChild, childStack, flags, &cmd);\n    VIR_FREE(stack);\n    if (cpid < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to clone to check reboot support\"));\n        return -1;\n    } else if (virProcessWait(cpid, &status, false) < 0) {\n        return -1;\n    }\n\n    if (status != 1) {\n        VIR_DEBUG(\"Containerized reboot support is missing \"\n                  \"(kernel probably too old < 3.4)\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"Containerized reboot support is available\");\n    return 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Received container continue message\""
          ],
          "line": 2200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Failed to read the container continue message\")"
          ],
          "line": 2196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerWaitForContinue",
          "args": [
            "argv->monitor"
          ],
          "line": 2195
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerWaitForContinue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "404-423",
          "snippet": "int lxcContainerWaitForContinue(int control)\n{\n    lxc_message_t msg;\n    int readLen;\n\n    VIR_DEBUG(\"Wait continue on fd %d\", control);\n    readLen = saferead(control, &msg, sizeof(msg));\n    VIR_DEBUG(\"Got continue on fd %d %d\", control, readLen);\n    if (readLen != sizeof(msg)) {\n        if (readLen >= 0)\n            errno = EIO;\n        return -1;\n    }\n    if (msg != LXC_CONTINUE_MSG) {\n        errno = EINVAL;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LXC_CONTINUE_MSG 'c'"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define LXC_CONTINUE_MSG 'c'\n\nint lxcContainerWaitForContinue(int control)\n{\n    lxc_message_t msg;\n    int readLen;\n\n    VIR_DEBUG(\"Wait continue on fd %d\", control);\n    readLen = saferead(control, &msg, sizeof(msg));\n    VIR_DEBUG(\"Got continue on fd %d %d\", control, readLen);\n    if (readLen != sizeof(msg)) {\n        if (readLen >= 0)\n            errno = EIO;\n        return -1;\n    }\n    if (msg != LXC_CONTINUE_MSG) {\n        errno = EINVAL;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_SYSTEM_ERROR",
            "\"%s\"",
            "_(\"failed to attach the namespace\")"
          ],
          "line": 2187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcAttachNS",
          "args": [
            "argv->nsInheritFDs"
          ],
          "line": 2186
        },
        "resolved": true,
        "details": {
          "function_name": "lxcAttachNS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2066-2073",
          "snippet": "static int lxcAttachNS(int *ns_fd)\n{\n    if (ns_fd &&\n        virProcessSetNamespaces((size_t)VIR_LXC_DOMAIN_NAMESPACE_LAST,\n                                ns_fd) < 0)\n        return -1;\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcAttachNS(int *ns_fd)\n{\n    if (ns_fd &&\n        virProcessSetNamespaces((size_t)VIR_LXC_DOMAIN_NAMESPACE_LAST,\n                                ns_fd) < 0)\n        return -1;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"lxcChild() passed invalid vm definition\")"
          ],
          "line": 2181
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerChild(void *data)\n{\n    lxc_child_argv_t *argv = data;\n    virDomainDefPtr vmDef = argv->config;\n    int ttyfd = -1;\n    int ret = -1;\n    char *ttyPath = NULL;\n    virDomainFSDefPtr root;\n    virCommandPtr cmd = NULL;\n    int hasReboot;\n    gid_t *groups = NULL;\n    int ngroups;\n\n    if (NULL == vmDef) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"lxcChild() passed invalid vm definition\"));\n        goto cleanup;\n    }\n\n    if (lxcAttachNS(argv->nsInheritFDs) < 0) {\n        virReportError(VIR_ERR_SYSTEM_ERROR, \"%s\",\n                       _(\"failed to attach the namespace\"));\n        return -1;\n    }\n\n    /* Wait for controller to finish setup tasks, including\n     * things like move of network interfaces, uid/gid mapping\n     */\n    if (lxcContainerWaitForContinue(argv->monitor) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to read the container continue message\"));\n        goto cleanup;\n    }\n    VIR_DEBUG(\"Received container continue message\");\n\n    if ((hasReboot = lxcContainerHasReboot()) < 0)\n        goto cleanup;\n\n    cmd = lxcContainerBuildInitCmd(vmDef,\n                                   argv->ttyPaths,\n                                   argv->nttyPaths);\n    virCommandWriteArgLog(cmd, 1);\n\n    if (lxcContainerSetID(vmDef) < 0)\n        goto cleanup;\n\n    root = virDomainGetFilesystemForTarget(vmDef, \"/\");\n\n    if (argv->nttyPaths) {\n        const char *tty = argv->ttyPaths[0];\n        if (STRPREFIX(tty, \"/dev/pts/\"))\n            tty += strlen(\"/dev/pts/\");\n        ttyPath = g_strdup_printf(\"%s/%s.devpts/%s\", LXC_STATE_DIR, vmDef->name,\n                                  tty);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"At least one tty is required\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Container TTY path: %s\", ttyPath);\n\n    ttyfd = open(ttyPath, O_RDWR);\n    if (ttyfd < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to open tty %s\"),\n                             ttyPath);\n        goto cleanup;\n    }\n\n    if (lxcContainerResolveAllSymlinks(vmDef) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Setting up pivot\");\n    if (lxcContainerSetupPivotRoot(vmDef, root,\n                                   argv->ttyPaths, argv->nttyPaths,\n                                   argv->securityDriver) < 0)\n        goto cleanup;\n\n    if (!virFileExists(vmDef->os.init)) {\n        virReportSystemError(errno,\n                             _(\"cannot find init path '%s' relative to container root\"),\n                             vmDef->os.init);\n        goto cleanup;\n    }\n\n    if (lxcContainerSetUserGroup(cmd, vmDef, argv->ttyPaths[0]) < 0)\n        goto cleanup;\n\n    /* rename and enable interfaces */\n    if (lxcContainerRenameAndEnableInterfaces(vmDef,\n                                              argv->nveths,\n                                              argv->veths) < 0) {\n        goto cleanup;\n    }\n\n    if (lxcContainerSetHostname(vmDef) < 0)\n        goto cleanup;\n\n\n    /* drop a set of root capabilities */\n    if (lxcContainerDropCapabilities(vmDef, !!hasReboot) < 0)\n        goto cleanup;\n\n    if (lxcContainerSendContinue(argv->handshakefd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to send continue signal to controller\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Setting up security labeling\");\n    if (virSecurityManagerSetProcessLabel(argv->securityDriver, vmDef) < 0)\n        goto cleanup;\n\n    VIR_DEBUG(\"Setting up inherited FDs\");\n    VIR_FORCE_CLOSE(argv->handshakefd);\n    VIR_FORCE_CLOSE(argv->monitor);\n    if (lxcContainerSetupFDs(&ttyfd,\n                             argv->npassFDs, argv->passFDs) < 0)\n        goto cleanup;\n\n    /* Make init process of the container the leader of the new session.\n     * That is needed when checkpointing container.\n     */\n    if (setsid() < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to become session leader\"));\n        goto cleanup;\n    }\n\n    /* TODO is it safe to call it here or should this call be moved in\n     * front of the clone() as otherwise there might be a risk for a\n     * deadlock */\n    if ((ngroups = virGetGroupList(virCommandGetUID(cmd), virCommandGetGID(cmd),\n                                   &groups)) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(ttyPath);\n    VIR_FORCE_CLOSE(ttyfd);\n    VIR_FORCE_CLOSE(argv->monitor);\n    VIR_FORCE_CLOSE(argv->handshakefd);\n\n    if (ret == 0) {\n        VIR_DEBUG(\"Executing init binary\");\n        /* this function will only return if an error occurred */\n        ret = virCommandExec(cmd, groups, ngroups);\n    }\n\n    if (ret != 0) {\n        VIR_DEBUG(\"Tearing down container\");\n        fprintf(stderr,\n                _(\"Failure in libvirt_lxc startup: %s\\n\"),\n                virGetLastErrorMessage());\n    }\n\n    VIR_FREE(groups);\n    virCommandFree(cmd);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerSetHostname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2129-2153",
    "snippet": "static int lxcContainerSetHostname(virDomainDefPtr def)\n{\n    int ret = -1;\n    char *name = NULL;\n    char *hostname = NULL;\n\n    /* Filter the VM name to get a valid hostname */\n    name = g_strdup(def->name);\n\n    /* RFC 1123 allows 0-9 digits as a first character in hostname */\n    virStringFilterChars(name, hostname_validchars);\n    hostname = name;\n    if (strlen(name) > 0 && name[0] == '-')\n        hostname = name + 1;\n\n    if (sethostname(hostname, strlen(hostname)) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"Failed to set hostname\"));\n        goto cleanup;\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(name);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const char hostname_validchars[] =\n    \"abcdefghijklmnopqrstuvwxyz\"\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    \"0123456789-\";"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "name"
          ],
          "line": 2151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Failed to set hostname\")"
          ],
          "line": 2145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to set hostname\""
          ],
          "line": 2145
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sethostname",
          "args": [
            "hostname",
            "strlen(hostname)"
          ],
          "line": 2144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "hostname"
          ],
          "line": 2144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "name"
          ],
          "line": 2141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStringFilterChars",
          "args": [
            "name",
            "hostname_validchars"
          ],
          "line": 2139
        },
        "resolved": true,
        "details": {
          "function_name": "virStringFilterChars",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "1245-1259",
          "snippet": "void\nvirStringFilterChars(char *str, const char *valid)\n{\n    size_t len, i, j;\n\n    if (!str)\n        return;\n\n    len = strlen(str);\n    for (i = 0, j = 0; i < len; i++) {\n        if (strchr(valid, str[i]))\n            str[j++] = str[i];\n    }\n    str[j] = '\\0';\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid\nvirStringFilterChars(char *str, const char *valid)\n{\n    size_t len, i, j;\n\n    if (!str)\n        return;\n\n    len = strlen(str);\n    for (i = 0, j = 0; i < len; i++) {\n        if (strchr(valid, str[i]))\n            str[j++] = str[i];\n    }\n    str[j] = '\\0';\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "def->name"
          ],
          "line": 2136
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic const char hostname_validchars[] =\n    \"abcdefghijklmnopqrstuvwxyz\"\n    \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\"\n    \"0123456789-\";\n\nstatic int lxcContainerSetHostname(virDomainDefPtr def)\n{\n    int ret = -1;\n    char *name = NULL;\n    char *hostname = NULL;\n\n    /* Filter the VM name to get a valid hostname */\n    name = g_strdup(def->name);\n\n    /* RFC 1123 allows 0-9 digits as a first character in hostname */\n    virStringFilterChars(name, hostname_validchars);\n    hostname = name;\n    if (strlen(name) > 0 && name[0] == '-')\n        hostname = name + 1;\n\n    if (sethostname(hostname, strlen(hostname)) < 0) {\n        virReportSystemError(errno, \"%s\", _(\"Failed to set hostname\"));\n        goto cleanup;\n    }\n    ret = 0;\n\n cleanup:\n    VIR_FREE(name);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerSetUserGroup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2087-2122",
    "snippet": "static int lxcContainerSetUserGroup(virCommandPtr cmd,\n                                    virDomainDefPtr vmDef,\n                                    const char *ttyPath)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (vmDef->os.inituser) {\n        if (virGetUserID(vmDef->os.inituser, &uid) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, _(\"User %s doesn't exist\"),\n                           vmDef->os.inituser);\n            return -1;\n        }\n        virCommandSetUID(cmd, uid);\n\n        /* Change the newly created tty owner to the inituid for\n         * shells to have job control. */\n        if (chown(ttyPath, uid, -1) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to change ownership of tty %s\"),\n                                 ttyPath);\n            return -1;\n        }\n    }\n\n    if (vmDef->os.initgroup) {\n        if (virGetGroupID(vmDef->os.initgroup, &gid) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, _(\"Group %s doesn't exist\"),\n                           vmDef->os.initgroup);\n            return -1;\n        }\n        virCommandSetGID(cmd, gid);\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandSetGID",
          "args": [
            "cmd",
            "gid"
          ],
          "line": 2118
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetGID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1111-1118",
          "snippet": "void\nvirCommandSetGID(virCommandPtr cmd, gid_t gid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->gid = gid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetGID(virCommandPtr cmd, gid_t gid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->gid = gid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Group %s doesn't exist\")",
            "vmDef->os.initgroup"
          ],
          "line": 2114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Group %s doesn't exist\""
          ],
          "line": 2114
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetGroupID",
          "args": [
            "vmDef->os.initgroup",
            "&gid"
          ],
          "line": 2113
        },
        "resolved": true,
        "details": {
          "function_name": "virGetGroupID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1138-1145",
          "snippet": "int virGetGroupID(const char *name G_GNUC_UNUSED,\n                  gid_t *gid G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virGetGroupID is not available\"));\n\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virGetGroupID(const char *name G_GNUC_UNUSED,\n                  gid_t *gid G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virGetGroupID is not available\"));\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to change ownership of tty %s\")",
            "ttyPath"
          ],
          "line": 2105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chown",
          "args": [
            "ttyPath",
            "uid",
            "-1"
          ],
          "line": 2104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandSetUID",
          "args": [
            "cmd",
            "uid"
          ],
          "line": 2100
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetUID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1120-1127",
          "snippet": "void\nvirCommandSetUID(virCommandPtr cmd, uid_t uid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->uid = uid;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetUID(virCommandPtr cmd, uid_t uid)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    cmd->uid = uid;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"User %s doesn't exist\")",
            "vmDef->os.inituser"
          ],
          "line": 2096
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetUserID",
          "args": [
            "vmDef->os.inituser",
            "&uid"
          ],
          "line": 2095
        },
        "resolved": true,
        "details": {
          "function_name": "virGetUserID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1128-1135",
          "snippet": "int virGetUserID(const char *name G_GNUC_UNUSED,\n                 uid_t *uid G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virGetUserID is not available\"));\n\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virGetUserID(const char *name G_GNUC_UNUSED,\n                 uid_t *uid G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virGetUserID is not available\"));\n\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetUserGroup(virCommandPtr cmd,\n                                    virDomainDefPtr vmDef,\n                                    const char *ttyPath)\n{\n    uid_t uid;\n    gid_t gid;\n\n    if (vmDef->os.inituser) {\n        if (virGetUserID(vmDef->os.inituser, &uid) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, _(\"User %s doesn't exist\"),\n                           vmDef->os.inituser);\n            return -1;\n        }\n        virCommandSetUID(cmd, uid);\n\n        /* Change the newly created tty owner to the inituid for\n         * shells to have job control. */\n        if (chown(ttyPath, uid, -1) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to change ownership of tty %s\"),\n                                 ttyPath);\n            return -1;\n        }\n    }\n\n    if (vmDef->os.initgroup) {\n        if (virGetGroupID(vmDef->os.initgroup, &gid) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, _(\"Group %s doesn't exist\"),\n                           vmDef->os.initgroup);\n            return -1;\n        }\n        virCommandSetGID(cmd, gid);\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcAttachNS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2066-2073",
    "snippet": "static int lxcAttachNS(int *ns_fd)\n{\n    if (ns_fd &&\n        virProcessSetNamespaces((size_t)VIR_LXC_DOMAIN_NAMESPACE_LAST,\n                                ns_fd) < 0)\n        return -1;\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virProcessSetNamespaces",
          "args": [
            "(size_t)VIR_LXC_DOMAIN_NAMESPACE_LAST",
            "ns_fd"
          ],
          "line": 2069
        },
        "resolved": true,
        "details": {
          "function_name": "virProcessSetNamespaces",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virprocess.c",
          "lines": "681-708",
          "snippet": "int virProcessSetNamespaces(size_t nfdlist,\n                            int *fdlist)\n{\n    size_t i;\n\n    if (nfdlist == 0) {\n        virReportInvalidArg(nfdlist, \"%s\",\n                            _(\"Expected at least one file descriptor\"));\n        return -1;\n    }\n    for (i = 0; i < nfdlist; i++) {\n        if (fdlist[i] < 0)\n            continue;\n\n        /* We get EINVAL if new NS is same as the current\n         * NS, or if the fd namespace doesn't match the\n         * type passed to setns()'s second param. Since we\n         * pass 0, we know the EINVAL is harmless\n         */\n        if (setns(fdlist[i], 0) < 0 &&\n            errno != EINVAL) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to join domain namespace\"));\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#   include <sys/syscall.h>",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "# include <windows.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/user.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/param.h>",
            "# include <sched.h>",
            "# include <sys/resource.h>",
            "# include <sys/time.h>",
            "# include <sys/mount.h>",
            "#include <unistd.h>",
            "# include <sys/wait.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/syscall.h>\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n# include <windows.h>\n# include <sys/cpuset.h>\n# include <sys/user.h>\n# include <sys/sysctl.h>\n# include <sys/param.h>\n# include <sched.h>\n# include <sys/resource.h>\n# include <sys/time.h>\n# include <sys/mount.h>\n#include <unistd.h>\n# include <sys/wait.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virProcessSetNamespaces(size_t nfdlist,\n                            int *fdlist)\n{\n    size_t i;\n\n    if (nfdlist == 0) {\n        virReportInvalidArg(nfdlist, \"%s\",\n                            _(\"Expected at least one file descriptor\"));\n        return -1;\n    }\n    for (i = 0; i < nfdlist; i++) {\n        if (fdlist[i] < 0)\n            continue;\n\n        /* We get EINVAL if new NS is same as the current\n         * NS, or if the fd namespace doesn't match the\n         * type passed to setns()'s second param. Since we\n         * pass 0, we know the EINVAL is harmless\n         */\n        if (setns(fdlist[i], 0) < 0 &&\n            errno != EINVAL) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to join domain namespace\"));\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcAttachNS(int *ns_fd)\n{\n    if (ns_fd &&\n        virProcessSetNamespaces((size_t)VIR_LXC_DOMAIN_NAMESPACE_LAST,\n                                ns_fd) < 0)\n        return -1;\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerDropCapabilities",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "2053-2058",
    "snippet": "static int lxcContainerDropCapabilities(virDomainDefPtr def G_GNUC_UNUSED,\n                                        bool keepReboot G_GNUC_UNUSED)\n{\n    VIR_WARN(\"libcap-ng support not compiled in, unable to clear capabilities\");\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"libcap-ng support not compiled in, unable to clear capabilities\""
          ],
          "line": 2056
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerDropCapabilities(virDomainDefPtr def G_GNUC_UNUSED,\n                                        bool keepReboot G_GNUC_UNUSED)\n{\n    VIR_WARN(\"libcap-ng support not compiled in, unable to clear capabilities\");\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerDropCapabilities",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1924-2051",
    "snippet": "static int lxcContainerDropCapabilities(virDomainDefPtr def,\n                                        bool keepReboot)\n{\n    int ret;\n    size_t i;\n    int policy = def->features[VIR_DOMAIN_FEATURE_CAPABILITIES];\n\n    /* Maps virDomainProcessCapsFeature to CAPS_* */\n    static int capsMapping[] = {CAP_AUDIT_CONTROL,\n                                CAP_AUDIT_WRITE,\n                                CAP_BLOCK_SUSPEND,\n                                CAP_CHOWN,\n                                CAP_DAC_OVERRIDE,\n                                CAP_DAC_READ_SEARCH,\n                                CAP_FOWNER,\n                                CAP_FSETID,\n                                CAP_IPC_LOCK,\n                                CAP_IPC_OWNER,\n                                CAP_KILL,\n                                CAP_LEASE,\n                                CAP_LINUX_IMMUTABLE,\n                                CAP_MAC_ADMIN,\n                                CAP_MAC_OVERRIDE,\n                                CAP_MKNOD,\n                                CAP_NET_ADMIN,\n                                CAP_NET_BIND_SERVICE,\n                                CAP_NET_BROADCAST,\n                                CAP_NET_RAW,\n                                CAP_SETGID,\n                                CAP_SETFCAP,\n                                CAP_SETPCAP,\n                                CAP_SETUID,\n                                CAP_SYS_ADMIN,\n                                CAP_SYS_BOOT,\n                                CAP_SYS_CHROOT,\n                                CAP_SYS_MODULE,\n                                CAP_SYS_NICE,\n                                CAP_SYS_PACCT,\n                                CAP_SYS_PTRACE,\n                                CAP_SYS_RAWIO,\n                                CAP_SYS_RESOURCE,\n                                CAP_SYS_TIME,\n                                CAP_SYS_TTY_CONFIG,\n                                CAP_SYSLOG,\n                                CAP_WAKE_ALARM};\n\n    capng_get_caps_process();\n\n    /* Make sure we drop everything if required by the user */\n    if (policy == VIR_DOMAIN_CAPABILITIES_POLICY_DENY)\n        capng_clear(CAPNG_SELECT_BOTH);\n\n    /* Apply all single capabilities changes */\n    for (i = 0; i < VIR_DOMAIN_PROCES_CAPS_FEATURE_LAST; i++) {\n        bool toDrop = false;\n        int state = def->caps_features[i];\n\n        if (!cap_valid(capsMapping[i]))\n            continue;\n\n        switch ((virDomainCapabilitiesPolicy) policy) {\n\n        case VIR_DOMAIN_CAPABILITIES_POLICY_DENY:\n            if (state == VIR_TRISTATE_SWITCH_ON &&\n                    (ret = capng_update(CAPNG_ADD,\n                                        CAPNG_EFFECTIVE | CAPNG_PERMITTED |\n                                        CAPNG_INHERITABLE | CAPNG_BOUNDING_SET,\n                                        capsMapping[i])) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to add capability %s: %d\"),\n                               virDomainProcessCapsFeatureTypeToString(i), ret);\n                return -1;\n            }\n            break;\n\n        case VIR_DOMAIN_CAPABILITIES_POLICY_DEFAULT:\n            switch (i) {\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_SYS_BOOT: /* No use of reboot */\n                toDrop = !keepReboot && (state != VIR_TRISTATE_SWITCH_ON);\n                break;\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_SYS_MODULE: /* No kernel module loading */\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_SYS_TIME: /* No changing the clock */\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_MKNOD: /* No creating device nodes */\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_AUDIT_CONTROL: /* No messing with auditing status */\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_MAC_ADMIN: /* No messing with LSM config */\n                toDrop = (state != VIR_TRISTATE_SWITCH_ON);\n                break;\n            default: /* User specified capabilities to drop */\n                toDrop = (state == VIR_TRISTATE_SWITCH_OFF);\n            }\n            G_GNUC_FALLTHROUGH;\n\n        case VIR_DOMAIN_CAPABILITIES_POLICY_ALLOW:\n            if (policy == VIR_DOMAIN_CAPABILITIES_POLICY_ALLOW)\n                toDrop = state == VIR_TRISTATE_SWITCH_OFF;\n\n            if (toDrop && (ret = capng_update(CAPNG_DROP,\n                                              CAPNG_EFFECTIVE | CAPNG_PERMITTED |\n                                              CAPNG_INHERITABLE | CAPNG_BOUNDING_SET,\n                                              capsMapping[i])) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to remove capability %s: %d\"),\n                               virDomainProcessCapsFeatureTypeToString(i), ret);\n                return -1;\n            }\n            break;\n\n        case VIR_DOMAIN_CAPABILITIES_POLICY_LAST:\n        default:\n            virReportEnumRangeError(virDomainCapabilitiesPolicy, policy);\n            return -1;\n        }\n    }\n\n    if ((ret = capng_apply(CAPNG_SELECT_BOTH)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to apply capabilities: %d\"), ret);\n        return -1;\n    }\n\n    /* We do not need to call capng_lock() in this case. The bounding\n     * set restriction will prevent them reacquiring sys_boot/module/time,\n     * etc which is all that matters for the container. Once inside the\n     * container it is fine for SECURE_NOROOT / SECURE_NO_SETUID_FIXUP to\n     * be unmasked  - they can never escape the bounding set. */\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to apply capabilities: %d\")",
            "ret"
          ],
          "line": 2039
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to apply capabilities: %d\""
          ],
          "line": 2040
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "capng_apply",
          "args": [
            "CAPNG_SELECT_BOTH"
          ],
          "line": 2038
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportEnumRangeError",
          "args": [
            "virDomainCapabilitiesPolicy",
            "policy"
          ],
          "line": 2033
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to remove capability %s: %d\")",
            "virDomainProcessCapsFeatureTypeToString(i)",
            "ret"
          ],
          "line": 2024
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainProcessCapsFeatureTypeToString",
          "args": [
            "i"
          ],
          "line": 2026
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "capng_update",
          "args": [
            "CAPNG_DROP",
            "CAPNG_EFFECTIVE | CAPNG_PERMITTED |\n                                              CAPNG_INHERITABLE | CAPNG_BOUNDING_SET",
            "capsMapping[i]"
          ],
          "line": 2020
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Failed to add capability %s: %d\")",
            "virDomainProcessCapsFeatureTypeToString(i)",
            "ret"
          ],
          "line": 1992
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainProcessCapsFeatureTypeToString",
          "args": [
            "i"
          ],
          "line": 1994
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "capng_update",
          "args": [
            "CAPNG_ADD",
            "CAPNG_EFFECTIVE | CAPNG_PERMITTED |\n                                        CAPNG_INHERITABLE | CAPNG_BOUNDING_SET",
            "capsMapping[i]"
          ],
          "line": 1988
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "cap_valid",
          "args": [
            "capsMapping[i]"
          ],
          "line": 1981
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "capng_clear",
          "args": [
            "CAPNG_SELECT_BOTH"
          ],
          "line": 1974
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "capng_get_caps_process",
          "args": [],
          "line": 1970
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerDropCapabilities(virDomainDefPtr def,\n                                        bool keepReboot)\n{\n    int ret;\n    size_t i;\n    int policy = def->features[VIR_DOMAIN_FEATURE_CAPABILITIES];\n\n    /* Maps virDomainProcessCapsFeature to CAPS_* */\n    static int capsMapping[] = {CAP_AUDIT_CONTROL,\n                                CAP_AUDIT_WRITE,\n                                CAP_BLOCK_SUSPEND,\n                                CAP_CHOWN,\n                                CAP_DAC_OVERRIDE,\n                                CAP_DAC_READ_SEARCH,\n                                CAP_FOWNER,\n                                CAP_FSETID,\n                                CAP_IPC_LOCK,\n                                CAP_IPC_OWNER,\n                                CAP_KILL,\n                                CAP_LEASE,\n                                CAP_LINUX_IMMUTABLE,\n                                CAP_MAC_ADMIN,\n                                CAP_MAC_OVERRIDE,\n                                CAP_MKNOD,\n                                CAP_NET_ADMIN,\n                                CAP_NET_BIND_SERVICE,\n                                CAP_NET_BROADCAST,\n                                CAP_NET_RAW,\n                                CAP_SETGID,\n                                CAP_SETFCAP,\n                                CAP_SETPCAP,\n                                CAP_SETUID,\n                                CAP_SYS_ADMIN,\n                                CAP_SYS_BOOT,\n                                CAP_SYS_CHROOT,\n                                CAP_SYS_MODULE,\n                                CAP_SYS_NICE,\n                                CAP_SYS_PACCT,\n                                CAP_SYS_PTRACE,\n                                CAP_SYS_RAWIO,\n                                CAP_SYS_RESOURCE,\n                                CAP_SYS_TIME,\n                                CAP_SYS_TTY_CONFIG,\n                                CAP_SYSLOG,\n                                CAP_WAKE_ALARM};\n\n    capng_get_caps_process();\n\n    /* Make sure we drop everything if required by the user */\n    if (policy == VIR_DOMAIN_CAPABILITIES_POLICY_DENY)\n        capng_clear(CAPNG_SELECT_BOTH);\n\n    /* Apply all single capabilities changes */\n    for (i = 0; i < VIR_DOMAIN_PROCES_CAPS_FEATURE_LAST; i++) {\n        bool toDrop = false;\n        int state = def->caps_features[i];\n\n        if (!cap_valid(capsMapping[i]))\n            continue;\n\n        switch ((virDomainCapabilitiesPolicy) policy) {\n\n        case VIR_DOMAIN_CAPABILITIES_POLICY_DENY:\n            if (state == VIR_TRISTATE_SWITCH_ON &&\n                    (ret = capng_update(CAPNG_ADD,\n                                        CAPNG_EFFECTIVE | CAPNG_PERMITTED |\n                                        CAPNG_INHERITABLE | CAPNG_BOUNDING_SET,\n                                        capsMapping[i])) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to add capability %s: %d\"),\n                               virDomainProcessCapsFeatureTypeToString(i), ret);\n                return -1;\n            }\n            break;\n\n        case VIR_DOMAIN_CAPABILITIES_POLICY_DEFAULT:\n            switch (i) {\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_SYS_BOOT: /* No use of reboot */\n                toDrop = !keepReboot && (state != VIR_TRISTATE_SWITCH_ON);\n                break;\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_SYS_MODULE: /* No kernel module loading */\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_SYS_TIME: /* No changing the clock */\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_MKNOD: /* No creating device nodes */\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_AUDIT_CONTROL: /* No messing with auditing status */\n            case VIR_DOMAIN_PROCES_CAPS_FEATURE_MAC_ADMIN: /* No messing with LSM config */\n                toDrop = (state != VIR_TRISTATE_SWITCH_ON);\n                break;\n            default: /* User specified capabilities to drop */\n                toDrop = (state == VIR_TRISTATE_SWITCH_OFF);\n            }\n            G_GNUC_FALLTHROUGH;\n\n        case VIR_DOMAIN_CAPABILITIES_POLICY_ALLOW:\n            if (policy == VIR_DOMAIN_CAPABILITIES_POLICY_ALLOW)\n                toDrop = state == VIR_TRISTATE_SWITCH_OFF;\n\n            if (toDrop && (ret = capng_update(CAPNG_DROP,\n                                              CAPNG_EFFECTIVE | CAPNG_PERMITTED |\n                                              CAPNG_INHERITABLE | CAPNG_BOUNDING_SET,\n                                              capsMapping[i])) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Failed to remove capability %s: %d\"),\n                               virDomainProcessCapsFeatureTypeToString(i), ret);\n                return -1;\n            }\n            break;\n\n        case VIR_DOMAIN_CAPABILITIES_POLICY_LAST:\n        default:\n            virReportEnumRangeError(virDomainCapabilitiesPolicy, policy);\n            return -1;\n        }\n    }\n\n    if ((ret = capng_apply(CAPNG_SELECT_BOTH)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to apply capabilities: %d\"), ret);\n        return -1;\n    }\n\n    /* We do not need to call capng_lock() in this case. The bounding\n     * set restriction will prevent them reacquiring sys_boot/module/time,\n     * etc which is all that matters for the container. Once inside the\n     * container it is fine for SECURE_NOROOT / SECURE_NO_SETUID_FIXUP to\n     * be unmasked  - they can never escape the bounding set. */\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerResolveAllSymlinks",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1785-1801",
    "snippet": "static int lxcContainerResolveAllSymlinks(virDomainDefPtr vmDef)\n{\n    size_t i;\n\n    VIR_DEBUG(\"Resolving symlinks\");\n\n    for (i = 0; i < vmDef->nfss; i++) {\n        virDomainFSDefPtr fs = vmDef->fss[i];\n        /* In the first pass, be gentle as some files may\n           depend on other filesystems to be mounted */\n        if (lxcContainerResolveSymlinks(fs, true) < 0)\n            return -1;\n    }\n    VIR_DEBUG(\"Resolved all filesystem symlinks\");\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Resolved all filesystem symlinks\""
          ],
          "line": 1798
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerResolveSymlinks",
          "args": [
            "fs",
            "true"
          ],
          "line": 1795
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerResolveSymlinks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "604-645",
          "snippet": "static int lxcContainerResolveSymlinks(virDomainFSDefPtr fs, bool gentle)\n{\n    char *newroot;\n\n    if (!fs->src || !fs->src->path || fs->symlinksResolved)\n        return 0;\n\n    if (access(fs->src->path, F_OK)) {\n        if (gentle) {\n            /* Just ignore the error for the while, we'll try again later */\n            VIR_DEBUG(\"Skipped unaccessible '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to access '%s'\"), fs->src->path);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Resolving '%s'\", fs->src->path);\n    if (virFileResolveAllLinks(fs->src->path, &newroot) < 0) {\n        if (gentle) {\n            VIR_DEBUG(\"Skipped non-resolvable '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to resolve symlink at %s\"),\n                                 fs->src->path);\n        }\n        return -1;\n    }\n\n    /* Mark it resolved to skip it the next time */\n    fs->symlinksResolved = true;\n\n    VIR_DEBUG(\"Resolved '%s' to %s\", fs->src->path, newroot);\n\n    VIR_FREE(fs->src->path);\n    fs->src->path = newroot;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerResolveSymlinks(virDomainFSDefPtr fs, bool gentle)\n{\n    char *newroot;\n\n    if (!fs->src || !fs->src->path || fs->symlinksResolved)\n        return 0;\n\n    if (access(fs->src->path, F_OK)) {\n        if (gentle) {\n            /* Just ignore the error for the while, we'll try again later */\n            VIR_DEBUG(\"Skipped unaccessible '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to access '%s'\"), fs->src->path);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Resolving '%s'\", fs->src->path);\n    if (virFileResolveAllLinks(fs->src->path, &newroot) < 0) {\n        if (gentle) {\n            VIR_DEBUG(\"Skipped non-resolvable '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to resolve symlink at %s\"),\n                                 fs->src->path);\n        }\n        return -1;\n    }\n\n    /* Mark it resolved to skip it the next time */\n    fs->symlinksResolved = true;\n\n    VIR_DEBUG(\"Resolved '%s' to %s\", fs->src->path, newroot);\n\n    VIR_FREE(fs->src->path);\n    fs->src->path = newroot;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Resolving symlinks\""
          ],
          "line": 1789
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerResolveAllSymlinks(virDomainDefPtr vmDef)\n{\n    size_t i;\n\n    VIR_DEBUG(\"Resolving symlinks\");\n\n    for (i = 0; i < vmDef->nfss; i++) {\n        virDomainFSDefPtr fs = vmDef->fss[i];\n        /* In the first pass, be gentle as some files may\n           depend on other filesystems to be mounted */\n        if (lxcContainerResolveSymlinks(fs, true) < 0)\n            return -1;\n    }\n    VIR_DEBUG(\"Resolved all filesystem symlinks\");\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerSetupPivotRoot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1699-1783",
    "snippet": "static int lxcContainerSetupPivotRoot(virDomainDefPtr vmDef,\n                                      virDomainFSDefPtr root,\n                                      char **ttyPaths,\n                                      size_t nttyPaths,\n                                      virSecurityManagerPtr securityDriver)\n{\n    virCgroupPtr cgroup = NULL;\n    int ret = -1;\n    char *sec_mount_options;\n    char *stateDir = NULL;\n\n    VIR_DEBUG(\"Setup pivot root\");\n\n    if (!(sec_mount_options = virSecurityManagerGetMountOptions(securityDriver, vmDef)))\n        return -1;\n\n    /* Before pivoting we need to identify any\n     * cgroups controllers that are mounted */\n    if (virCgroupNewSelf(&cgroup) < 0)\n        goto cleanup;\n\n    if (virFileResolveAllLinks(LXC_STATE_DIR, &stateDir) < 0)\n        goto cleanup;\n\n    /* Ensure the root filesystem is mounted */\n    if (lxcContainerPrepareRoot(vmDef, root, sec_mount_options) < 0)\n        goto cleanup;\n\n    /* Gives us a private root, leaving all parent OS mounts on /.oldroot */\n    if (lxcContainerPivotRoot(root) < 0)\n        goto cleanup;\n\n    /* FIXME: we should find a way to unmount these mounts for container\n     * even user namespace is enabled. */\n    if (STREQ(root->src->path, \"/\") && (!vmDef->idmap.nuidmap) &&\n        lxcContainerUnmountForSharedRoot(stateDir, vmDef->name) < 0)\n        goto cleanup;\n\n    /* Mounts the core /proc, /sys, etc filesystems */\n    if (lxcContainerMountBasicFS(vmDef->idmap.nuidmap,\n                                 !lxcNeedNetworkNamespace(vmDef)) < 0)\n        goto cleanup;\n\n    /* Ensure entire root filesystem (except /.oldroot) is readonly */\n    if (root->readonly &&\n        lxcContainerSetReadOnly() < 0)\n        goto cleanup;\n\n    /* Mounts /proc/meminfo etc sysinfo */\n    if (lxcContainerMountProcFuse(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Now we can re-mount the cgroups controllers in the\n     * same configuration as before */\n    if (virCgroupBindMount(cgroup, \"/.oldroot/\", sec_mount_options) < 0)\n        goto cleanup;\n\n    /* Mounts /dev */\n    if (lxcContainerMountFSDev(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Mounts /dev/pts */\n    if (lxcContainerMountFSDevPTS(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Setup device nodes in /dev/ */\n    if (lxcContainerSetupDevices(ttyPaths, nttyPaths) < 0)\n        goto cleanup;\n\n    /* Sets up any non-root mounts from guest config */\n    if (lxcContainerMountAllFS(vmDef, sec_mount_options) < 0)\n        goto cleanup;\n\n   /* Gets rid of all remaining mounts from host OS, including /.oldroot itself */\n    if (lxcContainerUnmountSubtree(\"/.oldroot\", true) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(stateDir);\n    virCgroupFree(&cgroup);\n    VIR_FREE(sec_mount_options);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sec_mount_options"
          ],
          "line": 1781
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCgroupFree",
          "args": [
            "&cgroup"
          ],
          "line": 1780
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "3544-3563",
          "snippet": "void\nvirCgroupFree(virCgroupPtr *group)\n{\n    size_t i;\n\n    if (*group == NULL)\n        return;\n\n    for (i = 0; i < VIR_CGROUP_CONTROLLER_LAST; i++) {\n        VIR_FREE((*group)->legacy[i].mountPoint);\n        VIR_FREE((*group)->legacy[i].linkPoint);\n        VIR_FREE((*group)->legacy[i].placement);\n    }\n\n    VIR_FREE((*group)->unified.mountPoint);\n    VIR_FREE((*group)->unified.placement);\n\n    VIR_FREE((*group)->path);\n    VIR_FREE(*group);\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nvoid\nvirCgroupFree(virCgroupPtr *group)\n{\n    size_t i;\n\n    if (*group == NULL)\n        return;\n\n    for (i = 0; i < VIR_CGROUP_CONTROLLER_LAST; i++) {\n        VIR_FREE((*group)->legacy[i].mountPoint);\n        VIR_FREE((*group)->legacy[i].linkPoint);\n        VIR_FREE((*group)->legacy[i].placement);\n    }\n\n    VIR_FREE((*group)->unified.mountPoint);\n    VIR_FREE((*group)->unified.placement);\n\n    VIR_FREE((*group)->path);\n    VIR_FREE(*group);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "stateDir"
          ],
          "line": 1779
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerUnmountSubtree",
          "args": [
            "\"/.oldroot\"",
            "true"
          ],
          "line": 1773
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerUnmountSubtree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "551-602",
          "snippet": "static int lxcContainerUnmountSubtree(const char *prefix,\n                                      bool isOldRootFS)\n{\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n    int saveErrno;\n    const char *failedUmount = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Unmount subtree from %s\", prefix);\n\n    if (virFileGetMountReverseSubtree(\"/proc/mounts\", prefix,\n                                      &mounts, &nmounts) < 0)\n        goto cleanup;\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Umount %s\", mounts[i]);\n        if (umount(mounts[i]) < 0) {\n            failedUmount = mounts[i];\n            saveErrno = errno;\n            VIR_WARN(\"Failed to unmount '%s', trying to detach subtree '%s': %s\",\n                     failedUmount, mounts[nmounts-1],\n                     g_strerror(errno));\n            break;\n        }\n    }\n\n    if (failedUmount) {\n        /* This detaches the subtree */\n        if (umount2(mounts[nmounts-1], MNT_DETACH) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not detach subtree '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n        /* This unmounts the tmpfs on which the old root filesystem was hosted */\n        if (isOldRootFS &&\n            umount(mounts[nmounts-1]) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not unmount old root '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(mounts);\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerUnmountSubtree(const char *prefix,\n                                      bool isOldRootFS)\n{\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n    int saveErrno;\n    const char *failedUmount = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Unmount subtree from %s\", prefix);\n\n    if (virFileGetMountReverseSubtree(\"/proc/mounts\", prefix,\n                                      &mounts, &nmounts) < 0)\n        goto cleanup;\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Umount %s\", mounts[i]);\n        if (umount(mounts[i]) < 0) {\n            failedUmount = mounts[i];\n            saveErrno = errno;\n            VIR_WARN(\"Failed to unmount '%s', trying to detach subtree '%s': %s\",\n                     failedUmount, mounts[nmounts-1],\n                     g_strerror(errno));\n            break;\n        }\n    }\n\n    if (failedUmount) {\n        /* This detaches the subtree */\n        if (umount2(mounts[nmounts-1], MNT_DETACH) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not detach subtree '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n        /* This unmounts the tmpfs on which the old root filesystem was hosted */\n        if (isOldRootFS &&\n            umount(mounts[nmounts-1]) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not unmount old root '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(mounts);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerMountAllFS",
          "args": [
            "vmDef",
            "sec_mount_options"
          ],
          "line": 1769
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountAllFS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1571-1598",
          "snippet": "static int lxcContainerMountAllFS(virDomainDefPtr vmDef,\n                                  char *sec_mount_options)\n{\n    size_t i;\n    VIR_DEBUG(\"Mounting all non-root filesystems\");\n\n    /* Pull in rest of container's mounts */\n    for (i = 0; i < vmDef->nfss; i++) {\n        if (STREQ(vmDef->fss[i]->dst, \"/\"))\n            continue;\n\n        VIR_DEBUG(\"Mounting '%s' -> '%s'\", vmDef->fss[i]->src->path, vmDef->fss[i]->dst);\n\n        if (lxcContainerResolveSymlinks(vmDef->fss[i], false) < 0)\n            return -1;\n\n        if (!(vmDef->fss[i]->src && vmDef->fss[i]->src->path &&\n              STRPREFIX(vmDef->fss[i]->src->path, vmDef->fss[i]->dst)) &&\n            lxcContainerUnmountSubtree(vmDef->fss[i]->dst, false) < 0)\n            return -1;\n\n        if (lxcContainerMountFS(vmDef->fss[i], sec_mount_options) < 0)\n            return -1;\n    }\n\n    VIR_DEBUG(\"Mounted all non-root filesystems\");\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountAllFS(virDomainDefPtr vmDef,\n                                  char *sec_mount_options)\n{\n    size_t i;\n    VIR_DEBUG(\"Mounting all non-root filesystems\");\n\n    /* Pull in rest of container's mounts */\n    for (i = 0; i < vmDef->nfss; i++) {\n        if (STREQ(vmDef->fss[i]->dst, \"/\"))\n            continue;\n\n        VIR_DEBUG(\"Mounting '%s' -> '%s'\", vmDef->fss[i]->src->path, vmDef->fss[i]->dst);\n\n        if (lxcContainerResolveSymlinks(vmDef->fss[i], false) < 0)\n            return -1;\n\n        if (!(vmDef->fss[i]->src && vmDef->fss[i]->src->path &&\n              STRPREFIX(vmDef->fss[i]->src->path, vmDef->fss[i]->dst)) &&\n            lxcContainerUnmountSubtree(vmDef->fss[i]->dst, false) < 0)\n            return -1;\n\n        if (lxcContainerMountFS(vmDef->fss[i], sec_mount_options) < 0)\n            return -1;\n    }\n\n    VIR_DEBUG(\"Mounted all non-root filesystems\");\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerSetupDevices",
          "args": [
            "ttyPaths",
            "nttyPaths"
          ],
          "line": 1765
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetupDevices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1094-1136",
          "snippet": "static int lxcContainerSetupDevices(char **ttyPaths, size_t nttyPaths)\n{\n    size_t i;\n    const struct {\n        const char *src;\n        const char *dst;\n    } links[] = {\n        { \"/proc/self/fd/0\", \"/dev/stdin\" },\n        { \"/proc/self/fd/1\", \"/dev/stdout\" },\n        { \"/proc/self/fd/2\", \"/dev/stderr\" },\n        { \"/proc/self/fd\", \"/dev/fd\" },\n    };\n\n    for (i = 0; i < G_N_ELEMENTS(links); i++) {\n        if (symlink(links[i].src, links[i].dst) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to symlink device %s to %s\"),\n                                 links[i].dst, links[i].src);\n            return -1;\n        }\n    }\n\n    /* We have private devpts capability, so bind that */\n    if (virFileBindMountDevice(\"/dev/pts/ptmx\", \"/dev/ptmx\") < 0)\n        return -1;\n\n    for (i = 0; i < nttyPaths; i++) {\n        char *tty;\n        tty = g_strdup_printf(\"/dev/tty%zu\", i + 1);\n\n        if (virFileBindMountDevice(ttyPaths[i], tty) < 0) {\n            VIR_FREE(tty);\n            return -1;\n        }\n\n        VIR_FREE(tty);\n\n        if (i == 0 &&\n            virFileBindMountDevice(ttyPaths[i], \"/dev/console\") < 0)\n            return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetupDevices(char **ttyPaths, size_t nttyPaths)\n{\n    size_t i;\n    const struct {\n        const char *src;\n        const char *dst;\n    } links[] = {\n        { \"/proc/self/fd/0\", \"/dev/stdin\" },\n        { \"/proc/self/fd/1\", \"/dev/stdout\" },\n        { \"/proc/self/fd/2\", \"/dev/stderr\" },\n        { \"/proc/self/fd\", \"/dev/fd\" },\n    };\n\n    for (i = 0; i < G_N_ELEMENTS(links); i++) {\n        if (symlink(links[i].src, links[i].dst) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to symlink device %s to %s\"),\n                                 links[i].dst, links[i].src);\n            return -1;\n        }\n    }\n\n    /* We have private devpts capability, so bind that */\n    if (virFileBindMountDevice(\"/dev/pts/ptmx\", \"/dev/ptmx\") < 0)\n        return -1;\n\n    for (i = 0; i < nttyPaths; i++) {\n        char *tty;\n        tty = g_strdup_printf(\"/dev/tty%zu\", i + 1);\n\n        if (virFileBindMountDevice(ttyPaths[i], tty) < 0) {\n            VIR_FREE(tty);\n            return -1;\n        }\n\n        VIR_FREE(tty);\n\n        if (i == 0 &&\n            virFileBindMountDevice(ttyPaths[i], \"/dev/console\") < 0)\n            return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerMountFSDevPTS",
          "args": [
            "vmDef",
            "stateDir"
          ],
          "line": 1761
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountFSDevPTS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1061-1092",
          "snippet": "static int lxcContainerMountFSDevPTS(virDomainDefPtr def,\n                                     const char *stateDir)\n{\n    int ret = -1;\n    char *path = NULL;\n    int flags = def->idmap.nuidmap ? MS_BIND : MS_MOVE;\n\n    VIR_DEBUG(\"Mount /dev/pts stateDir=%s\", stateDir);\n\n    path = g_strdup_printf(\"/.oldroot/%s/%s.devpts\", stateDir, def->name);\n\n    if (virFileMakePath(\"/dev/pts\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot create /dev/pts\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Trying to %s %s to /dev/pts\", def->idmap.nuidmap ?\n              \"bind\" : \"move\", path);\n\n    if (mount(path, \"/dev/pts\", \"none\", flags, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount %s on /dev/pts\"),\n                             path);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    VIR_FREE(path);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSDevPTS(virDomainDefPtr def,\n                                     const char *stateDir)\n{\n    int ret = -1;\n    char *path = NULL;\n    int flags = def->idmap.nuidmap ? MS_BIND : MS_MOVE;\n\n    VIR_DEBUG(\"Mount /dev/pts stateDir=%s\", stateDir);\n\n    path = g_strdup_printf(\"/.oldroot/%s/%s.devpts\", stateDir, def->name);\n\n    if (virFileMakePath(\"/dev/pts\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot create /dev/pts\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Trying to %s %s to /dev/pts\", def->idmap.nuidmap ?\n              \"bind\" : \"move\", path);\n\n    if (mount(path, \"/dev/pts\", \"none\", flags, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount %s on /dev/pts\"),\n                             path);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    VIR_FREE(path);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupBindMount",
          "args": [
            "cgroup",
            "\"/.oldroot/\"",
            "sec_mount_options"
          ],
          "line": 1753
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupBindMount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "3478-3486",
          "snippet": "int\nvirCgroupBindMount(virCgroupPtr group G_GNUC_UNUSED,\n                   const char *oldroot G_GNUC_UNUSED,\n                   const char *mountopts G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nint\nvirCgroupBindMount(virCgroupPtr group G_GNUC_UNUSED,\n                   const char *oldroot G_GNUC_UNUSED,\n                   const char *mountopts G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerMountProcFuse",
          "args": [
            "vmDef",
            "stateDir"
          ],
          "line": 1748
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountProcFuse",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1020-1024",
          "snippet": "static int lxcContainerMountProcFuse(virDomainDefPtr def G_GNUC_UNUSED,\n                                     const char *stateDir G_GNUC_UNUSED)\n{\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountProcFuse(virDomainDefPtr def G_GNUC_UNUSED,\n                                     const char *stateDir G_GNUC_UNUSED)\n{\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerSetReadOnly",
          "args": [],
          "line": 1744
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerSetReadOnly",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "821-877",
          "snippet": "static int lxcContainerSetReadOnly(void)\n{\n    FILE *procmnt;\n    struct mntent mntent;\n    char mntbuf[1024];\n    int ret = -1;\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n\n    if (!(procmnt = setmntent(\"/proc/mounts\", \"r\"))) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to read /proc/mounts\"));\n        return -1;\n    }\n\n    while (getmntent_r(procmnt, &mntent, mntbuf, sizeof(mntbuf)) != NULL) {\n        char *tmp;\n        if (STREQ(mntent.mnt_dir, \"/\") ||\n            STREQ(mntent.mnt_dir, \"/.oldroot\") ||\n            STRPREFIX(mntent.mnt_dir, \"/.oldroot/\") ||\n            lxcIsBasicMountLocation(mntent.mnt_dir))\n            continue;\n\n        tmp = g_strdup(mntent.mnt_dir);\n\n        if (VIR_APPEND_ELEMENT(mounts, nmounts, tmp) < 0) {\n            VIR_FREE(tmp);\n            goto cleanup;\n        }\n    }\n\n    if (!mounts) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    qsort(mounts, nmounts, sizeof(mounts[0]),\n          virStringSortRevCompare);\n\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Bind readonly %s\", mounts[i]);\n        if (mount(mounts[i], mounts[i], \"none\", MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make mount %s readonly\"),\n                                 mounts[i]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n cleanup:\n    virStringListFreeCount(mounts, nmounts);\n    endmntent(procmnt);\n    return ret;\n\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetReadOnly(void)\n{\n    FILE *procmnt;\n    struct mntent mntent;\n    char mntbuf[1024];\n    int ret = -1;\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n\n    if (!(procmnt = setmntent(\"/proc/mounts\", \"r\"))) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to read /proc/mounts\"));\n        return -1;\n    }\n\n    while (getmntent_r(procmnt, &mntent, mntbuf, sizeof(mntbuf)) != NULL) {\n        char *tmp;\n        if (STREQ(mntent.mnt_dir, \"/\") ||\n            STREQ(mntent.mnt_dir, \"/.oldroot\") ||\n            STRPREFIX(mntent.mnt_dir, \"/.oldroot/\") ||\n            lxcIsBasicMountLocation(mntent.mnt_dir))\n            continue;\n\n        tmp = g_strdup(mntent.mnt_dir);\n\n        if (VIR_APPEND_ELEMENT(mounts, nmounts, tmp) < 0) {\n            VIR_FREE(tmp);\n            goto cleanup;\n        }\n    }\n\n    if (!mounts) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    qsort(mounts, nmounts, sizeof(mounts[0]),\n          virStringSortRevCompare);\n\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Bind readonly %s\", mounts[i]);\n        if (mount(mounts[i], mounts[i], \"none\", MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make mount %s readonly\"),\n                                 mounts[i]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n cleanup:\n    virStringListFreeCount(mounts, nmounts);\n    endmntent(procmnt);\n    return ret;\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerMountBasicFS",
          "args": [
            "vmDef->idmap.nuidmap",
            "!lxcNeedNetworkNamespace(vmDef)"
          ],
          "line": 1738
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountBasicFS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "880-994",
          "snippet": "static int lxcContainerMountBasicFS(bool userns_enabled,\n                                    bool netns_disabled)\n{\n    size_t i;\n    int rc = -1;\n    char* mnt_src = NULL;\n    int mnt_mflags;\n\n    VIR_DEBUG(\"Mounting basic filesystems\");\n\n    for (i = 0; i < G_N_ELEMENTS(lxcBasicMounts); i++) {\n        bool bindOverReadonly;\n        virLXCBasicMountInfo const *mnt = &lxcBasicMounts[i];\n\n        /* When enable userns but disable netns, kernel will\n         * forbid us doing a new fresh mount for sysfs.\n         * So we had to do a bind mount for sysfs instead.\n         */\n        if (userns_enabled && netns_disabled &&\n            STREQ(mnt->src, \"sysfs\")) {\n            mnt_src = g_strdup(\"/sys\");\n            mnt_mflags = MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY|MS_BIND;\n        } else {\n            mnt_src = g_strdup(mnt->src);\n            mnt_mflags = mnt->mflags;\n        }\n\n        VIR_DEBUG(\"Processing %s -> %s\",\n                  mnt_src, mnt->dst);\n\n        if (mnt->skipUnmounted) {\n            char *hostdir;\n            int ret;\n\n            hostdir = g_strdup_printf(\"/.oldroot%s\", mnt->dst);\n\n            ret = virFileIsMountPoint(hostdir);\n            VIR_FREE(hostdir);\n            if (ret < 0)\n                goto cleanup;\n\n            if (ret == 0) {\n                VIR_DEBUG(\"Skipping '%s' which isn't mounted in host\",\n                          mnt->dst);\n                VIR_FREE(mnt_src);\n                continue;\n            }\n        }\n\n        if (mnt->skipUserNS && userns_enabled) {\n            VIR_DEBUG(\"Skipping due to user ns enablement\");\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        /* Skip mounts with missing source without shouting: it may be a\n         * missing folder in /proc due to the absence of a kernel feature */\n        if (STRPREFIX(mnt_src, \"/\") && !virFileExists(mnt_src)) {\n            VIR_DEBUG(\"Skipping due to missing source: %s\", mnt_src);\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        if (mnt->skipNoNetns && netns_disabled) {\n            VIR_DEBUG(\"Skipping due to absence of network namespace\");\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        if (virFileMakePath(mnt->dst) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mkdir %s\"),\n                                 mnt->dst);\n            goto cleanup;\n        }\n\n        /*\n         * We can't immediately set the MS_RDONLY flag when mounting filesystems\n         * because (in at least some kernel versions) this will propagate back\n         * to the original mount in the host OS, turning it readonly too. Thus\n         * we mount the filesystem in read-write mode initially, and then do a\n         * separate read-only bind mount on top of that.\n         */\n        bindOverReadonly = !!(mnt_mflags & MS_RDONLY);\n\n        VIR_DEBUG(\"Mount %s on %s type=%s flags=0x%x\",\n                  mnt_src, mnt->dst, mnt->type, mnt_mflags & ~MS_RDONLY);\n        if (mount(mnt_src, mnt->dst, mnt->type, mnt_mflags & ~MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mount %s on %s type %s flags=0x%x\"),\n                                 mnt_src, mnt->dst, NULLSTR(mnt->type),\n                                 mnt_mflags & ~MS_RDONLY);\n            goto cleanup;\n        }\n\n        if (bindOverReadonly &&\n            mount(mnt_src, mnt->dst, \"none\",\n                  MS_BIND|MS_REMOUNT|mnt_mflags|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to re-mount %s on %s flags=0x%x\"),\n                                 mnt_src, mnt->dst,\n                                 MS_BIND|MS_REMOUNT|MS_RDONLY);\n            goto cleanup;\n        }\n\n        VIR_FREE(mnt_src);\n    }\n\n    rc = 0;\n\n cleanup:\n    VIR_FREE(mnt_src);\n    VIR_DEBUG(\"rc=%d\", rc);\n    return rc;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const virLXCBasicMountInfo lxcBasicMounts[] = {\n    { \"proc\", \"/proc\", \"proc\", MS_NOSUID|MS_NOEXEC|MS_NODEV, false, false, false },\n    { \"/proc/sys\", \"/proc/sys\", \"none\", MS_BIND|MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"/.oldroot/proc/sys/net/ipv4\", \"/proc/sys/net/ipv4\", \"none\", MS_BIND, false, false, true },\n    { \"/.oldroot/proc/sys/net/ipv6\", \"/proc/sys/net/ipv6\", \"none\", MS_BIND, false, false, true },\n    { \"sysfs\", \"/sys\", \"sysfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"securityfs\", \"/sys/kernel/security\", \"securityfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#if WITH_SELINUX\n    { SELINUX_MOUNT, SELINUX_MOUNT, \"selinuxfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#endif\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic const virLXCBasicMountInfo lxcBasicMounts[] = {\n    { \"proc\", \"/proc\", \"proc\", MS_NOSUID|MS_NOEXEC|MS_NODEV, false, false, false },\n    { \"/proc/sys\", \"/proc/sys\", \"none\", MS_BIND|MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"/.oldroot/proc/sys/net/ipv4\", \"/proc/sys/net/ipv4\", \"none\", MS_BIND, false, false, true },\n    { \"/.oldroot/proc/sys/net/ipv6\", \"/proc/sys/net/ipv6\", \"none\", MS_BIND, false, false, true },\n    { \"sysfs\", \"/sys\", \"sysfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"securityfs\", \"/sys/kernel/security\", \"securityfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#if WITH_SELINUX\n    { SELINUX_MOUNT, SELINUX_MOUNT, \"selinuxfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#endif\n};\n\nstatic int lxcContainerMountBasicFS(bool userns_enabled,\n                                    bool netns_disabled)\n{\n    size_t i;\n    int rc = -1;\n    char* mnt_src = NULL;\n    int mnt_mflags;\n\n    VIR_DEBUG(\"Mounting basic filesystems\");\n\n    for (i = 0; i < G_N_ELEMENTS(lxcBasicMounts); i++) {\n        bool bindOverReadonly;\n        virLXCBasicMountInfo const *mnt = &lxcBasicMounts[i];\n\n        /* When enable userns but disable netns, kernel will\n         * forbid us doing a new fresh mount for sysfs.\n         * So we had to do a bind mount for sysfs instead.\n         */\n        if (userns_enabled && netns_disabled &&\n            STREQ(mnt->src, \"sysfs\")) {\n            mnt_src = g_strdup(\"/sys\");\n            mnt_mflags = MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY|MS_BIND;\n        } else {\n            mnt_src = g_strdup(mnt->src);\n            mnt_mflags = mnt->mflags;\n        }\n\n        VIR_DEBUG(\"Processing %s -> %s\",\n                  mnt_src, mnt->dst);\n\n        if (mnt->skipUnmounted) {\n            char *hostdir;\n            int ret;\n\n            hostdir = g_strdup_printf(\"/.oldroot%s\", mnt->dst);\n\n            ret = virFileIsMountPoint(hostdir);\n            VIR_FREE(hostdir);\n            if (ret < 0)\n                goto cleanup;\n\n            if (ret == 0) {\n                VIR_DEBUG(\"Skipping '%s' which isn't mounted in host\",\n                          mnt->dst);\n                VIR_FREE(mnt_src);\n                continue;\n            }\n        }\n\n        if (mnt->skipUserNS && userns_enabled) {\n            VIR_DEBUG(\"Skipping due to user ns enablement\");\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        /* Skip mounts with missing source without shouting: it may be a\n         * missing folder in /proc due to the absence of a kernel feature */\n        if (STRPREFIX(mnt_src, \"/\") && !virFileExists(mnt_src)) {\n            VIR_DEBUG(\"Skipping due to missing source: %s\", mnt_src);\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        if (mnt->skipNoNetns && netns_disabled) {\n            VIR_DEBUG(\"Skipping due to absence of network namespace\");\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        if (virFileMakePath(mnt->dst) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mkdir %s\"),\n                                 mnt->dst);\n            goto cleanup;\n        }\n\n        /*\n         * We can't immediately set the MS_RDONLY flag when mounting filesystems\n         * because (in at least some kernel versions) this will propagate back\n         * to the original mount in the host OS, turning it readonly too. Thus\n         * we mount the filesystem in read-write mode initially, and then do a\n         * separate read-only bind mount on top of that.\n         */\n        bindOverReadonly = !!(mnt_mflags & MS_RDONLY);\n\n        VIR_DEBUG(\"Mount %s on %s type=%s flags=0x%x\",\n                  mnt_src, mnt->dst, mnt->type, mnt_mflags & ~MS_RDONLY);\n        if (mount(mnt_src, mnt->dst, mnt->type, mnt_mflags & ~MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mount %s on %s type %s flags=0x%x\"),\n                                 mnt_src, mnt->dst, NULLSTR(mnt->type),\n                                 mnt_mflags & ~MS_RDONLY);\n            goto cleanup;\n        }\n\n        if (bindOverReadonly &&\n            mount(mnt_src, mnt->dst, \"none\",\n                  MS_BIND|MS_REMOUNT|mnt_mflags|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to re-mount %s on %s flags=0x%x\"),\n                                 mnt_src, mnt->dst,\n                                 MS_BIND|MS_REMOUNT|MS_RDONLY);\n            goto cleanup;\n        }\n\n        VIR_FREE(mnt_src);\n    }\n\n    rc = 0;\n\n cleanup:\n    VIR_FREE(mnt_src);\n    VIR_DEBUG(\"rc=%d\", rc);\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcNeedNetworkNamespace",
          "args": [
            "vmDef"
          ],
          "line": 1739
        },
        "resolved": true,
        "details": {
          "function_name": "lxcNeedNetworkNamespace",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1678-1692",
          "snippet": "static bool\nlxcNeedNetworkNamespace(virDomainDefPtr def)\n{\n    size_t i;\n    if (def->nets != NULL)\n        return true;\n    if (def->features[VIR_DOMAIN_FEATURE_PRIVNET] == VIR_TRISTATE_SWITCH_ON)\n        return true;\n    for (i = 0; i < def->nhostdevs; i++) {\n        if (def->hostdevs[i]->mode == VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES &&\n            def->hostdevs[i]->source.caps.type == VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            return true;\n    }\n    return false;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic bool\nlxcNeedNetworkNamespace(virDomainDefPtr def)\n{\n    size_t i;\n    if (def->nets != NULL)\n        return true;\n    if (def->features[VIR_DOMAIN_FEATURE_PRIVNET] == VIR_TRISTATE_SWITCH_ON)\n        return true;\n    for (i = 0; i < def->nhostdevs; i++) {\n        if (def->hostdevs[i]->mode == VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES &&\n            def->hostdevs[i]->source.caps.type == VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            return true;\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerUnmountForSharedRoot",
          "args": [
            "stateDir",
            "vmDef->name"
          ],
          "line": 1734
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerUnmountForSharedRoot",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1626-1675",
          "snippet": "static int lxcContainerUnmountForSharedRoot(const char *stateDir,\n                                            const char *domain)\n{\n    int ret = -1;\n    char *tmp = NULL;\n\n#if WITH_SELINUX\n    /* Some versions of Linux kernel don't let you overmount\n     * the selinux filesystem, so make sure we kill it first\n     */\n    if (lxcContainerUnmountSubtree(SELINUX_MOUNT, false) < 0)\n        goto cleanup;\n#endif\n\n    /* These filesystems are created by libvirt temporarily, they\n     * shouldn't appear in container. */\n    tmp = g_strdup_printf(\"%s/%s.dev\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n\n    VIR_FREE(tmp);\n    tmp = g_strdup_printf(\"%s/%s.devpts\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n\n#if WITH_FUSE\n    VIR_FREE(tmp);\n    tmp = g_strdup_printf(\"%s/%s.fuse\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n#endif\n\n    /* If we have the root source being '/', then we need to\n     * get rid of any existing stuff under /proc, /sys & /tmp.\n     * We need new namespace aware versions of those. We must\n     * do /proc last otherwise we won't find /proc/mounts :-) */\n    if (lxcContainerUnmountSubtree(\"/sys\", false) < 0 ||\n        lxcContainerUnmountSubtree(\"/dev\", false) < 0 ||\n        lxcContainerUnmountSubtree(\"/proc\", false) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(tmp);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerUnmountForSharedRoot(const char *stateDir,\n                                            const char *domain)\n{\n    int ret = -1;\n    char *tmp = NULL;\n\n#if WITH_SELINUX\n    /* Some versions of Linux kernel don't let you overmount\n     * the selinux filesystem, so make sure we kill it first\n     */\n    if (lxcContainerUnmountSubtree(SELINUX_MOUNT, false) < 0)\n        goto cleanup;\n#endif\n\n    /* These filesystems are created by libvirt temporarily, they\n     * shouldn't appear in container. */\n    tmp = g_strdup_printf(\"%s/%s.dev\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n\n    VIR_FREE(tmp);\n    tmp = g_strdup_printf(\"%s/%s.devpts\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n\n#if WITH_FUSE\n    VIR_FREE(tmp);\n    tmp = g_strdup_printf(\"%s/%s.fuse\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n#endif\n\n    /* If we have the root source being '/', then we need to\n     * get rid of any existing stuff under /proc, /sys & /tmp.\n     * We need new namespace aware versions of those. We must\n     * do /proc last otherwise we won't find /proc/mounts :-) */\n    if (lxcContainerUnmountSubtree(\"/sys\", false) < 0 ||\n        lxcContainerUnmountSubtree(\"/dev\", false) < 0 ||\n        lxcContainerUnmountSubtree(\"/proc\", false) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(tmp);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "root->src->path",
            "\"/\""
          ],
          "line": 1733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerPivotRoot",
          "args": [
            "root"
          ],
          "line": 1728
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerPivotRoot",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "694-782",
          "snippet": "static int lxcContainerPivotRoot(virDomainFSDefPtr root)\n{\n    int ret;\n    char *oldroot = NULL, *newroot = NULL;\n\n    ret = -1;\n\n    VIR_DEBUG(\"Pivot via %s\", root->src->path);\n\n    /* root->parent must be private, so make / private. */\n    if (mount(\"\", \"/\", \"none\", MS_PRIVATE|MS_REC, NULL) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to make root private\"));\n        goto err;\n    }\n\n    oldroot = g_strdup_printf(\"%s/.oldroot\", root->src->path);\n\n    if (virFileMakePath(oldroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             oldroot);\n        goto err;\n    }\n\n    /* Create a tmpfs root since old and new roots must be\n     * on separate filesystems */\n    if (mount(\"tmprootfs\", oldroot, \"tmpfs\", 0, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount empty tmpfs at %s\"),\n                             oldroot);\n        goto err;\n    }\n\n    /* Create a directory called 'new' in tmpfs */\n    newroot = g_strdup_printf(\"%s/new\", oldroot);\n\n    if (virFileMakePath(newroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             newroot);\n        goto err;\n    }\n\n    /* ... and mount our root onto it */\n    if (mount(root->src->path, newroot, \"none\", MS_BIND|MS_REC, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to bind %s to new root %s\"),\n                             root->src->path, newroot);\n        goto err;\n    }\n\n    if (root->readonly) {\n        if (mount(root->src->path, newroot, \"none\", MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make new root %s readonly\"),\n                                 root->src->path);\n            goto err;\n        }\n    }\n\n    /* Now we chdir into the tmpfs, then pivot into the\n     * root->src bind-mounted onto '/new' */\n    if (chdir(newroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to chdir into %s\"), newroot);\n        goto err;\n    }\n\n    /* The old root directory will live at /.oldroot after\n     * this and will soon be unmounted completely */\n    if (pivot_root(\".\", \".oldroot\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to pivot root\"));\n        goto err;\n    }\n\n    /* CWD is undefined after pivot_root, so go to / */\n    if (chdir(\"/\") < 0)\n        goto err;\n\n    ret = 0;\n\n err:\n    VIR_FREE(oldroot);\n    VIR_FREE(newroot);\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerPivotRoot(virDomainFSDefPtr root)\n{\n    int ret;\n    char *oldroot = NULL, *newroot = NULL;\n\n    ret = -1;\n\n    VIR_DEBUG(\"Pivot via %s\", root->src->path);\n\n    /* root->parent must be private, so make / private. */\n    if (mount(\"\", \"/\", \"none\", MS_PRIVATE|MS_REC, NULL) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to make root private\"));\n        goto err;\n    }\n\n    oldroot = g_strdup_printf(\"%s/.oldroot\", root->src->path);\n\n    if (virFileMakePath(oldroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             oldroot);\n        goto err;\n    }\n\n    /* Create a tmpfs root since old and new roots must be\n     * on separate filesystems */\n    if (mount(\"tmprootfs\", oldroot, \"tmpfs\", 0, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount empty tmpfs at %s\"),\n                             oldroot);\n        goto err;\n    }\n\n    /* Create a directory called 'new' in tmpfs */\n    newroot = g_strdup_printf(\"%s/new\", oldroot);\n\n    if (virFileMakePath(newroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             newroot);\n        goto err;\n    }\n\n    /* ... and mount our root onto it */\n    if (mount(root->src->path, newroot, \"none\", MS_BIND|MS_REC, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to bind %s to new root %s\"),\n                             root->src->path, newroot);\n        goto err;\n    }\n\n    if (root->readonly) {\n        if (mount(root->src->path, newroot, \"none\", MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make new root %s readonly\"),\n                                 root->src->path);\n            goto err;\n        }\n    }\n\n    /* Now we chdir into the tmpfs, then pivot into the\n     * root->src bind-mounted onto '/new' */\n    if (chdir(newroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to chdir into %s\"), newroot);\n        goto err;\n    }\n\n    /* The old root directory will live at /.oldroot after\n     * this and will soon be unmounted completely */\n    if (pivot_root(\".\", \".oldroot\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to pivot root\"));\n        goto err;\n    }\n\n    /* CWD is undefined after pivot_root, so go to / */\n    if (chdir(\"/\") < 0)\n        goto err;\n\n    ret = 0;\n\n err:\n    VIR_FREE(oldroot);\n    VIR_FREE(newroot);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerPrepareRoot",
          "args": [
            "vmDef",
            "root",
            "sec_mount_options"
          ],
          "line": 1724
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerPrepareRoot",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "647-692",
          "snippet": "static int lxcContainerPrepareRoot(virDomainDefPtr def,\n                                   virDomainFSDefPtr root,\n                                   const char *sec_mount_options)\n{\n    char *dst;\n    char *tmp;\n\n    VIR_DEBUG(\"Prepare root %d\", root->type);\n\n    if (root->type == VIR_DOMAIN_FS_TYPE_MOUNT)\n        return 0;\n\n    if (root->type == VIR_DOMAIN_FS_TYPE_FILE) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unexpected root filesystem without loop device\"));\n        return -1;\n    }\n\n    if (root->type != VIR_DOMAIN_FS_TYPE_BLOCK) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported root filesystem type %s\"),\n                       virDomainFSTypeToString(root->type));\n        return -1;\n    }\n\n    if (lxcContainerResolveSymlinks(root, false) < 0)\n        return -1;\n\n    dst = g_strdup_printf(\"%s/%s.root\", LXC_STATE_DIR, def->name);\n\n    tmp = root->dst;\n    root->dst = dst;\n\n    if (lxcContainerMountFSBlock(root, \"\", sec_mount_options) < 0) {\n        root->dst = tmp;\n        VIR_FREE(dst);\n        return -1;\n    }\n\n    root->dst = tmp;\n    root->type = VIR_DOMAIN_FS_TYPE_MOUNT;\n    VIR_FREE(root->src->path);\n    root->src->path = dst;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerPrepareRoot(virDomainDefPtr def,\n                                   virDomainFSDefPtr root,\n                                   const char *sec_mount_options)\n{\n    char *dst;\n    char *tmp;\n\n    VIR_DEBUG(\"Prepare root %d\", root->type);\n\n    if (root->type == VIR_DOMAIN_FS_TYPE_MOUNT)\n        return 0;\n\n    if (root->type == VIR_DOMAIN_FS_TYPE_FILE) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unexpected root filesystem without loop device\"));\n        return -1;\n    }\n\n    if (root->type != VIR_DOMAIN_FS_TYPE_BLOCK) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported root filesystem type %s\"),\n                       virDomainFSTypeToString(root->type));\n        return -1;\n    }\n\n    if (lxcContainerResolveSymlinks(root, false) < 0)\n        return -1;\n\n    dst = g_strdup_printf(\"%s/%s.root\", LXC_STATE_DIR, def->name);\n\n    tmp = root->dst;\n    root->dst = dst;\n\n    if (lxcContainerMountFSBlock(root, \"\", sec_mount_options) < 0) {\n        root->dst = tmp;\n        VIR_FREE(dst);\n        return -1;\n    }\n\n    root->dst = tmp;\n    root->type = VIR_DOMAIN_FS_TYPE_MOUNT;\n    VIR_FREE(root->src->path);\n    root->src->path = dst;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileResolveAllLinks",
          "args": [
            "LXC_STATE_DIR",
            "&stateDir"
          ],
          "line": 1720
        },
        "resolved": true,
        "details": {
          "function_name": "virFileResolveAllLinks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1622-1626",
          "snippet": "int\nvirFileResolveAllLinks(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, true, resultpath);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileResolveAllLinks(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, true, resultpath);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCgroupNewSelf",
          "args": [
            "&cgroup"
          ],
          "line": 1717
        },
        "resolved": true,
        "details": {
          "function_name": "virCgroupNewSelf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircgroup.c",
          "lines": "2803-2809",
          "snippet": "int\nvirCgroupNewSelf(virCgroupPtr *group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virthread.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virsystemd.h\"",
            "#include \"virstring.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"vircgroupbackend.h\"",
            "#include \"viralloc.h\"",
            "#include \"virutil.h\"",
            "#include \"vircgrouppriv.h\"",
            "# include <unistd.h>",
            "# include <dirent.h>",
            "# include <signal.h>",
            "# include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <sys/stat.h>",
            "# include <fcntl.h>",
            "# include <sys/mount.h>",
            "# include <mntent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthread.h\"\n#include \"virhostcpu.h\"\n#include \"virtypedparam.h\"\n#include \"virsystemd.h\"\n#include \"virstring.h\"\n#include \"virhashcode.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"vircgroupbackend.h\"\n#include \"viralloc.h\"\n#include \"virutil.h\"\n#include \"vircgrouppriv.h\"\n# include <unistd.h>\n# include <dirent.h>\n# include <signal.h>\n# include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <sys/stat.h>\n# include <fcntl.h>\n# include <sys/mount.h>\n# include <mntent.h>\n#include <config.h>\n\nint\nvirCgroupNewSelf(virCgroupPtr *group G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Control groups not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecurityManagerGetMountOptions",
          "args": [
            "securityDriver",
            "vmDef"
          ],
          "line": 1712
        },
        "resolved": true,
        "details": {
          "function_name": "virSecurityManagerGetMountOptions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_manager.c",
          "lines": "1014-1028",
          "snippet": "char *\nvirSecurityManagerGetMountOptions(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm)\n{\n    if (mgr->drv->domainGetSecurityMountOptions) {\n        char *ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainGetSecurityMountOptions(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return NULL;\n}",
          "includes": [
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virobject.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"security_dac.h\"",
            "#include \"security_stack.h\"",
            "#include \"security_driver.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virobject.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"security_dac.h\"\n#include \"security_stack.h\"\n#include \"security_driver.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nchar *\nvirSecurityManagerGetMountOptions(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr vm)\n{\n    if (mgr->drv->domainGetSecurityMountOptions) {\n        char *ret;\n        virObjectLock(mgr);\n        ret = mgr->drv->domainGetSecurityMountOptions(mgr, vm);\n        virObjectUnlock(mgr);\n        return ret;\n    }\n\n    virReportUnsupportedError();\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setup pivot root\""
          ],
          "line": 1710
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerSetupPivotRoot(virDomainDefPtr vmDef,\n                                      virDomainFSDefPtr root,\n                                      char **ttyPaths,\n                                      size_t nttyPaths,\n                                      virSecurityManagerPtr securityDriver)\n{\n    virCgroupPtr cgroup = NULL;\n    int ret = -1;\n    char *sec_mount_options;\n    char *stateDir = NULL;\n\n    VIR_DEBUG(\"Setup pivot root\");\n\n    if (!(sec_mount_options = virSecurityManagerGetMountOptions(securityDriver, vmDef)))\n        return -1;\n\n    /* Before pivoting we need to identify any\n     * cgroups controllers that are mounted */\n    if (virCgroupNewSelf(&cgroup) < 0)\n        goto cleanup;\n\n    if (virFileResolveAllLinks(LXC_STATE_DIR, &stateDir) < 0)\n        goto cleanup;\n\n    /* Ensure the root filesystem is mounted */\n    if (lxcContainerPrepareRoot(vmDef, root, sec_mount_options) < 0)\n        goto cleanup;\n\n    /* Gives us a private root, leaving all parent OS mounts on /.oldroot */\n    if (lxcContainerPivotRoot(root) < 0)\n        goto cleanup;\n\n    /* FIXME: we should find a way to unmount these mounts for container\n     * even user namespace is enabled. */\n    if (STREQ(root->src->path, \"/\") && (!vmDef->idmap.nuidmap) &&\n        lxcContainerUnmountForSharedRoot(stateDir, vmDef->name) < 0)\n        goto cleanup;\n\n    /* Mounts the core /proc, /sys, etc filesystems */\n    if (lxcContainerMountBasicFS(vmDef->idmap.nuidmap,\n                                 !lxcNeedNetworkNamespace(vmDef)) < 0)\n        goto cleanup;\n\n    /* Ensure entire root filesystem (except /.oldroot) is readonly */\n    if (root->readonly &&\n        lxcContainerSetReadOnly() < 0)\n        goto cleanup;\n\n    /* Mounts /proc/meminfo etc sysinfo */\n    if (lxcContainerMountProcFuse(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Now we can re-mount the cgroups controllers in the\n     * same configuration as before */\n    if (virCgroupBindMount(cgroup, \"/.oldroot/\", sec_mount_options) < 0)\n        goto cleanup;\n\n    /* Mounts /dev */\n    if (lxcContainerMountFSDev(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Mounts /dev/pts */\n    if (lxcContainerMountFSDevPTS(vmDef, stateDir) < 0)\n        goto cleanup;\n\n    /* Setup device nodes in /dev/ */\n    if (lxcContainerSetupDevices(ttyPaths, nttyPaths) < 0)\n        goto cleanup;\n\n    /* Sets up any non-root mounts from guest config */\n    if (lxcContainerMountAllFS(vmDef, sec_mount_options) < 0)\n        goto cleanup;\n\n   /* Gets rid of all remaining mounts from host OS, including /.oldroot itself */\n    if (lxcContainerUnmountSubtree(\"/.oldroot\", true) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(stateDir);\n    virCgroupFree(&cgroup);\n    VIR_FREE(sec_mount_options);\n    return ret;\n}"
  },
  {
    "function_name": "lxcNeedNetworkNamespace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1678-1692",
    "snippet": "static bool\nlxcNeedNetworkNamespace(virDomainDefPtr def)\n{\n    size_t i;\n    if (def->nets != NULL)\n        return true;\n    if (def->features[VIR_DOMAIN_FEATURE_PRIVNET] == VIR_TRISTATE_SWITCH_ON)\n        return true;\n    for (i = 0; i < def->nhostdevs; i++) {\n        if (def->hostdevs[i]->mode == VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES &&\n            def->hostdevs[i]->source.caps.type == VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            return true;\n    }\n    return false;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic bool\nlxcNeedNetworkNamespace(virDomainDefPtr def)\n{\n    size_t i;\n    if (def->nets != NULL)\n        return true;\n    if (def->features[VIR_DOMAIN_FEATURE_PRIVNET] == VIR_TRISTATE_SWITCH_ON)\n        return true;\n    for (i = 0; i < def->nhostdevs; i++) {\n        if (def->hostdevs[i]->mode == VIR_DOMAIN_HOSTDEV_MODE_CAPABILITIES &&\n            def->hostdevs[i]->source.caps.type == VIR_DOMAIN_HOSTDEV_CAPS_TYPE_NET)\n            return true;\n    }\n    return false;\n}"
  },
  {
    "function_name": "lxcContainerUnmountForSharedRoot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1626-1675",
    "snippet": "static int lxcContainerUnmountForSharedRoot(const char *stateDir,\n                                            const char *domain)\n{\n    int ret = -1;\n    char *tmp = NULL;\n\n#if WITH_SELINUX\n    /* Some versions of Linux kernel don't let you overmount\n     * the selinux filesystem, so make sure we kill it first\n     */\n    if (lxcContainerUnmountSubtree(SELINUX_MOUNT, false) < 0)\n        goto cleanup;\n#endif\n\n    /* These filesystems are created by libvirt temporarily, they\n     * shouldn't appear in container. */\n    tmp = g_strdup_printf(\"%s/%s.dev\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n\n    VIR_FREE(tmp);\n    tmp = g_strdup_printf(\"%s/%s.devpts\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n\n#if WITH_FUSE\n    VIR_FREE(tmp);\n    tmp = g_strdup_printf(\"%s/%s.fuse\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n#endif\n\n    /* If we have the root source being '/', then we need to\n     * get rid of any existing stuff under /proc, /sys & /tmp.\n     * We need new namespace aware versions of those. We must\n     * do /proc last otherwise we won't find /proc/mounts :-) */\n    if (lxcContainerUnmountSubtree(\"/sys\", false) < 0 ||\n        lxcContainerUnmountSubtree(\"/dev\", false) < 0 ||\n        lxcContainerUnmountSubtree(\"/proc\", false) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(tmp);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 1673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerUnmountSubtree",
          "args": [
            "\"/proc\"",
            "false"
          ],
          "line": 1667
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerUnmountSubtree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "551-602",
          "snippet": "static int lxcContainerUnmountSubtree(const char *prefix,\n                                      bool isOldRootFS)\n{\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n    int saveErrno;\n    const char *failedUmount = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Unmount subtree from %s\", prefix);\n\n    if (virFileGetMountReverseSubtree(\"/proc/mounts\", prefix,\n                                      &mounts, &nmounts) < 0)\n        goto cleanup;\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Umount %s\", mounts[i]);\n        if (umount(mounts[i]) < 0) {\n            failedUmount = mounts[i];\n            saveErrno = errno;\n            VIR_WARN(\"Failed to unmount '%s', trying to detach subtree '%s': %s\",\n                     failedUmount, mounts[nmounts-1],\n                     g_strerror(errno));\n            break;\n        }\n    }\n\n    if (failedUmount) {\n        /* This detaches the subtree */\n        if (umount2(mounts[nmounts-1], MNT_DETACH) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not detach subtree '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n        /* This unmounts the tmpfs on which the old root filesystem was hosted */\n        if (isOldRootFS &&\n            umount(mounts[nmounts-1]) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not unmount old root '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(mounts);\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerUnmountSubtree(const char *prefix,\n                                      bool isOldRootFS)\n{\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n    int saveErrno;\n    const char *failedUmount = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Unmount subtree from %s\", prefix);\n\n    if (virFileGetMountReverseSubtree(\"/proc/mounts\", prefix,\n                                      &mounts, &nmounts) < 0)\n        goto cleanup;\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Umount %s\", mounts[i]);\n        if (umount(mounts[i]) < 0) {\n            failedUmount = mounts[i];\n            saveErrno = errno;\n            VIR_WARN(\"Failed to unmount '%s', trying to detach subtree '%s': %s\",\n                     failedUmount, mounts[nmounts-1],\n                     g_strerror(errno));\n            break;\n        }\n    }\n\n    if (failedUmount) {\n        /* This detaches the subtree */\n        if (umount2(mounts[nmounts-1], MNT_DETACH) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not detach subtree '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n        /* This unmounts the tmpfs on which the old root filesystem was hosted */\n        if (isOldRootFS &&\n            umount(mounts[nmounts-1]) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not unmount old root '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(mounts);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s.fuse\"",
            "stateDir",
            "domain"
          ],
          "line": 1655
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 1654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 1647
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerUnmountForSharedRoot(const char *stateDir,\n                                            const char *domain)\n{\n    int ret = -1;\n    char *tmp = NULL;\n\n#if WITH_SELINUX\n    /* Some versions of Linux kernel don't let you overmount\n     * the selinux filesystem, so make sure we kill it first\n     */\n    if (lxcContainerUnmountSubtree(SELINUX_MOUNT, false) < 0)\n        goto cleanup;\n#endif\n\n    /* These filesystems are created by libvirt temporarily, they\n     * shouldn't appear in container. */\n    tmp = g_strdup_printf(\"%s/%s.dev\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n\n    VIR_FREE(tmp);\n    tmp = g_strdup_printf(\"%s/%s.devpts\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n\n#if WITH_FUSE\n    VIR_FREE(tmp);\n    tmp = g_strdup_printf(\"%s/%s.fuse\", stateDir, domain);\n\n    if (lxcContainerUnmountSubtree(tmp, false) < 0)\n        goto cleanup;\n#endif\n\n    /* If we have the root source being '/', then we need to\n     * get rid of any existing stuff under /proc, /sys & /tmp.\n     * We need new namespace aware versions of those. We must\n     * do /proc last otherwise we won't find /proc/mounts :-) */\n    if (lxcContainerUnmountSubtree(\"/sys\", false) < 0 ||\n        lxcContainerUnmountSubtree(\"/dev\", false) < 0 ||\n        lxcContainerUnmountSubtree(\"/proc\", false) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(tmp);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerSetupHostdevCapsMakePath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1601-1623",
    "snippet": "int lxcContainerSetupHostdevCapsMakePath(const char *dev)\n{\n    int ret = -1;\n    char *dir, *tmp;\n\n    dir = g_strdup(dev);\n\n    if ((tmp = strrchr(dir, '/'))) {\n        *tmp = '\\0';\n        if (virFileMakePath(dir) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to create directory for '%s' dev '%s'\"),\n                                 dir, dev);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(dir);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dir"
          ],
          "line": 1621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to create directory for '%s' dev '%s'\")",
            "dir",
            "dev"
          ],
          "line": 1611
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to create directory for '%s' dev '%s'\""
          ],
          "line": 1612
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "dir"
          ],
          "line": 1610
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "dir",
            "'/'"
          ],
          "line": 1608
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "dev"
          ],
          "line": 1606
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nint lxcContainerSetupHostdevCapsMakePath(const char *dev)\n{\n    int ret = -1;\n    char *dir, *tmp;\n\n    dir = g_strdup(dev);\n\n    if ((tmp = strrchr(dir, '/'))) {\n        *tmp = '\\0';\n        if (virFileMakePath(dir) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to create directory for '%s' dev '%s'\"),\n                                 dir, dev);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(dir);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountAllFS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1571-1598",
    "snippet": "static int lxcContainerMountAllFS(virDomainDefPtr vmDef,\n                                  char *sec_mount_options)\n{\n    size_t i;\n    VIR_DEBUG(\"Mounting all non-root filesystems\");\n\n    /* Pull in rest of container's mounts */\n    for (i = 0; i < vmDef->nfss; i++) {\n        if (STREQ(vmDef->fss[i]->dst, \"/\"))\n            continue;\n\n        VIR_DEBUG(\"Mounting '%s' -> '%s'\", vmDef->fss[i]->src->path, vmDef->fss[i]->dst);\n\n        if (lxcContainerResolveSymlinks(vmDef->fss[i], false) < 0)\n            return -1;\n\n        if (!(vmDef->fss[i]->src && vmDef->fss[i]->src->path &&\n              STRPREFIX(vmDef->fss[i]->src->path, vmDef->fss[i]->dst)) &&\n            lxcContainerUnmountSubtree(vmDef->fss[i]->dst, false) < 0)\n            return -1;\n\n        if (lxcContainerMountFS(vmDef->fss[i], sec_mount_options) < 0)\n            return -1;\n    }\n\n    VIR_DEBUG(\"Mounted all non-root filesystems\");\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mounted all non-root filesystems\""
          ],
          "line": 1596
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerMountFS",
          "args": [
            "vmDef->fss[i]",
            "sec_mount_options"
          ],
          "line": 1592
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountFS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1533-1568",
          "snippet": "static int lxcContainerMountFS(virDomainFSDefPtr fs,\n                               char *sec_mount_options)\n{\n    switch (fs->type) {\n    case VIR_DOMAIN_FS_TYPE_MOUNT:\n        if (lxcContainerMountFSBind(fs, \"/.oldroot\") < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_BLOCK:\n        if (lxcContainerMountFSBlock(fs, \"/.oldroot\", sec_mount_options) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_RAM:\n        if (lxcContainerMountFSTmpfs(fs, sec_mount_options) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_BIND:\n        if (lxcContainerMountFSBind(fs, \"\") < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_FILE:\n        /* We do actually support this, but the lxc controller\n         * should have associated the file with a loopback\n         * device and changed this to TYPE_BLOCK for us */\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected filesystem type %s\"),\n                       virDomainFSTypeToString(fs->type));\n        return -1;\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Cannot mount filesystem type %s\"),\n                       virDomainFSTypeToString(fs->type));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFS(virDomainFSDefPtr fs,\n                               char *sec_mount_options)\n{\n    switch (fs->type) {\n    case VIR_DOMAIN_FS_TYPE_MOUNT:\n        if (lxcContainerMountFSBind(fs, \"/.oldroot\") < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_BLOCK:\n        if (lxcContainerMountFSBlock(fs, \"/.oldroot\", sec_mount_options) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_RAM:\n        if (lxcContainerMountFSTmpfs(fs, sec_mount_options) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_BIND:\n        if (lxcContainerMountFSBind(fs, \"\") < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_FILE:\n        /* We do actually support this, but the lxc controller\n         * should have associated the file with a loopback\n         * device and changed this to TYPE_BLOCK for us */\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected filesystem type %s\"),\n                       virDomainFSTypeToString(fs->type));\n        return -1;\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Cannot mount filesystem type %s\"),\n                       virDomainFSTypeToString(fs->type));\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerUnmountSubtree",
          "args": [
            "vmDef->fss[i]->dst",
            "false"
          ],
          "line": 1589
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerUnmountSubtree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "551-602",
          "snippet": "static int lxcContainerUnmountSubtree(const char *prefix,\n                                      bool isOldRootFS)\n{\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n    int saveErrno;\n    const char *failedUmount = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Unmount subtree from %s\", prefix);\n\n    if (virFileGetMountReverseSubtree(\"/proc/mounts\", prefix,\n                                      &mounts, &nmounts) < 0)\n        goto cleanup;\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Umount %s\", mounts[i]);\n        if (umount(mounts[i]) < 0) {\n            failedUmount = mounts[i];\n            saveErrno = errno;\n            VIR_WARN(\"Failed to unmount '%s', trying to detach subtree '%s': %s\",\n                     failedUmount, mounts[nmounts-1],\n                     g_strerror(errno));\n            break;\n        }\n    }\n\n    if (failedUmount) {\n        /* This detaches the subtree */\n        if (umount2(mounts[nmounts-1], MNT_DETACH) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not detach subtree '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n        /* This unmounts the tmpfs on which the old root filesystem was hosted */\n        if (isOldRootFS &&\n            umount(mounts[nmounts-1]) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not unmount old root '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(mounts);\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerUnmountSubtree(const char *prefix,\n                                      bool isOldRootFS)\n{\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n    int saveErrno;\n    const char *failedUmount = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Unmount subtree from %s\", prefix);\n\n    if (virFileGetMountReverseSubtree(\"/proc/mounts\", prefix,\n                                      &mounts, &nmounts) < 0)\n        goto cleanup;\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Umount %s\", mounts[i]);\n        if (umount(mounts[i]) < 0) {\n            failedUmount = mounts[i];\n            saveErrno = errno;\n            VIR_WARN(\"Failed to unmount '%s', trying to detach subtree '%s': %s\",\n                     failedUmount, mounts[nmounts-1],\n                     g_strerror(errno));\n            break;\n        }\n    }\n\n    if (failedUmount) {\n        /* This detaches the subtree */\n        if (umount2(mounts[nmounts-1], MNT_DETACH) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not detach subtree '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n        /* This unmounts the tmpfs on which the old root filesystem was hosted */\n        if (isOldRootFS &&\n            umount(mounts[nmounts-1]) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not unmount old root '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(mounts);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "vmDef->fss[i]->src->path",
            "vmDef->fss[i]->dst"
          ],
          "line": 1588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerResolveSymlinks",
          "args": [
            "vmDef->fss[i]",
            "false"
          ],
          "line": 1584
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerResolveSymlinks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "604-645",
          "snippet": "static int lxcContainerResolveSymlinks(virDomainFSDefPtr fs, bool gentle)\n{\n    char *newroot;\n\n    if (!fs->src || !fs->src->path || fs->symlinksResolved)\n        return 0;\n\n    if (access(fs->src->path, F_OK)) {\n        if (gentle) {\n            /* Just ignore the error for the while, we'll try again later */\n            VIR_DEBUG(\"Skipped unaccessible '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to access '%s'\"), fs->src->path);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Resolving '%s'\", fs->src->path);\n    if (virFileResolveAllLinks(fs->src->path, &newroot) < 0) {\n        if (gentle) {\n            VIR_DEBUG(\"Skipped non-resolvable '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to resolve symlink at %s\"),\n                                 fs->src->path);\n        }\n        return -1;\n    }\n\n    /* Mark it resolved to skip it the next time */\n    fs->symlinksResolved = true;\n\n    VIR_DEBUG(\"Resolved '%s' to %s\", fs->src->path, newroot);\n\n    VIR_FREE(fs->src->path);\n    fs->src->path = newroot;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerResolveSymlinks(virDomainFSDefPtr fs, bool gentle)\n{\n    char *newroot;\n\n    if (!fs->src || !fs->src->path || fs->symlinksResolved)\n        return 0;\n\n    if (access(fs->src->path, F_OK)) {\n        if (gentle) {\n            /* Just ignore the error for the while, we'll try again later */\n            VIR_DEBUG(\"Skipped unaccessible '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to access '%s'\"), fs->src->path);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Resolving '%s'\", fs->src->path);\n    if (virFileResolveAllLinks(fs->src->path, &newroot) < 0) {\n        if (gentle) {\n            VIR_DEBUG(\"Skipped non-resolvable '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to resolve symlink at %s\"),\n                                 fs->src->path);\n        }\n        return -1;\n    }\n\n    /* Mark it resolved to skip it the next time */\n    fs->symlinksResolved = true;\n\n    VIR_DEBUG(\"Resolved '%s' to %s\", fs->src->path, newroot);\n\n    VIR_FREE(fs->src->path);\n    fs->src->path = newroot;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mounting '%s' -> '%s'\"",
            "vmDef->fss[i]->src->path",
            "vmDef->fss[i]->dst"
          ],
          "line": 1582
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "vmDef->fss[i]->dst",
            "\"/\""
          ],
          "line": 1579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mounting all non-root filesystems\""
          ],
          "line": 1575
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountAllFS(virDomainDefPtr vmDef,\n                                  char *sec_mount_options)\n{\n    size_t i;\n    VIR_DEBUG(\"Mounting all non-root filesystems\");\n\n    /* Pull in rest of container's mounts */\n    for (i = 0; i < vmDef->nfss; i++) {\n        if (STREQ(vmDef->fss[i]->dst, \"/\"))\n            continue;\n\n        VIR_DEBUG(\"Mounting '%s' -> '%s'\", vmDef->fss[i]->src->path, vmDef->fss[i]->dst);\n\n        if (lxcContainerResolveSymlinks(vmDef->fss[i], false) < 0)\n            return -1;\n\n        if (!(vmDef->fss[i]->src && vmDef->fss[i]->src->path &&\n              STRPREFIX(vmDef->fss[i]->src->path, vmDef->fss[i]->dst)) &&\n            lxcContainerUnmountSubtree(vmDef->fss[i]->dst, false) < 0)\n            return -1;\n\n        if (lxcContainerMountFS(vmDef->fss[i], sec_mount_options) < 0)\n            return -1;\n    }\n\n    VIR_DEBUG(\"Mounted all non-root filesystems\");\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerMountFS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1533-1568",
    "snippet": "static int lxcContainerMountFS(virDomainFSDefPtr fs,\n                               char *sec_mount_options)\n{\n    switch (fs->type) {\n    case VIR_DOMAIN_FS_TYPE_MOUNT:\n        if (lxcContainerMountFSBind(fs, \"/.oldroot\") < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_BLOCK:\n        if (lxcContainerMountFSBlock(fs, \"/.oldroot\", sec_mount_options) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_RAM:\n        if (lxcContainerMountFSTmpfs(fs, sec_mount_options) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_BIND:\n        if (lxcContainerMountFSBind(fs, \"\") < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_FILE:\n        /* We do actually support this, but the lxc controller\n         * should have associated the file with a loopback\n         * device and changed this to TYPE_BLOCK for us */\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected filesystem type %s\"),\n                       virDomainFSTypeToString(fs->type));\n        return -1;\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Cannot mount filesystem type %s\"),\n                       virDomainFSTypeToString(fs->type));\n        return -1;\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Cannot mount filesystem type %s\")",
            "virDomainFSTypeToString(fs->type)"
          ],
          "line": 1562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainFSTypeToString",
          "args": [
            "fs->type"
          ],
          "line": 1564
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot mount filesystem type %s\""
          ],
          "line": 1563
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unexpected filesystem type %s\")",
            "virDomainFSTypeToString(fs->type)"
          ],
          "line": 1557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainFSTypeToString",
          "args": [
            "fs->type"
          ],
          "line": 1559
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerMountFSBind",
          "args": [
            "fs",
            "\"\""
          ],
          "line": 1550
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountFSBind",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1139-1210",
          "snippet": "static int lxcContainerMountFSBind(virDomainFSDefPtr fs,\n                                   const char *srcprefix)\n{\n    char *src = NULL;\n    int ret = -1;\n    struct stat st;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    if (stat(fs->dst, &st) < 0) {\n        if (errno != ENOENT) {\n            virReportSystemError(errno, _(\"Unable to stat bind target %s\"),\n                                 fs->dst);\n            goto cleanup;\n        }\n        /* ENOENT => create the target dir or file */\n        if (stat(src, &st) < 0) {\n            virReportSystemError(errno, _(\"Unable to stat bind source %s\"),\n                                 src);\n            goto cleanup;\n        }\n        if (S_ISDIR(st.st_mode)) {\n            if (virFileMakePath(fs->dst) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to create %s\"),\n                                     fs->dst);\n                goto cleanup;\n            }\n        } else {\n            /* Create Empty file for target mount point */\n            int fd = open(fs->dst, O_WRONLY|O_CREAT|O_NOCTTY|O_NONBLOCK, 0666);\n            if (fd < 0) {\n                if (errno != EEXIST) {\n                    virReportSystemError(errno,\n                                         _(\"Failed to create bind target %s\"),\n                                         fs->dst);\n                    goto cleanup;\n                }\n            }\n            if (VIR_CLOSE(fd) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to close bind target %s\"),\n                                     fs->dst);\n                goto cleanup;\n            }\n        }\n    }\n\n    if (mount(src, fs->dst, \"none\", MS_BIND, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to bind mount directory %s to %s\"),\n                             src, fs->dst);\n        goto cleanup;\n    }\n\n    if (fs->readonly) {\n        VIR_DEBUG(\"Binding %s readonly\", fs->dst);\n        if (mount(src, fs->dst, \"none\", MS_BIND|MS_REMOUNT|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make directory %s readonly\"),\n                                 fs->dst);\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(src);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBind(virDomainFSDefPtr fs,\n                                   const char *srcprefix)\n{\n    char *src = NULL;\n    int ret = -1;\n    struct stat st;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    if (stat(fs->dst, &st) < 0) {\n        if (errno != ENOENT) {\n            virReportSystemError(errno, _(\"Unable to stat bind target %s\"),\n                                 fs->dst);\n            goto cleanup;\n        }\n        /* ENOENT => create the target dir or file */\n        if (stat(src, &st) < 0) {\n            virReportSystemError(errno, _(\"Unable to stat bind source %s\"),\n                                 src);\n            goto cleanup;\n        }\n        if (S_ISDIR(st.st_mode)) {\n            if (virFileMakePath(fs->dst) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to create %s\"),\n                                     fs->dst);\n                goto cleanup;\n            }\n        } else {\n            /* Create Empty file for target mount point */\n            int fd = open(fs->dst, O_WRONLY|O_CREAT|O_NOCTTY|O_NONBLOCK, 0666);\n            if (fd < 0) {\n                if (errno != EEXIST) {\n                    virReportSystemError(errno,\n                                         _(\"Failed to create bind target %s\"),\n                                         fs->dst);\n                    goto cleanup;\n                }\n            }\n            if (VIR_CLOSE(fd) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to close bind target %s\"),\n                                     fs->dst);\n                goto cleanup;\n            }\n        }\n    }\n\n    if (mount(src, fs->dst, \"none\", MS_BIND, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to bind mount directory %s to %s\"),\n                             src, fs->dst);\n        goto cleanup;\n    }\n\n    if (fs->readonly) {\n        VIR_DEBUG(\"Binding %s readonly\", fs->dst);\n        if (mount(src, fs->dst, \"none\", MS_BIND|MS_REMOUNT|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make directory %s readonly\"),\n                                 fs->dst);\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(src);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerMountFSTmpfs",
          "args": [
            "fs",
            "sec_mount_options"
          ],
          "line": 1546
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountFSTmpfs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1491-1530",
          "snippet": "static int lxcContainerMountFSTmpfs(virDomainFSDefPtr fs,\n                                    char *sec_mount_options)\n{\n    int ret = -1;\n    char *data = NULL;\n\n    VIR_DEBUG(\"usage=%lld sec=%s\", fs->usage, sec_mount_options);\n\n    data = g_strdup_printf(\"size=%lld%s\", fs->usage, sec_mount_options);\n\n    if (virFileMakePath(fs->dst) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (mount(\"tmpfs\", fs->dst, \"tmpfs\", MS_NOSUID|MS_NODEV, data) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount directory %s as tmpfs\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (fs->readonly) {\n        VIR_DEBUG(\"Binding %s readonly\", fs->dst);\n        if (mount(fs->dst, fs->dst, \"none\", MS_BIND|MS_REMOUNT|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make directory %s readonly\"),\n                                 fs->dst);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(data);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSTmpfs(virDomainFSDefPtr fs,\n                                    char *sec_mount_options)\n{\n    int ret = -1;\n    char *data = NULL;\n\n    VIR_DEBUG(\"usage=%lld sec=%s\", fs->usage, sec_mount_options);\n\n    data = g_strdup_printf(\"size=%lld%s\", fs->usage, sec_mount_options);\n\n    if (virFileMakePath(fs->dst) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (mount(\"tmpfs\", fs->dst, \"tmpfs\", MS_NOSUID|MS_NODEV, data) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount directory %s as tmpfs\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (fs->readonly) {\n        VIR_DEBUG(\"Binding %s readonly\", fs->dst);\n        if (mount(fs->dst, fs->dst, \"none\", MS_BIND|MS_REMOUNT|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make directory %s readonly\"),\n                                 fs->dst);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(data);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerMountFSBlock",
          "args": [
            "fs",
            "\"/.oldroot\"",
            "sec_mount_options"
          ],
          "line": 1542
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountFSBlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1471-1488",
          "snippet": "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options)\n{\n    char *src = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    ret = lxcContainerMountFSBlockHelper(fs, src, srcprefix, sec_mount_options);\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d\", ret);\n\n    VIR_FREE(src);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options)\n{\n    char *src = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    ret = lxcContainerMountFSBlockHelper(fs, src, srcprefix, sec_mount_options);\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d\", ret);\n\n    VIR_FREE(src);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFS(virDomainFSDefPtr fs,\n                               char *sec_mount_options)\n{\n    switch (fs->type) {\n    case VIR_DOMAIN_FS_TYPE_MOUNT:\n        if (lxcContainerMountFSBind(fs, \"/.oldroot\") < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_BLOCK:\n        if (lxcContainerMountFSBlock(fs, \"/.oldroot\", sec_mount_options) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_RAM:\n        if (lxcContainerMountFSTmpfs(fs, sec_mount_options) < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_BIND:\n        if (lxcContainerMountFSBind(fs, \"\") < 0)\n            return -1;\n        break;\n    case VIR_DOMAIN_FS_TYPE_FILE:\n        /* We do actually support this, but the lxc controller\n         * should have associated the file with a loopback\n         * device and changed this to TYPE_BLOCK for us */\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unexpected filesystem type %s\"),\n                       virDomainFSTypeToString(fs->type));\n        return -1;\n    default:\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Cannot mount filesystem type %s\"),\n                       virDomainFSTypeToString(fs->type));\n        return -1;\n    }\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerMountFSTmpfs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1491-1530",
    "snippet": "static int lxcContainerMountFSTmpfs(virDomainFSDefPtr fs,\n                                    char *sec_mount_options)\n{\n    int ret = -1;\n    char *data = NULL;\n\n    VIR_DEBUG(\"usage=%lld sec=%s\", fs->usage, sec_mount_options);\n\n    data = g_strdup_printf(\"size=%lld%s\", fs->usage, sec_mount_options);\n\n    if (virFileMakePath(fs->dst) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (mount(\"tmpfs\", fs->dst, \"tmpfs\", MS_NOSUID|MS_NODEV, data) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount directory %s as tmpfs\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (fs->readonly) {\n        VIR_DEBUG(\"Binding %s readonly\", fs->dst);\n        if (mount(fs->dst, fs->dst, \"none\", MS_BIND|MS_REMOUNT|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make directory %s readonly\"),\n                                 fs->dst);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(data);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "data"
          ],
          "line": 1528
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to make directory %s readonly\")",
            "fs->dst"
          ],
          "line": 1518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to make directory %s readonly\""
          ],
          "line": 1519
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "fs->dst",
            "fs->dst",
            "\"none\"",
            "MS_BIND|MS_REMOUNT|MS_RDONLY",
            "NULL"
          ],
          "line": 1517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Binding %s readonly\"",
            "fs->dst"
          ],
          "line": 1516
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount directory %s as tmpfs\")",
            "fs->dst"
          ],
          "line": 1509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "\"tmpfs\"",
            "fs->dst",
            "\"tmpfs\"",
            "MS_NOSUID|MS_NODEV",
            "data"
          ],
          "line": 1508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to create %s\")",
            "fs->dst"
          ],
          "line": 1502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "fs->dst"
          ],
          "line": 1501
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"size=%lld%s\"",
            "fs->usage",
            "sec_mount_options"
          ],
          "line": 1499
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"usage=%lld sec=%s\"",
            "fs->usage",
            "sec_mount_options"
          ],
          "line": 1497
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSTmpfs(virDomainFSDefPtr fs,\n                                    char *sec_mount_options)\n{\n    int ret = -1;\n    char *data = NULL;\n\n    VIR_DEBUG(\"usage=%lld sec=%s\", fs->usage, sec_mount_options);\n\n    data = g_strdup_printf(\"size=%lld%s\", fs->usage, sec_mount_options);\n\n    if (virFileMakePath(fs->dst) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (mount(\"tmpfs\", fs->dst, \"tmpfs\", MS_NOSUID|MS_NODEV, data) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount directory %s as tmpfs\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (fs->readonly) {\n        VIR_DEBUG(\"Binding %s readonly\", fs->dst);\n        if (mount(fs->dst, fs->dst, \"none\", MS_BIND|MS_REMOUNT|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make directory %s readonly\"),\n                                 fs->dst);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(data);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountFSBlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1471-1488",
    "snippet": "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options)\n{\n    char *src = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    ret = lxcContainerMountFSBlockHelper(fs, src, srcprefix, sec_mount_options);\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d\", ret);\n\n    VIR_FREE(src);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "src"
          ],
          "line": 1486
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Done mounting filesystem ret=%d\"",
            "ret"
          ],
          "line": 1484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerMountFSBlockHelper",
          "args": [
            "fs",
            "src",
            "srcprefix",
            "sec_mount_options"
          ],
          "line": 1482
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountFSBlockHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1429-1468",
          "snippet": "static int lxcContainerMountFSBlockHelper(virDomainFSDefPtr fs,\n                                          const char *src,\n                                          const char *srcprefix,\n                                          const char *sec_mount_options)\n{\n    int fsflags = 0;\n    int ret = -1;\n    char *format = NULL;\n\n    if (fs->readonly)\n        fsflags |= MS_RDONLY;\n\n    if (virFileMakePath(fs->dst) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerMountDetectFilesystem(src, &format) < 0)\n        goto cleanup;\n\n    if (format) {\n        VIR_DEBUG(\"Mount '%s' on '%s' with detected format '%s' opts '%s'\",\n                  src, fs->dst, format, sec_mount_options);\n        if (mount(src, fs->dst, format, fsflags, sec_mount_options) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mount device %s to %s as %s\"),\n                                 src, fs->dst, format);\n            goto cleanup;\n        }\n        ret = 0;\n    } else {\n        ret = lxcContainerMountFSBlockAuto(fs, fsflags, src, srcprefix, sec_mount_options);\n    }\n\n cleanup:\n    VIR_FREE(format);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSBlockHelper(virDomainFSDefPtr fs,\n                                          const char *src,\n                                          const char *srcprefix,\n                                          const char *sec_mount_options)\n{\n    int fsflags = 0;\n    int ret = -1;\n    char *format = NULL;\n\n    if (fs->readonly)\n        fsflags |= MS_RDONLY;\n\n    if (virFileMakePath(fs->dst) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerMountDetectFilesystem(src, &format) < 0)\n        goto cleanup;\n\n    if (format) {\n        VIR_DEBUG(\"Mount '%s' on '%s' with detected format '%s' opts '%s'\",\n                  src, fs->dst, format, sec_mount_options);\n        if (mount(src, fs->dst, format, fsflags, sec_mount_options) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mount device %s to %s as %s\"),\n                                 src, fs->dst, format);\n            goto cleanup;\n        }\n        ret = 0;\n    } else {\n        ret = lxcContainerMountFSBlockAuto(fs, fsflags, src, srcprefix, sec_mount_options);\n    }\n\n cleanup:\n    VIR_FREE(format);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s%s\"",
            "srcprefix",
            "fs->src->path"
          ],
          "line": 1480
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"src=%s dst=%s\"",
            "fs->src->path",
            "fs->dst"
          ],
          "line": 1478
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options)\n{\n    char *src = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    ret = lxcContainerMountFSBlockHelper(fs, src, srcprefix, sec_mount_options);\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d\", ret);\n\n    VIR_FREE(src);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountFSBlockHelper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1429-1468",
    "snippet": "static int lxcContainerMountFSBlockHelper(virDomainFSDefPtr fs,\n                                          const char *src,\n                                          const char *srcprefix,\n                                          const char *sec_mount_options)\n{\n    int fsflags = 0;\n    int ret = -1;\n    char *format = NULL;\n\n    if (fs->readonly)\n        fsflags |= MS_RDONLY;\n\n    if (virFileMakePath(fs->dst) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerMountDetectFilesystem(src, &format) < 0)\n        goto cleanup;\n\n    if (format) {\n        VIR_DEBUG(\"Mount '%s' on '%s' with detected format '%s' opts '%s'\",\n                  src, fs->dst, format, sec_mount_options);\n        if (mount(src, fs->dst, format, fsflags, sec_mount_options) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mount device %s to %s as %s\"),\n                                 src, fs->dst, format);\n            goto cleanup;\n        }\n        ret = 0;\n    } else {\n        ret = lxcContainerMountFSBlockAuto(fs, fsflags, src, srcprefix, sec_mount_options);\n    }\n\n cleanup:\n    VIR_FREE(format);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "format"
          ],
          "line": 1466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerMountFSBlockAuto",
          "args": [
            "fs",
            "fsflags",
            "src",
            "srcprefix",
            "sec_mount_options"
          ],
          "line": 1462
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountFSBlockAuto",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1300-1422",
          "snippet": "static int lxcContainerMountFSBlockAuto(virDomainFSDefPtr fs,\n                                        int fsflags,\n                                        const char *src,\n                                        const char *srcprefix,\n                                        const char *sec_mount_options)\n{\n    FILE *fp = NULL;\n    int ret = -1;\n    bool tryProc = false;\n    bool gotStar = false;\n    char *fslist = NULL;\n    char *line = NULL;\n    const char *type;\n\n    VIR_DEBUG(\"src=%s dst=%s srcprefix=%s\", src, fs->dst, srcprefix);\n\n    /* First time around we use /etc/filesystems */\n retry:\n    fslist = g_strdup_printf(\"%s%s\", srcprefix,\n                             tryProc ? \"/proc/filesystems\" : \"/etc/filesystems\");\n\n    VIR_DEBUG(\"Open fslist %s\", fslist);\n    if (!(fp = fopen(fslist, \"r\"))) {\n        /* If /etc/filesystems does not exist, then we need to retry\n         * with /proc/filesystems next\n         */\n        if (errno == ENOENT &&\n            !tryProc) {\n            tryProc = true;\n            VIR_FREE(fslist);\n            goto retry;\n        }\n\n        virReportSystemError(errno,\n                             _(\"Unable to read %s\"),\n                             fslist);\n        goto cleanup;\n    }\n\n    while (!feof(fp)) {\n        size_t n;\n        VIR_FREE(line);\n        if (getline(&line, &n, fp) <= 0) {\n            if (feof(fp))\n                break;\n\n            goto cleanup;\n        }\n\n        if (strstr(line, \"nodev\"))\n            continue;\n\n        type = strchr(line, '\\n');\n        if (type)\n            line[type-line] = '\\0';\n\n        type = line;\n        virSkipSpaces(&type);\n\n        /*\n         * /etc/filesystems is only allowed to contain '*' on the last line\n         */\n        if (gotStar && !tryProc) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s has unexpected '*' before last line\"),\n                           fslist);\n            goto cleanup;\n        }\n\n        /* An '*' on the last line in /etc/filesystems\n         * means try /proc/filesystems next. We don't\n         * jump immediately though, since we need to see\n         * if any more lines follow\n         */\n        if (!tryProc &&\n            STREQ(type, \"*\"))\n            gotStar = true;\n\n        VIR_DEBUG(\"Trying mount '%s' on '%s' with '%s' opts '%s'\",\n                  src, fs->dst, type, sec_mount_options);\n        if (mount(src, fs->dst, type, fsflags, sec_mount_options) < 0) {\n            /* These errnos indicate a bogus filesystem type for\n             * the image we have, so skip to the next type\n             */\n            if (errno == EINVAL || errno == ENODEV)\n                continue;\n\n            virReportSystemError(errno,\n                                 _(\"Failed to mount device %s to %s\"),\n                                 src, fs->dst);\n            goto cleanup;\n        }\n\n        ret = 0;\n        break;\n    }\n\n    /* We've got to the end of /etc/filesystems and saw\n     * a '*', so we must try /proc/filesystems next\n     */\n    if (ret != 0 &&\n        !tryProc &&\n        gotStar) {\n        tryProc = true;\n        VIR_FREE(fslist);\n        VIR_FORCE_FCLOSE(fp);\n        goto retry;\n    }\n\n    if (ret != 0) {\n        virReportSystemError(ENODEV,\n                             _(\"Failed to mount device %s to %s, unable to detect filesystem\"),\n                             src, fs->dst);\n    }\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d tryProc=%d\", ret, tryProc);\n\n cleanup:\n    VIR_FREE(line);\n    VIR_FREE(fslist);\n    VIR_FORCE_FCLOSE(fp);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSBlockAuto(virDomainFSDefPtr fs,\n                                        int fsflags,\n                                        const char *src,\n                                        const char *srcprefix,\n                                        const char *sec_mount_options)\n{\n    FILE *fp = NULL;\n    int ret = -1;\n    bool tryProc = false;\n    bool gotStar = false;\n    char *fslist = NULL;\n    char *line = NULL;\n    const char *type;\n\n    VIR_DEBUG(\"src=%s dst=%s srcprefix=%s\", src, fs->dst, srcprefix);\n\n    /* First time around we use /etc/filesystems */\n retry:\n    fslist = g_strdup_printf(\"%s%s\", srcprefix,\n                             tryProc ? \"/proc/filesystems\" : \"/etc/filesystems\");\n\n    VIR_DEBUG(\"Open fslist %s\", fslist);\n    if (!(fp = fopen(fslist, \"r\"))) {\n        /* If /etc/filesystems does not exist, then we need to retry\n         * with /proc/filesystems next\n         */\n        if (errno == ENOENT &&\n            !tryProc) {\n            tryProc = true;\n            VIR_FREE(fslist);\n            goto retry;\n        }\n\n        virReportSystemError(errno,\n                             _(\"Unable to read %s\"),\n                             fslist);\n        goto cleanup;\n    }\n\n    while (!feof(fp)) {\n        size_t n;\n        VIR_FREE(line);\n        if (getline(&line, &n, fp) <= 0) {\n            if (feof(fp))\n                break;\n\n            goto cleanup;\n        }\n\n        if (strstr(line, \"nodev\"))\n            continue;\n\n        type = strchr(line, '\\n');\n        if (type)\n            line[type-line] = '\\0';\n\n        type = line;\n        virSkipSpaces(&type);\n\n        /*\n         * /etc/filesystems is only allowed to contain '*' on the last line\n         */\n        if (gotStar && !tryProc) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s has unexpected '*' before last line\"),\n                           fslist);\n            goto cleanup;\n        }\n\n        /* An '*' on the last line in /etc/filesystems\n         * means try /proc/filesystems next. We don't\n         * jump immediately though, since we need to see\n         * if any more lines follow\n         */\n        if (!tryProc &&\n            STREQ(type, \"*\"))\n            gotStar = true;\n\n        VIR_DEBUG(\"Trying mount '%s' on '%s' with '%s' opts '%s'\",\n                  src, fs->dst, type, sec_mount_options);\n        if (mount(src, fs->dst, type, fsflags, sec_mount_options) < 0) {\n            /* These errnos indicate a bogus filesystem type for\n             * the image we have, so skip to the next type\n             */\n            if (errno == EINVAL || errno == ENODEV)\n                continue;\n\n            virReportSystemError(errno,\n                                 _(\"Failed to mount device %s to %s\"),\n                                 src, fs->dst);\n            goto cleanup;\n        }\n\n        ret = 0;\n        break;\n    }\n\n    /* We've got to the end of /etc/filesystems and saw\n     * a '*', so we must try /proc/filesystems next\n     */\n    if (ret != 0 &&\n        !tryProc &&\n        gotStar) {\n        tryProc = true;\n        VIR_FREE(fslist);\n        VIR_FORCE_FCLOSE(fp);\n        goto retry;\n    }\n\n    if (ret != 0) {\n        virReportSystemError(ENODEV,\n                             _(\"Failed to mount device %s to %s, unable to detect filesystem\"),\n                             src, fs->dst);\n    }\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d tryProc=%d\", ret, tryProc);\n\n cleanup:\n    VIR_FREE(line);\n    VIR_FREE(fslist);\n    VIR_FORCE_FCLOSE(fp);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount device %s to %s as %s\")",
            "src",
            "fs->dst",
            "format"
          ],
          "line": 1455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to mount device %s to %s as %s\""
          ],
          "line": 1456
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "src",
            "fs->dst",
            "format",
            "fsflags",
            "sec_mount_options"
          ],
          "line": 1454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mount '%s' on '%s' with detected format '%s' opts '%s'\"",
            "src",
            "fs->dst",
            "format",
            "sec_mount_options"
          ],
          "line": 1452
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerMountDetectFilesystem",
          "args": [
            "src",
            "&format"
          ],
          "line": 1448
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountDetectFilesystem",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1282-1289",
          "snippet": "static int\nlxcContainerMountDetectFilesystem(const char *src G_GNUC_UNUSED,\n                                  char **type)\n{\n    /* No libblkid, so just return success with no detected type */\n    *type = NULL;\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nlxcContainerMountDetectFilesystem(const char *src G_GNUC_UNUSED,\n                                  char **type)\n{\n    /* No libblkid, so just return success with no detected type */\n    *type = NULL;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to create %s\")",
            "fs->dst"
          ],
          "line": 1442
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "fs->dst"
          ],
          "line": 1441
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSBlockHelper(virDomainFSDefPtr fs,\n                                          const char *src,\n                                          const char *srcprefix,\n                                          const char *sec_mount_options)\n{\n    int fsflags = 0;\n    int ret = -1;\n    char *format = NULL;\n\n    if (fs->readonly)\n        fsflags |= MS_RDONLY;\n\n    if (virFileMakePath(fs->dst) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             fs->dst);\n        goto cleanup;\n    }\n\n    if (lxcContainerMountDetectFilesystem(src, &format) < 0)\n        goto cleanup;\n\n    if (format) {\n        VIR_DEBUG(\"Mount '%s' on '%s' with detected format '%s' opts '%s'\",\n                  src, fs->dst, format, sec_mount_options);\n        if (mount(src, fs->dst, format, fsflags, sec_mount_options) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mount device %s to %s as %s\"),\n                                 src, fs->dst, format);\n            goto cleanup;\n        }\n        ret = 0;\n    } else {\n        ret = lxcContainerMountFSBlockAuto(fs, fsflags, src, srcprefix, sec_mount_options);\n    }\n\n cleanup:\n    VIR_FREE(format);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountFSBlockAuto",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1300-1422",
    "snippet": "static int lxcContainerMountFSBlockAuto(virDomainFSDefPtr fs,\n                                        int fsflags,\n                                        const char *src,\n                                        const char *srcprefix,\n                                        const char *sec_mount_options)\n{\n    FILE *fp = NULL;\n    int ret = -1;\n    bool tryProc = false;\n    bool gotStar = false;\n    char *fslist = NULL;\n    char *line = NULL;\n    const char *type;\n\n    VIR_DEBUG(\"src=%s dst=%s srcprefix=%s\", src, fs->dst, srcprefix);\n\n    /* First time around we use /etc/filesystems */\n retry:\n    fslist = g_strdup_printf(\"%s%s\", srcprefix,\n                             tryProc ? \"/proc/filesystems\" : \"/etc/filesystems\");\n\n    VIR_DEBUG(\"Open fslist %s\", fslist);\n    if (!(fp = fopen(fslist, \"r\"))) {\n        /* If /etc/filesystems does not exist, then we need to retry\n         * with /proc/filesystems next\n         */\n        if (errno == ENOENT &&\n            !tryProc) {\n            tryProc = true;\n            VIR_FREE(fslist);\n            goto retry;\n        }\n\n        virReportSystemError(errno,\n                             _(\"Unable to read %s\"),\n                             fslist);\n        goto cleanup;\n    }\n\n    while (!feof(fp)) {\n        size_t n;\n        VIR_FREE(line);\n        if (getline(&line, &n, fp) <= 0) {\n            if (feof(fp))\n                break;\n\n            goto cleanup;\n        }\n\n        if (strstr(line, \"nodev\"))\n            continue;\n\n        type = strchr(line, '\\n');\n        if (type)\n            line[type-line] = '\\0';\n\n        type = line;\n        virSkipSpaces(&type);\n\n        /*\n         * /etc/filesystems is only allowed to contain '*' on the last line\n         */\n        if (gotStar && !tryProc) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s has unexpected '*' before last line\"),\n                           fslist);\n            goto cleanup;\n        }\n\n        /* An '*' on the last line in /etc/filesystems\n         * means try /proc/filesystems next. We don't\n         * jump immediately though, since we need to see\n         * if any more lines follow\n         */\n        if (!tryProc &&\n            STREQ(type, \"*\"))\n            gotStar = true;\n\n        VIR_DEBUG(\"Trying mount '%s' on '%s' with '%s' opts '%s'\",\n                  src, fs->dst, type, sec_mount_options);\n        if (mount(src, fs->dst, type, fsflags, sec_mount_options) < 0) {\n            /* These errnos indicate a bogus filesystem type for\n             * the image we have, so skip to the next type\n             */\n            if (errno == EINVAL || errno == ENODEV)\n                continue;\n\n            virReportSystemError(errno,\n                                 _(\"Failed to mount device %s to %s\"),\n                                 src, fs->dst);\n            goto cleanup;\n        }\n\n        ret = 0;\n        break;\n    }\n\n    /* We've got to the end of /etc/filesystems and saw\n     * a '*', so we must try /proc/filesystems next\n     */\n    if (ret != 0 &&\n        !tryProc &&\n        gotStar) {\n        tryProc = true;\n        VIR_FREE(fslist);\n        VIR_FORCE_FCLOSE(fp);\n        goto retry;\n    }\n\n    if (ret != 0) {\n        virReportSystemError(ENODEV,\n                             _(\"Failed to mount device %s to %s, unable to detect filesystem\"),\n                             src, fs->dst);\n    }\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d tryProc=%d\", ret, tryProc);\n\n cleanup:\n    VIR_FREE(line);\n    VIR_FREE(fslist);\n    VIR_FORCE_FCLOSE(fp);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "fp"
          ],
          "line": 1420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "fslist"
          ],
          "line": 1419
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "line"
          ],
          "line": 1418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Done mounting filesystem ret=%d tryProc=%d\"",
            "ret",
            "tryProc"
          ],
          "line": 1415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENODEV",
            "_(\"Failed to mount device %s to %s, unable to detect filesystem\")",
            "src",
            "fs->dst"
          ],
          "line": 1410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to mount device %s to %s, unable to detect filesystem\""
          ],
          "line": 1411
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "fp"
          ],
          "line": 1405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "fslist"
          ],
          "line": 1404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount device %s to %s\")",
            "src",
            "fs->dst"
          ],
          "line": 1387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "src",
            "fs->dst",
            "type",
            "fsflags",
            "sec_mount_options"
          ],
          "line": 1380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Trying mount '%s' on '%s' with '%s' opts '%s'\"",
            "src",
            "fs->dst",
            "type",
            "sec_mount_options"
          ],
          "line": 1378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "type",
            "\"*\""
          ],
          "line": 1375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"%s has unexpected '*' before last line\")",
            "fslist"
          ],
          "line": 1363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSkipSpaces",
          "args": [
            "&type"
          ],
          "line": 1357
        },
        "resolved": true,
        "details": {
          "function_name": "virSkipSpacesAndBackslash",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "810-818",
          "snippet": "void\nvirSkipSpacesAndBackslash(const char **str)\n{\n    const char *cur = *str;\n\n    while (g_ascii_isspace(*cur) || *cur == '\\\\')\n        cur++;\n    *str = cur;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid\nvirSkipSpacesAndBackslash(const char **str)\n{\n    const char *cur = *str;\n\n    while (g_ascii_isspace(*cur) || *cur == '\\\\')\n        cur++;\n    *str = cur;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "line",
            "'\\n'"
          ],
          "line": 1352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "line",
            "\"nodev\""
          ],
          "line": 1349
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "feof",
          "args": [
            "fp"
          ],
          "line": 1343
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getline",
          "args": [
            "&line",
            "&n",
            "fp"
          ],
          "line": 1342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "line"
          ],
          "line": 1341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "feof",
          "args": [
            "fp"
          ],
          "line": 1339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to read %s\")",
            "fslist"
          ],
          "line": 1333
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "fslist"
          ],
          "line": 1329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "fslist",
            "\"r\""
          ],
          "line": 1322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Open fslist %s\"",
            "fslist"
          ],
          "line": 1321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s%s\"",
            "srcprefix",
            "tryProc ? \"/proc/filesystems\" : \"/etc/filesystems\""
          ],
          "line": 1318
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"src=%s dst=%s srcprefix=%s\"",
            "src",
            "fs->dst",
            "srcprefix"
          ],
          "line": 1314
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSBlockAuto(virDomainFSDefPtr fs,\n                                        int fsflags,\n                                        const char *src,\n                                        const char *srcprefix,\n                                        const char *sec_mount_options)\n{\n    FILE *fp = NULL;\n    int ret = -1;\n    bool tryProc = false;\n    bool gotStar = false;\n    char *fslist = NULL;\n    char *line = NULL;\n    const char *type;\n\n    VIR_DEBUG(\"src=%s dst=%s srcprefix=%s\", src, fs->dst, srcprefix);\n\n    /* First time around we use /etc/filesystems */\n retry:\n    fslist = g_strdup_printf(\"%s%s\", srcprefix,\n                             tryProc ? \"/proc/filesystems\" : \"/etc/filesystems\");\n\n    VIR_DEBUG(\"Open fslist %s\", fslist);\n    if (!(fp = fopen(fslist, \"r\"))) {\n        /* If /etc/filesystems does not exist, then we need to retry\n         * with /proc/filesystems next\n         */\n        if (errno == ENOENT &&\n            !tryProc) {\n            tryProc = true;\n            VIR_FREE(fslist);\n            goto retry;\n        }\n\n        virReportSystemError(errno,\n                             _(\"Unable to read %s\"),\n                             fslist);\n        goto cleanup;\n    }\n\n    while (!feof(fp)) {\n        size_t n;\n        VIR_FREE(line);\n        if (getline(&line, &n, fp) <= 0) {\n            if (feof(fp))\n                break;\n\n            goto cleanup;\n        }\n\n        if (strstr(line, \"nodev\"))\n            continue;\n\n        type = strchr(line, '\\n');\n        if (type)\n            line[type-line] = '\\0';\n\n        type = line;\n        virSkipSpaces(&type);\n\n        /*\n         * /etc/filesystems is only allowed to contain '*' on the last line\n         */\n        if (gotStar && !tryProc) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s has unexpected '*' before last line\"),\n                           fslist);\n            goto cleanup;\n        }\n\n        /* An '*' on the last line in /etc/filesystems\n         * means try /proc/filesystems next. We don't\n         * jump immediately though, since we need to see\n         * if any more lines follow\n         */\n        if (!tryProc &&\n            STREQ(type, \"*\"))\n            gotStar = true;\n\n        VIR_DEBUG(\"Trying mount '%s' on '%s' with '%s' opts '%s'\",\n                  src, fs->dst, type, sec_mount_options);\n        if (mount(src, fs->dst, type, fsflags, sec_mount_options) < 0) {\n            /* These errnos indicate a bogus filesystem type for\n             * the image we have, so skip to the next type\n             */\n            if (errno == EINVAL || errno == ENODEV)\n                continue;\n\n            virReportSystemError(errno,\n                                 _(\"Failed to mount device %s to %s\"),\n                                 src, fs->dst);\n            goto cleanup;\n        }\n\n        ret = 0;\n        break;\n    }\n\n    /* We've got to the end of /etc/filesystems and saw\n     * a '*', so we must try /proc/filesystems next\n     */\n    if (ret != 0 &&\n        !tryProc &&\n        gotStar) {\n        tryProc = true;\n        VIR_FREE(fslist);\n        VIR_FORCE_FCLOSE(fp);\n        goto retry;\n    }\n\n    if (ret != 0) {\n        virReportSystemError(ENODEV,\n                             _(\"Failed to mount device %s to %s, unable to detect filesystem\"),\n                             src, fs->dst);\n    }\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d tryProc=%d\", ret, tryProc);\n\n cleanup:\n    VIR_FREE(line);\n    VIR_FREE(fslist);\n    VIR_FORCE_FCLOSE(fp);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountDetectFilesystem",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1282-1289",
    "snippet": "static int\nlxcContainerMountDetectFilesystem(const char *src G_GNUC_UNUSED,\n                                  char **type)\n{\n    /* No libblkid, so just return success with no detected type */\n    *type = NULL;\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nlxcContainerMountDetectFilesystem(const char *src G_GNUC_UNUSED,\n                                  char **type)\n{\n    /* No libblkid, so just return success with no detected type */\n    *type = NULL;\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerMountDetectFilesystem",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1214-1280",
    "snippet": "static int\nlxcContainerMountDetectFilesystem(const char *src, char **type)\n{\n    int fd;\n    int ret = -1;\n    int rc;\n    const char *data = NULL;\n    blkid_probe blkid = NULL;\n\n    *type = NULL;\n\n    if ((fd = open(src, O_RDONLY)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open filesystem %s\"), src);\n        return -1;\n    }\n\n    if (!(blkid = blkid_new_probe())) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to create blkid library handle\"));\n        goto cleanup;\n    }\n    if (blkid_probe_set_device(blkid, fd, 0, 0) < 0) {\n        virReportSystemError(EINVAL,\n                             _(\"Unable to associate device %s with blkid library\"),\n                             src);\n        goto cleanup;\n    }\n\n    blkid_probe_enable_superblocks(blkid, 1);\n\n    blkid_probe_set_superblocks_flags(blkid, BLKID_SUBLKS_TYPE);\n\n    rc = blkid_do_safeprobe(blkid);\n    if (rc != 0) {\n        if (rc == 1) /* Nothing found, return success with *type == NULL */\n            goto done;\n\n        if (rc == -2) {\n            virReportSystemError(EINVAL,\n                                 _(\"Too many filesystems detected for %s\"),\n                                 src);\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Unable to detect filesystem for %s\"),\n                                 src);\n        }\n        goto cleanup;\n    }\n\n    if (blkid_probe_lookup_value(blkid, \"TYPE\", &data, NULL) < 0) {\n        virReportSystemError(ENOENT,\n                             _(\"Unable to find filesystem type for %s\"),\n                             src);\n        goto cleanup;\n    }\n\n    *type = g_strdup(data);\n\n done:\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(fd);\n    if (blkid)\n        blkid_free_probe(blkid);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "blkid_free_probe",
          "args": [
            "blkid"
          ],
          "line": 1278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "fd"
          ],
          "line": 1276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "data"
          ],
          "line": 1271
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENOENT",
            "_(\"Unable to find filesystem type for %s\")",
            "src"
          ],
          "line": 1265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to find filesystem type for %s\""
          ],
          "line": 1266
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "blkid_probe_lookup_value",
          "args": [
            "blkid",
            "\"TYPE\"",
            "&data",
            "NULL"
          ],
          "line": 1264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to detect filesystem for %s\")",
            "src"
          ],
          "line": 1257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "EINVAL",
            "_(\"Too many filesystems detected for %s\")",
            "src"
          ],
          "line": 1253
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blkid_do_safeprobe",
          "args": [
            "blkid"
          ],
          "line": 1247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blkid_probe_set_superblocks_flags",
          "args": [
            "blkid",
            "BLKID_SUBLKS_TYPE"
          ],
          "line": 1245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blkid_probe_enable_superblocks",
          "args": [
            "blkid",
            "1"
          ],
          "line": 1243
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "EINVAL",
            "_(\"Unable to associate device %s with blkid library\")",
            "src"
          ],
          "line": 1237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blkid_probe_set_device",
          "args": [
            "blkid",
            "fd",
            "0",
            "0"
          ],
          "line": 1236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to create blkid library handle\")"
          ],
          "line": 1232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blkid_new_probe",
          "args": [],
          "line": 1231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to open filesystem %s\")",
            "src"
          ],
          "line": 1226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "src",
            "O_RDONLY"
          ],
          "line": 1225
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nlxcContainerMountDetectFilesystem(const char *src, char **type)\n{\n    int fd;\n    int ret = -1;\n    int rc;\n    const char *data = NULL;\n    blkid_probe blkid = NULL;\n\n    *type = NULL;\n\n    if ((fd = open(src, O_RDONLY)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Unable to open filesystem %s\"), src);\n        return -1;\n    }\n\n    if (!(blkid = blkid_new_probe())) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to create blkid library handle\"));\n        goto cleanup;\n    }\n    if (blkid_probe_set_device(blkid, fd, 0, 0) < 0) {\n        virReportSystemError(EINVAL,\n                             _(\"Unable to associate device %s with blkid library\"),\n                             src);\n        goto cleanup;\n    }\n\n    blkid_probe_enable_superblocks(blkid, 1);\n\n    blkid_probe_set_superblocks_flags(blkid, BLKID_SUBLKS_TYPE);\n\n    rc = blkid_do_safeprobe(blkid);\n    if (rc != 0) {\n        if (rc == 1) /* Nothing found, return success with *type == NULL */\n            goto done;\n\n        if (rc == -2) {\n            virReportSystemError(EINVAL,\n                                 _(\"Too many filesystems detected for %s\"),\n                                 src);\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Unable to detect filesystem for %s\"),\n                                 src);\n        }\n        goto cleanup;\n    }\n\n    if (blkid_probe_lookup_value(blkid, \"TYPE\", &data, NULL) < 0) {\n        virReportSystemError(ENOENT,\n                             _(\"Unable to find filesystem type for %s\"),\n                             src);\n        goto cleanup;\n    }\n\n    *type = g_strdup(data);\n\n done:\n    ret = 0;\n cleanup:\n    VIR_FORCE_CLOSE(fd);\n    if (blkid)\n        blkid_free_probe(blkid);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountFSBind",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1139-1210",
    "snippet": "static int lxcContainerMountFSBind(virDomainFSDefPtr fs,\n                                   const char *srcprefix)\n{\n    char *src = NULL;\n    int ret = -1;\n    struct stat st;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    if (stat(fs->dst, &st) < 0) {\n        if (errno != ENOENT) {\n            virReportSystemError(errno, _(\"Unable to stat bind target %s\"),\n                                 fs->dst);\n            goto cleanup;\n        }\n        /* ENOENT => create the target dir or file */\n        if (stat(src, &st) < 0) {\n            virReportSystemError(errno, _(\"Unable to stat bind source %s\"),\n                                 src);\n            goto cleanup;\n        }\n        if (S_ISDIR(st.st_mode)) {\n            if (virFileMakePath(fs->dst) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to create %s\"),\n                                     fs->dst);\n                goto cleanup;\n            }\n        } else {\n            /* Create Empty file for target mount point */\n            int fd = open(fs->dst, O_WRONLY|O_CREAT|O_NOCTTY|O_NONBLOCK, 0666);\n            if (fd < 0) {\n                if (errno != EEXIST) {\n                    virReportSystemError(errno,\n                                         _(\"Failed to create bind target %s\"),\n                                         fs->dst);\n                    goto cleanup;\n                }\n            }\n            if (VIR_CLOSE(fd) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to close bind target %s\"),\n                                     fs->dst);\n                goto cleanup;\n            }\n        }\n    }\n\n    if (mount(src, fs->dst, \"none\", MS_BIND, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to bind mount directory %s to %s\"),\n                             src, fs->dst);\n        goto cleanup;\n    }\n\n    if (fs->readonly) {\n        VIR_DEBUG(\"Binding %s readonly\", fs->dst);\n        if (mount(src, fs->dst, \"none\", MS_BIND|MS_REMOUNT|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make directory %s readonly\"),\n                                 fs->dst);\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(src);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "src"
          ],
          "line": 1208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to make directory %s readonly\")",
            "fs->dst"
          ],
          "line": 1199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to make directory %s readonly\""
          ],
          "line": 1200
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "src",
            "fs->dst",
            "\"none\"",
            "MS_BIND|MS_REMOUNT|MS_RDONLY",
            "NULL"
          ],
          "line": 1198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Binding %s readonly\"",
            "fs->dst"
          ],
          "line": 1197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to bind mount directory %s to %s\")",
            "src",
            "fs->dst"
          ],
          "line": 1190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "src",
            "fs->dst",
            "\"none\"",
            "MS_BIND",
            "NULL"
          ],
          "line": 1189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to close bind target %s\")",
            "fs->dst"
          ],
          "line": 1181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_CLOSE",
          "args": [
            "fd"
          ],
          "line": 1180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to create bind target %s\")",
            "fs->dst"
          ],
          "line": 1174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "fs->dst",
            "O_WRONLY|O_CREAT|O_NOCTTY|O_NONBLOCK",
            "0666"
          ],
          "line": 1171
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockReopenReadOnly",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "3308-3323",
          "snippet": "int\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nint\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to create %s\")",
            "fs->dst"
          ],
          "line": 1164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "fs->dst"
          ],
          "line": 1163
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "S_ISDIR",
          "args": [
            "st.st_mode"
          ],
          "line": 1162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to stat bind source %s\")",
            "src"
          ],
          "line": 1158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "src",
            "&st"
          ],
          "line": 1157
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to stat bind target %s\")",
            "fs->dst"
          ],
          "line": 1152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s%s\"",
            "srcprefix",
            "fs->src->path"
          ],
          "line": 1148
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"src=%s dst=%s\"",
            "fs->src->path",
            "fs->dst"
          ],
          "line": 1146
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBind(virDomainFSDefPtr fs,\n                                   const char *srcprefix)\n{\n    char *src = NULL;\n    int ret = -1;\n    struct stat st;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    if (stat(fs->dst, &st) < 0) {\n        if (errno != ENOENT) {\n            virReportSystemError(errno, _(\"Unable to stat bind target %s\"),\n                                 fs->dst);\n            goto cleanup;\n        }\n        /* ENOENT => create the target dir or file */\n        if (stat(src, &st) < 0) {\n            virReportSystemError(errno, _(\"Unable to stat bind source %s\"),\n                                 src);\n            goto cleanup;\n        }\n        if (S_ISDIR(st.st_mode)) {\n            if (virFileMakePath(fs->dst) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to create %s\"),\n                                     fs->dst);\n                goto cleanup;\n            }\n        } else {\n            /* Create Empty file for target mount point */\n            int fd = open(fs->dst, O_WRONLY|O_CREAT|O_NOCTTY|O_NONBLOCK, 0666);\n            if (fd < 0) {\n                if (errno != EEXIST) {\n                    virReportSystemError(errno,\n                                         _(\"Failed to create bind target %s\"),\n                                         fs->dst);\n                    goto cleanup;\n                }\n            }\n            if (VIR_CLOSE(fd) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to close bind target %s\"),\n                                     fs->dst);\n                goto cleanup;\n            }\n        }\n    }\n\n    if (mount(src, fs->dst, \"none\", MS_BIND, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to bind mount directory %s to %s\"),\n                             src, fs->dst);\n        goto cleanup;\n    }\n\n    if (fs->readonly) {\n        VIR_DEBUG(\"Binding %s readonly\", fs->dst);\n        if (mount(src, fs->dst, \"none\", MS_BIND|MS_REMOUNT|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make directory %s readonly\"),\n                                 fs->dst);\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(src);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerSetupDevices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1094-1136",
    "snippet": "static int lxcContainerSetupDevices(char **ttyPaths, size_t nttyPaths)\n{\n    size_t i;\n    const struct {\n        const char *src;\n        const char *dst;\n    } links[] = {\n        { \"/proc/self/fd/0\", \"/dev/stdin\" },\n        { \"/proc/self/fd/1\", \"/dev/stdout\" },\n        { \"/proc/self/fd/2\", \"/dev/stderr\" },\n        { \"/proc/self/fd\", \"/dev/fd\" },\n    };\n\n    for (i = 0; i < G_N_ELEMENTS(links); i++) {\n        if (symlink(links[i].src, links[i].dst) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to symlink device %s to %s\"),\n                                 links[i].dst, links[i].src);\n            return -1;\n        }\n    }\n\n    /* We have private devpts capability, so bind that */\n    if (virFileBindMountDevice(\"/dev/pts/ptmx\", \"/dev/ptmx\") < 0)\n        return -1;\n\n    for (i = 0; i < nttyPaths; i++) {\n        char *tty;\n        tty = g_strdup_printf(\"/dev/tty%zu\", i + 1);\n\n        if (virFileBindMountDevice(ttyPaths[i], tty) < 0) {\n            VIR_FREE(tty);\n            return -1;\n        }\n\n        VIR_FREE(tty);\n\n        if (i == 0 &&\n            virFileBindMountDevice(ttyPaths[i], \"/dev/console\") < 0)\n            return -1;\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virFileBindMountDevice",
          "args": [
            "ttyPaths[i]",
            "\"/dev/console\""
          ],
          "line": 1132
        },
        "resolved": true,
        "details": {
          "function_name": "virFileBindMountDevice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3797-3804",
          "snippet": "int\nvirFileBindMountDevice(const char *src G_GNUC_UNUSED,\n                       const char *dst G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"mount is not supported on this platform.\"));\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileBindMountDevice(const char *src G_GNUC_UNUSED,\n                       const char *dst G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"mount is not supported on this platform.\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tty"
          ],
          "line": 1129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tty"
          ],
          "line": 1125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/dev/tty%zu\"",
            "i + 1"
          ],
          "line": 1122
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to symlink device %s to %s\")",
            "links[i].dst",
            "links[i].src"
          ],
          "line": 1109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to symlink device %s to %s\""
          ],
          "line": 1110
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "symlink",
          "args": [
            "links[i].src",
            "links[i].dst"
          ],
          "line": 1108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "links"
          ],
          "line": 1107
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetupDevices(char **ttyPaths, size_t nttyPaths)\n{\n    size_t i;\n    const struct {\n        const char *src;\n        const char *dst;\n    } links[] = {\n        { \"/proc/self/fd/0\", \"/dev/stdin\" },\n        { \"/proc/self/fd/1\", \"/dev/stdout\" },\n        { \"/proc/self/fd/2\", \"/dev/stderr\" },\n        { \"/proc/self/fd\", \"/dev/fd\" },\n    };\n\n    for (i = 0; i < G_N_ELEMENTS(links); i++) {\n        if (symlink(links[i].src, links[i].dst) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to symlink device %s to %s\"),\n                                 links[i].dst, links[i].src);\n            return -1;\n        }\n    }\n\n    /* We have private devpts capability, so bind that */\n    if (virFileBindMountDevice(\"/dev/pts/ptmx\", \"/dev/ptmx\") < 0)\n        return -1;\n\n    for (i = 0; i < nttyPaths; i++) {\n        char *tty;\n        tty = g_strdup_printf(\"/dev/tty%zu\", i + 1);\n\n        if (virFileBindMountDevice(ttyPaths[i], tty) < 0) {\n            VIR_FREE(tty);\n            return -1;\n        }\n\n        VIR_FREE(tty);\n\n        if (i == 0 &&\n            virFileBindMountDevice(ttyPaths[i], \"/dev/console\") < 0)\n            return -1;\n    }\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerMountFSDevPTS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1061-1092",
    "snippet": "static int lxcContainerMountFSDevPTS(virDomainDefPtr def,\n                                     const char *stateDir)\n{\n    int ret = -1;\n    char *path = NULL;\n    int flags = def->idmap.nuidmap ? MS_BIND : MS_MOVE;\n\n    VIR_DEBUG(\"Mount /dev/pts stateDir=%s\", stateDir);\n\n    path = g_strdup_printf(\"/.oldroot/%s/%s.devpts\", stateDir, def->name);\n\n    if (virFileMakePath(\"/dev/pts\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot create /dev/pts\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Trying to %s %s to /dev/pts\", def->idmap.nuidmap ?\n              \"bind\" : \"move\", path);\n\n    if (mount(path, \"/dev/pts\", \"none\", flags, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount %s on /dev/pts\"),\n                             path);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    VIR_FREE(path);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "path"
          ],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount %s on /dev/pts\")",
            "path"
          ],
          "line": 1082
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to mount %s on /dev/pts\""
          ],
          "line": 1083
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "path",
            "\"/dev/pts\"",
            "\"none\"",
            "flags",
            "NULL"
          ],
          "line": 1081
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Trying to %s %s to /dev/pts\"",
            "def->idmap.nuidmap ?\n              \"bind\" : \"move\"",
            "path"
          ],
          "line": 1078
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Cannot create /dev/pts\")"
          ],
          "line": 1073
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "\"/dev/pts\""
          ],
          "line": 1072
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/.oldroot/%s/%s.devpts\"",
            "stateDir",
            "def->name"
          ],
          "line": 1070
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mount /dev/pts stateDir=%s\"",
            "stateDir"
          ],
          "line": 1068
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSDevPTS(virDomainDefPtr def,\n                                     const char *stateDir)\n{\n    int ret = -1;\n    char *path = NULL;\n    int flags = def->idmap.nuidmap ? MS_BIND : MS_MOVE;\n\n    VIR_DEBUG(\"Mount /dev/pts stateDir=%s\", stateDir);\n\n    path = g_strdup_printf(\"/.oldroot/%s/%s.devpts\", stateDir, def->name);\n\n    if (virFileMakePath(\"/dev/pts\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot create /dev/pts\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Trying to %s %s to /dev/pts\", def->idmap.nuidmap ?\n              \"bind\" : \"move\", path);\n\n    if (mount(path, \"/dev/pts\", \"none\", flags, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount %s on /dev/pts\"),\n                             path);\n        goto cleanup;\n    }\n\n    ret = 0;\n cleanup:\n    VIR_FREE(path);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountFSDev",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1027-1059",
    "snippet": "static int lxcContainerMountFSDev(virDomainDefPtr def,\n                                  const char *stateDir)\n{\n    int ret = -1;\n    char *path = NULL;\n    int flags = def->idmap.nuidmap ? MS_BIND : MS_MOVE;\n\n    VIR_DEBUG(\"Mount /dev/ stateDir=%s\", stateDir);\n\n    path = g_strdup_printf(\"/.oldroot/%s/%s.dev\", stateDir, def->name);\n\n    if (virFileMakePath(\"/dev\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot create /dev\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Trying to %s %s to /dev\", def->idmap.nuidmap ?\n              \"bind\" : \"move\", path);\n\n    if (mount(path, \"/dev\", \"none\", flags, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount %s on /dev\"),\n                             path);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(path);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "path"
          ],
          "line": 1057
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount %s on /dev\")",
            "path"
          ],
          "line": 1048
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to mount %s on /dev\""
          ],
          "line": 1049
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "path",
            "\"/dev\"",
            "\"none\"",
            "flags",
            "NULL"
          ],
          "line": 1047
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Trying to %s %s to /dev\"",
            "def->idmap.nuidmap ?\n              \"bind\" : \"move\"",
            "path"
          ],
          "line": 1044
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Cannot create /dev\")"
          ],
          "line": 1039
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "\"/dev\""
          ],
          "line": 1038
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/.oldroot/%s/%s.dev\"",
            "stateDir",
            "def->name"
          ],
          "line": 1036
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mount /dev/ stateDir=%s\"",
            "stateDir"
          ],
          "line": 1034
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSDev(virDomainDefPtr def,\n                                  const char *stateDir)\n{\n    int ret = -1;\n    char *path = NULL;\n    int flags = def->idmap.nuidmap ? MS_BIND : MS_MOVE;\n\n    VIR_DEBUG(\"Mount /dev/ stateDir=%s\", stateDir);\n\n    path = g_strdup_printf(\"/.oldroot/%s/%s.dev\", stateDir, def->name);\n\n    if (virFileMakePath(\"/dev\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Cannot create /dev\"));\n        goto cleanup;\n    }\n\n    VIR_DEBUG(\"Trying to %s %s to /dev\", def->idmap.nuidmap ?\n              \"bind\" : \"move\", path);\n\n    if (mount(path, \"/dev\", \"none\", flags, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount %s on /dev\"),\n                             path);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FREE(path);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountProcFuse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "1020-1024",
    "snippet": "static int lxcContainerMountProcFuse(virDomainDefPtr def G_GNUC_UNUSED,\n                                     const char *stateDir G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountProcFuse(virDomainDefPtr def G_GNUC_UNUSED,\n                                     const char *stateDir G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerMountProcFuse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "997-1018",
    "snippet": "static int lxcContainerMountProcFuse(virDomainDefPtr def,\n                                     const char *stateDir)\n{\n    int ret;\n    char *meminfo_path = NULL;\n\n    VIR_DEBUG(\"Mount /proc/meminfo stateDir=%s\", stateDir);\n\n    meminfo_path = g_strdup_printf(\"/.oldroot/%s/%s.fuse/meminfo\",\n                                   stateDir,\n                                   def->name);\n\n    if ((ret = mount(meminfo_path, \"/proc/meminfo\",\n                     NULL, MS_BIND, NULL)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount %s on /proc/meminfo\"),\n                             meminfo_path);\n    }\n\n    VIR_FREE(meminfo_path);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "meminfo_path"
          ],
          "line": 1016
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount %s on /proc/meminfo\")",
            "meminfo_path"
          ],
          "line": 1011
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to mount %s on /proc/meminfo\""
          ],
          "line": 1012
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "meminfo_path",
            "\"/proc/meminfo\"",
            "NULL",
            "MS_BIND",
            "NULL"
          ],
          "line": 1009
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/.oldroot/%s/%s.fuse/meminfo\"",
            "stateDir",
            "def->name"
          ],
          "line": 1005
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mount /proc/meminfo stateDir=%s\"",
            "stateDir"
          ],
          "line": 1003
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountProcFuse(virDomainDefPtr def,\n                                     const char *stateDir)\n{\n    int ret;\n    char *meminfo_path = NULL;\n\n    VIR_DEBUG(\"Mount /proc/meminfo stateDir=%s\", stateDir);\n\n    meminfo_path = g_strdup_printf(\"/.oldroot/%s/%s.fuse/meminfo\",\n                                   stateDir,\n                                   def->name);\n\n    if ((ret = mount(meminfo_path, \"/proc/meminfo\",\n                     NULL, MS_BIND, NULL)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount %s on /proc/meminfo\"),\n                             meminfo_path);\n    }\n\n    VIR_FREE(meminfo_path);\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerMountBasicFS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "880-994",
    "snippet": "static int lxcContainerMountBasicFS(bool userns_enabled,\n                                    bool netns_disabled)\n{\n    size_t i;\n    int rc = -1;\n    char* mnt_src = NULL;\n    int mnt_mflags;\n\n    VIR_DEBUG(\"Mounting basic filesystems\");\n\n    for (i = 0; i < G_N_ELEMENTS(lxcBasicMounts); i++) {\n        bool bindOverReadonly;\n        virLXCBasicMountInfo const *mnt = &lxcBasicMounts[i];\n\n        /* When enable userns but disable netns, kernel will\n         * forbid us doing a new fresh mount for sysfs.\n         * So we had to do a bind mount for sysfs instead.\n         */\n        if (userns_enabled && netns_disabled &&\n            STREQ(mnt->src, \"sysfs\")) {\n            mnt_src = g_strdup(\"/sys\");\n            mnt_mflags = MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY|MS_BIND;\n        } else {\n            mnt_src = g_strdup(mnt->src);\n            mnt_mflags = mnt->mflags;\n        }\n\n        VIR_DEBUG(\"Processing %s -> %s\",\n                  mnt_src, mnt->dst);\n\n        if (mnt->skipUnmounted) {\n            char *hostdir;\n            int ret;\n\n            hostdir = g_strdup_printf(\"/.oldroot%s\", mnt->dst);\n\n            ret = virFileIsMountPoint(hostdir);\n            VIR_FREE(hostdir);\n            if (ret < 0)\n                goto cleanup;\n\n            if (ret == 0) {\n                VIR_DEBUG(\"Skipping '%s' which isn't mounted in host\",\n                          mnt->dst);\n                VIR_FREE(mnt_src);\n                continue;\n            }\n        }\n\n        if (mnt->skipUserNS && userns_enabled) {\n            VIR_DEBUG(\"Skipping due to user ns enablement\");\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        /* Skip mounts with missing source without shouting: it may be a\n         * missing folder in /proc due to the absence of a kernel feature */\n        if (STRPREFIX(mnt_src, \"/\") && !virFileExists(mnt_src)) {\n            VIR_DEBUG(\"Skipping due to missing source: %s\", mnt_src);\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        if (mnt->skipNoNetns && netns_disabled) {\n            VIR_DEBUG(\"Skipping due to absence of network namespace\");\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        if (virFileMakePath(mnt->dst) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mkdir %s\"),\n                                 mnt->dst);\n            goto cleanup;\n        }\n\n        /*\n         * We can't immediately set the MS_RDONLY flag when mounting filesystems\n         * because (in at least some kernel versions) this will propagate back\n         * to the original mount in the host OS, turning it readonly too. Thus\n         * we mount the filesystem in read-write mode initially, and then do a\n         * separate read-only bind mount on top of that.\n         */\n        bindOverReadonly = !!(mnt_mflags & MS_RDONLY);\n\n        VIR_DEBUG(\"Mount %s on %s type=%s flags=0x%x\",\n                  mnt_src, mnt->dst, mnt->type, mnt_mflags & ~MS_RDONLY);\n        if (mount(mnt_src, mnt->dst, mnt->type, mnt_mflags & ~MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mount %s on %s type %s flags=0x%x\"),\n                                 mnt_src, mnt->dst, NULLSTR(mnt->type),\n                                 mnt_mflags & ~MS_RDONLY);\n            goto cleanup;\n        }\n\n        if (bindOverReadonly &&\n            mount(mnt_src, mnt->dst, \"none\",\n                  MS_BIND|MS_REMOUNT|mnt_mflags|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to re-mount %s on %s flags=0x%x\"),\n                                 mnt_src, mnt->dst,\n                                 MS_BIND|MS_REMOUNT|MS_RDONLY);\n            goto cleanup;\n        }\n\n        VIR_FREE(mnt_src);\n    }\n\n    rc = 0;\n\n cleanup:\n    VIR_FREE(mnt_src);\n    VIR_DEBUG(\"rc=%d\", rc);\n    return rc;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const virLXCBasicMountInfo lxcBasicMounts[] = {\n    { \"proc\", \"/proc\", \"proc\", MS_NOSUID|MS_NOEXEC|MS_NODEV, false, false, false },\n    { \"/proc/sys\", \"/proc/sys\", \"none\", MS_BIND|MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"/.oldroot/proc/sys/net/ipv4\", \"/proc/sys/net/ipv4\", \"none\", MS_BIND, false, false, true },\n    { \"/.oldroot/proc/sys/net/ipv6\", \"/proc/sys/net/ipv6\", \"none\", MS_BIND, false, false, true },\n    { \"sysfs\", \"/sys\", \"sysfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"securityfs\", \"/sys/kernel/security\", \"securityfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#if WITH_SELINUX\n    { SELINUX_MOUNT, SELINUX_MOUNT, \"selinuxfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#endif\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"rc=%d\"",
            "rc"
          ],
          "line": 992
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "mnt_src"
          ],
          "line": 991
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "mnt_src"
          ],
          "line": 985
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to re-mount %s on %s flags=0x%x\")",
            "mnt_src",
            "mnt->dst",
            "MS_BIND|MS_REMOUNT|MS_RDONLY"
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to re-mount %s on %s flags=0x%x\""
          ],
          "line": 979
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "mnt_src",
            "mnt->dst",
            "\"none\"",
            "MS_BIND|MS_REMOUNT|mnt_mflags|MS_RDONLY",
            "NULL"
          ],
          "line": 976
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount %s on %s type %s flags=0x%x\")",
            "mnt_src",
            "mnt->dst",
            "NULLSTR(mnt->type)",
            "mnt_mflags & ~MS_RDONLY"
          ],
          "line": 968
        },
        "resolved": true,
        "details": {
          "function_name": "virReportSystemErrorFull",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "1322-1360",
          "snippet": "void virReportSystemErrorFull(int domcode,\n                              int theerrno,\n                              const char *filename,\n                              const char *funcname,\n                              size_t linenr,\n                              const char *fmt, ...)\n{\n    int save_errno = errno;\n    char msgDetailBuf[VIR_ERROR_MAX_LENGTH];\n\n    const char *errnoDetail = g_strerror(theerrno);\n    const char *msg = virErrorMsg(VIR_ERR_SYSTEM_ERROR, fmt);\n    const char *msgDetail = NULL;\n\n    if (fmt) {\n        va_list args;\n        int n;\n\n        va_start(args, fmt);\n        n = g_vsnprintf(msgDetailBuf, sizeof(msgDetailBuf), fmt, args);\n        va_end(args);\n\n        size_t len = strlen(errnoDetail);\n        if (0 <= n && n + 2 + len < sizeof(msgDetailBuf)) {\n          strcpy(msgDetailBuf + n, \": \");\n          n += 2;\n          strcpy(msgDetailBuf + n, errnoDetail);\n          msgDetail = msgDetailBuf;\n        }\n    }\n\n    if (!msgDetail)\n        msgDetail = errnoDetail;\n\n    virRaiseErrorFull(filename, funcname, linenr,\n                      domcode, VIR_ERR_SYSTEM_ERROR, VIR_ERR_ERROR,\n                      msg, msgDetail, NULL, theerrno, -1, msg, msgDetail);\n    errno = save_errno;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid virReportSystemErrorFull(int domcode,\n                              int theerrno,\n                              const char *filename,\n                              const char *funcname,\n                              size_t linenr,\n                              const char *fmt, ...)\n{\n    int save_errno = errno;\n    char msgDetailBuf[VIR_ERROR_MAX_LENGTH];\n\n    const char *errnoDetail = g_strerror(theerrno);\n    const char *msg = virErrorMsg(VIR_ERR_SYSTEM_ERROR, fmt);\n    const char *msgDetail = NULL;\n\n    if (fmt) {\n        va_list args;\n        int n;\n\n        va_start(args, fmt);\n        n = g_vsnprintf(msgDetailBuf, sizeof(msgDetailBuf), fmt, args);\n        va_end(args);\n\n        size_t len = strlen(errnoDetail);\n        if (0 <= n && n + 2 + len < sizeof(msgDetailBuf)) {\n          strcpy(msgDetailBuf + n, \": \");\n          n += 2;\n          strcpy(msgDetailBuf + n, errnoDetail);\n          msgDetail = msgDetailBuf;\n        }\n    }\n\n    if (!msgDetail)\n        msgDetail = errnoDetail;\n\n    virRaiseErrorFull(filename, funcname, linenr,\n                      domcode, VIR_ERR_SYSTEM_ERROR, VIR_ERR_ERROR,\n                      msg, msgDetail, NULL, theerrno, -1, msg, msgDetail);\n    errno = save_errno;\n}"
        }
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "mnt->type"
          ],
          "line": 970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "mnt_src",
            "mnt->dst",
            "mnt->type",
            "mnt_mflags & ~MS_RDONLY",
            "NULL"
          ],
          "line": 967
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mount %s on %s type=%s flags=0x%x\"",
            "mnt_src",
            "mnt->dst",
            "mnt->type",
            "mnt_mflags & ~MS_RDONLY"
          ],
          "line": 965
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mkdir %s\")",
            "mnt->dst"
          ],
          "line": 950
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "mnt->dst"
          ],
          "line": 949
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "mnt_src"
          ],
          "line": 945
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Skipping due to absence of network namespace\""
          ],
          "line": 944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "mnt_src"
          ],
          "line": 939
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Skipping due to missing source: %s\"",
            "mnt_src"
          ],
          "line": 938
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "mnt_src"
          ],
          "line": 937
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "mnt_src",
            "\"/\""
          ],
          "line": 937
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "mnt_src"
          ],
          "line": 931
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Skipping due to user ns enablement\""
          ],
          "line": 930
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "mnt_src"
          ],
          "line": 924
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Skipping '%s' which isn't mounted in host\"",
            "mnt->dst"
          ],
          "line": 922
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "hostdir"
          ],
          "line": 917
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileIsMountPoint",
          "args": [
            "hostdir"
          ],
          "line": 916
        },
        "resolved": true,
        "details": {
          "function_name": "virFileIsMountPoint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1910-1944",
          "snippet": "int virFileIsMountPoint(const char *file)\n{\n    g_autofree char *parent = NULL;\n    int ret;\n    struct stat sb1, sb2;\n\n    parent = g_path_get_dirname(file);\n\n    VIR_DEBUG(\"Comparing '%s' to '%s'\", file, parent);\n\n    if (stat(file, &sb1) < 0) {\n        if (errno == ENOENT)\n            return 0;\n        else\n            virReportSystemError(errno,\n                                 _(\"Cannot stat '%s'\"),\n                                 file);\n        return -1;\n    }\n\n    if (stat(parent, &sb2) < 0) {\n        virReportSystemError(errno,\n                             _(\"Cannot stat '%s'\"),\n                             parent);\n        return -1;\n    }\n\n    if (!S_ISDIR(sb1.st_mode))\n        return 0;\n\n    ret = sb1.st_dev != sb2.st_dev;\n    VIR_DEBUG(\"Is mount %d\", ret);\n\n    return ret;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileIsMountPoint(const char *file)\n{\n    g_autofree char *parent = NULL;\n    int ret;\n    struct stat sb1, sb2;\n\n    parent = g_path_get_dirname(file);\n\n    VIR_DEBUG(\"Comparing '%s' to '%s'\", file, parent);\n\n    if (stat(file, &sb1) < 0) {\n        if (errno == ENOENT)\n            return 0;\n        else\n            virReportSystemError(errno,\n                                 _(\"Cannot stat '%s'\"),\n                                 file);\n        return -1;\n    }\n\n    if (stat(parent, &sb2) < 0) {\n        virReportSystemError(errno,\n                             _(\"Cannot stat '%s'\"),\n                             parent);\n        return -1;\n    }\n\n    if (!S_ISDIR(sb1.st_mode))\n        return 0;\n\n    ret = sb1.st_dev != sb2.st_dev;\n    VIR_DEBUG(\"Is mount %d\", ret);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/.oldroot%s\"",
            "mnt->dst"
          ],
          "line": 914
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Processing %s -> %s\"",
            "mnt_src",
            "mnt->dst"
          ],
          "line": 907
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "mnt->src",
            "\"sysfs\""
          ],
          "line": 899
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "lxcBasicMounts"
          ],
          "line": 890
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Mounting basic filesystems\""
          ],
          "line": 888
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic const virLXCBasicMountInfo lxcBasicMounts[] = {\n    { \"proc\", \"/proc\", \"proc\", MS_NOSUID|MS_NOEXEC|MS_NODEV, false, false, false },\n    { \"/proc/sys\", \"/proc/sys\", \"none\", MS_BIND|MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"/.oldroot/proc/sys/net/ipv4\", \"/proc/sys/net/ipv4\", \"none\", MS_BIND, false, false, true },\n    { \"/.oldroot/proc/sys/net/ipv6\", \"/proc/sys/net/ipv6\", \"none\", MS_BIND, false, false, true },\n    { \"sysfs\", \"/sys\", \"sysfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"securityfs\", \"/sys/kernel/security\", \"securityfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#if WITH_SELINUX\n    { SELINUX_MOUNT, SELINUX_MOUNT, \"selinuxfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#endif\n};\n\nstatic int lxcContainerMountBasicFS(bool userns_enabled,\n                                    bool netns_disabled)\n{\n    size_t i;\n    int rc = -1;\n    char* mnt_src = NULL;\n    int mnt_mflags;\n\n    VIR_DEBUG(\"Mounting basic filesystems\");\n\n    for (i = 0; i < G_N_ELEMENTS(lxcBasicMounts); i++) {\n        bool bindOverReadonly;\n        virLXCBasicMountInfo const *mnt = &lxcBasicMounts[i];\n\n        /* When enable userns but disable netns, kernel will\n         * forbid us doing a new fresh mount for sysfs.\n         * So we had to do a bind mount for sysfs instead.\n         */\n        if (userns_enabled && netns_disabled &&\n            STREQ(mnt->src, \"sysfs\")) {\n            mnt_src = g_strdup(\"/sys\");\n            mnt_mflags = MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY|MS_BIND;\n        } else {\n            mnt_src = g_strdup(mnt->src);\n            mnt_mflags = mnt->mflags;\n        }\n\n        VIR_DEBUG(\"Processing %s -> %s\",\n                  mnt_src, mnt->dst);\n\n        if (mnt->skipUnmounted) {\n            char *hostdir;\n            int ret;\n\n            hostdir = g_strdup_printf(\"/.oldroot%s\", mnt->dst);\n\n            ret = virFileIsMountPoint(hostdir);\n            VIR_FREE(hostdir);\n            if (ret < 0)\n                goto cleanup;\n\n            if (ret == 0) {\n                VIR_DEBUG(\"Skipping '%s' which isn't mounted in host\",\n                          mnt->dst);\n                VIR_FREE(mnt_src);\n                continue;\n            }\n        }\n\n        if (mnt->skipUserNS && userns_enabled) {\n            VIR_DEBUG(\"Skipping due to user ns enablement\");\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        /* Skip mounts with missing source without shouting: it may be a\n         * missing folder in /proc due to the absence of a kernel feature */\n        if (STRPREFIX(mnt_src, \"/\") && !virFileExists(mnt_src)) {\n            VIR_DEBUG(\"Skipping due to missing source: %s\", mnt_src);\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        if (mnt->skipNoNetns && netns_disabled) {\n            VIR_DEBUG(\"Skipping due to absence of network namespace\");\n            VIR_FREE(mnt_src);\n            continue;\n        }\n\n        if (virFileMakePath(mnt->dst) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mkdir %s\"),\n                                 mnt->dst);\n            goto cleanup;\n        }\n\n        /*\n         * We can't immediately set the MS_RDONLY flag when mounting filesystems\n         * because (in at least some kernel versions) this will propagate back\n         * to the original mount in the host OS, turning it readonly too. Thus\n         * we mount the filesystem in read-write mode initially, and then do a\n         * separate read-only bind mount on top of that.\n         */\n        bindOverReadonly = !!(mnt_mflags & MS_RDONLY);\n\n        VIR_DEBUG(\"Mount %s on %s type=%s flags=0x%x\",\n                  mnt_src, mnt->dst, mnt->type, mnt_mflags & ~MS_RDONLY);\n        if (mount(mnt_src, mnt->dst, mnt->type, mnt_mflags & ~MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to mount %s on %s type %s flags=0x%x\"),\n                                 mnt_src, mnt->dst, NULLSTR(mnt->type),\n                                 mnt_mflags & ~MS_RDONLY);\n            goto cleanup;\n        }\n\n        if (bindOverReadonly &&\n            mount(mnt_src, mnt->dst, \"none\",\n                  MS_BIND|MS_REMOUNT|mnt_mflags|MS_RDONLY, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to re-mount %s on %s flags=0x%x\"),\n                                 mnt_src, mnt->dst,\n                                 MS_BIND|MS_REMOUNT|MS_RDONLY);\n            goto cleanup;\n        }\n\n        VIR_FREE(mnt_src);\n    }\n\n    rc = 0;\n\n cleanup:\n    VIR_FREE(mnt_src);\n    VIR_DEBUG(\"rc=%d\", rc);\n    return rc;\n}"
  },
  {
    "function_name": "lxcContainerSetReadOnly",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "821-877",
    "snippet": "static int lxcContainerSetReadOnly(void)\n{\n    FILE *procmnt;\n    struct mntent mntent;\n    char mntbuf[1024];\n    int ret = -1;\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n\n    if (!(procmnt = setmntent(\"/proc/mounts\", \"r\"))) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to read /proc/mounts\"));\n        return -1;\n    }\n\n    while (getmntent_r(procmnt, &mntent, mntbuf, sizeof(mntbuf)) != NULL) {\n        char *tmp;\n        if (STREQ(mntent.mnt_dir, \"/\") ||\n            STREQ(mntent.mnt_dir, \"/.oldroot\") ||\n            STRPREFIX(mntent.mnt_dir, \"/.oldroot/\") ||\n            lxcIsBasicMountLocation(mntent.mnt_dir))\n            continue;\n\n        tmp = g_strdup(mntent.mnt_dir);\n\n        if (VIR_APPEND_ELEMENT(mounts, nmounts, tmp) < 0) {\n            VIR_FREE(tmp);\n            goto cleanup;\n        }\n    }\n\n    if (!mounts) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    qsort(mounts, nmounts, sizeof(mounts[0]),\n          virStringSortRevCompare);\n\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Bind readonly %s\", mounts[i]);\n        if (mount(mounts[i], mounts[i], \"none\", MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make mount %s readonly\"),\n                                 mounts[i]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n cleanup:\n    virStringListFreeCount(mounts, nmounts);\n    endmntent(procmnt);\n    return ret;\n\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "endmntent",
          "args": [
            "procmnt"
          ],
          "line": 874
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStringListFreeCount",
          "args": [
            "mounts",
            "nmounts"
          ],
          "line": 873
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListFreeCount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "334-347",
          "snippet": "void\nvirStringListFreeCount(char **strings,\n                       size_t count)\n{\n    size_t i;\n\n    if (!strings)\n        return;\n\n    for (i = 0; i < count; i++)\n        VIR_FREE(strings[i]);\n\n    VIR_FREE(strings);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid\nvirStringListFreeCount(char **strings,\n                       size_t count)\n{\n    size_t i;\n\n    if (!strings)\n        return;\n\n    for (i = 0; i < count; i++)\n        VIR_FREE(strings[i]);\n\n    VIR_FREE(strings);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to make mount %s readonly\")",
            "mounts[i]"
          ],
          "line": 864
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to make mount %s readonly\""
          ],
          "line": 865
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "mounts[i]",
            "mounts[i]",
            "\"none\"",
            "MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT",
            "NULL"
          ],
          "line": 863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Bind readonly %s\"",
            "mounts[i]"
          ],
          "line": 862
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qsort",
          "args": [
            "mounts",
            "nmounts",
            "sizeof(mounts[0])",
            "virStringSortRevCompare"
          ],
          "line": 858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 848
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_APPEND_ELEMENT",
          "args": [
            "mounts",
            "nmounts",
            "tmp"
          ],
          "line": 847
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "mntent.mnt_dir"
          ],
          "line": 845
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcIsBasicMountLocation",
          "args": [
            "mntent.mnt_dir"
          ],
          "line": 842
        },
        "resolved": true,
        "details": {
          "function_name": "lxcIsBasicMountLocation",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "808-818",
          "snippet": "bool lxcIsBasicMountLocation(const char *path)\n{\n    size_t i;\n\n    for (i = 0; i < G_N_ELEMENTS(lxcBasicMounts); i++) {\n        if (STREQ(path, lxcBasicMounts[i].dst))\n            return true;\n    }\n\n    return false;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static const virLXCBasicMountInfo lxcBasicMounts[] = {\n    { \"proc\", \"/proc\", \"proc\", MS_NOSUID|MS_NOEXEC|MS_NODEV, false, false, false },\n    { \"/proc/sys\", \"/proc/sys\", \"none\", MS_BIND|MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"/.oldroot/proc/sys/net/ipv4\", \"/proc/sys/net/ipv4\", \"none\", MS_BIND, false, false, true },\n    { \"/.oldroot/proc/sys/net/ipv6\", \"/proc/sys/net/ipv6\", \"none\", MS_BIND, false, false, true },\n    { \"sysfs\", \"/sys\", \"sysfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"securityfs\", \"/sys/kernel/security\", \"securityfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#if WITH_SELINUX\n    { SELINUX_MOUNT, SELINUX_MOUNT, \"selinuxfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#endif\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic const virLXCBasicMountInfo lxcBasicMounts[] = {\n    { \"proc\", \"/proc\", \"proc\", MS_NOSUID|MS_NOEXEC|MS_NODEV, false, false, false },\n    { \"/proc/sys\", \"/proc/sys\", \"none\", MS_BIND|MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"/.oldroot/proc/sys/net/ipv4\", \"/proc/sys/net/ipv4\", \"none\", MS_BIND, false, false, true },\n    { \"/.oldroot/proc/sys/net/ipv6\", \"/proc/sys/net/ipv6\", \"none\", MS_BIND, false, false, true },\n    { \"sysfs\", \"/sys\", \"sysfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"securityfs\", \"/sys/kernel/security\", \"securityfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#if WITH_SELINUX\n    { SELINUX_MOUNT, SELINUX_MOUNT, \"selinuxfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#endif\n};\n\nbool lxcIsBasicMountLocation(const char *path)\n{\n    size_t i;\n\n    for (i = 0; i < G_N_ELEMENTS(lxcBasicMounts); i++) {\n        if (STREQ(path, lxcBasicMounts[i].dst))\n            return true;\n    }\n\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "mntent.mnt_dir",
            "\"/.oldroot/\""
          ],
          "line": 841
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "mntent.mnt_dir",
            "\"/.oldroot\""
          ],
          "line": 840
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "mntent.mnt_dir",
            "\"/\""
          ],
          "line": 839
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getmntent_r",
          "args": [
            "procmnt",
            "&mntent",
            "mntbuf",
            "sizeof(mntbuf)"
          ],
          "line": 837
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Failed to read /proc/mounts\")"
          ],
          "line": 832
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setmntent",
          "args": [
            "\"/proc/mounts\"",
            "\"r\""
          ],
          "line": 831
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetReadOnly(void)\n{\n    FILE *procmnt;\n    struct mntent mntent;\n    char mntbuf[1024];\n    int ret = -1;\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n\n    if (!(procmnt = setmntent(\"/proc/mounts\", \"r\"))) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to read /proc/mounts\"));\n        return -1;\n    }\n\n    while (getmntent_r(procmnt, &mntent, mntbuf, sizeof(mntbuf)) != NULL) {\n        char *tmp;\n        if (STREQ(mntent.mnt_dir, \"/\") ||\n            STREQ(mntent.mnt_dir, \"/.oldroot\") ||\n            STRPREFIX(mntent.mnt_dir, \"/.oldroot/\") ||\n            lxcIsBasicMountLocation(mntent.mnt_dir))\n            continue;\n\n        tmp = g_strdup(mntent.mnt_dir);\n\n        if (VIR_APPEND_ELEMENT(mounts, nmounts, tmp) < 0) {\n            VIR_FREE(tmp);\n            goto cleanup;\n        }\n    }\n\n    if (!mounts) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    qsort(mounts, nmounts, sizeof(mounts[0]),\n          virStringSortRevCompare);\n\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Bind readonly %s\", mounts[i]);\n        if (mount(mounts[i], mounts[i], \"none\", MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make mount %s readonly\"),\n                                 mounts[i]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n cleanup:\n    virStringListFreeCount(mounts, nmounts);\n    endmntent(procmnt);\n    return ret;\n\n}"
  },
  {
    "function_name": "lxcIsBasicMountLocation",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "808-818",
    "snippet": "bool lxcIsBasicMountLocation(const char *path)\n{\n    size_t i;\n\n    for (i = 0; i < G_N_ELEMENTS(lxcBasicMounts); i++) {\n        if (STREQ(path, lxcBasicMounts[i].dst))\n            return true;\n    }\n\n    return false;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static const virLXCBasicMountInfo lxcBasicMounts[] = {\n    { \"proc\", \"/proc\", \"proc\", MS_NOSUID|MS_NOEXEC|MS_NODEV, false, false, false },\n    { \"/proc/sys\", \"/proc/sys\", \"none\", MS_BIND|MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"/.oldroot/proc/sys/net/ipv4\", \"/proc/sys/net/ipv4\", \"none\", MS_BIND, false, false, true },\n    { \"/.oldroot/proc/sys/net/ipv6\", \"/proc/sys/net/ipv6\", \"none\", MS_BIND, false, false, true },\n    { \"sysfs\", \"/sys\", \"sysfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"securityfs\", \"/sys/kernel/security\", \"securityfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#if WITH_SELINUX\n    { SELINUX_MOUNT, SELINUX_MOUNT, \"selinuxfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#endif\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "path",
            "lxcBasicMounts[i].dst"
          ],
          "line": 813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "lxcBasicMounts"
          ],
          "line": 812
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic const virLXCBasicMountInfo lxcBasicMounts[] = {\n    { \"proc\", \"/proc\", \"proc\", MS_NOSUID|MS_NOEXEC|MS_NODEV, false, false, false },\n    { \"/proc/sys\", \"/proc/sys\", \"none\", MS_BIND|MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"/.oldroot/proc/sys/net/ipv4\", \"/proc/sys/net/ipv4\", \"none\", MS_BIND, false, false, true },\n    { \"/.oldroot/proc/sys/net/ipv6\", \"/proc/sys/net/ipv6\", \"none\", MS_BIND, false, false, true },\n    { \"sysfs\", \"/sys\", \"sysfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, false, false, false },\n    { \"securityfs\", \"/sys/kernel/security\", \"securityfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#if WITH_SELINUX\n    { SELINUX_MOUNT, SELINUX_MOUNT, \"selinuxfs\", MS_NOSUID|MS_NOEXEC|MS_NODEV|MS_RDONLY, true, true, false },\n#endif\n};\n\nbool lxcIsBasicMountLocation(const char *path)\n{\n    size_t i;\n\n    for (i = 0; i < G_N_ELEMENTS(lxcBasicMounts); i++) {\n        if (STREQ(path, lxcBasicMounts[i].dst))\n            return true;\n    }\n\n    return false;\n}"
  },
  {
    "function_name": "lxcContainerPivotRoot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "694-782",
    "snippet": "static int lxcContainerPivotRoot(virDomainFSDefPtr root)\n{\n    int ret;\n    char *oldroot = NULL, *newroot = NULL;\n\n    ret = -1;\n\n    VIR_DEBUG(\"Pivot via %s\", root->src->path);\n\n    /* root->parent must be private, so make / private. */\n    if (mount(\"\", \"/\", \"none\", MS_PRIVATE|MS_REC, NULL) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to make root private\"));\n        goto err;\n    }\n\n    oldroot = g_strdup_printf(\"%s/.oldroot\", root->src->path);\n\n    if (virFileMakePath(oldroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             oldroot);\n        goto err;\n    }\n\n    /* Create a tmpfs root since old and new roots must be\n     * on separate filesystems */\n    if (mount(\"tmprootfs\", oldroot, \"tmpfs\", 0, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount empty tmpfs at %s\"),\n                             oldroot);\n        goto err;\n    }\n\n    /* Create a directory called 'new' in tmpfs */\n    newroot = g_strdup_printf(\"%s/new\", oldroot);\n\n    if (virFileMakePath(newroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             newroot);\n        goto err;\n    }\n\n    /* ... and mount our root onto it */\n    if (mount(root->src->path, newroot, \"none\", MS_BIND|MS_REC, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to bind %s to new root %s\"),\n                             root->src->path, newroot);\n        goto err;\n    }\n\n    if (root->readonly) {\n        if (mount(root->src->path, newroot, \"none\", MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make new root %s readonly\"),\n                                 root->src->path);\n            goto err;\n        }\n    }\n\n    /* Now we chdir into the tmpfs, then pivot into the\n     * root->src bind-mounted onto '/new' */\n    if (chdir(newroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to chdir into %s\"), newroot);\n        goto err;\n    }\n\n    /* The old root directory will live at /.oldroot after\n     * this and will soon be unmounted completely */\n    if (pivot_root(\".\", \".oldroot\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to pivot root\"));\n        goto err;\n    }\n\n    /* CWD is undefined after pivot_root, so go to / */\n    if (chdir(\"/\") < 0)\n        goto err;\n\n    ret = 0;\n\n err:\n    VIR_FREE(oldroot);\n    VIR_FREE(newroot);\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "newroot"
          ],
          "line": 779
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "oldroot"
          ],
          "line": 778
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "\"/\""
          ],
          "line": 772
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Failed to pivot root\")"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to pivot root\""
          ],
          "line": 767
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pivot_root",
          "args": [
            "\".\"",
            "\".oldroot\""
          ],
          "line": 765
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to chdir into %s\")",
            "newroot"
          ],
          "line": 758
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "chdir",
          "args": [
            "newroot"
          ],
          "line": 757
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to make new root %s readonly\")",
            "root->src->path"
          ],
          "line": 748
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "root->src->path",
            "newroot",
            "\"none\"",
            "MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT",
            "NULL"
          ],
          "line": 747
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to bind %s to new root %s\")",
            "root->src->path",
            "newroot"
          ],
          "line": 740
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "root->src->path",
            "newroot",
            "\"none\"",
            "MS_BIND|MS_REC",
            "NULL"
          ],
          "line": 739
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to create %s\")",
            "newroot"
          ],
          "line": 732
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileMakePath",
          "args": [
            "newroot"
          ],
          "line": 731
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3076-3080",
          "snippet": "int\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePath(const char *path)\n{\n    return virFileMakePathWithMode(path, 0777);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/new\"",
            "oldroot"
          ],
          "line": 729
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to mount empty tmpfs at %s\")",
            "oldroot"
          ],
          "line": 722
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "\"tmprootfs\"",
            "oldroot",
            "\"tmpfs\"",
            "0",
            "NULL"
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to create %s\")",
            "oldroot"
          ],
          "line": 713
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Failed to make root private\")"
          ],
          "line": 705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mount",
          "args": [
            "\"\"",
            "\"/\"",
            "\"none\"",
            "MS_PRIVATE|MS_REC",
            "NULL"
          ],
          "line": 704
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Pivot via %s\"",
            "root->src->path"
          ],
          "line": 701
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerPivotRoot(virDomainFSDefPtr root)\n{\n    int ret;\n    char *oldroot = NULL, *newroot = NULL;\n\n    ret = -1;\n\n    VIR_DEBUG(\"Pivot via %s\", root->src->path);\n\n    /* root->parent must be private, so make / private. */\n    if (mount(\"\", \"/\", \"none\", MS_PRIVATE|MS_REC, NULL) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to make root private\"));\n        goto err;\n    }\n\n    oldroot = g_strdup_printf(\"%s/.oldroot\", root->src->path);\n\n    if (virFileMakePath(oldroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             oldroot);\n        goto err;\n    }\n\n    /* Create a tmpfs root since old and new roots must be\n     * on separate filesystems */\n    if (mount(\"tmprootfs\", oldroot, \"tmpfs\", 0, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to mount empty tmpfs at %s\"),\n                             oldroot);\n        goto err;\n    }\n\n    /* Create a directory called 'new' in tmpfs */\n    newroot = g_strdup_printf(\"%s/new\", oldroot);\n\n    if (virFileMakePath(newroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to create %s\"),\n                             newroot);\n        goto err;\n    }\n\n    /* ... and mount our root onto it */\n    if (mount(root->src->path, newroot, \"none\", MS_BIND|MS_REC, NULL) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to bind %s to new root %s\"),\n                             root->src->path, newroot);\n        goto err;\n    }\n\n    if (root->readonly) {\n        if (mount(root->src->path, newroot, \"none\", MS_BIND|MS_REC|MS_RDONLY|MS_REMOUNT, NULL) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to make new root %s readonly\"),\n                                 root->src->path);\n            goto err;\n        }\n    }\n\n    /* Now we chdir into the tmpfs, then pivot into the\n     * root->src bind-mounted onto '/new' */\n    if (chdir(newroot) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to chdir into %s\"), newroot);\n        goto err;\n    }\n\n    /* The old root directory will live at /.oldroot after\n     * this and will soon be unmounted completely */\n    if (pivot_root(\".\", \".oldroot\") < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Failed to pivot root\"));\n        goto err;\n    }\n\n    /* CWD is undefined after pivot_root, so go to / */\n    if (chdir(\"/\") < 0)\n        goto err;\n\n    ret = 0;\n\n err:\n    VIR_FREE(oldroot);\n    VIR_FREE(newroot);\n\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerPrepareRoot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "647-692",
    "snippet": "static int lxcContainerPrepareRoot(virDomainDefPtr def,\n                                   virDomainFSDefPtr root,\n                                   const char *sec_mount_options)\n{\n    char *dst;\n    char *tmp;\n\n    VIR_DEBUG(\"Prepare root %d\", root->type);\n\n    if (root->type == VIR_DOMAIN_FS_TYPE_MOUNT)\n        return 0;\n\n    if (root->type == VIR_DOMAIN_FS_TYPE_FILE) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unexpected root filesystem without loop device\"));\n        return -1;\n    }\n\n    if (root->type != VIR_DOMAIN_FS_TYPE_BLOCK) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported root filesystem type %s\"),\n                       virDomainFSTypeToString(root->type));\n        return -1;\n    }\n\n    if (lxcContainerResolveSymlinks(root, false) < 0)\n        return -1;\n\n    dst = g_strdup_printf(\"%s/%s.root\", LXC_STATE_DIR, def->name);\n\n    tmp = root->dst;\n    root->dst = dst;\n\n    if (lxcContainerMountFSBlock(root, \"\", sec_mount_options) < 0) {\n        root->dst = tmp;\n        VIR_FREE(dst);\n        return -1;\n    }\n\n    root->dst = tmp;\n    root->type = VIR_DOMAIN_FS_TYPE_MOUNT;\n    VIR_FREE(root->src->path);\n    root->src->path = dst;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "root->src->path"
          ],
          "line": 688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "dst"
          ],
          "line": 682
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lxcContainerMountFSBlock",
          "args": [
            "root",
            "\"\"",
            "sec_mount_options"
          ],
          "line": 680
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerMountFSBlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "1471-1488",
          "snippet": "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options)\n{\n    char *src = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    ret = lxcContainerMountFSBlockHelper(fs, src, srcprefix, sec_mount_options);\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d\", ret);\n\n    VIR_FREE(src);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options)\n{\n    char *src = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"src=%s dst=%s\", fs->src->path, fs->dst);\n\n    src = g_strdup_printf(\"%s%s\", srcprefix, fs->src->path);\n\n    ret = lxcContainerMountFSBlockHelper(fs, src, srcprefix, sec_mount_options);\n\n    VIR_DEBUG(\"Done mounting filesystem ret=%d\", ret);\n\n    VIR_FREE(src);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s.root\"",
            "LXC_STATE_DIR",
            "def->name"
          ],
          "line": 675
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerResolveSymlinks",
          "args": [
            "root",
            "false"
          ],
          "line": 672
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerResolveSymlinks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "604-645",
          "snippet": "static int lxcContainerResolveSymlinks(virDomainFSDefPtr fs, bool gentle)\n{\n    char *newroot;\n\n    if (!fs->src || !fs->src->path || fs->symlinksResolved)\n        return 0;\n\n    if (access(fs->src->path, F_OK)) {\n        if (gentle) {\n            /* Just ignore the error for the while, we'll try again later */\n            VIR_DEBUG(\"Skipped unaccessible '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to access '%s'\"), fs->src->path);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Resolving '%s'\", fs->src->path);\n    if (virFileResolveAllLinks(fs->src->path, &newroot) < 0) {\n        if (gentle) {\n            VIR_DEBUG(\"Skipped non-resolvable '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to resolve symlink at %s\"),\n                                 fs->src->path);\n        }\n        return -1;\n    }\n\n    /* Mark it resolved to skip it the next time */\n    fs->symlinksResolved = true;\n\n    VIR_DEBUG(\"Resolved '%s' to %s\", fs->src->path, newroot);\n\n    VIR_FREE(fs->src->path);\n    fs->src->path = newroot;\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerResolveSymlinks(virDomainFSDefPtr fs, bool gentle)\n{\n    char *newroot;\n\n    if (!fs->src || !fs->src->path || fs->symlinksResolved)\n        return 0;\n\n    if (access(fs->src->path, F_OK)) {\n        if (gentle) {\n            /* Just ignore the error for the while, we'll try again later */\n            VIR_DEBUG(\"Skipped unaccessible '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to access '%s'\"), fs->src->path);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Resolving '%s'\", fs->src->path);\n    if (virFileResolveAllLinks(fs->src->path, &newroot) < 0) {\n        if (gentle) {\n            VIR_DEBUG(\"Skipped non-resolvable '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to resolve symlink at %s\"),\n                                 fs->src->path);\n        }\n        return -1;\n    }\n\n    /* Mark it resolved to skip it the next time */\n    fs->symlinksResolved = true;\n\n    VIR_DEBUG(\"Resolved '%s' to %s\", fs->src->path, newroot);\n\n    VIR_FREE(fs->src->path);\n    fs->src->path = newroot;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "_(\"Unsupported root filesystem type %s\")",
            "virDomainFSTypeToString(root->type)"
          ],
          "line": 666
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainFSTypeToString",
          "args": [
            "root->type"
          ],
          "line": 668
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unsupported root filesystem type %s\""
          ],
          "line": 667
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Unexpected root filesystem without loop device\")"
          ],
          "line": 660
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Prepare root %d\"",
            "root->type"
          ],
          "line": 654
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerMountFSBlock(virDomainFSDefPtr fs,\n                                    const char *srcprefix,\n                                    const char *sec_mount_options);\n\nstatic int lxcContainerPrepareRoot(virDomainDefPtr def,\n                                   virDomainFSDefPtr root,\n                                   const char *sec_mount_options)\n{\n    char *dst;\n    char *tmp;\n\n    VIR_DEBUG(\"Prepare root %d\", root->type);\n\n    if (root->type == VIR_DOMAIN_FS_TYPE_MOUNT)\n        return 0;\n\n    if (root->type == VIR_DOMAIN_FS_TYPE_FILE) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unexpected root filesystem without loop device\"));\n        return -1;\n    }\n\n    if (root->type != VIR_DOMAIN_FS_TYPE_BLOCK) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       _(\"Unsupported root filesystem type %s\"),\n                       virDomainFSTypeToString(root->type));\n        return -1;\n    }\n\n    if (lxcContainerResolveSymlinks(root, false) < 0)\n        return -1;\n\n    dst = g_strdup_printf(\"%s/%s.root\", LXC_STATE_DIR, def->name);\n\n    tmp = root->dst;\n    root->dst = dst;\n\n    if (lxcContainerMountFSBlock(root, \"\", sec_mount_options) < 0) {\n        root->dst = tmp;\n        VIR_FREE(dst);\n        return -1;\n    }\n\n    root->dst = tmp;\n    root->type = VIR_DOMAIN_FS_TYPE_MOUNT;\n    VIR_FREE(root->src->path);\n    root->src->path = dst;\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerResolveSymlinks",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "604-645",
    "snippet": "static int lxcContainerResolveSymlinks(virDomainFSDefPtr fs, bool gentle)\n{\n    char *newroot;\n\n    if (!fs->src || !fs->src->path || fs->symlinksResolved)\n        return 0;\n\n    if (access(fs->src->path, F_OK)) {\n        if (gentle) {\n            /* Just ignore the error for the while, we'll try again later */\n            VIR_DEBUG(\"Skipped unaccessible '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to access '%s'\"), fs->src->path);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Resolving '%s'\", fs->src->path);\n    if (virFileResolveAllLinks(fs->src->path, &newroot) < 0) {\n        if (gentle) {\n            VIR_DEBUG(\"Skipped non-resolvable '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to resolve symlink at %s\"),\n                                 fs->src->path);\n        }\n        return -1;\n    }\n\n    /* Mark it resolved to skip it the next time */\n    fs->symlinksResolved = true;\n\n    VIR_DEBUG(\"Resolved '%s' to %s\", fs->src->path, newroot);\n\n    VIR_FREE(fs->src->path);\n    fs->src->path = newroot;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "fs->src->path"
          ],
          "line": 641
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Resolved '%s' to %s\"",
            "fs->src->path",
            "newroot"
          ],
          "line": 639
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to resolve symlink at %s\")",
            "fs->src->path"
          ],
          "line": 629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to resolve symlink at %s\""
          ],
          "line": 630
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Skipped non-resolvable '%s'\"",
            "fs->src->path"
          ],
          "line": 626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileResolveAllLinks",
          "args": [
            "fs->src->path",
            "&newroot"
          ],
          "line": 624
        },
        "resolved": true,
        "details": {
          "function_name": "virFileResolveAllLinks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1622-1626",
          "snippet": "int\nvirFileResolveAllLinks(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, true, resultpath);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileResolveAllLinks(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, true, resultpath);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Resolving '%s'\"",
            "fs->src->path"
          ],
          "line": 623
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to access '%s'\")",
            "fs->src->path"
          ],
          "line": 617
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Skipped unaccessible '%s'\"",
            "fs->src->path"
          ],
          "line": 614
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "fs->src->path",
            "F_OK"
          ],
          "line": 611
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerResolveSymlinks(virDomainFSDefPtr fs, bool gentle)\n{\n    char *newroot;\n\n    if (!fs->src || !fs->src->path || fs->symlinksResolved)\n        return 0;\n\n    if (access(fs->src->path, F_OK)) {\n        if (gentle) {\n            /* Just ignore the error for the while, we'll try again later */\n            VIR_DEBUG(\"Skipped unaccessible '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to access '%s'\"), fs->src->path);\n            return -1;\n        }\n    }\n\n    VIR_DEBUG(\"Resolving '%s'\", fs->src->path);\n    if (virFileResolveAllLinks(fs->src->path, &newroot) < 0) {\n        if (gentle) {\n            VIR_DEBUG(\"Skipped non-resolvable '%s'\", fs->src->path);\n            return 0;\n        } else {\n            virReportSystemError(errno,\n                                 _(\"Failed to resolve symlink at %s\"),\n                                 fs->src->path);\n        }\n        return -1;\n    }\n\n    /* Mark it resolved to skip it the next time */\n    fs->symlinksResolved = true;\n\n    VIR_DEBUG(\"Resolved '%s' to %s\", fs->src->path, newroot);\n\n    VIR_FREE(fs->src->path);\n    fs->src->path = newroot;\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerUnmountSubtree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "551-602",
    "snippet": "static int lxcContainerUnmountSubtree(const char *prefix,\n                                      bool isOldRootFS)\n{\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n    int saveErrno;\n    const char *failedUmount = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Unmount subtree from %s\", prefix);\n\n    if (virFileGetMountReverseSubtree(\"/proc/mounts\", prefix,\n                                      &mounts, &nmounts) < 0)\n        goto cleanup;\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Umount %s\", mounts[i]);\n        if (umount(mounts[i]) < 0) {\n            failedUmount = mounts[i];\n            saveErrno = errno;\n            VIR_WARN(\"Failed to unmount '%s', trying to detach subtree '%s': %s\",\n                     failedUmount, mounts[nmounts-1],\n                     g_strerror(errno));\n            break;\n        }\n    }\n\n    if (failedUmount) {\n        /* This detaches the subtree */\n        if (umount2(mounts[nmounts-1], MNT_DETACH) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not detach subtree '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n        /* This unmounts the tmpfs on which the old root filesystem was hosted */\n        if (isOldRootFS &&\n            umount(mounts[nmounts-1]) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not unmount old root '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(mounts);\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStringListFree",
          "args": [
            "mounts"
          ],
          "line": 599
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "306-314",
          "snippet": "void virStringListFree(char **strings)\n{\n    char **tmp = strings;\n    while (tmp && *tmp) {\n        VIR_FREE(*tmp);\n        tmp++;\n    }\n    VIR_FREE(strings);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid virStringListFree(char **strings)\n{\n    char **tmp = strings;\n    while (tmp && *tmp) {\n        VIR_FREE(*tmp);\n        tmp++;\n    }\n    VIR_FREE(strings);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "saveErrno",
            "_(\"Failed to unmount '%s' and could not unmount old root '%s'\")",
            "failedUmount",
            "mounts[nmounts-1]"
          ],
          "line": 589
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to unmount '%s' and could not unmount old root '%s'\""
          ],
          "line": 590
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "umount",
          "args": [
            "mounts[nmounts-1]"
          ],
          "line": 588
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "saveErrno",
            "_(\"Failed to unmount '%s' and could not detach subtree '%s'\")",
            "failedUmount",
            "mounts[nmounts-1]"
          ],
          "line": 581
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umount2",
          "args": [
            "mounts[nmounts-1]",
            "MNT_DETACH"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to unmount '%s', trying to detach subtree '%s': %s\"",
            "failedUmount",
            "mounts[nmounts-1]",
            "g_strerror(errno)"
          ],
          "line": 571
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "umount",
          "args": [
            "mounts[i]"
          ],
          "line": 568
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Umount %s\"",
            "mounts[i]"
          ],
          "line": 567
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileGetMountReverseSubtree",
          "args": [
            "\"/proc/mounts\"",
            "prefix",
            "&mounts",
            "&nmounts"
          ],
          "line": 563
        },
        "resolved": true,
        "details": {
          "function_name": "virFileGetMountReverseSubtree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2096-2102",
          "snippet": "int virFileGetMountReverseSubtree(const char *mtabpath,\n                                  const char *prefix,\n                                  char ***mountsret,\n                                  size_t *nmountsret)\n{\n    return virFileGetMountSubtreeImpl(mtabpath, prefix, mountsret, nmountsret, true);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileGetMountReverseSubtree(const char *mtabpath,\n                                  const char *prefix,\n                                  char ***mountsret,\n                                  size_t *nmountsret)\n{\n    return virFileGetMountSubtreeImpl(mtabpath, prefix, mountsret, nmountsret, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Unmount subtree from %s\"",
            "prefix"
          ],
          "line": 561
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerUnmountSubtree(const char *prefix,\n                                      bool isOldRootFS)\n{\n    char **mounts = NULL;\n    size_t nmounts = 0;\n    size_t i;\n    int saveErrno;\n    const char *failedUmount = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Unmount subtree from %s\", prefix);\n\n    if (virFileGetMountReverseSubtree(\"/proc/mounts\", prefix,\n                                      &mounts, &nmounts) < 0)\n        goto cleanup;\n    for (i = 0; i < nmounts; i++) {\n        VIR_DEBUG(\"Umount %s\", mounts[i]);\n        if (umount(mounts[i]) < 0) {\n            failedUmount = mounts[i];\n            saveErrno = errno;\n            VIR_WARN(\"Failed to unmount '%s', trying to detach subtree '%s': %s\",\n                     failedUmount, mounts[nmounts-1],\n                     g_strerror(errno));\n            break;\n        }\n    }\n\n    if (failedUmount) {\n        /* This detaches the subtree */\n        if (umount2(mounts[nmounts-1], MNT_DETACH) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not detach subtree '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n        /* This unmounts the tmpfs on which the old root filesystem was hosted */\n        if (isOldRootFS &&\n            umount(mounts[nmounts-1]) < 0) {\n            virReportSystemError(saveErrno,\n                                 _(\"Failed to unmount '%s' and could not unmount old root '%s'\"),\n                                 failedUmount, mounts[nmounts-1]);\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    virStringListFree(mounts);\n\n    return ret;\n}"
  },
  {
    "function_name": "lxcContainerRenameAndEnableInterfaces",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "480-528",
    "snippet": "static int\nlxcContainerRenameAndEnableInterfaces(virDomainDefPtr vmDef,\n                                      size_t nveths,\n                                      char **veths)\n{\n    size_t i;\n    const char *newname;\n    virDomainNetDefPtr netDef;\n    bool privNet = vmDef->features[VIR_DOMAIN_FEATURE_PRIVNET] ==\n                   VIR_TRISTATE_SWITCH_ON;\n\n    for (i = 0; i < nveths; i++) {\n        if (!(netDef = lxcContainerGetNetDef(vmDef, veths[i])))\n            return -1;\n\n        newname = netDef->ifname_guest;\n        if (!newname) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing device name for container-side veth\"));\n            return -1;\n        }\n\n        VIR_DEBUG(\"Renaming %s to %s\", veths[i], newname);\n        if (virNetDevSetName(veths[i], newname) < 0)\n            return -1;\n\n        /* Only enable this device if there is a reason to do so (either\n         * at least one IP was specified, or link state was set to up in\n         * the config)\n         */\n        if (netDef->guestIP.nips ||\n            netDef->linkstate == VIR_DOMAIN_NET_INTERFACE_LINK_STATE_UP) {\n            VIR_DEBUG(\"Enabling %s\", newname);\n            if (virNetDevSetOnline(newname, true) < 0)\n                return -1;\n        }\n\n        /* set IP addresses and routes */\n        if (virNetDevIPInfoAddToDev(newname, &netDef->guestIP) < 0)\n            return -1;\n    }\n\n    /* enable lo device only if there were other net devices */\n    if ((veths || privNet) &&\n        virNetDevSetOnline(\"lo\", true) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNetDevSetOnline",
          "args": [
            "\"lo\"",
            "true"
          ],
          "line": 524
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetOnline",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "660-665",
          "snippet": "int\nvirNetDevSetOnline(const char *ifname,\n                   bool online)\n{\n    return virNetDevSetIFFlag(ifname, VIR_IFF_UP, online);\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint\nvirNetDevSetOnline(const char *ifname,\n                   bool online)\n{\n    return virNetDevSetIFFlag(ifname, VIR_IFF_UP, online);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNetDevIPInfoAddToDev",
          "args": [
            "newname",
            "&netDef->guestIP"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevIPInfoAddToDev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdevip.c",
          "lines": "1071-1113",
          "snippet": "int\nvirNetDevIPInfoAddToDev(const char *ifname,\n                        virNetDevIPInfo const *ipInfo)\n{\n    size_t i;\n    int prefix;\n    g_autofree char *ipStr = NULL;\n\n    /* add all IP addresses */\n    for (i = 0; i < ipInfo->nips; i++) {\n        virNetDevIPAddrPtr ip = ipInfo->ips[i];\n\n        if ((prefix = virSocketAddrGetIPPrefix(&ip->address,\n                                               NULL, ip->prefix)) < 0) {\n            ipStr = virSocketAddrFormat(&ip->address);\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to determine prefix for IP address '%s'\"),\n                           NULLSTR(ipStr));\n            return -1;\n        }\n        if (virNetDevIPAddrAdd(ifname, &ip->address, &ip->peer, prefix) < 0)\n            return -1;\n    }\n\n    /* add all routes */\n    for (i = 0; i < ipInfo->nroutes; i++) {\n        virNetDevIPRoutePtr route = ipInfo->routes[i];\n\n        if ((prefix = virNetDevIPRouteGetPrefix(route)) < 0) {\n            ipStr = virSocketAddrFormat(&route->address);\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to determine prefix for route with destination '%s'\"),\n                           NULLSTR(ipStr));\n            return -1;\n        }\n        if (virNetDevIPRouteAdd(ifname, &route->address, prefix,\n                                &route->gateway,\n                                virNetDevIPRouteGetMetric(route)) < 0)\n            return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <net/if.h>",
            "# include <sys/ioctl.h>",
            "# include <ifaddrs.h>",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virnetlink.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virnetdevip.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <net/if.h>\n# include <sys/ioctl.h>\n# include <ifaddrs.h>\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virnetlink.h\"\n#include \"virnetdev.h\"\n#include \"virnetdevip.h\"\n#include <config.h>\n\nint\nvirNetDevIPInfoAddToDev(const char *ifname,\n                        virNetDevIPInfo const *ipInfo)\n{\n    size_t i;\n    int prefix;\n    g_autofree char *ipStr = NULL;\n\n    /* add all IP addresses */\n    for (i = 0; i < ipInfo->nips; i++) {\n        virNetDevIPAddrPtr ip = ipInfo->ips[i];\n\n        if ((prefix = virSocketAddrGetIPPrefix(&ip->address,\n                                               NULL, ip->prefix)) < 0) {\n            ipStr = virSocketAddrFormat(&ip->address);\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to determine prefix for IP address '%s'\"),\n                           NULLSTR(ipStr));\n            return -1;\n        }\n        if (virNetDevIPAddrAdd(ifname, &ip->address, &ip->peer, prefix) < 0)\n            return -1;\n    }\n\n    /* add all routes */\n    for (i = 0; i < ipInfo->nroutes; i++) {\n        virNetDevIPRoutePtr route = ipInfo->routes[i];\n\n        if ((prefix = virNetDevIPRouteGetPrefix(route)) < 0) {\n            ipStr = virSocketAddrFormat(&route->address);\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Failed to determine prefix for route with destination '%s'\"),\n                           NULLSTR(ipStr));\n            return -1;\n        }\n        if (virNetDevIPRouteAdd(ifname, &route->address, prefix,\n                                &route->gateway,\n                                virNetDevIPRouteGetMetric(route)) < 0)\n            return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Enabling %s\"",
            "newname"
          ],
          "line": 512
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNetDevSetName",
          "args": [
            "veths[i]",
            "newname"
          ],
          "line": 503
        },
        "resolved": true,
        "details": {
          "function_name": "virNetDevSetName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virnetdev.c",
          "lines": "591-597",
          "snippet": "int virNetDevSetName(const char* ifname, const char *newifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Cannot rename interface '%s' to '%s' on this platform\"),\n                         ifname, newifname);\n    return -1;\n}",
          "includes": [
            "# include <linux/devlink.h>",
            "# include <net/if_dl.h>",
            "# include <sys/sockio.h>",
            "# include <linux/ethtool.h>",
            "# include <linux/types.h>",
            "# include <linux/if_vlan.h>",
            "# include <linux/sockios.h>",
            "#include <fcntl.h>",
            "# include <sys/ioctl.h>",
            "#include \"virjson.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virpci.h\"",
            "#include \"vircommand.h\"",
            "#include \"virerror.h\"",
            "#include \"virfile.h\"",
            "#include \"virmacaddr.h\"",
            "#include \"virnetlink.h\"",
            "#include \"viralloc.h\"",
            "#include \"virnetdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/devlink.h>\n# include <net/if_dl.h>\n# include <sys/sockio.h>\n# include <linux/ethtool.h>\n# include <linux/types.h>\n# include <linux/if_vlan.h>\n# include <linux/sockios.h>\n#include <fcntl.h>\n# include <sys/ioctl.h>\n#include \"virjson.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virpci.h\"\n#include \"vircommand.h\"\n#include \"virerror.h\"\n#include \"virfile.h\"\n#include \"virmacaddr.h\"\n#include \"virnetlink.h\"\n#include \"viralloc.h\"\n#include \"virnetdev.h\"\n#include <config.h>\n\nint virNetDevSetName(const char* ifname, const char *newifname)\n{\n    virReportSystemError(ENOSYS,\n                         _(\"Cannot rename interface '%s' to '%s' on this platform\"),\n                         ifname, newifname);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Renaming %s to %s\"",
            "veths[i]",
            "newname"
          ],
          "line": 502
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing device name for container-side veth\")"
          ],
          "line": 497
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Missing device name for container-side veth\""
          ],
          "line": 498
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "lxcContainerGetNetDef",
          "args": [
            "vmDef",
            "veths[i]"
          ],
          "line": 492
        },
        "resolved": true,
        "details": {
          "function_name": "lxcContainerGetNetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "454-467",
          "snippet": "static virDomainNetDefPtr\nlxcContainerGetNetDef(virDomainDefPtr vmDef, const char *devName)\n{\n    size_t i;\n    virDomainNetDefPtr netDef;\n\n    for (i = 0; i < vmDef->nnets; i++) {\n        netDef = vmDef->nets[i];\n        if (STREQ_NULLABLE(netDef->ifname_guest_actual, devName))\n            return netDef;\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virDomainNetDefPtr\nlxcContainerGetNetDef(virDomainDefPtr vmDef, const char *devName)\n{\n    size_t i;\n    virDomainNetDefPtr netDef;\n\n    for (i = 0; i < vmDef->nnets; i++) {\n        netDef = vmDef->nets[i];\n        if (STREQ_NULLABLE(netDef->ifname_guest_actual, devName))\n            return netDef;\n    }\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nlxcContainerRenameAndEnableInterfaces(virDomainDefPtr vmDef,\n                                      size_t nveths,\n                                      char **veths)\n{\n    size_t i;\n    const char *newname;\n    virDomainNetDefPtr netDef;\n    bool privNet = vmDef->features[VIR_DOMAIN_FEATURE_PRIVNET] ==\n                   VIR_TRISTATE_SWITCH_ON;\n\n    for (i = 0; i < nveths; i++) {\n        if (!(netDef = lxcContainerGetNetDef(vmDef, veths[i])))\n            return -1;\n\n        newname = netDef->ifname_guest;\n        if (!newname) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing device name for container-side veth\"));\n            return -1;\n        }\n\n        VIR_DEBUG(\"Renaming %s to %s\", veths[i], newname);\n        if (virNetDevSetName(veths[i], newname) < 0)\n            return -1;\n\n        /* Only enable this device if there is a reason to do so (either\n         * at least one IP was specified, or link state was set to up in\n         * the config)\n         */\n        if (netDef->guestIP.nips ||\n            netDef->linkstate == VIR_DOMAIN_NET_INTERFACE_LINK_STATE_UP) {\n            VIR_DEBUG(\"Enabling %s\", newname);\n            if (virNetDevSetOnline(newname, true) < 0)\n                return -1;\n        }\n\n        /* set IP addresses and routes */\n        if (virNetDevIPInfoAddToDev(newname, &netDef->guestIP) < 0)\n            return -1;\n    }\n\n    /* enable lo device only if there were other net devices */\n    if ((veths || privNet) &&\n        virNetDevSetOnline(\"lo\", true) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerGetNetDef",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "454-467",
    "snippet": "static virDomainNetDefPtr\nlxcContainerGetNetDef(virDomainDefPtr vmDef, const char *devName)\n{\n    size_t i;\n    virDomainNetDefPtr netDef;\n\n    for (i = 0; i < vmDef->nnets; i++) {\n        netDef = vmDef->nets[i];\n        if (STREQ_NULLABLE(netDef->ifname_guest_actual, devName))\n            return netDef;\n    }\n\n    return NULL;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "netDef->ifname_guest_actual",
            "devName"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virDomainNetDefPtr\nlxcContainerGetNetDef(virDomainDefPtr vmDef, const char *devName)\n{\n    size_t i;\n    virDomainNetDefPtr netDef;\n\n    for (i = 0; i < vmDef->nnets; i++) {\n        netDef = vmDef->nets[i];\n        if (STREQ_NULLABLE(netDef->ifname_guest_actual, devName))\n            return netDef;\n    }\n\n    return NULL;\n}"
  },
  {
    "function_name": "lxcContainerSetID",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "434-451",
    "snippet": "static int lxcContainerSetID(virDomainDefPtr def)\n{\n    /* Only call virSetUIDGID when user namespace is enabled\n     * for this container. And user namespace is only enabled\n     * when nuidmap&ngidmap is not zero */\n\n    if (!def->idmap.nuidmap)\n        return 0;\n\n    VIR_DEBUG(\"Setting UID/GID to 0/0\");\n    if (virSetUIDGID(0, 0, NULL, 0) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"setuid or setgid failed\"));\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"setuid or setgid failed\")"
          ],
          "line": 445
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"setuid or setgid failed\""
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetUIDGID",
          "args": [
            "0",
            "0",
            "NULL",
            "0"
          ],
          "line": 444
        },
        "resolved": true,
        "details": {
          "function_name": "virSetUIDGID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1147-1156",
          "snippet": "int\nvirSetUIDGID(uid_t uid G_GNUC_UNUSED,\n             gid_t gid G_GNUC_UNUSED,\n             gid_t *groups G_GNUC_UNUSED,\n             int ngroups G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virSetUIDGID is not available\"));\n    return -1;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirSetUIDGID(uid_t uid G_GNUC_UNUSED,\n             gid_t gid G_GNUC_UNUSED,\n             gid_t *groups G_GNUC_UNUSED,\n             int ngroups G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virSetUIDGID is not available\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Setting UID/GID to 0/0\""
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetID(virDomainDefPtr def)\n{\n    /* Only call virSetUIDGID when user namespace is enabled\n     * for this container. And user namespace is only enabled\n     * when nuidmap&ngidmap is not zero */\n\n    if (!def->idmap.nuidmap)\n        return 0;\n\n    VIR_DEBUG(\"Setting UID/GID to 0/0\");\n    if (virSetUIDGID(0, 0, NULL, 0) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"setuid or setgid failed\"));\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerWaitForContinue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "404-423",
    "snippet": "int lxcContainerWaitForContinue(int control)\n{\n    lxc_message_t msg;\n    int readLen;\n\n    VIR_DEBUG(\"Wait continue on fd %d\", control);\n    readLen = saferead(control, &msg, sizeof(msg));\n    VIR_DEBUG(\"Got continue on fd %d %d\", control, readLen);\n    if (readLen != sizeof(msg)) {\n        if (readLen >= 0)\n            errno = EIO;\n        return -1;\n    }\n    if (msg != LXC_CONTINUE_MSG) {\n        errno = EINVAL;\n        return -1;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define LXC_CONTINUE_MSG 'c'"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Got continue on fd %d %d\"",
            "control",
            "readLen"
          ],
          "line": 411
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "saferead",
          "args": [
            "control",
            "&msg",
            "sizeof(msg)"
          ],
          "line": 410
        },
        "resolved": true,
        "details": {
          "function_name": "saferead_lim",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1330-1372",
          "snippet": "static char *\nsaferead_lim(int fd, size_t max_len, size_t *length)\n{\n    char *buf = NULL;\n    size_t alloc = 0;\n    size_t size = 0;\n    int save_errno;\n\n    for (;;) {\n        int count;\n        int requested;\n\n        if (size + BUFSIZ + 1 > alloc) {\n            alloc += alloc / 2;\n            if (alloc < size + BUFSIZ + 1)\n                alloc = size + BUFSIZ + 1;\n\n            if (VIR_REALLOC_N(buf, alloc) < 0) {\n                save_errno = errno;\n                break;\n            }\n        }\n\n        /* Ensure that (size + requested <= max_len); */\n        requested = MIN(size < max_len ? max_len - size : 0,\n                        alloc - size - 1);\n        count = saferead(fd, buf + size, requested);\n        size += count;\n\n        if (count != requested || requested == 0) {\n            save_errno = errno;\n            if (count < 0)\n                break;\n            buf[size] = '\\0';\n            *length = size;\n            return buf;\n        }\n    }\n\n    VIR_FREE(buf);\n    errno = save_errno;\n    return NULL;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic char *\nsaferead_lim(int fd, size_t max_len, size_t *length)\n{\n    char *buf = NULL;\n    size_t alloc = 0;\n    size_t size = 0;\n    int save_errno;\n\n    for (;;) {\n        int count;\n        int requested;\n\n        if (size + BUFSIZ + 1 > alloc) {\n            alloc += alloc / 2;\n            if (alloc < size + BUFSIZ + 1)\n                alloc = size + BUFSIZ + 1;\n\n            if (VIR_REALLOC_N(buf, alloc) < 0) {\n                save_errno = errno;\n                break;\n            }\n        }\n\n        /* Ensure that (size + requested <= max_len); */\n        requested = MIN(size < max_len ? max_len - size : 0,\n                        alloc - size - 1);\n        count = saferead(fd, buf + size, requested);\n        size += count;\n\n        if (count != requested || requested == 0) {\n            save_errno = errno;\n            if (count < 0)\n                break;\n            buf[size] = '\\0';\n            *length = size;\n            return buf;\n        }\n    }\n\n    VIR_FREE(buf);\n    errno = save_errno;\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Wait continue on fd %d\"",
            "control"
          ],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define LXC_CONTINUE_MSG 'c'\n\nint lxcContainerWaitForContinue(int control)\n{\n    lxc_message_t msg;\n    int readLen;\n\n    VIR_DEBUG(\"Wait continue on fd %d\", control);\n    readLen = saferead(control, &msg, sizeof(msg));\n    VIR_DEBUG(\"Got continue on fd %d %d\", control, readLen);\n    if (readLen != sizeof(msg)) {\n        if (readLen >= 0)\n            errno = EIO;\n        return -1;\n    }\n    if (msg != LXC_CONTINUE_MSG) {\n        errno = EINVAL;\n        return -1;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerSendContinue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "381-392",
    "snippet": "int lxcContainerSendContinue(int control)\n{\n    lxc_message_t msg = LXC_CONTINUE_MSG;\n    int writeCount = 0;\n\n    VIR_DEBUG(\"Send continue on fd %d\", control);\n    writeCount = safewrite(control, &msg, sizeof(msg));\n    if (writeCount != sizeof(msg))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define LXC_CONTINUE_MSG 'c'"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "safewrite",
          "args": [
            "control",
            "&msg",
            "sizeof(msg)"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "safewrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1093-1111",
          "snippet": "ssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Send continue on fd %d\"",
            "control"
          ],
          "line": 386
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define LXC_CONTINUE_MSG 'c'\n\nint lxcContainerSendContinue(int control)\n{\n    lxc_message_t msg = LXC_CONTINUE_MSG;\n    int writeCount = 0;\n\n    VIR_DEBUG(\"Send continue on fd %d\", control);\n    writeCount = safewrite(control, &msg, sizeof(msg));\n    if (writeCount != sizeof(msg))\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "lxcContainerSetupFDs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "264-370",
    "snippet": "static int lxcContainerSetupFDs(int *ttyfd,\n                                size_t npassFDs, int *passFDs)\n{\n    int rc = -1;\n    int open_max;\n    int fd;\n    int last_fd;\n    size_t i;\n    size_t j;\n\n    VIR_DEBUG(\"Logging from the container init will now cease \"\n              \"as the FDs are about to be closed for exec of \"\n              \"the container init process\");\n\n    if (dup2(*ttyfd, STDIN_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stdin) failed\"));\n        goto cleanup;\n    }\n\n    if (dup2(*ttyfd, STDOUT_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stdout) failed\"));\n        goto cleanup;\n    }\n\n    if (dup2(*ttyfd, STDERR_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stderr) failed\"));\n        goto cleanup;\n    }\n\n    VIR_FORCE_CLOSE(*ttyfd);\n\n    /* Any FDs in @passFDs need to be moved around so that\n     * they are numbered, without gaps, starting from\n     * STDERR_FILENO + 1\n     */\n    for (i = 0; i < npassFDs; i++) {\n        int wantfd;\n\n        wantfd = STDERR_FILENO + i + 1;\n        VIR_DEBUG(\"Pass %d onto %d\", passFDs[i], wantfd);\n\n        /* If we already have desired FD number, life\n         * is easy. Nothing needs renumbering */\n        if (passFDs[i] == wantfd)\n            continue;\n\n        /*\n         * Lets check to see if any later FDs are occupying\n         * our desired FD number. If so, we must move them\n         * out of the way\n         */\n        for (j = i + 1; j < npassFDs; j++) {\n            if (passFDs[j] == wantfd) {\n                VIR_DEBUG(\"Clash %zu\", j);\n                int newfd = dup(passFDs[j]);\n                if (newfd < 0) {\n                    virReportSystemError(errno,\n                                         _(\"Cannot move fd %d out of the way\"),\n                                         passFDs[j]);\n                    goto cleanup;\n                }\n                /* We're intentionally not closing the\n                 * old value of passFDs[j], because we\n                 * don't want later iterations of the\n                 * loop to take it back. dup2() will\n                 * cause it to be closed shortly anyway\n                 */\n                VIR_DEBUG(\"Moved clash onto %d\", newfd);\n                passFDs[j] = newfd;\n            }\n        }\n\n        /* Finally we can move into our desired FD number */\n        if (dup2(passFDs[i], wantfd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Cannot duplicate fd %d onto fd %d\"),\n                                 passFDs[i], wantfd);\n            goto cleanup;\n        }\n        VIR_FORCE_CLOSE(passFDs[i]);\n    }\n\n    last_fd = STDERR_FILENO + npassFDs;\n\n    /* Just in case someone forget to set FD_CLOEXEC, explicitly\n     * close all remaining FDs before executing the container */\n    open_max = sysconf(_SC_OPEN_MAX);\n    if (open_max < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"sysconf(_SC_OPEN_MAX) failed\"));\n        goto cleanup;\n    }\n\n    for (fd = last_fd + 1; fd < open_max; fd++) {\n        int tmpfd = fd;\n        VIR_MASS_CLOSE(tmpfd);\n    }\n\n    rc = 0;\n\n cleanup:\n    VIR_DEBUG(\"rc=%d\", rc);\n    return rc;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"rc=%d\"",
            "rc"
          ],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_MASS_CLOSE",
          "args": [
            "tmpfd"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"sysconf(_SC_OPEN_MAX) failed\")"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"sysconf(_SC_OPEN_MAX) failed\""
          ],
          "line": 356
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sysconf",
          "args": [
            "_SC_OPEN_MAX"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "passFDs[i]"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Cannot duplicate fd %d onto fd %d\")",
            "passFDs[i]",
            "wantfd"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup2",
          "args": [
            "passFDs[i]",
            "wantfd"
          ],
          "line": 340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Moved clash onto %d\"",
            "newfd"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Cannot move fd %d out of the way\")",
            "passFDs[j]"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup",
          "args": [
            "passFDs[j]"
          ],
          "line": 321
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Clash %zu\"",
            "j"
          ],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Pass %d onto %d\"",
            "passFDs[i]",
            "wantfd"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "*ttyfd"
          ],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"dup2(stderr) failed\")"
          ],
          "line": 291
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup2",
          "args": [
            "*ttyfd",
            "STDERR_FILENO"
          ],
          "line": 290
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"dup2(stdout) failed\")"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup2",
          "args": [
            "*ttyfd",
            "STDOUT_FILENO"
          ],
          "line": 284
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"dup2(stdin) failed\")"
          ],
          "line": 279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup2",
          "args": [
            "*ttyfd",
            "STDIN_FILENO"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Logging from the container init will now cease \"\n              \"as the FDs are about to be closed for exec of \"\n              \"the container init process\""
          ],
          "line": 274
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int lxcContainerSetupFDs(int *ttyfd,\n                                size_t npassFDs, int *passFDs)\n{\n    int rc = -1;\n    int open_max;\n    int fd;\n    int last_fd;\n    size_t i;\n    size_t j;\n\n    VIR_DEBUG(\"Logging from the container init will now cease \"\n              \"as the FDs are about to be closed for exec of \"\n              \"the container init process\");\n\n    if (dup2(*ttyfd, STDIN_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stdin) failed\"));\n        goto cleanup;\n    }\n\n    if (dup2(*ttyfd, STDOUT_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stdout) failed\"));\n        goto cleanup;\n    }\n\n    if (dup2(*ttyfd, STDERR_FILENO) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"dup2(stderr) failed\"));\n        goto cleanup;\n    }\n\n    VIR_FORCE_CLOSE(*ttyfd);\n\n    /* Any FDs in @passFDs need to be moved around so that\n     * they are numbered, without gaps, starting from\n     * STDERR_FILENO + 1\n     */\n    for (i = 0; i < npassFDs; i++) {\n        int wantfd;\n\n        wantfd = STDERR_FILENO + i + 1;\n        VIR_DEBUG(\"Pass %d onto %d\", passFDs[i], wantfd);\n\n        /* If we already have desired FD number, life\n         * is easy. Nothing needs renumbering */\n        if (passFDs[i] == wantfd)\n            continue;\n\n        /*\n         * Lets check to see if any later FDs are occupying\n         * our desired FD number. If so, we must move them\n         * out of the way\n         */\n        for (j = i + 1; j < npassFDs; j++) {\n            if (passFDs[j] == wantfd) {\n                VIR_DEBUG(\"Clash %zu\", j);\n                int newfd = dup(passFDs[j]);\n                if (newfd < 0) {\n                    virReportSystemError(errno,\n                                         _(\"Cannot move fd %d out of the way\"),\n                                         passFDs[j]);\n                    goto cleanup;\n                }\n                /* We're intentionally not closing the\n                 * old value of passFDs[j], because we\n                 * don't want later iterations of the\n                 * loop to take it back. dup2() will\n                 * cause it to be closed shortly anyway\n                 */\n                VIR_DEBUG(\"Moved clash onto %d\", newfd);\n                passFDs[j] = newfd;\n            }\n        }\n\n        /* Finally we can move into our desired FD number */\n        if (dup2(passFDs[i], wantfd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Cannot duplicate fd %d onto fd %d\"),\n                                 passFDs[i], wantfd);\n            goto cleanup;\n        }\n        VIR_FORCE_CLOSE(passFDs[i]);\n    }\n\n    last_fd = STDERR_FILENO + npassFDs;\n\n    /* Just in case someone forget to set FD_CLOEXEC, explicitly\n     * close all remaining FDs before executing the container */\n    open_max = sysconf(_SC_OPEN_MAX);\n    if (open_max < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"sysconf(_SC_OPEN_MAX) failed\"));\n        goto cleanup;\n    }\n\n    for (fd = last_fd + 1; fd < open_max; fd++) {\n        int tmpfd = fd;\n        VIR_MASS_CLOSE(tmpfd);\n    }\n\n    rc = 0;\n\n cleanup:\n    VIR_DEBUG(\"rc=%d\", rc);\n    return rc;\n}"
  },
  {
    "function_name": "lxcContainerBuildInitCmd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "195-248",
    "snippet": "static virCommandPtr lxcContainerBuildInitCmd(virDomainDefPtr vmDef,\n                                              char **ttyPaths,\n                                              size_t nttyPaths)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virCommandPtr cmd;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    size_t i;\n\n    /* 'container_ptys' must exclude the PTY associated with\n     * the /dev/console device, hence start at 1 not 0\n     */\n    for (i = 1; i < nttyPaths; i++) {\n        if (!STRPREFIX(ttyPaths[i], \"/dev/\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Expected a /dev path for '%s'\"),\n                           ttyPaths[i]);\n            virBufferFreeAndReset(&buf);\n            return NULL;\n        }\n        virBufferAdd(&buf, ttyPaths[i] + 5, -1);\n        virBufferAddChar(&buf, ' ');\n    }\n    virBufferTrimLen(&buf, 1);\n\n    virUUIDFormat(vmDef->uuid, uuidstr);\n\n    cmd = virCommandNew(vmDef->os.init);\n\n    if (vmDef->os.initargv && vmDef->os.initargv[0])\n        virCommandAddArgSet(cmd, (const char **)vmDef->os.initargv);\n\n    virCommandAddEnvString(cmd, \"PATH=/bin:/sbin\");\n    virCommandAddEnvString(cmd, \"TERM=linux\");\n    virCommandAddEnvString(cmd, \"container=lxc-libvirt\");\n    virCommandAddEnvString(cmd, \"HOME=/\");\n    virCommandAddEnvPair(cmd, \"container_uuid\", uuidstr);\n    if (nttyPaths > 1)\n        virCommandAddEnvPair(cmd, \"container_ttys\", virBufferCurrentContent(&buf));\n    virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_UUID\", uuidstr);\n    virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_NAME\", vmDef->name);\n    if (vmDef->os.cmdline)\n        virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_CMDLINE\", vmDef->os.cmdline);\n    if (vmDef->os.initdir)\n        virCommandSetWorkingDirectory(cmd, vmDef->os.initdir);\n\n    for (i = 0; vmDef->os.initenv[i]; i++) {\n        virCommandAddEnvPair(cmd, vmDef->os.initenv[i]->name,\n                                  vmDef->os.initenv[i]->value);\n    }\n\n    virBufferFreeAndReset(&buf);\n    return cmd;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferFreeAndReset",
          "args": [
            "&buf"
          ],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferFreeAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "268-277",
          "snippet": "void virBufferFreeAndReset(virBufferPtr buf)\n{\n    if (!buf)\n        return;\n\n    if (buf->str)\n        g_string_free(buf->str, true);\n\n    memset(buf, 0, sizeof(*buf));\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid virBufferFreeAndReset(virBufferPtr buf)\n{\n    if (!buf)\n        return;\n\n    if (buf->str)\n        g_string_free(buf->str, true);\n\n    memset(buf, 0, sizeof(*buf));\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddEnvPair",
          "args": [
            "cmd",
            "vmDef->os.initenv[i]->name",
            "vmDef->os.initenv[i]->value"
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddEnvPair",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1371-1375",
          "snippet": "void\nvirCommandAddEnvPair(virCommandPtr cmd, const char *name, const char *value)\n{\n    virCommandAddEnvFormat(cmd, \"%s=%s\", name, value);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddEnvPair(virCommandPtr cmd, const char *name, const char *value)\n{\n    virCommandAddEnvFormat(cmd, \"%s=%s\", name, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetWorkingDirectory",
          "args": [
            "cmd",
            "vmDef->os.initdir"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetWorkingDirectory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1695-1707",
          "snippet": "void\nvirCommandSetWorkingDirectory(virCommandPtr cmd, const char *pwd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->pwd) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot set directory twice\");\n    } else {\n        cmd->pwd = g_strdup(pwd);\n    }\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetWorkingDirectory(virCommandPtr cmd, const char *pwd)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->pwd) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot set directory twice\");\n    } else {\n        cmd->pwd = g_strdup(pwd);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferCurrentContent",
          "args": [
            "&buf"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferCurrentContent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "222-233",
          "snippet": "const char *\nvirBufferCurrentContent(virBufferPtr buf)\n{\n    if (!buf)\n        return NULL;\n\n    if (!buf->str ||\n        buf->str->len == 0)\n        return \"\";\n\n    return buf->str->str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nconst char *\nvirBufferCurrentContent(virBufferPtr buf)\n{\n    if (!buf)\n        return NULL;\n\n    if (!buf->str ||\n        buf->str->len == 0)\n        return \"\";\n\n    return buf->str->str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddEnvString",
          "args": [
            "cmd",
            "\"HOME=/\""
          ],
          "line": 230
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddEnvString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1386-1397",
          "snippet": "void\nvirCommandAddEnvString(virCommandPtr cmd, const char *str)\n{\n    char *env;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    env = g_strdup(str);\n\n    virCommandAddEnv(cmd, env);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddEnvString(virCommandPtr cmd, const char *str)\n{\n    char *env;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    env = g_strdup(str);\n\n    virCommandAddEnv(cmd, env);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgSet",
          "args": [
            "cmd",
            "(const char **)vmDef->os.initargv"
          ],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1617-1646",
          "snippet": "void\nvirCommandAddArgSet(virCommandPtr cmd, const char *const*vals)\n{\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (vals[0] == NULL) {\n        cmd->has_error = EINVAL;\n        return;\n    }\n\n    while (vals[narg] != NULL)\n        narg++;\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    narg = 0;\n    while (vals[narg] != NULL) {\n        char *arg;\n\n        arg = g_strdup(vals[narg++]);\n        cmd->args[cmd->nargs++] = arg;\n    }\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgSet(virCommandPtr cmd, const char *const*vals)\n{\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (vals[0] == NULL) {\n        cmd->has_error = EINVAL;\n        return;\n    }\n\n    while (vals[narg] != NULL)\n        narg++;\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    narg = 0;\n    while (vals[narg] != NULL) {\n        char *arg;\n\n        arg = g_strdup(vals[narg++]);\n        cmd->args[cmd->nargs++] = arg;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "vmDef->os.init"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "vmDef->uuid",
            "uuidstr"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferTrimLen",
          "args": [
            "&buf",
            "1"
          ],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferTrimLen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "698-708",
          "snippet": "void\nvirBufferTrimLen(virBufferPtr buf, int len)\n{\n    if (!buf || !buf->str)\n        return;\n\n    if (len > buf->str->len)\n        return;\n\n    g_string_truncate(buf->str, buf->str->len - len);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferTrimLen(virBufferPtr buf, int len)\n{\n    if (!buf || !buf->str)\n        return;\n\n    if (len > buf->str->len)\n        return;\n\n    g_string_truncate(buf->str, buf->str->len - len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAddChar",
          "args": [
            "&buf",
            "' '"
          ],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAddChar",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "206-210",
          "snippet": "void\nvirBufferAddChar(virBufferPtr buf, char c)\n{\n    virBufferAdd(buf, &c, 1);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAddChar(virBufferPtr buf, char c)\n{\n    virBufferAdd(buf, &c, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAdd",
          "args": [
            "&buf",
            "ttyPaths[i] + 5",
            "-1"
          ],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "156-169",
          "snippet": "void\nvirBufferAdd(virBufferPtr buf, const char *str, int len)\n{\n    if (!str || !buf || (len == 0 && buf->indent == 0))\n        return;\n\n    virBufferInitialize(buf);\n    virBufferApplyIndent(buf);\n\n    if (len < 0)\n        g_string_append(buf->str, str);\n    else\n        g_string_append_len(buf->str, str, len);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAdd(virBufferPtr buf, const char *str, int len)\n{\n    if (!str || !buf || (len == 0 && buf->indent == 0))\n        return;\n\n    virBufferInitialize(buf);\n    virBufferApplyIndent(buf);\n\n    if (len < 0)\n        g_string_append(buf->str, str);\n    else\n        g_string_append_len(buf->str, str, len);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Expected a /dev path for '%s'\")",
            "ttyPaths[i]"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Expected a /dev path for '%s'\""
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRPREFIX",
          "args": [
            "ttyPaths[i]",
            "\"/dev/\""
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virCommandPtr lxcContainerBuildInitCmd(virDomainDefPtr vmDef,\n                                              char **ttyPaths,\n                                              size_t nttyPaths)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virCommandPtr cmd;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    size_t i;\n\n    /* 'container_ptys' must exclude the PTY associated with\n     * the /dev/console device, hence start at 1 not 0\n     */\n    for (i = 1; i < nttyPaths; i++) {\n        if (!STRPREFIX(ttyPaths[i], \"/dev/\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Expected a /dev path for '%s'\"),\n                           ttyPaths[i]);\n            virBufferFreeAndReset(&buf);\n            return NULL;\n        }\n        virBufferAdd(&buf, ttyPaths[i] + 5, -1);\n        virBufferAddChar(&buf, ' ');\n    }\n    virBufferTrimLen(&buf, 1);\n\n    virUUIDFormat(vmDef->uuid, uuidstr);\n\n    cmd = virCommandNew(vmDef->os.init);\n\n    if (vmDef->os.initargv && vmDef->os.initargv[0])\n        virCommandAddArgSet(cmd, (const char **)vmDef->os.initargv);\n\n    virCommandAddEnvString(cmd, \"PATH=/bin:/sbin\");\n    virCommandAddEnvString(cmd, \"TERM=linux\");\n    virCommandAddEnvString(cmd, \"container=lxc-libvirt\");\n    virCommandAddEnvString(cmd, \"HOME=/\");\n    virCommandAddEnvPair(cmd, \"container_uuid\", uuidstr);\n    if (nttyPaths > 1)\n        virCommandAddEnvPair(cmd, \"container_ttys\", virBufferCurrentContent(&buf));\n    virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_UUID\", uuidstr);\n    virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_NAME\", vmDef->name);\n    if (vmDef->os.cmdline)\n        virCommandAddEnvPair(cmd, \"LIBVIRT_LXC_CMDLINE\", vmDef->os.cmdline);\n    if (vmDef->os.initdir)\n        virCommandSetWorkingDirectory(cmd, vmDef->os.initdir);\n\n    for (i = 0; vmDef->os.initenv[i]; i++) {\n        virCommandAddEnvPair(cmd, vmDef->os.initenv[i]->name,\n                                  vmDef->os.initenv[i]->value);\n    }\n\n    virBufferFreeAndReset(&buf);\n    return cmd;\n}"
  },
  {
    "function_name": "lxcContainerHasReboot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "132-184",
    "snippet": "static\nint lxcContainerHasReboot(void)\n{\n    int flags = CLONE_NEWPID|CLONE_NEWNS|CLONE_NEWUTS|\n        CLONE_NEWIPC|SIGCHLD;\n    int cpid;\n    char *childStack;\n    char *stack;\n    char *buf;\n    int cmd, v;\n    int status;\n    char *tmp;\n    int stacksize = getpagesize() * 4;\n\n    if (virFileReadAll(\"/proc/sys/kernel/ctrl-alt-del\", 10, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    if (virStrToLong_i(buf, NULL, 10, &v) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Malformed ctrl-alt-del setting '%s'\"), buf);\n        VIR_FREE(buf);\n        return -1;\n    }\n    VIR_FREE(buf);\n    cmd = v ? LINUX_REBOOT_CMD_CAD_ON : LINUX_REBOOT_CMD_CAD_OFF;\n\n    if (VIR_ALLOC_N(stack, stacksize) < 0)\n        return -1;\n\n    childStack = stack + stacksize;\n\n    cpid = clone(lxcContainerRebootChild, childStack, flags, &cmd);\n    VIR_FREE(stack);\n    if (cpid < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to clone to check reboot support\"));\n        return -1;\n    } else if (virProcessWait(cpid, &status, false) < 0) {\n        return -1;\n    }\n\n    if (status != 1) {\n        VIR_DEBUG(\"Containerized reboot support is missing \"\n                  \"(kernel probably too old < 3.4)\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"Containerized reboot support is available\");\n    return 1;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Containerized reboot support is available\""
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Containerized reboot support is missing \"\n                  \"(kernel probably too old < 3.4)\""
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virProcessWait",
          "args": [
            "cpid",
            "&status",
            "false"
          ],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "virProcessWait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virprocess.c",
          "lines": "296-302",
          "snippet": "int\nvirProcessWait(pid_t pid, int *exitstatus G_GNUC_UNUSED, bool raw G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, _(\"unable to wait for process %lld\"),\n                         (long long) pid);\n    return -1;\n}",
          "includes": [
            "#   include <sys/syscall.h>",
            "#include \"vircommand.h\"",
            "#include \"virstring.h\"",
            "#include \"virutil.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virprocess.h\"",
            "# include <windows.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/user.h>",
            "# include <sys/sysctl.h>",
            "# include <sys/param.h>",
            "# include <sched.h>",
            "# include <sys/resource.h>",
            "# include <sys/time.h>",
            "# include <sys/mount.h>",
            "#include <unistd.h>",
            "# include <sys/wait.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#   include <sys/syscall.h>\n#include \"vircommand.h\"\n#include \"virstring.h\"\n#include \"virutil.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virprocess.h\"\n# include <windows.h>\n# include <sys/cpuset.h>\n# include <sys/user.h>\n# include <sys/sysctl.h>\n# include <sys/param.h>\n# include <sched.h>\n# include <sys/resource.h>\n# include <sys/time.h>\n# include <sys/mount.h>\n#include <unistd.h>\n# include <sys/wait.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirProcessWait(pid_t pid, int *exitstatus G_GNUC_UNUSED, bool raw G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, _(\"unable to wait for process %lld\"),\n                         (long long) pid);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to clone to check reboot support\")"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to clone to check reboot support\""
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "userns_required",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
          "lines": "2329-2332",
          "snippet": "static int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virnetdevip.h\"",
            "#include \"vircommand.h\"",
            "#include \"virusb.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"virnetdevveth.h\"",
            "#include \"viralloc.h\"",
            "#include \"lxc_container.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <cap-ng.h>",
            "#include <linux/fs.h>",
            "#include <linux/unistd.h>",
            "#include <linux/reboot.h>",
            "#include <sys/reboot.h>",
            "#include <mntent.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/mount.h>",
            "#include <sys/ioctl.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int userns_required(virDomainDefPtr def)\n{\n    return def->idmap.uidmap && def->idmap.gidmap;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "stack"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clone",
          "args": [
            "lxcContainerRebootChild",
            "childStack",
            "flags",
            "&cmd"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "stack",
            "stacksize"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "buf"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "buf"
          ],
          "line": 155
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Malformed ctrl-alt-del setting '%s'\")",
            "buf"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrToLong_i",
          "args": [
            "buf",
            "NULL",
            "10",
            "&v"
          ],
          "line": 152
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "391-407",
          "snippet": "int\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "buf",
            "'\\n'"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "\"/proc/sys/kernel/ctrl-alt-del\"",
            "10",
            "&buf"
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpagesize",
          "args": [],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic\nint lxcContainerHasReboot(void)\n{\n    int flags = CLONE_NEWPID|CLONE_NEWNS|CLONE_NEWUTS|\n        CLONE_NEWIPC|SIGCHLD;\n    int cpid;\n    char *childStack;\n    char *stack;\n    char *buf;\n    int cmd, v;\n    int status;\n    char *tmp;\n    int stacksize = getpagesize() * 4;\n\n    if (virFileReadAll(\"/proc/sys/kernel/ctrl-alt-del\", 10, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    if (virStrToLong_i(buf, NULL, 10, &v) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Malformed ctrl-alt-del setting '%s'\"), buf);\n        VIR_FREE(buf);\n        return -1;\n    }\n    VIR_FREE(buf);\n    cmd = v ? LINUX_REBOOT_CMD_CAD_ON : LINUX_REBOOT_CMD_CAD_OFF;\n\n    if (VIR_ALLOC_N(stack, stacksize) < 0)\n        return -1;\n\n    childStack = stack + stacksize;\n\n    cpid = clone(lxcContainerRebootChild, childStack, flags, &cmd);\n    VIR_FREE(stack);\n    if (cpid < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to clone to check reboot support\"));\n        return -1;\n    } else if (virProcessWait(cpid, &status, false) < 0) {\n        return -1;\n    }\n\n    if (status != 1) {\n        VIR_DEBUG(\"Containerized reboot support is missing \"\n                  \"(kernel probably too old < 3.4)\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"Containerized reboot support is available\");\n    return 1;\n}"
  },
  {
    "function_name": "lxcContainerRebootChild",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/lxc/lxc_container.c",
    "lines": "119-129",
    "snippet": "G_GNUC_NORETURN static int\nlxcContainerRebootChild(void *argv)\n{\n    int *cmd = argv;\n    int ret;\n\n    ret = reboot(*cmd);\n    if (ret == -1 && errno == EINVAL)\n        _exit(1);\n    _exit(0);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virstring.h\"",
      "#include \"virprocess.h\"",
      "#include \"virnetdevip.h\"",
      "#include \"vircommand.h\"",
      "#include \"virusb.h\"",
      "#include \"virfile.h\"",
      "#include \"viruuid.h\"",
      "#include \"virnetdevveth.h\"",
      "#include \"viralloc.h\"",
      "#include \"lxc_container.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "# include <selinux/selinux.h>",
      "# include <blkid.h>",
      "# include <cap-ng.h>",
      "#include <linux/fs.h>",
      "#include <linux/unistd.h>",
      "#include <linux/reboot.h>",
      "#include <sys/reboot.h>",
      "#include <mntent.h>",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <sys/mount.h>",
      "#include <sys/ioctl.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "_exit",
          "args": [
            "0"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_exit",
          "args": [
            "1"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reboot",
          "args": [
            "*cmd"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virnetdevip.h\"\n#include \"vircommand.h\"\n#include \"virusb.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"virnetdevveth.h\"\n#include \"viralloc.h\"\n#include \"lxc_container.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <cap-ng.h>\n#include <linux/fs.h>\n#include <linux/unistd.h>\n#include <linux/reboot.h>\n#include <sys/reboot.h>\n#include <mntent.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/mount.h>\n#include <sys/ioctl.h>\n#include <fcntl.h>\n#include <config.h>\n\nG_GNUC_NORETURN static int\nlxcContainerRebootChild(void *argv)\n{\n    int *cmd = argv;\n    int ret;\n\n    ret = reboot(*cmd);\n    if (ret == -1 && errno == EINVAL)\n        _exit(1);\n    _exit(0);\n}"
  }
]