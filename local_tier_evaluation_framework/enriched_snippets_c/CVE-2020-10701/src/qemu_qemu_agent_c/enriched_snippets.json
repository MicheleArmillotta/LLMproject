[
  {
    "function_name": "qemuAgentSetResponseTimeout",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "2496-2501",
    "snippet": "void\nqemuAgentSetResponseTimeout(qemuAgentPtr agent,\n                            int timeout)\n{\n    agent->timeout = timeout;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nvoid\nqemuAgentSetResponseTimeout(qemuAgentPtr agent,\n                            int timeout)\n{\n    agent->timeout = timeout;\n}"
  },
  {
    "function_name": "qemuAgentGetTimezone",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "2445-2488",
    "snippet": "int\nqemuAgentGetTimezone(qemuAgentPtr agent,\n                     virTypedParameterPtr *params,\n                     int *nparams,\n                     int *maxparams)\n{\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    virJSONValuePtr data = NULL;\n    const char *name;\n    int offset;\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-get-timezone\", NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            return -2;\n        return -1;\n    }\n\n    if (!(data = virJSONValueObjectGetObject(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-timezone reply was missing return data\"));\n        return -1;\n    }\n\n    if ((name = virJSONValueObjectGetString(data, \"zone\")) &&\n        virTypedParamsAddString(params, nparams, maxparams,\n                                \"timezone.name\", name) < 0)\n        return -1;\n\n    if ((virJSONValueObjectGetNumberInt(data, \"offset\", &offset)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"'offset' missing in reply of guest-get-timezone\"));\n        return -1;\n    }\n\n    if (virTypedParamsAddInt(params, nparams, maxparams,\n                             \"timezone.offset\", offset) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virTypedParamsAddInt",
          "args": [
            "params",
            "nparams",
            "maxparams",
            "\"timezone.offset\"",
            "offset"
          ],
          "line": 2483
        },
        "resolved": true,
        "details": {
          "function_name": "virTypedParamsAddInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtypedparam-public.c",
          "lines": "437-463",
          "snippet": "int\nvirTypedParamsAddInt(virTypedParameterPtr *params,\n                     int *nparams,\n                     int *maxparams,\n                     const char *name,\n                     int value)\n{\n    size_t max = *maxparams;\n    size_t n = *nparams;\n\n    virResetLastError();\n\n    if (VIR_RESIZE_N(*params, max, n, 1) < 0)\n        goto error;\n    *maxparams = max;\n\n    if (virTypedParameterAssign(*params + n, name,\n                                VIR_TYPED_PARAM_INT, value) < 0)\n        goto error;\n\n    *nparams += 1;\n    return 0;\n\n error:\n    virDispatchError(NULL);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtypedparam.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include <config.h>\n\nint\nvirTypedParamsAddInt(virTypedParameterPtr *params,\n                     int *nparams,\n                     int *maxparams,\n                     const char *name,\n                     int value)\n{\n    size_t max = *maxparams;\n    size_t n = *nparams;\n\n    virResetLastError();\n\n    if (VIR_RESIZE_N(*params, max, n, 1) < 0)\n        goto error;\n    *maxparams = max;\n\n    if (virTypedParameterAssign(*params + n, name,\n                                VIR_TYPED_PARAM_INT, value) < 0)\n        goto error;\n\n    *nparams += 1;\n    return 0;\n\n error:\n    virDispatchError(NULL);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'offset' missing in reply of guest-get-timezone\")"
          ],
          "line": 2478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"'offset' missing in reply of guest-get-timezone\""
          ],
          "line": 2479
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberInt",
          "args": [
            "data",
            "\"offset\"",
            "&offset"
          ],
          "line": 2477
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1331-1342",
          "snippet": "int\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTypedParamsAddString",
          "args": [
            "params",
            "nparams",
            "maxparams",
            "\"timezone.name\"",
            "name"
          ],
          "line": 2473
        },
        "resolved": true,
        "details": {
          "function_name": "virTypedParamsAddStringList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtypedparam-public.c",
          "lines": "768-788",
          "snippet": "int\nvirTypedParamsAddStringList(virTypedParameterPtr *params,\n                            int *nparams,\n                            int *maxparams,\n                            const char *name,\n                            const char **values)\n{\n    size_t i;\n    int rv = -1;\n\n    if (!values)\n        return 0;\n\n    for (i = 0; values[i]; i++) {\n        if ((rv = virTypedParamsAddString(params, nparams, maxparams,\n                                          name, values[i])) < 0)\n            break;\n    }\n\n    return rv;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtypedparam.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include <config.h>\n\nint\nvirTypedParamsAddStringList(virTypedParameterPtr *params,\n                            int *nparams,\n                            int *maxparams,\n                            const char *name,\n                            const char **values)\n{\n    size_t i;\n    int rv = -1;\n\n    if (!values)\n        return 0;\n\n    for (i = 0; values[i]; i++) {\n        if ((rv = virTypedParamsAddString(params, nparams, maxparams,\n                                          name, values[i])) < 0)\n            break;\n    }\n\n    return rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "data",
            "\"zone\""
          ],
          "line": 2472
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"guest-get-timezone reply was missing return data\")"
          ],
          "line": 2467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetObject",
          "args": [
            "reply",
            "\"return\""
          ],
          "line": 2466
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1415-1419",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetObject(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_OBJECT);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetObject(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_OBJECT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentErrorCommandUnsupported",
          "args": [
            "reply"
          ],
          "line": 2461
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentErrorCommandUnsupported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1002-1019",
          "snippet": "static bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 2460
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-get-timezone\"",
            "NULL"
          ],
          "line": 2457
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentGetTimezone(qemuAgentPtr agent,\n                     virTypedParameterPtr *params,\n                     int *nparams,\n                     int *maxparams)\n{\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    virJSONValuePtr data = NULL;\n    const char *name;\n    int offset;\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-get-timezone\", NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            return -2;\n        return -1;\n    }\n\n    if (!(data = virJSONValueObjectGetObject(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-timezone reply was missing return data\"));\n        return -1;\n    }\n\n    if ((name = virJSONValueObjectGetString(data, \"zone\")) &&\n        virTypedParamsAddString(params, nparams, maxparams,\n                                \"timezone.name\", name) < 0)\n        return -1;\n\n    if ((virJSONValueObjectGetNumberInt(data, \"offset\", &offset)) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"'offset' missing in reply of guest-get-timezone\"));\n        return -1;\n    }\n\n    if (virTypedParamsAddInt(params, nparams, maxparams,\n                             \"timezone.offset\", offset) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuAgentGetOSInfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "2392-2439",
    "snippet": "int\nqemuAgentGetOSInfo(qemuAgentPtr agent,\n                   virTypedParameterPtr *params,\n                   int *nparams,\n                   int *maxparams)\n{\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    virJSONValuePtr data = NULL;\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-get-osinfo\", NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            return -2;\n        return -1;\n    }\n\n    if (!(data = virJSONValueObjectGetObject(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-osinfo reply was missing return data\"));\n        return -1;\n    }\n\n#define OSINFO_ADD_PARAM(agent_string_, param_string_) \\\n    do { \\\n        const char *result; \\\n        if ((result = virJSONValueObjectGetString(data, agent_string_))) { \\\n            if (virTypedParamsAddString(params, nparams, maxparams, \\\n                                        param_string_, result) < 0) { \\\n                return -1; \\\n            } \\\n        } \\\n    } while (0)\n    OSINFO_ADD_PARAM(\"id\", \"os.id\");\n    OSINFO_ADD_PARAM(\"name\", \"os.name\");\n    OSINFO_ADD_PARAM(\"pretty-name\", \"os.pretty-name\");\n    OSINFO_ADD_PARAM(\"version\", \"os.version\");\n    OSINFO_ADD_PARAM(\"version-id\", \"os.version-id\");\n    OSINFO_ADD_PARAM(\"machine\", \"os.machine\");\n    OSINFO_ADD_PARAM(\"variant\", \"os.variant\");\n    OSINFO_ADD_PARAM(\"variant-id\", \"os.variant-id\");\n    OSINFO_ADD_PARAM(\"kernel-release\", \"os.kernel-release\");\n    OSINFO_ADD_PARAM(\"kernel-version\", \"os.kernel-version\");\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"kernel-version\"",
            "\"os.kernel-version\""
          ],
          "line": 2436
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"kernel-release\"",
            "\"os.kernel-release\""
          ],
          "line": 2435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"variant-id\"",
            "\"os.variant-id\""
          ],
          "line": 2434
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"variant\"",
            "\"os.variant\""
          ],
          "line": 2433
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"machine\"",
            "\"os.machine\""
          ],
          "line": 2432
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"version-id\"",
            "\"os.version-id\""
          ],
          "line": 2431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"version\"",
            "\"os.version\""
          ],
          "line": 2430
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"pretty-name\"",
            "\"os.pretty-name\""
          ],
          "line": 2429
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"name\"",
            "\"os.name\""
          ],
          "line": 2428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OSINFO_ADD_PARAM",
          "args": [
            "\"id\"",
            "\"os.id\""
          ],
          "line": 2427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"guest-get-osinfo reply was missing return data\")"
          ],
          "line": 2412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"guest-get-osinfo reply was missing return data\""
          ],
          "line": 2413
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetObject",
          "args": [
            "reply",
            "\"return\""
          ],
          "line": 2411
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1415-1419",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetObject(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_OBJECT);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetObject(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_OBJECT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentErrorCommandUnsupported",
          "args": [
            "reply"
          ],
          "line": 2406
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentErrorCommandUnsupported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1002-1019",
          "snippet": "static bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 2405
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-get-osinfo\"",
            "NULL"
          ],
          "line": 2402
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentGetOSInfo(qemuAgentPtr agent,\n                   virTypedParameterPtr *params,\n                   int *nparams,\n                   int *maxparams)\n{\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    virJSONValuePtr data = NULL;\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-get-osinfo\", NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            return -2;\n        return -1;\n    }\n\n    if (!(data = virJSONValueObjectGetObject(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-osinfo reply was missing return data\"));\n        return -1;\n    }\n\n#define OSINFO_ADD_PARAM(agent_string_, param_string_) \\\n    do { \\\n        const char *result; \\\n        if ((result = virJSONValueObjectGetString(data, agent_string_))) { \\\n            if (virTypedParamsAddString(params, nparams, maxparams, \\\n                                        param_string_, result) < 0) { \\\n                return -1; \\\n            } \\\n        } \\\n    } while (0)\n    OSINFO_ADD_PARAM(\"id\", \"os.id\");\n    OSINFO_ADD_PARAM(\"name\", \"os.name\");\n    OSINFO_ADD_PARAM(\"pretty-name\", \"os.pretty-name\");\n    OSINFO_ADD_PARAM(\"version\", \"os.version\");\n    OSINFO_ADD_PARAM(\"version-id\", \"os.version-id\");\n    OSINFO_ADD_PARAM(\"machine\", \"os.machine\");\n    OSINFO_ADD_PARAM(\"variant\", \"os.variant\");\n    OSINFO_ADD_PARAM(\"variant-id\", \"os.variant-id\");\n    OSINFO_ADD_PARAM(\"kernel-release\", \"os.kernel-release\");\n    OSINFO_ADD_PARAM(\"kernel-version\", \"os.kernel-version\");\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuAgentGetUsers",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "2301-2386",
    "snippet": "int\nqemuAgentGetUsers(qemuAgentPtr agent,\n                  virTypedParameterPtr *params,\n                  int *nparams,\n                  int *maxparams)\n{\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    virJSONValuePtr data = NULL;\n    size_t ndata;\n    size_t i;\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-get-users\", NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            return -2;\n        return -1;\n    }\n\n    if (!(data = virJSONValueObjectGetArray(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-users reply was missing return data\"));\n        return -1;\n    }\n\n    if (!virJSONValueIsArray(data)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-users data array\"));\n        return -1;\n    }\n\n    ndata = virJSONValueArraySize(data);\n\n    if (virTypedParamsAddUInt(params, nparams, maxparams,\n                              \"user.count\", ndata) < 0)\n        return -1;\n\n    for (i = 0; i < ndata; i++) {\n        virJSONValuePtr entry = virJSONValueArrayGet(data, i);\n        char param_name[VIR_TYPED_PARAM_FIELD_LENGTH];\n        const char *strvalue;\n        double logintime;\n\n        if (!entry) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"array element missing in guest-get-users return \"\n                             \"value\"));\n            return -1;\n        }\n\n        if (!(strvalue = virJSONValueObjectGetString(entry, \"user\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'user' missing in reply of guest-get-users\"));\n            return -1;\n        }\n\n        g_snprintf(param_name, VIR_TYPED_PARAM_FIELD_LENGTH, \"user.%zu.name\", i);\n        if (virTypedParamsAddString(params, nparams, maxparams,\n                                    param_name, strvalue) < 0)\n            return -1;\n\n        /* 'domain' is only present for windows guests */\n        if ((strvalue = virJSONValueObjectGetString(entry, \"domain\"))) {\n            g_snprintf(param_name, VIR_TYPED_PARAM_FIELD_LENGTH,\n                       \"user.%zu.domain\", i);\n            if (virTypedParamsAddString(params, nparams, maxparams,\n                                        param_name, strvalue) < 0)\n                return -1;\n        }\n\n        if (virJSONValueObjectGetNumberDouble(entry, \"login-time\", &logintime) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'login-time' missing in reply of guest-get-users\"));\n            return -1;\n        }\n        g_snprintf(param_name, VIR_TYPED_PARAM_FIELD_LENGTH,\n                   \"user.%zu.login-time\", i);\n        if (virTypedParamsAddULLong(params, nparams, maxparams,\n                                    param_name, logintime * 1000) < 0)\n            return -1;\n    }\n\n    return ndata;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virTypedParamsAddULLong",
          "args": [
            "params",
            "nparams",
            "maxparams",
            "param_name",
            "logintime * 1000"
          ],
          "line": 2380
        },
        "resolved": true,
        "details": {
          "function_name": "virTypedParamsAddULLong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtypedparam-public.c",
          "lines": "578-604",
          "snippet": "int\nvirTypedParamsAddULLong(virTypedParameterPtr *params,\n                        int *nparams,\n                        int *maxparams,\n                        const char *name,\n                        unsigned long long value)\n{\n    size_t max = *maxparams;\n    size_t n = *nparams;\n\n    virResetLastError();\n\n    if (VIR_RESIZE_N(*params, max, n, 1) < 0)\n        goto error;\n    *maxparams = max;\n\n    if (virTypedParameterAssign(*params + n, name,\n                                VIR_TYPED_PARAM_ULLONG, value) < 0)\n        goto error;\n\n    *nparams += 1;\n    return 0;\n\n error:\n    virDispatchError(NULL);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtypedparam.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include <config.h>\n\nint\nvirTypedParamsAddULLong(virTypedParameterPtr *params,\n                        int *nparams,\n                        int *maxparams,\n                        const char *name,\n                        unsigned long long value)\n{\n    size_t max = *maxparams;\n    size_t n = *nparams;\n\n    virResetLastError();\n\n    if (VIR_RESIZE_N(*params, max, n, 1) < 0)\n        goto error;\n    *maxparams = max;\n\n    if (virTypedParameterAssign(*params + n, name,\n                                VIR_TYPED_PARAM_ULLONG, value) < 0)\n        goto error;\n\n    *nparams += 1;\n    return 0;\n\n error:\n    virDispatchError(NULL);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_snprintf",
          "args": [
            "param_name",
            "VIR_TYPED_PARAM_FIELD_LENGTH",
            "\"user.%zu.login-time\"",
            "i"
          ],
          "line": 2378
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'login-time' missing in reply of guest-get-users\")"
          ],
          "line": 2374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"'login-time' missing in reply of guest-get-users\""
          ],
          "line": 2375
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberDouble",
          "args": [
            "entry",
            "\"login-time\"",
            "&logintime"
          ],
          "line": 2373
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberDouble",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1387-1398",
          "snippet": "int\nvirJSONValueObjectGetNumberDouble(virJSONValuePtr object,\n                                  const char *key,\n                                  double *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberDouble(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberDouble(virJSONValuePtr object,\n                                  const char *key,\n                                  double *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberDouble(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTypedParamsAddString",
          "args": [
            "params",
            "nparams",
            "maxparams",
            "param_name",
            "strvalue"
          ],
          "line": 2368
        },
        "resolved": true,
        "details": {
          "function_name": "virTypedParamsAddStringList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtypedparam-public.c",
          "lines": "768-788",
          "snippet": "int\nvirTypedParamsAddStringList(virTypedParameterPtr *params,\n                            int *nparams,\n                            int *maxparams,\n                            const char *name,\n                            const char **values)\n{\n    size_t i;\n    int rv = -1;\n\n    if (!values)\n        return 0;\n\n    for (i = 0; values[i]; i++) {\n        if ((rv = virTypedParamsAddString(params, nparams, maxparams,\n                                          name, values[i])) < 0)\n            break;\n    }\n\n    return rv;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtypedparam.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include <config.h>\n\nint\nvirTypedParamsAddStringList(virTypedParameterPtr *params,\n                            int *nparams,\n                            int *maxparams,\n                            const char *name,\n                            const char **values)\n{\n    size_t i;\n    int rv = -1;\n\n    if (!values)\n        return 0;\n\n    for (i = 0; values[i]; i++) {\n        if ((rv = virTypedParamsAddString(params, nparams, maxparams,\n                                          name, values[i])) < 0)\n            break;\n    }\n\n    return rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_snprintf",
          "args": [
            "param_name",
            "VIR_TYPED_PARAM_FIELD_LENGTH",
            "\"user.%zu.domain\"",
            "i"
          ],
          "line": 2366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "entry",
            "\"domain\""
          ],
          "line": 2365
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_snprintf",
          "args": [
            "param_name",
            "VIR_TYPED_PARAM_FIELD_LENGTH",
            "\"user.%zu.name\"",
            "i"
          ],
          "line": 2359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'user' missing in reply of guest-get-users\")"
          ],
          "line": 2354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"array element missing in guest-get-users return \"\n                             \"value\")"
          ],
          "line": 2347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "data",
            "i"
          ],
          "line": 2341
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTypedParamsAddUInt",
          "args": [
            "params",
            "nparams",
            "maxparams",
            "\"user.count\"",
            "ndata"
          ],
          "line": 2336
        },
        "resolved": true,
        "details": {
          "function_name": "virTypedParamsAddUInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtypedparam-public.c",
          "lines": "484-510",
          "snippet": "int\nvirTypedParamsAddUInt(virTypedParameterPtr *params,\n                      int *nparams,\n                      int *maxparams,\n                      const char *name,\n                      unsigned int value)\n{\n    size_t max = *maxparams;\n    size_t n = *nparams;\n\n    virResetLastError();\n\n    if (VIR_RESIZE_N(*params, max, n, 1) < 0)\n        goto error;\n    *maxparams = max;\n\n    if (virTypedParameterAssign(*params + n, name,\n                                VIR_TYPED_PARAM_UINT, value) < 0)\n        goto error;\n\n    *nparams += 1;\n    return 0;\n\n error:\n    virDispatchError(NULL);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtypedparam.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include <config.h>\n\nint\nvirTypedParamsAddUInt(virTypedParameterPtr *params,\n                      int *nparams,\n                      int *maxparams,\n                      const char *name,\n                      unsigned int value)\n{\n    size_t max = *maxparams;\n    size_t n = *nparams;\n\n    virResetLastError();\n\n    if (VIR_RESIZE_N(*params, max, n, 1) < 0)\n        goto error;\n    *maxparams = max;\n\n    if (virTypedParameterAssign(*params + n, name,\n                                VIR_TYPED_PARAM_UINT, value) < 0)\n        goto error;\n\n    *nparams += 1;\n    return 0;\n\n error:\n    virDispatchError(NULL);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "data"
          ],
          "line": 2334
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed guest-get-users data array\")"
          ],
          "line": 2329
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueIsArray",
          "args": [
            "data"
          ],
          "line": 2328
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueIsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1010-1014",
          "snippet": "bool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nbool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"guest-get-users reply was missing return data\")"
          ],
          "line": 2323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetArray",
          "args": [
            "reply",
            "\"return\""
          ],
          "line": 2322
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentErrorCommandUnsupported",
          "args": [
            "reply"
          ],
          "line": 2317
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentErrorCommandUnsupported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1002-1019",
          "snippet": "static bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 2316
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-get-users\"",
            "NULL"
          ],
          "line": 2313
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentGetUsers(qemuAgentPtr agent,\n                  virTypedParameterPtr *params,\n                  int *nparams,\n                  int *maxparams)\n{\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    virJSONValuePtr data = NULL;\n    size_t ndata;\n    size_t i;\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-get-users\", NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            return -2;\n        return -1;\n    }\n\n    if (!(data = virJSONValueObjectGetArray(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-users reply was missing return data\"));\n        return -1;\n    }\n\n    if (!virJSONValueIsArray(data)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-users data array\"));\n        return -1;\n    }\n\n    ndata = virJSONValueArraySize(data);\n\n    if (virTypedParamsAddUInt(params, nparams, maxparams,\n                              \"user.count\", ndata) < 0)\n        return -1;\n\n    for (i = 0; i < ndata; i++) {\n        virJSONValuePtr entry = virJSONValueArrayGet(data, i);\n        char param_name[VIR_TYPED_PARAM_FIELD_LENGTH];\n        const char *strvalue;\n        double logintime;\n\n        if (!entry) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"array element missing in guest-get-users return \"\n                             \"value\"));\n            return -1;\n        }\n\n        if (!(strvalue = virJSONValueObjectGetString(entry, \"user\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'user' missing in reply of guest-get-users\"));\n            return -1;\n        }\n\n        g_snprintf(param_name, VIR_TYPED_PARAM_FIELD_LENGTH, \"user.%zu.name\", i);\n        if (virTypedParamsAddString(params, nparams, maxparams,\n                                    param_name, strvalue) < 0)\n            return -1;\n\n        /* 'domain' is only present for windows guests */\n        if ((strvalue = virJSONValueObjectGetString(entry, \"domain\"))) {\n            g_snprintf(param_name, VIR_TYPED_PARAM_FIELD_LENGTH,\n                       \"user.%zu.domain\", i);\n            if (virTypedParamsAddString(params, nparams, maxparams,\n                                        param_name, strvalue) < 0)\n                return -1;\n        }\n\n        if (virJSONValueObjectGetNumberDouble(entry, \"login-time\", &logintime) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'login-time' missing in reply of guest-get-users\"));\n            return -1;\n        }\n        g_snprintf(param_name, VIR_TYPED_PARAM_FIELD_LENGTH,\n                   \"user.%zu.login-time\", i);\n        if (virTypedParamsAddULLong(params, nparams, maxparams,\n                                    param_name, logintime * 1000) < 0)\n            return -1;\n    }\n\n    return ndata;\n}"
  },
  {
    "function_name": "qemuAgentSetUserPassword",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "2271-2295",
    "snippet": "int\nqemuAgentSetUserPassword(qemuAgentPtr agent,\n                         const char *user,\n                         const char *password,\n                         bool crypted)\n{\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    g_autofree char *password64 = NULL;\n\n    password64 = g_base64_encode((unsigned char *)password,\n                                 strlen(password));\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-set-user-password\",\n                                     \"b:crypted\", crypted,\n                                     \"s:username\", user,\n                                     \"s:password\", password64,\n                                     NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 2291
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-set-user-password\"",
            "\"b:crypted\"",
            "crypted",
            "\"s:username\"",
            "user",
            "\"s:password\"",
            "password64",
            "NULL"
          ],
          "line": 2284
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_base64_encode",
          "args": [
            "(unsigned char *)password",
            "strlen(password)"
          ],
          "line": 2281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "password"
          ],
          "line": 2282
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentSetUserPassword(qemuAgentPtr agent,\n                         const char *user,\n                         const char *password,\n                         bool crypted)\n{\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    g_autofree char *password64 = NULL;\n\n    password64 = g_base64_encode((unsigned char *)password,\n                                 strlen(password));\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-set-user-password\",\n                                     \"b:crypted\", crypted,\n                                     \"s:username\", user,\n                                     \"s:password\", password64,\n                                     NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuAgentGetInterfaces",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "2091-2268",
    "snippet": "int\nqemuAgentGetInterfaces(qemuAgentPtr agent,\n                       virDomainInterfacePtr **ifaces)\n{\n    int ret = -1;\n    size_t i, j;\n    virJSONValuePtr cmd = NULL;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr ret_array = NULL;\n    size_t ifaces_count = 0;\n    size_t addrs_count = 0;\n    virDomainInterfacePtr *ifaces_ret = NULL;\n    virHashTablePtr ifaces_store = NULL;\n    char **ifname = NULL;\n\n    /* Hash table to handle the interface alias */\n    if (!(ifaces_store = virHashCreate(ifaces_count, NULL))) {\n        virHashFree(ifaces_store);\n        return -1;\n    }\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-network-get-interfaces\", NULL)))\n        goto cleanup;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (!(ret_array = virJSONValueObjectGet(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"qemu agent didn't provide 'return' field\"));\n        goto cleanup;\n    }\n\n    if (!virJSONValueIsArray(ret_array)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"qemu agent didn't return an array of interfaces\"));\n        goto cleanup;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(ret_array); i++) {\n        virJSONValuePtr tmp_iface = virJSONValueArrayGet(ret_array, i);\n        virJSONValuePtr ip_addr_arr = NULL;\n        const char *hwaddr, *ifname_s, *name = NULL;\n        virDomainInterfacePtr iface = NULL;\n\n        /* Shouldn't happen but doesn't hurt to check neither */\n        if (!tmp_iface) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"qemu agent reply missing interface entry in array\"));\n            goto error;\n        }\n\n        /* interface name is required to be presented */\n        name = virJSONValueObjectGetString(tmp_iface, \"name\");\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"qemu agent didn't provide 'name' field\"));\n            goto error;\n        }\n\n        /* Handle interface alias (<ifname>:<alias>) */\n        ifname = virStringSplit(name, \":\", 2);\n        ifname_s = ifname[0];\n\n        iface = virHashLookup(ifaces_store, ifname_s);\n\n        /* If the hash table doesn't contain this iface, add it */\n        if (!iface) {\n            if (VIR_EXPAND_N(ifaces_ret, ifaces_count, 1) < 0)\n                goto error;\n\n            if (VIR_ALLOC(ifaces_ret[ifaces_count - 1]) < 0)\n                goto error;\n\n            if (virHashAddEntry(ifaces_store, ifname_s,\n                                ifaces_ret[ifaces_count - 1]) < 0)\n                goto error;\n\n            iface = ifaces_ret[ifaces_count - 1];\n            iface->naddrs = 0;\n\n            iface->name = g_strdup(ifname_s);\n\n            hwaddr = virJSONValueObjectGetString(tmp_iface, \"hardware-address\");\n            iface->hwaddr = g_strdup(hwaddr);\n        }\n\n        /* Has to be freed for each interface. */\n        virStringListFree(ifname);\n\n        /* as well as IP address which - moreover -\n         * can be presented multiple times */\n        ip_addr_arr = virJSONValueObjectGet(tmp_iface, \"ip-addresses\");\n        if (!ip_addr_arr)\n            continue;\n\n        if (!virJSONValueIsArray(ip_addr_arr)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Malformed ip-addresses array\"));\n            goto error;\n        }\n\n        /* If current iface already exists, continue with the count */\n        addrs_count = iface->naddrs;\n\n        for (j = 0; j < virJSONValueArraySize(ip_addr_arr); j++) {\n            const char *type, *addr;\n            virJSONValuePtr ip_addr_obj = virJSONValueArrayGet(ip_addr_arr, j);\n            virDomainIPAddressPtr ip_addr;\n\n            if (VIR_EXPAND_N(iface->addrs, addrs_count, 1)  < 0)\n                goto error;\n\n            ip_addr = &iface->addrs[addrs_count - 1];\n\n            /* Shouldn't happen but doesn't hurt to check neither */\n            if (!ip_addr_obj) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"qemu agent reply missing IP addr in array\"));\n                goto error;\n            }\n\n            type = virJSONValueObjectGetString(ip_addr_obj, \"ip-address-type\");\n            if (!type) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"qemu agent didn't provide 'ip-address-type'\"\n                                 \" field for interface '%s'\"), name);\n                goto error;\n            } else if (STREQ(type, \"ipv4\")) {\n                ip_addr->type = VIR_IP_ADDR_TYPE_IPV4;\n            } else if (STREQ(type, \"ipv6\")) {\n                ip_addr->type = VIR_IP_ADDR_TYPE_IPV6;\n            } else {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"unknown ip address type '%s'\"),\n                               type);\n                goto error;\n            }\n\n            addr = virJSONValueObjectGetString(ip_addr_obj, \"ip-address\");\n            if (!addr) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"qemu agent didn't provide 'ip-address'\"\n                                 \" field for interface '%s'\"), name);\n                goto error;\n            }\n            ip_addr->addr = g_strdup(addr);\n\n            if (virJSONValueObjectGetNumberUint(ip_addr_obj, \"prefix\",\n                                                &ip_addr->prefix) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"malformed 'prefix' field\"));\n                goto error;\n            }\n        }\n\n        iface->naddrs = addrs_count;\n    }\n\n    *ifaces = g_steal_pointer(&ifaces_ret);\n    ret = ifaces_count;\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    virHashFree(ifaces_store);\n    return ret;\n\n error:\n    if (ifaces_ret) {\n        for (i = 0; i < ifaces_count; i++)\n            virDomainInterfaceFree(ifaces_ret[i]);\n    }\n    VIR_FREE(ifaces_ret);\n    virStringListFree(ifname);\n\n    goto cleanup;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStringListFree",
          "args": [
            "ifname"
          ],
          "line": 2265
        },
        "resolved": true,
        "details": {
          "function_name": "virStringListFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "306-314",
          "snippet": "void virStringListFree(char **strings)\n{\n    char **tmp = strings;\n    while (tmp && *tmp) {\n        VIR_FREE(*tmp);\n        tmp++;\n    }\n    VIR_FREE(strings);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nvoid virStringListFree(char **strings)\n{\n    char **tmp = strings;\n    while (tmp && *tmp) {\n        VIR_FREE(*tmp);\n        tmp++;\n    }\n    VIR_FREE(strings);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ifaces_ret"
          ],
          "line": 2264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainInterfaceFree",
          "args": [
            "ifaces_ret[i]"
          ],
          "line": 2262
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainInterfaceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "12074-12090",
          "snippet": "void\nvirDomainInterfaceFree(virDomainInterfacePtr iface)\n{\n    size_t i;\n\n    if (!iface)\n        return;\n\n    VIR_FREE(iface->name);\n    VIR_FREE(iface->hwaddr);\n\n    for (i = 0; i < iface->naddrs; i++)\n        VIR_FREE(iface->addrs[i].addr);\n    VIR_FREE(iface->addrs);\n\n    VIR_FREE(iface);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nvoid\nvirDomainInterfaceFree(virDomainInterfacePtr iface)\n{\n    size_t i;\n\n    if (!iface)\n        return;\n\n    VIR_FREE(iface->name);\n    VIR_FREE(iface->hwaddr);\n\n    for (i = 0; i < iface->naddrs; i++)\n        VIR_FREE(iface->addrs[i].addr);\n    VIR_FREE(iface->addrs);\n\n    VIR_FREE(iface);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashFree",
          "args": [
            "ifaces_store"
          ],
          "line": 2256
        },
        "resolved": true,
        "details": {
          "function_name": "virHashFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "313-337",
          "snippet": "void\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 2255
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&ifaces_ret"
          ],
          "line": 2250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"malformed 'prefix' field\")"
          ],
          "line": 2241
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"malformed 'prefix' field\""
          ],
          "line": 2242
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberUint",
          "args": [
            "ip_addr_obj",
            "\"prefix\"",
            "&ip_addr->prefix"
          ],
          "line": 2239
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberUint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1345-1356",
          "snippet": "int\nvirJSONValueObjectGetNumberUint(virJSONValuePtr object,\n                                const char *key,\n                                unsigned int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUint(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberUint(virJSONValuePtr object,\n                                const char *key,\n                                unsigned int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUint(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "addr"
          ],
          "line": 2237
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"qemu agent didn't provide 'ip-address'\"\n                                 \" field for interface '%s'\")",
            "name"
          ],
          "line": 2232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "ip_addr_obj",
            "\"ip-address\""
          ],
          "line": 2230
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"unknown ip address type '%s'\")",
            "type"
          ],
          "line": 2224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "type",
            "\"ipv6\""
          ],
          "line": 2221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "type",
            "\"ipv4\""
          ],
          "line": 2219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"qemu agent didn't provide 'ip-address-type'\"\n                                 \" field for interface '%s'\")",
            "name"
          ],
          "line": 2215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"qemu agent reply missing IP addr in array\")"
          ],
          "line": 2208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "iface->addrs",
            "addrs_count",
            "1"
          ],
          "line": 2201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "ip_addr_arr",
            "j"
          ],
          "line": 2198
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "ip_addr_arr"
          ],
          "line": 2196
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed ip-addresses array\")"
          ],
          "line": 2188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueIsArray",
          "args": [
            "ip_addr_arr"
          ],
          "line": 2187
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueIsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1010-1014",
          "snippet": "bool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nbool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "tmp_iface",
            "\"ip-addresses\""
          ],
          "line": 2183
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "ifaces_store",
            "ifname_s",
            "ifaces_ret[ifaces_count - 1]"
          ],
          "line": 2165
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "ifaces_ret[ifaces_count - 1]"
          ],
          "line": 2162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "ifaces_ret",
            "ifaces_count",
            "1"
          ],
          "line": 2159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "ifaces_store",
            "ifname_s"
          ],
          "line": 2155
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStringSplit",
          "args": [
            "name",
            "\":\"",
            "2"
          ],
          "line": 2152
        },
        "resolved": true,
        "details": {
          "function_name": "virStringSplit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "126-132",
          "snippet": "char **\nvirStringSplit(const char *string,\n               const char *delim,\n               size_t max_tokens)\n{\n    return virStringSplitCount(string, delim, max_tokens, NULL);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nchar **\nvirStringSplit(const char *string,\n               const char *delim,\n               size_t max_tokens)\n{\n    return virStringSplitCount(string, delim, max_tokens, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"qemu agent didn't provide 'name' field\")"
          ],
          "line": 2146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"qemu agent reply missing interface entry in array\")"
          ],
          "line": 2138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"qemu agent didn't return an array of interfaces\")"
          ],
          "line": 2125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"qemu agent didn't provide 'return' field\")"
          ],
          "line": 2119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 2115
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-network-get-interfaces\"",
            "NULL"
          ],
          "line": 2112
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashCreate",
          "args": [
            "ifaces_count",
            "NULL"
          ],
          "line": 2107
        },
        "resolved": true,
        "details": {
          "function_name": "virHashCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "202-211",
          "snippet": "virHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentGetInterfaces(qemuAgentPtr agent,\n                       virDomainInterfacePtr **ifaces)\n{\n    int ret = -1;\n    size_t i, j;\n    virJSONValuePtr cmd = NULL;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr ret_array = NULL;\n    size_t ifaces_count = 0;\n    size_t addrs_count = 0;\n    virDomainInterfacePtr *ifaces_ret = NULL;\n    virHashTablePtr ifaces_store = NULL;\n    char **ifname = NULL;\n\n    /* Hash table to handle the interface alias */\n    if (!(ifaces_store = virHashCreate(ifaces_count, NULL))) {\n        virHashFree(ifaces_store);\n        return -1;\n    }\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-network-get-interfaces\", NULL)))\n        goto cleanup;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (!(ret_array = virJSONValueObjectGet(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"qemu agent didn't provide 'return' field\"));\n        goto cleanup;\n    }\n\n    if (!virJSONValueIsArray(ret_array)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"qemu agent didn't return an array of interfaces\"));\n        goto cleanup;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(ret_array); i++) {\n        virJSONValuePtr tmp_iface = virJSONValueArrayGet(ret_array, i);\n        virJSONValuePtr ip_addr_arr = NULL;\n        const char *hwaddr, *ifname_s, *name = NULL;\n        virDomainInterfacePtr iface = NULL;\n\n        /* Shouldn't happen but doesn't hurt to check neither */\n        if (!tmp_iface) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"qemu agent reply missing interface entry in array\"));\n            goto error;\n        }\n\n        /* interface name is required to be presented */\n        name = virJSONValueObjectGetString(tmp_iface, \"name\");\n        if (!name) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"qemu agent didn't provide 'name' field\"));\n            goto error;\n        }\n\n        /* Handle interface alias (<ifname>:<alias>) */\n        ifname = virStringSplit(name, \":\", 2);\n        ifname_s = ifname[0];\n\n        iface = virHashLookup(ifaces_store, ifname_s);\n\n        /* If the hash table doesn't contain this iface, add it */\n        if (!iface) {\n            if (VIR_EXPAND_N(ifaces_ret, ifaces_count, 1) < 0)\n                goto error;\n\n            if (VIR_ALLOC(ifaces_ret[ifaces_count - 1]) < 0)\n                goto error;\n\n            if (virHashAddEntry(ifaces_store, ifname_s,\n                                ifaces_ret[ifaces_count - 1]) < 0)\n                goto error;\n\n            iface = ifaces_ret[ifaces_count - 1];\n            iface->naddrs = 0;\n\n            iface->name = g_strdup(ifname_s);\n\n            hwaddr = virJSONValueObjectGetString(tmp_iface, \"hardware-address\");\n            iface->hwaddr = g_strdup(hwaddr);\n        }\n\n        /* Has to be freed for each interface. */\n        virStringListFree(ifname);\n\n        /* as well as IP address which - moreover -\n         * can be presented multiple times */\n        ip_addr_arr = virJSONValueObjectGet(tmp_iface, \"ip-addresses\");\n        if (!ip_addr_arr)\n            continue;\n\n        if (!virJSONValueIsArray(ip_addr_arr)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Malformed ip-addresses array\"));\n            goto error;\n        }\n\n        /* If current iface already exists, continue with the count */\n        addrs_count = iface->naddrs;\n\n        for (j = 0; j < virJSONValueArraySize(ip_addr_arr); j++) {\n            const char *type, *addr;\n            virJSONValuePtr ip_addr_obj = virJSONValueArrayGet(ip_addr_arr, j);\n            virDomainIPAddressPtr ip_addr;\n\n            if (VIR_EXPAND_N(iface->addrs, addrs_count, 1)  < 0)\n                goto error;\n\n            ip_addr = &iface->addrs[addrs_count - 1];\n\n            /* Shouldn't happen but doesn't hurt to check neither */\n            if (!ip_addr_obj) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"qemu agent reply missing IP addr in array\"));\n                goto error;\n            }\n\n            type = virJSONValueObjectGetString(ip_addr_obj, \"ip-address-type\");\n            if (!type) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"qemu agent didn't provide 'ip-address-type'\"\n                                 \" field for interface '%s'\"), name);\n                goto error;\n            } else if (STREQ(type, \"ipv4\")) {\n                ip_addr->type = VIR_IP_ADDR_TYPE_IPV4;\n            } else if (STREQ(type, \"ipv6\")) {\n                ip_addr->type = VIR_IP_ADDR_TYPE_IPV6;\n            } else {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"unknown ip address type '%s'\"),\n                               type);\n                goto error;\n            }\n\n            addr = virJSONValueObjectGetString(ip_addr_obj, \"ip-address\");\n            if (!addr) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"qemu agent didn't provide 'ip-address'\"\n                                 \" field for interface '%s'\"), name);\n                goto error;\n            }\n            ip_addr->addr = g_strdup(addr);\n\n            if (virJSONValueObjectGetNumberUint(ip_addr_obj, \"prefix\",\n                                                &ip_addr->prefix) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"malformed 'prefix' field\"));\n                goto error;\n            }\n        }\n\n        iface->naddrs = addrs_count;\n    }\n\n    *ifaces = g_steal_pointer(&ifaces_ret);\n    ret = ifaces_count;\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    virHashFree(ifaces_store);\n    return ret;\n\n error:\n    if (ifaces_ret) {\n        for (i = 0; i < ifaces_count; i++)\n            virDomainInterfaceFree(ifaces_ret[i]);\n    }\n    VIR_FREE(ifaces_ret);\n    virStringListFree(ifname);\n\n    goto cleanup;\n}"
  },
  {
    "function_name": "qemuAgentGetFSInfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1948-2078",
    "snippet": "int\nqemuAgentGetFSInfo(qemuAgentPtr agent,\n                   qemuAgentFSInfoPtr **info)\n{\n    size_t i;\n    int ret = -1;\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    virJSONValuePtr data;\n    size_t ndata = 0;\n    qemuAgentFSInfoPtr *info_ret = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-get-fsinfo\", NULL);\n    if (!cmd)\n        return ret;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            ret = -2;\n        goto cleanup;\n    }\n\n    if (!(data = virJSONValueObjectGet(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-fsinfo reply was missing return data\"));\n        goto cleanup;\n    }\n\n    if (!virJSONValueIsArray(data)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-fsinfo data array\"));\n        goto cleanup;\n    }\n\n    ndata = virJSONValueArraySize(data);\n    if (ndata == 0) {\n        ret = 0;\n        *info = NULL;\n        goto cleanup;\n    }\n    info_ret = g_new0(qemuAgentFSInfoPtr, ndata);\n\n    for (i = 0; i < ndata; i++) {\n        /* Reverse the order to arrange in mount order */\n        virJSONValuePtr entry = virJSONValueArrayGet(data, ndata - 1 - i);\n        virJSONValuePtr disk;\n        unsigned long long bytes_val;\n        const char *result = NULL;\n\n        if (!entry) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"array element '%zd' of '%zd' missing in \"\n                             \"guest-get-fsinfo return data\"),\n                           i, ndata);\n            goto cleanup;\n        }\n\n        info_ret[i] = g_new0(qemuAgentFSInfo, 1);\n\n        if (!(result = virJSONValueObjectGetString(entry, \"mountpoint\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'mountpoint' missing in reply of \"\n                             \"guest-get-fsinfo\"));\n            goto cleanup;\n        }\n\n        info_ret[i]->mountpoint = g_strdup(result);\n\n        if (!(result = virJSONValueObjectGetString(entry, \"name\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'name' missing in reply of guest-get-fsinfo\"));\n            goto cleanup;\n        }\n\n        info_ret[i]->name = g_strdup(result);\n\n        if (!(result = virJSONValueObjectGetString(entry, \"type\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'type' missing in reply of guest-get-fsinfo\"));\n            goto cleanup;\n        }\n\n        info_ret[i]->fstype = g_strdup(result);\n\n\n        /* 'used-bytes' and 'total-bytes' were added in qemu-ga 3.0 */\n        if (virJSONValueObjectHasKey(entry, \"used-bytes\")) {\n            if (virJSONValueObjectGetNumberUlong(entry, \"used-bytes\",\n                                                 &bytes_val) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Error getting 'used-bytes' in reply of guest-get-fsinfo\"));\n                goto cleanup;\n            }\n            info_ret[i]->used_bytes = bytes_val;\n        } else {\n            info_ret[i]->used_bytes = -1;\n        }\n\n        if (virJSONValueObjectHasKey(entry, \"total-bytes\")) {\n            if (virJSONValueObjectGetNumberUlong(entry, \"total-bytes\",\n                                                 &bytes_val) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Error getting 'total-bytes' in reply of guest-get-fsinfo\"));\n                goto cleanup;\n            }\n            info_ret[i]->total_bytes = bytes_val;\n        } else {\n            info_ret[i]->total_bytes = -1;\n        }\n\n        if (!(disk = virJSONValueObjectGet(entry, \"disk\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'disk' missing in reply of guest-get-fsinfo\"));\n            goto cleanup;\n        }\n\n        if (qemuAgentGetFSInfoFillDisks(disk, info_ret[i]) < 0)\n            goto cleanup;\n    }\n\n    *info = g_steal_pointer(&info_ret);\n    ret = ndata;\n\n cleanup:\n    if (info_ret) {\n        for (i = 0; i < ndata; i++)\n            qemuAgentFSInfoFree(info_ret[i]);\n        g_free(info_ret);\n    }\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info_ret"
          ],
          "line": 2075
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentFSInfoFree",
          "args": [
            "info_ret[i]"
          ],
          "line": 2074
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentFSInfoFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1849-1866",
          "snippet": "void\nqemuAgentFSInfoFree(qemuAgentFSInfoPtr info)\n{\n    size_t i;\n\n    if (!info)\n        return;\n\n    g_free(info->mountpoint);\n    g_free(info->name);\n    g_free(info->fstype);\n\n    for (i = 0; i < info->ndisks; i++)\n        qemuAgentDiskInfoFree(info->disks[i]);\n    g_free(info->disks);\n\n    g_free(info);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nvoid\nqemuAgentFSInfoFree(qemuAgentFSInfoPtr info)\n{\n    size_t i;\n\n    if (!info)\n        return;\n\n    g_free(info->mountpoint);\n    g_free(info->name);\n    g_free(info->fstype);\n\n    for (i = 0; i < info->ndisks; i++)\n        qemuAgentDiskInfoFree(info->disks[i]);\n    g_free(info->disks);\n\n    g_free(info);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&info_ret"
          ],
          "line": 2068
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentGetFSInfoFillDisks",
          "args": [
            "disk",
            "info_ret[i]"
          ],
          "line": 2064
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentGetFSInfoFillDisks",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1868-1942",
          "snippet": "static int\nqemuAgentGetFSInfoFillDisks(virJSONValuePtr jsondisks,\n                            qemuAgentFSInfoPtr fsinfo)\n{\n    size_t ndisks;\n    size_t i;\n\n    if (!virJSONValueIsArray(jsondisks)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-fsinfo 'disk' data array\"));\n        return -1;\n    }\n\n    ndisks = virJSONValueArraySize(jsondisks);\n\n    if (ndisks)\n        fsinfo->disks = g_new0(qemuAgentDiskInfoPtr, ndisks);\n    fsinfo->ndisks = ndisks;\n\n    for (i = 0; i < fsinfo->ndisks; i++) {\n        virJSONValuePtr jsondisk = virJSONValueArrayGet(jsondisks, i);\n        virJSONValuePtr pci;\n        qemuAgentDiskInfoPtr disk;\n        const char *val;\n\n        if (!jsondisk) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"array element '%zd' of '%zd' missing in \"\n                             \"guest-get-fsinfo 'disk' data\"),\n                           i, fsinfo->ndisks);\n            return -1;\n        }\n\n        fsinfo->disks[i] = g_new0(qemuAgentDiskInfo, 1);\n        disk = fsinfo->disks[i];\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"bus-type\")))\n            disk->bus_type = g_strdup(val);\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"serial\")))\n            disk->serial = g_strdup(val);\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"dev\")))\n            disk->devnode = g_strdup(val);\n\n#define GET_DISK_ADDR(jsonObject, var, name) \\\n        do { \\\n            if (virJSONValueObjectGetNumberUint(jsonObject, name, var) < 0) { \\\n                virReportError(VIR_ERR_INTERNAL_ERROR, \\\n                               _(\"'%s' missing in guest-get-fsinfo \" \\\n                                 \"'disk' data\"), name); \\\n                return -1; \\\n            } \\\n        } while (0)\n\n        GET_DISK_ADDR(jsondisk, &disk->bus, \"bus\");\n        GET_DISK_ADDR(jsondisk, &disk->target, \"target\");\n        GET_DISK_ADDR(jsondisk, &disk->unit, \"unit\");\n\n        if (!(pci = virJSONValueObjectGet(jsondisk, \"pci-controller\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'pci-controller' missing in guest-get-fsinfo \"\n                             \"'disk' data\"));\n            return -1;\n        }\n\n        GET_DISK_ADDR(pci, &disk->pci_controller.domain, \"domain\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.bus, \"bus\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.slot, \"slot\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.function, \"function\");\n#undef GET_DISK_ADDR\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentGetFSInfoFillDisks(virJSONValuePtr jsondisks,\n                            qemuAgentFSInfoPtr fsinfo)\n{\n    size_t ndisks;\n    size_t i;\n\n    if (!virJSONValueIsArray(jsondisks)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-fsinfo 'disk' data array\"));\n        return -1;\n    }\n\n    ndisks = virJSONValueArraySize(jsondisks);\n\n    if (ndisks)\n        fsinfo->disks = g_new0(qemuAgentDiskInfoPtr, ndisks);\n    fsinfo->ndisks = ndisks;\n\n    for (i = 0; i < fsinfo->ndisks; i++) {\n        virJSONValuePtr jsondisk = virJSONValueArrayGet(jsondisks, i);\n        virJSONValuePtr pci;\n        qemuAgentDiskInfoPtr disk;\n        const char *val;\n\n        if (!jsondisk) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"array element '%zd' of '%zd' missing in \"\n                             \"guest-get-fsinfo 'disk' data\"),\n                           i, fsinfo->ndisks);\n            return -1;\n        }\n\n        fsinfo->disks[i] = g_new0(qemuAgentDiskInfo, 1);\n        disk = fsinfo->disks[i];\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"bus-type\")))\n            disk->bus_type = g_strdup(val);\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"serial\")))\n            disk->serial = g_strdup(val);\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"dev\")))\n            disk->devnode = g_strdup(val);\n\n#define GET_DISK_ADDR(jsonObject, var, name) \\\n        do { \\\n            if (virJSONValueObjectGetNumberUint(jsonObject, name, var) < 0) { \\\n                virReportError(VIR_ERR_INTERNAL_ERROR, \\\n                               _(\"'%s' missing in guest-get-fsinfo \" \\\n                                 \"'disk' data\"), name); \\\n                return -1; \\\n            } \\\n        } while (0)\n\n        GET_DISK_ADDR(jsondisk, &disk->bus, \"bus\");\n        GET_DISK_ADDR(jsondisk, &disk->target, \"target\");\n        GET_DISK_ADDR(jsondisk, &disk->unit, \"unit\");\n\n        if (!(pci = virJSONValueObjectGet(jsondisk, \"pci-controller\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'pci-controller' missing in guest-get-fsinfo \"\n                             \"'disk' data\"));\n            return -1;\n        }\n\n        GET_DISK_ADDR(pci, &disk->pci_controller.domain, \"domain\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.bus, \"bus\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.slot, \"slot\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.function, \"function\");\n#undef GET_DISK_ADDR\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'disk' missing in reply of guest-get-fsinfo\")"
          ],
          "line": 2059
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"'disk' missing in reply of guest-get-fsinfo\""
          ],
          "line": 2060
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "entry",
            "\"disk\""
          ],
          "line": 2058
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Error getting 'total-bytes' in reply of guest-get-fsinfo\")"
          ],
          "line": 2049
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberUlong",
          "args": [
            "entry",
            "\"total-bytes\"",
            "&bytes_val"
          ],
          "line": 2047
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberUlong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1373-1384",
          "snippet": "int\nvirJSONValueObjectGetNumberUlong(virJSONValuePtr object,\n                                 const char *key,\n                                 unsigned long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUlong(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberUlong(virJSONValuePtr object,\n                                 const char *key,\n                                 unsigned long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUlong(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectHasKey",
          "args": [
            "entry",
            "\"total-bytes\""
          ],
          "line": 2046
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectHasKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "838-853",
          "snippet": "int\nvirJSONValueObjectHasKey(virJSONValuePtr object,\n                         const char *key)\n{\n    size_t i;\n\n    if (object->type != VIR_JSON_TYPE_OBJECT)\n        return -1;\n\n    for (i = 0; i < object->data.object.npairs; i++) {\n        if (STREQ(object->data.object.pairs[i].key, key))\n            return 1;\n    }\n\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectHasKey(virJSONValuePtr object,\n                         const char *key)\n{\n    size_t i;\n\n    if (object->type != VIR_JSON_TYPE_OBJECT)\n        return -1;\n\n    for (i = 0; i < object->data.object.npairs; i++) {\n        if (STREQ(object->data.object.pairs[i].key, key))\n            return 1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Error getting 'used-bytes' in reply of guest-get-fsinfo\")"
          ],
          "line": 2037
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "result"
          ],
          "line": 2030
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'type' missing in reply of guest-get-fsinfo\")"
          ],
          "line": 2025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "entry",
            "\"type\""
          ],
          "line": 2024
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'name' missing in reply of guest-get-fsinfo\")"
          ],
          "line": 2017
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'mountpoint' missing in reply of \"\n                             \"guest-get-fsinfo\")"
          ],
          "line": 2008
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "qemuAgentFSInfo",
            "1"
          ],
          "line": 2005
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"array element '%zd' of '%zd' missing in \"\n                             \"guest-get-fsinfo return data\")",
            "i",
            "ndata"
          ],
          "line": 1998
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "data",
            "ndata - 1 - i"
          ],
          "line": 1992
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "qemuAgentFSInfoPtr",
            "ndata"
          ],
          "line": 1988
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "data"
          ],
          "line": 1982
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed guest-get-fsinfo data array\")"
          ],
          "line": 1977
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueIsArray",
          "args": [
            "data"
          ],
          "line": 1976
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueIsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1010-1014",
          "snippet": "bool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nbool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"guest-get-fsinfo reply was missing return data\")"
          ],
          "line": 1971
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentErrorCommandUnsupported",
          "args": [
            "reply"
          ],
          "line": 1965
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentErrorCommandUnsupported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1002-1019",
          "snippet": "static bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1964
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-get-fsinfo\"",
            "NULL"
          ],
          "line": 1960
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentGetFSInfo(qemuAgentPtr agent,\n                   qemuAgentFSInfoPtr **info)\n{\n    size_t i;\n    int ret = -1;\n    g_autoptr(virJSONValue) cmd = NULL;\n    g_autoptr(virJSONValue) reply = NULL;\n    virJSONValuePtr data;\n    size_t ndata = 0;\n    qemuAgentFSInfoPtr *info_ret = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-get-fsinfo\", NULL);\n    if (!cmd)\n        return ret;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            ret = -2;\n        goto cleanup;\n    }\n\n    if (!(data = virJSONValueObjectGet(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-fsinfo reply was missing return data\"));\n        goto cleanup;\n    }\n\n    if (!virJSONValueIsArray(data)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-fsinfo data array\"));\n        goto cleanup;\n    }\n\n    ndata = virJSONValueArraySize(data);\n    if (ndata == 0) {\n        ret = 0;\n        *info = NULL;\n        goto cleanup;\n    }\n    info_ret = g_new0(qemuAgentFSInfoPtr, ndata);\n\n    for (i = 0; i < ndata; i++) {\n        /* Reverse the order to arrange in mount order */\n        virJSONValuePtr entry = virJSONValueArrayGet(data, ndata - 1 - i);\n        virJSONValuePtr disk;\n        unsigned long long bytes_val;\n        const char *result = NULL;\n\n        if (!entry) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"array element '%zd' of '%zd' missing in \"\n                             \"guest-get-fsinfo return data\"),\n                           i, ndata);\n            goto cleanup;\n        }\n\n        info_ret[i] = g_new0(qemuAgentFSInfo, 1);\n\n        if (!(result = virJSONValueObjectGetString(entry, \"mountpoint\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'mountpoint' missing in reply of \"\n                             \"guest-get-fsinfo\"));\n            goto cleanup;\n        }\n\n        info_ret[i]->mountpoint = g_strdup(result);\n\n        if (!(result = virJSONValueObjectGetString(entry, \"name\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'name' missing in reply of guest-get-fsinfo\"));\n            goto cleanup;\n        }\n\n        info_ret[i]->name = g_strdup(result);\n\n        if (!(result = virJSONValueObjectGetString(entry, \"type\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'type' missing in reply of guest-get-fsinfo\"));\n            goto cleanup;\n        }\n\n        info_ret[i]->fstype = g_strdup(result);\n\n\n        /* 'used-bytes' and 'total-bytes' were added in qemu-ga 3.0 */\n        if (virJSONValueObjectHasKey(entry, \"used-bytes\")) {\n            if (virJSONValueObjectGetNumberUlong(entry, \"used-bytes\",\n                                                 &bytes_val) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Error getting 'used-bytes' in reply of guest-get-fsinfo\"));\n                goto cleanup;\n            }\n            info_ret[i]->used_bytes = bytes_val;\n        } else {\n            info_ret[i]->used_bytes = -1;\n        }\n\n        if (virJSONValueObjectHasKey(entry, \"total-bytes\")) {\n            if (virJSONValueObjectGetNumberUlong(entry, \"total-bytes\",\n                                                 &bytes_val) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Error getting 'total-bytes' in reply of guest-get-fsinfo\"));\n                goto cleanup;\n            }\n            info_ret[i]->total_bytes = bytes_val;\n        } else {\n            info_ret[i]->total_bytes = -1;\n        }\n\n        if (!(disk = virJSONValueObjectGet(entry, \"disk\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'disk' missing in reply of guest-get-fsinfo\"));\n            goto cleanup;\n        }\n\n        if (qemuAgentGetFSInfoFillDisks(disk, info_ret[i]) < 0)\n            goto cleanup;\n    }\n\n    *info = g_steal_pointer(&info_ret);\n    ret = ndata;\n\n cleanup:\n    if (info_ret) {\n        for (i = 0; i < ndata; i++)\n            qemuAgentFSInfoFree(info_ret[i]);\n        g_free(info_ret);\n    }\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentGetFSInfoFillDisks",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1868-1942",
    "snippet": "static int\nqemuAgentGetFSInfoFillDisks(virJSONValuePtr jsondisks,\n                            qemuAgentFSInfoPtr fsinfo)\n{\n    size_t ndisks;\n    size_t i;\n\n    if (!virJSONValueIsArray(jsondisks)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-fsinfo 'disk' data array\"));\n        return -1;\n    }\n\n    ndisks = virJSONValueArraySize(jsondisks);\n\n    if (ndisks)\n        fsinfo->disks = g_new0(qemuAgentDiskInfoPtr, ndisks);\n    fsinfo->ndisks = ndisks;\n\n    for (i = 0; i < fsinfo->ndisks; i++) {\n        virJSONValuePtr jsondisk = virJSONValueArrayGet(jsondisks, i);\n        virJSONValuePtr pci;\n        qemuAgentDiskInfoPtr disk;\n        const char *val;\n\n        if (!jsondisk) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"array element '%zd' of '%zd' missing in \"\n                             \"guest-get-fsinfo 'disk' data\"),\n                           i, fsinfo->ndisks);\n            return -1;\n        }\n\n        fsinfo->disks[i] = g_new0(qemuAgentDiskInfo, 1);\n        disk = fsinfo->disks[i];\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"bus-type\")))\n            disk->bus_type = g_strdup(val);\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"serial\")))\n            disk->serial = g_strdup(val);\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"dev\")))\n            disk->devnode = g_strdup(val);\n\n#define GET_DISK_ADDR(jsonObject, var, name) \\\n        do { \\\n            if (virJSONValueObjectGetNumberUint(jsonObject, name, var) < 0) { \\\n                virReportError(VIR_ERR_INTERNAL_ERROR, \\\n                               _(\"'%s' missing in guest-get-fsinfo \" \\\n                                 \"'disk' data\"), name); \\\n                return -1; \\\n            } \\\n        } while (0)\n\n        GET_DISK_ADDR(jsondisk, &disk->bus, \"bus\");\n        GET_DISK_ADDR(jsondisk, &disk->target, \"target\");\n        GET_DISK_ADDR(jsondisk, &disk->unit, \"unit\");\n\n        if (!(pci = virJSONValueObjectGet(jsondisk, \"pci-controller\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'pci-controller' missing in guest-get-fsinfo \"\n                             \"'disk' data\"));\n            return -1;\n        }\n\n        GET_DISK_ADDR(pci, &disk->pci_controller.domain, \"domain\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.bus, \"bus\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.slot, \"slot\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.function, \"function\");\n#undef GET_DISK_ADDR\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GET_DISK_ADDR",
          "args": [
            "pci",
            "&disk->pci_controller.function",
            "\"function\""
          ],
          "line": 1937
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GET_DISK_ADDR",
          "args": [
            "pci",
            "&disk->pci_controller.slot",
            "\"slot\""
          ],
          "line": 1936
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GET_DISK_ADDR",
          "args": [
            "pci",
            "&disk->pci_controller.bus",
            "\"bus\""
          ],
          "line": 1935
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GET_DISK_ADDR",
          "args": [
            "pci",
            "&disk->pci_controller.domain",
            "\"domain\""
          ],
          "line": 1934
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'pci-controller' missing in guest-get-fsinfo \"\n                             \"'disk' data\")"
          ],
          "line": 1928
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"'pci-controller' missing in guest-get-fsinfo \"\n                             \"'disk' data\""
          ],
          "line": 1929
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "jsondisk",
            "\"pci-controller\""
          ],
          "line": 1927
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "GET_DISK_ADDR",
          "args": [
            "jsondisk",
            "&disk->unit",
            "\"unit\""
          ],
          "line": 1925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GET_DISK_ADDR",
          "args": [
            "jsondisk",
            "&disk->target",
            "\"target\""
          ],
          "line": 1924
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GET_DISK_ADDR",
          "args": [
            "jsondisk",
            "&disk->bus",
            "\"bus\""
          ],
          "line": 1923
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "val"
          ],
          "line": 1911
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "jsondisk",
            "\"dev\""
          ],
          "line": 1910
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "qemuAgentDiskInfo",
            "1"
          ],
          "line": 1901
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"array element '%zd' of '%zd' missing in \"\n                             \"guest-get-fsinfo 'disk' data\")",
            "i",
            "fsinfo->ndisks"
          ],
          "line": 1894
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "jsondisks",
            "i"
          ],
          "line": 1888
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_new0",
          "args": [
            "qemuAgentDiskInfoPtr",
            "ndisks"
          ],
          "line": 1884
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "jsondisks"
          ],
          "line": 1881
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed guest-get-fsinfo 'disk' data array\")"
          ],
          "line": 1876
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueIsArray",
          "args": [
            "jsondisks"
          ],
          "line": 1875
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueIsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1010-1014",
          "snippet": "bool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nbool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentGetFSInfoFillDisks(virJSONValuePtr jsondisks,\n                            qemuAgentFSInfoPtr fsinfo)\n{\n    size_t ndisks;\n    size_t i;\n\n    if (!virJSONValueIsArray(jsondisks)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-fsinfo 'disk' data array\"));\n        return -1;\n    }\n\n    ndisks = virJSONValueArraySize(jsondisks);\n\n    if (ndisks)\n        fsinfo->disks = g_new0(qemuAgentDiskInfoPtr, ndisks);\n    fsinfo->ndisks = ndisks;\n\n    for (i = 0; i < fsinfo->ndisks; i++) {\n        virJSONValuePtr jsondisk = virJSONValueArrayGet(jsondisks, i);\n        virJSONValuePtr pci;\n        qemuAgentDiskInfoPtr disk;\n        const char *val;\n\n        if (!jsondisk) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"array element '%zd' of '%zd' missing in \"\n                             \"guest-get-fsinfo 'disk' data\"),\n                           i, fsinfo->ndisks);\n            return -1;\n        }\n\n        fsinfo->disks[i] = g_new0(qemuAgentDiskInfo, 1);\n        disk = fsinfo->disks[i];\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"bus-type\")))\n            disk->bus_type = g_strdup(val);\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"serial\")))\n            disk->serial = g_strdup(val);\n\n        if ((val = virJSONValueObjectGetString(jsondisk, \"dev\")))\n            disk->devnode = g_strdup(val);\n\n#define GET_DISK_ADDR(jsonObject, var, name) \\\n        do { \\\n            if (virJSONValueObjectGetNumberUint(jsonObject, name, var) < 0) { \\\n                virReportError(VIR_ERR_INTERNAL_ERROR, \\\n                               _(\"'%s' missing in guest-get-fsinfo \" \\\n                                 \"'disk' data\"), name); \\\n                return -1; \\\n            } \\\n        } while (0)\n\n        GET_DISK_ADDR(jsondisk, &disk->bus, \"bus\");\n        GET_DISK_ADDR(jsondisk, &disk->target, \"target\");\n        GET_DISK_ADDR(jsondisk, &disk->unit, \"unit\");\n\n        if (!(pci = virJSONValueObjectGet(jsondisk, \"pci-controller\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'pci-controller' missing in guest-get-fsinfo \"\n                             \"'disk' data\"));\n            return -1;\n        }\n\n        GET_DISK_ADDR(pci, &disk->pci_controller.domain, \"domain\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.bus, \"bus\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.slot, \"slot\");\n        GET_DISK_ADDR(pci, &disk->pci_controller.function, \"function\");\n#undef GET_DISK_ADDR\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuAgentFSInfoFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1849-1866",
    "snippet": "void\nqemuAgentFSInfoFree(qemuAgentFSInfoPtr info)\n{\n    size_t i;\n\n    if (!info)\n        return;\n\n    g_free(info->mountpoint);\n    g_free(info->name);\n    g_free(info->fstype);\n\n    for (i = 0; i < info->ndisks; i++)\n        qemuAgentDiskInfoFree(info->disks[i]);\n    g_free(info->disks);\n\n    g_free(info);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info"
          ],
          "line": 1865
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info->disks"
          ],
          "line": 1863
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentDiskInfoFree",
          "args": [
            "info->disks[i]"
          ],
          "line": 1862
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentDiskInfoFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1837-1847",
          "snippet": "static void\nqemuAgentDiskInfoFree(qemuAgentDiskInfoPtr info)\n{\n    if (!info)\n        return;\n\n    g_free(info->serial);\n    g_free(info->bus_type);\n    g_free(info->devnode);\n    g_free(info);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentDiskInfoFree(qemuAgentDiskInfoPtr info)\n{\n    if (!info)\n        return;\n\n    g_free(info->serial);\n    g_free(info->bus_type);\n    g_free(info->devnode);\n    g_free(info);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info->fstype"
          ],
          "line": 1859
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info->name"
          ],
          "line": 1858
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info->mountpoint"
          ],
          "line": 1857
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nvoid\nqemuAgentFSInfoFree(qemuAgentFSInfoPtr info)\n{\n    size_t i;\n\n    if (!info)\n        return;\n\n    g_free(info->mountpoint);\n    g_free(info->name);\n    g_free(info->fstype);\n\n    for (i = 0; i < info->ndisks; i++)\n        qemuAgentDiskInfoFree(info->disks[i]);\n    g_free(info->disks);\n\n    g_free(info);\n}"
  },
  {
    "function_name": "qemuAgentDiskInfoFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1837-1847",
    "snippet": "static void\nqemuAgentDiskInfoFree(qemuAgentDiskInfoPtr info)\n{\n    if (!info)\n        return;\n\n    g_free(info->serial);\n    g_free(info->bus_type);\n    g_free(info->devnode);\n    g_free(info);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info"
          ],
          "line": 1846
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info->devnode"
          ],
          "line": 1845
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info->bus_type"
          ],
          "line": 1844
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_free",
          "args": [
            "info->serial"
          ],
          "line": 1843
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentDiskInfoFree(qemuAgentDiskInfoPtr info)\n{\n    if (!info)\n        return;\n\n    g_free(info->serial);\n    g_free(info->bus_type);\n    g_free(info->devnode);\n    g_free(info);\n}"
  },
  {
    "function_name": "qemuAgentSetTime",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1789-1835",
    "snippet": "int\nqemuAgentSetTime(qemuAgentPtr agent,\n                long long seconds,\n                unsigned int nseconds,\n                bool rtcSync)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    if (rtcSync) {\n        cmd = qemuAgentMakeCommand(\"guest-set-time\", NULL);\n    } else {\n        /* guest agent expect time with nanosecond granularity.\n         * Impressing. */\n        long long json_time;\n\n        /* Check if we overflow. For some reason qemu doesn't handle unsigned\n         * long long on the agent well as it silently truncates numbers to\n         * signed long long. Therefore we must check overflow against LLONG_MAX\n         * not ULLONG_MAX. */\n        if (seconds > LLONG_MAX / 1000000000LL) {\n            virReportError(VIR_ERR_INVALID_ARG,\n                           _(\"Time '%lld' is too big for guest agent\"),\n                           seconds);\n            return ret;\n        }\n\n        json_time = seconds * 1000000000LL;\n        json_time += nseconds;\n        cmd = qemuAgentMakeCommand(\"guest-set-time\",\n                                   \"I:time\", json_time,\n                                   NULL);\n    }\n\n    if (!cmd)\n        return ret;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1833
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1827
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-set-time\"",
            "\"I:time\"",
            "json_time",
            "NULL"
          ],
          "line": 1819
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "_(\"Time '%lld' is too big for guest agent\")",
            "seconds"
          ],
          "line": 1811
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Time '%lld' is too big for guest agent\""
          ],
          "line": 1812
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentSetTime(qemuAgentPtr agent,\n                long long seconds,\n                unsigned int nseconds,\n                bool rtcSync)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    if (rtcSync) {\n        cmd = qemuAgentMakeCommand(\"guest-set-time\", NULL);\n    } else {\n        /* guest agent expect time with nanosecond granularity.\n         * Impressing. */\n        long long json_time;\n\n        /* Check if we overflow. For some reason qemu doesn't handle unsigned\n         * long long on the agent well as it silently truncates numbers to\n         * signed long long. Therefore we must check overflow against LLONG_MAX\n         * not ULLONG_MAX. */\n        if (seconds > LLONG_MAX / 1000000000LL) {\n            virReportError(VIR_ERR_INVALID_ARG,\n                           _(\"Time '%lld' is too big for guest agent\"),\n                           seconds);\n            return ret;\n        }\n\n        json_time = seconds * 1000000000LL;\n        json_time += nseconds;\n        cmd = qemuAgentMakeCommand(\"guest-set-time\",\n                                   \"I:time\", json_time,\n                                   NULL);\n    }\n\n    if (!cmd)\n        return ret;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    ret = 0;\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentGetTime",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1747-1781",
    "snippet": "int\nqemuAgentGetTime(qemuAgentPtr agent,\n                 long long *seconds,\n                 unsigned int *nseconds)\n{\n    int ret = -1;\n    unsigned long long json_time;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-get-time\",\n                               NULL);\n    if (!cmd)\n        return ret;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (virJSONValueObjectGetNumberUlong(reply, \"return\", &json_time) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"malformed return value\"));\n        goto cleanup;\n    }\n\n    /* guest agent returns time in nanoseconds,\n     * we need it in seconds here */\n    *seconds = json_time / 1000000000LL;\n    *nseconds = json_time % 1000000000LL;\n    ret = 0;\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1779
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"malformed return value\")"
          ],
          "line": 1766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"malformed return value\""
          ],
          "line": 1767
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberUlong",
          "args": [
            "reply",
            "\"return\"",
            "&json_time"
          ],
          "line": 1765
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberUlong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1373-1384",
          "snippet": "int\nvirJSONValueObjectGetNumberUlong(virJSONValuePtr object,\n                                 const char *key,\n                                 unsigned long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUlong(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberUlong(virJSONValuePtr object,\n                                 const char *key,\n                                 unsigned long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUlong(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1762
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-get-time\"",
            "NULL"
          ],
          "line": 1757
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentGetTime(qemuAgentPtr agent,\n                 long long *seconds,\n                 unsigned int *nseconds)\n{\n    int ret = -1;\n    unsigned long long json_time;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-get-time\",\n                               NULL);\n    if (!cmd)\n        return ret;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (virJSONValueObjectGetNumberUlong(reply, \"return\", &json_time) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"malformed return value\"));\n        goto cleanup;\n    }\n\n    /* guest agent returns time in nanoseconds,\n     * we need it in seconds here */\n    *seconds = json_time / 1000000000LL;\n    *nseconds = json_time % 1000000000LL;\n    ret = 0;\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentGetHostname",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1702-1744",
    "snippet": "int\nqemuAgentGetHostname(qemuAgentPtr agent,\n                     char **hostname)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr data = NULL;\n    const char *result = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-get-host-name\",\n                               NULL);\n\n    if (!cmd)\n        return ret;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            ret = -2;\n        goto cleanup;\n    }\n\n    if (!(data = virJSONValueObjectGet(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"malformed return value\"));\n        goto cleanup;\n    }\n\n    if (!(result = virJSONValueObjectGetString(data, \"host-name\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"'host-name' missing in guest-get-host-name reply\"));\n        goto cleanup;\n    }\n\n    *hostname = g_strdup(result);\n\n    ret = 0;\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1742
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "result"
          ],
          "line": 1736
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'host-name' missing in guest-get-host-name reply\")"
          ],
          "line": 1731
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"'host-name' missing in guest-get-host-name reply\""
          ],
          "line": 1732
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "data",
            "\"host-name\""
          ],
          "line": 1730
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"malformed return value\")"
          ],
          "line": 1725
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "reply",
            "\"return\""
          ],
          "line": 1724
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentErrorCommandUnsupported",
          "args": [
            "reply"
          ],
          "line": 1719
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentErrorCommandUnsupported",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1002-1019",
          "snippet": "static bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1718
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-get-host-name\"",
            "NULL"
          ],
          "line": 1712
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentGetHostname(qemuAgentPtr agent,\n                     char **hostname)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr data = NULL;\n    const char *result = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-get-host-name\",\n                               NULL);\n\n    if (!cmd)\n        return ret;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0) {\n        if (qemuAgentErrorCommandUnsupported(reply))\n            ret = -2;\n        goto cleanup;\n    }\n\n    if (!(data = virJSONValueObjectGet(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"malformed return value\"));\n        goto cleanup;\n    }\n\n    if (!(result = virJSONValueObjectGetString(data, \"host-name\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"'host-name' missing in guest-get-host-name reply\"));\n        goto cleanup;\n    }\n\n    *hostname = g_strdup(result);\n\n    ret = 0;\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentUpdateCPUInfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1625-1699",
    "snippet": "int\nqemuAgentUpdateCPUInfo(unsigned int nvcpus,\n                       qemuAgentCPUInfoPtr cpuinfo,\n                       int ncpuinfo)\n{\n    size_t i;\n    int nonline = 0;\n    int nofflinable = 0;\n    ssize_t cpu0 = -1;\n\n    /* count the active and offlinable cpus */\n    for (i = 0; i < ncpuinfo; i++) {\n        if (cpuinfo[i].id == 0)\n            cpu0 = i;\n\n        if (cpuinfo[i].online)\n            nonline++;\n\n        if (cpuinfo[i].offlinable && cpuinfo[i].online)\n            nofflinable++;\n\n        /* This shouldn't happen, but we can't trust the guest agent */\n        if (!cpuinfo[i].online && !cpuinfo[i].offlinable) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Invalid data provided by guest agent\"));\n            return -1;\n        }\n    }\n\n    /* CPU0 was made offlinable in linux a while ago, but certain parts (suspend\n     * to ram) of the kernel still don't cope well with that. Make sure that if\n     * all remaining vCPUs are offlinable, vCPU0 will not be selected to be\n     * offlined automatically */\n    if (nofflinable == nonline && cpu0 >= 0 && cpuinfo[cpu0].online) {\n        cpuinfo[cpu0].offlinable = false;\n        nofflinable--;\n    }\n\n    /* the guest agent reported less cpus than requested */\n    if (nvcpus > ncpuinfo) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest agent reports less cpu than requested\"));\n        return -1;\n    }\n\n    /* not enough offlinable CPUs to support the request */\n    if (nvcpus < nonline - nofflinable) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Cannot offline enough CPUs\"));\n        return -1;\n    }\n\n    for (i = 0; i < ncpuinfo; i++) {\n        if (nvcpus < nonline) {\n            /* unplug */\n            if (cpuinfo[i].offlinable && cpuinfo[i].online) {\n                cpuinfo[i].online = false;\n                cpuinfo[i].modified = true;\n                nonline--;\n            }\n        } else if (nvcpus > nonline) {\n            /* plug */\n            if (!cpuinfo[i].online) {\n                cpuinfo[i].online = true;\n                cpuinfo[i].modified = true;\n                nonline++;\n            }\n        } else {\n            /* done */\n            break;\n        }\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "\"%s\"",
            "_(\"Cannot offline enough CPUs\")"
          ],
          "line": 1672
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot offline enough CPUs\""
          ],
          "line": 1673
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"guest agent reports less cpu than requested\")"
          ],
          "line": 1665
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Invalid data provided by guest agent\")"
          ],
          "line": 1648
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentUpdateCPUInfo(unsigned int nvcpus,\n                       qemuAgentCPUInfoPtr cpuinfo,\n                       int ncpuinfo)\n{\n    size_t i;\n    int nonline = 0;\n    int nofflinable = 0;\n    ssize_t cpu0 = -1;\n\n    /* count the active and offlinable cpus */\n    for (i = 0; i < ncpuinfo; i++) {\n        if (cpuinfo[i].id == 0)\n            cpu0 = i;\n\n        if (cpuinfo[i].online)\n            nonline++;\n\n        if (cpuinfo[i].offlinable && cpuinfo[i].online)\n            nofflinable++;\n\n        /* This shouldn't happen, but we can't trust the guest agent */\n        if (!cpuinfo[i].online && !cpuinfo[i].offlinable) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Invalid data provided by guest agent\"));\n            return -1;\n        }\n    }\n\n    /* CPU0 was made offlinable in linux a while ago, but certain parts (suspend\n     * to ram) of the kernel still don't cope well with that. Make sure that if\n     * all remaining vCPUs are offlinable, vCPU0 will not be selected to be\n     * offlined automatically */\n    if (nofflinable == nonline && cpu0 >= 0 && cpuinfo[cpu0].online) {\n        cpuinfo[cpu0].offlinable = false;\n        nofflinable--;\n    }\n\n    /* the guest agent reported less cpus than requested */\n    if (nvcpus > ncpuinfo) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest agent reports less cpu than requested\"));\n        return -1;\n    }\n\n    /* not enough offlinable CPUs to support the request */\n    if (nvcpus < nonline - nofflinable) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"Cannot offline enough CPUs\"));\n        return -1;\n    }\n\n    for (i = 0; i < ncpuinfo; i++) {\n        if (nvcpus < nonline) {\n            /* unplug */\n            if (cpuinfo[i].offlinable && cpuinfo[i].online) {\n                cpuinfo[i].online = false;\n                cpuinfo[i].modified = true;\n                nonline--;\n            }\n        } else if (nvcpus > nonline) {\n            /* plug */\n            if (!cpuinfo[i].online) {\n                cpuinfo[i].online = true;\n                cpuinfo[i].modified = true;\n                nonline++;\n            }\n        } else {\n            /* done */\n            break;\n        }\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuAgentSetVCPUs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1593-1621",
    "snippet": "int\nqemuAgentSetVCPUs(qemuAgentPtr agent,\n                  qemuAgentCPUInfoPtr info,\n                  size_t ninfo)\n{\n    int rv;\n    int nmodified;\n    size_t i;\n\n    do {\n        if ((rv = qemuAgentSetVCPUsCommand(agent, info, ninfo, &nmodified)) < 0)\n            return -1;\n\n        /* all vcpus were set successfully */\n        if (rv == nmodified)\n            return 0;\n\n        /* un-mark vcpus that were already set */\n        for (i = 0; i < ninfo && rv > 0; i++) {\n            if (!info[i].modified)\n                continue;\n\n            info[i].modified = false;\n            rv--;\n        }\n    } while (1);\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuAgentSetVCPUsCommand",
          "args": [
            "agent",
            "info",
            "ninfo",
            "&nmodified"
          ],
          "line": 1603
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentSetVCPUsCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1511-1582",
          "snippet": "static int\nqemuAgentSetVCPUsCommand(qemuAgentPtr agent,\n                         qemuAgentCPUInfoPtr info,\n                         size_t ninfo,\n                         int *nmodified)\n{\n    int ret = -1;\n    virJSONValuePtr cmd = NULL;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr cpus = NULL;\n    virJSONValuePtr cpu = NULL;\n    size_t i;\n\n    *nmodified = 0;\n\n    /* create the key data array */\n    cpus = virJSONValueNewArray();\n\n    for (i = 0; i < ninfo; i++) {\n        qemuAgentCPUInfoPtr in = &info[i];\n\n        /* don't set state for cpus that were not touched */\n        if (!in->modified)\n            continue;\n\n        (*nmodified)++;\n\n        /* create single cpu object */\n        cpu = virJSONValueNewObject();\n\n        if (virJSONValueObjectAppendNumberInt(cpu, \"logical-id\", in->id) < 0)\n            goto cleanup;\n\n        if (virJSONValueObjectAppendBoolean(cpu, \"online\", in->online) < 0)\n            goto cleanup;\n\n        if (virJSONValueArrayAppend(cpus, cpu) < 0)\n            goto cleanup;\n\n        cpu = NULL;\n    }\n\n    if (*nmodified == 0) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-set-vcpus\",\n                                     \"a:vcpus\", &cpus,\n                                     NULL)))\n        goto cleanup;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    /* All negative values are invalid. Return of 0 is bogus since we wouldn't\n     * call the guest agent so that 0 cpus would be set successfully. Reporting\n     * more successfully set vcpus that we've asked for is invalid. */\n    if (virJSONValueObjectGetNumberInt(reply, \"return\", &ret) < 0 ||\n        ret <= 0 || ret > *nmodified) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest agent returned malformed or invalid return value\"));\n        ret = -1;\n    }\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    virJSONValueFree(cpu);\n    virJSONValueFree(cpus);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentSetVCPUsCommand(qemuAgentPtr agent,\n                         qemuAgentCPUInfoPtr info,\n                         size_t ninfo,\n                         int *nmodified)\n{\n    int ret = -1;\n    virJSONValuePtr cmd = NULL;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr cpus = NULL;\n    virJSONValuePtr cpu = NULL;\n    size_t i;\n\n    *nmodified = 0;\n\n    /* create the key data array */\n    cpus = virJSONValueNewArray();\n\n    for (i = 0; i < ninfo; i++) {\n        qemuAgentCPUInfoPtr in = &info[i];\n\n        /* don't set state for cpus that were not touched */\n        if (!in->modified)\n            continue;\n\n        (*nmodified)++;\n\n        /* create single cpu object */\n        cpu = virJSONValueNewObject();\n\n        if (virJSONValueObjectAppendNumberInt(cpu, \"logical-id\", in->id) < 0)\n            goto cleanup;\n\n        if (virJSONValueObjectAppendBoolean(cpu, \"online\", in->online) < 0)\n            goto cleanup;\n\n        if (virJSONValueArrayAppend(cpus, cpu) < 0)\n            goto cleanup;\n\n        cpu = NULL;\n    }\n\n    if (*nmodified == 0) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-set-vcpus\",\n                                     \"a:vcpus\", &cpus,\n                                     NULL)))\n        goto cleanup;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    /* All negative values are invalid. Return of 0 is bogus since we wouldn't\n     * call the guest agent so that 0 cpus would be set successfully. Reporting\n     * more successfully set vcpus that we've asked for is invalid. */\n    if (virJSONValueObjectGetNumberInt(reply, \"return\", &ret) < 0 ||\n        ret <= 0 || ret > *nmodified) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest agent returned malformed or invalid return value\"));\n        ret = -1;\n    }\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    virJSONValueFree(cpu);\n    virJSONValueFree(cpus);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentSetVCPUs(qemuAgentPtr agent,\n                  qemuAgentCPUInfoPtr info,\n                  size_t ninfo)\n{\n    int rv;\n    int nmodified;\n    size_t i;\n\n    do {\n        if ((rv = qemuAgentSetVCPUsCommand(agent, info, ninfo, &nmodified)) < 0)\n            return -1;\n\n        /* all vcpus were set successfully */\n        if (rv == nmodified)\n            return 0;\n\n        /* un-mark vcpus that were already set */\n        for (i = 0; i < ninfo && rv > 0; i++) {\n            if (!info[i].modified)\n                continue;\n\n            info[i].modified = false;\n            rv--;\n        }\n    } while (1);\n\n    return 0;\n}"
  },
  {
    "function_name": "qemuAgentSetVCPUsCommand",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1511-1582",
    "snippet": "static int\nqemuAgentSetVCPUsCommand(qemuAgentPtr agent,\n                         qemuAgentCPUInfoPtr info,\n                         size_t ninfo,\n                         int *nmodified)\n{\n    int ret = -1;\n    virJSONValuePtr cmd = NULL;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr cpus = NULL;\n    virJSONValuePtr cpu = NULL;\n    size_t i;\n\n    *nmodified = 0;\n\n    /* create the key data array */\n    cpus = virJSONValueNewArray();\n\n    for (i = 0; i < ninfo; i++) {\n        qemuAgentCPUInfoPtr in = &info[i];\n\n        /* don't set state for cpus that were not touched */\n        if (!in->modified)\n            continue;\n\n        (*nmodified)++;\n\n        /* create single cpu object */\n        cpu = virJSONValueNewObject();\n\n        if (virJSONValueObjectAppendNumberInt(cpu, \"logical-id\", in->id) < 0)\n            goto cleanup;\n\n        if (virJSONValueObjectAppendBoolean(cpu, \"online\", in->online) < 0)\n            goto cleanup;\n\n        if (virJSONValueArrayAppend(cpus, cpu) < 0)\n            goto cleanup;\n\n        cpu = NULL;\n    }\n\n    if (*nmodified == 0) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-set-vcpus\",\n                                     \"a:vcpus\", &cpus,\n                                     NULL)))\n        goto cleanup;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    /* All negative values are invalid. Return of 0 is bogus since we wouldn't\n     * call the guest agent so that 0 cpus would be set successfully. Reporting\n     * more successfully set vcpus that we've asked for is invalid. */\n    if (virJSONValueObjectGetNumberInt(reply, \"return\", &ret) < 0 ||\n        ret <= 0 || ret > *nmodified) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest agent returned malformed or invalid return value\"));\n        ret = -1;\n    }\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    virJSONValueFree(cpu);\n    virJSONValueFree(cpus);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "cpus"
          ],
          "line": 1580
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"guest agent returned malformed or invalid return value\")"
          ],
          "line": 1571
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"guest agent returned malformed or invalid return value\""
          ],
          "line": 1572
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberInt",
          "args": [
            "reply",
            "\"return\"",
            "&ret"
          ],
          "line": 1569
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1331-1342",
          "snippet": "int\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1563
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-set-vcpus\"",
            "\"a:vcpus\"",
            "&cpus",
            "NULL"
          ],
          "line": 1558
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayAppend",
          "args": [
            "cpus",
            "cpu"
          ],
          "line": 1547
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "792-804",
          "snippet": "int\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendBoolean",
          "args": [
            "cpu",
            "\"online\"",
            "in->online"
          ],
          "line": 1544
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendBoolean",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "741-754",
          "snippet": "int\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendNumberInt",
          "args": [
            "cpu",
            "\"logical-id\"",
            "in->id"
          ],
          "line": 1541
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "661-674",
          "snippet": "int\nvirJSONValueObjectAppendNumberInt(virJSONValuePtr object,\n                                  const char *key,\n                                  int number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberInt(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendNumberInt(virJSONValuePtr object,\n                                  const char *key,\n                                  int number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberInt(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewObject",
          "args": [],
          "line": 1539
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "571-579",
          "snippet": "virJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewArray",
          "args": [],
          "line": 1527
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "560-568",
          "snippet": "virJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentSetVCPUsCommand(qemuAgentPtr agent,\n                         qemuAgentCPUInfoPtr info,\n                         size_t ninfo,\n                         int *nmodified)\n{\n    int ret = -1;\n    virJSONValuePtr cmd = NULL;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr cpus = NULL;\n    virJSONValuePtr cpu = NULL;\n    size_t i;\n\n    *nmodified = 0;\n\n    /* create the key data array */\n    cpus = virJSONValueNewArray();\n\n    for (i = 0; i < ninfo; i++) {\n        qemuAgentCPUInfoPtr in = &info[i];\n\n        /* don't set state for cpus that were not touched */\n        if (!in->modified)\n            continue;\n\n        (*nmodified)++;\n\n        /* create single cpu object */\n        cpu = virJSONValueNewObject();\n\n        if (virJSONValueObjectAppendNumberInt(cpu, \"logical-id\", in->id) < 0)\n            goto cleanup;\n\n        if (virJSONValueObjectAppendBoolean(cpu, \"online\", in->online) < 0)\n            goto cleanup;\n\n        if (virJSONValueArrayAppend(cpus, cpu) < 0)\n            goto cleanup;\n\n        cpu = NULL;\n    }\n\n    if (*nmodified == 0) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-set-vcpus\",\n                                     \"a:vcpus\", &cpus,\n                                     NULL)))\n        goto cleanup;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    /* All negative values are invalid. Return of 0 is bogus since we wouldn't\n     * call the guest agent so that 0 cpus would be set successfully. Reporting\n     * more successfully set vcpus that we've asked for is invalid. */\n    if (virJSONValueObjectGetNumberInt(reply, \"return\", &ret) < 0 ||\n        ret <= 0 || ret > *nmodified) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest agent returned malformed or invalid return value\"));\n        ret = -1;\n    }\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    virJSONValueFree(cpu);\n    virJSONValueFree(cpus);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentGetVCPUs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1436-1507",
    "snippet": "int\nqemuAgentGetVCPUs(qemuAgentPtr agent,\n                  qemuAgentCPUInfoPtr *info)\n{\n    int ret = -1;\n    size_t i;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr data = NULL;\n    size_t ndata;\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-get-vcpus\", NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (!(data = virJSONValueObjectGetArray(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-vcpus reply was missing return data\"));\n        goto cleanup;\n    }\n\n    if (!virJSONValueIsArray(data)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-vcpus data array\"));\n        goto cleanup;\n    }\n\n    ndata = virJSONValueArraySize(data);\n\n    if (VIR_ALLOC_N(*info, ndata) < 0)\n        goto cleanup;\n\n    for (i = 0; i < ndata; i++) {\n        virJSONValuePtr entry = virJSONValueArrayGet(data, i);\n        qemuAgentCPUInfoPtr in = *info + i;\n\n        if (!entry) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"array element missing in guest-get-vcpus return \"\n                             \"value\"));\n            goto cleanup;\n        }\n\n        if (virJSONValueObjectGetNumberUint(entry, \"logical-id\", &in->id) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'logical-id' missing in reply of guest-get-vcpus\"));\n            goto cleanup;\n        }\n\n        if (virJSONValueObjectGetBoolean(entry, \"online\", &in->online) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'online' missing in reply of guest-get-vcpus\"));\n            goto cleanup;\n        }\n\n        if (virJSONValueObjectGetBoolean(entry, \"can-offline\",\n                                         &in->offlinable) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'can-offline' missing in reply of guest-get-vcpus\"));\n            goto cleanup;\n        }\n    }\n\n    ret = ndata;\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1505
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'can-offline' missing in reply of guest-get-vcpus\")"
          ],
          "line": 1495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"'can-offline' missing in reply of guest-get-vcpus\""
          ],
          "line": 1496
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetBoolean",
          "args": [
            "entry",
            "\"can-offline\"",
            "&in->offlinable"
          ],
          "line": 1493
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetBoolean",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1401-1412",
          "snippet": "int\nvirJSONValueObjectGetBoolean(virJSONValuePtr object,\n                             const char *key,\n                             bool *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetBoolean(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetBoolean(virJSONValuePtr object,\n                             const char *key,\n                             bool *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetBoolean(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'online' missing in reply of guest-get-vcpus\")"
          ],
          "line": 1488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"'logical-id' missing in reply of guest-get-vcpus\")"
          ],
          "line": 1482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberUint",
          "args": [
            "entry",
            "\"logical-id\"",
            "&in->id"
          ],
          "line": 1481
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberUint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1345-1356",
          "snippet": "int\nvirJSONValueObjectGetNumberUint(virJSONValuePtr object,\n                                const char *key,\n                                unsigned int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUint(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberUint(virJSONValuePtr object,\n                                const char *key,\n                                unsigned int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUint(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"array element missing in guest-get-vcpus return \"\n                             \"value\")"
          ],
          "line": 1475
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "data",
            "i"
          ],
          "line": 1471
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "*info",
            "ndata"
          ],
          "line": 1467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "data"
          ],
          "line": 1465
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed guest-get-vcpus data array\")"
          ],
          "line": 1460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueIsArray",
          "args": [
            "data"
          ],
          "line": 1459
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueIsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1010-1014",
          "snippet": "bool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nbool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"guest-get-vcpus reply was missing return data\")"
          ],
          "line": 1454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetArray",
          "args": [
            "reply",
            "\"return\""
          ],
          "line": 1453
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1450
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-get-vcpus\"",
            "NULL"
          ],
          "line": 1447
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentGetVCPUs(qemuAgentPtr agent,\n                  qemuAgentCPUInfoPtr *info)\n{\n    int ret = -1;\n    size_t i;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n    virJSONValuePtr data = NULL;\n    size_t ndata;\n\n    if (!(cmd = qemuAgentMakeCommand(\"guest-get-vcpus\", NULL)))\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (!(data = virJSONValueObjectGetArray(reply, \"return\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"guest-get-vcpus reply was missing return data\"));\n        goto cleanup;\n    }\n\n    if (!virJSONValueIsArray(data)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed guest-get-vcpus data array\"));\n        goto cleanup;\n    }\n\n    ndata = virJSONValueArraySize(data);\n\n    if (VIR_ALLOC_N(*info, ndata) < 0)\n        goto cleanup;\n\n    for (i = 0; i < ndata; i++) {\n        virJSONValuePtr entry = virJSONValueArrayGet(data, i);\n        qemuAgentCPUInfoPtr in = *info + i;\n\n        if (!entry) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"array element missing in guest-get-vcpus return \"\n                             \"value\"));\n            goto cleanup;\n        }\n\n        if (virJSONValueObjectGetNumberUint(entry, \"logical-id\", &in->id) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'logical-id' missing in reply of guest-get-vcpus\"));\n            goto cleanup;\n        }\n\n        if (virJSONValueObjectGetBoolean(entry, \"online\", &in->online) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'online' missing in reply of guest-get-vcpus\"));\n            goto cleanup;\n        }\n\n        if (virJSONValueObjectGetBoolean(entry, \"can-offline\",\n                                         &in->offlinable) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'can-offline' missing in reply of guest-get-vcpus\"));\n            goto cleanup;\n        }\n    }\n\n    ret = ndata;\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentFSTrim",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1415-1434",
    "snippet": "int\nqemuAgentFSTrim(qemuAgentPtr agent,\n                unsigned long long minimum)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-fstrim\",\n                               \"U:minimum\", minimum,\n                               NULL);\n    if (!cmd)\n        return ret;\n\n    ret = qemuAgentCommand(agent, cmd, &reply, agent->timeout);\n\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1432
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1429
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-fstrim\"",
            "\"U:minimum\"",
            "minimum",
            "NULL"
          ],
          "line": 1423
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentFSTrim(qemuAgentPtr agent,\n                unsigned long long minimum)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-fstrim\",\n                               \"U:minimum\", minimum,\n                               NULL);\n    if (!cmd)\n        return ret;\n\n    ret = qemuAgentCommand(agent, cmd, &reply, agent->timeout);\n\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentArbitraryCommand",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1380-1413",
    "snippet": "int\nqemuAgentArbitraryCommand(qemuAgentPtr agent,\n                          const char *cmd_str,\n                          char **result,\n                          int timeout)\n{\n    int ret = -1;\n    virJSONValuePtr cmd = NULL;\n    virJSONValuePtr reply = NULL;\n\n    *result = NULL;\n    if (timeout < VIR_DOMAIN_QEMU_AGENT_COMMAND_MIN) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"guest agent timeout '%d' is \"\n                         \"less than the minimum '%d'\"),\n                       timeout, VIR_DOMAIN_QEMU_AGENT_COMMAND_MIN);\n        goto cleanup;\n    }\n\n    if (!(cmd = virJSONValueFromString(cmd_str)))\n        goto cleanup;\n\n    if ((ret = qemuAgentCommand(agent, cmd, &reply, timeout)) < 0)\n        goto cleanup;\n\n    if (!(*result = virJSONValueToString(reply, false)))\n        ret = -1;\n\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1411
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueToString",
          "args": [
            "reply",
            "false"
          ],
          "line": 1405
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueToString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "2014-2024",
          "snippet": "char *\nvirJSONValueToString(virJSONValuePtr object,\n                     bool pretty)\n{\n    g_auto(virBuffer) buf = VIR_BUFFER_INITIALIZER;\n\n    if (virJSONValueToBuffer(object, &buf, pretty) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nchar *\nvirJSONValueToString(virJSONValuePtr object,\n                     bool pretty)\n{\n    g_auto(virBuffer) buf = VIR_BUFFER_INITIALIZER;\n\n    if (virJSONValueToBuffer(object, &buf, pretty) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "timeout"
          ],
          "line": 1402
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueFromString",
          "args": [
            "cmd_str"
          ],
          "line": 1399
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFromString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1993-1999",
          "snippet": "virJSONValuePtr\nvirJSONValueFromString(const char *jsonstring G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No JSON parser implementation is available\"));\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueFromString(const char *jsonstring G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No JSON parser implementation is available\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "_(\"guest agent timeout '%d' is \"\n                         \"less than the minimum '%d'\")",
            "timeout",
            "VIR_DOMAIN_QEMU_AGENT_COMMAND_MIN"
          ],
          "line": 1392
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"guest agent timeout '%d' is \"\n                         \"less than the minimum '%d'\""
          ],
          "line": 1393
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentArbitraryCommand(qemuAgentPtr agent,\n                          const char *cmd_str,\n                          char **result,\n                          int timeout)\n{\n    int ret = -1;\n    virJSONValuePtr cmd = NULL;\n    virJSONValuePtr reply = NULL;\n\n    *result = NULL;\n    if (timeout < VIR_DOMAIN_QEMU_AGENT_COMMAND_MIN) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"guest agent timeout '%d' is \"\n                         \"less than the minimum '%d'\"),\n                       timeout, VIR_DOMAIN_QEMU_AGENT_COMMAND_MIN);\n        goto cleanup;\n    }\n\n    if (!(cmd = virJSONValueFromString(cmd_str)))\n        goto cleanup;\n\n    if ((ret = qemuAgentCommand(agent, cmd, &reply, timeout)) < 0)\n        goto cleanup;\n\n    if (!(*result = virJSONValueToString(reply, false)))\n        ret = -1;\n\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentSuspend",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1359-1378",
    "snippet": "int\nqemuAgentSuspend(qemuAgentPtr agent,\n                 unsigned int target)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(qemuAgentSuspendModeTypeToString(target),\n                               NULL);\n    if (!cmd)\n        return -1;\n\n    agent->await_event = QEMU_AGENT_EVENT_SUSPEND;\n    ret = qemuAgentCommand(agent, cmd, &reply, agent->timeout);\n\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1376
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1373
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "qemuAgentSuspendModeTypeToString(target)",
            "NULL"
          ],
          "line": 1367
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentSuspendModeTypeToString",
          "args": [
            "target"
          ],
          "line": 1367
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint\nqemuAgentSuspend(qemuAgentPtr agent,\n                 unsigned int target)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(qemuAgentSuspendModeTypeToString(target),\n                               NULL);\n    if (!cmd)\n        return -1;\n\n    agent->await_event = QEMU_AGENT_EVENT_SUSPEND;\n    ret = qemuAgentCommand(agent, cmd, &reply, agent->timeout);\n\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentFSThaw",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1325-1348",
    "snippet": "int qemuAgentFSThaw(qemuAgentPtr agent)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-fsfreeze-thaw\", NULL);\n\n    if (!cmd)\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (virJSONValueObjectGetNumberInt(reply, \"return\", &ret) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"malformed return value\"));\n    }\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1346
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"malformed return value\")"
          ],
          "line": 1340
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"malformed return value\""
          ],
          "line": 1341
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberInt",
          "args": [
            "reply",
            "\"return\"",
            "&ret"
          ],
          "line": 1339
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1331-1342",
          "snippet": "int\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1336
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-fsfreeze-thaw\"",
            "NULL"
          ],
          "line": 1331
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint qemuAgentFSThaw(qemuAgentPtr agent)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-fsfreeze-thaw\", NULL);\n\n    if (!cmd)\n        return -1;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (virJSONValueObjectGetNumberInt(reply, \"return\", &ret) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"malformed return value\"));\n    }\n\n cleanup:\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentFSFreeze",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1278-1312",
    "snippet": "int qemuAgentFSFreeze(qemuAgentPtr agent, const char **mountpoints,\n                      unsigned int nmountpoints)\n{\n    int ret = -1;\n    virJSONValuePtr cmd, arg = NULL;\n    virJSONValuePtr reply = NULL;\n\n    if (mountpoints && nmountpoints) {\n        arg = qemuAgentMakeStringsArray(mountpoints, nmountpoints);\n        if (!arg)\n            return -1;\n\n        cmd = qemuAgentMakeCommand(\"guest-fsfreeze-freeze-list\",\n                                   \"a:mountpoints\", &arg, NULL);\n    } else {\n        cmd = qemuAgentMakeCommand(\"guest-fsfreeze-freeze\", NULL);\n    }\n\n    if (!cmd)\n        goto cleanup;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (virJSONValueObjectGetNumberInt(reply, \"return\", &ret) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"malformed return value\"));\n    }\n\n cleanup:\n    virJSONValueFree(arg);\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1310
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"malformed return value\")"
          ],
          "line": 1303
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"malformed return value\""
          ],
          "line": 1304
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberInt",
          "args": [
            "reply",
            "\"return\"",
            "&ret"
          ],
          "line": 1302
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1331-1342",
          "snippet": "int\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "agent->timeout"
          ],
          "line": 1299
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-fsfreeze-freeze\"",
            "NULL"
          ],
          "line": 1293
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeStringsArray",
          "args": [
            "mountpoints",
            "nmountpoints"
          ],
          "line": 1286
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeStringsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1191-1212",
          "snippet": "static virJSONValuePtr\nqemuAgentMakeStringsArray(const char **strings, unsigned int len)\n{\n    size_t i;\n    virJSONValuePtr ret = virJSONValueNewArray(), str;\n\n    for (i = 0; i < len; i++) {\n        str = virJSONValueNewString(strings[i]);\n        if (!str)\n            goto error;\n\n        if (virJSONValueArrayAppend(ret, str) < 0) {\n            virJSONValueFree(str);\n            goto error;\n        }\n    }\n    return ret;\n\n error:\n    virJSONValueFree(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic virJSONValuePtr\nqemuAgentMakeStringsArray(const char **strings, unsigned int len)\n{\n    size_t i;\n    virJSONValuePtr ret = virJSONValueNewArray(), str;\n\n    for (i = 0; i < len; i++) {\n        str = virJSONValueNewString(strings[i]);\n        if (!str)\n            goto error;\n\n        if (virJSONValueArrayAppend(ret, str) < 0) {\n            virJSONValueFree(str);\n            goto error;\n        }\n    }\n    return ret;\n\n error:\n    virJSONValueFree(ret);\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint qemuAgentFSFreeze(qemuAgentPtr agent, const char **mountpoints,\n                      unsigned int nmountpoints)\n{\n    int ret = -1;\n    virJSONValuePtr cmd, arg = NULL;\n    virJSONValuePtr reply = NULL;\n\n    if (mountpoints && nmountpoints) {\n        arg = qemuAgentMakeStringsArray(mountpoints, nmountpoints);\n        if (!arg)\n            return -1;\n\n        cmd = qemuAgentMakeCommand(\"guest-fsfreeze-freeze-list\",\n                                   \"a:mountpoints\", &arg, NULL);\n    } else {\n        cmd = qemuAgentMakeCommand(\"guest-fsfreeze-freeze\", NULL);\n    }\n\n    if (!cmd)\n        goto cleanup;\n\n    if (qemuAgentCommand(agent, cmd, &reply, agent->timeout) < 0)\n        goto cleanup;\n\n    if (virJSONValueObjectGetNumberInt(reply, \"return\", &ret) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"malformed return value\"));\n    }\n\n cleanup:\n    virJSONValueFree(arg);\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentShutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1239-1262",
    "snippet": "int qemuAgentShutdown(qemuAgentPtr agent,\n                      qemuAgentShutdownMode mode)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-shutdown\",\n                               \"s:mode\", qemuAgentShutdownModeTypeToString(mode),\n                               NULL);\n    if (!cmd)\n        return -1;\n\n    if (mode == QEMU_AGENT_SHUTDOWN_REBOOT)\n        agent->await_event = QEMU_AGENT_EVENT_RESET;\n    else\n        agent->await_event = QEMU_AGENT_EVENT_SHUTDOWN;\n    ret = qemuAgentCommand(agent, cmd, &reply,\n                           VIR_DOMAIN_QEMU_AGENT_COMMAND_SHUTDOWN);\n\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "reply"
          ],
          "line": 1260
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentCommand",
          "args": [
            "agent",
            "cmd",
            "&reply",
            "VIR_DOMAIN_QEMU_AGENT_COMMAND_SHUTDOWN"
          ],
          "line": 1256
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1095-1158",
          "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentMakeCommand",
          "args": [
            "\"guest-shutdown\"",
            "\"s:mode\"",
            "qemuAgentShutdownModeTypeToString(mode)",
            "NULL"
          ],
          "line": 1246
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentMakeCommand",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1160-1189",
          "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentShutdownModeTypeToString",
          "args": [
            "mode"
          ],
          "line": 1247
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nint qemuAgentShutdown(qemuAgentPtr agent,\n                      qemuAgentShutdownMode mode)\n{\n    int ret = -1;\n    virJSONValuePtr cmd;\n    virJSONValuePtr reply = NULL;\n\n    cmd = qemuAgentMakeCommand(\"guest-shutdown\",\n                               \"s:mode\", qemuAgentShutdownModeTypeToString(mode),\n                               NULL);\n    if (!cmd)\n        return -1;\n\n    if (mode == QEMU_AGENT_SHUTDOWN_REBOOT)\n        agent->await_event = QEMU_AGENT_EVENT_RESET;\n    else\n        agent->await_event = QEMU_AGENT_EVENT_SHUTDOWN;\n    ret = qemuAgentCommand(agent, cmd, &reply,\n                           VIR_DOMAIN_QEMU_AGENT_COMMAND_SHUTDOWN);\n\n    virJSONValueFree(cmd);\n    virJSONValueFree(reply);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentNotifyEvent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1214-1230",
    "snippet": "void qemuAgentNotifyEvent(qemuAgentPtr agent,\n                          qemuAgentEvent event)\n{\n    virObjectLock(agent);\n\n    VIR_DEBUG(\"agent=%p event=%d await_event=%d\", agent, event, agent->await_event);\n    if (agent->await_event == event) {\n        agent->await_event = QEMU_AGENT_EVENT_NONE;\n        /* somebody waiting for this event, wake him up. */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n\n    virObjectUnlock(agent);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "agent"
          ],
          "line": 1229
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCondSignal",
          "args": [
            "&agent->notify"
          ],
          "line": 1225
        },
        "resolved": true,
        "details": {
          "function_name": "virCondSignal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "170-173",
          "snippet": "void virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"agent=%p event=%d await_event=%d\"",
            "agent",
            "event",
            "agent->await_event"
          ],
          "line": 1219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "agent"
          ],
          "line": 1217
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nvoid qemuAgentNotifyEvent(qemuAgentPtr agent,\n                          qemuAgentEvent event)\n{\n    virObjectLock(agent);\n\n    VIR_DEBUG(\"agent=%p event=%d await_event=%d\", agent, event, agent->await_event);\n    if (agent->await_event == event) {\n        agent->await_event = QEMU_AGENT_EVENT_NONE;\n        /* somebody waiting for this event, wake him up. */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n\n    virObjectUnlock(agent);\n}"
  },
  {
    "function_name": "qemuAgentMakeStringsArray",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1191-1212",
    "snippet": "static virJSONValuePtr\nqemuAgentMakeStringsArray(const char **strings, unsigned int len)\n{\n    size_t i;\n    virJSONValuePtr ret = virJSONValueNewArray(), str;\n\n    for (i = 0; i < len; i++) {\n        str = virJSONValueNewString(strings[i]);\n        if (!str)\n            goto error;\n\n        if (virJSONValueArrayAppend(ret, str) < 0) {\n            virJSONValueFree(str);\n            goto error;\n        }\n    }\n    return ret;\n\n error:\n    virJSONValueFree(ret);\n    return NULL;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "ret"
          ],
          "line": 1210
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayAppend",
          "args": [
            "ret",
            "str"
          ],
          "line": 1202
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "792-804",
          "snippet": "int\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewString",
          "args": [
            "strings[i]"
          ],
          "line": 1198
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "433-448",
          "snippet": "virJSONValuePtr\nvirJSONValueNewString(const char *data)\n{\n    virJSONValuePtr val;\n\n    if (!data)\n        return virJSONValueNewNull();\n\n    if (VIR_ALLOC(val) < 0)\n        return NULL;\n\n    val->type = VIR_JSON_TYPE_STRING;\n    val->data.string = g_strdup(data);\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewString(const char *data)\n{\n    virJSONValuePtr val;\n\n    if (!data)\n        return virJSONValueNewNull();\n\n    if (VIR_ALLOC(val) < 0)\n        return NULL;\n\n    val->type = VIR_JSON_TYPE_STRING;\n    val->data.string = g_strdup(data);\n\n    return val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewArray",
          "args": [],
          "line": 1195
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "560-568",
          "snippet": "virJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic virJSONValuePtr\nqemuAgentMakeStringsArray(const char **strings, unsigned int len)\n{\n    size_t i;\n    virJSONValuePtr ret = virJSONValueNewArray(), str;\n\n    for (i = 0; i < len; i++) {\n        str = virJSONValueNewString(strings[i]);\n        if (!str)\n            goto error;\n\n        if (virJSONValueArrayAppend(ret, str) < 0) {\n            virJSONValueFree(str);\n            goto error;\n        }\n    }\n    return ret;\n\n error:\n    virJSONValueFree(ret);\n    return NULL;\n}"
  },
  {
    "function_name": "qemuAgentMakeCommand",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1160-1189",
    "snippet": "static virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void qemuAgentDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "args"
          ],
          "line": 1187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "jargs"
          ],
          "line": 1186
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "args"
          ],
          "line": 1180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppend",
          "args": [
            "obj",
            "\"arguments\"",
            "jargs"
          ],
          "line": 1177
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendBoolean",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "741-754",
          "snippet": "int\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectCreateVArgs",
          "args": [
            "&jargs",
            "args"
          ],
          "line": 1173
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectCreateVArgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "359-374",
          "snippet": "int\nvirJSONValueObjectCreateVArgs(virJSONValuePtr *obj,\n                              va_list args)\n{\n    int ret;\n\n    *obj = virJSONValueNewObject();\n\n    /* free the object on error, or if no value objects were added */\n    if ((ret = virJSONValueObjectAddVArgs(*obj, args)) <= 0) {\n        virJSONValueFree(*obj);\n        *obj = NULL;\n    }\n\n    return ret;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectCreateVArgs(virJSONValuePtr *obj,\n                              va_list args)\n{\n    int ret;\n\n    *obj = virJSONValueNewObject();\n\n    /* free the object on error, or if no value objects were added */\n    if ((ret = virJSONValueObjectAddVArgs(*obj, args)) <= 0) {\n        virJSONValueFree(*obj);\n        *obj = NULL;\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendString",
          "args": [
            "obj",
            "\"execute\"",
            "cmdname"
          ],
          "line": 1170
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "643-649",
          "snippet": "int\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "args",
            "cmdname"
          ],
          "line": 1168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueNewObject",
          "args": [],
          "line": 1164
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "571-579",
          "snippet": "virJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic virJSONValuePtr G_GNUC_NULL_TERMINATED\nqemuAgentMakeCommand(const char *cmdname,\n                     ...)\n{\n    virJSONValuePtr obj = virJSONValueNewObject();\n    virJSONValuePtr jargs = NULL;\n    va_list args;\n\n    va_start(args, cmdname);\n\n    if (virJSONValueObjectAppendString(obj, \"execute\", cmdname) < 0)\n        goto error;\n\n    if (virJSONValueObjectCreateVArgs(&jargs, args) < 0)\n        goto error;\n\n    if (jargs &&\n        virJSONValueObjectAppend(obj, \"arguments\", jargs) < 0)\n        goto error;\n\n    va_end(args);\n\n    return obj;\n\n error:\n    virJSONValueFree(obj);\n    virJSONValueFree(jargs);\n    va_end(args);\n    return NULL;\n}"
  },
  {
    "function_name": "qemuAgentCommand",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1095-1158",
    "snippet": "static int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define LINE_ENDING \"\\n\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "msg.txBuffer"
          ],
          "line": 1154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdstr"
          ],
          "line": 1153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentCheckError",
          "args": [
            "cmd",
            "*reply"
          ],
          "line": 1150
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCheckError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1052-1093",
          "snippet": "static int\nqemuAgentCheckError(virJSONValuePtr cmd,\n                    virJSONValuePtr reply)\n{\n    if (virJSONValueObjectHasKey(reply, \"error\")) {\n        virJSONValuePtr error = virJSONValueObjectGet(reply, \"error\");\n        char *cmdstr = virJSONValueToString(cmd, false);\n        char *replystr = virJSONValueToString(reply, false);\n\n        /* Log the full JSON formatted command & error */\n        VIR_DEBUG(\"unable to execute QEMU agent command %s: %s\",\n                  NULLSTR(cmdstr), NULLSTR(replystr));\n\n        /* Only send the user the command name + friendly error */\n        if (!error)\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unable to execute QEMU agent command '%s'\"),\n                           qemuAgentCommandName(cmd));\n        else\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unable to execute QEMU agent command '%s': %s\"),\n                           qemuAgentCommandName(cmd),\n                           qemuAgentStringifyError(error));\n\n        VIR_FREE(cmdstr);\n        VIR_FREE(replystr);\n        return -1;\n    } else if (!virJSONValueObjectHasKey(reply, \"return\")) {\n        char *cmdstr = virJSONValueToString(cmd, false);\n        char *replystr = virJSONValueToString(reply, false);\n\n        VIR_DEBUG(\"Neither 'return' nor 'error' is set in the JSON reply %s: %s\",\n                  NULLSTR(cmdstr), NULLSTR(replystr));\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to execute QEMU agent command '%s'\"),\n                       qemuAgentCommandName(cmd));\n        VIR_FREE(cmdstr);\n        VIR_FREE(replystr);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentCheckError(virJSONValuePtr cmd,\n                    virJSONValuePtr reply)\n{\n    if (virJSONValueObjectHasKey(reply, \"error\")) {\n        virJSONValuePtr error = virJSONValueObjectGet(reply, \"error\");\n        char *cmdstr = virJSONValueToString(cmd, false);\n        char *replystr = virJSONValueToString(reply, false);\n\n        /* Log the full JSON formatted command & error */\n        VIR_DEBUG(\"unable to execute QEMU agent command %s: %s\",\n                  NULLSTR(cmdstr), NULLSTR(replystr));\n\n        /* Only send the user the command name + friendly error */\n        if (!error)\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unable to execute QEMU agent command '%s'\"),\n                           qemuAgentCommandName(cmd));\n        else\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unable to execute QEMU agent command '%s': %s\"),\n                           qemuAgentCommandName(cmd),\n                           qemuAgentStringifyError(error));\n\n        VIR_FREE(cmdstr);\n        VIR_FREE(replystr);\n        return -1;\n    } else if (!virJSONValueObjectHasKey(reply, \"return\")) {\n        char *cmdstr = virJSONValueToString(cmd, false);\n        char *replystr = virJSONValueToString(reply, false);\n\n        VIR_DEBUG(\"Neither 'return' nor 'error' is set in the JSON reply %s: %s\",\n                  NULLSTR(cmdstr), NULLSTR(replystr));\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to execute QEMU agent command '%s'\"),\n                       qemuAgentCommandName(cmd));\n        VIR_FREE(cmdstr);\n        VIR_FREE(replystr);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AGENT_UNRESPONSIVE",
            "\"%s\"",
            "_(\"Guest agent disappeared while executing command\")"
          ],
          "line": 1141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Guest agent disappeared while executing command\""
          ],
          "line": 1142
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing agent reply object\")"
          ],
          "line": 1138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Receive command reply ret=%d rxObject=%p\"",
            "ret",
            "msg.rxObject"
          ],
          "line": 1127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentSend",
          "args": [
            "agent",
            "&msg",
            "seconds"
          ],
          "line": 1125
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentSend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "821-879",
          "snippet": "static int qemuAgentSend(qemuAgentPtr agent,\n                         qemuAgentMessagePtr msg,\n                         int seconds)\n{\n    int ret = -1;\n    unsigned long long then = 0;\n\n    /* Check whether qemu quit unexpectedly */\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Attempt to send command while error is set %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        return -1;\n    }\n\n    if (seconds > VIR_DOMAIN_QEMU_AGENT_COMMAND_BLOCK) {\n        unsigned long long now;\n        if (virTimeMillisNow(&now) < 0)\n            return -1;\n        if (seconds == VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT)\n            seconds = QEMU_AGENT_WAIT_TIME;\n        then = now + seconds * 1000ull;\n    }\n\n    agent->msg = msg;\n    qemuAgentUpdateWatch(agent);\n\n    while (!agent->msg->finished) {\n        if ((then && virCondWaitUntil(&agent->notify, &agent->parent.lock, then) < 0) ||\n            (!then && virCondWait(&agent->notify, &agent->parent.lock) < 0)) {\n            if (errno == ETIMEDOUT) {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent not available for now\"));\n                ret = -2;\n            } else {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to wait on agent socket \"\n                                       \"condition\"));\n            }\n            agent->inSync = false;\n            goto cleanup;\n        }\n    }\n\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Send command resulted in error %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    agent->msg = NULL;\n    qemuAgentUpdateWatch(agent);\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define QEMU_AGENT_WAIT_TIME 5"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define QEMU_AGENT_WAIT_TIME 5\n\nstatic int qemuAgentSend(qemuAgentPtr agent,\n                         qemuAgentMessagePtr msg,\n                         int seconds)\n{\n    int ret = -1;\n    unsigned long long then = 0;\n\n    /* Check whether qemu quit unexpectedly */\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Attempt to send command while error is set %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        return -1;\n    }\n\n    if (seconds > VIR_DOMAIN_QEMU_AGENT_COMMAND_BLOCK) {\n        unsigned long long now;\n        if (virTimeMillisNow(&now) < 0)\n            return -1;\n        if (seconds == VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT)\n            seconds = QEMU_AGENT_WAIT_TIME;\n        then = now + seconds * 1000ull;\n    }\n\n    agent->msg = msg;\n    qemuAgentUpdateWatch(agent);\n\n    while (!agent->msg->finished) {\n        if ((then && virCondWaitUntil(&agent->notify, &agent->parent.lock, then) < 0) ||\n            (!then && virCondWait(&agent->notify, &agent->parent.lock) < 0)) {\n            if (errno == ETIMEDOUT) {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent not available for now\"));\n                ret = -2;\n            } else {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to wait on agent socket \"\n                                       \"condition\"));\n            }\n            agent->inSync = false;\n            goto cleanup;\n        }\n    }\n\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Send command resulted in error %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    agent->msg = NULL;\n    qemuAgentUpdateWatch(agent);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Send command '%s' for write, seconds = %d\"",
            "cmdstr",
            "seconds"
          ],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "msg.txBuffer"
          ],
          "line": 1121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s\" LINE_ENDING",
            "cmdstr"
          ],
          "line": 1120
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueToString",
          "args": [
            "cmd",
            "false"
          ],
          "line": 1118
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueToString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "2014-2024",
          "snippet": "char *\nvirJSONValueToString(virJSONValuePtr object,\n                     bool pretty)\n{\n    g_auto(virBuffer) buf = VIR_BUFFER_INITIALIZER;\n\n    if (virJSONValueToBuffer(object, &buf, pretty) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nchar *\nvirJSONValueToString(virJSONValuePtr object,\n                     bool pretty)\n{\n    g_auto(virBuffer) buf = VIR_BUFFER_INITIALIZER;\n\n    if (virJSONValueToBuffer(object, &buf, pretty) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentGuestSync",
          "args": [
            "agent"
          ],
          "line": 1115
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentGuestSync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "893-959",
          "snippet": "static int\nqemuAgentGuestSync(qemuAgentPtr agent)\n{\n    int ret = -1;\n    int send_ret;\n    unsigned long long id;\n    qemuAgentMessage sync_msg;\n    int timeout = VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT;\n\n    if (agent->singleSync && agent->inSync)\n        return 0;\n\n    /* if user specified a custom agent timeout that is lower than the\n     * default timeout, use the shorter timeout instead */\n    if ((agent->timeout >= 0) && (agent->timeout < QEMU_AGENT_WAIT_TIME))\n        timeout = agent->timeout;\n\n    memset(&sync_msg, 0, sizeof(sync_msg));\n    /* set only on first sync */\n    sync_msg.first = true;\n\n retry:\n    if (virTimeMillisNow(&id) < 0)\n        return -1;\n\n    sync_msg.txBuffer = g_strdup_printf(\"{\\\"execute\\\":\\\"guest-sync\\\", \"\n                                        \"\\\"arguments\\\":{\\\"id\\\":%llu}}\\n\", id);\n\n    sync_msg.txLength = strlen(sync_msg.txBuffer);\n    sync_msg.sync = true;\n    sync_msg.id = id;\n\n    VIR_DEBUG(\"Sending guest-sync command with ID: %llu\", id);\n\n    send_ret = qemuAgentSend(agent, &sync_msg, timeout);\n\n    VIR_DEBUG(\"qemuAgentSend returned: %d\", send_ret);\n\n    if (send_ret < 0)\n        goto cleanup;\n\n    if (!sync_msg.rxObject) {\n        if (sync_msg.first) {\n            VIR_FREE(sync_msg.txBuffer);\n            memset(&sync_msg, 0, sizeof(sync_msg));\n            goto retry;\n        } else {\n            if (agent->running)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            else\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            goto cleanup;\n        }\n    }\n\n    if (agent->singleSync)\n        agent->inSync = true;\n\n    ret = 0;\n\n cleanup:\n    virJSONValueFree(sync_msg.rxObject);\n    VIR_FREE(sync_msg.txBuffer);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define QEMU_AGENT_WAIT_TIME 5"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define QEMU_AGENT_WAIT_TIME 5\n\nstatic int\nqemuAgentGuestSync(qemuAgentPtr agent)\n{\n    int ret = -1;\n    int send_ret;\n    unsigned long long id;\n    qemuAgentMessage sync_msg;\n    int timeout = VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT;\n\n    if (agent->singleSync && agent->inSync)\n        return 0;\n\n    /* if user specified a custom agent timeout that is lower than the\n     * default timeout, use the shorter timeout instead */\n    if ((agent->timeout >= 0) && (agent->timeout < QEMU_AGENT_WAIT_TIME))\n        timeout = agent->timeout;\n\n    memset(&sync_msg, 0, sizeof(sync_msg));\n    /* set only on first sync */\n    sync_msg.first = true;\n\n retry:\n    if (virTimeMillisNow(&id) < 0)\n        return -1;\n\n    sync_msg.txBuffer = g_strdup_printf(\"{\\\"execute\\\":\\\"guest-sync\\\", \"\n                                        \"\\\"arguments\\\":{\\\"id\\\":%llu}}\\n\", id);\n\n    sync_msg.txLength = strlen(sync_msg.txBuffer);\n    sync_msg.sync = true;\n    sync_msg.id = id;\n\n    VIR_DEBUG(\"Sending guest-sync command with ID: %llu\", id);\n\n    send_ret = qemuAgentSend(agent, &sync_msg, timeout);\n\n    VIR_DEBUG(\"qemuAgentSend returned: %d\", send_ret);\n\n    if (send_ret < 0)\n        goto cleanup;\n\n    if (!sync_msg.rxObject) {\n        if (sync_msg.first) {\n            VIR_FREE(sync_msg.txBuffer);\n            memset(&sync_msg, 0, sizeof(sync_msg));\n            goto retry;\n        } else {\n            if (agent->running)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            else\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            goto cleanup;\n        }\n    }\n\n    if (agent->singleSync)\n        agent->inSync = true;\n\n    ret = 0;\n\n cleanup:\n    virJSONValueFree(sync_msg.rxObject);\n    VIR_FREE(sync_msg.txBuffer);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AGENT_UNRESPONSIVE",
            "\"%s\"",
            "_(\"Guest agent disappeared while executing command\")"
          ],
          "line": 1110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&msg",
            "0",
            "sizeof(msg)"
          ],
          "line": 1107
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define LINE_ENDING \"\\n\"\n\nstatic int\nqemuAgentCommand(qemuAgentPtr agent,\n                 virJSONValuePtr cmd,\n                 virJSONValuePtr *reply,\n                 int seconds)\n{\n    int ret = -1;\n    qemuAgentMessage msg;\n    char *cmdstr = NULL;\n    int await_event = agent->await_event;\n\n    *reply = NULL;\n    memset(&msg, 0, sizeof(msg));\n\n    if (!agent->running) {\n        virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                       _(\"Guest agent disappeared while executing command\"));\n        goto cleanup;\n    }\n\n    if (qemuAgentGuestSync(agent) < 0)\n        goto cleanup;\n\n    if (!(cmdstr = virJSONValueToString(cmd, false)))\n        goto cleanup;\n    msg.txBuffer = g_strdup_printf(\"%s\" LINE_ENDING, cmdstr);\n    msg.txLength = strlen(msg.txBuffer);\n\n    VIR_DEBUG(\"Send command '%s' for write, seconds = %d\", cmdstr, seconds);\n\n    ret = qemuAgentSend(agent, &msg, seconds);\n\n    VIR_DEBUG(\"Receive command reply ret=%d rxObject=%p\",\n              ret, msg.rxObject);\n\n    if (ret < 0)\n        goto cleanup;\n\n    /* If we haven't obtained any reply but we wait for an\n     * event, then don't report this as error */\n    if (!msg.rxObject) {\n        if (!await_event) {\n            if (agent->running) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            } else {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            }\n            ret = -1;\n        }\n        goto cleanup;\n    }\n\n    *reply = msg.rxObject;\n    ret = qemuAgentCheckError(cmd, *reply);\n\n cleanup:\n    VIR_FREE(cmdstr);\n    VIR_FREE(msg.txBuffer);\n    agent->await_event = QEMU_AGENT_EVENT_NONE;\n\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentCheckError",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1052-1093",
    "snippet": "static int\nqemuAgentCheckError(virJSONValuePtr cmd,\n                    virJSONValuePtr reply)\n{\n    if (virJSONValueObjectHasKey(reply, \"error\")) {\n        virJSONValuePtr error = virJSONValueObjectGet(reply, \"error\");\n        char *cmdstr = virJSONValueToString(cmd, false);\n        char *replystr = virJSONValueToString(reply, false);\n\n        /* Log the full JSON formatted command & error */\n        VIR_DEBUG(\"unable to execute QEMU agent command %s: %s\",\n                  NULLSTR(cmdstr), NULLSTR(replystr));\n\n        /* Only send the user the command name + friendly error */\n        if (!error)\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unable to execute QEMU agent command '%s'\"),\n                           qemuAgentCommandName(cmd));\n        else\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unable to execute QEMU agent command '%s': %s\"),\n                           qemuAgentCommandName(cmd),\n                           qemuAgentStringifyError(error));\n\n        VIR_FREE(cmdstr);\n        VIR_FREE(replystr);\n        return -1;\n    } else if (!virJSONValueObjectHasKey(reply, \"return\")) {\n        char *cmdstr = virJSONValueToString(cmd, false);\n        char *replystr = virJSONValueToString(reply, false);\n\n        VIR_DEBUG(\"Neither 'return' nor 'error' is set in the JSON reply %s: %s\",\n                  NULLSTR(cmdstr), NULLSTR(replystr));\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to execute QEMU agent command '%s'\"),\n                       qemuAgentCommandName(cmd));\n        VIR_FREE(cmdstr);\n        VIR_FREE(replystr);\n        return -1;\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "replystr"
          ],
          "line": 1089
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdstr"
          ],
          "line": 1088
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"unable to execute QEMU agent command '%s'\")",
            "qemuAgentCommandName(cmd)"
          ],
          "line": 1085
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentCommandName",
          "args": [
            "cmd"
          ],
          "line": 1087
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentCommandName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1042-1050",
          "snippet": "static const char *\nqemuAgentCommandName(virJSONValuePtr cmd)\n{\n    const char *name = virJSONValueObjectGetString(cmd, \"execute\");\n    if (name)\n        return name;\n    else\n        return \"<unknown>\";\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic const char *\nqemuAgentCommandName(virJSONValuePtr cmd)\n{\n    const char *name = virJSONValueObjectGetString(cmd, \"execute\");\n    if (name)\n        return name;\n    else\n        return \"<unknown>\";\n}"
        }
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unable to execute QEMU agent command '%s'\""
          ],
          "line": 1086
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Neither 'return' nor 'error' is set in the JSON reply %s: %s\"",
            "NULLSTR(cmdstr)",
            "NULLSTR(replystr)"
          ],
          "line": 1083
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "replystr"
          ],
          "line": 1084
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "cmdstr"
          ],
          "line": 1084
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueToString",
          "args": [
            "reply",
            "false"
          ],
          "line": 1081
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueToString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "2014-2024",
          "snippet": "char *\nvirJSONValueToString(virJSONValuePtr object,\n                     bool pretty)\n{\n    g_auto(virBuffer) buf = VIR_BUFFER_INITIALIZER;\n\n    if (virJSONValueToBuffer(object, &buf, pretty) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nchar *\nvirJSONValueToString(virJSONValuePtr object,\n                     bool pretty)\n{\n    g_auto(virBuffer) buf = VIR_BUFFER_INITIALIZER;\n\n    if (virJSONValueToBuffer(object, &buf, pretty) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectHasKey",
          "args": [
            "reply",
            "\"return\""
          ],
          "line": 1079
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectHasKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "838-853",
          "snippet": "int\nvirJSONValueObjectHasKey(virJSONValuePtr object,\n                         const char *key)\n{\n    size_t i;\n\n    if (object->type != VIR_JSON_TYPE_OBJECT)\n        return -1;\n\n    for (i = 0; i < object->data.object.npairs; i++) {\n        if (STREQ(object->data.object.pairs[i].key, key))\n            return 1;\n    }\n\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectHasKey(virJSONValuePtr object,\n                         const char *key)\n{\n    size_t i;\n\n    if (object->type != VIR_JSON_TYPE_OBJECT)\n        return -1;\n\n    for (i = 0; i < object->data.object.npairs; i++) {\n        if (STREQ(object->data.object.pairs[i].key, key))\n            return 1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "replystr"
          ],
          "line": 1077
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdstr"
          ],
          "line": 1076
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"unable to execute QEMU agent command '%s': %s\")",
            "qemuAgentCommandName(cmd)",
            "qemuAgentStringifyError(error)"
          ],
          "line": 1071
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentStringifyError",
          "args": [
            "error"
          ],
          "line": 1074
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentStringifyError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "1026-1040",
          "snippet": "static const char *\nqemuAgentStringifyError(virJSONValuePtr error)\n{\n    const char *klass = virJSONValueObjectGetString(error, \"class\");\n    const char *detail = virJSONValueObjectGetString(error, \"desc\");\n\n    /* The QMP 'desc' field is usually sufficient for our generic\n     * error reporting needs. However, if not present, translate\n     * the class into something readable.\n     */\n    if (!detail)\n        detail = qemuAgentStringifyErrorClass(klass);\n\n    return detail;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic const char *\nqemuAgentStringifyError(virJSONValuePtr error)\n{\n    const char *klass = virJSONValueObjectGetString(error, \"class\");\n    const char *detail = virJSONValueObjectGetString(error, \"desc\");\n\n    /* The QMP 'desc' field is usually sufficient for our generic\n     * error reporting needs. However, if not present, translate\n     * the class into something readable.\n     */\n    if (!detail)\n        detail = qemuAgentStringifyErrorClass(klass);\n\n    return detail;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"unable to execute QEMU agent command '%s'\")",
            "qemuAgentCommandName(cmd)"
          ],
          "line": 1067
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"unable to execute QEMU agent command %s: %s\"",
            "NULLSTR(cmdstr)",
            "NULLSTR(replystr)"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "replystr"
          ],
          "line": 1063
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "cmdstr"
          ],
          "line": 1063
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "reply",
            "\"error\""
          ],
          "line": 1057
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentCheckError(virJSONValuePtr cmd,\n                    virJSONValuePtr reply)\n{\n    if (virJSONValueObjectHasKey(reply, \"error\")) {\n        virJSONValuePtr error = virJSONValueObjectGet(reply, \"error\");\n        char *cmdstr = virJSONValueToString(cmd, false);\n        char *replystr = virJSONValueToString(reply, false);\n\n        /* Log the full JSON formatted command & error */\n        VIR_DEBUG(\"unable to execute QEMU agent command %s: %s\",\n                  NULLSTR(cmdstr), NULLSTR(replystr));\n\n        /* Only send the user the command name + friendly error */\n        if (!error)\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unable to execute QEMU agent command '%s'\"),\n                           qemuAgentCommandName(cmd));\n        else\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unable to execute QEMU agent command '%s': %s\"),\n                           qemuAgentCommandName(cmd),\n                           qemuAgentStringifyError(error));\n\n        VIR_FREE(cmdstr);\n        VIR_FREE(replystr);\n        return -1;\n    } else if (!virJSONValueObjectHasKey(reply, \"return\")) {\n        char *cmdstr = virJSONValueToString(cmd, false);\n        char *replystr = virJSONValueToString(reply, false);\n\n        VIR_DEBUG(\"Neither 'return' nor 'error' is set in the JSON reply %s: %s\",\n                  NULLSTR(cmdstr), NULLSTR(replystr));\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to execute QEMU agent command '%s'\"),\n                       qemuAgentCommandName(cmd));\n        VIR_FREE(cmdstr);\n        VIR_FREE(replystr);\n        return -1;\n    }\n    return 0;\n}"
  },
  {
    "function_name": "qemuAgentCommandName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1042-1050",
    "snippet": "static const char *\nqemuAgentCommandName(virJSONValuePtr cmd)\n{\n    const char *name = virJSONValueObjectGetString(cmd, \"execute\");\n    if (name)\n        return name;\n    else\n        return \"<unknown>\";\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "cmd",
            "\"execute\""
          ],
          "line": 1045
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic const char *\nqemuAgentCommandName(virJSONValuePtr cmd)\n{\n    const char *name = virJSONValueObjectGetString(cmd, \"execute\");\n    if (name)\n        return name;\n    else\n        return \"<unknown>\";\n}"
  },
  {
    "function_name": "qemuAgentStringifyError",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1026-1040",
    "snippet": "static const char *\nqemuAgentStringifyError(virJSONValuePtr error)\n{\n    const char *klass = virJSONValueObjectGetString(error, \"class\");\n    const char *detail = virJSONValueObjectGetString(error, \"desc\");\n\n    /* The QMP 'desc' field is usually sufficient for our generic\n     * error reporting needs. However, if not present, translate\n     * the class into something readable.\n     */\n    if (!detail)\n        detail = qemuAgentStringifyErrorClass(klass);\n\n    return detail;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuAgentStringifyErrorClass",
          "args": [
            "klass"
          ],
          "line": 1037
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentStringifyErrorClass",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "961-994",
          "snippet": "static const char *\nqemuAgentStringifyErrorClass(const char *klass)\n{\n    if (STREQ_NULLABLE(klass, \"BufferOverrun\"))\n        return \"Buffer overrun\";\n    else if (STREQ_NULLABLE(klass, \"CommandDisabled\"))\n        return \"The command has been disabled for this instance\";\n    else if (STREQ_NULLABLE(klass, \"CommandNotFound\"))\n        return \"The command has not been found\";\n    else if (STREQ_NULLABLE(klass, \"FdNotFound\"))\n        return \"File descriptor not found\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameter\"))\n        return \"Invalid parameter\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameterType\"))\n        return \"Invalid parameter type\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameterValue\"))\n        return \"Invalid parameter value\";\n    else if (STREQ_NULLABLE(klass, \"OpenFileFailed\"))\n        return \"Cannot open file\";\n    else if (STREQ_NULLABLE(klass, \"QgaCommandFailed\"))\n        return \"Guest agent command failed\";\n    else if (STREQ_NULLABLE(klass, \"QMPBadInputObjectMember\"))\n        return \"Bad QMP input object member\";\n    else if (STREQ_NULLABLE(klass, \"QMPExtraInputObjectMember\"))\n        return \"Unexpected extra object member\";\n    else if (STREQ_NULLABLE(klass, \"UndefinedError\"))\n        return \"An undefined error has occurred\";\n    else if (STREQ_NULLABLE(klass, \"Unsupported\"))\n        return \"this feature or command is not currently supported\";\n    else if (klass)\n        return klass;\n    else\n        return \"unknown QEMU command error\";\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic const char *\nqemuAgentStringifyErrorClass(const char *klass)\n{\n    if (STREQ_NULLABLE(klass, \"BufferOverrun\"))\n        return \"Buffer overrun\";\n    else if (STREQ_NULLABLE(klass, \"CommandDisabled\"))\n        return \"The command has been disabled for this instance\";\n    else if (STREQ_NULLABLE(klass, \"CommandNotFound\"))\n        return \"The command has not been found\";\n    else if (STREQ_NULLABLE(klass, \"FdNotFound\"))\n        return \"File descriptor not found\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameter\"))\n        return \"Invalid parameter\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameterType\"))\n        return \"Invalid parameter type\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameterValue\"))\n        return \"Invalid parameter value\";\n    else if (STREQ_NULLABLE(klass, \"OpenFileFailed\"))\n        return \"Cannot open file\";\n    else if (STREQ_NULLABLE(klass, \"QgaCommandFailed\"))\n        return \"Guest agent command failed\";\n    else if (STREQ_NULLABLE(klass, \"QMPBadInputObjectMember\"))\n        return \"Bad QMP input object member\";\n    else if (STREQ_NULLABLE(klass, \"QMPExtraInputObjectMember\"))\n        return \"Unexpected extra object member\";\n    else if (STREQ_NULLABLE(klass, \"UndefinedError\"))\n        return \"An undefined error has occurred\";\n    else if (STREQ_NULLABLE(klass, \"Unsupported\"))\n        return \"this feature or command is not currently supported\";\n    else if (klass)\n        return klass;\n    else\n        return \"unknown QEMU command error\";\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "error",
            "\"desc\""
          ],
          "line": 1030
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic const char *\nqemuAgentStringifyError(virJSONValuePtr error)\n{\n    const char *klass = virJSONValueObjectGetString(error, \"class\");\n    const char *detail = virJSONValueObjectGetString(error, \"desc\");\n\n    /* The QMP 'desc' field is usually sufficient for our generic\n     * error reporting needs. However, if not present, translate\n     * the class into something readable.\n     */\n    if (!detail)\n        detail = qemuAgentStringifyErrorClass(klass);\n\n    return detail;\n}"
  },
  {
    "function_name": "qemuAgentErrorCommandUnsupported",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "1002-1019",
    "snippet": "static bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"CommandDisabled\""
          ],
          "line": 1018
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"CommandNotFound\""
          ],
          "line": 1017
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "error",
            "\"class\""
          ],
          "line": 1016
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "reply",
            "\"error\""
          ],
          "line": 1011
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic bool\nqemuAgentErrorCommandUnsupported(virJSONValuePtr reply)\n{\n    const char *klass;\n    virJSONValuePtr error;\n\n    if (!reply)\n        return false;\n\n    error = virJSONValueObjectGet(reply, \"error\");\n\n    if (!error)\n        return false;\n\n    klass = virJSONValueObjectGetString(error, \"class\");\n    return STREQ_NULLABLE(klass, \"CommandNotFound\") ||\n        STREQ_NULLABLE(klass, \"CommandDisabled\");\n}"
  },
  {
    "function_name": "qemuAgentStringifyErrorClass",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "961-994",
    "snippet": "static const char *\nqemuAgentStringifyErrorClass(const char *klass)\n{\n    if (STREQ_NULLABLE(klass, \"BufferOverrun\"))\n        return \"Buffer overrun\";\n    else if (STREQ_NULLABLE(klass, \"CommandDisabled\"))\n        return \"The command has been disabled for this instance\";\n    else if (STREQ_NULLABLE(klass, \"CommandNotFound\"))\n        return \"The command has not been found\";\n    else if (STREQ_NULLABLE(klass, \"FdNotFound\"))\n        return \"File descriptor not found\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameter\"))\n        return \"Invalid parameter\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameterType\"))\n        return \"Invalid parameter type\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameterValue\"))\n        return \"Invalid parameter value\";\n    else if (STREQ_NULLABLE(klass, \"OpenFileFailed\"))\n        return \"Cannot open file\";\n    else if (STREQ_NULLABLE(klass, \"QgaCommandFailed\"))\n        return \"Guest agent command failed\";\n    else if (STREQ_NULLABLE(klass, \"QMPBadInputObjectMember\"))\n        return \"Bad QMP input object member\";\n    else if (STREQ_NULLABLE(klass, \"QMPExtraInputObjectMember\"))\n        return \"Unexpected extra object member\";\n    else if (STREQ_NULLABLE(klass, \"UndefinedError\"))\n        return \"An undefined error has occurred\";\n    else if (STREQ_NULLABLE(klass, \"Unsupported\"))\n        return \"this feature or command is not currently supported\";\n    else if (klass)\n        return klass;\n    else\n        return \"unknown QEMU command error\";\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"Unsupported\""
          ],
          "line": 988
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"UndefinedError\""
          ],
          "line": 986
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"QMPExtraInputObjectMember\""
          ],
          "line": 984
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"QMPBadInputObjectMember\""
          ],
          "line": 982
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"QgaCommandFailed\""
          ],
          "line": 980
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"OpenFileFailed\""
          ],
          "line": 978
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"InvalidParameterValue\""
          ],
          "line": 976
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"InvalidParameterType\""
          ],
          "line": 974
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"InvalidParameter\""
          ],
          "line": 972
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"FdNotFound\""
          ],
          "line": 970
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"CommandNotFound\""
          ],
          "line": 968
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"CommandDisabled\""
          ],
          "line": 966
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ_NULLABLE",
          "args": [
            "klass",
            "\"BufferOverrun\""
          ],
          "line": 964
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic const char *\nqemuAgentStringifyErrorClass(const char *klass)\n{\n    if (STREQ_NULLABLE(klass, \"BufferOverrun\"))\n        return \"Buffer overrun\";\n    else if (STREQ_NULLABLE(klass, \"CommandDisabled\"))\n        return \"The command has been disabled for this instance\";\n    else if (STREQ_NULLABLE(klass, \"CommandNotFound\"))\n        return \"The command has not been found\";\n    else if (STREQ_NULLABLE(klass, \"FdNotFound\"))\n        return \"File descriptor not found\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameter\"))\n        return \"Invalid parameter\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameterType\"))\n        return \"Invalid parameter type\";\n    else if (STREQ_NULLABLE(klass, \"InvalidParameterValue\"))\n        return \"Invalid parameter value\";\n    else if (STREQ_NULLABLE(klass, \"OpenFileFailed\"))\n        return \"Cannot open file\";\n    else if (STREQ_NULLABLE(klass, \"QgaCommandFailed\"))\n        return \"Guest agent command failed\";\n    else if (STREQ_NULLABLE(klass, \"QMPBadInputObjectMember\"))\n        return \"Bad QMP input object member\";\n    else if (STREQ_NULLABLE(klass, \"QMPExtraInputObjectMember\"))\n        return \"Unexpected extra object member\";\n    else if (STREQ_NULLABLE(klass, \"UndefinedError\"))\n        return \"An undefined error has occurred\";\n    else if (STREQ_NULLABLE(klass, \"Unsupported\"))\n        return \"this feature or command is not currently supported\";\n    else if (klass)\n        return klass;\n    else\n        return \"unknown QEMU command error\";\n}"
  },
  {
    "function_name": "qemuAgentGuestSync",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "893-959",
    "snippet": "static int\nqemuAgentGuestSync(qemuAgentPtr agent)\n{\n    int ret = -1;\n    int send_ret;\n    unsigned long long id;\n    qemuAgentMessage sync_msg;\n    int timeout = VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT;\n\n    if (agent->singleSync && agent->inSync)\n        return 0;\n\n    /* if user specified a custom agent timeout that is lower than the\n     * default timeout, use the shorter timeout instead */\n    if ((agent->timeout >= 0) && (agent->timeout < QEMU_AGENT_WAIT_TIME))\n        timeout = agent->timeout;\n\n    memset(&sync_msg, 0, sizeof(sync_msg));\n    /* set only on first sync */\n    sync_msg.first = true;\n\n retry:\n    if (virTimeMillisNow(&id) < 0)\n        return -1;\n\n    sync_msg.txBuffer = g_strdup_printf(\"{\\\"execute\\\":\\\"guest-sync\\\", \"\n                                        \"\\\"arguments\\\":{\\\"id\\\":%llu}}\\n\", id);\n\n    sync_msg.txLength = strlen(sync_msg.txBuffer);\n    sync_msg.sync = true;\n    sync_msg.id = id;\n\n    VIR_DEBUG(\"Sending guest-sync command with ID: %llu\", id);\n\n    send_ret = qemuAgentSend(agent, &sync_msg, timeout);\n\n    VIR_DEBUG(\"qemuAgentSend returned: %d\", send_ret);\n\n    if (send_ret < 0)\n        goto cleanup;\n\n    if (!sync_msg.rxObject) {\n        if (sync_msg.first) {\n            VIR_FREE(sync_msg.txBuffer);\n            memset(&sync_msg, 0, sizeof(sync_msg));\n            goto retry;\n        } else {\n            if (agent->running)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            else\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            goto cleanup;\n        }\n    }\n\n    if (agent->singleSync)\n        agent->inSync = true;\n\n    ret = 0;\n\n cleanup:\n    virJSONValueFree(sync_msg.rxObject);\n    VIR_FREE(sync_msg.txBuffer);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define QEMU_AGENT_WAIT_TIME 5"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sync_msg.txBuffer"
          ],
          "line": 957
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "sync_msg.rxObject"
          ],
          "line": 956
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AGENT_UNRESPONSIVE",
            "\"%s\"",
            "_(\"Guest agent disappeared while executing command\")"
          ],
          "line": 944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Guest agent disappeared while executing command\""
          ],
          "line": 945
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing agent reply object\")"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&sync_msg",
            "0",
            "sizeof(sync_msg)"
          ],
          "line": 937
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "sync_msg.txBuffer"
          ],
          "line": 936
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"qemuAgentSend returned: %d\"",
            "send_ret"
          ],
          "line": 929
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentSend",
          "args": [
            "agent",
            "&sync_msg",
            "timeout"
          ],
          "line": 927
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentSend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "821-879",
          "snippet": "static int qemuAgentSend(qemuAgentPtr agent,\n                         qemuAgentMessagePtr msg,\n                         int seconds)\n{\n    int ret = -1;\n    unsigned long long then = 0;\n\n    /* Check whether qemu quit unexpectedly */\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Attempt to send command while error is set %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        return -1;\n    }\n\n    if (seconds > VIR_DOMAIN_QEMU_AGENT_COMMAND_BLOCK) {\n        unsigned long long now;\n        if (virTimeMillisNow(&now) < 0)\n            return -1;\n        if (seconds == VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT)\n            seconds = QEMU_AGENT_WAIT_TIME;\n        then = now + seconds * 1000ull;\n    }\n\n    agent->msg = msg;\n    qemuAgentUpdateWatch(agent);\n\n    while (!agent->msg->finished) {\n        if ((then && virCondWaitUntil(&agent->notify, &agent->parent.lock, then) < 0) ||\n            (!then && virCondWait(&agent->notify, &agent->parent.lock) < 0)) {\n            if (errno == ETIMEDOUT) {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent not available for now\"));\n                ret = -2;\n            } else {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to wait on agent socket \"\n                                       \"condition\"));\n            }\n            agent->inSync = false;\n            goto cleanup;\n        }\n    }\n\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Send command resulted in error %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    agent->msg = NULL;\n    qemuAgentUpdateWatch(agent);\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define QEMU_AGENT_WAIT_TIME 5"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define QEMU_AGENT_WAIT_TIME 5\n\nstatic int qemuAgentSend(qemuAgentPtr agent,\n                         qemuAgentMessagePtr msg,\n                         int seconds)\n{\n    int ret = -1;\n    unsigned long long then = 0;\n\n    /* Check whether qemu quit unexpectedly */\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Attempt to send command while error is set %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        return -1;\n    }\n\n    if (seconds > VIR_DOMAIN_QEMU_AGENT_COMMAND_BLOCK) {\n        unsigned long long now;\n        if (virTimeMillisNow(&now) < 0)\n            return -1;\n        if (seconds == VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT)\n            seconds = QEMU_AGENT_WAIT_TIME;\n        then = now + seconds * 1000ull;\n    }\n\n    agent->msg = msg;\n    qemuAgentUpdateWatch(agent);\n\n    while (!agent->msg->finished) {\n        if ((then && virCondWaitUntil(&agent->notify, &agent->parent.lock, then) < 0) ||\n            (!then && virCondWait(&agent->notify, &agent->parent.lock) < 0)) {\n            if (errno == ETIMEDOUT) {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent not available for now\"));\n                ret = -2;\n            } else {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to wait on agent socket \"\n                                       \"condition\"));\n            }\n            agent->inSync = false;\n            goto cleanup;\n        }\n    }\n\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Send command resulted in error %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    agent->msg = NULL;\n    qemuAgentUpdateWatch(agent);\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Sending guest-sync command with ID: %llu\"",
            "id"
          ],
          "line": 925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "sync_msg.txBuffer"
          ],
          "line": 921
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"{\\\"execute\\\":\\\"guest-sync\\\", \"\n                                        \"\\\"arguments\\\":{\\\"id\\\":%llu}}\\n\"",
            "id"
          ],
          "line": 918
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTimeMillisNow",
          "args": [
            "&id"
          ],
          "line": 915
        },
        "resolved": true,
        "details": {
          "function_name": "virTimeMillisNow",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtime.c",
          "lines": "214-222",
          "snippet": "int virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtime.h\"",
            "#include <sys/time.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtime.h\"\n#include <sys/time.h>\n#include <unistd.h>\n#include <config.h>\n\nint virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&sync_msg",
            "0",
            "sizeof(sync_msg)"
          ],
          "line": 910
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define QEMU_AGENT_WAIT_TIME 5\n\nstatic int\nqemuAgentGuestSync(qemuAgentPtr agent)\n{\n    int ret = -1;\n    int send_ret;\n    unsigned long long id;\n    qemuAgentMessage sync_msg;\n    int timeout = VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT;\n\n    if (agent->singleSync && agent->inSync)\n        return 0;\n\n    /* if user specified a custom agent timeout that is lower than the\n     * default timeout, use the shorter timeout instead */\n    if ((agent->timeout >= 0) && (agent->timeout < QEMU_AGENT_WAIT_TIME))\n        timeout = agent->timeout;\n\n    memset(&sync_msg, 0, sizeof(sync_msg));\n    /* set only on first sync */\n    sync_msg.first = true;\n\n retry:\n    if (virTimeMillisNow(&id) < 0)\n        return -1;\n\n    sync_msg.txBuffer = g_strdup_printf(\"{\\\"execute\\\":\\\"guest-sync\\\", \"\n                                        \"\\\"arguments\\\":{\\\"id\\\":%llu}}\\n\", id);\n\n    sync_msg.txLength = strlen(sync_msg.txBuffer);\n    sync_msg.sync = true;\n    sync_msg.id = id;\n\n    VIR_DEBUG(\"Sending guest-sync command with ID: %llu\", id);\n\n    send_ret = qemuAgentSend(agent, &sync_msg, timeout);\n\n    VIR_DEBUG(\"qemuAgentSend returned: %d\", send_ret);\n\n    if (send_ret < 0)\n        goto cleanup;\n\n    if (!sync_msg.rxObject) {\n        if (sync_msg.first) {\n            VIR_FREE(sync_msg.txBuffer);\n            memset(&sync_msg, 0, sizeof(sync_msg));\n            goto retry;\n        } else {\n            if (agent->running)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Missing agent reply object\"));\n            else\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent disappeared while executing command\"));\n            goto cleanup;\n        }\n    }\n\n    if (agent->singleSync)\n        agent->inSync = true;\n\n    ret = 0;\n\n cleanup:\n    virJSONValueFree(sync_msg.rxObject);\n    VIR_FREE(sync_msg.txBuffer);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentSend",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "821-879",
    "snippet": "static int qemuAgentSend(qemuAgentPtr agent,\n                         qemuAgentMessagePtr msg,\n                         int seconds)\n{\n    int ret = -1;\n    unsigned long long then = 0;\n\n    /* Check whether qemu quit unexpectedly */\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Attempt to send command while error is set %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        return -1;\n    }\n\n    if (seconds > VIR_DOMAIN_QEMU_AGENT_COMMAND_BLOCK) {\n        unsigned long long now;\n        if (virTimeMillisNow(&now) < 0)\n            return -1;\n        if (seconds == VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT)\n            seconds = QEMU_AGENT_WAIT_TIME;\n        then = now + seconds * 1000ull;\n    }\n\n    agent->msg = msg;\n    qemuAgentUpdateWatch(agent);\n\n    while (!agent->msg->finished) {\n        if ((then && virCondWaitUntil(&agent->notify, &agent->parent.lock, then) < 0) ||\n            (!then && virCondWait(&agent->notify, &agent->parent.lock) < 0)) {\n            if (errno == ETIMEDOUT) {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent not available for now\"));\n                ret = -2;\n            } else {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to wait on agent socket \"\n                                       \"condition\"));\n            }\n            agent->inSync = false;\n            goto cleanup;\n        }\n    }\n\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Send command resulted in error %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    agent->msg = NULL;\n    qemuAgentUpdateWatch(agent);\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define QEMU_AGENT_WAIT_TIME 5"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuAgentUpdateWatch",
          "args": [
            "agent"
          ],
          "line": 876
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentUpdateWatch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "545-550",
          "snippet": "static void qemuAgentUpdateWatch(qemuAgentPtr agent)\n{\n    qemuAgentUnregister(agent);\n    if (agent->socket)\n        qemuAgentRegister(agent);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentUpdateWatch(qemuAgentPtr agent)\n{\n    qemuAgentUnregister(agent);\n    if (agent->socket)\n        qemuAgentRegister(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetError",
          "args": [
            "&agent->lastError"
          ],
          "line": 868
        },
        "resolved": true,
        "details": {
          "function_name": "virSetErrorLogPriorityFunc",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "1391-1394",
          "snippet": "void virSetErrorLogPriorityFunc(virErrorLogPriorityFunc func)\n{\n    virErrorLogPriorityFilter = func;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virErrorLogPriorityFunc virErrorLogPriorityFilter = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvirErrorLogPriorityFunc virErrorLogPriorityFilter = NULL;\n\nvoid virSetErrorLogPriorityFunc(virErrorLogPriorityFunc func)\n{\n    virErrorLogPriorityFilter = func;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Send command resulted in error %s\"",
            "NULLSTR(agent->lastError.message)"
          ],
          "line": 866
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "agent->lastError.message"
          ],
          "line": 867
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to wait on agent socket \"\n                                       \"condition\")"
          ],
          "line": 856
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to wait on agent socket \"\n                                       \"condition\""
          ],
          "line": 857
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_AGENT_UNRESPONSIVE",
            "\"%s\"",
            "_(\"Guest agent not available for now\")"
          ],
          "line": 852
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCondWait",
          "args": [
            "&agent->notify",
            "&agent->parent.lock"
          ],
          "line": 850
        },
        "resolved": true,
        "details": {
          "function_name": "virCondWait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "145-153",
          "snippet": "int virCondWait(virCondPtr c, virMutexPtr m)\n{\n    int ret;\n    if ((ret = pthread_cond_wait(&c->cond, &m->lock)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondWait(virCondPtr c, virMutexPtr m)\n{\n    int ret;\n    if ((ret = pthread_cond_wait(&c->cond, &m->lock)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCondWaitUntil",
          "args": [
            "&agent->notify",
            "&agent->parent.lock",
            "then"
          ],
          "line": 849
        },
        "resolved": true,
        "details": {
          "function_name": "virCondWaitUntil",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "155-168",
          "snippet": "int virCondWaitUntil(virCondPtr c, virMutexPtr m, unsigned long long whenms)\n{\n    int ret;\n    struct timespec ts;\n\n    ts.tv_sec = whenms / 1000;\n    ts.tv_nsec = (whenms % 1000) * 1000000;\n\n    if ((ret = pthread_cond_timedwait(&c->cond, &m->lock, &ts)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondWaitUntil(virCondPtr c, virMutexPtr m, unsigned long long whenms)\n{\n    int ret;\n    struct timespec ts;\n\n    ts.tv_sec = whenms / 1000;\n    ts.tv_nsec = (whenms % 1000) * 1000000;\n\n    if ((ret = pthread_cond_timedwait(&c->cond, &m->lock, &ts)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virTimeMillisNow",
          "args": [
            "&now"
          ],
          "line": 838
        },
        "resolved": true,
        "details": {
          "function_name": "virTimeMillisNow",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtime.c",
          "lines": "214-222",
          "snippet": "int virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtime.h\"",
            "#include <sys/time.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtime.h\"\n#include <sys/time.h>\n#include <unistd.h>\n#include <config.h>\n\nint virTimeMillisNow(unsigned long long *now)\n{\n    if (virTimeMillisNowRaw(now) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to get current time\"));\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Attempt to send command while error is set %s\"",
            "NULLSTR(agent->lastError.message)"
          ],
          "line": 830
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "agent->lastError.message"
          ],
          "line": 831
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define QEMU_AGENT_WAIT_TIME 5\n\nstatic int qemuAgentSend(qemuAgentPtr agent,\n                         qemuAgentMessagePtr msg,\n                         int seconds)\n{\n    int ret = -1;\n    unsigned long long then = 0;\n\n    /* Check whether qemu quit unexpectedly */\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Attempt to send command while error is set %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        return -1;\n    }\n\n    if (seconds > VIR_DOMAIN_QEMU_AGENT_COMMAND_BLOCK) {\n        unsigned long long now;\n        if (virTimeMillisNow(&now) < 0)\n            return -1;\n        if (seconds == VIR_DOMAIN_QEMU_AGENT_COMMAND_DEFAULT)\n            seconds = QEMU_AGENT_WAIT_TIME;\n        then = now + seconds * 1000ull;\n    }\n\n    agent->msg = msg;\n    qemuAgentUpdateWatch(agent);\n\n    while (!agent->msg->finished) {\n        if ((then && virCondWaitUntil(&agent->notify, &agent->parent.lock, then) < 0) ||\n            (!then && virCondWait(&agent->notify, &agent->parent.lock) < 0)) {\n            if (errno == ETIMEDOUT) {\n                virReportError(VIR_ERR_AGENT_UNRESPONSIVE, \"%s\",\n                               _(\"Guest agent not available for now\"));\n                ret = -2;\n            } else {\n                virReportSystemError(errno, \"%s\",\n                                     _(\"Unable to wait on agent socket \"\n                                       \"condition\"));\n            }\n            agent->inSync = false;\n            goto cleanup;\n        }\n    }\n\n    if (agent->lastError.code != VIR_ERR_OK) {\n        VIR_DEBUG(\"Send command resulted in error %s\",\n                  NULLSTR(agent->lastError.message));\n        virSetError(&agent->lastError);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    agent->msg = NULL;\n    qemuAgentUpdateWatch(agent);\n\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentClose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "778-798",
    "snippet": "void qemuAgentClose(qemuAgentPtr agent)\n{\n    if (!agent)\n        return;\n\n    VIR_DEBUG(\"agent=%p\", agent);\n\n    virObjectLock(agent);\n\n    if (agent->socket) {\n        qemuAgentUnregister(agent);\n        g_object_unref(agent->socket);\n        agent->socket = NULL;\n        agent->fd = -1;\n    }\n\n    qemuAgentNotifyCloseLocked(agent);\n    virObjectUnlock(agent);\n\n    virObjectUnref(agent);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "agent"
          ],
          "line": 797
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "agent"
          ],
          "line": 795
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentNotifyCloseLocked",
          "args": [
            "agent"
          ],
          "line": 794
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentNotifyCloseLocked",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "748-761",
          "snippet": "static void\nqemuAgentNotifyCloseLocked(qemuAgentPtr agent)\n{\n    if (agent) {\n        agent->running = false;\n\n        /* If there is somebody waiting for a message\n         * wake him up. No message will arrive anyway. */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentNotifyCloseLocked(qemuAgentPtr agent)\n{\n    if (agent) {\n        agent->running = false;\n\n        /* If there is somebody waiting for a message\n         * wake him up. No message will arrive anyway. */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_object_unref",
          "args": [
            "agent->socket"
          ],
          "line": 789
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentUnregister",
          "args": [
            "agent"
          ],
          "line": 788
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentUnregister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "534-542",
          "snippet": "static void\nqemuAgentUnregister(qemuAgentPtr agent)\n{\n    if (agent->watch) {\n        g_source_destroy(agent->watch);\n        g_source_unref(agent->watch);\n        agent->watch = NULL;\n    }\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentUnregister(qemuAgentPtr agent)\n{\n    if (agent->watch) {\n        g_source_destroy(agent->watch);\n        g_source_unref(agent->watch);\n        agent->watch = NULL;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "agent"
          ],
          "line": 785
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"agent=%p\"",
            "agent"
          ],
          "line": 783
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nvoid qemuAgentClose(qemuAgentPtr agent)\n{\n    if (!agent)\n        return;\n\n    VIR_DEBUG(\"agent=%p\", agent);\n\n    virObjectLock(agent);\n\n    if (agent->socket) {\n        qemuAgentUnregister(agent);\n        g_object_unref(agent->socket);\n        agent->socket = NULL;\n        agent->fd = -1;\n    }\n\n    qemuAgentNotifyCloseLocked(agent);\n    virObjectUnlock(agent);\n\n    virObjectUnref(agent);\n}"
  },
  {
    "function_name": "qemuAgentNotifyClose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "764-775",
    "snippet": "void\nqemuAgentNotifyClose(qemuAgentPtr agent)\n{\n    if (!agent)\n        return;\n\n    VIR_DEBUG(\"agent=%p\", agent);\n\n    virObjectLock(agent);\n    qemuAgentNotifyCloseLocked(agent);\n    virObjectUnlock(agent);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "agent"
          ],
          "line": 774
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentNotifyCloseLocked",
          "args": [
            "agent"
          ],
          "line": 773
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentNotifyCloseLocked",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "748-761",
          "snippet": "static void\nqemuAgentNotifyCloseLocked(qemuAgentPtr agent)\n{\n    if (agent) {\n        agent->running = false;\n\n        /* If there is somebody waiting for a message\n         * wake him up. No message will arrive anyway. */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentNotifyCloseLocked(qemuAgentPtr agent)\n{\n    if (agent) {\n        agent->running = false;\n\n        /* If there is somebody waiting for a message\n         * wake him up. No message will arrive anyway. */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "agent"
          ],
          "line": 772
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"agent=%p\"",
            "agent"
          ],
          "line": 770
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nvoid\nqemuAgentNotifyClose(qemuAgentPtr agent)\n{\n    if (!agent)\n        return;\n\n    VIR_DEBUG(\"agent=%p\", agent);\n\n    virObjectLock(agent);\n    qemuAgentNotifyCloseLocked(agent);\n    virObjectUnlock(agent);\n}"
  },
  {
    "function_name": "qemuAgentNotifyCloseLocked",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "748-761",
    "snippet": "static void\nqemuAgentNotifyCloseLocked(qemuAgentPtr agent)\n{\n    if (agent) {\n        agent->running = false;\n\n        /* If there is somebody waiting for a message\n         * wake him up. No message will arrive anyway. */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCondSignal",
          "args": [
            "&agent->notify"
          ],
          "line": 758
        },
        "resolved": true,
        "details": {
          "function_name": "virCondSignal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "170-173",
          "snippet": "void virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentNotifyCloseLocked(qemuAgentPtr agent)\n{\n    if (agent) {\n        agent->running = false;\n\n        /* If there is somebody waiting for a message\n         * wake him up. No message will arrive anyway. */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n}"
  },
  {
    "function_name": "qemuAgentOpen",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "674-745",
    "snippet": "qemuAgentPtr\nqemuAgentOpen(virDomainObjPtr vm,\n              const virDomainChrSourceDef *config,\n              GMainContext *context,\n              qemuAgentCallbacksPtr cb,\n              bool singleSync)\n{\n    qemuAgentPtr agent;\n    g_autoptr(GError) gerr = NULL;\n\n    if (!cb || !cb->eofNotify) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"EOF notify callback must be supplied\"));\n        return NULL;\n    }\n\n    if (qemuAgentInitialize() < 0)\n        return NULL;\n\n    if (!(agent = virObjectLockableNew(qemuAgentClass)))\n        return NULL;\n\n    agent->timeout = QEMU_DOMAIN_PRIVATE(vm)->agentTimeout;\n    agent->fd = -1;\n    if (virCondInit(&agent->notify) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"cannot initialize agent condition\"));\n        virObjectUnref(agent);\n        return NULL;\n    }\n    agent->vm = vm;\n    agent->cb = cb;\n    agent->singleSync = singleSync;\n\n    if (config->type != VIR_DOMAIN_CHR_TYPE_UNIX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to handle agent type: %s\"),\n                       virDomainChrTypeToString(config->type));\n        goto cleanup;\n    }\n\n    agent->fd = qemuAgentOpenUnix(config->data.nix.path);\n    if (agent->fd == -1)\n        goto cleanup;\n\n    agent->context = g_main_context_ref(context);\n\n    agent->socket = g_socket_new_from_fd(agent->fd, &gerr);\n    if (!agent->socket) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to create socket object: %s\"),\n                       gerr->message);\n        goto cleanup;\n    }\n\n    qemuAgentRegister(agent);\n\n    agent->running = true;\n    VIR_DEBUG(\"New agent %p fd=%d\", agent, agent->fd);\n\n    return agent;\n\n cleanup:\n    /* We don't want the 'destroy' callback invoked during\n     * cleanup from construction failure, because that can\n     * give a double-unref on virDomainObjPtr in the caller,\n     * so kill the callbacks now.\n     */\n    agent->cb = NULL;\n    qemuAgentClose(agent);\n    return NULL;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virClassPtr qemuAgentClass;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuAgentClose",
          "args": [
            "agent"
          ],
          "line": 743
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "778-798",
          "snippet": "void qemuAgentClose(qemuAgentPtr agent)\n{\n    if (!agent)\n        return;\n\n    VIR_DEBUG(\"agent=%p\", agent);\n\n    virObjectLock(agent);\n\n    if (agent->socket) {\n        qemuAgentUnregister(agent);\n        g_object_unref(agent->socket);\n        agent->socket = NULL;\n        agent->fd = -1;\n    }\n\n    qemuAgentNotifyCloseLocked(agent);\n    virObjectUnlock(agent);\n\n    virObjectUnref(agent);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nvoid qemuAgentClose(qemuAgentPtr agent)\n{\n    if (!agent)\n        return;\n\n    VIR_DEBUG(\"agent=%p\", agent);\n\n    virObjectLock(agent);\n\n    if (agent->socket) {\n        qemuAgentUnregister(agent);\n        g_object_unref(agent->socket);\n        agent->socket = NULL;\n        agent->fd = -1;\n    }\n\n    qemuAgentNotifyCloseLocked(agent);\n    virObjectUnlock(agent);\n\n    virObjectUnref(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"New agent %p fd=%d\"",
            "agent",
            "agent->fd"
          ],
          "line": 732
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentRegister",
          "args": [
            "agent"
          ],
          "line": 729
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "507-531",
          "snippet": "static void\nqemuAgentRegister(qemuAgentPtr agent)\n{\n    GIOCondition cond = 0;\n\n    if (agent->lastError.code == VIR_ERR_OK) {\n        cond |= G_IO_IN;\n\n        if (agent->msg && agent->msg->txOffset < agent->msg->txLength)\n            cond |= G_IO_OUT;\n    }\n\n    agent->watch = g_socket_create_source(agent->socket,\n                                        cond,\n                                        NULL);\n\n    virObjectRef(agent);\n    g_source_set_callback(agent->watch,\n                          (GSourceFunc)qemuAgentIO,\n                          agent,\n                          (GDestroyNotify)virObjectUnref);\n\n    g_source_attach(agent->watch,\n                    agent->context);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentRegister(qemuAgentPtr agent)\n{\n    GIOCondition cond = 0;\n\n    if (agent->lastError.code == VIR_ERR_OK) {\n        cond |= G_IO_IN;\n\n        if (agent->msg && agent->msg->txOffset < agent->msg->txLength)\n            cond |= G_IO_OUT;\n    }\n\n    agent->watch = g_socket_create_source(agent->socket,\n                                        cond,\n                                        NULL);\n\n    virObjectRef(agent);\n    g_source_set_callback(agent->watch,\n                          (GSourceFunc)qemuAgentIO,\n                          agent,\n                          (GDestroyNotify)virObjectUnref);\n\n    g_source_attach(agent->watch,\n                    agent->context);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unable to create socket object: %s\")",
            "gerr->message"
          ],
          "line": 723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to create socket object: %s\""
          ],
          "line": 724
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_socket_new_from_fd",
          "args": [
            "agent->fd",
            "&gerr"
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_main_context_ref",
          "args": [
            "context"
          ],
          "line": 719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentOpenUnix",
          "args": [
            "config->data.nix.path"
          ],
          "line": 715
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentOpenUnix",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "185-225",
          "snippet": "static int\nqemuAgentOpenUnix(const char *socketpath)\n{\n    struct sockaddr_un addr;\n    int agentfd;\n    int ret = -1;\n\n    if ((agentfd = socket(AF_UNIX, SOCK_STREAM, 0)) < 0) {\n        virReportSystemError(errno,\n                             \"%s\", _(\"failed to create socket\"));\n        return -1;\n    }\n\n    if (virSetCloseExec(agentfd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set agent \"\n                               \"close-on-exec flag\"));\n        goto error;\n    }\n\n    memset(&addr, 0, sizeof(addr));\n    addr.sun_family = AF_UNIX;\n    if (virStrcpyStatic(addr.sun_path, socketpath) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Socket path %s too big for destination\"), socketpath);\n        goto error;\n    }\n\n    ret = connect(agentfd, (struct sockaddr *)&addr, sizeof(addr));\n    if (ret < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to connect to agent socket\"));\n        goto error;\n    }\n\n    return agentfd;\n\n error:\n    VIR_FORCE_CLOSE(agentfd);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentOpenUnix(const char *socketpath)\n{\n    struct sockaddr_un addr;\n    int agentfd;\n    int ret = -1;\n\n    if ((agentfd = socket(AF_UNIX, SOCK_STREAM, 0)) < 0) {\n        virReportSystemError(errno,\n                             \"%s\", _(\"failed to create socket\"));\n        return -1;\n    }\n\n    if (virSetCloseExec(agentfd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set agent \"\n                               \"close-on-exec flag\"));\n        goto error;\n    }\n\n    memset(&addr, 0, sizeof(addr));\n    addr.sun_family = AF_UNIX;\n    if (virStrcpyStatic(addr.sun_path, socketpath) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Socket path %s too big for destination\"), socketpath);\n        goto error;\n    }\n\n    ret = connect(agentfd, (struct sockaddr *)&addr, sizeof(addr));\n    if (ret < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to connect to agent socket\"));\n        goto error;\n    }\n\n    return agentfd;\n\n error:\n    VIR_FORCE_CLOSE(agentfd);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"unable to handle agent type: %s\")",
            "virDomainChrTypeToString(config->type)"
          ],
          "line": 709
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainChrTypeToString",
          "args": [
            "config->type"
          ],
          "line": 711
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "agent"
          ],
          "line": 701
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"cannot initialize agent condition\")"
          ],
          "line": 699
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCondInit",
          "args": [
            "&agent->notify"
          ],
          "line": 698
        },
        "resolved": true,
        "details": {
          "function_name": "virCondInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "125-133",
          "snippet": "int virCondInit(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_init(&c->cond, NULL)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondInit(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_init(&c->cond, NULL)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "QEMU_DOMAIN_PRIVATE",
          "args": [
            "vm"
          ],
          "line": 696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLockableNew",
          "args": [
            "qemuAgentClass"
          ],
          "line": 693
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLockableNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "256-279",
          "snippet": "void *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nvoid *\nvirObjectLockableNew(virClassPtr klass)\n{\n    virObjectLockablePtr obj;\n\n    if (!virClassIsDerivedFrom(klass, virClassForObjectLockable())) {\n        virReportInvalidArg(klass,\n                            _(\"Class %s must derive from virObjectLockable\"),\n                            virClassName(klass));\n        return NULL;\n    }\n\n    if (!(obj = virObjectNew(klass)))\n        return NULL;\n\n    if (virMutexInit(&obj->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize mutex\"));\n        virObjectUnref(obj);\n        return NULL;\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentInitialize",
          "args": [],
          "line": 690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"EOF notify callback must be supplied\")"
          ],
          "line": 685
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic virClassPtr qemuAgentClass;\n\nqemuAgentPtr\nqemuAgentOpen(virDomainObjPtr vm,\n              const virDomainChrSourceDef *config,\n              GMainContext *context,\n              qemuAgentCallbacksPtr cb,\n              bool singleSync)\n{\n    qemuAgentPtr agent;\n    g_autoptr(GError) gerr = NULL;\n\n    if (!cb || !cb->eofNotify) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"EOF notify callback must be supplied\"));\n        return NULL;\n    }\n\n    if (qemuAgentInitialize() < 0)\n        return NULL;\n\n    if (!(agent = virObjectLockableNew(qemuAgentClass)))\n        return NULL;\n\n    agent->timeout = QEMU_DOMAIN_PRIVATE(vm)->agentTimeout;\n    agent->fd = -1;\n    if (virCondInit(&agent->notify) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"cannot initialize agent condition\"));\n        virObjectUnref(agent);\n        return NULL;\n    }\n    agent->vm = vm;\n    agent->cb = cb;\n    agent->singleSync = singleSync;\n\n    if (config->type != VIR_DOMAIN_CHR_TYPE_UNIX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"unable to handle agent type: %s\"),\n                       virDomainChrTypeToString(config->type));\n        goto cleanup;\n    }\n\n    agent->fd = qemuAgentOpenUnix(config->data.nix.path);\n    if (agent->fd == -1)\n        goto cleanup;\n\n    agent->context = g_main_context_ref(context);\n\n    agent->socket = g_socket_new_from_fd(agent->fd, &gerr);\n    if (!agent->socket) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to create socket object: %s\"),\n                       gerr->message);\n        goto cleanup;\n    }\n\n    qemuAgentRegister(agent);\n\n    agent->running = true;\n    VIR_DEBUG(\"New agent %p fd=%d\", agent, agent->fd);\n\n    return agent;\n\n cleanup:\n    /* We don't want the 'destroy' callback invoked during\n     * cleanup from construction failure, because that can\n     * give a double-unref on virDomainObjPtr in the caller,\n     * so kill the callbacks now.\n     */\n    agent->cb = NULL;\n    qemuAgentClose(agent);\n    return NULL;\n}"
  },
  {
    "function_name": "qemuAgentIO",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "553-671",
    "snippet": "static gboolean\nqemuAgentIO(GSocket *socket G_GNUC_UNUSED,\n            GIOCondition cond,\n            gpointer opaque)\n{\n    qemuAgentPtr agent = opaque;\n    bool error = false;\n    bool eof = false;\n\n    virObjectRef(agent);\n    /* lock access to the agent and protect fd */\n    virObjectLock(agent);\n#if DEBUG_IO\n    VIR_DEBUG(\"Agent %p I/O on watch %d socket %p cond %d\", agent, agent->socket, cond);\n#endif\n\n    if (agent->fd == -1 || !agent->watch) {\n        virObjectUnlock(agent);\n        virObjectUnref(agent);\n        return G_SOURCE_REMOVE;\n    }\n\n    if (agent->lastError.code != VIR_ERR_OK) {\n        if (cond & (G_IO_HUP | G_IO_ERR))\n            eof = true;\n        error = true;\n    } else {\n        if (cond & G_IO_OUT) {\n            if (qemuAgentIOWrite(agent) < 0)\n                error = true;\n        }\n\n        if (!error &&\n            cond & G_IO_IN) {\n            int got = qemuAgentIORead(agent);\n            if (got < 0) {\n                error = true;\n            } else if (got == 0) {\n                eof = true;\n            } else {\n                /* Ignore hangup/error cond if we read some data, to\n                 * give time for that data to be consumed */\n                cond = 0;\n\n                if (qemuAgentIOProcess(agent) < 0)\n                    error = true;\n            }\n        }\n\n        if (!error &&\n            cond & G_IO_HUP) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"End of file from agent socket\"));\n            eof = true;\n        }\n\n        if (!error && !eof &&\n            cond & G_IO_ERR) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Invalid file descriptor while waiting for agent\"));\n            eof = true;\n        }\n    }\n\n    if (error || eof) {\n        if (agent->lastError.code != VIR_ERR_OK) {\n            /* Already have an error, so clear any new error */\n            virResetLastError();\n        } else {\n            if (virGetLastErrorCode() == VIR_ERR_OK)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Error while processing agent IO\"));\n            virCopyLastError(&agent->lastError);\n            virResetLastError();\n        }\n\n        VIR_DEBUG(\"Error on agent %s\", NULLSTR(agent->lastError.message));\n        /* If IO process resulted in an error & we have a message,\n         * then wakeup that waiter */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n\n    qemuAgentUpdateWatch(agent);\n\n    /* We have to unlock to avoid deadlock against command thread,\n     * but is this safe ?  I think it is, because the callback\n     * will try to acquire the virDomainObjPtr mutex next */\n    if (eof) {\n        void (*eofNotify)(qemuAgentPtr, virDomainObjPtr)\n            = agent->cb->eofNotify;\n        virDomainObjPtr vm = agent->vm;\n\n        /* Make sure anyone waiting wakes up now */\n        virCondSignal(&agent->notify);\n        virObjectUnlock(agent);\n        virObjectUnref(agent);\n        VIR_DEBUG(\"Triggering EOF callback\");\n        (eofNotify)(agent, vm);\n    } else if (error) {\n        void (*errorNotify)(qemuAgentPtr, virDomainObjPtr)\n            = agent->cb->errorNotify;\n        virDomainObjPtr vm = agent->vm;\n\n        /* Make sure anyone waiting wakes up now */\n        virCondSignal(&agent->notify);\n        virObjectUnlock(agent);\n        virObjectUnref(agent);\n        VIR_DEBUG(\"Triggering error callback\");\n        (errorNotify)(agent, vm);\n    } else {\n        virObjectUnlock(agent);\n        virObjectUnref(agent);\n    }\n\n    return G_SOURCE_REMOVE;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DEBUG_IO 0"
    ],
    "globals_used": [
      "static gboolean\nqemuAgentIO(GSocket *socket,\n            GIOCondition cond,\n            gpointer opaque);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "agent"
          ],
          "line": 667
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "agent"
          ],
          "line": 666
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "agent",
            "vm"
          ],
          "line": 664
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Triggering error callback\""
          ],
          "line": 663
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCondSignal",
          "args": [
            "&agent->notify"
          ],
          "line": 660
        },
        "resolved": true,
        "details": {
          "function_name": "virCondSignal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "170-173",
          "snippet": "void virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virCondSignal(virCondPtr c)\n{\n    pthread_cond_signal(&c->cond);\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "agent",
            "vm"
          ],
          "line": 653
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Triggering EOF callback\""
          ],
          "line": 652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentUpdateWatch",
          "args": [
            "agent"
          ],
          "line": 638
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentUpdateWatch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "545-550",
          "snippet": "static void qemuAgentUpdateWatch(qemuAgentPtr agent)\n{\n    qemuAgentUnregister(agent);\n    if (agent->socket)\n        qemuAgentRegister(agent);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentUpdateWatch(qemuAgentPtr agent)\n{\n    qemuAgentUnregister(agent);\n    if (agent->socket)\n        qemuAgentRegister(agent);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Error on agent %s\"",
            "NULLSTR(agent->lastError.message)"
          ],
          "line": 629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "agent->lastError.message"
          ],
          "line": 629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 626
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCopyLastError",
          "args": [
            "&agent->lastError"
          ],
          "line": 625
        },
        "resolved": true,
        "details": {
          "function_name": "virCopyLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "370-389",
          "snippet": "int\nvirCopyLastError(virErrorPtr to)\n{\n    virErrorPtr err = virLastErrorObject();\n\n    if (!to)\n        return -1;\n\n    /* We can't guarantee caller has initialized it to zero */\n    memset(to, 0, sizeof(*to));\n    if (err) {\n        virCopyError(err, to);\n    } else {\n        virResetError(to);\n        to->code = VIR_ERR_NO_MEMORY;\n        to->domain = VIR_FROM_NONE;\n        to->level = VIR_ERR_ERROR;\n    }\n    return to->code;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirCopyLastError(virErrorPtr to)\n{\n    virErrorPtr err = virLastErrorObject();\n\n    if (!to)\n        return -1;\n\n    /* We can't guarantee caller has initialized it to zero */\n    memset(to, 0, sizeof(*to));\n    if (err) {\n        virCopyError(err, to);\n    } else {\n        virResetError(to);\n        to->code = VIR_ERR_NO_MEMORY;\n        to->domain = VIR_FROM_NONE;\n        to->level = VIR_ERR_ERROR;\n    }\n    return to->code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Error while processing agent IO\")"
          ],
          "line": 623
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Error while processing agent IO\""
          ],
          "line": 624
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetLastErrorCode",
          "args": [],
          "line": 622
        },
        "resolved": true,
        "details": {
          "function_name": "virGetLastErrorCode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "280-287",
          "snippet": "int\nvirGetLastErrorCode(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (!err)\n        return VIR_ERR_OK;\n    return err->code;\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirGetLastErrorCode(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (!err)\n        return VIR_ERR_OK;\n    return err->code;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Invalid file descriptor while waiting for agent\")"
          ],
          "line": 611
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"End of file from agent socket\")"
          ],
          "line": 604
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentIOProcess",
          "args": [
            "agent"
          ],
          "line": 597
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentIOProcess",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "366-411",
          "snippet": "static int\nqemuAgentIOProcess(qemuAgentPtr agent)\n{\n    int len;\n    qemuAgentMessagePtr msg = NULL;\n\n    /* See if there's a message ready for reply; that is,\n     * one that has completed writing all its data.\n     */\n    if (agent->msg && agent->msg->txOffset == agent->msg->txLength)\n        msg = agent->msg;\n\n#if DEBUG_IO\n# if DEBUG_RAW_IO\n    char *str1 = qemuAgentEscapeNonPrintable(msg ? msg->txBuffer : \"\");\n    char *str2 = qemuAgentEscapeNonPrintable(agent->buffer);\n    VIR_ERROR(_(\"Process %zu %p %p [[[%s]]][[[%s]]]\"),\n              agent->bufferOffset, agent->msg, msg, str1, str2);\n    VIR_FREE(str1);\n    VIR_FREE(str2);\n# else\n    VIR_DEBUG(\"Process %zu\", agent->bufferOffset);\n# endif\n#endif\n\n    len = qemuAgentIOProcessData(agent,\n                                 agent->buffer, agent->bufferOffset,\n                                 msg);\n\n    if (len < 0)\n        return -1;\n\n    if (len < agent->bufferOffset) {\n        memmove(agent->buffer, agent->buffer + len, agent->bufferOffset - len);\n        agent->bufferOffset -= len;\n    } else {\n        VIR_FREE(agent->buffer);\n        agent->bufferOffset = agent->bufferLength = 0;\n    }\n#if DEBUG_IO\n    VIR_DEBUG(\"Process done %zu used %d\", agent->bufferOffset, len);\n#endif\n    if (msg && msg->finished)\n        virCondBroadcast(&agent->notify);\n    return len;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define DEBUG_RAW_IO 0",
            "#define DEBUG_IO 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define DEBUG_RAW_IO 0\n#define DEBUG_IO 0\n\nstatic int\nqemuAgentIOProcess(qemuAgentPtr agent)\n{\n    int len;\n    qemuAgentMessagePtr msg = NULL;\n\n    /* See if there's a message ready for reply; that is,\n     * one that has completed writing all its data.\n     */\n    if (agent->msg && agent->msg->txOffset == agent->msg->txLength)\n        msg = agent->msg;\n\n#if DEBUG_IO\n# if DEBUG_RAW_IO\n    char *str1 = qemuAgentEscapeNonPrintable(msg ? msg->txBuffer : \"\");\n    char *str2 = qemuAgentEscapeNonPrintable(agent->buffer);\n    VIR_ERROR(_(\"Process %zu %p %p [[[%s]]][[[%s]]]\"),\n              agent->bufferOffset, agent->msg, msg, str1, str2);\n    VIR_FREE(str1);\n    VIR_FREE(str2);\n# else\n    VIR_DEBUG(\"Process %zu\", agent->bufferOffset);\n# endif\n#endif\n\n    len = qemuAgentIOProcessData(agent,\n                                 agent->buffer, agent->bufferOffset,\n                                 msg);\n\n    if (len < 0)\n        return -1;\n\n    if (len < agent->bufferOffset) {\n        memmove(agent->buffer, agent->buffer + len, agent->bufferOffset - len);\n        agent->bufferOffset -= len;\n    } else {\n        VIR_FREE(agent->buffer);\n        agent->bufferOffset = agent->bufferLength = 0;\n    }\n#if DEBUG_IO\n    VIR_DEBUG(\"Process done %zu used %d\", agent->bufferOffset, len);\n#endif\n    if (msg && msg->finished)\n        virCondBroadcast(&agent->notify);\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentIORead",
          "args": [
            "agent"
          ],
          "line": 587
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentIORead",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "449-498",
          "snippet": "static int\nqemuAgentIORead(qemuAgentPtr agent)\n{\n    size_t avail = agent->bufferLength - agent->bufferOffset;\n    int ret = 0;\n\n    if (avail < 1024) {\n        if (agent->bufferLength >= QEMU_AGENT_MAX_RESPONSE) {\n            virReportSystemError(ERANGE,\n                                 _(\"No complete agent response found in %d bytes\"),\n                                 QEMU_AGENT_MAX_RESPONSE);\n            return -1;\n        }\n        if (VIR_REALLOC_N(agent->buffer,\n                          agent->bufferLength + 1024) < 0)\n            return -1;\n        agent->bufferLength += 1024;\n        avail += 1024;\n    }\n\n    /* Read as much as we can get into our buffer,\n       until we block on EAGAIN, or hit EOF */\n    while (avail > 1) {\n        int got;\n        got = read(agent->fd,\n                   agent->buffer + agent->bufferOffset,\n                   avail - 1);\n        if (got < 0) {\n            if (errno == EAGAIN)\n                break;\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to read from agent\"));\n            ret = -1;\n            break;\n        }\n        if (got == 0)\n            break;\n\n        ret += got;\n        avail -= got;\n        agent->bufferOffset += got;\n        agent->buffer[agent->bufferOffset] = '\\0';\n    }\n\n#if DEBUG_IO\n    VIR_DEBUG(\"Now read %zu bytes of data\", agent->bufferOffset);\n#endif\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define QEMU_AGENT_MAX_RESPONSE (10 * 1024 * 1024)",
            "#define DEBUG_IO 0"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define QEMU_AGENT_MAX_RESPONSE (10 * 1024 * 1024)\n#define DEBUG_IO 0\n\nstatic int\nqemuAgentIORead(qemuAgentPtr agent)\n{\n    size_t avail = agent->bufferLength - agent->bufferOffset;\n    int ret = 0;\n\n    if (avail < 1024) {\n        if (agent->bufferLength >= QEMU_AGENT_MAX_RESPONSE) {\n            virReportSystemError(ERANGE,\n                                 _(\"No complete agent response found in %d bytes\"),\n                                 QEMU_AGENT_MAX_RESPONSE);\n            return -1;\n        }\n        if (VIR_REALLOC_N(agent->buffer,\n                          agent->bufferLength + 1024) < 0)\n            return -1;\n        agent->bufferLength += 1024;\n        avail += 1024;\n    }\n\n    /* Read as much as we can get into our buffer,\n       until we block on EAGAIN, or hit EOF */\n    while (avail > 1) {\n        int got;\n        got = read(agent->fd,\n                   agent->buffer + agent->bufferOffset,\n                   avail - 1);\n        if (got < 0) {\n            if (errno == EAGAIN)\n                break;\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to read from agent\"));\n            ret = -1;\n            break;\n        }\n        if (got == 0)\n            break;\n\n        ret += got;\n        avail -= got;\n        agent->bufferOffset += got;\n        agent->buffer[agent->bufferOffset] = '\\0';\n    }\n\n#if DEBUG_IO\n    VIR_DEBUG(\"Now read %zu bytes of data\", agent->bufferOffset);\n#endif\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentIOWrite",
          "args": [
            "agent"
          ],
          "line": 581
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentIOWrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "418-441",
          "snippet": "static int\nqemuAgentIOWrite(qemuAgentPtr agent)\n{\n    int done;\n\n    /* If no active message, or fully transmitted, then no-op */\n    if (!agent->msg || agent->msg->txOffset == agent->msg->txLength)\n        return 0;\n\n    done = safewrite(agent->fd,\n                     agent->msg->txBuffer + agent->msg->txOffset,\n                     agent->msg->txLength - agent->msg->txOffset);\n\n    if (done < 0) {\n        if (errno == EAGAIN)\n            return 0;\n\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to write to agent\"));\n        return -1;\n    }\n    agent->msg->txOffset += done;\n    return done;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentIOWrite(qemuAgentPtr agent)\n{\n    int done;\n\n    /* If no active message, or fully transmitted, then no-op */\n    if (!agent->msg || agent->msg->txOffset == agent->msg->txLength)\n        return 0;\n\n    done = safewrite(agent->fd,\n                     agent->msg->txBuffer + agent->msg->txOffset,\n                     agent->msg->txLength - agent->msg->txOffset);\n\n    if (done < 0) {\n        if (errno == EAGAIN)\n            return 0;\n\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to write to agent\"));\n        return -1;\n    }\n    agent->msg->txOffset += done;\n    return done;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Agent %p I/O on watch %d socket %p cond %d\"",
            "agent",
            "agent->socket",
            "cond"
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "agent"
          ],
          "line": 564
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectRef",
          "args": [
            "agent"
          ],
          "line": 562
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectRef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "377-387",
          "snippet": "void *\nvirObjectRef(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return NULL;\n    g_atomic_int_add(&obj->u.s.refs, 1);\n    PROBE(OBJECT_REF, \"obj=%p\", obj);\n    return anyobj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid *\nvirObjectRef(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return NULL;\n    g_atomic_int_add(&obj->u.s.refs, 1);\n    PROBE(OBJECT_REF, \"obj=%p\", obj);\n    return anyobj;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define DEBUG_IO 0\n\nstatic gboolean\nqemuAgentIO(GSocket *socket,\n            GIOCondition cond,\n            gpointer opaque);\n\nstatic gboolean\nqemuAgentIO(GSocket *socket G_GNUC_UNUSED,\n            GIOCondition cond,\n            gpointer opaque)\n{\n    qemuAgentPtr agent = opaque;\n    bool error = false;\n    bool eof = false;\n\n    virObjectRef(agent);\n    /* lock access to the agent and protect fd */\n    virObjectLock(agent);\n#if DEBUG_IO\n    VIR_DEBUG(\"Agent %p I/O on watch %d socket %p cond %d\", agent, agent->socket, cond);\n#endif\n\n    if (agent->fd == -1 || !agent->watch) {\n        virObjectUnlock(agent);\n        virObjectUnref(agent);\n        return G_SOURCE_REMOVE;\n    }\n\n    if (agent->lastError.code != VIR_ERR_OK) {\n        if (cond & (G_IO_HUP | G_IO_ERR))\n            eof = true;\n        error = true;\n    } else {\n        if (cond & G_IO_OUT) {\n            if (qemuAgentIOWrite(agent) < 0)\n                error = true;\n        }\n\n        if (!error &&\n            cond & G_IO_IN) {\n            int got = qemuAgentIORead(agent);\n            if (got < 0) {\n                error = true;\n            } else if (got == 0) {\n                eof = true;\n            } else {\n                /* Ignore hangup/error cond if we read some data, to\n                 * give time for that data to be consumed */\n                cond = 0;\n\n                if (qemuAgentIOProcess(agent) < 0)\n                    error = true;\n            }\n        }\n\n        if (!error &&\n            cond & G_IO_HUP) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"End of file from agent socket\"));\n            eof = true;\n        }\n\n        if (!error && !eof &&\n            cond & G_IO_ERR) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Invalid file descriptor while waiting for agent\"));\n            eof = true;\n        }\n    }\n\n    if (error || eof) {\n        if (agent->lastError.code != VIR_ERR_OK) {\n            /* Already have an error, so clear any new error */\n            virResetLastError();\n        } else {\n            if (virGetLastErrorCode() == VIR_ERR_OK)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Error while processing agent IO\"));\n            virCopyLastError(&agent->lastError);\n            virResetLastError();\n        }\n\n        VIR_DEBUG(\"Error on agent %s\", NULLSTR(agent->lastError.message));\n        /* If IO process resulted in an error & we have a message,\n         * then wakeup that waiter */\n        if (agent->msg && !agent->msg->finished) {\n            agent->msg->finished = 1;\n            virCondSignal(&agent->notify);\n        }\n    }\n\n    qemuAgentUpdateWatch(agent);\n\n    /* We have to unlock to avoid deadlock against command thread,\n     * but is this safe ?  I think it is, because the callback\n     * will try to acquire the virDomainObjPtr mutex next */\n    if (eof) {\n        void (*eofNotify)(qemuAgentPtr, virDomainObjPtr)\n            = agent->cb->eofNotify;\n        virDomainObjPtr vm = agent->vm;\n\n        /* Make sure anyone waiting wakes up now */\n        virCondSignal(&agent->notify);\n        virObjectUnlock(agent);\n        virObjectUnref(agent);\n        VIR_DEBUG(\"Triggering EOF callback\");\n        (eofNotify)(agent, vm);\n    } else if (error) {\n        void (*errorNotify)(qemuAgentPtr, virDomainObjPtr)\n            = agent->cb->errorNotify;\n        virDomainObjPtr vm = agent->vm;\n\n        /* Make sure anyone waiting wakes up now */\n        virCondSignal(&agent->notify);\n        virObjectUnlock(agent);\n        virObjectUnref(agent);\n        VIR_DEBUG(\"Triggering error callback\");\n        (errorNotify)(agent, vm);\n    } else {\n        virObjectUnlock(agent);\n        virObjectUnref(agent);\n    }\n\n    return G_SOURCE_REMOVE;\n}"
  },
  {
    "function_name": "qemuAgentUpdateWatch",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "545-550",
    "snippet": "static void qemuAgentUpdateWatch(qemuAgentPtr agent)\n{\n    qemuAgentUnregister(agent);\n    if (agent->socket)\n        qemuAgentRegister(agent);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "qemuAgentRegister",
          "args": [
            "agent"
          ],
          "line": 549
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "507-531",
          "snippet": "static void\nqemuAgentRegister(qemuAgentPtr agent)\n{\n    GIOCondition cond = 0;\n\n    if (agent->lastError.code == VIR_ERR_OK) {\n        cond |= G_IO_IN;\n\n        if (agent->msg && agent->msg->txOffset < agent->msg->txLength)\n            cond |= G_IO_OUT;\n    }\n\n    agent->watch = g_socket_create_source(agent->socket,\n                                        cond,\n                                        NULL);\n\n    virObjectRef(agent);\n    g_source_set_callback(agent->watch,\n                          (GSourceFunc)qemuAgentIO,\n                          agent,\n                          (GDestroyNotify)virObjectUnref);\n\n    g_source_attach(agent->watch,\n                    agent->context);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentRegister(qemuAgentPtr agent)\n{\n    GIOCondition cond = 0;\n\n    if (agent->lastError.code == VIR_ERR_OK) {\n        cond |= G_IO_IN;\n\n        if (agent->msg && agent->msg->txOffset < agent->msg->txLength)\n            cond |= G_IO_OUT;\n    }\n\n    agent->watch = g_socket_create_source(agent->socket,\n                                        cond,\n                                        NULL);\n\n    virObjectRef(agent);\n    g_source_set_callback(agent->watch,\n                          (GSourceFunc)qemuAgentIO,\n                          agent,\n                          (GDestroyNotify)virObjectUnref);\n\n    g_source_attach(agent->watch,\n                    agent->context);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentUnregister",
          "args": [
            "agent"
          ],
          "line": 547
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentUnregister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "534-542",
          "snippet": "static void\nqemuAgentUnregister(qemuAgentPtr agent)\n{\n    if (agent->watch) {\n        g_source_destroy(agent->watch);\n        g_source_unref(agent->watch);\n        agent->watch = NULL;\n    }\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentUnregister(qemuAgentPtr agent)\n{\n    if (agent->watch) {\n        g_source_destroy(agent->watch);\n        g_source_unref(agent->watch);\n        agent->watch = NULL;\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentUpdateWatch(qemuAgentPtr agent)\n{\n    qemuAgentUnregister(agent);\n    if (agent->socket)\n        qemuAgentRegister(agent);\n}"
  },
  {
    "function_name": "qemuAgentUnregister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "534-542",
    "snippet": "static void\nqemuAgentUnregister(qemuAgentPtr agent)\n{\n    if (agent->watch) {\n        g_source_destroy(agent->watch);\n        g_source_unref(agent->watch);\n        agent->watch = NULL;\n    }\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_source_unref",
          "args": [
            "agent->watch"
          ],
          "line": 539
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_destroy",
          "args": [
            "agent->watch"
          ],
          "line": 538
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentUnregister(qemuAgentPtr agent)\n{\n    if (agent->watch) {\n        g_source_destroy(agent->watch);\n        g_source_unref(agent->watch);\n        agent->watch = NULL;\n    }\n}"
  },
  {
    "function_name": "qemuAgentRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "507-531",
    "snippet": "static void\nqemuAgentRegister(qemuAgentPtr agent)\n{\n    GIOCondition cond = 0;\n\n    if (agent->lastError.code == VIR_ERR_OK) {\n        cond |= G_IO_IN;\n\n        if (agent->msg && agent->msg->txOffset < agent->msg->txLength)\n            cond |= G_IO_OUT;\n    }\n\n    agent->watch = g_socket_create_source(agent->socket,\n                                        cond,\n                                        NULL);\n\n    virObjectRef(agent);\n    g_source_set_callback(agent->watch,\n                          (GSourceFunc)qemuAgentIO,\n                          agent,\n                          (GDestroyNotify)virObjectUnref);\n\n    g_source_attach(agent->watch,\n                    agent->context);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_source_attach",
          "args": [
            "agent->watch",
            "agent->context"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_source_set_callback",
          "args": [
            "agent->watch",
            "(GSourceFunc)qemuAgentIO",
            "agent",
            "(GDestroyNotify)virObjectUnref"
          ],
          "line": 524
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virObjectRef",
          "args": [
            "agent"
          ],
          "line": 523
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectRef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "377-387",
          "snippet": "void *\nvirObjectRef(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return NULL;\n    g_atomic_int_add(&obj->u.s.refs, 1);\n    PROBE(OBJECT_REF, \"obj=%p\", obj);\n    return anyobj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid *\nvirObjectRef(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return NULL;\n    g_atomic_int_add(&obj->u.s.refs, 1);\n    PROBE(OBJECT_REF, \"obj=%p\", obj);\n    return anyobj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_socket_create_source",
          "args": [
            "agent->socket",
            "cond",
            "NULL"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void\nqemuAgentRegister(qemuAgentPtr agent)\n{\n    GIOCondition cond = 0;\n\n    if (agent->lastError.code == VIR_ERR_OK) {\n        cond |= G_IO_IN;\n\n        if (agent->msg && agent->msg->txOffset < agent->msg->txLength)\n            cond |= G_IO_OUT;\n    }\n\n    agent->watch = g_socket_create_source(agent->socket,\n                                        cond,\n                                        NULL);\n\n    virObjectRef(agent);\n    g_source_set_callback(agent->watch,\n                          (GSourceFunc)qemuAgentIO,\n                          agent,\n                          (GDestroyNotify)virObjectUnref);\n\n    g_source_attach(agent->watch,\n                    agent->context);\n}"
  },
  {
    "function_name": "qemuAgentIORead",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "449-498",
    "snippet": "static int\nqemuAgentIORead(qemuAgentPtr agent)\n{\n    size_t avail = agent->bufferLength - agent->bufferOffset;\n    int ret = 0;\n\n    if (avail < 1024) {\n        if (agent->bufferLength >= QEMU_AGENT_MAX_RESPONSE) {\n            virReportSystemError(ERANGE,\n                                 _(\"No complete agent response found in %d bytes\"),\n                                 QEMU_AGENT_MAX_RESPONSE);\n            return -1;\n        }\n        if (VIR_REALLOC_N(agent->buffer,\n                          agent->bufferLength + 1024) < 0)\n            return -1;\n        agent->bufferLength += 1024;\n        avail += 1024;\n    }\n\n    /* Read as much as we can get into our buffer,\n       until we block on EAGAIN, or hit EOF */\n    while (avail > 1) {\n        int got;\n        got = read(agent->fd,\n                   agent->buffer + agent->bufferOffset,\n                   avail - 1);\n        if (got < 0) {\n            if (errno == EAGAIN)\n                break;\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to read from agent\"));\n            ret = -1;\n            break;\n        }\n        if (got == 0)\n            break;\n\n        ret += got;\n        avail -= got;\n        agent->bufferOffset += got;\n        agent->buffer[agent->bufferOffset] = '\\0';\n    }\n\n#if DEBUG_IO\n    VIR_DEBUG(\"Now read %zu bytes of data\", agent->bufferOffset);\n#endif\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define QEMU_AGENT_MAX_RESPONSE (10 * 1024 * 1024)",
      "#define DEBUG_IO 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Now read %zu bytes of data\"",
            "agent->bufferOffset"
          ],
          "line": 494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to read from agent\")"
          ],
          "line": 479
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to read from agent\""
          ],
          "line": 480
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "read",
          "args": [
            "agent->fd",
            "agent->buffer + agent->bufferOffset",
            "avail - 1"
          ],
          "line": 473
        },
        "resolved": true,
        "details": {
          "function_name": "qemuProcessDetectIOThreadPIDs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_process.c",
          "lines": "2434-2495",
          "snippet": "static int\nqemuProcessDetectIOThreadPIDs(virQEMUDriverPtr driver,\n                              virDomainObjPtr vm,\n                              int asyncJob)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    qemuMonitorIOThreadInfoPtr *iothreads = NULL;\n    int niothreads = 0;\n    int ret = -1;\n    size_t i;\n\n    if (!virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_OBJECT_IOTHREAD)) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    /* Get the list of IOThreads from qemu */\n    if (qemuDomainObjEnterMonitorAsync(driver, vm, asyncJob) < 0)\n        goto cleanup;\n    niothreads = qemuMonitorGetIOThreads(priv->mon, &iothreads);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        goto cleanup;\n    if (niothreads < 0)\n        goto cleanup;\n\n    if (niothreads != vm->def->niothreadids) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"got wrong number of IOThread pids from QEMU monitor. \"\n                         \"got %d, wanted %zu\"),\n                       niothreads, vm->def->niothreadids);\n        goto cleanup;\n    }\n\n    /* Nothing to do */\n    if (niothreads == 0) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    for (i = 0; i < niothreads; i++) {\n        virDomainIOThreadIDDefPtr iothrid;\n\n        if (!(iothrid = virDomainIOThreadIDFind(vm->def,\n                                                iothreads[i]->iothread_id))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"iothread %d not found\"),\n                           iothreads[i]->iothread_id);\n            goto cleanup;\n        }\n        iothrid->thread_id = iothreads[i]->thread_id;\n    }\n\n    ret = 0;\n\n cleanup:\n    if (iothreads) {\n        for (i = 0; i < niothreads; i++)\n            VIR_FREE(iothreads[i]);\n        VIR_FREE(iothreads);\n    }\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virthreadjob.h\"",
            "#include \"viridentity.h\"",
            "#include \"virvsock.h\"",
            "#include \"virresctrl.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"configmake.h\"",
            "#include \"virsecret.h\"",
            "#include \"virhostdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virnuma.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virnetdevmidonet.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"viruuid.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"domain_audit.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virhook.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"cpu/cpu_x86.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_firmware.h\"",
            "#include \"qemu_extdevice.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_interface.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_domain_address.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_processpriv.h\"",
            "#include \"qemu_process.h\"",
            "# include <cap-ng.h>",
            "#include <sys/utsname.h>",
            "# include <sys/cpuset.h>",
            "# include <sys/param.h>",
            "# include <linux/capability.h>",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virthreadjob.h\"\n#include \"viridentity.h\"\n#include \"virvsock.h\"\n#include \"virresctrl.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"nwfilter_conf.h\"\n#include \"configmake.h\"\n#include \"virsecret.h\"\n#include \"virhostdev.h\"\n#include \"virstring.h\"\n#include \"virnuma.h\"\n#include \"virbitmap.h\"\n#include \"virnetdevmidonet.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"viruuid.h\"\n#include \"locking/domain_lock.h\"\n#include \"domain_nwfilter.h\"\n#include \"domain_audit.h\"\n#include \"virhostcpu.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virhook.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"cpu/cpu_x86.h\"\n#include \"cpu/cpu.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_firmware.h\"\n#include \"qemu_extdevice.h\"\n#include \"qemu_security.h\"\n#include \"qemu_interface.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_command.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_domain_address.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_processpriv.h\"\n#include \"qemu_process.h\"\n# include <cap-ng.h>\n#include <sys/utsname.h>\n# include <sys/cpuset.h>\n# include <sys/param.h>\n# include <linux/capability.h>\n#include <sys/stat.h>\n#include <signal.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int\nqemuProcessDetectIOThreadPIDs(virQEMUDriverPtr driver,\n                              virDomainObjPtr vm,\n                              int asyncJob)\n{\n    qemuDomainObjPrivatePtr priv = vm->privateData;\n    qemuMonitorIOThreadInfoPtr *iothreads = NULL;\n    int niothreads = 0;\n    int ret = -1;\n    size_t i;\n\n    if (!virQEMUCapsGet(priv->qemuCaps, QEMU_CAPS_OBJECT_IOTHREAD)) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    /* Get the list of IOThreads from qemu */\n    if (qemuDomainObjEnterMonitorAsync(driver, vm, asyncJob) < 0)\n        goto cleanup;\n    niothreads = qemuMonitorGetIOThreads(priv->mon, &iothreads);\n    if (qemuDomainObjExitMonitor(driver, vm) < 0)\n        goto cleanup;\n    if (niothreads < 0)\n        goto cleanup;\n\n    if (niothreads != vm->def->niothreadids) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"got wrong number of IOThread pids from QEMU monitor. \"\n                         \"got %d, wanted %zu\"),\n                       niothreads, vm->def->niothreadids);\n        goto cleanup;\n    }\n\n    /* Nothing to do */\n    if (niothreads == 0) {\n        ret = 0;\n        goto cleanup;\n    }\n\n    for (i = 0; i < niothreads; i++) {\n        virDomainIOThreadIDDefPtr iothrid;\n\n        if (!(iothrid = virDomainIOThreadIDFind(vm->def,\n                                                iothreads[i]->iothread_id))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"iothread %d not found\"),\n                           iothreads[i]->iothread_id);\n            goto cleanup;\n        }\n        iothrid->thread_id = iothreads[i]->thread_id;\n    }\n\n    ret = 0;\n\n cleanup:\n    if (iothreads) {\n        for (i = 0; i < niothreads; i++)\n            VIR_FREE(iothreads[i]);\n        VIR_FREE(iothreads);\n    }\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_REALLOC_N",
          "args": [
            "agent->buffer",
            "agent->bufferLength + 1024"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ERANGE",
            "_(\"No complete agent response found in %d bytes\")",
            "QEMU_AGENT_MAX_RESPONSE"
          ],
          "line": 457
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define QEMU_AGENT_MAX_RESPONSE (10 * 1024 * 1024)\n#define DEBUG_IO 0\n\nstatic int\nqemuAgentIORead(qemuAgentPtr agent)\n{\n    size_t avail = agent->bufferLength - agent->bufferOffset;\n    int ret = 0;\n\n    if (avail < 1024) {\n        if (agent->bufferLength >= QEMU_AGENT_MAX_RESPONSE) {\n            virReportSystemError(ERANGE,\n                                 _(\"No complete agent response found in %d bytes\"),\n                                 QEMU_AGENT_MAX_RESPONSE);\n            return -1;\n        }\n        if (VIR_REALLOC_N(agent->buffer,\n                          agent->bufferLength + 1024) < 0)\n            return -1;\n        agent->bufferLength += 1024;\n        avail += 1024;\n    }\n\n    /* Read as much as we can get into our buffer,\n       until we block on EAGAIN, or hit EOF */\n    while (avail > 1) {\n        int got;\n        got = read(agent->fd,\n                   agent->buffer + agent->bufferOffset,\n                   avail - 1);\n        if (got < 0) {\n            if (errno == EAGAIN)\n                break;\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Unable to read from agent\"));\n            ret = -1;\n            break;\n        }\n        if (got == 0)\n            break;\n\n        ret += got;\n        avail -= got;\n        agent->bufferOffset += got;\n        agent->buffer[agent->bufferOffset] = '\\0';\n    }\n\n#if DEBUG_IO\n    VIR_DEBUG(\"Now read %zu bytes of data\", agent->bufferOffset);\n#endif\n\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentIOWrite",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "418-441",
    "snippet": "static int\nqemuAgentIOWrite(qemuAgentPtr agent)\n{\n    int done;\n\n    /* If no active message, or fully transmitted, then no-op */\n    if (!agent->msg || agent->msg->txOffset == agent->msg->txLength)\n        return 0;\n\n    done = safewrite(agent->fd,\n                     agent->msg->txBuffer + agent->msg->txOffset,\n                     agent->msg->txLength - agent->msg->txOffset);\n\n    if (done < 0) {\n        if (errno == EAGAIN)\n            return 0;\n\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to write to agent\"));\n        return -1;\n    }\n    agent->msg->txOffset += done;\n    return done;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to write to agent\")"
          ],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to write to agent\""
          ],
          "line": 436
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "safewrite",
          "args": [
            "agent->fd",
            "agent->msg->txBuffer + agent->msg->txOffset",
            "agent->msg->txLength - agent->msg->txOffset"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "safewrite",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1093-1111",
          "snippet": "ssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nssize_t\nsafewrite(int fd, const void *buf, size_t count)\n{\n    size_t nwritten = 0;\n    while (count > 0) {\n        ssize_t r = write(fd, buf, count);\n\n        if (r < 0 && errno == EINTR)\n            continue;\n        if (r < 0)\n            return r;\n        if (r == 0)\n            return nwritten;\n        buf = (const char *)buf + r;\n        count -= r;\n        nwritten += r;\n    }\n    return nwritten;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentIOWrite(qemuAgentPtr agent)\n{\n    int done;\n\n    /* If no active message, or fully transmitted, then no-op */\n    if (!agent->msg || agent->msg->txOffset == agent->msg->txLength)\n        return 0;\n\n    done = safewrite(agent->fd,\n                     agent->msg->txBuffer + agent->msg->txOffset,\n                     agent->msg->txLength - agent->msg->txOffset);\n\n    if (done < 0) {\n        if (errno == EAGAIN)\n            return 0;\n\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to write to agent\"));\n        return -1;\n    }\n    agent->msg->txOffset += done;\n    return done;\n}"
  },
  {
    "function_name": "qemuAgentIOProcess",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "366-411",
    "snippet": "static int\nqemuAgentIOProcess(qemuAgentPtr agent)\n{\n    int len;\n    qemuAgentMessagePtr msg = NULL;\n\n    /* See if there's a message ready for reply; that is,\n     * one that has completed writing all its data.\n     */\n    if (agent->msg && agent->msg->txOffset == agent->msg->txLength)\n        msg = agent->msg;\n\n#if DEBUG_IO\n# if DEBUG_RAW_IO\n    char *str1 = qemuAgentEscapeNonPrintable(msg ? msg->txBuffer : \"\");\n    char *str2 = qemuAgentEscapeNonPrintable(agent->buffer);\n    VIR_ERROR(_(\"Process %zu %p %p [[[%s]]][[[%s]]]\"),\n              agent->bufferOffset, agent->msg, msg, str1, str2);\n    VIR_FREE(str1);\n    VIR_FREE(str2);\n# else\n    VIR_DEBUG(\"Process %zu\", agent->bufferOffset);\n# endif\n#endif\n\n    len = qemuAgentIOProcessData(agent,\n                                 agent->buffer, agent->bufferOffset,\n                                 msg);\n\n    if (len < 0)\n        return -1;\n\n    if (len < agent->bufferOffset) {\n        memmove(agent->buffer, agent->buffer + len, agent->bufferOffset - len);\n        agent->bufferOffset -= len;\n    } else {\n        VIR_FREE(agent->buffer);\n        agent->bufferOffset = agent->bufferLength = 0;\n    }\n#if DEBUG_IO\n    VIR_DEBUG(\"Process done %zu used %d\", agent->bufferOffset, len);\n#endif\n    if (msg && msg->finished)\n        virCondBroadcast(&agent->notify);\n    return len;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DEBUG_RAW_IO 0",
      "#define DEBUG_IO 0"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCondBroadcast",
          "args": [
            "&agent->notify"
          ],
          "line": 409
        },
        "resolved": true,
        "details": {
          "function_name": "virCondBroadcast",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "175-178",
          "snippet": "void virCondBroadcast(virCondPtr c)\n{\n    pthread_cond_broadcast(&c->cond);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virCondBroadcast(virCondPtr c)\n{\n    pthread_cond_broadcast(&c->cond);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Process done %zu used %d\"",
            "agent->bufferOffset",
            "len"
          ],
          "line": 406
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "agent->buffer"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memmove",
          "args": [
            "agent->buffer",
            "agent->buffer + len",
            "agent->bufferOffset - len"
          ],
          "line": 399
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentIOProcessData",
          "args": [
            "agent",
            "agent->buffer",
            "agent->bufferOffset",
            "msg"
          ],
          "line": 391
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentIOProcessData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "326-360",
          "snippet": "static int qemuAgentIOProcessData(qemuAgentPtr agent,\n                                  char *data,\n                                  size_t len,\n                                  qemuAgentMessagePtr msg)\n{\n    int used = 0;\n    size_t i = 0;\n#if DEBUG_IO\n# if DEBUG_RAW_IO\n    char *str1 = qemuAgentEscapeNonPrintable(data);\n    VIR_ERROR(_(\"[%s]\"), str1);\n    VIR_FREE(str1);\n# else\n    VIR_DEBUG(\"Data %zu bytes [%s]\", len, data);\n# endif\n#endif\n\n    while (used < len) {\n        char *nl = strstr(data + used, LINE_ENDING);\n\n        if (nl) {\n            int got = nl - (data + used);\n            for (i = 0; i < strlen(LINE_ENDING); i++)\n                data[used + got + i] = '\\0';\n            if (qemuAgentIOProcessLine(agent, data + used, msg) < 0)\n                return -1;\n            used += got + strlen(LINE_ENDING);\n        } else {\n            break;\n        }\n    }\n\n    VIR_DEBUG(\"Total used %d bytes out of %zd available in buffer\", used, len);\n    return used;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define DEBUG_RAW_IO 0",
            "#define DEBUG_IO 0",
            "#define LINE_ENDING \"\\n\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define DEBUG_RAW_IO 0\n#define DEBUG_IO 0\n#define LINE_ENDING \"\\n\"\n\nstatic int qemuAgentIOProcessData(qemuAgentPtr agent,\n                                  char *data,\n                                  size_t len,\n                                  qemuAgentMessagePtr msg)\n{\n    int used = 0;\n    size_t i = 0;\n#if DEBUG_IO\n# if DEBUG_RAW_IO\n    char *str1 = qemuAgentEscapeNonPrintable(data);\n    VIR_ERROR(_(\"[%s]\"), str1);\n    VIR_FREE(str1);\n# else\n    VIR_DEBUG(\"Data %zu bytes [%s]\", len, data);\n# endif\n#endif\n\n    while (used < len) {\n        char *nl = strstr(data + used, LINE_ENDING);\n\n        if (nl) {\n            int got = nl - (data + used);\n            for (i = 0; i < strlen(LINE_ENDING); i++)\n                data[used + got + i] = '\\0';\n            if (qemuAgentIOProcessLine(agent, data + used, msg) < 0)\n                return -1;\n            used += got + strlen(LINE_ENDING);\n        } else {\n            break;\n        }\n    }\n\n    VIR_DEBUG(\"Total used %d bytes out of %zd available in buffer\", used, len);\n    return used;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Process %zu\"",
            "agent->bufferOffset"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "str2"
          ],
          "line": 385
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "str1"
          ],
          "line": 384
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"Process %zu %p %p [[[%s]]][[[%s]]]\")",
            "agent->bufferOffset",
            "agent->msg",
            "msg",
            "str1",
            "str2"
          ],
          "line": 382
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Process %zu %p %p [[[%s]]][[[%s]]]\""
          ],
          "line": 382
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentEscapeNonPrintable",
          "args": [
            "agent->buffer"
          ],
          "line": 381
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentEscapeNonPrintable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "154-169",
          "snippet": "static char *\nqemuAgentEscapeNonPrintable(const char *text)\n{\n    size_t i;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    for (i = 0; text[i] != '\\0'; i++) {\n        if (text[i] == '\\\\')\n            virBufferAddLit(&buf, \"\\\\\\\\\");\n        else if (g_ascii_isprint(text[i]) || text[i] == '\\n' ||\n                 (text[i] == '\\r' && text[i+1] == '\\n'))\n            virBufferAddChar(&buf, text[i]);\n        else\n            virBufferAsprintf(&buf, \"\\\\x%02x\", text[i]);\n    }\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic char *\nqemuAgentEscapeNonPrintable(const char *text)\n{\n    size_t i;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    for (i = 0; text[i] != '\\0'; i++) {\n        if (text[i] == '\\\\')\n            virBufferAddLit(&buf, \"\\\\\\\\\");\n        else if (g_ascii_isprint(text[i]) || text[i] == '\\n' ||\n                 (text[i] == '\\r' && text[i+1] == '\\n'))\n            virBufferAddChar(&buf, text[i]);\n        else\n            virBufferAsprintf(&buf, \"\\\\x%02x\", text[i]);\n    }\n    return virBufferContentAndReset(&buf);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define DEBUG_RAW_IO 0\n#define DEBUG_IO 0\n\nstatic int\nqemuAgentIOProcess(qemuAgentPtr agent)\n{\n    int len;\n    qemuAgentMessagePtr msg = NULL;\n\n    /* See if there's a message ready for reply; that is,\n     * one that has completed writing all its data.\n     */\n    if (agent->msg && agent->msg->txOffset == agent->msg->txLength)\n        msg = agent->msg;\n\n#if DEBUG_IO\n# if DEBUG_RAW_IO\n    char *str1 = qemuAgentEscapeNonPrintable(msg ? msg->txBuffer : \"\");\n    char *str2 = qemuAgentEscapeNonPrintable(agent->buffer);\n    VIR_ERROR(_(\"Process %zu %p %p [[[%s]]][[[%s]]]\"),\n              agent->bufferOffset, agent->msg, msg, str1, str2);\n    VIR_FREE(str1);\n    VIR_FREE(str2);\n# else\n    VIR_DEBUG(\"Process %zu\", agent->bufferOffset);\n# endif\n#endif\n\n    len = qemuAgentIOProcessData(agent,\n                                 agent->buffer, agent->bufferOffset,\n                                 msg);\n\n    if (len < 0)\n        return -1;\n\n    if (len < agent->bufferOffset) {\n        memmove(agent->buffer, agent->buffer + len, agent->bufferOffset - len);\n        agent->bufferOffset -= len;\n    } else {\n        VIR_FREE(agent->buffer);\n        agent->bufferOffset = agent->bufferLength = 0;\n    }\n#if DEBUG_IO\n    VIR_DEBUG(\"Process done %zu used %d\", agent->bufferOffset, len);\n#endif\n    if (msg && msg->finished)\n        virCondBroadcast(&agent->notify);\n    return len;\n}"
  },
  {
    "function_name": "qemuAgentIOProcessData",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "326-360",
    "snippet": "static int qemuAgentIOProcessData(qemuAgentPtr agent,\n                                  char *data,\n                                  size_t len,\n                                  qemuAgentMessagePtr msg)\n{\n    int used = 0;\n    size_t i = 0;\n#if DEBUG_IO\n# if DEBUG_RAW_IO\n    char *str1 = qemuAgentEscapeNonPrintable(data);\n    VIR_ERROR(_(\"[%s]\"), str1);\n    VIR_FREE(str1);\n# else\n    VIR_DEBUG(\"Data %zu bytes [%s]\", len, data);\n# endif\n#endif\n\n    while (used < len) {\n        char *nl = strstr(data + used, LINE_ENDING);\n\n        if (nl) {\n            int got = nl - (data + used);\n            for (i = 0; i < strlen(LINE_ENDING); i++)\n                data[used + got + i] = '\\0';\n            if (qemuAgentIOProcessLine(agent, data + used, msg) < 0)\n                return -1;\n            used += got + strlen(LINE_ENDING);\n        } else {\n            break;\n        }\n    }\n\n    VIR_DEBUG(\"Total used %d bytes out of %zd available in buffer\", used, len);\n    return used;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define DEBUG_RAW_IO 0",
      "#define DEBUG_IO 0",
      "#define LINE_ENDING \"\\n\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Total used %d bytes out of %zd available in buffer\"",
            "used",
            "len"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "LINE_ENDING"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qemuAgentIOProcessLine",
          "args": [
            "agent",
            "data + used",
            "msg"
          ],
          "line": 350
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentIOProcessLine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "256-324",
          "snippet": "static int\nqemuAgentIOProcessLine(qemuAgentPtr agent,\n                       const char *line,\n                       qemuAgentMessagePtr msg)\n{\n    virJSONValuePtr obj = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Line [%s]\", line);\n\n    if (!(obj = virJSONValueFromString(line))) {\n        /* receiving garbage on first sync is regular situation */\n        if (msg && msg->sync && msg->first) {\n            VIR_DEBUG(\"Received garbage on sync\");\n            msg->finished = 1;\n            return 0;\n        }\n\n        goto cleanup;\n    }\n\n    if (virJSONValueGetType(obj) != VIR_JSON_TYPE_OBJECT) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Parsed JSON reply '%s' isn't an object\"), line);\n        goto cleanup;\n    }\n\n    if (virJSONValueObjectHasKey(obj, \"QMP\") == 1) {\n        ret = 0;\n    } else if (virJSONValueObjectHasKey(obj, \"event\") == 1) {\n        ret = qemuAgentIOProcessEvent(agent, obj);\n    } else if (virJSONValueObjectHasKey(obj, \"error\") == 1 ||\n               virJSONValueObjectHasKey(obj, \"return\") == 1) {\n        if (msg) {\n            if (msg->sync) {\n                unsigned long long id;\n\n                if (virJSONValueObjectGetNumberUlong(obj, \"return\", &id) < 0) {\n                    VIR_DEBUG(\"Ignoring delayed reply on sync\");\n                    ret = 0;\n                    goto cleanup;\n                }\n\n                VIR_DEBUG(\"Guest returned ID: %llu\", id);\n\n                if (msg->id != id) {\n                    VIR_DEBUG(\"Guest agent returned ID: %llu instead of %llu\",\n                              id, msg->id);\n                    ret = 0;\n                    goto cleanup;\n                }\n            }\n            msg->rxObject = obj;\n            msg->finished = 1;\n            obj = NULL;\n        } else {\n            /* we are out of sync */\n            VIR_DEBUG(\"Ignoring delayed reply\");\n        }\n        ret = 0;\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unknown JSON reply '%s'\"), line);\n    }\n\n cleanup:\n    virJSONValueFree(obj);\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic int\nqemuAgentIOProcessLine(qemuAgentPtr agent,\n                       const char *line,\n                       qemuAgentMessagePtr msg)\n{\n    virJSONValuePtr obj = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Line [%s]\", line);\n\n    if (!(obj = virJSONValueFromString(line))) {\n        /* receiving garbage on first sync is regular situation */\n        if (msg && msg->sync && msg->first) {\n            VIR_DEBUG(\"Received garbage on sync\");\n            msg->finished = 1;\n            return 0;\n        }\n\n        goto cleanup;\n    }\n\n    if (virJSONValueGetType(obj) != VIR_JSON_TYPE_OBJECT) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Parsed JSON reply '%s' isn't an object\"), line);\n        goto cleanup;\n    }\n\n    if (virJSONValueObjectHasKey(obj, \"QMP\") == 1) {\n        ret = 0;\n    } else if (virJSONValueObjectHasKey(obj, \"event\") == 1) {\n        ret = qemuAgentIOProcessEvent(agent, obj);\n    } else if (virJSONValueObjectHasKey(obj, \"error\") == 1 ||\n               virJSONValueObjectHasKey(obj, \"return\") == 1) {\n        if (msg) {\n            if (msg->sync) {\n                unsigned long long id;\n\n                if (virJSONValueObjectGetNumberUlong(obj, \"return\", &id) < 0) {\n                    VIR_DEBUG(\"Ignoring delayed reply on sync\");\n                    ret = 0;\n                    goto cleanup;\n                }\n\n                VIR_DEBUG(\"Guest returned ID: %llu\", id);\n\n                if (msg->id != id) {\n                    VIR_DEBUG(\"Guest agent returned ID: %llu instead of %llu\",\n                              id, msg->id);\n                    ret = 0;\n                    goto cleanup;\n                }\n            }\n            msg->rxObject = obj;\n            msg->finished = 1;\n            obj = NULL;\n        } else {\n            /* we are out of sync */\n            VIR_DEBUG(\"Ignoring delayed reply\");\n        }\n        ret = 0;\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unknown JSON reply '%s'\"), line);\n    }\n\n cleanup:\n    virJSONValueFree(obj);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "LINE_ENDING"
          ],
          "line": 348
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "data + used",
            "LINE_ENDING"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Data %zu bytes [%s]\"",
            "len",
            "data"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "str1"
          ],
          "line": 337
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ERROR",
          "args": [
            "_(\"[%s]\")",
            "str1"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"[%s]\""
          ],
          "line": 336
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentEscapeNonPrintable",
          "args": [
            "data"
          ],
          "line": 335
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentEscapeNonPrintable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "154-169",
          "snippet": "static char *\nqemuAgentEscapeNonPrintable(const char *text)\n{\n    size_t i;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    for (i = 0; text[i] != '\\0'; i++) {\n        if (text[i] == '\\\\')\n            virBufferAddLit(&buf, \"\\\\\\\\\");\n        else if (g_ascii_isprint(text[i]) || text[i] == '\\n' ||\n                 (text[i] == '\\r' && text[i+1] == '\\n'))\n            virBufferAddChar(&buf, text[i]);\n        else\n            virBufferAsprintf(&buf, \"\\\\x%02x\", text[i]);\n    }\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic char *\nqemuAgentEscapeNonPrintable(const char *text)\n{\n    size_t i;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    for (i = 0; text[i] != '\\0'; i++) {\n        if (text[i] == '\\\\')\n            virBufferAddLit(&buf, \"\\\\\\\\\");\n        else if (g_ascii_isprint(text[i]) || text[i] == '\\n' ||\n                 (text[i] == '\\r' && text[i+1] == '\\n'))\n            virBufferAddChar(&buf, text[i]);\n        else\n            virBufferAsprintf(&buf, \"\\\\x%02x\", text[i]);\n    }\n    return virBufferContentAndReset(&buf);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\n#define DEBUG_RAW_IO 0\n#define DEBUG_IO 0\n#define LINE_ENDING \"\\n\"\n\nstatic int qemuAgentIOProcessData(qemuAgentPtr agent,\n                                  char *data,\n                                  size_t len,\n                                  qemuAgentMessagePtr msg)\n{\n    int used = 0;\n    size_t i = 0;\n#if DEBUG_IO\n# if DEBUG_RAW_IO\n    char *str1 = qemuAgentEscapeNonPrintable(data);\n    VIR_ERROR(_(\"[%s]\"), str1);\n    VIR_FREE(str1);\n# else\n    VIR_DEBUG(\"Data %zu bytes [%s]\", len, data);\n# endif\n#endif\n\n    while (used < len) {\n        char *nl = strstr(data + used, LINE_ENDING);\n\n        if (nl) {\n            int got = nl - (data + used);\n            for (i = 0; i < strlen(LINE_ENDING); i++)\n                data[used + got + i] = '\\0';\n            if (qemuAgentIOProcessLine(agent, data + used, msg) < 0)\n                return -1;\n            used += got + strlen(LINE_ENDING);\n        } else {\n            break;\n        }\n    }\n\n    VIR_DEBUG(\"Total used %d bytes out of %zd available in buffer\", used, len);\n    return used;\n}"
  },
  {
    "function_name": "qemuAgentIOProcessLine",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "256-324",
    "snippet": "static int\nqemuAgentIOProcessLine(qemuAgentPtr agent,\n                       const char *line,\n                       qemuAgentMessagePtr msg)\n{\n    virJSONValuePtr obj = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Line [%s]\", line);\n\n    if (!(obj = virJSONValueFromString(line))) {\n        /* receiving garbage on first sync is regular situation */\n        if (msg && msg->sync && msg->first) {\n            VIR_DEBUG(\"Received garbage on sync\");\n            msg->finished = 1;\n            return 0;\n        }\n\n        goto cleanup;\n    }\n\n    if (virJSONValueGetType(obj) != VIR_JSON_TYPE_OBJECT) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Parsed JSON reply '%s' isn't an object\"), line);\n        goto cleanup;\n    }\n\n    if (virJSONValueObjectHasKey(obj, \"QMP\") == 1) {\n        ret = 0;\n    } else if (virJSONValueObjectHasKey(obj, \"event\") == 1) {\n        ret = qemuAgentIOProcessEvent(agent, obj);\n    } else if (virJSONValueObjectHasKey(obj, \"error\") == 1 ||\n               virJSONValueObjectHasKey(obj, \"return\") == 1) {\n        if (msg) {\n            if (msg->sync) {\n                unsigned long long id;\n\n                if (virJSONValueObjectGetNumberUlong(obj, \"return\", &id) < 0) {\n                    VIR_DEBUG(\"Ignoring delayed reply on sync\");\n                    ret = 0;\n                    goto cleanup;\n                }\n\n                VIR_DEBUG(\"Guest returned ID: %llu\", id);\n\n                if (msg->id != id) {\n                    VIR_DEBUG(\"Guest agent returned ID: %llu instead of %llu\",\n                              id, msg->id);\n                    ret = 0;\n                    goto cleanup;\n                }\n            }\n            msg->rxObject = obj;\n            msg->finished = 1;\n            obj = NULL;\n        } else {\n            /* we are out of sync */\n            VIR_DEBUG(\"Ignoring delayed reply\");\n        }\n        ret = 0;\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unknown JSON reply '%s'\"), line);\n    }\n\n cleanup:\n    virJSONValueFree(obj);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void qemuAgentDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "obj"
          ],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Unknown JSON reply '%s'\")",
            "line"
          ],
          "line": 317
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unknown JSON reply '%s'\""
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Ignoring delayed reply\""
          ],
          "line": 313
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Guest agent returned ID: %llu instead of %llu\"",
            "id",
            "msg->id"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Guest returned ID: %llu\"",
            "id"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Ignoring delayed reply on sync\""
          ],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberUlong",
          "args": [
            "obj",
            "\"return\"",
            "&id"
          ],
          "line": 293
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberUlong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1373-1384",
          "snippet": "int\nvirJSONValueObjectGetNumberUlong(virJSONValuePtr object,\n                                 const char *key,\n                                 unsigned long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUlong(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberUlong(virJSONValuePtr object,\n                                 const char *key,\n                                 unsigned long long *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUlong(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectHasKey",
          "args": [
            "obj",
            "\"return\""
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectHasKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "838-853",
          "snippet": "int\nvirJSONValueObjectHasKey(virJSONValuePtr object,\n                         const char *key)\n{\n    size_t i;\n\n    if (object->type != VIR_JSON_TYPE_OBJECT)\n        return -1;\n\n    for (i = 0; i < object->data.object.npairs; i++) {\n        if (STREQ(object->data.object.pairs[i].key, key))\n            return 1;\n    }\n\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectHasKey(virJSONValuePtr object,\n                         const char *key)\n{\n    size_t i;\n\n    if (object->type != VIR_JSON_TYPE_OBJECT)\n        return -1;\n\n    for (i = 0; i < object->data.object.npairs; i++) {\n        if (STREQ(object->data.object.pairs[i].key, key))\n            return 1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "qemuAgentIOProcessEvent",
          "args": [
            "agent",
            "obj"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "qemuAgentIOProcessEvent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
          "lines": "228-254",
          "snippet": "static int\nqemuAgentIOProcessEvent(qemuAgentPtr agent,\n                        virJSONValuePtr obj)\n{\n    const char *type;\n    VIR_DEBUG(\"agent=%p obj=%p\", agent, obj);\n\n    type = virJSONValueObjectGetString(obj, \"event\");\n    if (!type) {\n        VIR_WARN(\"missing event type in message\");\n        errno = EINVAL;\n        return -1;\n    }\n\n/*\n    for (i = 0; i < G_N_ELEMENTS(eventHandlers); i++) {\n        if (STREQ(eventHandlers[i].type, type)) {\n            virJSONValuePtr data = virJSONValueObjectGet(obj, \"data\");\n            VIR_DEBUG(\"handle %s handler=%p data=%p\", type,\n                      eventHandlers[i].handler, data);\n            (eventHandlers[i].handler)(agent, data);\n            break;\n        }\n    }\n*/\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virenum.h\"",
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virtime.h\"",
            "#include \"virprocess.h\"",
            "#include \"virfile.h\"",
            "#include \"virjson.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_agent.h\"",
            "#include <gio/gio.h>",
            "#include <sys/time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void qemuAgentDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic int\nqemuAgentIOProcessEvent(qemuAgentPtr agent,\n                        virJSONValuePtr obj)\n{\n    const char *type;\n    VIR_DEBUG(\"agent=%p obj=%p\", agent, obj);\n\n    type = virJSONValueObjectGetString(obj, \"event\");\n    if (!type) {\n        VIR_WARN(\"missing event type in message\");\n        errno = EINVAL;\n        return -1;\n    }\n\n/*\n    for (i = 0; i < G_N_ELEMENTS(eventHandlers); i++) {\n        if (STREQ(eventHandlers[i].type, type)) {\n            virJSONValuePtr data = virJSONValueObjectGet(obj, \"data\");\n            VIR_DEBUG(\"handle %s handler=%p data=%p\", type,\n                      eventHandlers[i].handler, data);\n            (eventHandlers[i].handler)(agent, data);\n            break;\n        }\n    }\n*/\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Parsed JSON reply '%s' isn't an object\")",
            "line"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueGetType",
          "args": [
            "obj"
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueGetType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "101-105",
          "snippet": "virJSONType\nvirJSONValueGetType(const virJSONValue *value)\n{\n    return value->type;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONType\nvirJSONValueGetType(const virJSONValue *value)\n{\n    return value->type;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Received garbage on sync\""
          ],
          "line": 269
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueFromString",
          "args": [
            "line"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFromString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1993-1999",
          "snippet": "virJSONValuePtr\nvirJSONValueFromString(const char *jsonstring G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No JSON parser implementation is available\"));\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueFromString(const char *jsonstring G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                   _(\"No JSON parser implementation is available\"));\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Line [%s]\"",
            "line"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic int\nqemuAgentIOProcessLine(qemuAgentPtr agent,\n                       const char *line,\n                       qemuAgentMessagePtr msg)\n{\n    virJSONValuePtr obj = NULL;\n    int ret = -1;\n\n    VIR_DEBUG(\"Line [%s]\", line);\n\n    if (!(obj = virJSONValueFromString(line))) {\n        /* receiving garbage on first sync is regular situation */\n        if (msg && msg->sync && msg->first) {\n            VIR_DEBUG(\"Received garbage on sync\");\n            msg->finished = 1;\n            return 0;\n        }\n\n        goto cleanup;\n    }\n\n    if (virJSONValueGetType(obj) != VIR_JSON_TYPE_OBJECT) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Parsed JSON reply '%s' isn't an object\"), line);\n        goto cleanup;\n    }\n\n    if (virJSONValueObjectHasKey(obj, \"QMP\") == 1) {\n        ret = 0;\n    } else if (virJSONValueObjectHasKey(obj, \"event\") == 1) {\n        ret = qemuAgentIOProcessEvent(agent, obj);\n    } else if (virJSONValueObjectHasKey(obj, \"error\") == 1 ||\n               virJSONValueObjectHasKey(obj, \"return\") == 1) {\n        if (msg) {\n            if (msg->sync) {\n                unsigned long long id;\n\n                if (virJSONValueObjectGetNumberUlong(obj, \"return\", &id) < 0) {\n                    VIR_DEBUG(\"Ignoring delayed reply on sync\");\n                    ret = 0;\n                    goto cleanup;\n                }\n\n                VIR_DEBUG(\"Guest returned ID: %llu\", id);\n\n                if (msg->id != id) {\n                    VIR_DEBUG(\"Guest agent returned ID: %llu instead of %llu\",\n                              id, msg->id);\n                    ret = 0;\n                    goto cleanup;\n                }\n            }\n            msg->rxObject = obj;\n            msg->finished = 1;\n            obj = NULL;\n        } else {\n            /* we are out of sync */\n            VIR_DEBUG(\"Ignoring delayed reply\");\n        }\n        ret = 0;\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unknown JSON reply '%s'\"), line);\n    }\n\n cleanup:\n    virJSONValueFree(obj);\n    return ret;\n}"
  },
  {
    "function_name": "qemuAgentIOProcessEvent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "228-254",
    "snippet": "static int\nqemuAgentIOProcessEvent(qemuAgentPtr agent,\n                        virJSONValuePtr obj)\n{\n    const char *type;\n    VIR_DEBUG(\"agent=%p obj=%p\", agent, obj);\n\n    type = virJSONValueObjectGetString(obj, \"event\");\n    if (!type) {\n        VIR_WARN(\"missing event type in message\");\n        errno = EINVAL;\n        return -1;\n    }\n\n/*\n    for (i = 0; i < G_N_ELEMENTS(eventHandlers); i++) {\n        if (STREQ(eventHandlers[i].type, type)) {\n            virJSONValuePtr data = virJSONValueObjectGet(obj, \"data\");\n            VIR_DEBUG(\"handle %s handler=%p data=%p\", type,\n                      eventHandlers[i].handler, data);\n            (eventHandlers[i].handler)(agent, data);\n            break;\n        }\n    }\n*/\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void qemuAgentDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"missing event type in message\""
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "obj",
            "\"event\""
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"agent=%p obj=%p\"",
            "agent",
            "obj"
          ],
          "line": 233
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic int\nqemuAgentIOProcessEvent(qemuAgentPtr agent,\n                        virJSONValuePtr obj)\n{\n    const char *type;\n    VIR_DEBUG(\"agent=%p obj=%p\", agent, obj);\n\n    type = virJSONValueObjectGetString(obj, \"event\");\n    if (!type) {\n        VIR_WARN(\"missing event type in message\");\n        errno = EINVAL;\n        return -1;\n    }\n\n/*\n    for (i = 0; i < G_N_ELEMENTS(eventHandlers); i++) {\n        if (STREQ(eventHandlers[i].type, type)) {\n            virJSONValuePtr data = virJSONValueObjectGet(obj, \"data\");\n            VIR_DEBUG(\"handle %s handler=%p data=%p\", type,\n                      eventHandlers[i].handler, data);\n            (eventHandlers[i].handler)(agent, data);\n            break;\n        }\n    }\n*/\n    return 0;\n}"
  },
  {
    "function_name": "qemuAgentOpenUnix",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "185-225",
    "snippet": "static int\nqemuAgentOpenUnix(const char *socketpath)\n{\n    struct sockaddr_un addr;\n    int agentfd;\n    int ret = -1;\n\n    if ((agentfd = socket(AF_UNIX, SOCK_STREAM, 0)) < 0) {\n        virReportSystemError(errno,\n                             \"%s\", _(\"failed to create socket\"));\n        return -1;\n    }\n\n    if (virSetCloseExec(agentfd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set agent \"\n                               \"close-on-exec flag\"));\n        goto error;\n    }\n\n    memset(&addr, 0, sizeof(addr));\n    addr.sun_family = AF_UNIX;\n    if (virStrcpyStatic(addr.sun_path, socketpath) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Socket path %s too big for destination\"), socketpath);\n        goto error;\n    }\n\n    ret = connect(agentfd, (struct sockaddr *)&addr, sizeof(addr));\n    if (ret < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to connect to agent socket\"));\n        goto error;\n    }\n\n    return agentfd;\n\n error:\n    VIR_FORCE_CLOSE(agentfd);\n    return -1;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "agentfd"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to connect to agent socket\")"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to connect to agent socket\""
          ],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "bswap_header",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_driver.c",
          "lines": "2852-2860",
          "snippet": "static inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virenum.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virqemu.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"virnuma.h\"",
            "#include \"virperf.h\"",
            "#include \"vircgroup.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"virhostdev.h\"",
            "#include \"viraccessapicheckqemu.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virtime.h\"",
            "#include \"virnodesuspend.h\"",
            "#include \"virkeycode.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"locking/lock_manager.h\"",
            "#include \"virthreadpool.h\"",
            "#include \"configmake.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virhook.h\"",
            "#include \"domain_nwfilter.h\"",
            "#include \"virsysinfo.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"libvirt_internal.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"domain_driver.h\"",
            "#include \"domain_cgroup.h\"",
            "#include \"domain_audit.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viruuid.h\"",
            "#include \"virarptable.h\"",
            "#include \"viralloc.h\"",
            "#include \"capabilities.h\"",
            "#include \"virnetdevopenvswitch.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virbuffer.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_checkpoint.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"qemu_migration_params.h\"",
            "#include \"qemu_migration.h\"",
            "#include \"qemu_process.h\"",
            "#include \"qemu_monitor.h\"",
            "#include \"qemu_hotplug.h\"",
            "#include \"qemu_hostdev.h\"",
            "#include \"qemu_cgroup.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_capabilities.h\"",
            "#include \"qemu_conf.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_agent.h\"",
            "#include \"qemu_driver.h\"",
            "#include <sys/ioctl.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <stdarg.h>",
            "#include <dirent.h>",
            "#include <sys/time.h>",
            "#include <sys/poll.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virenum.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virqemu.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"virnuma.h\"\n#include \"virperf.h\"\n#include \"vircgroup.h\"\n#include \"domain_capabilities.h\"\n#include \"virhostdev.h\"\n#include \"viraccessapicheckqemu.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"virbitmap.h\"\n#include \"virtypedparam.h\"\n#include \"virtime.h\"\n#include \"virnodesuspend.h\"\n#include \"virkeycode.h\"\n#include \"locking/domain_lock.h\"\n#include \"locking/lock_manager.h\"\n#include \"virthreadpool.h\"\n#include \"configmake.h\"\n#include \"virfdstream.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"virhook.h\"\n#include \"domain_nwfilter.h\"\n#include \"virsysinfo.h\"\n#include \"cpu/cpu.h\"\n#include \"virxml.h\"\n#include \"libvirt_internal.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"node_device_conf.h\"\n#include \"domain_driver.h\"\n#include \"domain_cgroup.h\"\n#include \"domain_audit.h\"\n#include \"domain_conf.h\"\n#include \"viruuid.h\"\n#include \"virarptable.h\"\n#include \"viralloc.h\"\n#include \"capabilities.h\"\n#include \"virnetdevopenvswitch.h\"\n#include \"virnetdevtap.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virbuffer.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_checkpoint.h\"\n#include \"qemu_security.h\"\n#include \"qemu_blockjob.h\"\n#include \"qemu_migration_params.h\"\n#include \"qemu_migration.h\"\n#include \"qemu_process.h\"\n#include \"qemu_monitor.h\"\n#include \"qemu_hotplug.h\"\n#include \"qemu_hostdev.h\"\n#include \"qemu_cgroup.h\"\n#include \"qemu_command.h\"\n#include \"qemu_capabilities.h\"\n#include \"qemu_conf.h\"\n#include \"qemu_block.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_agent.h\"\n#include \"qemu_driver.h\"\n#include <sys/ioctl.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <unistd.h>\n#include <stdarg.h>\n#include <dirent.h>\n#include <sys/time.h>\n#include <sys/poll.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic inline void\nbswap_header(virQEMUSaveHeaderPtr hdr)\n{\n    hdr->version = GUINT32_SWAP_LE_BE(hdr->version);\n    hdr->data_len = GUINT32_SWAP_LE_BE(hdr->data_len);\n    hdr->was_running = GUINT32_SWAP_LE_BE(hdr->was_running);\n    hdr->compressed = GUINT32_SWAP_LE_BE(hdr->compressed);\n    hdr->cookieOffset = GUINT32_SWAP_LE_BE(hdr->cookieOffset);\n}"
        }
      },
      {
        "call_info": {
          "callee": "connect",
          "args": [
            "agentfd",
            "(struct sockaddr *)&addr",
            "sizeof(addr)"
          ],
          "line": 213
        },
        "resolved": true,
        "details": {
          "function_name": "vir_connect",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "216-232",
          "snippet": "int\nvir_connect(int fd, const struct sockaddr *addr, socklen_t addrlen)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (connect(sk, addr, addrlen) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_connect(int fd, const struct sockaddr *addr, socklen_t addrlen)\n{\n    SOCKET sk = FD2SK(fd);\n\n    if (sk == INVALID_SOCKET) {\n        errno = EBADF;\n        return -1;\n    }\n\n    if (connect(sk, addr, addrlen) < 0) {\n        set_errno();\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Socket path %s too big for destination\")",
            "socketpath"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrcpyStatic",
          "args": [
            "addr.sun_path",
            "socketpath"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&addr",
            "0",
            "sizeof(addr)"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to set agent \"\n                               \"close-on-exec flag\")"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSetCloseExec",
          "args": [
            "agentfd"
          ],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "virSetCloseExec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "131-134",
          "snippet": "int virSetCloseExec(int fd)\n{\n    return virSetInherit(fd, false);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetCloseExec(int fd)\n{\n    return virSetInherit(fd, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to create socket\")"
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "socket",
          "args": [
            "AF_UNIX",
            "SOCK_STREAM",
            "0"
          ],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "vir_socket",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virsocket.c",
          "lines": "351-367",
          "snippet": "int\nvir_socket(int domain, int type, int protocol)\n{\n    SOCKET sk;\n\n    /* We have to use WSASocket() instead of socket(), to create\n     * non-overlapped IO sockets. Overlapped IO sockets cannot\n     * be used with read/write.\n     */\n    sk = WSASocket(domain, type, protocol, NULL, 0, 0);\n    if (sk == INVALID_SOCKET) {\n        set_errno();\n        return -1;\n    }\n\n    return SK2FD(sk);\n}",
          "includes": [
            "#include <fcntl.h>",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virsocket.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <fcntl.h>\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virsocket.h\"\n#include <config.h>\n\nint\nvir_socket(int domain, int type, int protocol)\n{\n    SOCKET sk;\n\n    /* We have to use WSASocket() instead of socket(), to create\n     * non-overlapped IO sockets. Overlapped IO sockets cannot\n     * be used with read/write.\n     */\n    sk = WSASocket(domain, type, protocol, NULL, 0, 0);\n    if (sk == INVALID_SOCKET) {\n        set_errno();\n        return -1;\n    }\n\n    return SK2FD(sk);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int\nqemuAgentOpenUnix(const char *socketpath)\n{\n    struct sockaddr_un addr;\n    int agentfd;\n    int ret = -1;\n\n    if ((agentfd = socket(AF_UNIX, SOCK_STREAM, 0)) < 0) {\n        virReportSystemError(errno,\n                             \"%s\", _(\"failed to create socket\"));\n        return -1;\n    }\n\n    if (virSetCloseExec(agentfd) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to set agent \"\n                               \"close-on-exec flag\"));\n        goto error;\n    }\n\n    memset(&addr, 0, sizeof(addr));\n    addr.sun_family = AF_UNIX;\n    if (virStrcpyStatic(addr.sun_path, socketpath) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Socket path %s too big for destination\"), socketpath);\n        goto error;\n    }\n\n    ret = connect(agentfd, (struct sockaddr *)&addr, sizeof(addr));\n    if (ret < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to connect to agent socket\"));\n        goto error;\n    }\n\n    return agentfd;\n\n error:\n    VIR_FORCE_CLOSE(agentfd);\n    return -1;\n}"
  },
  {
    "function_name": "qemuAgentDispose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "173-183",
    "snippet": "static void qemuAgentDispose(void *obj)\n{\n    qemuAgentPtr agent = obj;\n    VIR_DEBUG(\"agent=%p\", agent);\n    if (agent->cb && agent->cb->destroy)\n        (agent->cb->destroy)(agent, agent->vm);\n    virCondDestroy(&agent->notify);\n    VIR_FREE(agent->buffer);\n    g_main_context_unref(agent->context);\n    virResetError(&agent->lastError);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void qemuAgentDispose(void *obj);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virResetError",
          "args": [
            "&agent->lastError"
          ],
          "line": 182
        },
        "resolved": true,
        "details": {
          "function_name": "virResetError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "466-476",
          "snippet": "void\nvirResetError(virErrorPtr err)\n{\n    if (err == NULL)\n        return;\n    VIR_FREE(err->message);\n    VIR_FREE(err->str1);\n    VIR_FREE(err->str2);\n    VIR_FREE(err->str3);\n    memset(err, 0, sizeof(virError));\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetError(virErrorPtr err)\n{\n    if (err == NULL)\n        return;\n    VIR_FREE(err->message);\n    VIR_FREE(err->str1);\n    VIR_FREE(err->str2);\n    VIR_FREE(err->str3);\n    memset(err, 0, sizeof(virError));\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_main_context_unref",
          "args": [
            "agent->context"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "agent->buffer"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCondDestroy",
          "args": [
            "&agent->notify"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "virCondDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "135-143",
          "snippet": "int virCondDestroy(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_destroy(&c->cond)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondDestroy(virCondPtr c)\n{\n    int ret;\n    if ((ret = pthread_cond_destroy(&c->cond)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "",
          "args": [
            "agent",
            "agent->vm"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"agent=%p\"",
            "agent"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic void qemuAgentDispose(void *obj);\n\nstatic void qemuAgentDispose(void *obj)\n{\n    qemuAgentPtr agent = obj;\n    VIR_DEBUG(\"agent=%p\", agent);\n    if (agent->cb && agent->cb->destroy)\n        (agent->cb->destroy)(agent, agent->vm);\n    virCondDestroy(&agent->notify);\n    VIR_FREE(agent->buffer);\n    g_main_context_unref(agent->context);\n    virResetError(&agent->lastError);\n}"
  },
  {
    "function_name": "qemuAgentEscapeNonPrintable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "154-169",
    "snippet": "static char *\nqemuAgentEscapeNonPrintable(const char *text)\n{\n    size_t i;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    for (i = 0; text[i] != '\\0'; i++) {\n        if (text[i] == '\\\\')\n            virBufferAddLit(&buf, \"\\\\\\\\\");\n        else if (g_ascii_isprint(text[i]) || text[i] == '\\n' ||\n                 (text[i] == '\\r' && text[i+1] == '\\n'))\n            virBufferAddChar(&buf, text[i]);\n        else\n            virBufferAsprintf(&buf, \"\\\\x%02x\", text[i]);\n    }\n    return virBufferContentAndReset(&buf);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferContentAndReset",
          "args": [
            "&buf"
          ],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferContentAndReset",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "247-260",
          "snippet": "char *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirBufferContentAndReset(virBufferPtr buf)\n{\n    char *str = NULL;\n\n    if (!buf)\n        return NULL;\n\n    if (buf->str)\n        str = g_string_free(buf->str, false);\n\n    memset(buf, 0, sizeof(*buf));\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAsprintf",
          "args": [
            "&buf",
            "\"\\\\x%02x\"",
            "text[i]"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAsprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "302-309",
          "snippet": "void\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAsprintf(virBufferPtr buf, const char *format, ...)\n{\n    va_list argptr;\n    va_start(argptr, format);\n    virBufferVasprintf(buf, format, argptr);\n    va_end(argptr);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAddChar",
          "args": [
            "&buf",
            "text[i]"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAddChar",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "206-210",
          "snippet": "void\nvirBufferAddChar(virBufferPtr buf, char c)\n{\n    virBufferAdd(buf, &c, 1);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAddChar(virBufferPtr buf, char c)\n{\n    virBufferAdd(buf, &c, 1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_ascii_isprint",
          "args": [
            "text[i]"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "&buf",
            "\"\\\\\\\\\""
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic char *\nqemuAgentEscapeNonPrintable(const char *text)\n{\n    size_t i;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    for (i = 0; text[i] != '\\0'; i++) {\n        if (text[i] == '\\\\')\n            virBufferAddLit(&buf, \"\\\\\\\\\");\n        else if (g_ascii_isprint(text[i]) || text[i] == '\\n' ||\n                 (text[i] == '\\r' && text[i+1] == '\\n'))\n            virBufferAddChar(&buf, text[i]);\n        else\n            virBufferAsprintf(&buf, \"\\\\x%02x\", text[i]);\n    }\n    return virBufferContentAndReset(&buf);\n}"
  },
  {
    "function_name": "qemuAgentOnceInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_agent.c",
    "lines": "142-148",
    "snippet": "static int qemuAgentOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(qemuAgent, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virsocket.h\"",
      "#include \"virenum.h\"",
      "#include \"virstring.h\"",
      "#include \"virobject.h\"",
      "#include \"virtime.h\"",
      "#include \"virprocess.h\"",
      "#include \"virfile.h\"",
      "#include \"virjson.h\"",
      "#include \"virerror.h\"",
      "#include \"virlog.h\"",
      "#include \"viralloc.h\"",
      "#include \"qemu_domain.h\"",
      "#include \"qemu_agent.h\"",
      "#include <gio/gio.h>",
      "#include <sys/time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <poll.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_CLASS_NEW",
          "args": [
            "qemuAgent",
            "virClassForObjectLockable()"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virClassForObjectLockable",
          "args": [],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "virClassForObjectLockable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "116-123",
          "snippet": "virClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectLockableClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectLockableClass;\n\nvirClassPtr\nvirClassForObjectLockable(void)\n{\n    if (virObjectInitialize() < 0)\n        return NULL;\n\n    return virObjectLockableClass;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virsocket.h\"\n#include \"virenum.h\"\n#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virtime.h\"\n#include \"virprocess.h\"\n#include \"virfile.h\"\n#include \"virjson.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_agent.h\"\n#include <gio/gio.h>\n#include <sys/time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <poll.h>\n#include <config.h>\n\nstatic int qemuAgentOnceInit(void)\n{\n    if (!VIR_CLASS_NEW(qemuAgent, virClassForObjectLockable()))\n        return -1;\n\n    return 0;\n}"
  }
]