[
  {
    "function_name": "virBhyveProbeCaps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "326-357",
    "snippet": "int\nvirBhyveProbeCaps(unsigned int *caps)\n{\n    char *binary;\n    int ret = 0;\n\n    binary = virFindFileInPath(\"bhyve\");\n    if (binary == NULL)\n        goto out;\n\n    if ((ret = bhyveProbeCapsFromHelp(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsAHCI32Slot(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsNetE1000(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsLPC_Bootrom(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsFramebuffer(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsXHCIController(caps, binary)))\n        goto out;\n\n out:\n    VIR_FREE(binary);\n    return ret;\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "binary"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bhyveProbeCapsXHCIController",
          "args": [
            "caps",
            "binary"
          ],
          "line": 351
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsXHCIController",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "315-323",
          "snippet": "static int\nbhyveProbeCapsXHCIController(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,xhci\",\n                                      \"pci slot 0:0: unknown device \\\"xhci\\\"\",\n                                      BHYVE_CAP_FBUF);\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsXHCIController(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,xhci\",\n                                      \"pci slot 0:0: unknown device \\\"xhci\\\"\",\n                                      BHYVE_CAP_FBUF);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bhyveProbeCapsFramebuffer",
          "args": [
            "caps",
            "binary"
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsFramebuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "304-312",
          "snippet": "static int\nbhyveProbeCapsFramebuffer(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,fbuf\",\n                                      \"pci slot 0:0: unknown device \\\"fbuf\\\"\",\n                                      BHYVE_CAP_FBUF);\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsFramebuffer(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,fbuf\",\n                                      \"pci slot 0:0: unknown device \\\"fbuf\\\"\",\n                                      BHYVE_CAP_FBUF);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bhyveProbeCapsLPC_Bootrom",
          "args": [
            "caps",
            "binary"
          ],
          "line": 345
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsLPC_Bootrom",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "293-301",
          "snippet": "static int\nbhyveProbeCapsLPC_Bootrom(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-l\",\n                                      \"bootrom\",\n                                      \"bhyve: invalid lpc device configuration 'bootrom'\",\n                                      BHYVE_CAP_LPC_BOOTROM);\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsLPC_Bootrom(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-l\",\n                                      \"bootrom\",\n                                      \"bhyve: invalid lpc device configuration 'bootrom'\",\n                                      BHYVE_CAP_LPC_BOOTROM);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bhyveProbeCapsNetE1000",
          "args": [
            "caps",
            "binary"
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsNetE1000",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "283-291",
          "snippet": "static int\nbhyveProbeCapsNetE1000(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,e1000\",\n                                      \"pci slot 0:0: unknown device \\\"e1000\\\"\",\n                                      BHYVE_CAP_NET_E1000);\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsNetE1000(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,e1000\",\n                                      \"pci slot 0:0: unknown device \\\"e1000\\\"\",\n                                      BHYVE_CAP_NET_E1000);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bhyveProbeCapsAHCI32Slot",
          "args": [
            "caps",
            "binary"
          ],
          "line": 339
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsAHCI32Slot",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "272-280",
          "snippet": "static int\nbhyveProbeCapsAHCI32Slot(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,ahci\",\n                                      \"pci slot 0:0: unknown device \\\"ahci\\\"\",\n                                      BHYVE_CAP_AHCI32SLOT);\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsAHCI32Slot(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,ahci\",\n                                      \"pci slot 0:0: unknown device \\\"ahci\\\"\",\n                                      BHYVE_CAP_AHCI32SLOT);\n}"
        }
      },
      {
        "call_info": {
          "callee": "bhyveProbeCapsFromHelp",
          "args": [
            "caps",
            "binary"
          ],
          "line": 336
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsFromHelp",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "242-270",
          "snippet": "static int\nbhyveProbeCapsFromHelp(unsigned int *caps, char *binary)\n{\n    char *help;\n    virCommandPtr cmd = NULL;\n    int ret = 0, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArg(cmd, \"-h\");\n    virCommandSetErrorBuffer(cmd, &help);\n    if (virCommandRun(cmd, &exit) < 0) {\n        ret = -1;\n        goto out;\n    }\n\n    if (strstr(help, \"-u:\") != NULL)\n        *caps |= BHYVE_CAP_RTC_UTC;\n\n    /* \"-c vcpus\" was there before CPU topology support was introduced,\n     * then it became\n     * \"-c [[cpus=]numcpus][,sockets=n][,cores=n][,threads=n] */\n    if (strstr(help, \"-c vcpus\") == NULL)\n        *caps |= BHYVE_CAP_CPUTOPOLOGY;\n\n out:\n    VIR_FREE(help);\n    virCommandFree(cmd);\n    return ret;\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsFromHelp(unsigned int *caps, char *binary)\n{\n    char *help;\n    virCommandPtr cmd = NULL;\n    int ret = 0, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArg(cmd, \"-h\");\n    virCommandSetErrorBuffer(cmd, &help);\n    if (virCommandRun(cmd, &exit) < 0) {\n        ret = -1;\n        goto out;\n    }\n\n    if (strstr(help, \"-u:\") != NULL)\n        *caps |= BHYVE_CAP_RTC_UTC;\n\n    /* \"-c vcpus\" was there before CPU topology support was introduced,\n     * then it became\n     * \"-c [[cpus=]numcpus][,sockets=n][,cores=n][,threads=n] */\n    if (strstr(help, \"-c vcpus\") == NULL)\n        *caps |= BHYVE_CAP_CPUTOPOLOGY;\n\n out:\n    VIR_FREE(help);\n    virCommandFree(cmd);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFindFileInPath",
          "args": [
            "\"bhyve\""
          ],
          "line": 332
        },
        "resolved": true,
        "details": {
          "function_name": "virFindFileInPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1657-1709",
          "snippet": "char *\nvirFindFileInPath(const char *file)\n{\n    const char *origpath = NULL;\n    VIR_AUTOSTRINGLIST paths = NULL;\n    char **pathiter;\n\n    if (file == NULL)\n        return NULL;\n\n    /* if we are passed an absolute path (starting with /), return a\n     * copy of that path, after validating that it is executable\n     */\n    if (g_path_is_absolute(file)) {\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        return g_strdup(file);\n    }\n\n    /* If we are passed an anchored path (containing a /), then there\n     * is no path search - it must exist in the current directory\n     */\n    if (strchr(file, '/')) {\n        char *abspath = NULL;\n\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        ignore_value(virFileAbsPath(file, &abspath));\n        return abspath;\n    }\n\n    /* copy PATH env so we can tweak it */\n    origpath = getenv(\"PATH\");\n    if (!origpath)\n        origpath = \"/bin:/usr/bin\";\n\n    /* for each path segment, append the file to search for and test for\n     * it. return it if found.\n     */\n\n    if (!(paths = virStringSplit(origpath, \":\", 0)))\n        return NULL;\n\n    for (pathiter = paths; *pathiter; pathiter++) {\n        g_autofree char *fullpath = g_strdup_printf(\"%s/%s\", *pathiter, file);\n        if (virFileIsExecutable(fullpath))\n            return g_steal_pointer(&fullpath);\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirFindFileInPath(const char *file)\n{\n    const char *origpath = NULL;\n    VIR_AUTOSTRINGLIST paths = NULL;\n    char **pathiter;\n\n    if (file == NULL)\n        return NULL;\n\n    /* if we are passed an absolute path (starting with /), return a\n     * copy of that path, after validating that it is executable\n     */\n    if (g_path_is_absolute(file)) {\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        return g_strdup(file);\n    }\n\n    /* If we are passed an anchored path (containing a /), then there\n     * is no path search - it must exist in the current directory\n     */\n    if (strchr(file, '/')) {\n        char *abspath = NULL;\n\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        ignore_value(virFileAbsPath(file, &abspath));\n        return abspath;\n    }\n\n    /* copy PATH env so we can tweak it */\n    origpath = getenv(\"PATH\");\n    if (!origpath)\n        origpath = \"/bin:/usr/bin\";\n\n    /* for each path segment, append the file to search for and test for\n     * it. return it if found.\n     */\n\n    if (!(paths = virStringSplit(origpath, \":\", 0)))\n        return NULL;\n\n    for (pathiter = paths; *pathiter; pathiter++) {\n        g_autofree char *fullpath = g_strdup_printf(\"%s/%s\", *pathiter, file);\n        if (virFileIsExecutable(fullpath))\n            return g_steal_pointer(&fullpath);\n    }\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nint\nvirBhyveProbeCaps(unsigned int *caps)\n{\n    char *binary;\n    int ret = 0;\n\n    binary = virFindFileInPath(\"bhyve\");\n    if (binary == NULL)\n        goto out;\n\n    if ((ret = bhyveProbeCapsFromHelp(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsAHCI32Slot(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsNetE1000(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsLPC_Bootrom(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsFramebuffer(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsXHCIController(caps, binary)))\n        goto out;\n\n out:\n    VIR_FREE(binary);\n    return ret;\n}"
  },
  {
    "function_name": "bhyveProbeCapsXHCIController",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "315-323",
    "snippet": "static int\nbhyveProbeCapsXHCIController(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,xhci\",\n                                      \"pci slot 0:0: unknown device \\\"xhci\\\"\",\n                                      BHYVE_CAP_FBUF);\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bhyveProbeCapsDeviceHelper",
          "args": [
            "caps",
            "binary",
            "\"-s\"",
            "\"0,xhci\"",
            "\"pci slot 0:0: unknown device \\\"xhci\\\"\"",
            "BHYVE_CAP_FBUF"
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsDeviceHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "214-240",
          "snippet": "static int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsXHCIController(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,xhci\",\n                                      \"pci slot 0:0: unknown device \\\"xhci\\\"\",\n                                      BHYVE_CAP_FBUF);\n}"
  },
  {
    "function_name": "bhyveProbeCapsFramebuffer",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "304-312",
    "snippet": "static int\nbhyveProbeCapsFramebuffer(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,fbuf\",\n                                      \"pci slot 0:0: unknown device \\\"fbuf\\\"\",\n                                      BHYVE_CAP_FBUF);\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bhyveProbeCapsDeviceHelper",
          "args": [
            "caps",
            "binary",
            "\"-s\"",
            "\"0,fbuf\"",
            "\"pci slot 0:0: unknown device \\\"fbuf\\\"\"",
            "BHYVE_CAP_FBUF"
          ],
          "line": 307
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsDeviceHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "214-240",
          "snippet": "static int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsFramebuffer(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,fbuf\",\n                                      \"pci slot 0:0: unknown device \\\"fbuf\\\"\",\n                                      BHYVE_CAP_FBUF);\n}"
  },
  {
    "function_name": "bhyveProbeCapsLPC_Bootrom",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "293-301",
    "snippet": "static int\nbhyveProbeCapsLPC_Bootrom(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-l\",\n                                      \"bootrom\",\n                                      \"bhyve: invalid lpc device configuration 'bootrom'\",\n                                      BHYVE_CAP_LPC_BOOTROM);\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bhyveProbeCapsDeviceHelper",
          "args": [
            "caps",
            "binary",
            "\"-l\"",
            "\"bootrom\"",
            "\"bhyve: invalid lpc device configuration 'bootrom'\"",
            "BHYVE_CAP_LPC_BOOTROM"
          ],
          "line": 296
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsDeviceHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "214-240",
          "snippet": "static int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsLPC_Bootrom(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-l\",\n                                      \"bootrom\",\n                                      \"bhyve: invalid lpc device configuration 'bootrom'\",\n                                      BHYVE_CAP_LPC_BOOTROM);\n}"
  },
  {
    "function_name": "bhyveProbeCapsNetE1000",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "283-291",
    "snippet": "static int\nbhyveProbeCapsNetE1000(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,e1000\",\n                                      \"pci slot 0:0: unknown device \\\"e1000\\\"\",\n                                      BHYVE_CAP_NET_E1000);\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bhyveProbeCapsDeviceHelper",
          "args": [
            "caps",
            "binary",
            "\"-s\"",
            "\"0,e1000\"",
            "\"pci slot 0:0: unknown device \\\"e1000\\\"\"",
            "BHYVE_CAP_NET_E1000"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsDeviceHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "214-240",
          "snippet": "static int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsNetE1000(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,e1000\",\n                                      \"pci slot 0:0: unknown device \\\"e1000\\\"\",\n                                      BHYVE_CAP_NET_E1000);\n}"
  },
  {
    "function_name": "bhyveProbeCapsAHCI32Slot",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "272-280",
    "snippet": "static int\nbhyveProbeCapsAHCI32Slot(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,ahci\",\n                                      \"pci slot 0:0: unknown device \\\"ahci\\\"\",\n                                      BHYVE_CAP_AHCI32SLOT);\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "bhyveProbeCapsDeviceHelper",
          "args": [
            "caps",
            "binary",
            "\"-s\"",
            "\"0,ahci\"",
            "\"pci slot 0:0: unknown device \\\"ahci\\\"\"",
            "BHYVE_CAP_AHCI32SLOT"
          ],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "bhyveProbeCapsDeviceHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "214-240",
          "snippet": "static int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsAHCI32Slot(unsigned int *caps, char *binary)\n{\n    return bhyveProbeCapsDeviceHelper(caps, binary,\n                                      \"-s\",\n                                      \"0,ahci\",\n                                      \"pci slot 0:0: unknown device \\\"ahci\\\"\",\n                                      BHYVE_CAP_AHCI32SLOT);\n}"
  },
  {
    "function_name": "bhyveProbeCapsFromHelp",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "242-270",
    "snippet": "static int\nbhyveProbeCapsFromHelp(unsigned int *caps, char *binary)\n{\n    char *help;\n    virCommandPtr cmd = NULL;\n    int ret = 0, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArg(cmd, \"-h\");\n    virCommandSetErrorBuffer(cmd, &help);\n    if (virCommandRun(cmd, &exit) < 0) {\n        ret = -1;\n        goto out;\n    }\n\n    if (strstr(help, \"-u:\") != NULL)\n        *caps |= BHYVE_CAP_RTC_UTC;\n\n    /* \"-c vcpus\" was there before CPU topology support was introduced,\n     * then it became\n     * \"-c [[cpus=]numcpus][,sockets=n][,cores=n][,threads=n] */\n    if (strstr(help, \"-c vcpus\") == NULL)\n        *caps |= BHYVE_CAP_CPUTOPOLOGY;\n\n out:\n    VIR_FREE(help);\n    virCommandFree(cmd);\n    return ret;\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "cmd"
          ],
          "line": 268
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "help"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "help",
            "\"-c vcpus\""
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "help",
            "\"-u:\""
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "&exit"
          ],
          "line": 252
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetErrorBuffer",
          "args": [
            "cmd",
            "&help"
          ],
          "line": 251
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetErrorBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1903-1918",
          "snippet": "void\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArg",
          "args": [
            "cmd",
            "\"-h\""
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "binary"
          ],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsFromHelp(unsigned int *caps, char *binary)\n{\n    char *help;\n    virCommandPtr cmd = NULL;\n    int ret = 0, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArg(cmd, \"-h\");\n    virCommandSetErrorBuffer(cmd, &help);\n    if (virCommandRun(cmd, &exit) < 0) {\n        ret = -1;\n        goto out;\n    }\n\n    if (strstr(help, \"-u:\") != NULL)\n        *caps |= BHYVE_CAP_RTC_UTC;\n\n    /* \"-c vcpus\" was there before CPU topology support was introduced,\n     * then it became\n     * \"-c [[cpus=]numcpus][,sockets=n][,cores=n][,threads=n] */\n    if (strstr(help, \"-c vcpus\") == NULL)\n        *caps |= BHYVE_CAP_CPUTOPOLOGY;\n\n out:\n    VIR_FREE(help);\n    virCommandFree(cmd);\n    return ret;\n}"
  },
  {
    "function_name": "bhyveProbeCapsDeviceHelper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "214-240",
    "snippet": "static int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "cmd"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "error"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "error",
            "errormsg"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "&exit"
          ],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetErrorBuffer",
          "args": [
            "cmd",
            "&error"
          ],
          "line": 228
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetErrorBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1903-1918",
          "snippet": "void\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetErrorBuffer(virCommandPtr cmd, char **errbuf)\n{\n    *errbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->errfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify stderr twice\");\n        return;\n    }\n\n    cmd->errbuf = errbuf;\n    cmd->errfdptr = &cmd->errfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgList",
          "args": [
            "cmd",
            "bus",
            "device",
            "NULL"
          ],
          "line": 227
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "binary"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nstatic int\nbhyveProbeCapsDeviceHelper(unsigned int *caps,\n                           char *binary,\n                           const char *bus,\n                           const char *device,\n                           const char *errormsg,\n                           unsigned int flag)\n{\n    char *error;\n    virCommandPtr cmd = NULL;\n    int ret = -1, exit;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArgList(cmd, bus, device, NULL);\n    virCommandSetErrorBuffer(cmd, &error);\n    if (virCommandRun(cmd, &exit) < 0)\n        goto cleanup;\n\n    if (strstr(error, errormsg) == NULL)\n        *caps |= flag;\n\n    ret = 0;\n cleanup:\n    VIR_FREE(error);\n    virCommandFree(cmd);\n    return ret;\n}"
  },
  {
    "function_name": "virBhyveProbeGrubCaps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "180-212",
    "snippet": "int\nvirBhyveProbeGrubCaps(virBhyveGrubCapsFlags *caps)\n{\n    char *binary, *help;\n    virCommandPtr cmd;\n    int ret, exit;\n\n    ret = 0;\n    *caps = 0;\n    cmd = NULL;\n    help = NULL;\n\n    binary = virFindFileInPath(\"grub-bhyve\");\n    if (binary == NULL)\n        goto out;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArg(cmd, \"--help\");\n    virCommandSetOutputBuffer(cmd, &help);\n    if (virCommandRun(cmd, &exit) < 0) {\n        ret = -1;\n        goto out;\n    }\n\n    if (strstr(help, \"--cons-dev\") != NULL)\n        *caps |= BHYVE_GRUB_CAP_CONSDEV;\n\n out:\n    VIR_FREE(help);\n    virCommandFree(cmd);\n    VIR_FREE(binary);\n    return ret;\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "binary"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "cmd"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "help"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "help",
            "\"--cons-dev\""
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "&exit"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetOutputBuffer",
          "args": [
            "cmd",
            "&help"
          ],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetOutputBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1869-1884",
          "snippet": "void\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetOutputBuffer(virCommandPtr cmd, char **outbuf)\n{\n    *outbuf = NULL;\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->outfdptr) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify output twice\");\n        return;\n    }\n\n    cmd->outbuf = outbuf;\n    cmd->outfdptr = &cmd->outfd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArg",
          "args": [
            "cmd",
            "\"--help\""
          ],
          "line": 197
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNew",
          "args": [
            "binary"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFindFileInPath",
          "args": [
            "\"grub-bhyve\""
          ],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "virFindFileInPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1657-1709",
          "snippet": "char *\nvirFindFileInPath(const char *file)\n{\n    const char *origpath = NULL;\n    VIR_AUTOSTRINGLIST paths = NULL;\n    char **pathiter;\n\n    if (file == NULL)\n        return NULL;\n\n    /* if we are passed an absolute path (starting with /), return a\n     * copy of that path, after validating that it is executable\n     */\n    if (g_path_is_absolute(file)) {\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        return g_strdup(file);\n    }\n\n    /* If we are passed an anchored path (containing a /), then there\n     * is no path search - it must exist in the current directory\n     */\n    if (strchr(file, '/')) {\n        char *abspath = NULL;\n\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        ignore_value(virFileAbsPath(file, &abspath));\n        return abspath;\n    }\n\n    /* copy PATH env so we can tweak it */\n    origpath = getenv(\"PATH\");\n    if (!origpath)\n        origpath = \"/bin:/usr/bin\";\n\n    /* for each path segment, append the file to search for and test for\n     * it. return it if found.\n     */\n\n    if (!(paths = virStringSplit(origpath, \":\", 0)))\n        return NULL;\n\n    for (pathiter = paths; *pathiter; pathiter++) {\n        g_autofree char *fullpath = g_strdup_printf(\"%s/%s\", *pathiter, file);\n        if (virFileIsExecutable(fullpath))\n            return g_steal_pointer(&fullpath);\n    }\n\n    return NULL;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirFindFileInPath(const char *file)\n{\n    const char *origpath = NULL;\n    VIR_AUTOSTRINGLIST paths = NULL;\n    char **pathiter;\n\n    if (file == NULL)\n        return NULL;\n\n    /* if we are passed an absolute path (starting with /), return a\n     * copy of that path, after validating that it is executable\n     */\n    if (g_path_is_absolute(file)) {\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        return g_strdup(file);\n    }\n\n    /* If we are passed an anchored path (containing a /), then there\n     * is no path search - it must exist in the current directory\n     */\n    if (strchr(file, '/')) {\n        char *abspath = NULL;\n\n        if (!virFileIsExecutable(file))\n            return NULL;\n\n        ignore_value(virFileAbsPath(file, &abspath));\n        return abspath;\n    }\n\n    /* copy PATH env so we can tweak it */\n    origpath = getenv(\"PATH\");\n    if (!origpath)\n        origpath = \"/bin:/usr/bin\";\n\n    /* for each path segment, append the file to search for and test for\n     * it. return it if found.\n     */\n\n    if (!(paths = virStringSplit(origpath, \":\", 0)))\n        return NULL;\n\n    for (pathiter = paths; *pathiter; pathiter++) {\n        g_autofree char *fullpath = g_strdup_printf(\"%s/%s\", *pathiter, file);\n        if (virFileIsExecutable(fullpath))\n            return g_steal_pointer(&fullpath);\n    }\n\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nint\nvirBhyveProbeGrubCaps(virBhyveGrubCapsFlags *caps)\n{\n    char *binary, *help;\n    virCommandPtr cmd;\n    int ret, exit;\n\n    ret = 0;\n    *caps = 0;\n    cmd = NULL;\n    help = NULL;\n\n    binary = virFindFileInPath(\"grub-bhyve\");\n    if (binary == NULL)\n        goto out;\n\n    cmd = virCommandNew(binary);\n    virCommandAddArg(cmd, \"--help\");\n    virCommandSetOutputBuffer(cmd, &help);\n    if (virCommandRun(cmd, &exit) < 0) {\n        ret = -1;\n        goto out;\n    }\n\n    if (strstr(help, \"--cons-dev\") != NULL)\n        *caps |= BHYVE_GRUB_CAP_CONSDEV;\n\n out:\n    VIR_FREE(help);\n    virCommandFree(cmd);\n    VIR_FREE(binary);\n    return ret;\n}"
  },
  {
    "function_name": "virBhyveDomainCapsBuild",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "128-178",
    "snippet": "virDomainCapsPtr\nvirBhyveDomainCapsBuild(bhyveConnPtr conn,\n                        const char *emulatorbin,\n                        const char *machine,\n                        virArch arch,\n                        virDomainVirtType virttype)\n{\n    virDomainCapsPtr caps = NULL;\n    unsigned int bhyve_caps = 0;\n    DIR *dir;\n    struct dirent *entry;\n    size_t firmwares_alloc = 0;\n    virBhyveDriverConfigPtr cfg = virBhyveDriverGetConfig(conn);\n    const char *firmware_dir = cfg->firmwareDir;\n    virDomainCapsStringValuesPtr firmwares = NULL;\n\n    if (!(caps = virDomainCapsNew(emulatorbin, machine, arch, virttype)))\n        goto cleanup;\n\n    if (virBhyveProbeCaps(&bhyve_caps)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"failed probing capabilities\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC(firmwares) < 0)\n        goto cleanup;\n\n    if (virDirOpenIfExists(&dir, firmware_dir) > 0) {\n        while ((virDirRead(dir, &entry, firmware_dir)) > 0) {\n            if (VIR_RESIZE_N(firmwares->values,\n                firmwares_alloc, firmwares->nvalues, 1) < 0)\n                goto cleanup;\n\n            firmwares->values[firmwares->nvalues] = g_strdup_printf(\"%s/%s\",\n                                                    firmware_dir, entry->d_name);\n            firmwares->nvalues++;\n        }\n    } else {\n        VIR_WARN(\"Cannot open firmware directory %s\", firmware_dir);\n    }\n\n    if (virBhyveDomainCapsFill(caps, bhyve_caps, firmwares) < 0)\n        goto cleanup;\n\n cleanup:\n    VIR_FREE(firmwares);\n    VIR_DIR_CLOSE(dir);\n    virObjectUnref(cfg);\n    return caps;\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "cfg"
          ],
          "line": 176
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DIR_CLOSE",
          "args": [
            "dir"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "firmwares"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBhyveDomainCapsFill",
          "args": [
            "caps",
            "bhyve_caps",
            "firmwares"
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "virBhyveDomainCapsFill",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "73-125",
          "snippet": "int\nvirBhyveDomainCapsFill(virDomainCapsPtr caps,\n                       unsigned int bhyvecaps,\n                       virDomainCapsStringValuesPtr firmwares)\n{\n    caps->disk.supported = VIR_TRISTATE_BOOL_YES;\n    caps->disk.diskDevice.report = true;\n    caps->disk.bus.report = true;\n    caps->disk.model.report = true;\n    VIR_DOMAIN_CAPS_ENUM_SET(caps->disk.diskDevice,\n                             VIR_DOMAIN_DISK_DEVICE_DISK,\n                             VIR_DOMAIN_DISK_DEVICE_CDROM);\n\n    VIR_DOMAIN_CAPS_ENUM_SET(caps->disk.bus,\n                             VIR_DOMAIN_DISK_BUS_SATA,\n                             VIR_DOMAIN_DISK_BUS_VIRTIO);\n\n    caps->os.supported = VIR_TRISTATE_BOOL_YES;\n\n    caps->os.loader.supported = VIR_TRISTATE_BOOL_NO;\n    if (bhyvecaps & BHYVE_CAP_LPC_BOOTROM) {\n        caps->os.loader.type.report = true;\n        caps->os.loader.readonly.report = true;\n        caps->os.loader.supported = VIR_TRISTATE_BOOL_YES;\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->os.loader.type,\n                                 VIR_DOMAIN_LOADER_TYPE_PFLASH);\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->os.loader.readonly,\n                                 VIR_TRISTATE_BOOL_YES);\n\n        caps->os.loader.values.values = firmwares->values;\n        caps->os.loader.values.nvalues = firmwares->nvalues;\n    }\n\n\n    caps->graphics.supported = VIR_TRISTATE_BOOL_NO;\n    caps->video.supported = VIR_TRISTATE_BOOL_NO;\n    if (bhyvecaps & BHYVE_CAP_FBUF) {\n        caps->graphics.supported = VIR_TRISTATE_BOOL_YES;\n        caps->graphics.type.report = true;\n        caps->video.supported = VIR_TRISTATE_BOOL_YES;\n        caps->video.modelType.report = true;\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->graphics.type, VIR_DOMAIN_GRAPHICS_TYPE_VNC);\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->video.modelType, VIR_DOMAIN_VIDEO_TYPE_GOP);\n    }\n\n    caps->hostdev.supported = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_IOTHREADS] = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_VMCOREINFO] = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_GENID] = VIR_TRISTATE_BOOL_NO;\n    caps->gic.supported = VIR_TRISTATE_BOOL_NO;\n\n    return 0;\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nint\nvirBhyveDomainCapsFill(virDomainCapsPtr caps,\n                       unsigned int bhyvecaps,\n                       virDomainCapsStringValuesPtr firmwares)\n{\n    caps->disk.supported = VIR_TRISTATE_BOOL_YES;\n    caps->disk.diskDevice.report = true;\n    caps->disk.bus.report = true;\n    caps->disk.model.report = true;\n    VIR_DOMAIN_CAPS_ENUM_SET(caps->disk.diskDevice,\n                             VIR_DOMAIN_DISK_DEVICE_DISK,\n                             VIR_DOMAIN_DISK_DEVICE_CDROM);\n\n    VIR_DOMAIN_CAPS_ENUM_SET(caps->disk.bus,\n                             VIR_DOMAIN_DISK_BUS_SATA,\n                             VIR_DOMAIN_DISK_BUS_VIRTIO);\n\n    caps->os.supported = VIR_TRISTATE_BOOL_YES;\n\n    caps->os.loader.supported = VIR_TRISTATE_BOOL_NO;\n    if (bhyvecaps & BHYVE_CAP_LPC_BOOTROM) {\n        caps->os.loader.type.report = true;\n        caps->os.loader.readonly.report = true;\n        caps->os.loader.supported = VIR_TRISTATE_BOOL_YES;\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->os.loader.type,\n                                 VIR_DOMAIN_LOADER_TYPE_PFLASH);\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->os.loader.readonly,\n                                 VIR_TRISTATE_BOOL_YES);\n\n        caps->os.loader.values.values = firmwares->values;\n        caps->os.loader.values.nvalues = firmwares->nvalues;\n    }\n\n\n    caps->graphics.supported = VIR_TRISTATE_BOOL_NO;\n    caps->video.supported = VIR_TRISTATE_BOOL_NO;\n    if (bhyvecaps & BHYVE_CAP_FBUF) {\n        caps->graphics.supported = VIR_TRISTATE_BOOL_YES;\n        caps->graphics.type.report = true;\n        caps->video.supported = VIR_TRISTATE_BOOL_YES;\n        caps->video.modelType.report = true;\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->graphics.type, VIR_DOMAIN_GRAPHICS_TYPE_VNC);\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->video.modelType, VIR_DOMAIN_VIDEO_TYPE_GOP);\n    }\n\n    caps->hostdev.supported = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_IOTHREADS] = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_VMCOREINFO] = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_GENID] = VIR_TRISTATE_BOOL_NO;\n    caps->gic.supported = VIR_TRISTATE_BOOL_NO;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Cannot open firmware directory %s\"",
            "firmware_dir"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/%s\"",
            "firmware_dir",
            "entry->d_name"
          ],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_RESIZE_N",
          "args": [
            "firmwares->values",
            "firmwares_alloc",
            "firmwares->nvalues",
            "1"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDirRead",
          "args": [
            "dir",
            "&entry",
            "firmware_dir"
          ],
          "line": 157
        },
        "resolved": true,
        "details": {
          "function_name": "virDirRead",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2940-2954",
          "snippet": "int virDirRead(DIR *dirp, struct dirent **ent, const char *name)\n{\n    do {\n        errno = 0;\n        *ent = readdir(dirp); /* exempt from syntax-check */\n        if (!*ent && errno) {\n            if (name)\n                virReportSystemError(errno, _(\"Unable to read directory '%s'\"),\n                                     name);\n            return -1;\n        }\n    } while (*ent && (STREQ((*ent)->d_name, \".\") ||\n                      STREQ((*ent)->d_name, \"..\")));\n    return !!*ent;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virDirRead(DIR *dirp, struct dirent **ent, const char *name)\n{\n    do {\n        errno = 0;\n        *ent = readdir(dirp); /* exempt from syntax-check */\n        if (!*ent && errno) {\n            if (name)\n                virReportSystemError(errno, _(\"Unable to read directory '%s'\"),\n                                     name);\n            return -1;\n        }\n    } while (*ent && (STREQ((*ent)->d_name, \".\") ||\n                      STREQ((*ent)->d_name, \"..\")));\n    return !!*ent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDirOpenIfExists",
          "args": [
            "&dir",
            "firmware_dir"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "virDirOpenIfExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "2898-2902",
          "snippet": "int\nvirDirOpenIfExists(DIR **dirp, const char *name)\n{\n    return virDirOpenInternal(dirp, name, true, false);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirDirOpenIfExists(DIR **dirp, const char *name)\n{\n    return virDirOpenInternal(dirp, name, true, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "firmwares"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"failed probing capabilities\")"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBhyveProbeCaps",
          "args": [
            "&bhyve_caps"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "virBhyveProbeCaps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
          "lines": "326-357",
          "snippet": "int\nvirBhyveProbeCaps(unsigned int *caps)\n{\n    char *binary;\n    int ret = 0;\n\n    binary = virFindFileInPath(\"bhyve\");\n    if (binary == NULL)\n        goto out;\n\n    if ((ret = bhyveProbeCapsFromHelp(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsAHCI32Slot(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsNetE1000(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsLPC_Bootrom(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsFramebuffer(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsXHCIController(caps, binary)))\n        goto out;\n\n out:\n    VIR_FREE(binary);\n    return ret;\n}",
          "includes": [
            "#include \"bhyve_conf.h\"",
            "#include \"bhyve_capabilities.h\"",
            "#include \"vircommand.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu/cpu.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include <sys/types.h>",
            "#include <dirent.h>",
            "#include <sys/utsname.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nint\nvirBhyveProbeCaps(unsigned int *caps)\n{\n    char *binary;\n    int ret = 0;\n\n    binary = virFindFileInPath(\"bhyve\");\n    if (binary == NULL)\n        goto out;\n\n    if ((ret = bhyveProbeCapsFromHelp(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsAHCI32Slot(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsNetE1000(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsLPC_Bootrom(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsFramebuffer(caps, binary)))\n        goto out;\n\n    if ((ret = bhyveProbeCapsXHCIController(caps, binary)))\n        goto out;\n\n out:\n    VIR_FREE(binary);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainCapsNew",
          "args": [
            "emulatorbin",
            "machine",
            "arch",
            "virttype"
          ],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainCapsNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_capabilities.c",
          "lines": "124-144",
          "snippet": "virDomainCapsPtr\nvirDomainCapsNew(const char *path,\n                 const char *machine,\n                 virArch arch,\n                 virDomainVirtType virttype)\n{\n    virDomainCapsPtr caps = NULL;\n\n    if (virDomainCapsInitialize() < 0)\n        return NULL;\n\n    if (!(caps = virObjectLockableNew(virDomainCapsClass)))\n        return NULL;\n\n    caps->path = g_strdup(path);\n    caps->machine = g_strdup(machine);\n    caps->arch = arch;\n    caps->virttype = virttype;\n\n    return caps;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_capabilities.h\"",
            "#include \"device_conf.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virDomainCapsClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"domain_conf.h\"\n#include \"domain_capabilities.h\"\n#include \"device_conf.h\"\n#include <config.h>\n\nstatic virClassPtr virDomainCapsClass;\n\nvirDomainCapsPtr\nvirDomainCapsNew(const char *path,\n                 const char *machine,\n                 virArch arch,\n                 virDomainVirtType virttype)\n{\n    virDomainCapsPtr caps = NULL;\n\n    if (virDomainCapsInitialize() < 0)\n        return NULL;\n\n    if (!(caps = virObjectLockableNew(virDomainCapsClass)))\n        return NULL;\n\n    caps->path = g_strdup(path);\n    caps->machine = g_strdup(machine);\n    caps->arch = arch;\n    caps->virttype = virttype;\n\n    return caps;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBhyveDriverGetConfig",
          "args": [
            "conn"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "virBhyveDriverGetConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_conf.c",
          "lines": "85-93",
          "snippet": "virBhyveDriverConfigPtr\nvirBhyveDriverGetConfig(bhyveConnPtr driver)\n{\n    virBhyveDriverConfigPtr cfg;\n    bhyveDriverLock(driver);\n    cfg = virObjectRef(driver->config);\n    bhyveDriverUnlock(driver);\n    return cfg;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"bhyve_domain.h\"",
            "#include \"bhyve_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"bhyve_domain.h\"\n#include \"bhyve_conf.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nvirBhyveDriverConfigPtr\nvirBhyveDriverGetConfig(bhyveConnPtr driver)\n{\n    virBhyveDriverConfigPtr cfg;\n    bhyveDriverLock(driver);\n    cfg = virObjectRef(driver->config);\n    bhyveDriverUnlock(driver);\n    return cfg;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nvirDomainCapsPtr\nvirBhyveDomainCapsBuild(bhyveConnPtr conn,\n                        const char *emulatorbin,\n                        const char *machine,\n                        virArch arch,\n                        virDomainVirtType virttype)\n{\n    virDomainCapsPtr caps = NULL;\n    unsigned int bhyve_caps = 0;\n    DIR *dir;\n    struct dirent *entry;\n    size_t firmwares_alloc = 0;\n    virBhyveDriverConfigPtr cfg = virBhyveDriverGetConfig(conn);\n    const char *firmware_dir = cfg->firmwareDir;\n    virDomainCapsStringValuesPtr firmwares = NULL;\n\n    if (!(caps = virDomainCapsNew(emulatorbin, machine, arch, virttype)))\n        goto cleanup;\n\n    if (virBhyveProbeCaps(&bhyve_caps)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"failed probing capabilities\"));\n        goto cleanup;\n    }\n\n    if (VIR_ALLOC(firmwares) < 0)\n        goto cleanup;\n\n    if (virDirOpenIfExists(&dir, firmware_dir) > 0) {\n        while ((virDirRead(dir, &entry, firmware_dir)) > 0) {\n            if (VIR_RESIZE_N(firmwares->values,\n                firmwares_alloc, firmwares->nvalues, 1) < 0)\n                goto cleanup;\n\n            firmwares->values[firmwares->nvalues] = g_strdup_printf(\"%s/%s\",\n                                                    firmware_dir, entry->d_name);\n            firmwares->nvalues++;\n        }\n    } else {\n        VIR_WARN(\"Cannot open firmware directory %s\", firmware_dir);\n    }\n\n    if (virBhyveDomainCapsFill(caps, bhyve_caps, firmwares) < 0)\n        goto cleanup;\n\n cleanup:\n    VIR_FREE(firmwares);\n    VIR_DIR_CLOSE(dir);\n    virObjectUnref(cfg);\n    return caps;\n}"
  },
  {
    "function_name": "virBhyveDomainCapsFill",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "73-125",
    "snippet": "int\nvirBhyveDomainCapsFill(virDomainCapsPtr caps,\n                       unsigned int bhyvecaps,\n                       virDomainCapsStringValuesPtr firmwares)\n{\n    caps->disk.supported = VIR_TRISTATE_BOOL_YES;\n    caps->disk.diskDevice.report = true;\n    caps->disk.bus.report = true;\n    caps->disk.model.report = true;\n    VIR_DOMAIN_CAPS_ENUM_SET(caps->disk.diskDevice,\n                             VIR_DOMAIN_DISK_DEVICE_DISK,\n                             VIR_DOMAIN_DISK_DEVICE_CDROM);\n\n    VIR_DOMAIN_CAPS_ENUM_SET(caps->disk.bus,\n                             VIR_DOMAIN_DISK_BUS_SATA,\n                             VIR_DOMAIN_DISK_BUS_VIRTIO);\n\n    caps->os.supported = VIR_TRISTATE_BOOL_YES;\n\n    caps->os.loader.supported = VIR_TRISTATE_BOOL_NO;\n    if (bhyvecaps & BHYVE_CAP_LPC_BOOTROM) {\n        caps->os.loader.type.report = true;\n        caps->os.loader.readonly.report = true;\n        caps->os.loader.supported = VIR_TRISTATE_BOOL_YES;\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->os.loader.type,\n                                 VIR_DOMAIN_LOADER_TYPE_PFLASH);\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->os.loader.readonly,\n                                 VIR_TRISTATE_BOOL_YES);\n\n        caps->os.loader.values.values = firmwares->values;\n        caps->os.loader.values.nvalues = firmwares->nvalues;\n    }\n\n\n    caps->graphics.supported = VIR_TRISTATE_BOOL_NO;\n    caps->video.supported = VIR_TRISTATE_BOOL_NO;\n    if (bhyvecaps & BHYVE_CAP_FBUF) {\n        caps->graphics.supported = VIR_TRISTATE_BOOL_YES;\n        caps->graphics.type.report = true;\n        caps->video.supported = VIR_TRISTATE_BOOL_YES;\n        caps->video.modelType.report = true;\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->graphics.type, VIR_DOMAIN_GRAPHICS_TYPE_VNC);\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->video.modelType, VIR_DOMAIN_VIDEO_TYPE_GOP);\n    }\n\n    caps->hostdev.supported = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_IOTHREADS] = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_VMCOREINFO] = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_GENID] = VIR_TRISTATE_BOOL_NO;\n    caps->gic.supported = VIR_TRISTATE_BOOL_NO;\n\n    return 0;\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DOMAIN_CAPS_ENUM_SET",
          "args": [
            "caps->video.modelType",
            "VIR_DOMAIN_VIDEO_TYPE_GOP"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DOMAIN_CAPS_ENUM_SET",
          "args": [
            "caps->graphics.type",
            "VIR_DOMAIN_GRAPHICS_TYPE_VNC"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DOMAIN_CAPS_ENUM_SET",
          "args": [
            "caps->os.loader.readonly",
            "VIR_TRISTATE_BOOL_YES"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DOMAIN_CAPS_ENUM_SET",
          "args": [
            "caps->os.loader.type",
            "VIR_DOMAIN_LOADER_TYPE_PFLASH"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DOMAIN_CAPS_ENUM_SET",
          "args": [
            "caps->disk.bus",
            "VIR_DOMAIN_DISK_BUS_SATA",
            "VIR_DOMAIN_DISK_BUS_VIRTIO"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DOMAIN_CAPS_ENUM_SET",
          "args": [
            "caps->disk.diskDevice",
            "VIR_DOMAIN_DISK_DEVICE_DISK",
            "VIR_DOMAIN_DISK_DEVICE_CDROM"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nint\nvirBhyveDomainCapsFill(virDomainCapsPtr caps,\n                       unsigned int bhyvecaps,\n                       virDomainCapsStringValuesPtr firmwares)\n{\n    caps->disk.supported = VIR_TRISTATE_BOOL_YES;\n    caps->disk.diskDevice.report = true;\n    caps->disk.bus.report = true;\n    caps->disk.model.report = true;\n    VIR_DOMAIN_CAPS_ENUM_SET(caps->disk.diskDevice,\n                             VIR_DOMAIN_DISK_DEVICE_DISK,\n                             VIR_DOMAIN_DISK_DEVICE_CDROM);\n\n    VIR_DOMAIN_CAPS_ENUM_SET(caps->disk.bus,\n                             VIR_DOMAIN_DISK_BUS_SATA,\n                             VIR_DOMAIN_DISK_BUS_VIRTIO);\n\n    caps->os.supported = VIR_TRISTATE_BOOL_YES;\n\n    caps->os.loader.supported = VIR_TRISTATE_BOOL_NO;\n    if (bhyvecaps & BHYVE_CAP_LPC_BOOTROM) {\n        caps->os.loader.type.report = true;\n        caps->os.loader.readonly.report = true;\n        caps->os.loader.supported = VIR_TRISTATE_BOOL_YES;\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->os.loader.type,\n                                 VIR_DOMAIN_LOADER_TYPE_PFLASH);\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->os.loader.readonly,\n                                 VIR_TRISTATE_BOOL_YES);\n\n        caps->os.loader.values.values = firmwares->values;\n        caps->os.loader.values.nvalues = firmwares->nvalues;\n    }\n\n\n    caps->graphics.supported = VIR_TRISTATE_BOOL_NO;\n    caps->video.supported = VIR_TRISTATE_BOOL_NO;\n    if (bhyvecaps & BHYVE_CAP_FBUF) {\n        caps->graphics.supported = VIR_TRISTATE_BOOL_YES;\n        caps->graphics.type.report = true;\n        caps->video.supported = VIR_TRISTATE_BOOL_YES;\n        caps->video.modelType.report = true;\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->graphics.type, VIR_DOMAIN_GRAPHICS_TYPE_VNC);\n        VIR_DOMAIN_CAPS_ENUM_SET(caps->video.modelType, VIR_DOMAIN_VIDEO_TYPE_GOP);\n    }\n\n    caps->hostdev.supported = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_IOTHREADS] = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_VMCOREINFO] = VIR_TRISTATE_BOOL_NO;\n    caps->features[VIR_DOMAIN_CAPS_FEATURE_GENID] = VIR_TRISTATE_BOOL_NO;\n    caps->gic.supported = VIR_TRISTATE_BOOL_NO;\n\n    return 0;\n}"
  },
  {
    "function_name": "virBhyveCapsBuild",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/bhyve/bhyve_capabilities.c",
    "lines": "43-71",
    "snippet": "virCapsPtr\nvirBhyveCapsBuild(void)\n{\n    virCapsPtr caps;\n    virCapsGuestPtr guest;\n\n    if ((caps = virCapabilitiesNew(virArchFromHost(),\n                                   false, false)) == NULL)\n        return NULL;\n\n    if ((guest = virCapabilitiesAddGuest(caps, VIR_DOMAIN_OSTYPE_HVM,\n                                         VIR_ARCH_X86_64,\n                                         \"bhyve\",\n                                         NULL, 0, NULL)) == NULL)\n        goto error;\n\n    if (virCapabilitiesAddGuestDomain(guest, VIR_DOMAIN_VIRT_BHYVE,\n                                      NULL, NULL, 0, NULL) == NULL)\n        goto error;\n\n    if (!(caps->host.cpu = virCPUProbeHost(caps->host.arch)))\n        VIR_WARN(\"Failed to get host CPU\");\n\n    return caps;\n\n error:\n    virObjectUnref(caps);\n    return NULL;\n}",
    "includes": [
      "#include \"bhyve_conf.h\"",
      "#include \"bhyve_capabilities.h\"",
      "#include \"vircommand.h\"",
      "#include \"domain_conf.h\"",
      "#include \"cpu/cpu.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include <sys/types.h>",
      "#include <dirent.h>",
      "#include <sys/utsname.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "caps"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to get host CPU\""
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCPUProbeHost",
          "args": [
            "caps->host.arch"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "virCPUProbeHost",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/cpu/cpu.c",
          "lines": "454-463",
          "snippet": "virCPUDefPtr\nvirCPUProbeHost(virArch arch)\n{\n    virNodeInfo nodeinfo;\n\n    if (virCapabilitiesGetNodeInfo(&nodeinfo) < 0)\n        return NULL;\n\n    return virCPUGetHost(arch, VIR_CPU_TYPE_HOST, &nodeinfo, NULL);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"capabilities.h\"",
            "#include \"cpu_arm.h\"",
            "#include \"cpu_s390.h\"",
            "#include \"cpu_ppc64.h\"",
            "#include \"cpu_x86.h\"",
            "#include \"cpu_map.h\"",
            "#include \"cpu.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"capabilities.h\"\n#include \"cpu_arm.h\"\n#include \"cpu_s390.h\"\n#include \"cpu_ppc64.h\"\n#include \"cpu_x86.h\"\n#include \"cpu_map.h\"\n#include \"cpu.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include <config.h>\n\nvirCPUDefPtr\nvirCPUProbeHost(virArch arch)\n{\n    virNodeInfo nodeinfo;\n\n    if (virCapabilitiesGetNodeInfo(&nodeinfo) < 0)\n        return NULL;\n\n    return virCPUGetHost(arch, VIR_CPU_TYPE_HOST, &nodeinfo, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCapabilitiesAddGuestDomain",
          "args": [
            "guest",
            "VIR_DOMAIN_VIRT_BHYVE",
            "NULL",
            "NULL",
            "0",
            "NULL"
          ],
          "line": 59
        },
        "resolved": true,
        "details": {
          "function_name": "virCapabilitiesAddGuestDomain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/capabilities.c",
          "lines": "485-518",
          "snippet": "virCapsGuestDomainPtr\nvirCapabilitiesAddGuestDomain(virCapsGuestPtr guest,\n                              int hvtype,\n                              const char *emulator,\n                              const char *loader,\n                              int nmachines,\n                              virCapsGuestMachinePtr *machines)\n{\n    virCapsGuestDomainPtr dom;\n\n    if (VIR_ALLOC(dom) < 0)\n        goto error;\n\n    dom->type = hvtype;\n    dom->info.emulator = g_strdup(emulator);\n    dom->info.loader = g_strdup(loader);\n\n    if (VIR_RESIZE_N(guest->arch.domains, guest->arch.ndomains_max,\n                     guest->arch.ndomains, 1) < 0)\n        goto error;\n    guest->arch.domains[guest->arch.ndomains] = dom;\n    guest->arch.ndomains++;\n\n    if (nmachines) {\n        dom->info.nmachines = nmachines;\n        dom->info.machines = machines;\n    }\n\n    return dom;\n\n error:\n    virCapabilitiesFreeGuestDomain(dom);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virenum.h\"",
            "#include \"viruuid.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virstring.h\"",
            "#include \"virnuma.h\"",
            "#include \"virlog.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virarch.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"capabilities.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virenum.h\"\n#include \"viruuid.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virnuma.h\"\n#include \"virlog.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"virarch.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"domain_conf.h\"\n#include \"cpu_conf.h\"\n#include \"capabilities.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirCapsGuestDomainPtr\nvirCapabilitiesAddGuestDomain(virCapsGuestPtr guest,\n                              int hvtype,\n                              const char *emulator,\n                              const char *loader,\n                              int nmachines,\n                              virCapsGuestMachinePtr *machines)\n{\n    virCapsGuestDomainPtr dom;\n\n    if (VIR_ALLOC(dom) < 0)\n        goto error;\n\n    dom->type = hvtype;\n    dom->info.emulator = g_strdup(emulator);\n    dom->info.loader = g_strdup(loader);\n\n    if (VIR_RESIZE_N(guest->arch.domains, guest->arch.ndomains_max,\n                     guest->arch.ndomains, 1) < 0)\n        goto error;\n    guest->arch.domains[guest->arch.ndomains] = dom;\n    guest->arch.ndomains++;\n\n    if (nmachines) {\n        dom->info.nmachines = nmachines;\n        dom->info.machines = machines;\n    }\n\n    return dom;\n\n error:\n    virCapabilitiesFreeGuestDomain(dom);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCapabilitiesAddGuest",
          "args": [
            "caps",
            "VIR_DOMAIN_OSTYPE_HVM",
            "VIR_ARCH_X86_64",
            "\"bhyve\"",
            "NULL",
            "0",
            "NULL"
          ],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "virCapabilitiesAddGuest",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/capabilities.c",
          "lines": "434-470",
          "snippet": "virCapsGuestPtr\nvirCapabilitiesAddGuest(virCapsPtr caps,\n                        int ostype,\n                        virArch arch,\n                        const char *emulator,\n                        const char *loader,\n                        int nmachines,\n                        virCapsGuestMachinePtr *machines)\n{\n    virCapsGuestPtr guest;\n\n    if (VIR_ALLOC(guest) < 0)\n        goto error;\n\n    guest->ostype = ostype;\n    guest->arch.id = arch;\n    guest->arch.wordsize = virArchGetWordSize(arch);\n\n    guest->arch.defaultInfo.emulator = g_strdup(emulator);\n    guest->arch.defaultInfo.loader = g_strdup(loader);\n\n    if (VIR_RESIZE_N(caps->guests, caps->nguests_max,\n                     caps->nguests, 1) < 0)\n        goto error;\n    caps->guests[caps->nguests++] = guest;\n\n    if (nmachines) {\n        guest->arch.defaultInfo.nmachines = nmachines;\n        guest->arch.defaultInfo.machines = machines;\n    }\n\n    return guest;\n\n error:\n    virCapabilitiesFreeGuest(guest);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virenum.h\"",
            "#include \"viruuid.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virstring.h\"",
            "#include \"virnuma.h\"",
            "#include \"virlog.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virarch.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"capabilities.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virenum.h\"\n#include \"viruuid.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virnuma.h\"\n#include \"virlog.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"virarch.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"domain_conf.h\"\n#include \"cpu_conf.h\"\n#include \"capabilities.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirCapsGuestPtr\nvirCapabilitiesAddGuest(virCapsPtr caps,\n                        int ostype,\n                        virArch arch,\n                        const char *emulator,\n                        const char *loader,\n                        int nmachines,\n                        virCapsGuestMachinePtr *machines)\n{\n    virCapsGuestPtr guest;\n\n    if (VIR_ALLOC(guest) < 0)\n        goto error;\n\n    guest->ostype = ostype;\n    guest->arch.id = arch;\n    guest->arch.wordsize = virArchGetWordSize(arch);\n\n    guest->arch.defaultInfo.emulator = g_strdup(emulator);\n    guest->arch.defaultInfo.loader = g_strdup(loader);\n\n    if (VIR_RESIZE_N(caps->guests, caps->nguests_max,\n                     caps->nguests, 1) < 0)\n        goto error;\n    caps->guests[caps->nguests++] = guest;\n\n    if (nmachines) {\n        guest->arch.defaultInfo.nmachines = nmachines;\n        guest->arch.defaultInfo.machines = machines;\n    }\n\n    return guest;\n\n error:\n    virCapabilitiesFreeGuest(guest);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCapabilitiesNew",
          "args": [
            "virArchFromHost()",
            "false",
            "false"
          ],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "virCapabilitiesNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/capabilities.c",
          "lines": "78-96",
          "snippet": "virCapsPtr\nvirCapabilitiesNew(virArch hostarch,\n                   bool offlineMigrate,\n                   bool liveMigrate)\n{\n    virCapsPtr caps;\n\n    if (virCapabilitiesInitialize() < 0)\n        return NULL;\n\n    if (!(caps = virObjectNew(virCapsClass)))\n        return NULL;\n\n    caps->host.arch = hostarch;\n    caps->host.offlineMigrate = offlineMigrate;\n    caps->host.liveMigrate = liveMigrate;\n\n    return caps;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virenum.h\"",
            "#include \"viruuid.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virstring.h\"",
            "#include \"virnuma.h\"",
            "#include \"virlog.h\"",
            "#include \"virhostmem.h\"",
            "#include \"virhostcpu.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virarch.h\"",
            "#include \"viralloc.h\"",
            "#include \"storage_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"cpu_conf.h\"",
            "#include \"capabilities.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virCapsClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virenum.h\"\n#include \"viruuid.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virnuma.h\"\n#include \"virlog.h\"\n#include \"virhostmem.h\"\n#include \"virhostcpu.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"virarch.h\"\n#include \"viralloc.h\"\n#include \"storage_conf.h\"\n#include \"domain_conf.h\"\n#include \"cpu_conf.h\"\n#include \"capabilities.h\"\n#include <unistd.h>\n#include <config.h>\n\nstatic virClassPtr virCapsClass;\n\nvirCapsPtr\nvirCapabilitiesNew(virArch hostarch,\n                   bool offlineMigrate,\n                   bool liveMigrate)\n{\n    virCapsPtr caps;\n\n    if (virCapabilitiesInitialize() < 0)\n        return NULL;\n\n    if (!(caps = virObjectNew(virCapsClass)))\n        return NULL;\n\n    caps->host.arch = hostarch;\n    caps->host.offlineMigrate = offlineMigrate;\n    caps->host.liveMigrate = liveMigrate;\n\n    return caps;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virArchFromHost",
          "args": [],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "virArchFromHost",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virarch.c",
          "lines": "206-235",
          "snippet": "virArch virArchFromHost(void)\n{\n    struct utsname ut;\n    virArch arch;\n\n    uname(&ut);\n\n    /* Some special cases we need to handle first\n     * for non-canonical names */\n    if (strlen(ut.machine) == 4 &&\n        ut.machine[0] == 'i' &&\n        ut.machine[2] == '8' &&\n        ut.machine[3] == '6' &&\n        ut.machine[4] == '\\0') {\n        arch = VIR_ARCH_I686;\n    } else if (STREQ(ut.machine, \"amd64\")) {\n        arch = VIR_ARCH_X86_64;\n    } else {\n        /* Otherwise assume the canonical name */\n        if ((arch = virArchFromString(ut.machine)) == VIR_ARCH_NONE) {\n            VIR_WARN(\"Unknown host arch %s, report to libvir-list@redhat.com\",\n                     ut.machine);\n        }\n    }\n\n    VIR_DEBUG(\"Mapped %s to %d (%s)\",\n              ut.machine, arch, virArchToString(arch));\n\n    return arch;\n}",
          "includes": [
            "#include \"virarch.h\"",
            "#include \"virlog.h\"",
            "# include <sys/utsname.h>",
            "# include <windows.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virarch.h\"\n#include \"virlog.h\"\n# include <sys/utsname.h>\n# include <windows.h>\n#include <config.h>\n\nvirArch virArchFromHost(void)\n{\n    struct utsname ut;\n    virArch arch;\n\n    uname(&ut);\n\n    /* Some special cases we need to handle first\n     * for non-canonical names */\n    if (strlen(ut.machine) == 4 &&\n        ut.machine[0] == 'i' &&\n        ut.machine[2] == '8' &&\n        ut.machine[3] == '6' &&\n        ut.machine[4] == '\\0') {\n        arch = VIR_ARCH_I686;\n    } else if (STREQ(ut.machine, \"amd64\")) {\n        arch = VIR_ARCH_X86_64;\n    } else {\n        /* Otherwise assume the canonical name */\n        if ((arch = virArchFromString(ut.machine)) == VIR_ARCH_NONE) {\n            VIR_WARN(\"Unknown host arch %s, report to libvir-list@redhat.com\",\n                     ut.machine);\n        }\n    }\n\n    VIR_DEBUG(\"Mapped %s to %d (%s)\",\n              ut.machine, arch, virArchToString(arch));\n\n    return arch;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bhyve_conf.h\"\n#include \"bhyve_capabilities.h\"\n#include \"vircommand.h\"\n#include \"domain_conf.h\"\n#include \"cpu/cpu.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include <sys/types.h>\n#include <dirent.h>\n#include <sys/utsname.h>\n#include <config.h>\n\nvirCapsPtr\nvirBhyveCapsBuild(void)\n{\n    virCapsPtr caps;\n    virCapsGuestPtr guest;\n\n    if ((caps = virCapabilitiesNew(virArchFromHost(),\n                                   false, false)) == NULL)\n        return NULL;\n\n    if ((guest = virCapabilitiesAddGuest(caps, VIR_DOMAIN_OSTYPE_HVM,\n                                         VIR_ARCH_X86_64,\n                                         \"bhyve\",\n                                         NULL, 0, NULL)) == NULL)\n        goto error;\n\n    if (virCapabilitiesAddGuestDomain(guest, VIR_DOMAIN_VIRT_BHYVE,\n                                      NULL, NULL, 0, NULL) == NULL)\n        goto error;\n\n    if (!(caps->host.cpu = virCPUProbeHost(caps->host.arch)))\n        VIR_WARN(\"Failed to get host CPU\");\n\n    return caps;\n\n error:\n    virObjectUnref(caps);\n    return NULL;\n}"
  }
]