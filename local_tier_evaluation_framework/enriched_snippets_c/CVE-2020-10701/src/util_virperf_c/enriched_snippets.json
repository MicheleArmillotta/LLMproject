[
  {
    "function_name": "virPerfFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "385-399",
    "snippet": "void\nvirPerfFree(virPerfPtr perf)\n{\n    size_t i;\n\n    if (perf == NULL)\n        return;\n\n    for (i = 0; i < VIR_PERF_EVENT_LAST; i++) {\n        if (perf->events[i].enabled)\n            virPerfEventDisable(perf, i);\n    }\n\n    VIR_FREE(perf);\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "perf"
          ],
          "line": 398
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPerfEventDisable",
          "args": [
            "perf",
            "i"
          ],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "virPerfEventDisable",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
          "lines": "337-344",
          "snippet": "int\nvirPerfEventDisable(virPerfPtr perf G_GNUC_UNUSED,\n                    virPerfEventType type G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Perf not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "# include <linux/perf_event.h>",
            "#include \"viralloc.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virperf.h\"",
            "# include <sys/syscall.h>",
            "# include <sys/ioctl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPerfEventDisable(virPerfPtr perf G_GNUC_UNUSED,\n                    virPerfEventType type G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Perf not supported on this platform\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid\nvirPerfFree(virPerfPtr perf)\n{\n    size_t i;\n\n    if (perf == NULL)\n        return;\n\n    for (i = 0; i < VIR_PERF_EVENT_LAST; i++) {\n        if (perf->events[i].enabled)\n            virPerfEventDisable(perf, i);\n    }\n\n    VIR_FREE(perf);\n}"
  },
  {
    "function_name": "virPerfNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "365-383",
    "snippet": "virPerfPtr\nvirPerfNew(void)\n{\n    size_t i;\n    virPerfPtr perf;\n\n    if (VIR_ALLOC(perf) < 0)\n        return NULL;\n\n    for (i = 0; i < VIR_PERF_EVENT_LAST; i++) {\n        perf->events[i].fd = -1;\n        perf->events[i].enabled = false;\n    }\n\n    if (virPerfRdtAttrInit() < 0)\n        virResetLastError();\n\n    return perf;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virResetLastError",
          "args": [],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "virResetLastError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virerror.c",
          "lines": "500-506",
          "snippet": "void\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}",
          "includes": [
            "#include \"virerrorpriv.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virerrorpriv.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirResetLastError(void)\n{\n    virErrorPtr err = virLastErrorObject();\n    if (err)\n        virResetError(err);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPerfRdtAttrInit",
          "args": [],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "virPerfRdtAttrInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
          "lines": "320-324",
          "snippet": "static int\nvirPerfRdtAttrInit(void)\n{\n    return 0;\n}",
          "includes": [
            "# include <linux/perf_event.h>",
            "#include \"viralloc.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virperf.h\"",
            "# include <sys/syscall.h>",
            "# include <sys/ioctl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirPerfRdtAttrInit(void)\n{\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "perf"
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirPerfPtr\nvirPerfNew(void)\n{\n    size_t i;\n    virPerfPtr perf;\n\n    if (VIR_ALLOC(perf) < 0)\n        return NULL;\n\n    for (i = 0; i < VIR_PERF_EVENT_LAST; i++) {\n        perf->events[i].fd = -1;\n        perf->events[i].enabled = false;\n    }\n\n    if (virPerfRdtAttrInit() < 0)\n        virResetLastError();\n\n    return perf;\n}"
  },
  {
    "function_name": "virPerfReadEvent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "353-361",
    "snippet": "int\nvirPerfReadEvent(virPerfPtr perf G_GNUC_UNUSED,\n                 virPerfEventType type G_GNUC_UNUSED,\n                 uint64_t *value G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Perf not supported on this platform\"));\n    return -1;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENXIO",
            "\"%s\"",
            "_(\"Perf not supported on this platform\")"
          ],
          "line": 358
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Perf not supported on this platform\""
          ],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPerfReadEvent(virPerfPtr perf G_GNUC_UNUSED,\n                 virPerfEventType type G_GNUC_UNUSED,\n                 uint64_t *value G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Perf not supported on this platform\"));\n    return -1;\n}"
  },
  {
    "function_name": "virPerfEventIsEnabled",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "346-351",
    "snippet": "bool\nvirPerfEventIsEnabled(virPerfPtr perf G_GNUC_UNUSED,\n                      virPerfEventType type G_GNUC_UNUSED)\n{\n    return false;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nbool\nvirPerfEventIsEnabled(virPerfPtr perf G_GNUC_UNUSED,\n                      virPerfEventType type G_GNUC_UNUSED)\n{\n    return false;\n}"
  },
  {
    "function_name": "virPerfEventDisable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "337-344",
    "snippet": "int\nvirPerfEventDisable(virPerfPtr perf G_GNUC_UNUSED,\n                    virPerfEventType type G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Perf not supported on this platform\"));\n    return -1;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENXIO",
            "\"%s\"",
            "_(\"Perf not supported on this platform\")"
          ],
          "line": 341
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Perf not supported on this platform\""
          ],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPerfEventDisable(virPerfPtr perf G_GNUC_UNUSED,\n                    virPerfEventType type G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Perf not supported on this platform\"));\n    return -1;\n}"
  },
  {
    "function_name": "virPerfEventEnable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "327-335",
    "snippet": "int\nvirPerfEventEnable(virPerfPtr perf G_GNUC_UNUSED,\n                   virPerfEventType type G_GNUC_UNUSED,\n                   pid_t pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Perf not supported on this platform\"));\n    return -1;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "ENXIO",
            "\"%s\"",
            "_(\"Perf not supported on this platform\")"
          ],
          "line": 332
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Perf not supported on this platform\""
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPerfEventEnable(virPerfPtr perf G_GNUC_UNUSED,\n                   virPerfEventType type G_GNUC_UNUSED,\n                   pid_t pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENXIO, \"%s\",\n                         _(\"Perf not supported on this platform\"));\n    return -1;\n}"
  },
  {
    "function_name": "virPerfRdtAttrInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "320-324",
    "snippet": "static int\nvirPerfRdtAttrInit(void)\n{\n    return 0;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirPerfRdtAttrInit(void)\n{\n    return 0;\n}"
  },
  {
    "function_name": "virPerfReadEvent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "298-317",
    "snippet": "int\nvirPerfReadEvent(virPerfPtr perf,\n                 virPerfEventType type,\n                 uint64_t *value)\n{\n    virPerfEventPtr event = &perf->events[type];\n    if (!event->enabled)\n        return -1;\n\n    if (saferead(event->fd, value, sizeof(uint64_t)) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to read cache data\"));\n        return -1;\n    }\n\n    if (type == VIR_PERF_EVENT_CMT)\n        *value *= event->efields.cmt.scale;\n\n    return 0;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Unable to read cache data\")"
          ],
          "line": 308
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to read cache data\""
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "saferead",
          "args": [
            "event->fd",
            "value",
            "sizeof(uint64_t)"
          ],
          "line": 307
        },
        "resolved": true,
        "details": {
          "function_name": "saferead_lim",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1330-1372",
          "snippet": "static char *\nsaferead_lim(int fd, size_t max_len, size_t *length)\n{\n    char *buf = NULL;\n    size_t alloc = 0;\n    size_t size = 0;\n    int save_errno;\n\n    for (;;) {\n        int count;\n        int requested;\n\n        if (size + BUFSIZ + 1 > alloc) {\n            alloc += alloc / 2;\n            if (alloc < size + BUFSIZ + 1)\n                alloc = size + BUFSIZ + 1;\n\n            if (VIR_REALLOC_N(buf, alloc) < 0) {\n                save_errno = errno;\n                break;\n            }\n        }\n\n        /* Ensure that (size + requested <= max_len); */\n        requested = MIN(size < max_len ? max_len - size : 0,\n                        alloc - size - 1);\n        count = saferead(fd, buf + size, requested);\n        size += count;\n\n        if (count != requested || requested == 0) {\n            save_errno = errno;\n            if (count < 0)\n                break;\n            buf[size] = '\\0';\n            *length = size;\n            return buf;\n        }\n    }\n\n    VIR_FREE(buf);\n    errno = save_errno;\n    return NULL;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nstatic char *\nsaferead_lim(int fd, size_t max_len, size_t *length)\n{\n    char *buf = NULL;\n    size_t alloc = 0;\n    size_t size = 0;\n    int save_errno;\n\n    for (;;) {\n        int count;\n        int requested;\n\n        if (size + BUFSIZ + 1 > alloc) {\n            alloc += alloc / 2;\n            if (alloc < size + BUFSIZ + 1)\n                alloc = size + BUFSIZ + 1;\n\n            if (VIR_REALLOC_N(buf, alloc) < 0) {\n                save_errno = errno;\n                break;\n            }\n        }\n\n        /* Ensure that (size + requested <= max_len); */\n        requested = MIN(size < max_len ? max_len - size : 0,\n                        alloc - size - 1);\n        count = saferead(fd, buf + size, requested);\n        size += count;\n\n        if (count != requested || requested == 0) {\n            save_errno = errno;\n            if (count < 0)\n                break;\n            buf[size] = '\\0';\n            *length = size;\n            return buf;\n        }\n    }\n\n    VIR_FREE(buf);\n    errno = save_errno;\n    return NULL;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPerfReadEvent(virPerfPtr perf,\n                 virPerfEventType type,\n                 uint64_t *value)\n{\n    virPerfEventPtr event = &perf->events[type];\n    if (!event->enabled)\n        return -1;\n\n    if (saferead(event->fd, value, sizeof(uint64_t)) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"Unable to read cache data\"));\n        return -1;\n    }\n\n    if (type == VIR_PERF_EVENT_CMT)\n        *value *= event->efields.cmt.scale;\n\n    return 0;\n}"
  },
  {
    "function_name": "virPerfEventIsEnabled",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "292-296",
    "snippet": "bool virPerfEventIsEnabled(virPerfPtr perf,\n                           virPerfEventType type)\n{\n    return perf && perf->events[type].enabled;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nbool virPerfEventIsEnabled(virPerfPtr perf,\n                           virPerfEventType type)\n{\n    return perf && perf->events[type].enabled;\n}"
  },
  {
    "function_name": "virPerfEventDisable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "271-290",
    "snippet": "int\nvirPerfEventDisable(virPerfPtr perf,\n                    virPerfEventType type)\n{\n    virPerfEventPtr event = &(perf->events[type]);\n\n    if (!event->enabled)\n        return 0;\n\n    if (ioctl(event->fd, PERF_EVENT_IOC_DISABLE) < 0) {\n        virReportSystemError(errno,\n                             _(\"unable to disable host cpu perf event for %s\"),\n                             virPerfEventTypeToString(type));\n        return -1;\n    }\n\n    event->enabled = false;\n    VIR_FORCE_CLOSE(event->fd);\n    return 0;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "event->fd"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unable to disable host cpu perf event for %s\")",
            "virPerfEventTypeToString(type)"
          ],
          "line": 281
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPerfEventTypeToString",
          "args": [
            "type"
          ],
          "line": 283
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unable to disable host cpu perf event for %s\""
          ],
          "line": 282
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "event->fd",
            "PERF_EVENT_IOC_DISABLE"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPerfEventDisable(virPerfPtr perf,\n                    virPerfEventType type)\n{\n    virPerfEventPtr event = &(perf->events[type]);\n\n    if (!event->enabled)\n        return 0;\n\n    if (ioctl(event->fd, PERF_EVENT_IOC_DISABLE) < 0) {\n        virReportSystemError(errno,\n                             _(\"unable to disable host cpu perf event for %s\"),\n                             virPerfEventTypeToString(type));\n        return -1;\n    }\n\n    event->enabled = false;\n    VIR_FORCE_CLOSE(event->fd);\n    return 0;\n}"
  },
  {
    "function_name": "virPerfEventEnable",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "205-269",
    "snippet": "int\nvirPerfEventEnable(virPerfPtr perf,\n                   virPerfEventType type,\n                   pid_t pid)\n{\n    struct perf_event_attr attr;\n    virPerfEventPtr event = &(perf->events[type]);\n    virPerfEventAttrPtr event_attr = &attrs[type];\n\n    if (event->enabled)\n        return 0;\n\n    if (event_attr->attrType == 0 && (type == VIR_PERF_EVENT_CMT ||\n                                      type == VIR_PERF_EVENT_MBMT ||\n                                      type == VIR_PERF_EVENT_MBML)) {\n        virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                       _(\"unable to enable host cpu perf event for %s\"),\n                       virPerfEventTypeToString(type));\n        return -1;\n    }\n\n    if (type == VIR_PERF_EVENT_CMT) {\n        g_autofree char *buf = NULL;\n\n        if (virFileReadAll(\"/sys/devices/intel_cqm/events/llc_occupancy.scale\",\n                           10, &buf) < 0)\n            goto error;\n\n        if (virStrToLong_i(buf, NULL, 10, &event->efields.cmt.scale) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to get cmt scaling factor\"));\n            goto error;\n        }\n    }\n\n    memset(&attr, 0, sizeof(attr));\n    attr.size = sizeof(attr);\n    attr.inherit = 1;\n    attr.disabled = 1;\n    attr.enable_on_exec = 0;\n    attr.type = event_attr->attrType;\n    attr.config = event_attr->attrConfig;\n\n    event->fd = syscall(__NR_perf_event_open, &attr, pid, -1, -1, 0);\n    if (event->fd < 0) {\n        virReportSystemError(errno,\n                             _(\"unable to open host cpu perf event for %s\"),\n                             virPerfEventTypeToString(type));\n        goto error;\n    }\n\n    if (ioctl(event->fd, PERF_EVENT_IOC_ENABLE) < 0) {\n        virReportSystemError(errno,\n                             _(\"unable to enable host cpu perf event for %s\"),\n                             virPerfEventTypeToString(type));\n        goto error;\n    }\n\n    event->enabled = true;\n    return 0;\n\n error:\n    VIR_FORCE_CLOSE(event->fd);\n    return -1;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "event->fd"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unable to enable host cpu perf event for %s\")",
            "virPerfEventTypeToString(type)"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPerfEventTypeToString",
          "args": [
            "type"
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unable to enable host cpu perf event for %s\""
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "event->fd",
            "PERF_EVENT_IOC_ENABLE"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"unable to open host cpu perf event for %s\")",
            "virPerfEventTypeToString(type)"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPerfEventTypeToString",
          "args": [
            "type"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "syscall",
          "args": [
            "__NR_perf_event_open",
            "&attr",
            "pid",
            "-1",
            "-1",
            "0"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&attr",
            "0",
            "sizeof(attr)"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to get cmt scaling factor\")"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStrToLong_i",
          "args": [
            "buf",
            "NULL",
            "10",
            "&event->efields.cmt.scale"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_i",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "391-407",
          "snippet": "int\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_i(char const *s, char **end_ptr, int base, int *result)\n{\n    long int val;\n    char *p;\n    int err;\n\n    errno = 0;\n    val = strtol(s, &p, base); /* exempt from syntax-check */\n    err = (errno || (!end_ptr && *p) || p == s || (int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "\"/sys/devices/intel_cqm/events/llc_occupancy.scale\"",
            "10",
            "&buf"
          ],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_ARGUMENT_UNSUPPORTED",
            "_(\"unable to enable host cpu perf event for %s\")",
            "virPerfEventTypeToString(type)"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPerfEventTypeToString",
          "args": [
            "type"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nvirPerfEventEnable(virPerfPtr perf,\n                   virPerfEventType type,\n                   pid_t pid)\n{\n    struct perf_event_attr attr;\n    virPerfEventPtr event = &(perf->events[type]);\n    virPerfEventAttrPtr event_attr = &attrs[type];\n\n    if (event->enabled)\n        return 0;\n\n    if (event_attr->attrType == 0 && (type == VIR_PERF_EVENT_CMT ||\n                                      type == VIR_PERF_EVENT_MBMT ||\n                                      type == VIR_PERF_EVENT_MBML)) {\n        virReportError(VIR_ERR_ARGUMENT_UNSUPPORTED,\n                       _(\"unable to enable host cpu perf event for %s\"),\n                       virPerfEventTypeToString(type));\n        return -1;\n    }\n\n    if (type == VIR_PERF_EVENT_CMT) {\n        g_autofree char *buf = NULL;\n\n        if (virFileReadAll(\"/sys/devices/intel_cqm/events/llc_occupancy.scale\",\n                           10, &buf) < 0)\n            goto error;\n\n        if (virStrToLong_i(buf, NULL, 10, &event->efields.cmt.scale) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to get cmt scaling factor\"));\n            goto error;\n        }\n    }\n\n    memset(&attr, 0, sizeof(attr));\n    attr.size = sizeof(attr);\n    attr.inherit = 1;\n    attr.disabled = 1;\n    attr.enable_on_exec = 0;\n    attr.type = event_attr->attrType;\n    attr.config = event_attr->attrConfig;\n\n    event->fd = syscall(__NR_perf_event_open, &attr, pid, -1, -1, 0);\n    if (event->fd < 0) {\n        virReportSystemError(errno,\n                             _(\"unable to open host cpu perf event for %s\"),\n                             virPerfEventTypeToString(type));\n        goto error;\n    }\n\n    if (ioctl(event->fd, PERF_EVENT_IOC_ENABLE) < 0) {\n        virReportSystemError(errno,\n                             _(\"unable to enable host cpu perf event for %s\"),\n                             virPerfEventTypeToString(type));\n        goto error;\n    }\n\n    event->enabled = true;\n    return 0;\n\n error:\n    VIR_FORCE_CLOSE(event->fd);\n    return -1;\n}"
  },
  {
    "function_name": "virPerfRdtAttrInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virperf.c",
    "lines": "178-202",
    "snippet": "static int\nvirPerfRdtAttrInit(void)\n{\n    char *tmp = NULL;\n    unsigned int attr_type = 0;\n    g_autofree char *buf = NULL;\n\n    if (virFileReadAllQuiet(\"/sys/devices/intel_cqm/type\", 10, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    if (virStrToLong_ui(buf, NULL, 10, &attr_type) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to get rdt event type\"));\n        return -1;\n    }\n\n    attrs[VIR_PERF_EVENT_CMT].attrType = attr_type;\n    attrs[VIR_PERF_EVENT_MBMT].attrType = attr_type;\n    attrs[VIR_PERF_EVENT_MBML].attrType = attr_type;\n\n    return 0;\n}",
    "includes": [
      "# include <linux/perf_event.h>",
      "#include \"viralloc.h\"",
      "#include \"virtypedparam.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"virlog.h\"",
      "#include \"virerror.h\"",
      "#include \"virperf.h\"",
      "# include <sys/syscall.h>",
      "# include <sys/ioctl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to get rdt event type\")"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to get rdt event type\""
          ],
          "line": 193
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrToLong_ui",
          "args": [
            "buf",
            "NULL",
            "10",
            "&attr_type"
          ],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "virStrToLong_uip",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "444-461",
          "snippet": "int\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrToLong_uip(char const *s, char **end_ptr, int base, unsigned int *result)\n{\n    unsigned long int val;\n    char *p;\n    bool err = false;\n\n    errno = 0;\n    val = strtoul(s, &p, base); /* exempt from syntax-check */\n    err = (memchr(s, '-', p - s) ||\n           errno || (!end_ptr && *p) || p == s || (unsigned int) val != val);\n    if (end_ptr)\n        *end_ptr = p;\n    if (err)\n        return -1;\n    *result = val;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "buf",
            "'\\n'"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileReadAllQuiet",
          "args": [
            "\"/sys/devices/intel_cqm/type\"",
            "10",
            "&buf"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <linux/perf_event.h>\n#include \"viralloc.h\"\n#include \"virtypedparam.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virperf.h\"\n# include <sys/syscall.h>\n# include <sys/ioctl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nvirPerfRdtAttrInit(void)\n{\n    char *tmp = NULL;\n    unsigned int attr_type = 0;\n    g_autofree char *buf = NULL;\n\n    if (virFileReadAllQuiet(\"/sys/devices/intel_cqm/type\", 10, &buf) < 0)\n        return -1;\n\n    if ((tmp = strchr(buf, '\\n')))\n        *tmp = '\\0';\n\n    if (virStrToLong_ui(buf, NULL, 10, &attr_type) < 0) {\n        virReportSystemError(errno, \"%s\",\n                             _(\"failed to get rdt event type\"));\n        return -1;\n    }\n\n    attrs[VIR_PERF_EVENT_CMT].attrType = attr_type;\n    attrs[VIR_PERF_EVENT_MBMT].attrType = attr_type;\n    attrs[VIR_PERF_EVENT_MBML].attrType = attr_type;\n\n    return 0;\n}"
  }
]