[
  {
    "function_name": "virLockSpaceReleaseResourcesForOwner",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "726-751",
    "snippet": "int virLockSpaceReleaseResourcesForOwner(virLockSpacePtr lockspace,\n                                         pid_t owner)\n{\n    int ret = 0;\n    struct virLockSpaceRemoveData data = {\n        owner, 0\n    };\n\n    VIR_DEBUG(\"lockspace=%p owner=%lld\", lockspace, (unsigned long long)owner);\n\n    virMutexLock(&lockspace->lock);\n\n    if (virHashRemoveSet(lockspace->resources,\n                         virLockSpaceRemoveResourcesForOwner,\n                         &data) < 0)\n        goto error;\n\n    ret = data.count;\n\n    virMutexUnlock(&lockspace->lock);\n    return ret;\n\n error:\n    virMutexUnlock(&lockspace->lock);\n    return -1;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 749
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashRemoveSet",
          "args": [
            "lockspace->resources",
            "virLockSpaceRemoveResourcesForOwner",
            "&data"
          ],
          "line": 738
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "665-696",
          "snippet": "ssize_t\nvirHashRemoveSet(virHashTablePtr table,\n                 virHashSearcher iter,\n                 const void *data)\n{\n    size_t i, count = 0;\n\n    if (table == NULL || iter == NULL)\n        return -1;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr *nextptr = table->table + i;\n\n        while (*nextptr) {\n            virHashEntryPtr entry = *nextptr;\n            if (!iter(entry->payload, entry->name, data)) {\n                nextptr = &entry->next;\n            } else {\n                count++;\n                if (table->dataFree)\n                    table->dataFree(entry->payload);\n                if (table->keyFree)\n                    table->keyFree(entry->name);\n                *nextptr = entry->next;\n                VIR_FREE(entry);\n                table->nbElems--;\n            }\n        }\n    }\n\n    return count;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nssize_t\nvirHashRemoveSet(virHashTablePtr table,\n                 virHashSearcher iter,\n                 const void *data)\n{\n    size_t i, count = 0;\n\n    if (table == NULL || iter == NULL)\n        return -1;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr *nextptr = table->table + i;\n\n        while (*nextptr) {\n            virHashEntryPtr entry = *nextptr;\n            if (!iter(entry->payload, entry->name, data)) {\n                nextptr = &entry->next;\n            } else {\n                count++;\n                if (table->dataFree)\n                    table->dataFree(entry->payload);\n                if (table->keyFree)\n                    table->keyFree(entry->name);\n                *nextptr = entry->next;\n                VIR_FREE(entry);\n                table->nbElems--;\n            }\n        }\n    }\n\n    return count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 736
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"lockspace=%p owner=%lld\"",
            "lockspace",
            "(unsigned long long)owner"
          ],
          "line": 734
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nint virLockSpaceReleaseResourcesForOwner(virLockSpacePtr lockspace,\n                                         pid_t owner)\n{\n    int ret = 0;\n    struct virLockSpaceRemoveData data = {\n        owner, 0\n    };\n\n    VIR_DEBUG(\"lockspace=%p owner=%lld\", lockspace, (unsigned long long)owner);\n\n    virMutexLock(&lockspace->lock);\n\n    if (virHashRemoveSet(lockspace->resources,\n                         virLockSpaceRemoveResourcesForOwner,\n                         &data) < 0)\n        goto error;\n\n    ret = data.count;\n\n    virMutexUnlock(&lockspace->lock);\n    return ret;\n\n error:\n    virMutexUnlock(&lockspace->lock);\n    return -1;\n}"
  },
  {
    "function_name": "virLockSpaceRemoveResourcesForOwner",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "693-723",
    "snippet": "static int\nvirLockSpaceRemoveResourcesForOwner(const void *payload,\n                                    const void *name G_GNUC_UNUSED,\n                                    const void *opaque)\n{\n    virLockSpaceResourcePtr res = (virLockSpaceResourcePtr)payload;\n    struct virLockSpaceRemoveData *data = (struct virLockSpaceRemoveData *)opaque;\n    size_t i;\n\n    VIR_DEBUG(\"res %s owner %lld\", res->name, (unsigned long long)data->owner);\n\n    for (i = 0; i < res->nOwners; i++) {\n        if (res->owners[i] == data->owner)\n            break;\n    }\n\n    if (i == res->nOwners)\n        return 0;\n\n    data->count++;\n\n    VIR_DELETE_ELEMENT(res->owners, i, res->nOwners);\n\n    if (res->nOwners) {\n        VIR_DEBUG(\"Other shared owners remain\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"No more owners, remove it\");\n    return 1;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"No more owners, remove it\""
          ],
          "line": 721
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Other shared owners remain\""
          ],
          "line": 717
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "res->owners",
            "i",
            "res->nOwners"
          ],
          "line": 714
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"res %s owner %lld\"",
            "res->name",
            "(unsigned long long)data->owner"
          ],
          "line": 702
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic int\nvirLockSpaceRemoveResourcesForOwner(const void *payload,\n                                    const void *name G_GNUC_UNUSED,\n                                    const void *opaque)\n{\n    virLockSpaceResourcePtr res = (virLockSpaceResourcePtr)payload;\n    struct virLockSpaceRemoveData *data = (struct virLockSpaceRemoveData *)opaque;\n    size_t i;\n\n    VIR_DEBUG(\"res %s owner %lld\", res->name, (unsigned long long)data->owner);\n\n    for (i = 0; i < res->nOwners; i++) {\n        if (res->owners[i] == data->owner)\n            break;\n    }\n\n    if (i == res->nOwners)\n        return 0;\n\n    data->count++;\n\n    VIR_DELETE_ELEMENT(res->owners, i, res->nOwners);\n\n    if (res->nOwners) {\n        VIR_DEBUG(\"Other shared owners remain\");\n        return 0;\n    }\n\n    VIR_DEBUG(\"No more owners, remove it\");\n    return 1;\n}"
  },
  {
    "function_name": "virLockSpaceReleaseResource",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "641-684",
    "snippet": "int virLockSpaceReleaseResource(virLockSpacePtr lockspace,\n                                const char *resname,\n                                pid_t owner)\n{\n    int ret = -1;\n    virLockSpaceResourcePtr res;\n    size_t i;\n\n    VIR_DEBUG(\"lockspace=%p resname=%s owner=%lld\",\n              lockspace, resname, (unsigned long long)owner);\n\n    virMutexLock(&lockspace->lock);\n\n    if (!(res = virHashLookup(lockspace->resources, resname))) {\n        virReportError(VIR_ERR_RESOURCE_BUSY,\n                       _(\"Lockspace resource '%s' is not locked\"),\n                       resname);\n        goto cleanup;\n    }\n\n    for (i = 0; i < res->nOwners; i++) {\n        if (res->owners[i] == owner)\n            break;\n    }\n\n    if (i == res->nOwners) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"owner %lld does not hold the resource lock\"),\n                       (unsigned long long)owner);\n        goto cleanup;\n    }\n\n    VIR_DELETE_ELEMENT(res->owners, i, res->nOwners);\n\n    if ((res->nOwners == 0) &&\n        virHashRemoveEntry(lockspace->resources, resname) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&lockspace->lock);\n    return ret;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 682
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "lockspace->resources",
            "resname"
          ],
          "line": 676
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DELETE_ELEMENT",
          "args": [
            "res->owners",
            "i",
            "res->nOwners"
          ],
          "line": 673
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"owner %lld does not hold the resource lock\")",
            "(unsigned long long)owner"
          ],
          "line": 667
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"owner %lld does not hold the resource lock\""
          ],
          "line": 668
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_RESOURCE_BUSY",
            "_(\"Lockspace resource '%s' is not locked\")",
            "resname"
          ],
          "line": 655
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "lockspace->resources",
            "resname"
          ],
          "line": 654
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 652
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"lockspace=%p resname=%s owner=%lld\"",
            "lockspace",
            "resname",
            "(unsigned long long)owner"
          ],
          "line": 649
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nint virLockSpaceReleaseResource(virLockSpacePtr lockspace,\n                                const char *resname,\n                                pid_t owner)\n{\n    int ret = -1;\n    virLockSpaceResourcePtr res;\n    size_t i;\n\n    VIR_DEBUG(\"lockspace=%p resname=%s owner=%lld\",\n              lockspace, resname, (unsigned long long)owner);\n\n    virMutexLock(&lockspace->lock);\n\n    if (!(res = virHashLookup(lockspace->resources, resname))) {\n        virReportError(VIR_ERR_RESOURCE_BUSY,\n                       _(\"Lockspace resource '%s' is not locked\"),\n                       resname);\n        goto cleanup;\n    }\n\n    for (i = 0; i < res->nOwners; i++) {\n        if (res->owners[i] == owner)\n            break;\n    }\n\n    if (i == res->nOwners) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"owner %lld does not hold the resource lock\"),\n                       (unsigned long long)owner);\n        goto cleanup;\n    }\n\n    VIR_DELETE_ELEMENT(res->owners, i, res->nOwners);\n\n    if ((res->nOwners == 0) &&\n        virHashRemoveEntry(lockspace->resources, resname) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&lockspace->lock);\n    return ret;\n}"
  },
  {
    "function_name": "virLockSpaceAcquireResource",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "592-638",
    "snippet": "int virLockSpaceAcquireResource(virLockSpacePtr lockspace,\n                                const char *resname,\n                                pid_t owner,\n                                unsigned int flags)\n{\n    int ret = -1;\n    virLockSpaceResourcePtr res;\n\n    VIR_DEBUG(\"lockspace=%p resname=%s flags=0x%x owner=%lld\",\n              lockspace, resname, flags, (unsigned long long)owner);\n\n    virCheckFlags(VIR_LOCK_SPACE_ACQUIRE_SHARED |\n                  VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE, -1);\n\n    virMutexLock(&lockspace->lock);\n\n    if ((res = virHashLookup(lockspace->resources, resname))) {\n        if ((res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) &&\n            (flags & VIR_LOCK_SPACE_ACQUIRE_SHARED)) {\n\n            if (VIR_EXPAND_N(res->owners, res->nOwners, 1) < 0)\n                goto cleanup;\n            res->owners[res->nOwners-1] = owner;\n\n            goto done;\n        }\n        virReportError(VIR_ERR_RESOURCE_BUSY,\n                       _(\"Lockspace resource '%s' is locked\"),\n                       resname);\n        goto cleanup;\n    }\n\n    if (!(res = virLockSpaceResourceNew(lockspace, resname, flags, owner)))\n        goto cleanup;\n\n    if (virHashAddEntry(lockspace->resources, resname, res) < 0) {\n        virLockSpaceResourceFree(res);\n        goto cleanup;\n    }\n\n done:\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&lockspace->lock);\n    return ret;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 636
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockSpaceResourceFree",
          "args": [
            "res"
          ],
          "line": 628
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceResourceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "77-110",
          "snippet": "static void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "lockspace->resources",
            "resname",
            "res"
          ],
          "line": 627
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockSpaceResourceNew",
          "args": [
            "lockspace",
            "resname",
            "flags",
            "owner"
          ],
          "line": 624
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceResourceNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "113-228",
          "snippet": "static virLockSpaceResourcePtr\nvirLockSpaceResourceNew(virLockSpacePtr lockspace,\n                        const char *resname,\n                        unsigned int flags,\n                        pid_t owner)\n{\n    virLockSpaceResourcePtr res;\n    bool shared = !!(flags & VIR_LOCK_SPACE_ACQUIRE_SHARED);\n\n    if (VIR_ALLOC(res) < 0)\n        return NULL;\n\n    res->fd = -1;\n    res->flags = flags;\n\n    res->name = g_strdup(resname);\n\n    if (!(res->path = virLockSpaceGetResourcePath(lockspace, resname)))\n        goto error;\n\n    if (flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE) {\n        while (1) {\n            struct stat a, b;\n            if ((res->fd = open(res->path, O_RDWR|O_CREAT, 0600)) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to open/create resource %s\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (virSetCloseExec(res->fd) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to set close-on-exec flag '%s'\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (fstat(res->fd, &b) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to check status of pid file '%s'\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (virFileLock(res->fd, shared, 0, 1, false) < 0) {\n                if (errno == EACCES || errno == EAGAIN) {\n                    virReportError(VIR_ERR_RESOURCE_BUSY,\n                                   _(\"Lockspace resource '%s' is locked\"),\n                                   resname);\n                } else {\n                    virReportSystemError(errno,\n                                         _(\"Unable to acquire lock on '%s'\"),\n                                         res->path);\n                }\n                goto error;\n            }\n\n            /* Now make sure the pidfile we locked is the same\n             * one that now exists on the filesystem\n             */\n            if (stat(res->path, &a) < 0) {\n                VIR_DEBUG(\"Resource '%s' disappeared: %s\",\n                          res->path, g_strerror(errno));\n                VIR_FORCE_CLOSE(res->fd);\n                /* Someone else must be racing with us, so try again */\n                continue;\n            }\n\n            if (a.st_ino == b.st_ino)\n                break;\n\n            VIR_DEBUG(\"Resource '%s' was recreated\", res->path);\n            VIR_FORCE_CLOSE(res->fd);\n            /* Someone else must be racing with us, so try again */\n        }\n    } else {\n        if ((res->fd = open(res->path, O_RDWR)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open resource %s\"),\n                                 res->path);\n            goto error;\n        }\n\n        if (virSetCloseExec(res->fd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to set close-on-exec flag '%s'\"),\n                                 res->path);\n            goto error;\n        }\n\n        if (virFileLock(res->fd, shared, 0, 1, false) < 0) {\n            if (errno == EACCES || errno == EAGAIN) {\n                virReportError(VIR_ERR_RESOURCE_BUSY,\n                               _(\"Lockspace resource '%s' is locked\"),\n                               resname);\n            } else {\n                virReportSystemError(errno,\n                                     _(\"Unable to acquire lock on '%s'\"),\n                                     res->path);\n            }\n            goto error;\n        }\n    }\n    res->lockHeld = true;\n\n    if (VIR_EXPAND_N(res->owners, res->nOwners, 1) < 0)\n        goto error;\n\n    res->owners[res->nOwners-1] = owner;\n\n    return res;\n\n error:\n    virLockSpaceResourceFree(res);\n    return NULL;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic virLockSpaceResourcePtr\nvirLockSpaceResourceNew(virLockSpacePtr lockspace,\n                        const char *resname,\n                        unsigned int flags,\n                        pid_t owner)\n{\n    virLockSpaceResourcePtr res;\n    bool shared = !!(flags & VIR_LOCK_SPACE_ACQUIRE_SHARED);\n\n    if (VIR_ALLOC(res) < 0)\n        return NULL;\n\n    res->fd = -1;\n    res->flags = flags;\n\n    res->name = g_strdup(resname);\n\n    if (!(res->path = virLockSpaceGetResourcePath(lockspace, resname)))\n        goto error;\n\n    if (flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE) {\n        while (1) {\n            struct stat a, b;\n            if ((res->fd = open(res->path, O_RDWR|O_CREAT, 0600)) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to open/create resource %s\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (virSetCloseExec(res->fd) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to set close-on-exec flag '%s'\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (fstat(res->fd, &b) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to check status of pid file '%s'\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (virFileLock(res->fd, shared, 0, 1, false) < 0) {\n                if (errno == EACCES || errno == EAGAIN) {\n                    virReportError(VIR_ERR_RESOURCE_BUSY,\n                                   _(\"Lockspace resource '%s' is locked\"),\n                                   resname);\n                } else {\n                    virReportSystemError(errno,\n                                         _(\"Unable to acquire lock on '%s'\"),\n                                         res->path);\n                }\n                goto error;\n            }\n\n            /* Now make sure the pidfile we locked is the same\n             * one that now exists on the filesystem\n             */\n            if (stat(res->path, &a) < 0) {\n                VIR_DEBUG(\"Resource '%s' disappeared: %s\",\n                          res->path, g_strerror(errno));\n                VIR_FORCE_CLOSE(res->fd);\n                /* Someone else must be racing with us, so try again */\n                continue;\n            }\n\n            if (a.st_ino == b.st_ino)\n                break;\n\n            VIR_DEBUG(\"Resource '%s' was recreated\", res->path);\n            VIR_FORCE_CLOSE(res->fd);\n            /* Someone else must be racing with us, so try again */\n        }\n    } else {\n        if ((res->fd = open(res->path, O_RDWR)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open resource %s\"),\n                                 res->path);\n            goto error;\n        }\n\n        if (virSetCloseExec(res->fd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to set close-on-exec flag '%s'\"),\n                                 res->path);\n            goto error;\n        }\n\n        if (virFileLock(res->fd, shared, 0, 1, false) < 0) {\n            if (errno == EACCES || errno == EAGAIN) {\n                virReportError(VIR_ERR_RESOURCE_BUSY,\n                               _(\"Lockspace resource '%s' is locked\"),\n                               resname);\n            } else {\n                virReportSystemError(errno,\n                                     _(\"Unable to acquire lock on '%s'\"),\n                                     res->path);\n            }\n            goto error;\n        }\n    }\n    res->lockHeld = true;\n\n    if (VIR_EXPAND_N(res->owners, res->nOwners, 1) < 0)\n        goto error;\n\n    res->owners[res->nOwners-1] = owner;\n\n    return res;\n\n error:\n    virLockSpaceResourceFree(res);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_RESOURCE_BUSY",
            "_(\"Lockspace resource '%s' is locked\")",
            "resname"
          ],
          "line": 618
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Lockspace resource '%s' is locked\""
          ],
          "line": 619
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "res->owners",
            "res->nOwners",
            "1"
          ],
          "line": 612
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "lockspace->resources",
            "resname"
          ],
          "line": 608
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 606
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_LOCK_SPACE_ACQUIRE_SHARED |\n                  VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE",
            "-1"
          ],
          "line": 603
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"lockspace=%p resname=%s flags=0x%x owner=%lld\"",
            "lockspace",
            "resname",
            "flags",
            "(unsigned long long)owner"
          ],
          "line": 600
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nint virLockSpaceAcquireResource(virLockSpacePtr lockspace,\n                                const char *resname,\n                                pid_t owner,\n                                unsigned int flags)\n{\n    int ret = -1;\n    virLockSpaceResourcePtr res;\n\n    VIR_DEBUG(\"lockspace=%p resname=%s flags=0x%x owner=%lld\",\n              lockspace, resname, flags, (unsigned long long)owner);\n\n    virCheckFlags(VIR_LOCK_SPACE_ACQUIRE_SHARED |\n                  VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE, -1);\n\n    virMutexLock(&lockspace->lock);\n\n    if ((res = virHashLookup(lockspace->resources, resname))) {\n        if ((res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) &&\n            (flags & VIR_LOCK_SPACE_ACQUIRE_SHARED)) {\n\n            if (VIR_EXPAND_N(res->owners, res->nOwners, 1) < 0)\n                goto cleanup;\n            res->owners[res->nOwners-1] = owner;\n\n            goto done;\n        }\n        virReportError(VIR_ERR_RESOURCE_BUSY,\n                       _(\"Lockspace resource '%s' is locked\"),\n                       resname);\n        goto cleanup;\n    }\n\n    if (!(res = virLockSpaceResourceNew(lockspace, resname, flags, owner)))\n        goto cleanup;\n\n    if (virHashAddEntry(lockspace->resources, resname, res) < 0) {\n        virLockSpaceResourceFree(res);\n        goto cleanup;\n    }\n\n done:\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&lockspace->lock);\n    return ret;\n}"
  },
  {
    "function_name": "virLockSpaceDeleteResource",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "555-589",
    "snippet": "int virLockSpaceDeleteResource(virLockSpacePtr lockspace,\n                               const char *resname)\n{\n    int ret = -1;\n    char *respath = NULL;\n\n    VIR_DEBUG(\"lockspace=%p resname=%s\", lockspace, resname);\n\n    virMutexLock(&lockspace->lock);\n\n    if (virHashLookup(lockspace->resources, resname) != NULL) {\n        virReportError(VIR_ERR_RESOURCE_BUSY,\n                       _(\"Lockspace resource '%s' is locked\"),\n                       resname);\n        goto cleanup;\n    }\n\n    if (!(respath = virLockSpaceGetResourcePath(lockspace, resname)))\n        goto cleanup;\n\n    if (unlink(respath) < 0 &&\n        errno != ENOENT) {\n        virReportSystemError(errno,\n                             _(\"Unable to delete lockspace resource %s\"),\n                             respath);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&lockspace->lock);\n    VIR_FREE(respath);\n    return ret;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "respath"
          ],
          "line": 587
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 586
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to delete lockspace resource %s\")",
            "respath"
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to delete lockspace resource %s\""
          ],
          "line": 578
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "respath"
          ],
          "line": 575
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virLockSpaceGetResourcePath",
          "args": [
            "lockspace",
            "resname"
          ],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceGetResourcePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "65-74",
          "snippet": "static char *virLockSpaceGetResourcePath(virLockSpacePtr lockspace,\n                                         const char *resname)\n{\n    char *ret;\n    if (lockspace->dir)\n        ret = g_strdup_printf(\"%s/%s\", lockspace->dir, resname);\n    else\n        ret = g_strdup(resname);\n    return ret;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic char *virLockSpaceGetResourcePath(virLockSpacePtr lockspace,\n                                         const char *resname)\n{\n    char *ret;\n    if (lockspace->dir)\n        ret = g_strdup_printf(\"%s/%s\", lockspace->dir, resname);\n    else\n        ret = g_strdup(resname);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_RESOURCE_BUSY",
            "_(\"Lockspace resource '%s' is locked\")",
            "resname"
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "lockspace->resources",
            "resname"
          ],
          "line": 565
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 563
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"lockspace=%p resname=%s\"",
            "lockspace",
            "resname"
          ],
          "line": 561
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nint virLockSpaceDeleteResource(virLockSpacePtr lockspace,\n                               const char *resname)\n{\n    int ret = -1;\n    char *respath = NULL;\n\n    VIR_DEBUG(\"lockspace=%p resname=%s\", lockspace, resname);\n\n    virMutexLock(&lockspace->lock);\n\n    if (virHashLookup(lockspace->resources, resname) != NULL) {\n        virReportError(VIR_ERR_RESOURCE_BUSY,\n                       _(\"Lockspace resource '%s' is locked\"),\n                       resname);\n        goto cleanup;\n    }\n\n    if (!(respath = virLockSpaceGetResourcePath(lockspace, resname)))\n        goto cleanup;\n\n    if (unlink(respath) < 0 &&\n        errno != ENOENT) {\n        virReportSystemError(errno,\n                             _(\"Unable to delete lockspace resource %s\"),\n                             respath);\n        goto cleanup;\n    }\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&lockspace->lock);\n    VIR_FREE(respath);\n    return ret;\n}"
  },
  {
    "function_name": "virLockSpaceCreateResource",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "523-552",
    "snippet": "int virLockSpaceCreateResource(virLockSpacePtr lockspace,\n                               const char *resname)\n{\n    int ret = -1;\n    char *respath = NULL;\n\n    VIR_DEBUG(\"lockspace=%p resname=%s\", lockspace, resname);\n\n    virMutexLock(&lockspace->lock);\n\n    if (virHashLookup(lockspace->resources, resname) != NULL) {\n        virReportError(VIR_ERR_RESOURCE_BUSY,\n                       _(\"Lockspace resource '%s' is locked\"),\n                       resname);\n        goto cleanup;\n    }\n\n    if (!(respath = virLockSpaceGetResourcePath(lockspace, resname)))\n        goto cleanup;\n\n    if (virFileTouch(respath, 0600) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&lockspace->lock);\n    VIR_FREE(respath);\n    return ret;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "respath"
          ],
          "line": 550
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 549
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileTouch",
          "args": [
            "respath",
            "0600"
          ],
          "line": 543
        },
        "resolved": true,
        "details": {
          "function_name": "virFileTouch",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "591-609",
          "snippet": "int virFileTouch(const char *path, mode_t mode)\n{\n    int fd = -1;\n\n    if ((fd = open(path, O_WRONLY | O_CREAT, mode)) < 0) {\n        virReportSystemError(errno, _(\"cannot create file '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (VIR_CLOSE(fd) < 0) {\n        virReportSystemError(errno, _(\"cannot save file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileTouch(const char *path, mode_t mode)\n{\n    int fd = -1;\n\n    if ((fd = open(path, O_WRONLY | O_CREAT, mode)) < 0) {\n        virReportSystemError(errno, _(\"cannot create file '%s'\"),\n                             path);\n        return -1;\n    }\n\n    if (VIR_CLOSE(fd) < 0) {\n        virReportSystemError(errno, _(\"cannot save file '%s'\"),\n                             path);\n        VIR_FORCE_CLOSE(fd);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockSpaceGetResourcePath",
          "args": [
            "lockspace",
            "resname"
          ],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceGetResourcePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "65-74",
          "snippet": "static char *virLockSpaceGetResourcePath(virLockSpacePtr lockspace,\n                                         const char *resname)\n{\n    char *ret;\n    if (lockspace->dir)\n        ret = g_strdup_printf(\"%s/%s\", lockspace->dir, resname);\n    else\n        ret = g_strdup(resname);\n    return ret;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic char *virLockSpaceGetResourcePath(virLockSpacePtr lockspace,\n                                         const char *resname)\n{\n    char *ret;\n    if (lockspace->dir)\n        ret = g_strdup_printf(\"%s/%s\", lockspace->dir, resname);\n    else\n        ret = g_strdup(resname);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_RESOURCE_BUSY",
            "_(\"Lockspace resource '%s' is locked\")",
            "resname"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Lockspace resource '%s' is locked\""
          ],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "lockspace->resources",
            "resname"
          ],
          "line": 533
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 531
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"lockspace=%p resname=%s\"",
            "lockspace",
            "resname"
          ],
          "line": 529
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nint virLockSpaceCreateResource(virLockSpacePtr lockspace,\n                               const char *resname)\n{\n    int ret = -1;\n    char *respath = NULL;\n\n    VIR_DEBUG(\"lockspace=%p resname=%s\", lockspace, resname);\n\n    virMutexLock(&lockspace->lock);\n\n    if (virHashLookup(lockspace->resources, resname) != NULL) {\n        virReportError(VIR_ERR_RESOURCE_BUSY,\n                       _(\"Lockspace resource '%s' is locked\"),\n                       resname);\n        goto cleanup;\n    }\n\n    if (!(respath = virLockSpaceGetResourcePath(lockspace, resname)))\n        goto cleanup;\n\n    if (virFileTouch(respath, 0600) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virMutexUnlock(&lockspace->lock);\n    VIR_FREE(respath);\n    return ret;\n}"
  },
  {
    "function_name": "virLockSpaceGetDirectory",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "517-520",
    "snippet": "const char *virLockSpaceGetDirectory(virLockSpacePtr lockspace)\n{\n    return lockspace->dir;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nconst char *virLockSpaceGetDirectory(virLockSpacePtr lockspace)\n{\n    return lockspace->dir;\n}"
  },
  {
    "function_name": "virLockSpaceFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "505-514",
    "snippet": "void virLockSpaceFree(virLockSpacePtr lockspace)\n{\n    if (!lockspace)\n        return;\n\n    virHashFree(lockspace->resources);\n    VIR_FREE(lockspace->dir);\n    virMutexDestroy(&lockspace->lock);\n    VIR_FREE(lockspace);\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "lockspace"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexDestroy",
          "args": [
            "&lockspace->lock"
          ],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "76-79",
          "snippet": "void virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "lockspace->dir"
          ],
          "line": 511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashFree",
          "args": [
            "lockspace->resources"
          ],
          "line": 510
        },
        "resolved": true,
        "details": {
          "function_name": "virHashFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "313-337",
          "snippet": "void\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nvoid virLockSpaceFree(virLockSpacePtr lockspace)\n{\n    if (!lockspace)\n        return;\n\n    virHashFree(lockspace->resources);\n    VIR_FREE(lockspace->dir);\n    virMutexDestroy(&lockspace->lock);\n    VIR_FREE(lockspace);\n}"
  },
  {
    "function_name": "virLockSpacePreExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "428-502",
    "snippet": "virJSONValuePtr virLockSpacePreExecRestart(virLockSpacePtr lockspace)\n{\n    virJSONValuePtr object = virJSONValueNewObject();\n    virJSONValuePtr resources;\n    virHashKeyValuePairPtr pairs = NULL, tmp;\n\n    virMutexLock(&lockspace->lock);\n\n    if (lockspace->dir &&\n        virJSONValueObjectAppendString(object, \"directory\", lockspace->dir) < 0)\n        goto error;\n\n    resources = virJSONValueNewArray();\n\n    if (virJSONValueObjectAppend(object, \"resources\", resources) < 0) {\n        virJSONValueFree(resources);\n        goto error;\n    }\n\n    tmp = pairs = virHashGetItems(lockspace->resources, NULL);\n    while (tmp && tmp->value) {\n        virLockSpaceResourcePtr res = (virLockSpaceResourcePtr)tmp->value;\n        virJSONValuePtr child = virJSONValueNewObject();\n        virJSONValuePtr owners = NULL;\n        size_t i;\n\n        if (virJSONValueArrayAppend(resources, child) < 0) {\n            virJSONValueFree(child);\n            goto error;\n        }\n\n        if (virJSONValueObjectAppendString(child, \"name\", res->name) < 0 ||\n            virJSONValueObjectAppendString(child, \"path\", res->path) < 0 ||\n            virJSONValueObjectAppendNumberInt(child, \"fd\", res->fd) < 0 ||\n            virJSONValueObjectAppendBoolean(child, \"lockHeld\", res->lockHeld) < 0 ||\n            virJSONValueObjectAppendNumberUint(child, \"flags\", res->flags) < 0)\n            goto error;\n\n        if (virSetInherit(res->fd, true) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Cannot disable close-on-exec flag\"));\n            goto error;\n        }\n\n        owners = virJSONValueNewArray();\n\n        if (virJSONValueObjectAppend(child, \"owners\", owners) < 0) {\n            virJSONValueFree(owners);\n            goto error;\n        }\n\n        for (i = 0; i < res->nOwners; i++) {\n            virJSONValuePtr owner = virJSONValueNewNumberUlong(res->owners[i]);\n            if (!owner)\n                goto error;\n\n            if (virJSONValueArrayAppend(owners, owner) < 0) {\n                virJSONValueFree(owner);\n                goto error;\n            }\n        }\n\n        tmp++;\n    }\n    VIR_FREE(pairs);\n\n    virMutexUnlock(&lockspace->lock);\n    return object;\n\n error:\n    VIR_FREE(pairs);\n    virJSONValueFree(object);\n    virMutexUnlock(&lockspace->lock);\n    return NULL;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 500
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueFree",
          "args": [
            "object"
          ],
          "line": 499
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "391-423",
          "snippet": "void\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvoid\nvirJSONValueFree(virJSONValuePtr value)\n{\n    size_t i;\n    if (!value)\n        return;\n\n    switch ((virJSONType) value->type) {\n    case VIR_JSON_TYPE_OBJECT:\n        for (i = 0; i < value->data.object.npairs; i++) {\n            VIR_FREE(value->data.object.pairs[i].key);\n            virJSONValueFree(value->data.object.pairs[i].value);\n        }\n        VIR_FREE(value->data.object.pairs);\n        break;\n    case VIR_JSON_TYPE_ARRAY:\n        for (i = 0; i < value->data.array.nvalues; i++)\n            virJSONValueFree(value->data.array.values[i]);\n        VIR_FREE(value->data.array.values);\n        break;\n    case VIR_JSON_TYPE_STRING:\n        VIR_FREE(value->data.string);\n        break;\n    case VIR_JSON_TYPE_NUMBER:\n        VIR_FREE(value->data.number);\n        break;\n    case VIR_JSON_TYPE_BOOLEAN:\n    case VIR_JSON_TYPE_NULL:\n        break;\n    }\n\n    VIR_FREE(value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pairs"
          ],
          "line": 498
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "pairs"
          ],
          "line": 492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayAppend",
          "args": [
            "owners",
            "owner"
          ],
          "line": 484
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "792-804",
          "snippet": "int\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueArrayAppendString(virJSONValuePtr object,\n                              const char *value)\n{\n    virJSONValuePtr jvalue = virJSONValueNewString(value);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueArrayAppend(object, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewNumberUlong",
          "args": [
            "res->owners[i]"
          ],
          "line": 480
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewNumberUlong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "512-518",
          "snippet": "virJSONValuePtr\nvirJSONValueNewNumberUlong(unsigned long long data)\n{\n    g_autofree char *str = NULL;\n    str = g_strdup_printf(\"%llu\", data);\n    return virJSONValueNewNumber(str);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewNumberUlong(unsigned long long data)\n{\n    g_autofree char *str = NULL;\n    str = g_strdup_printf(\"%llu\", data);\n    return virJSONValueNewNumber(str);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppend",
          "args": [
            "child",
            "\"owners\"",
            "owners"
          ],
          "line": 474
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendBoolean",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "741-754",
          "snippet": "int\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendBoolean(virJSONValuePtr object,\n                                const char *key,\n                                int boolean_)\n{\n    virJSONValuePtr jvalue = virJSONValueNewBoolean(boolean_);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewArray",
          "args": [],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "560-568",
          "snippet": "virJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewArray(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_ARRAY;\n\n    return val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Cannot disable close-on-exec flag\")"
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot disable close-on-exec flag\""
          ],
          "line": 468
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetInherit",
          "args": [
            "res->fd",
            "true"
          ],
          "line": 466
        },
        "resolved": true,
        "details": {
          "function_name": "virSetInherit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "104-111",
          "snippet": "int virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendNumberUint",
          "args": [
            "child",
            "\"flags\"",
            "res->flags"
          ],
          "line": 463
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendNumberUint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "677-690",
          "snippet": "int\nvirJSONValueObjectAppendNumberUint(virJSONValuePtr object,\n                                   const char *key,\n                                   unsigned int number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberUint(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendNumberUint(virJSONValuePtr object,\n                                   const char *key,\n                                   unsigned int number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberUint(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendNumberInt",
          "args": [
            "child",
            "\"fd\"",
            "res->fd"
          ],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "661-674",
          "snippet": "int\nvirJSONValueObjectAppendNumberInt(virJSONValuePtr object,\n                                  const char *key,\n                                  int number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberInt(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendNumberInt(virJSONValuePtr object,\n                                  const char *key,\n                                  int number)\n{\n    virJSONValuePtr jvalue = virJSONValueNewNumberInt(number);\n    if (!jvalue)\n        return -1;\n    if (virJSONValueObjectAppend(object, key, jvalue) < 0) {\n        virJSONValueFree(jvalue);\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectAppendString",
          "args": [
            "child",
            "\"path\"",
            "res->path"
          ],
          "line": 460
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectAppendString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "643-649",
          "snippet": "int\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectAppendString(virJSONValuePtr object,\n                               const char *key,\n                               const char *value)\n{\n    return virJSONValueObjectInsertString(object, key, value, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueNewObject",
          "args": [],
          "line": 450
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueNewObject",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "571-579",
          "snippet": "virJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueNewObject(void)\n{\n    virJSONValuePtr val = g_new0(virJSONValue, 1);\n\n    val->type = VIR_JSON_TYPE_OBJECT;\n\n    return val;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashGetItems",
          "args": [
            "lockspace->resources",
            "NULL"
          ],
          "line": 447
        },
        "resolved": true,
        "details": {
          "function_name": "virHashGetItems",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "783-805",
          "snippet": "virHashKeyValuePairPtr virHashGetItems(virHashTablePtr table,\n                                       virHashKeyComparator compar)\n{\n    ssize_t numElems = virHashSize(table);\n    struct getKeysIter iter = {\n        .arrayIdx = 0,\n        .sortArray = NULL,\n    };\n\n    if (numElems < 0)\n        return NULL;\n\n    if (VIR_ALLOC_N(iter.sortArray, numElems + 1))\n        return NULL;\n\n    virHashForEach(table, virHashGetKeysIterator, &iter);\n\n    if (compar)\n        qsort(&iter.sortArray[0], numElems, sizeof(iter.sortArray[0]),\n              (qsort_comp)compar);\n\n    return iter.sortArray;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirHashKeyValuePairPtr virHashGetItems(virHashTablePtr table,\n                                       virHashKeyComparator compar)\n{\n    ssize_t numElems = virHashSize(table);\n    struct getKeysIter iter = {\n        .arrayIdx = 0,\n        .sortArray = NULL,\n    };\n\n    if (numElems < 0)\n        return NULL;\n\n    if (VIR_ALLOC_N(iter.sortArray, numElems + 1))\n        return NULL;\n\n    virHashForEach(table, virHashGetKeysIterator, &iter);\n\n    if (compar)\n        qsort(&iter.sortArray[0], numElems, sizeof(iter.sortArray[0]),\n              (qsort_comp)compar);\n\n    return iter.sortArray;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&lockspace->lock"
          ],
          "line": 434
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nvirJSONValuePtr virLockSpacePreExecRestart(virLockSpacePtr lockspace)\n{\n    virJSONValuePtr object = virJSONValueNewObject();\n    virJSONValuePtr resources;\n    virHashKeyValuePairPtr pairs = NULL, tmp;\n\n    virMutexLock(&lockspace->lock);\n\n    if (lockspace->dir &&\n        virJSONValueObjectAppendString(object, \"directory\", lockspace->dir) < 0)\n        goto error;\n\n    resources = virJSONValueNewArray();\n\n    if (virJSONValueObjectAppend(object, \"resources\", resources) < 0) {\n        virJSONValueFree(resources);\n        goto error;\n    }\n\n    tmp = pairs = virHashGetItems(lockspace->resources, NULL);\n    while (tmp && tmp->value) {\n        virLockSpaceResourcePtr res = (virLockSpaceResourcePtr)tmp->value;\n        virJSONValuePtr child = virJSONValueNewObject();\n        virJSONValuePtr owners = NULL;\n        size_t i;\n\n        if (virJSONValueArrayAppend(resources, child) < 0) {\n            virJSONValueFree(child);\n            goto error;\n        }\n\n        if (virJSONValueObjectAppendString(child, \"name\", res->name) < 0 ||\n            virJSONValueObjectAppendString(child, \"path\", res->path) < 0 ||\n            virJSONValueObjectAppendNumberInt(child, \"fd\", res->fd) < 0 ||\n            virJSONValueObjectAppendBoolean(child, \"lockHeld\", res->lockHeld) < 0 ||\n            virJSONValueObjectAppendNumberUint(child, \"flags\", res->flags) < 0)\n            goto error;\n\n        if (virSetInherit(res->fd, true) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Cannot disable close-on-exec flag\"));\n            goto error;\n        }\n\n        owners = virJSONValueNewArray();\n\n        if (virJSONValueObjectAppend(child, \"owners\", owners) < 0) {\n            virJSONValueFree(owners);\n            goto error;\n        }\n\n        for (i = 0; i < res->nOwners; i++) {\n            virJSONValuePtr owner = virJSONValueNewNumberUlong(res->owners[i]);\n            if (!owner)\n                goto error;\n\n            if (virJSONValueArrayAppend(owners, owner) < 0) {\n                virJSONValueFree(owner);\n                goto error;\n            }\n        }\n\n        tmp++;\n    }\n    VIR_FREE(pairs);\n\n    virMutexUnlock(&lockspace->lock);\n    return object;\n\n error:\n    VIR_FREE(pairs);\n    virJSONValueFree(object);\n    virMutexUnlock(&lockspace->lock);\n    return NULL;\n}"
  },
  {
    "function_name": "virLockSpaceNewPostExecRestart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "287-425",
    "snippet": "virLockSpacePtr virLockSpaceNewPostExecRestart(virJSONValuePtr object)\n{\n    virLockSpacePtr lockspace;\n    virJSONValuePtr resources;\n    size_t i;\n\n    VIR_DEBUG(\"object=%p\", object);\n\n    if (VIR_ALLOC(lockspace) < 0)\n        return NULL;\n\n    if (virMutexInit(&lockspace->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize lockspace mutex\"));\n        VIR_FREE(lockspace);\n        return NULL;\n    }\n\n    if (!(lockspace->resources = virHashCreate(VIR_LOCKSPACE_TABLE_SIZE,\n                                               virLockSpaceResourceDataFree)))\n        goto error;\n\n    if (virJSONValueObjectHasKey(object, \"directory\")) {\n        const char *dir = virJSONValueObjectGetString(object, \"directory\");\n        lockspace->dir = g_strdup(dir);\n    }\n\n    if (!(resources = virJSONValueObjectGet(object, \"resources\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing resources value in JSON document\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(resources)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed resources array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(resources); i++) {\n        virJSONValuePtr child = virJSONValueArrayGet(resources, i);\n        virLockSpaceResourcePtr res;\n        const char *tmp;\n        virJSONValuePtr owners;\n        size_t j;\n        size_t m;\n\n        if (VIR_ALLOC(res) < 0)\n            goto error;\n        res->fd = -1;\n\n        if (!(tmp = virJSONValueObjectGetString(child, \"name\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource name in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        res->name = g_strdup(tmp);\n\n        if (!(tmp = virJSONValueObjectGetString(child, \"path\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource path in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        res->path = g_strdup(tmp);\n        if (virJSONValueObjectGetNumberInt(child, \"fd\", &res->fd) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource fd in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        if (virSetInherit(res->fd, false) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Cannot enable close-on-exec flag\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        if (virJSONValueObjectGetBoolean(child, \"lockHeld\", &res->lockHeld) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource lockHeld in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n\n        if (virJSONValueObjectGetNumberUint(child, \"flags\", &res->flags) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource flags in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n\n        if (!(owners = virJSONValueObjectGet(child, \"owners\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource owners in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n\n        if (!virJSONValueIsArray(owners)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Malformed owners array\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n\n        m = virJSONValueArraySize(owners);\n        if (VIR_ALLOC_N(res->owners, res->nOwners) < 0) {\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        res->nOwners = m;\n\n        for (j = 0; j < res->nOwners; j++) {\n            unsigned long long int owner;\n            virJSONValuePtr ownerval = virJSONValueArrayGet(owners, j);\n\n            if (virJSONValueGetNumberUlong(ownerval, &owner) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Malformed owner value in JSON document\"));\n                virLockSpaceResourceFree(res);\n                goto error;\n            }\n\n            res->owners[j] = (pid_t)owner;\n        }\n\n        if (virHashAddEntry(lockspace->resources, res->name, res) < 0) {\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n    }\n\n    return lockspace;\n\n error:\n    virLockSpaceFree(lockspace);\n    return NULL;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIR_LOCKSPACE_TABLE_SIZE 10"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockSpaceFree",
          "args": [
            "lockspace"
          ],
          "line": 423
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "505-514",
          "snippet": "void virLockSpaceFree(virLockSpacePtr lockspace)\n{\n    if (!lockspace)\n        return;\n\n    virHashFree(lockspace->resources);\n    VIR_FREE(lockspace->dir);\n    virMutexDestroy(&lockspace->lock);\n    VIR_FREE(lockspace);\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nvoid virLockSpaceFree(virLockSpacePtr lockspace)\n{\n    if (!lockspace)\n        return;\n\n    virHashFree(lockspace->resources);\n    VIR_FREE(lockspace->dir);\n    virMutexDestroy(&lockspace->lock);\n    VIR_FREE(lockspace);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockSpaceResourceFree",
          "args": [
            "res"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceResourceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "77-110",
          "snippet": "static void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "lockspace->resources",
            "res->name",
            "res"
          ],
          "line": 414
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed owner value in JSON document\")"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Malformed owner value in JSON document\""
          ],
          "line": 406
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueGetNumberUlong",
          "args": [
            "ownerval",
            "&owner"
          ],
          "line": 404
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueGetNumberUlong",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1168-1176",
          "snippet": "int\nvirJSONValueGetNumberUlong(virJSONValuePtr number,\n                           unsigned long long *value)\n{\n    if (number->type != VIR_JSON_TYPE_NUMBER)\n        return -1;\n\n    return virStrToLong_ull(number->data.number, NULL, 10, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueGetNumberUlong(virJSONValuePtr number,\n                           unsigned long long *value)\n{\n    if (number->type != VIR_JSON_TYPE_NUMBER)\n        return -1;\n\n    return virStrToLong_ull(number->data.number, NULL, 10, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virJSONValueArrayGet",
          "args": [
            "owners",
            "j"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArrayGet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1024-1035",
          "snippet": "virJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueArrayGet(virJSONValuePtr array,\n                     unsigned int element)\n{\n    if (array->type != VIR_JSON_TYPE_ARRAY)\n        return NULL;\n\n    if (element >= array->data.array.nvalues)\n        return NULL;\n\n    return array->data.array.values[element];\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "res->owners",
            "res->nOwners"
          ],
          "line": 394
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueArraySize",
          "args": [
            "owners"
          ],
          "line": 393
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueArraySize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1017-1021",
          "snippet": "size_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nsize_t\nvirJSONValueArraySize(const virJSONValue *array)\n{\n    return array->data.array.nvalues;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed owners array\")"
          ],
          "line": 387
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueIsArray",
          "args": [
            "owners"
          ],
          "line": 386
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueIsArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1010-1014",
          "snippet": "bool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nbool\nvirJSONValueIsArray(virJSONValuePtr array)\n{\n    return array->type == VIR_JSON_TYPE_ARRAY;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing resource owners in JSON document\")"
          ],
          "line": 380
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGet",
          "args": [
            "child",
            "\"owners\""
          ],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetArray",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1422-1426",
          "snippet": "virJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nvirJSONValuePtr\nvirJSONValueObjectGetArray(virJSONValuePtr object, const char *key)\n{\n    return virJSONValueObjectGetByType(object, key, VIR_JSON_TYPE_ARRAY);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing resource flags in JSON document\")"
          ],
          "line": 373
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberUint",
          "args": [
            "child",
            "\"flags\"",
            "&res->flags"
          ],
          "line": 372
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberUint",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1345-1356",
          "snippet": "int\nvirJSONValueObjectGetNumberUint(virJSONValuePtr object,\n                                const char *key,\n                                unsigned int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUint(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberUint(virJSONValuePtr object,\n                                const char *key,\n                                unsigned int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberUint(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing resource lockHeld in JSON document\")"
          ],
          "line": 366
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetBoolean",
          "args": [
            "child",
            "\"lockHeld\"",
            "&res->lockHeld"
          ],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetBoolean",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1401-1412",
          "snippet": "int\nvirJSONValueObjectGetBoolean(virJSONValuePtr object,\n                             const char *key,\n                             bool *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetBoolean(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetBoolean(virJSONValuePtr object,\n                             const char *key,\n                             bool *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetBoolean(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"Cannot enable close-on-exec flag\")"
          ],
          "line": 360
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSetInherit",
          "args": [
            "res->fd",
            "false"
          ],
          "line": 359
        },
        "resolved": true,
        "details": {
          "function_name": "virSetInherit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "104-111",
          "snippet": "int virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetInherit(int fd G_GNUC_UNUSED, bool inherit G_GNUC_UNUSED)\n{\n    /* FIXME: Currently creating child processes is not supported on\n     * Win32, so there is no point in failing calls that are only relevant\n     * when creating child processes. So just pretend that we changed the\n     * inheritance property of the given fd as requested. */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing resource fd in JSON document\")"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetNumberInt",
          "args": [
            "child",
            "\"fd\"",
            "&res->fd"
          ],
          "line": 353
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetNumberInt",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1331-1342",
          "snippet": "int\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectGetNumberInt(virJSONValuePtr object,\n                               const char *key,\n                               int *value)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return -1;\n\n    return virJSONValueGetNumberInt(val, value);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing resource path in JSON document\")"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectGetString",
          "args": [
            "child",
            "\"path\""
          ],
          "line": 346
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectGetStringOrNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "1313-1328",
          "snippet": "const char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nconst char *\nvirJSONValueObjectGetStringOrNumber(virJSONValuePtr object,\n                                    const char *key)\n{\n    virJSONValuePtr val = virJSONValueObjectGet(object, key);\n\n    if (!val)\n        return NULL;\n\n    if (val->type == VIR_JSON_TYPE_STRING)\n        return val->data.string;\n    else if (val->type == VIR_JSON_TYPE_NUMBER)\n        return val->data.number;\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing resource name in JSON document\")"
          ],
          "line": 339
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "res"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Malformed resources array\")"
          ],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Missing resources value in JSON document\")"
          ],
          "line": 315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virJSONValueObjectHasKey",
          "args": [
            "object",
            "\"directory\""
          ],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "virJSONValueObjectHasKey",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virjson.c",
          "lines": "838-853",
          "snippet": "int\nvirJSONValueObjectHasKey(virJSONValuePtr object,\n                         const char *key)\n{\n    size_t i;\n\n    if (object->type != VIR_JSON_TYPE_OBJECT)\n        return -1;\n\n    for (i = 0; i < object->data.object.npairs; i++) {\n        if (STREQ(object->data.object.pairs[i].key, key))\n            return 1;\n    }\n\n    return 0;\n}",
          "includes": [
            "# include <yajl/yajl_parse.h>",
            "# include <yajl/yajl_gen.h>",
            "#include \"virenum.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virjson.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <yajl/yajl_parse.h>\n# include <yajl/yajl_gen.h>\n#include \"virenum.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virjson.h\"\n#include <config.h>\n\nint\nvirJSONValueObjectHasKey(virJSONValuePtr object,\n                         const char *key)\n{\n    size_t i;\n\n    if (object->type != VIR_JSON_TYPE_OBJECT)\n        return -1;\n\n    for (i = 0; i < object->data.object.npairs; i++) {\n        if (STREQ(object->data.object.pairs[i].key, key))\n            return 1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashCreate",
          "args": [
            "VIR_LOCKSPACE_TABLE_SIZE",
            "virLockSpaceResourceDataFree"
          ],
          "line": 305
        },
        "resolved": true,
        "details": {
          "function_name": "virHashCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "202-211",
          "snippet": "virHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "lockspace"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Unable to initialize lockspace mutex\")"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexInit",
          "args": [
            "&lockspace->lock"
          ],
          "line": 298
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "lockspace"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"object=%p\"",
            "object"
          ],
          "line": 293
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\n#define VIR_LOCKSPACE_TABLE_SIZE 10\n\nvirLockSpacePtr virLockSpaceNewPostExecRestart(virJSONValuePtr object)\n{\n    virLockSpacePtr lockspace;\n    virJSONValuePtr resources;\n    size_t i;\n\n    VIR_DEBUG(\"object=%p\", object);\n\n    if (VIR_ALLOC(lockspace) < 0)\n        return NULL;\n\n    if (virMutexInit(&lockspace->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize lockspace mutex\"));\n        VIR_FREE(lockspace);\n        return NULL;\n    }\n\n    if (!(lockspace->resources = virHashCreate(VIR_LOCKSPACE_TABLE_SIZE,\n                                               virLockSpaceResourceDataFree)))\n        goto error;\n\n    if (virJSONValueObjectHasKey(object, \"directory\")) {\n        const char *dir = virJSONValueObjectGetString(object, \"directory\");\n        lockspace->dir = g_strdup(dir);\n    }\n\n    if (!(resources = virJSONValueObjectGet(object, \"resources\"))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Missing resources value in JSON document\"));\n        goto error;\n    }\n\n    if (!virJSONValueIsArray(resources)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Malformed resources array\"));\n        goto error;\n    }\n\n    for (i = 0; i < virJSONValueArraySize(resources); i++) {\n        virJSONValuePtr child = virJSONValueArrayGet(resources, i);\n        virLockSpaceResourcePtr res;\n        const char *tmp;\n        virJSONValuePtr owners;\n        size_t j;\n        size_t m;\n\n        if (VIR_ALLOC(res) < 0)\n            goto error;\n        res->fd = -1;\n\n        if (!(tmp = virJSONValueObjectGetString(child, \"name\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource name in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        res->name = g_strdup(tmp);\n\n        if (!(tmp = virJSONValueObjectGetString(child, \"path\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource path in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        res->path = g_strdup(tmp);\n        if (virJSONValueObjectGetNumberInt(child, \"fd\", &res->fd) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource fd in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        if (virSetInherit(res->fd, false) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"Cannot enable close-on-exec flag\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        if (virJSONValueObjectGetBoolean(child, \"lockHeld\", &res->lockHeld) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource lockHeld in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n\n        if (virJSONValueObjectGetNumberUint(child, \"flags\", &res->flags) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource flags in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n\n        if (!(owners = virJSONValueObjectGet(child, \"owners\"))) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Missing resource owners in JSON document\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n\n        if (!virJSONValueIsArray(owners)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"Malformed owners array\"));\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n\n        m = virJSONValueArraySize(owners);\n        if (VIR_ALLOC_N(res->owners, res->nOwners) < 0) {\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n        res->nOwners = m;\n\n        for (j = 0; j < res->nOwners; j++) {\n            unsigned long long int owner;\n            virJSONValuePtr ownerval = virJSONValueArrayGet(owners, j);\n\n            if (virJSONValueGetNumberUlong(ownerval, &owner) < 0) {\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"Malformed owner value in JSON document\"));\n                virLockSpaceResourceFree(res);\n                goto error;\n            }\n\n            res->owners[j] = (pid_t)owner;\n        }\n\n        if (virHashAddEntry(lockspace->resources, res->name, res) < 0) {\n            virLockSpaceResourceFree(res);\n            goto error;\n        }\n    }\n\n    return lockspace;\n\n error:\n    virLockSpaceFree(lockspace);\n    return NULL;\n}"
  },
  {
    "function_name": "virLockSpaceNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "238-283",
    "snippet": "virLockSpacePtr virLockSpaceNew(const char *directory)\n{\n    virLockSpacePtr lockspace;\n\n    VIR_DEBUG(\"directory=%s\", NULLSTR(directory));\n\n    if (VIR_ALLOC(lockspace) < 0)\n        return NULL;\n\n    if (virMutexInit(&lockspace->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize lockspace mutex\"));\n        VIR_FREE(lockspace);\n        return NULL;\n    }\n\n    lockspace->dir = g_strdup(directory);\n\n    if (!(lockspace->resources = virHashCreate(VIR_LOCKSPACE_TABLE_SIZE,\n                                               virLockSpaceResourceDataFree)))\n        goto error;\n\n    if (directory) {\n        if (virFileExists(directory)) {\n            if (!virFileIsDir(directory)) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Lockspace location %s exists, but is not a directory\"),\n                               directory);\n                goto error;\n            }\n        } else {\n            if (virFileMakePathWithMode(directory, 0700) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to create lockspace %s\"),\n                                     directory);\n                goto error;\n            }\n        }\n    }\n\n    return lockspace;\n\n error:\n    virLockSpaceFree(lockspace);\n    return NULL;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIR_LOCKSPACE_TABLE_SIZE 10"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockSpaceFree",
          "args": [
            "lockspace"
          ],
          "line": 281
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "505-514",
          "snippet": "void virLockSpaceFree(virLockSpacePtr lockspace)\n{\n    if (!lockspace)\n        return;\n\n    virHashFree(lockspace->resources);\n    VIR_FREE(lockspace->dir);\n    virMutexDestroy(&lockspace->lock);\n    VIR_FREE(lockspace);\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nvoid virLockSpaceFree(virLockSpacePtr lockspace)\n{\n    if (!lockspace)\n        return;\n\n    virHashFree(lockspace->resources);\n    VIR_FREE(lockspace->dir);\n    virMutexDestroy(&lockspace->lock);\n    VIR_FREE(lockspace);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to create lockspace %s\")",
            "directory"
          ],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to create lockspace %s\""
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileMakePathWithMode",
          "args": [
            "directory",
            "0700"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePathWithMode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3082-3091",
          "snippet": "int\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Lockspace location %s exists, but is not a directory\")",
            "directory"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileIsDir",
          "args": [
            "directory"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "virFileIsDir",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1850-1855",
          "snippet": "bool\nvirFileIsDir(const char *path)\n{\n    struct stat s;\n    return (stat(path, &s) == 0) && S_ISDIR(s.st_mode);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileIsDir(const char *path)\n{\n    struct stat s;\n    return (stat(path, &s) == 0) && S_ISDIR(s.st_mode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "directory"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashCreate",
          "args": [
            "VIR_LOCKSPACE_TABLE_SIZE",
            "virLockSpaceResourceDataFree"
          ],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "virHashCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "202-211",
          "snippet": "virHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "lockspace"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Unable to initialize lockspace mutex\")"
          ],
          "line": 248
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexInit",
          "args": [
            "&lockspace->lock"
          ],
          "line": 247
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "lockspace"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"directory=%s\"",
            "NULLSTR(directory)"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NULLSTR",
          "args": [
            "directory"
          ],
          "line": 242
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\n#define VIR_LOCKSPACE_TABLE_SIZE 10\n\nvirLockSpacePtr virLockSpaceNew(const char *directory)\n{\n    virLockSpacePtr lockspace;\n\n    VIR_DEBUG(\"directory=%s\", NULLSTR(directory));\n\n    if (VIR_ALLOC(lockspace) < 0)\n        return NULL;\n\n    if (virMutexInit(&lockspace->lock) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"Unable to initialize lockspace mutex\"));\n        VIR_FREE(lockspace);\n        return NULL;\n    }\n\n    lockspace->dir = g_strdup(directory);\n\n    if (!(lockspace->resources = virHashCreate(VIR_LOCKSPACE_TABLE_SIZE,\n                                               virLockSpaceResourceDataFree)))\n        goto error;\n\n    if (directory) {\n        if (virFileExists(directory)) {\n            if (!virFileIsDir(directory)) {\n                virReportError(VIR_ERR_INTERNAL_ERROR,\n                               _(\"Lockspace location %s exists, but is not a directory\"),\n                               directory);\n                goto error;\n            }\n        } else {\n            if (virFileMakePathWithMode(directory, 0700) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to create lockspace %s\"),\n                                     directory);\n                goto error;\n            }\n        }\n    }\n\n    return lockspace;\n\n error:\n    virLockSpaceFree(lockspace);\n    return NULL;\n}"
  },
  {
    "function_name": "virLockSpaceResourceDataFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "231-235",
    "snippet": "static void virLockSpaceResourceDataFree(void *opaque)\n{\n    virLockSpaceResourcePtr res = opaque;\n    virLockSpaceResourceFree(res);\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockSpaceResourceFree",
          "args": [
            "res"
          ],
          "line": 234
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceResourceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "77-110",
          "snippet": "static void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic void virLockSpaceResourceDataFree(void *opaque)\n{\n    virLockSpaceResourcePtr res = opaque;\n    virLockSpaceResourceFree(res);\n}"
  },
  {
    "function_name": "virLockSpaceResourceNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "113-228",
    "snippet": "static virLockSpaceResourcePtr\nvirLockSpaceResourceNew(virLockSpacePtr lockspace,\n                        const char *resname,\n                        unsigned int flags,\n                        pid_t owner)\n{\n    virLockSpaceResourcePtr res;\n    bool shared = !!(flags & VIR_LOCK_SPACE_ACQUIRE_SHARED);\n\n    if (VIR_ALLOC(res) < 0)\n        return NULL;\n\n    res->fd = -1;\n    res->flags = flags;\n\n    res->name = g_strdup(resname);\n\n    if (!(res->path = virLockSpaceGetResourcePath(lockspace, resname)))\n        goto error;\n\n    if (flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE) {\n        while (1) {\n            struct stat a, b;\n            if ((res->fd = open(res->path, O_RDWR|O_CREAT, 0600)) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to open/create resource %s\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (virSetCloseExec(res->fd) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to set close-on-exec flag '%s'\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (fstat(res->fd, &b) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to check status of pid file '%s'\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (virFileLock(res->fd, shared, 0, 1, false) < 0) {\n                if (errno == EACCES || errno == EAGAIN) {\n                    virReportError(VIR_ERR_RESOURCE_BUSY,\n                                   _(\"Lockspace resource '%s' is locked\"),\n                                   resname);\n                } else {\n                    virReportSystemError(errno,\n                                         _(\"Unable to acquire lock on '%s'\"),\n                                         res->path);\n                }\n                goto error;\n            }\n\n            /* Now make sure the pidfile we locked is the same\n             * one that now exists on the filesystem\n             */\n            if (stat(res->path, &a) < 0) {\n                VIR_DEBUG(\"Resource '%s' disappeared: %s\",\n                          res->path, g_strerror(errno));\n                VIR_FORCE_CLOSE(res->fd);\n                /* Someone else must be racing with us, so try again */\n                continue;\n            }\n\n            if (a.st_ino == b.st_ino)\n                break;\n\n            VIR_DEBUG(\"Resource '%s' was recreated\", res->path);\n            VIR_FORCE_CLOSE(res->fd);\n            /* Someone else must be racing with us, so try again */\n        }\n    } else {\n        if ((res->fd = open(res->path, O_RDWR)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open resource %s\"),\n                                 res->path);\n            goto error;\n        }\n\n        if (virSetCloseExec(res->fd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to set close-on-exec flag '%s'\"),\n                                 res->path);\n            goto error;\n        }\n\n        if (virFileLock(res->fd, shared, 0, 1, false) < 0) {\n            if (errno == EACCES || errno == EAGAIN) {\n                virReportError(VIR_ERR_RESOURCE_BUSY,\n                               _(\"Lockspace resource '%s' is locked\"),\n                               resname);\n            } else {\n                virReportSystemError(errno,\n                                     _(\"Unable to acquire lock on '%s'\"),\n                                     res->path);\n            }\n            goto error;\n        }\n    }\n    res->lockHeld = true;\n\n    if (VIR_EXPAND_N(res->owners, res->nOwners, 1) < 0)\n        goto error;\n\n    res->owners[res->nOwners-1] = owner;\n\n    return res;\n\n error:\n    virLockSpaceResourceFree(res);\n    return NULL;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virLockSpaceResourceFree",
          "args": [
            "res"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceResourceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "77-110",
          "snippet": "static void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_EXPAND_N",
          "args": [
            "res->owners",
            "res->nOwners",
            "1"
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to acquire lock on '%s'\")",
            "res->path"
          ],
          "line": 209
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Unable to acquire lock on '%s'\""
          ],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_RESOURCE_BUSY",
            "_(\"Lockspace resource '%s' is locked\")",
            "resname"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileLock",
          "args": [
            "res->fd",
            "shared",
            "0",
            "1",
            "false"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "virFileLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "489-496",
          "snippet": "int virFileLock(int fd G_GNUC_UNUSED,\n                bool shared G_GNUC_UNUSED,\n                off_t start G_GNUC_UNUSED,\n                off_t len G_GNUC_UNUSED,\n                bool waitForLock G_GNUC_UNUSED)\n{\n    return -ENOSYS;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileLock(int fd G_GNUC_UNUSED,\n                bool shared G_GNUC_UNUSED,\n                off_t start G_GNUC_UNUSED,\n                off_t len G_GNUC_UNUSED,\n                bool waitForLock G_GNUC_UNUSED)\n{\n    return -ENOSYS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to set close-on-exec flag '%s'\")",
            "res->path"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSetCloseExec",
          "args": [
            "res->fd"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "virSetCloseExec",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "131-134",
          "snippet": "int virSetCloseExec(int fd)\n{\n    return virSetInherit(fd, false);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint virSetCloseExec(int fd)\n{\n    return virSetInherit(fd, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to open resource %s\")",
            "res->path"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "res->path",
            "O_RDWR"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "virFileFdopen",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "164-177",
          "snippet": "FILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nFILE *virFileFdopen(int *fdptr, const char *mode)\n{\n    FILE *file = NULL;\n\n    if (*fdptr >= 0) {\n        file = fdopen(*fdptr, mode);\n        if (file)\n            *fdptr = -1;\n    } else {\n        errno = EBADF;\n    }\n\n    return file;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "res->fd"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Resource '%s' was recreated\"",
            "res->path"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "res->fd"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Resource '%s' disappeared: %s\"",
            "res->path",
            "g_strerror(errno)"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "res->path",
            "&a"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to acquire lock on '%s'\")",
            "res->path"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_RESOURCE_BUSY",
            "_(\"Lockspace resource '%s' is locked\")",
            "resname"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to check status of pid file '%s'\")",
            "res->path"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fstat",
          "args": [
            "res->fd",
            "&b"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to set close-on-exec flag '%s'\")",
            "res->path"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Unable to open/create resource %s\")",
            "res->path"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "res->path",
            "O_RDWR|O_CREAT",
            "0600"
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockReopenReadOnly",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_block.c",
          "lines": "3308-3323",
          "snippet": "int\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"qemu_security.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_command.h\"",
            "#include \"qemu_block.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"qemu_security.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_command.h\"\n#include \"qemu_block.h\"\n#include <config.h>\n\nint\nqemuBlockReopenReadOnly(virDomainObjPtr vm,\n                         virStorageSourcePtr src,\n                         qemuDomainAsyncJob asyncJob)\n{\n    if (src->readonly)\n        return 0;\n\n    src->readonly = true;\n    if (qemuBlockReopenFormat(vm, src, asyncJob) < 0) {\n        src->readonly = false;\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLockSpaceGetResourcePath",
          "args": [
            "lockspace",
            "resname"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "virLockSpaceGetResourcePath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
          "lines": "65-74",
          "snippet": "static char *virLockSpaceGetResourcePath(virLockSpacePtr lockspace,\n                                         const char *resname)\n{\n    char *ret;\n    if (lockspace->dir)\n        ret = g_strdup_printf(\"%s/%s\", lockspace->dir, resname);\n    else\n        ret = g_strdup(resname);\n    return ret;\n}",
          "includes": [
            "#include <sys/stat.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virlockspace.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic char *virLockSpaceGetResourcePath(virLockSpacePtr lockspace,\n                                         const char *resname)\n{\n    char *ret;\n    if (lockspace->dir)\n        ret = g_strdup_printf(\"%s/%s\", lockspace->dir, resname);\n    else\n        ret = g_strdup(resname);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "res"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic virLockSpaceResourcePtr\nvirLockSpaceResourceNew(virLockSpacePtr lockspace,\n                        const char *resname,\n                        unsigned int flags,\n                        pid_t owner)\n{\n    virLockSpaceResourcePtr res;\n    bool shared = !!(flags & VIR_LOCK_SPACE_ACQUIRE_SHARED);\n\n    if (VIR_ALLOC(res) < 0)\n        return NULL;\n\n    res->fd = -1;\n    res->flags = flags;\n\n    res->name = g_strdup(resname);\n\n    if (!(res->path = virLockSpaceGetResourcePath(lockspace, resname)))\n        goto error;\n\n    if (flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE) {\n        while (1) {\n            struct stat a, b;\n            if ((res->fd = open(res->path, O_RDWR|O_CREAT, 0600)) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to open/create resource %s\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (virSetCloseExec(res->fd) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Failed to set close-on-exec flag '%s'\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (fstat(res->fd, &b) < 0) {\n                virReportSystemError(errno,\n                                     _(\"Unable to check status of pid file '%s'\"),\n                                     res->path);\n                goto error;\n            }\n\n            if (virFileLock(res->fd, shared, 0, 1, false) < 0) {\n                if (errno == EACCES || errno == EAGAIN) {\n                    virReportError(VIR_ERR_RESOURCE_BUSY,\n                                   _(\"Lockspace resource '%s' is locked\"),\n                                   resname);\n                } else {\n                    virReportSystemError(errno,\n                                         _(\"Unable to acquire lock on '%s'\"),\n                                         res->path);\n                }\n                goto error;\n            }\n\n            /* Now make sure the pidfile we locked is the same\n             * one that now exists on the filesystem\n             */\n            if (stat(res->path, &a) < 0) {\n                VIR_DEBUG(\"Resource '%s' disappeared: %s\",\n                          res->path, g_strerror(errno));\n                VIR_FORCE_CLOSE(res->fd);\n                /* Someone else must be racing with us, so try again */\n                continue;\n            }\n\n            if (a.st_ino == b.st_ino)\n                break;\n\n            VIR_DEBUG(\"Resource '%s' was recreated\", res->path);\n            VIR_FORCE_CLOSE(res->fd);\n            /* Someone else must be racing with us, so try again */\n        }\n    } else {\n        if ((res->fd = open(res->path, O_RDWR)) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Unable to open resource %s\"),\n                                 res->path);\n            goto error;\n        }\n\n        if (virSetCloseExec(res->fd) < 0) {\n            virReportSystemError(errno,\n                                 _(\"Failed to set close-on-exec flag '%s'\"),\n                                 res->path);\n            goto error;\n        }\n\n        if (virFileLock(res->fd, shared, 0, 1, false) < 0) {\n            if (errno == EACCES || errno == EAGAIN) {\n                virReportError(VIR_ERR_RESOURCE_BUSY,\n                               _(\"Lockspace resource '%s' is locked\"),\n                               resname);\n            } else {\n                virReportSystemError(errno,\n                                     _(\"Unable to acquire lock on '%s'\"),\n                                     res->path);\n            }\n            goto error;\n        }\n    }\n    res->lockHeld = true;\n\n    if (VIR_EXPAND_N(res->owners, res->nOwners, 1) < 0)\n        goto error;\n\n    res->owners[res->nOwners-1] = owner;\n\n    return res;\n\n error:\n    virLockSpaceResourceFree(res);\n    return NULL;\n}"
  },
  {
    "function_name": "virLockSpaceResourceFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "77-110",
    "snippet": "static void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "res"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "res->name"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "res->path"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_CLOSE",
          "args": [
            "res->fd"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "res->owners"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to unlink resource %s: %s\"",
            "res->path",
            "g_strerror(errno)"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "res->path"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to unlink resource %s: %s\"",
            "res->path",
            "g_strerror(errno)"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "unlink",
          "args": [
            "res->path"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Could not upgrade shared lease to exclusive, not deleting\""
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileLock",
          "args": [
            "res->fd",
            "false",
            "0",
            "1",
            "false"
          ],
          "line": 87
        },
        "resolved": true,
        "details": {
          "function_name": "virFileLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "489-496",
          "snippet": "int virFileLock(int fd G_GNUC_UNUSED,\n                bool shared G_GNUC_UNUSED,\n                off_t start G_GNUC_UNUSED,\n                off_t len G_GNUC_UNUSED,\n                bool waitForLock G_GNUC_UNUSED)\n{\n    return -ENOSYS;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint virFileLock(int fd G_GNUC_UNUSED,\n                bool shared G_GNUC_UNUSED,\n                off_t start G_GNUC_UNUSED,\n                off_t len G_GNUC_UNUSED,\n                bool waitForLock G_GNUC_UNUSED)\n{\n    return -ENOSYS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic void virLockSpaceResourceFree(virLockSpaceResourcePtr res)\n{\n    if (!res)\n        return;\n\n    if (res->lockHeld &&\n        (res->flags & VIR_LOCK_SPACE_ACQUIRE_AUTOCREATE)) {\n        if (res->flags & VIR_LOCK_SPACE_ACQUIRE_SHARED) {\n            /* We must upgrade to an exclusive lock to ensure\n             * no one else still has it before trying to delete */\n            if (virFileLock(res->fd, false, 0, 1, false) < 0) {\n                VIR_DEBUG(\"Could not upgrade shared lease to exclusive, not deleting\");\n            } else {\n                if (unlink(res->path) < 0 &&\n                    errno != ENOENT) {\n                    VIR_WARN(\"Failed to unlink resource %s: %s\",\n                             res->path, g_strerror(errno));\n                }\n            }\n        } else {\n            if (unlink(res->path) < 0 &&\n                errno != ENOENT) {\n                VIR_WARN(\"Failed to unlink resource %s: %s\",\n                         res->path, g_strerror(errno));\n            }\n        }\n    }\n\n    VIR_FREE(res->owners);\n    VIR_FORCE_CLOSE(res->fd);\n    VIR_FREE(res->path);\n    VIR_FREE(res->name);\n    VIR_FREE(res);\n}"
  },
  {
    "function_name": "virLockSpaceGetResourcePath",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlockspace.c",
    "lines": "65-74",
    "snippet": "static char *virLockSpaceGetResourcePath(virLockSpacePtr lockspace,\n                                         const char *resname)\n{\n    char *ret;\n    if (lockspace->dir)\n        ret = g_strdup_printf(\"%s/%s\", lockspace->dir, resname);\n    else\n        ret = g_strdup(resname);\n    return ret;\n}",
    "includes": [
      "#include <sys/stat.h>",
      "#include <unistd.h>",
      "#include <fcntl.h>",
      "#include \"virstring.h\"",
      "#include \"virthread.h\"",
      "#include \"virhash.h\"",
      "#include \"virfile.h\"",
      "#include \"virutil.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"virlockspace.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "resname"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <sys/stat.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virlockspace.h\"\n#include <config.h>\n\nstatic char *virLockSpaceGetResourcePath(virLockSpacePtr lockspace,\n                                         const char *resname)\n{\n    char *ret;\n    if (lockspace->dir)\n        ret = g_strdup_printf(\"%s/%s\", lockspace->dir, resname);\n    else\n        ret = g_strdup(resname);\n    return ret;\n}"
  }
]