[
  {
    "function_name": "AppArmorGetBaseLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "1130-1135",
    "snippet": "static const char *\nAppArmorGetBaseLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                     int virtType G_GNUC_UNUSED)\n{\n    return NULL;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic const char *\nAppArmorGetBaseLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                     int virtType G_GNUC_UNUSED)\n{\n    return NULL;\n}"
  },
  {
    "function_name": "AppArmorGetMountOptions",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "1120-1128",
    "snippet": "static char *\nAppArmorGetMountOptions(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                        virDomainDefPtr vm G_GNUC_UNUSED)\n{\n    char *opts;\n\n    opts = g_strdup(\"\");\n    return opts;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "\"\""
          ],
          "line": 1126
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nAppArmorGetMountOptions(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                        virDomainDefPtr vm G_GNUC_UNUSED)\n{\n    char *opts;\n\n    opts = g_strdup(\"\");\n    return opts;\n}"
  },
  {
    "function_name": "AppArmorSetFDLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "1095-1118",
    "snippet": "static int\nAppArmorSetFDLabel(virSecurityManagerPtr mgr,\n                   virDomainDefPtr def,\n                   int fd)\n{\n    char *proc = NULL;\n    char *fd_path = NULL;\n\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->imagelabel)\n        return 0;\n\n    proc = g_strdup_printf(\"/proc/self/fd/%d\", fd);\n\n    if (virFileResolveLink(proc, &fd_path) < 0) {\n        /* it's a deleted file, presumably.  Ignore? */\n        VIR_WARN(\"could not find path for descriptor %s, skipping\", proc);\n        return 0;\n    }\n\n    return reload_profile(mgr, def, fd_path, true);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "fd_path",
            "true"
          ],
          "line": 1117
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"could not find path for descriptor %s, skipping\"",
            "proc"
          ],
          "line": 1113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileResolveLink",
          "args": [
            "proc",
            "&fd_path"
          ],
          "line": 1111
        },
        "resolved": true,
        "details": {
          "function_name": "virFileResolveLink",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1608-1612",
          "snippet": "int\nvirFileResolveLink(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, false, resultpath);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileResolveLink(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, false, resultpath);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"/proc/self/fd/%d\"",
            "fd"
          ],
          "line": 1109
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 1104
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorSetFDLabel(virSecurityManagerPtr mgr,\n                   virDomainDefPtr def,\n                   int fd)\n{\n    char *proc = NULL;\n    char *fd_path = NULL;\n\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->imagelabel)\n        return 0;\n\n    proc = g_strdup_printf(\"/proc/self/fd/%d\", fd);\n\n    if (virFileResolveLink(proc, &fd_path) < 0) {\n        /* it's a deleted file, presumably.  Ignore? */\n        VIR_WARN(\"could not find path for descriptor %s, skipping\", proc);\n        return 0;\n    }\n\n    return reload_profile(mgr, def, fd_path, true);\n}"
  },
  {
    "function_name": "AppArmorRestoreSavedStateLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "1087-1093",
    "snippet": "static int\nAppArmorRestoreSavedStateLabel(virSecurityManagerPtr mgr,\n                               virDomainDefPtr def,\n                               const char *savefile G_GNUC_UNUSED)\n{\n    return reload_profile(mgr, def, NULL, false);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "NULL",
            "false"
          ],
          "line": 1092
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorRestoreSavedStateLabel(virSecurityManagerPtr mgr,\n                               virDomainDefPtr def,\n                               const char *savefile G_GNUC_UNUSED)\n{\n    return reload_profile(mgr, def, NULL, false);\n}"
  },
  {
    "function_name": "AppArmorSetPathLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "1067-1085",
    "snippet": "static int\nAppArmorSetPathLabel(virSecurityManagerPtr mgr,\n                           virDomainDefPtr def,\n                           const char *path,\n                           bool allowSubtree)\n{\n    int rc = -1;\n    char *full_path = NULL;\n\n    if (allowSubtree) {\n        full_path = g_strdup_printf(\"%s/{,**}\", path);\n        rc = reload_profile(mgr, def, full_path, true);\n        VIR_FREE(full_path);\n    } else {\n        rc = reload_profile(mgr, def, path, true);\n    }\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "path",
            "true"
          ],
          "line": 1081
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "full_path"
          ],
          "line": 1079
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/{,**}\"",
            "path"
          ],
          "line": 1077
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetPathLabel(virSecurityManagerPtr mgr,\n                           virDomainDefPtr def,\n                           const char *path,\n                           bool allowSubtree)\n{\n    int rc = -1;\n    char *full_path = NULL;\n\n    if (allowSubtree) {\n        full_path = g_strdup_printf(\"%s/{,**}\", path);\n        rc = reload_profile(mgr, def, full_path, true);\n        VIR_FREE(full_path);\n    } else {\n        rc = reload_profile(mgr, def, path, true);\n    }\n\n    return rc;\n}"
  },
  {
    "function_name": "AppArmorSetSavedStateLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "1059-1065",
    "snippet": "static int\nAppArmorSetSavedStateLabel(virSecurityManagerPtr mgr,\n                           virDomainDefPtr def,\n                           const char *savefile)\n{\n    return reload_profile(mgr, def, savefile, true);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "savefile",
            "true"
          ],
          "line": 1064
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSavedStateLabel(virSecurityManagerPtr mgr,\n                           virDomainDefPtr def,\n                           const char *savefile)\n{\n    return reload_profile(mgr, def, savefile, true);\n}"
  },
  {
    "function_name": "AppArmorRestoreChardevLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "1044-1057",
    "snippet": "static int\nAppArmorRestoreChardevLabel(virSecurityManagerPtr mgr,\n                            virDomainDefPtr def,\n                            virDomainChrSourceDefPtr dev_source G_GNUC_UNUSED,\n                            bool chardevStdioLogd G_GNUC_UNUSED)\n{\n    virSecurityLabelDefPtr secdef;\n\n    secdef = virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n    if (!secdef)\n        return 0;\n\n    return reload_profile(mgr, def, NULL, false);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "NULL",
            "false"
          ],
          "line": 1056
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 1052
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorRestoreChardevLabel(virSecurityManagerPtr mgr,\n                            virDomainDefPtr def,\n                            virDomainChrSourceDefPtr dev_source G_GNUC_UNUSED,\n                            bool chardevStdioLogd G_GNUC_UNUSED)\n{\n    virSecurityLabelDefPtr secdef;\n\n    secdef = virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n    if (!secdef)\n        return 0;\n\n    return reload_profile(mgr, def, NULL, false);\n}"
  },
  {
    "function_name": "AppArmorSetChardevLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "989-1042",
    "snippet": "static int\nAppArmorSetChardevLabel(virSecurityManagerPtr mgr,\n                        virDomainDefPtr def,\n                        virDomainChrSourceDefPtr dev_source,\n                        bool chardevStdioLogd G_GNUC_UNUSED)\n{\n    char *in = NULL, *out = NULL;\n    int ret = -1;\n    virSecurityLabelDefPtr secdef;\n\n    secdef = virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n    if (!secdef)\n        return 0;\n\n    switch ((virDomainChrType)dev_source->type) {\n    case VIR_DOMAIN_CHR_TYPE_DEV:\n    case VIR_DOMAIN_CHR_TYPE_FILE:\n    case VIR_DOMAIN_CHR_TYPE_UNIX:\n    case VIR_DOMAIN_CHR_TYPE_PTY:\n        ret = reload_profile(mgr, def, dev_source->data.file.path, true);\n        break;\n\n    case VIR_DOMAIN_CHR_TYPE_PIPE:\n        in = g_strdup_printf(\"%s.in\", dev_source->data.file.path);\n        out = g_strdup_printf(\"%s.out\", dev_source->data.file.path);\n        if (virFileExists(in)) {\n            if (reload_profile(mgr, def, in, true) < 0)\n                goto done;\n        }\n        if (virFileExists(out)) {\n            if (reload_profile(mgr, def, out, true) < 0)\n                goto done;\n        }\n        ret = reload_profile(mgr, def, dev_source->data.file.path, true);\n        break;\n\n    case VIR_DOMAIN_CHR_TYPE_SPICEPORT:\n    case VIR_DOMAIN_CHR_TYPE_NULL:\n    case VIR_DOMAIN_CHR_TYPE_VC:\n    case VIR_DOMAIN_CHR_TYPE_STDIO:\n    case VIR_DOMAIN_CHR_TYPE_UDP:\n    case VIR_DOMAIN_CHR_TYPE_TCP:\n    case VIR_DOMAIN_CHR_TYPE_SPICEVMC:\n    case VIR_DOMAIN_CHR_TYPE_NMDM:\n    case VIR_DOMAIN_CHR_TYPE_LAST:\n        ret = 0;\n        break;\n    }\n\n done:\n    VIR_FREE(in);\n    VIR_FREE(out);\n    return ret;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "out"
          ],
          "line": 1040
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "in"
          ],
          "line": 1039
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "dev_source->data.file.path",
            "true"
          ],
          "line": 1022
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "out"
          ],
          "line": 1018
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s.out\"",
            "dev_source->data.file.path"
          ],
          "line": 1013
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 999
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorSetChardevLabel(virSecurityManagerPtr mgr,\n                        virDomainDefPtr def,\n                        virDomainChrSourceDefPtr dev_source,\n                        bool chardevStdioLogd G_GNUC_UNUSED)\n{\n    char *in = NULL, *out = NULL;\n    int ret = -1;\n    virSecurityLabelDefPtr secdef;\n\n    secdef = virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n    if (!secdef)\n        return 0;\n\n    switch ((virDomainChrType)dev_source->type) {\n    case VIR_DOMAIN_CHR_TYPE_DEV:\n    case VIR_DOMAIN_CHR_TYPE_FILE:\n    case VIR_DOMAIN_CHR_TYPE_UNIX:\n    case VIR_DOMAIN_CHR_TYPE_PTY:\n        ret = reload_profile(mgr, def, dev_source->data.file.path, true);\n        break;\n\n    case VIR_DOMAIN_CHR_TYPE_PIPE:\n        in = g_strdup_printf(\"%s.in\", dev_source->data.file.path);\n        out = g_strdup_printf(\"%s.out\", dev_source->data.file.path);\n        if (virFileExists(in)) {\n            if (reload_profile(mgr, def, in, true) < 0)\n                goto done;\n        }\n        if (virFileExists(out)) {\n            if (reload_profile(mgr, def, out, true) < 0)\n                goto done;\n        }\n        ret = reload_profile(mgr, def, dev_source->data.file.path, true);\n        break;\n\n    case VIR_DOMAIN_CHR_TYPE_SPICEPORT:\n    case VIR_DOMAIN_CHR_TYPE_NULL:\n    case VIR_DOMAIN_CHR_TYPE_VC:\n    case VIR_DOMAIN_CHR_TYPE_STDIO:\n    case VIR_DOMAIN_CHR_TYPE_UDP:\n    case VIR_DOMAIN_CHR_TYPE_TCP:\n    case VIR_DOMAIN_CHR_TYPE_SPICEVMC:\n    case VIR_DOMAIN_CHR_TYPE_NMDM:\n    case VIR_DOMAIN_CHR_TYPE_LAST:\n        ret = 0;\n        break;\n    }\n\n done:\n    VIR_FREE(in);\n    VIR_FREE(out);\n    return ret;\n}"
  },
  {
    "function_name": "AppArmorRestoreSecurityHostdevLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "973-987",
    "snippet": "static int\nAppArmorRestoreSecurityHostdevLabel(virSecurityManagerPtr mgr,\n                                    virDomainDefPtr def,\n                                    virDomainHostdevDefPtr dev G_GNUC_UNUSED,\n                                    const char *vroot G_GNUC_UNUSED)\n\n{\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    return reload_profile(mgr, def, NULL, false);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "NULL",
            "false"
          ],
          "line": 986
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 981
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorRestoreSecurityHostdevLabel(virSecurityManagerPtr mgr,\n                                    virDomainDefPtr def,\n                                    virDomainHostdevDefPtr dev G_GNUC_UNUSED,\n                                    const char *vroot G_GNUC_UNUSED)\n\n{\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    return reload_profile(mgr, def, NULL, false);\n}"
  },
  {
    "function_name": "AppArmorSetSecurityHostdevLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "847-970",
    "snippet": "static int\nAppArmorSetSecurityHostdevLabel(virSecurityManagerPtr mgr,\n                                virDomainDefPtr def,\n                                virDomainHostdevDefPtr dev,\n                                const char *vroot)\n{\n    struct SDPDOP *ptr;\n    int ret = -1;\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n    virDomainHostdevSubsysUSBPtr usbsrc = &dev->source.subsys.u.usb;\n    virDomainHostdevSubsysPCIPtr pcisrc = &dev->source.subsys.u.pci;\n    virDomainHostdevSubsysSCSIPtr scsisrc = &dev->source.subsys.u.scsi;\n    virDomainHostdevSubsysSCSIVHostPtr hostsrc = &dev->source.subsys.u.scsi_host;\n    virDomainHostdevSubsysMediatedDevPtr mdevsrc = &dev->source.subsys.u.mdev;\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    if (dev->mode != VIR_DOMAIN_HOSTDEV_MODE_SUBSYS)\n        return 0;\n\n    /* Like AppArmorRestoreSecurityImageLabel() for a networked disk,\n     * do nothing for an iSCSI hostdev\n     */\n    if (dev->source.subsys.type == VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_SCSI &&\n        scsisrc->protocol == VIR_DOMAIN_HOSTDEV_SCSI_PROTOCOL_TYPE_ISCSI)\n        return 0;\n\n    if (profile_loaded(secdef->imagelabel) < 0)\n        return 0;\n\n    if (VIR_ALLOC(ptr) < 0)\n        return -1;\n    ptr->mgr = mgr;\n    ptr->def = def;\n\n    switch ((virDomainHostdevSubsysType)dev->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_USB: {\n        virUSBDevicePtr usb =\n            virUSBDeviceNew(usbsrc->bus, usbsrc->device, vroot);\n        if (!usb)\n            goto done;\n\n        ret = virUSBDeviceFileIterate(usb, AppArmorSetSecurityUSBLabel, ptr);\n        virUSBDeviceFree(usb);\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_PCI: {\n        virPCIDevicePtr pci =\n            virPCIDeviceNew(pcisrc->addr.domain, pcisrc->addr.bus,\n                            pcisrc->addr.slot, pcisrc->addr.function);\n\n        if (!pci)\n            goto done;\n\n        if (pcisrc->backend == VIR_DOMAIN_HOSTDEV_PCI_BACKEND_VFIO) {\n            char *vfioGroupDev = virPCIDeviceGetIOMMUGroupDev(pci);\n\n            if (!vfioGroupDev) {\n                virPCIDeviceFree(pci);\n                goto done;\n            }\n            ret = AppArmorSetSecurityPCILabel(pci, vfioGroupDev, ptr);\n            VIR_FREE(vfioGroupDev);\n        } else {\n            ret = virPCIDeviceFileIterate(pci, AppArmorSetSecurityPCILabel, ptr);\n        }\n        virPCIDeviceFree(pci);\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_SCSI: {\n        virDomainHostdevSubsysSCSIHostPtr scsihostsrc = &scsisrc->u.host;\n        virSCSIDevicePtr scsi =\n            virSCSIDeviceNew(NULL,\n                             scsihostsrc->adapter, scsihostsrc->bus,\n                             scsihostsrc->target, scsihostsrc->unit,\n                             dev->readonly, dev->shareable);\n\n         if (!scsi)\n             goto done;\n\n        ret = virSCSIDeviceFileIterate(scsi, AppArmorSetSecuritySCSILabel, ptr);\n        virSCSIDeviceFree(scsi);\n\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_SCSI_HOST: {\n        virSCSIVHostDevicePtr host = virSCSIVHostDeviceNew(hostsrc->wwpn);\n\n        if (!host)\n            goto done;\n\n        ret = virSCSIVHostDeviceFileIterate(host,\n                                            AppArmorSetSecurityHostLabel,\n                                            ptr);\n        virSCSIVHostDeviceFree(host);\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_MDEV: {\n        char *vfiodev = NULL;\n\n        if (!(vfiodev = virMediatedDeviceGetIOMMUGroupDev(mdevsrc->uuidstr)))\n            goto done;\n\n        ret = AppArmorSetSecurityHostdevLabelHelper(vfiodev, ptr);\n\n        VIR_FREE(vfiodev);\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_LAST:\n        ret = 0;\n        break;\n    }\n\n done:\n    VIR_FREE(ptr);\n    return ret;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "ptr"
          ],
          "line": 968
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vfiodev"
          ],
          "line": 958
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AppArmorSetSecurityHostdevLabelHelper",
          "args": [
            "vfiodev",
            "ptr"
          ],
          "line": 956
        },
        "resolved": true,
        "details": {
          "function_name": "AppArmorSetSecurityHostdevLabelHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "297-304",
          "snippet": "static int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virMediatedDeviceGetIOMMUGroupDev",
          "args": [
            "mdevsrc->uuidstr"
          ],
          "line": 953
        },
        "resolved": true,
        "details": {
          "function_name": "virMediatedDeviceGetIOMMUGroupDev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virmdev.c",
          "lines": "205-234",
          "snippet": "char *\nvirMediatedDeviceGetIOMMUGroupDev(const char *uuidstr)\n{\n    g_autofree char *result_path = NULL;\n    g_autofree char *result_file = NULL;\n    g_autofree char *iommu_path = NULL;\n    g_autofree char *dev_path = virMediatedDeviceGetSysfsPath(uuidstr);\n    char *vfio_path = NULL;\n\n    if (!dev_path)\n        return NULL;\n\n    iommu_path = g_strdup_printf(\"%s/iommu_group\", dev_path);\n\n    if (!virFileExists(iommu_path)) {\n        virReportSystemError(errno, _(\"failed to access '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    if (virFileResolveLink(iommu_path, &result_path) < 0) {\n        virReportSystemError(errno, _(\"failed to resolve '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    result_file = g_path_get_basename(result_path);\n\n    vfio_path = g_strdup_printf(\"/dev/vfio/%s\", result_file);\n\n    return vfio_path;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virmdev.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virmdev.h\"\n#include <config.h>\n\nchar *\nvirMediatedDeviceGetIOMMUGroupDev(const char *uuidstr)\n{\n    g_autofree char *result_path = NULL;\n    g_autofree char *result_file = NULL;\n    g_autofree char *iommu_path = NULL;\n    g_autofree char *dev_path = virMediatedDeviceGetSysfsPath(uuidstr);\n    char *vfio_path = NULL;\n\n    if (!dev_path)\n        return NULL;\n\n    iommu_path = g_strdup_printf(\"%s/iommu_group\", dev_path);\n\n    if (!virFileExists(iommu_path)) {\n        virReportSystemError(errno, _(\"failed to access '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    if (virFileResolveLink(iommu_path, &result_path) < 0) {\n        virReportSystemError(errno, _(\"failed to resolve '%s'\"), iommu_path);\n        return NULL;\n    }\n\n    result_file = g_path_get_basename(result_path);\n\n    vfio_path = g_strdup_printf(\"/dev/vfio/%s\", result_file);\n\n    return vfio_path;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIVHostDeviceFree",
          "args": [
            "host"
          ],
          "line": 946
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIVHostDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsivhost.c",
          "lines": "266-277",
          "snippet": "void\nvirSCSIVHostDeviceFree(virSCSIVHostDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s: freeing\", dev->name);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virscsivhost.h\"",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virscsivhost.h\"\n#include <fcntl.h>\n#include <config.h>\n\nvoid\nvirSCSIVHostDeviceFree(virSCSIVHostDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s: freeing\", dev->name);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIVHostDeviceFileIterate",
          "args": [
            "host",
            "AppArmorSetSecurityHostLabel",
            "ptr"
          ],
          "line": 943
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIVHostDeviceFileIterate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsivhost.c",
          "lines": "225-231",
          "snippet": "int\nvirSCSIVHostDeviceFileIterate(virSCSIVHostDevicePtr dev,\n                              virSCSIVHostDeviceFileActor actor,\n                              void *opaque)\n{\n    return (actor)(dev, dev->path, opaque);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virscsivhost.h\"",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virscsivhost.h\"\n#include <fcntl.h>\n#include <config.h>\n\nint\nvirSCSIVHostDeviceFileIterate(virSCSIVHostDevicePtr dev,\n                              virSCSIVHostDeviceFileActor actor,\n                              void *opaque)\n{\n    return (actor)(dev, dev->path, opaque);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIVHostDeviceNew",
          "args": [
            "hostsrc->wwpn"
          ],
          "line": 938
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIVHostDeviceNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsivhost.c",
          "lines": "248-263",
          "snippet": "virSCSIVHostDevicePtr\nvirSCSIVHostDeviceNew(const char *name)\n{\n    g_autoptr(virSCSIVHostDevice) dev = NULL;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->name = g_strdup(name);\n\n    dev->path = g_strdup_printf(\"%s/%s\", SYSFS_VHOST_SCSI_DEVICES, name);\n\n    VIR_DEBUG(\"%s: initialized\", dev->name);\n\n    return g_steal_pointer(&dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virscsivhost.h\"",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SYSFS_VHOST_SCSI_DEVICES \"/sys/kernel/config/target/vhost/\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virscsivhost.h\"\n#include <fcntl.h>\n#include <config.h>\n\n#define SYSFS_VHOST_SCSI_DEVICES \"/sys/kernel/config/target/vhost/\"\n\nvirSCSIVHostDevicePtr\nvirSCSIVHostDeviceNew(const char *name)\n{\n    g_autoptr(virSCSIVHostDevice) dev = NULL;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->name = g_strdup(name);\n\n    dev->path = g_strdup_printf(\"%s/%s\", SYSFS_VHOST_SCSI_DEVICES, name);\n\n    VIR_DEBUG(\"%s: initialized\", dev->name);\n\n    return g_steal_pointer(&dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceFree",
          "args": [
            "scsi"
          ],
          "line": 932
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "242-257",
          "snippet": "void\nvirSCSIDeviceFree(virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    if (!dev)\n        return;\n\n    VIR_FREE(dev->id);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->sg_path);\n    for (i = 0; i < dev->n_used_by; i++)\n        virSCSIDeviceUsedByInfoFree(dev->used_by[i]);\n    VIR_FREE(dev->used_by);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirSCSIDeviceFree(virSCSIDevicePtr dev)\n{\n    size_t i;\n\n    if (!dev)\n        return;\n\n    VIR_FREE(dev->id);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->sg_path);\n    for (i = 0; i < dev->n_used_by; i++)\n        virSCSIDeviceUsedByInfoFree(dev->used_by[i]);\n    VIR_FREE(dev->used_by);\n    VIR_FREE(dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceFileIterate",
          "args": [
            "scsi",
            "AppArmorSetSecuritySCSILabel",
            "ptr"
          ],
          "line": 931
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceFileIterate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "331-337",
          "snippet": "int\nvirSCSIDeviceFileIterate(virSCSIDevicePtr dev,\n                         virSCSIDeviceFileActor actor,\n                         void *opaque)\n{\n    return (actor)(dev, dev->sg_path, opaque);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIDeviceFileIterate(virSCSIDevicePtr dev,\n                         virSCSIDeviceFileActor actor,\n                         void *opaque)\n{\n    return (actor)(dev, dev->sg_path, opaque);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIDeviceNew",
          "args": [
            "NULL",
            "scsihostsrc->adapter",
            "scsihostsrc->bus",
            "scsihostsrc->target",
            "scsihostsrc->unit",
            "dev->readonly",
            "dev->shareable"
          ],
          "line": 923
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIDeviceNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsi.c",
          "lines": "172-231",
          "snippet": "virSCSIDevicePtr\nvirSCSIDeviceNew(const char *sysfs_prefix,\n                 const char *adapter,\n                 unsigned int bus,\n                 unsigned int target,\n                 unsigned long long unit,\n                 bool readonly,\n                 bool shareable)\n{\n    g_autoptr(virSCSIDevice) dev = NULL;\n    g_autofree char *sg = NULL;\n    g_autofree char *vendor_path = NULL;\n    g_autofree char *model_path = NULL;\n    g_autofree char *vendor = NULL;\n    g_autofree char *model = NULL;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus = bus;\n    dev->target = target;\n    dev->unit = unit;\n    dev->readonly = readonly;\n    dev->shareable = shareable;\n\n    if (!(sg = virSCSIDeviceGetSgName(prefix, adapter, bus, target, unit)))\n        return NULL;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &dev->adapter) < 0)\n        return NULL;\n\n    dev->name = g_strdup_printf(\"%d:%u:%u:%llu\", dev->adapter,\n                                dev->bus, dev->target, dev->unit);\n    dev->sg_path = g_strdup_printf(\"%s/%s\",\n                                   sysfs_prefix ? sysfs_prefix : \"/dev\", sg);\n\n    if (!virFileExists(dev->sg_path)) {\n        virReportSystemError(errno,\n                             _(\"SCSI device '%s': could not access %s\"),\n                             dev->name, dev->sg_path);\n        return NULL;\n    }\n\n    vendor_path = g_strdup_printf(\"%s/%s/vendor\", prefix, dev->name);\n    model_path = g_strdup_printf(\"%s/%s/model\", prefix, dev->name);\n\n    if (virFileReadAll(vendor_path, 1024, &vendor) < 0)\n        return NULL;\n\n    if (virFileReadAll(model_path, 1024, &model) < 0)\n        return NULL;\n\n    virTrimSpaces(vendor, NULL);\n    virTrimSpaces(model, NULL);\n\n    dev->id = g_strdup_printf(\"%s:%s\", vendor, model);\n\n    return g_steal_pointer(&dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsi.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virscsi.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\n#define SYSFS_SCSI_DEVICES \"/sys/bus/scsi/devices\"\n\nvirSCSIDevicePtr\nvirSCSIDeviceNew(const char *sysfs_prefix,\n                 const char *adapter,\n                 unsigned int bus,\n                 unsigned int target,\n                 unsigned long long unit,\n                 bool readonly,\n                 bool shareable)\n{\n    g_autoptr(virSCSIDevice) dev = NULL;\n    g_autofree char *sg = NULL;\n    g_autofree char *vendor_path = NULL;\n    g_autofree char *model_path = NULL;\n    g_autofree char *vendor = NULL;\n    g_autofree char *model = NULL;\n    const char *prefix = sysfs_prefix ? sysfs_prefix : SYSFS_SCSI_DEVICES;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus = bus;\n    dev->target = target;\n    dev->unit = unit;\n    dev->readonly = readonly;\n    dev->shareable = shareable;\n\n    if (!(sg = virSCSIDeviceGetSgName(prefix, adapter, bus, target, unit)))\n        return NULL;\n\n    if (virSCSIDeviceGetAdapterId(adapter, &dev->adapter) < 0)\n        return NULL;\n\n    dev->name = g_strdup_printf(\"%d:%u:%u:%llu\", dev->adapter,\n                                dev->bus, dev->target, dev->unit);\n    dev->sg_path = g_strdup_printf(\"%s/%s\",\n                                   sysfs_prefix ? sysfs_prefix : \"/dev\", sg);\n\n    if (!virFileExists(dev->sg_path)) {\n        virReportSystemError(errno,\n                             _(\"SCSI device '%s': could not access %s\"),\n                             dev->name, dev->sg_path);\n        return NULL;\n    }\n\n    vendor_path = g_strdup_printf(\"%s/%s/vendor\", prefix, dev->name);\n    model_path = g_strdup_printf(\"%s/%s/model\", prefix, dev->name);\n\n    if (virFileReadAll(vendor_path, 1024, &vendor) < 0)\n        return NULL;\n\n    if (virFileReadAll(model_path, 1024, &model) < 0)\n        return NULL;\n\n    virTrimSpaces(vendor, NULL);\n    virTrimSpaces(model, NULL);\n\n    dev->id = g_strdup_printf(\"%s:%s\", vendor, model);\n\n    return g_steal_pointer(&dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPCIDeviceFree",
          "args": [
            "pci"
          ],
          "line": 916
        },
        "resolved": true,
        "details": {
          "function_name": "virPCIDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpci.c",
          "lines": "1439-1450",
          "snippet": "void\nvirPCIDeviceFree(virPCIDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include \"virnetdev.h\"",
            "#include \"virpci.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include \"virnetdev.h\"\n#include \"virpci.h\"\n#include <config.h>\n\nvoid\nvirPCIDeviceFree(virPCIDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPCIDeviceFileIterate",
          "args": [
            "pci",
            "AppArmorSetSecurityPCILabel",
            "ptr"
          ],
          "line": 914
        },
        "resolved": true,
        "details": {
          "function_name": "virPCIDeviceFileIterate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpci.c",
          "lines": "1720-1762",
          "snippet": "int virPCIDeviceFileIterate(virPCIDevicePtr dev,\n                            virPCIDeviceFileActor actor,\n                            void *opaque)\n{\n    g_autofree char *pcidir = NULL;\n    DIR *dir = NULL;\n    int ret = -1;\n    struct dirent *ent;\n    int direrr;\n\n    pcidir = g_strdup_printf(\"/sys/bus/pci/devices/\" VIR_PCI_DEVICE_ADDRESS_FMT,\n                             dev->address.domain, dev->address.bus, dev->address.slot,\n                             dev->address.function);\n\n    if (virDirOpen(&dir, pcidir) < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &ent, pcidir)) > 0) {\n        g_autofree char *file = NULL;\n        /* Device assignment requires:\n         *   $PCIDIR/config, $PCIDIR/resource, $PCIDIR/resourceNNN,\n         *   $PCIDIR/rom, $PCIDIR/reset, $PCIDIR/vendor, $PCIDIR/device\n         */\n        if (STREQ(ent->d_name, \"config\") ||\n            STRPREFIX(ent->d_name, \"resource\") ||\n            STREQ(ent->d_name, \"rom\") ||\n            STREQ(ent->d_name, \"vendor\") ||\n            STREQ(ent->d_name, \"device\") ||\n            STREQ(ent->d_name, \"reset\")) {\n            file = g_strdup_printf(\"%s/%s\", pcidir, ent->d_name);\n            if ((actor)(dev, file, opaque) < 0)\n                goto cleanup;\n        }\n    }\n    if (direrr < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    return ret;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include \"virnetdev.h\"",
            "#include \"virpci.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include \"virnetdev.h\"\n#include \"virpci.h\"\n#include <config.h>\n\nint virPCIDeviceFileIterate(virPCIDevicePtr dev,\n                            virPCIDeviceFileActor actor,\n                            void *opaque)\n{\n    g_autofree char *pcidir = NULL;\n    DIR *dir = NULL;\n    int ret = -1;\n    struct dirent *ent;\n    int direrr;\n\n    pcidir = g_strdup_printf(\"/sys/bus/pci/devices/\" VIR_PCI_DEVICE_ADDRESS_FMT,\n                             dev->address.domain, dev->address.bus, dev->address.slot,\n                             dev->address.function);\n\n    if (virDirOpen(&dir, pcidir) < 0)\n        goto cleanup;\n\n    while ((direrr = virDirRead(dir, &ent, pcidir)) > 0) {\n        g_autofree char *file = NULL;\n        /* Device assignment requires:\n         *   $PCIDIR/config, $PCIDIR/resource, $PCIDIR/resourceNNN,\n         *   $PCIDIR/rom, $PCIDIR/reset, $PCIDIR/vendor, $PCIDIR/device\n         */\n        if (STREQ(ent->d_name, \"config\") ||\n            STRPREFIX(ent->d_name, \"resource\") ||\n            STREQ(ent->d_name, \"rom\") ||\n            STREQ(ent->d_name, \"vendor\") ||\n            STREQ(ent->d_name, \"device\") ||\n            STREQ(ent->d_name, \"reset\")) {\n            file = g_strdup_printf(\"%s/%s\", pcidir, ent->d_name);\n            if ((actor)(dev, file, opaque) < 0)\n                goto cleanup;\n        }\n    }\n    if (direrr < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    VIR_DIR_CLOSE(dir);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "vfioGroupDev"
          ],
          "line": 912
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AppArmorSetSecurityPCILabel",
          "args": [
            "pci",
            "vfioGroupDev",
            "ptr"
          ],
          "line": 911
        },
        "resolved": true,
        "details": {
          "function_name": "AppArmorSetSecurityPCILabel",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "313-318",
          "snippet": "static int\nAppArmorSetSecurityPCILabel(virPCIDevicePtr dev G_GNUC_UNUSED,\n                            const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityPCILabel(virPCIDevicePtr dev G_GNUC_UNUSED,\n                            const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPCIDeviceGetIOMMUGroupDev",
          "args": [
            "pci"
          ],
          "line": 905
        },
        "resolved": true,
        "details": {
          "function_name": "virPCIDeviceGetIOMMUGroupDev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpci.c",
          "lines": "1971-1995",
          "snippet": "char *\nvirPCIDeviceGetIOMMUGroupDev(virPCIDevicePtr dev)\n{\n    g_autofree char *devPath = NULL;\n    g_autofree char *groupPath = NULL;\n    g_autofree char *groupFile = NULL;\n\n    if (!(devPath = virPCIFile(dev->name, \"iommu_group\")))\n        return NULL;\n    if (virFileIsLink(devPath) != 1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Invalid device %s iommu_group file %s is not a symlink\"),\n                       dev->name, devPath);\n        return NULL;\n    }\n    if (virFileResolveLink(devPath, &groupPath) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to resolve device %s iommu_group symlink %s\"),\n                       dev->name, devPath);\n        return NULL;\n    }\n    groupFile = g_path_get_basename(groupPath);\n\n    return g_strdup_printf(\"/dev/vfio/%s\", groupFile);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include \"virnetdev.h\"",
            "#include \"virpci.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include \"virnetdev.h\"\n#include \"virpci.h\"\n#include <config.h>\n\nchar *\nvirPCIDeviceGetIOMMUGroupDev(virPCIDevicePtr dev)\n{\n    g_autofree char *devPath = NULL;\n    g_autofree char *groupPath = NULL;\n    g_autofree char *groupFile = NULL;\n\n    if (!(devPath = virPCIFile(dev->name, \"iommu_group\")))\n        return NULL;\n    if (virFileIsLink(devPath) != 1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Invalid device %s iommu_group file %s is not a symlink\"),\n                       dev->name, devPath);\n        return NULL;\n    }\n    if (virFileResolveLink(devPath, &groupPath) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Unable to resolve device %s iommu_group symlink %s\"),\n                       dev->name, devPath);\n        return NULL;\n    }\n    groupFile = g_path_get_basename(groupPath);\n\n    return g_strdup_printf(\"/dev/vfio/%s\", groupFile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPCIDeviceNew",
          "args": [
            "pcisrc->addr.domain",
            "pcisrc->addr.bus",
            "pcisrc->addr.slot",
            "pcisrc->addr.function"
          ],
          "line": 898
        },
        "resolved": true,
        "details": {
          "function_name": "virPCIDeviceNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpci.c",
          "lines": "1364-1416",
          "snippet": "virPCIDevicePtr\nvirPCIDeviceNew(unsigned int domain,\n                unsigned int bus,\n                unsigned int slot,\n                unsigned int function)\n{\n    g_autoptr(virPCIDevice) dev = NULL;\n    g_autofree char *vendor = NULL;\n    g_autofree char *product = NULL;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->address.domain = domain;\n    dev->address.bus = bus;\n    dev->address.slot = slot;\n    dev->address.function = function;\n\n    dev->name = g_strdup_printf(VIR_PCI_DEVICE_ADDRESS_FMT, domain, bus, slot,\n                                function);\n\n    dev->path = g_strdup_printf(PCI_SYSFS \"devices/%s/config\", dev->name);\n\n    if (!virFileExists(dev->path)) {\n        virReportSystemError(errno,\n                             _(\"Device %s not found: could not access %s\"),\n                             dev->name, dev->path);\n        return NULL;\n    }\n\n    vendor  = virPCIDeviceReadID(dev, \"vendor\");\n    product = virPCIDeviceReadID(dev, \"device\");\n\n    if (!vendor || !product) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to read product/vendor ID for %s\"),\n                       dev->name);\n        return NULL;\n    }\n\n    /* strings contain '0x' prefix */\n    if (g_snprintf(dev->id, sizeof(dev->id), \"%s %s\", &vendor[2],\n                   &product[2]) >= sizeof(dev->id)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->id buffer overflow: %s %s\"),\n                       &vendor[2], &product[2]);\n        return NULL;\n    }\n\n    VIR_DEBUG(\"%s %s: initialized\", dev->id, dev->name);\n\n    return g_steal_pointer(&dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include \"virnetdev.h\"",
            "#include \"virpci.h\"",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define PCI_SYSFS \"/sys/bus/pci/\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include \"virnetdev.h\"\n#include \"virpci.h\"\n#include <config.h>\n\n#define PCI_SYSFS \"/sys/bus/pci/\"\n\nvirPCIDevicePtr\nvirPCIDeviceNew(unsigned int domain,\n                unsigned int bus,\n                unsigned int slot,\n                unsigned int function)\n{\n    g_autoptr(virPCIDevice) dev = NULL;\n    g_autofree char *vendor = NULL;\n    g_autofree char *product = NULL;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->address.domain = domain;\n    dev->address.bus = bus;\n    dev->address.slot = slot;\n    dev->address.function = function;\n\n    dev->name = g_strdup_printf(VIR_PCI_DEVICE_ADDRESS_FMT, domain, bus, slot,\n                                function);\n\n    dev->path = g_strdup_printf(PCI_SYSFS \"devices/%s/config\", dev->name);\n\n    if (!virFileExists(dev->path)) {\n        virReportSystemError(errno,\n                             _(\"Device %s not found: could not access %s\"),\n                             dev->name, dev->path);\n        return NULL;\n    }\n\n    vendor  = virPCIDeviceReadID(dev, \"vendor\");\n    product = virPCIDeviceReadID(dev, \"device\");\n\n    if (!vendor || !product) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Failed to read product/vendor ID for %s\"),\n                       dev->name);\n        return NULL;\n    }\n\n    /* strings contain '0x' prefix */\n    if (g_snprintf(dev->id, sizeof(dev->id), \"%s %s\", &vendor[2],\n                   &product[2]) >= sizeof(dev->id)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->id buffer overflow: %s %s\"),\n                       &vendor[2], &product[2]);\n        return NULL;\n    }\n\n    VIR_DEBUG(\"%s %s: initialized\", dev->id, dev->name);\n\n    return g_steal_pointer(&dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceFree",
          "args": [
            "usb"
          ],
          "line": 892
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "353-363",
          "snippet": "void\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvoid\nvirUSBDeviceFree(virUSBDevicePtr dev)\n{\n    if (!dev)\n        return;\n    VIR_DEBUG(\"%s %s: freeing\", dev->id, dev->name);\n    VIR_FREE(dev->path);\n    VIR_FREE(dev->used_by_drvname);\n    VIR_FREE(dev->used_by_domname);\n    VIR_FREE(dev);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceFileIterate",
          "args": [
            "usb",
            "AppArmorSetSecurityUSBLabel",
            "ptr"
          ],
          "line": 891
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceFileIterate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "409-414",
          "snippet": "int virUSBDeviceFileIterate(virUSBDevicePtr dev,\n                            virUSBDeviceFileActor actor,\n                            void *opaque)\n{\n    return (actor)(dev, dev->path, opaque);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint virUSBDeviceFileIterate(virUSBDevicePtr dev,\n                            virUSBDeviceFileActor actor,\n                            void *opaque)\n{\n    return (actor)(dev, dev->path, opaque);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUSBDeviceNew",
          "args": [
            "usbsrc->bus",
            "usbsrc->device",
            "vroot"
          ],
          "line": 887
        },
        "resolved": true,
        "details": {
          "function_name": "virUSBDeviceNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virusb.c",
          "lines": "308-351",
          "snippet": "virUSBDevicePtr\nvirUSBDeviceNew(unsigned int bus,\n                unsigned int devno,\n                const char *vroot)\n{\n    virUSBDevicePtr dev;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus     = bus;\n    dev->dev     = devno;\n\n    if (g_snprintf(dev->name, sizeof(dev->name), \"%.3d:%.3d\",\n                   dev->bus, dev->dev) >= sizeof(dev->name)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->name buffer overflow: %.3d:%.3d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    if (vroot) {\n        dev->path = g_strdup_printf(\"%s/%03d/%03d\",\n                                    vroot, dev->bus, dev->dev);\n    } else {\n        dev->path = g_strdup_printf(USB_DEVFS \"%03d/%03d\",\n                                    dev->bus, dev->dev);\n    }\n\n    /* XXX fixme. this should be product/vendor */\n    if (g_snprintf(dev->id, sizeof(dev->id), \"%d %d\", dev->bus,\n                   dev->dev) >= sizeof(dev->id)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->id buffer overflow: %d %d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    VIR_DEBUG(\"%s %s: initialized\", dev->id, dev->name);\n\n    return dev;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virusb.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virusb.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nvirUSBDevicePtr\nvirUSBDeviceNew(unsigned int bus,\n                unsigned int devno,\n                const char *vroot)\n{\n    virUSBDevicePtr dev;\n\n    if (VIR_ALLOC(dev) < 0)\n        return NULL;\n\n    dev->bus     = bus;\n    dev->dev     = devno;\n\n    if (g_snprintf(dev->name, sizeof(dev->name), \"%.3d:%.3d\",\n                   dev->bus, dev->dev) >= sizeof(dev->name)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->name buffer overflow: %.3d:%.3d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    if (vroot) {\n        dev->path = g_strdup_printf(\"%s/%03d/%03d\",\n                                    vroot, dev->bus, dev->dev);\n    } else {\n        dev->path = g_strdup_printf(USB_DEVFS \"%03d/%03d\",\n                                    dev->bus, dev->dev);\n    }\n\n    /* XXX fixme. this should be product/vendor */\n    if (g_snprintf(dev->id, sizeof(dev->id), \"%d %d\", dev->bus,\n                   dev->dev) >= sizeof(dev->id)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"dev->id buffer overflow: %d %d\"),\n                       dev->bus, dev->dev);\n        virUSBDeviceFree(dev);\n        return NULL;\n    }\n\n    VIR_DEBUG(\"%s %s: initialized\", dev->id, dev->name);\n\n    return dev;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "ptr"
          ],
          "line": 879
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "profile_loaded",
          "args": [
            "secdef->imagelabel"
          ],
          "line": 876
        },
        "resolved": true,
        "details": {
          "function_name": "profile_loaded",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "110-114",
          "snippet": "static int\nprofile_loaded(const char *str)\n{\n    return profile_status(str, 0);\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_loaded(const char *str)\n{\n    return profile_status(str, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 856
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorSetSecurityHostdevLabel(virSecurityManagerPtr mgr,\n                                virDomainDefPtr def,\n                                virDomainHostdevDefPtr dev,\n                                const char *vroot)\n{\n    struct SDPDOP *ptr;\n    int ret = -1;\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n    virDomainHostdevSubsysUSBPtr usbsrc = &dev->source.subsys.u.usb;\n    virDomainHostdevSubsysPCIPtr pcisrc = &dev->source.subsys.u.pci;\n    virDomainHostdevSubsysSCSIPtr scsisrc = &dev->source.subsys.u.scsi;\n    virDomainHostdevSubsysSCSIVHostPtr hostsrc = &dev->source.subsys.u.scsi_host;\n    virDomainHostdevSubsysMediatedDevPtr mdevsrc = &dev->source.subsys.u.mdev;\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    if (dev->mode != VIR_DOMAIN_HOSTDEV_MODE_SUBSYS)\n        return 0;\n\n    /* Like AppArmorRestoreSecurityImageLabel() for a networked disk,\n     * do nothing for an iSCSI hostdev\n     */\n    if (dev->source.subsys.type == VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_SCSI &&\n        scsisrc->protocol == VIR_DOMAIN_HOSTDEV_SCSI_PROTOCOL_TYPE_ISCSI)\n        return 0;\n\n    if (profile_loaded(secdef->imagelabel) < 0)\n        return 0;\n\n    if (VIR_ALLOC(ptr) < 0)\n        return -1;\n    ptr->mgr = mgr;\n    ptr->def = def;\n\n    switch ((virDomainHostdevSubsysType)dev->source.subsys.type) {\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_USB: {\n        virUSBDevicePtr usb =\n            virUSBDeviceNew(usbsrc->bus, usbsrc->device, vroot);\n        if (!usb)\n            goto done;\n\n        ret = virUSBDeviceFileIterate(usb, AppArmorSetSecurityUSBLabel, ptr);\n        virUSBDeviceFree(usb);\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_PCI: {\n        virPCIDevicePtr pci =\n            virPCIDeviceNew(pcisrc->addr.domain, pcisrc->addr.bus,\n                            pcisrc->addr.slot, pcisrc->addr.function);\n\n        if (!pci)\n            goto done;\n\n        if (pcisrc->backend == VIR_DOMAIN_HOSTDEV_PCI_BACKEND_VFIO) {\n            char *vfioGroupDev = virPCIDeviceGetIOMMUGroupDev(pci);\n\n            if (!vfioGroupDev) {\n                virPCIDeviceFree(pci);\n                goto done;\n            }\n            ret = AppArmorSetSecurityPCILabel(pci, vfioGroupDev, ptr);\n            VIR_FREE(vfioGroupDev);\n        } else {\n            ret = virPCIDeviceFileIterate(pci, AppArmorSetSecurityPCILabel, ptr);\n        }\n        virPCIDeviceFree(pci);\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_SCSI: {\n        virDomainHostdevSubsysSCSIHostPtr scsihostsrc = &scsisrc->u.host;\n        virSCSIDevicePtr scsi =\n            virSCSIDeviceNew(NULL,\n                             scsihostsrc->adapter, scsihostsrc->bus,\n                             scsihostsrc->target, scsihostsrc->unit,\n                             dev->readonly, dev->shareable);\n\n         if (!scsi)\n             goto done;\n\n        ret = virSCSIDeviceFileIterate(scsi, AppArmorSetSecuritySCSILabel, ptr);\n        virSCSIDeviceFree(scsi);\n\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_SCSI_HOST: {\n        virSCSIVHostDevicePtr host = virSCSIVHostDeviceNew(hostsrc->wwpn);\n\n        if (!host)\n            goto done;\n\n        ret = virSCSIVHostDeviceFileIterate(host,\n                                            AppArmorSetSecurityHostLabel,\n                                            ptr);\n        virSCSIVHostDeviceFree(host);\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_MDEV: {\n        char *vfiodev = NULL;\n\n        if (!(vfiodev = virMediatedDeviceGetIOMMUGroupDev(mdevsrc->uuidstr)))\n            goto done;\n\n        ret = AppArmorSetSecurityHostdevLabelHelper(vfiodev, ptr);\n\n        VIR_FREE(vfiodev);\n        break;\n    }\n\n    case VIR_DOMAIN_HOSTDEV_SUBSYS_TYPE_LAST:\n        ret = 0;\n        break;\n    }\n\n done:\n    VIR_FREE(ptr);\n    return ret;\n}"
  },
  {
    "function_name": "AppArmorReserveSecurityLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "838-845",
    "snippet": "static int\nAppArmorReserveSecurityLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                             virDomainDefPtr def G_GNUC_UNUSED,\n                             pid_t pid G_GNUC_UNUSED)\n{\n    /* NOOP. Nothing to reserve with AppArmor */\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorReserveSecurityLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                             virDomainDefPtr def G_GNUC_UNUSED,\n                             pid_t pid G_GNUC_UNUSED)\n{\n    /* NOOP. Nothing to reserve with AppArmor */\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorSecurityVerify",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "817-836",
    "snippet": "static int\nAppArmorSecurityVerify(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                       virDomainDefPtr def)\n{\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef)\n        return 0;\n\n    if (secdef->type == VIR_DOMAIN_SECLABEL_STATIC) {\n        if (use_apparmor() < 0 || profile_status(secdef->label, 0) < 0) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"Invalid security label \\'%s\\'\"),\n                           secdef->label);\n            return -1;\n        }\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "_(\"Invalid security label \\'%s\\'\")",
            "secdef->label"
          ],
          "line": 829
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Invalid security label \\'%s\\'\""
          ],
          "line": 830
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "profile_status",
          "args": [
            "secdef->label",
            "0"
          ],
          "line": 828
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "use_apparmor",
          "args": [],
          "line": 828
        },
        "resolved": true,
        "details": {
          "function_name": "use_apparmor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "233-267",
          "snippet": "static int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 822
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorSecurityVerify(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                       virDomainDefPtr def)\n{\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef)\n        return 0;\n\n    if (secdef->type == VIR_DOMAIN_SECLABEL_STATIC) {\n        if (use_apparmor() < 0 || profile_status(secdef->label, 0) < 0) {\n            virReportError(VIR_ERR_XML_ERROR,\n                           _(\"Invalid security label \\'%s\\'\"),\n                           secdef->label);\n            return -1;\n        }\n    }\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorSetSecurityImageLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "775-815",
    "snippet": "static int\nAppArmorSetSecurityImageLabel(virSecurityManagerPtr mgr,\n                              virDomainDefPtr def,\n                              virStorageSourcePtr src,\n                              virSecurityDomainImageLabelFlags flags G_GNUC_UNUSED)\n{\n    virSecurityLabelDefPtr secdef;\n    g_autofree char *vfioGroupDev = NULL;\n    const char *path;\n\n    secdef = virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    if (!secdef->imagelabel)\n        return 0;\n\n    if (src->type == VIR_STORAGE_TYPE_NVME) {\n        const virStorageSourceNVMeDef *nvme = src->nvme;\n\n        if (!(vfioGroupDev = virPCIDeviceAddressGetIOMMUGroupDev(&nvme->pciAddr)))\n            return -1;\n\n        path = vfioGroupDev;\n    } else {\n        if (!src->path || !virStorageSourceIsLocalStorage(src))\n            return 0;\n\n        path = src->path;\n    }\n\n    /* if the device doesn't exist, error out */\n    if (!virFileExists(path)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"\\'%s\\' does not exist\"),\n                       path);\n        return -1;\n    }\n\n    return reload_profile(mgr, def, path, true);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "path",
            "true"
          ],
          "line": 814
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"\\'%s\\' does not exist\")",
            "path"
          ],
          "line": 808
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"\\'%s\\' does not exist\""
          ],
          "line": 809
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "path"
          ],
          "line": 807
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageSourceIsLocalStorage",
          "args": [
            "src"
          ],
          "line": 800
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageSourceIsLocalStorage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstoragefile.c",
          "lines": "2586-2608",
          "snippet": "bool\nvirStorageSourceIsLocalStorage(const virStorageSource *src)\n{\n    virStorageType type = virStorageSourceGetActualType(src);\n\n    switch (type) {\n    case VIR_STORAGE_TYPE_FILE:\n    case VIR_STORAGE_TYPE_BLOCK:\n    case VIR_STORAGE_TYPE_DIR:\n        return true;\n\n    case VIR_STORAGE_TYPE_NETWORK:\n    case VIR_STORAGE_TYPE_VOLUME:\n        /* While NVMe disks are local, they are not accessible via src->path.\n         * Therefore, we have to return false here. */\n    case VIR_STORAGE_TYPE_NVME:\n    case VIR_STORAGE_TYPE_LAST:\n    case VIR_STORAGE_TYPE_NONE:\n        return false;\n    }\n\n    return false;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsecret.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"virjson.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruri.h\"",
            "#include \"virstring.h\"",
            "#include \"virendian.h\"",
            "#include \"virhash.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virstoragefilebackend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsecret.h\"\n#include \"virstorageencryption.h\"\n#include \"virjson.h\"\n#include \"virbuffer.h\"\n#include \"viruri.h\"\n#include \"virstring.h\"\n#include \"virendian.h\"\n#include \"virhash.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virstoragefilebackend.h\"\n#include <config.h>\n\nbool\nvirStorageSourceIsLocalStorage(const virStorageSource *src)\n{\n    virStorageType type = virStorageSourceGetActualType(src);\n\n    switch (type) {\n    case VIR_STORAGE_TYPE_FILE:\n    case VIR_STORAGE_TYPE_BLOCK:\n    case VIR_STORAGE_TYPE_DIR:\n        return true;\n\n    case VIR_STORAGE_TYPE_NETWORK:\n    case VIR_STORAGE_TYPE_VOLUME:\n        /* While NVMe disks are local, they are not accessible via src->path.\n         * Therefore, we have to return false here. */\n    case VIR_STORAGE_TYPE_NVME:\n    case VIR_STORAGE_TYPE_LAST:\n    case VIR_STORAGE_TYPE_NONE:\n        return false;\n    }\n\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPCIDeviceAddressGetIOMMUGroupDev",
          "args": [
            "&nvme->pciAddr"
          ],
          "line": 795
        },
        "resolved": true,
        "details": {
          "function_name": "virPCIDeviceAddressGetIOMMUGroupDev",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpci.c",
          "lines": "1953-1965",
          "snippet": "char *\nvirPCIDeviceAddressGetIOMMUGroupDev(const virPCIDeviceAddress *devAddr)\n{\n    g_autoptr(virPCIDevice) pci = NULL;\n\n    if (!(pci = virPCIDeviceNew(devAddr->domain,\n                                devAddr->bus,\n                                devAddr->slot,\n                                devAddr->function)))\n        return NULL;\n\n    return virPCIDeviceGetIOMMUGroupDev(pci);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"virlog.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <inttypes.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include \"virnetdev.h\"",
            "#include \"virpci.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"virlog.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <inttypes.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include \"virnetdev.h\"\n#include \"virpci.h\"\n#include <config.h>\n\nchar *\nvirPCIDeviceAddressGetIOMMUGroupDev(const virPCIDeviceAddress *devAddr)\n{\n    g_autoptr(virPCIDevice) pci = NULL;\n\n    if (!(pci = virPCIDeviceNew(devAddr->domain,\n                                devAddr->bus,\n                                devAddr->slot,\n                                devAddr->function)))\n        return NULL;\n\n    return virPCIDeviceGetIOMMUGroupDev(pci);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 785
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorSetSecurityImageLabel(virSecurityManagerPtr mgr,\n                              virDomainDefPtr def,\n                              virStorageSourcePtr src,\n                              virSecurityDomainImageLabelFlags flags G_GNUC_UNUSED)\n{\n    virSecurityLabelDefPtr secdef;\n    g_autofree char *vfioGroupDev = NULL;\n    const char *path;\n\n    secdef = virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    if (!secdef->imagelabel)\n        return 0;\n\n    if (src->type == VIR_STORAGE_TYPE_NVME) {\n        const virStorageSourceNVMeDef *nvme = src->nvme;\n\n        if (!(vfioGroupDev = virPCIDeviceAddressGetIOMMUGroupDev(&nvme->pciAddr)))\n            return -1;\n\n        path = vfioGroupDev;\n    } else {\n        if (!src->path || !virStorageSourceIsLocalStorage(src))\n            return 0;\n\n        path = src->path;\n    }\n\n    /* if the device doesn't exist, error out */\n    if (!virFileExists(path)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"\\'%s\\' does not exist\"),\n                       path);\n        return -1;\n    }\n\n    return reload_profile(mgr, def, path, true);\n}"
  },
  {
    "function_name": "AppArmorRestoreInputLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "766-772",
    "snippet": "static int\nAppArmorRestoreInputLabel(virSecurityManagerPtr mgr,\n                          virDomainDefPtr def,\n                          virDomainInputDefPtr input G_GNUC_UNUSED)\n{\n    return reload_profile(mgr, def, NULL, false);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "NULL",
            "false"
          ],
          "line": 771
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorRestoreInputLabel(virSecurityManagerPtr mgr,\n                          virDomainDefPtr def,\n                          virDomainInputDefPtr input G_GNUC_UNUSED)\n{\n    return reload_profile(mgr, def, NULL, false);\n}"
  },
  {
    "function_name": "AppArmorSetInputLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "730-763",
    "snippet": "static int\nAppArmorSetInputLabel(virSecurityManagerPtr mgr,\n                      virDomainDefPtr def,\n                      virDomainInputDefPtr input)\n{\n    if (input == NULL)\n        return 0;\n\n    switch ((virDomainInputType)input->type) {\n    case VIR_DOMAIN_INPUT_TYPE_PASSTHROUGH:\n        if (input->source.evdev == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s: passthrough input device has no source\"),\n                           __func__);\n            return -1;\n        }\n        if (!virFileExists(input->source.evdev)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s: \\'%s\\' does not exist\"),\n                           __func__, input->source.evdev);\n            return -1;\n        }\n        return reload_profile(mgr, def, input->source.evdev, true);\n        break;\n\n    case VIR_DOMAIN_INPUT_TYPE_MOUSE:\n    case VIR_DOMAIN_INPUT_TYPE_TABLET:\n    case VIR_DOMAIN_INPUT_TYPE_KBD:\n    case VIR_DOMAIN_INPUT_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "input->source.evdev",
            "true"
          ],
          "line": 752
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"%s: \\'%s\\' does not exist\")",
            "__func__",
            "input->source.evdev"
          ],
          "line": 747
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"%s: \\'%s\\' does not exist\""
          ],
          "line": 748
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "input->source.evdev"
          ],
          "line": 746
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"%s: passthrough input device has no source\")",
            "__func__"
          ],
          "line": 741
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetInputLabel(virSecurityManagerPtr mgr,\n                      virDomainDefPtr def,\n                      virDomainInputDefPtr input)\n{\n    if (input == NULL)\n        return 0;\n\n    switch ((virDomainInputType)input->type) {\n    case VIR_DOMAIN_INPUT_TYPE_PASSTHROUGH:\n        if (input->source.evdev == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s: passthrough input device has no source\"),\n                           __func__);\n            return -1;\n        }\n        if (!virFileExists(input->source.evdev)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s: \\'%s\\' does not exist\"),\n                           __func__, input->source.evdev);\n            return -1;\n        }\n        return reload_profile(mgr, def, input->source.evdev, true);\n        break;\n\n    case VIR_DOMAIN_INPUT_TYPE_MOUSE:\n    case VIR_DOMAIN_INPUT_TYPE_TABLET:\n    case VIR_DOMAIN_INPUT_TYPE_KBD:\n    case VIR_DOMAIN_INPUT_TYPE_LAST:\n        break;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorRestoreMemoryLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "721-727",
    "snippet": "static int\nAppArmorRestoreMemoryLabel(virSecurityManagerPtr mgr,\n                           virDomainDefPtr def,\n                           virDomainMemoryDefPtr mem G_GNUC_UNUSED)\n{\n    return reload_profile(mgr, def, NULL, false);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "NULL",
            "false"
          ],
          "line": 726
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorRestoreMemoryLabel(virSecurityManagerPtr mgr,\n                           virDomainDefPtr def,\n                           virDomainMemoryDefPtr mem G_GNUC_UNUSED)\n{\n    return reload_profile(mgr, def, NULL, false);\n}"
  },
  {
    "function_name": "AppArmorSetMemoryLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "687-718",
    "snippet": "static int\nAppArmorSetMemoryLabel(virSecurityManagerPtr mgr,\n                       virDomainDefPtr def,\n                       virDomainMemoryDefPtr mem)\n{\n    if (mem == NULL)\n        return 0;\n\n    switch ((virDomainMemoryModel) mem->model) {\n    case VIR_DOMAIN_MEMORY_MODEL_NVDIMM:\n        if (mem->nvdimmPath == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s: nvdimm without a path\"),\n                           __func__);\n            return -1;\n        }\n        if (!virFileExists(mem->nvdimmPath)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s: \\'%s\\' does not exist\"),\n                           __func__, mem->nvdimmPath);\n            return -1;\n        }\n        return reload_profile(mgr, def, mem->nvdimmPath, true);\n        break;\n    case VIR_DOMAIN_MEMORY_MODEL_NONE:\n    case VIR_DOMAIN_MEMORY_MODEL_DIMM:\n    case VIR_DOMAIN_MEMORY_MODEL_LAST:\n        break;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "mem->nvdimmPath",
            "true"
          ],
          "line": 709
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"%s: \\'%s\\' does not exist\")",
            "__func__",
            "mem->nvdimmPath"
          ],
          "line": 704
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"%s: \\'%s\\' does not exist\""
          ],
          "line": 705
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "mem->nvdimmPath"
          ],
          "line": 703
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"%s: nvdimm without a path\")",
            "__func__"
          ],
          "line": 698
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetMemoryLabel(virSecurityManagerPtr mgr,\n                       virDomainDefPtr def,\n                       virDomainMemoryDefPtr mem)\n{\n    if (mem == NULL)\n        return 0;\n\n    switch ((virDomainMemoryModel) mem->model) {\n    case VIR_DOMAIN_MEMORY_MODEL_NVDIMM:\n        if (mem->nvdimmPath == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s: nvdimm without a path\"),\n                           __func__);\n            return -1;\n        }\n        if (!virFileExists(mem->nvdimmPath)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"%s: \\'%s\\' does not exist\"),\n                           __func__, mem->nvdimmPath);\n            return -1;\n        }\n        return reload_profile(mgr, def, mem->nvdimmPath, true);\n        break;\n    case VIR_DOMAIN_MEMORY_MODEL_NONE:\n    case VIR_DOMAIN_MEMORY_MODEL_DIMM:\n    case VIR_DOMAIN_MEMORY_MODEL_LAST:\n        break;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorRestoreSecurityImageLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "673-683",
    "snippet": "static int\nAppArmorRestoreSecurityImageLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr def,\n                                  virStorageSourcePtr src,\n                                  virSecurityDomainImageLabelFlags flags G_GNUC_UNUSED)\n{\n    if (!virStorageSourceIsLocalStorage(src))\n        return 0;\n\n    return reload_profile(mgr, def, NULL, false);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "NULL",
            "false"
          ],
          "line": 682
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageSourceIsLocalStorage",
          "args": [
            "src"
          ],
          "line": 679
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageSourceIsLocalStorage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstoragefile.c",
          "lines": "2586-2608",
          "snippet": "bool\nvirStorageSourceIsLocalStorage(const virStorageSource *src)\n{\n    virStorageType type = virStorageSourceGetActualType(src);\n\n    switch (type) {\n    case VIR_STORAGE_TYPE_FILE:\n    case VIR_STORAGE_TYPE_BLOCK:\n    case VIR_STORAGE_TYPE_DIR:\n        return true;\n\n    case VIR_STORAGE_TYPE_NETWORK:\n    case VIR_STORAGE_TYPE_VOLUME:\n        /* While NVMe disks are local, they are not accessible via src->path.\n         * Therefore, we have to return false here. */\n    case VIR_STORAGE_TYPE_NVME:\n    case VIR_STORAGE_TYPE_LAST:\n    case VIR_STORAGE_TYPE_NONE:\n        return false;\n    }\n\n    return false;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virsecret.h\"",
            "#include \"virstorageencryption.h\"",
            "#include \"virjson.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruri.h\"",
            "#include \"virstring.h\"",
            "#include \"virendian.h\"",
            "#include \"virhash.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include \"virstoragefilebackend.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virsecret.h\"\n#include \"virstorageencryption.h\"\n#include \"virjson.h\"\n#include \"virbuffer.h\"\n#include \"viruri.h\"\n#include \"virstring.h\"\n#include \"virendian.h\"\n#include \"virhash.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include \"virstoragefilebackend.h\"\n#include <config.h>\n\nbool\nvirStorageSourceIsLocalStorage(const virStorageSource *src)\n{\n    virStorageType type = virStorageSourceGetActualType(src);\n\n    switch (type) {\n    case VIR_STORAGE_TYPE_FILE:\n    case VIR_STORAGE_TYPE_BLOCK:\n    case VIR_STORAGE_TYPE_DIR:\n        return true;\n\n    case VIR_STORAGE_TYPE_NETWORK:\n    case VIR_STORAGE_TYPE_VOLUME:\n        /* While NVMe disks are local, they are not accessible via src->path.\n         * Therefore, we have to return false here. */\n    case VIR_STORAGE_TYPE_NVME:\n    case VIR_STORAGE_TYPE_LAST:\n    case VIR_STORAGE_TYPE_NONE:\n        return false;\n    }\n\n    return false;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorRestoreSecurityImageLabel(virSecurityManagerPtr mgr,\n                                  virDomainDefPtr def,\n                                  virStorageSourcePtr src,\n                                  virSecurityDomainImageLabelFlags flags G_GNUC_UNUSED)\n{\n    if (!virStorageSourceIsLocalStorage(src))\n        return 0;\n\n    return reload_profile(mgr, def, NULL, false);\n}"
  },
  {
    "function_name": "AppArmorClearSecuritySocketLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "664-669",
    "snippet": "static int\nAppArmorClearSecuritySocketLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                 virDomainDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorClearSecuritySocketLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                 virDomainDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorSetSecuritySocketLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "657-662",
    "snippet": "static int\nAppArmorSetSecuritySocketLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                               virDomainDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecuritySocketLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                               virDomainDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorSetSecurityDaemonSocketLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "650-655",
    "snippet": "static int\nAppArmorSetSecurityDaemonSocketLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                     virDomainDefPtr vm G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityDaemonSocketLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                     virDomainDefPtr vm G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorSetSecurityChildProcessLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "612-648",
    "snippet": "static int\nAppArmorSetSecurityChildProcessLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                     virDomainDefPtr def,\n                                     virCommandPtr cmd)\n{\n    int rc = -1;\n    char *profile_name = NULL;\n    char *cmd_str = NULL;\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->label)\n        return 0;\n\n    if (STRNEQ(SECURITY_APPARMOR_NAME, secdef->model)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"security label driver mismatch: \"\n                         \"\\'%s\\' model configured for domain, but \"\n                         \"hypervisor driver is \\'%s\\'.\"),\n                       secdef->model, SECURITY_APPARMOR_NAME);\n        if (use_apparmor() > 0)\n            goto cleanup;\n    }\n\n    if ((profile_name = get_profile_name(def)) == NULL)\n        goto cleanup;\n\n    cmd_str = virCommandToString(cmd, false);\n    VIR_DEBUG(\"Changing AppArmor profile to %s on %s\", profile_name, cmd_str);\n    virCommandSetAppArmorProfile(cmd, profile_name);\n    rc = 0;\n\n cleanup:\n    VIR_FREE(profile_name);\n    VIR_FREE(cmd_str);\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmd_str"
          ],
          "line": 646
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "profile_name"
          ],
          "line": 645
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandSetAppArmorProfile",
          "args": [
            "cmd",
            "profile_name"
          ],
          "line": 641
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetAppArmorProfile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1240-1252",
          "snippet": "void\nvirCommandSetAppArmorProfile(virCommandPtr cmd,\n                             const char *profile G_GNUC_UNUSED)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n    cmd->appArmorProfile = g_strdup(profile);\n#endif\n    return;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetAppArmorProfile(virCommandPtr cmd,\n                             const char *profile G_GNUC_UNUSED)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n    cmd->appArmorProfile = g_strdup(profile);\n#endif\n    return;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Changing AppArmor profile to %s on %s\"",
            "profile_name",
            "cmd_str"
          ],
          "line": 640
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandToString",
          "args": [
            "cmd",
            "false"
          ],
          "line": 639
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandToString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2082-2135",
          "snippet": "char *\nvirCommandToString(virCommandPtr cmd, bool linebreaks)\n{\n    size_t i;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    bool prevopt = false;\n\n    /* Cannot assume virCommandRun will be called; so report the error\n     * now.  If virCommandRun is called, it will report the same error. */\n    if (!cmd ||cmd->has_error == ENOMEM) {\n        virReportOOMError();\n        return NULL;\n    }\n    if (cmd->has_error) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"invalid use of command API\"));\n        return NULL;\n    }\n\n    for (i = 0; i < cmd->nenv; i++) {\n        /* In shell, a='b c' has a different meaning than 'a=b c', so\n         * we must determine where the '=' lives.  */\n        char *eq = strchr(cmd->env[i], '=');\n\n        if (!eq) {\n            virBufferFreeAndReset(&buf);\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"invalid use of command API\"));\n            return NULL;\n        }\n        eq++;\n        virBufferAdd(&buf, cmd->env[i], eq - cmd->env[i]);\n        virBufferEscapeShell(&buf, eq);\n        virBufferAddChar(&buf, ' ');\n        if (linebreaks)\n            virBufferAddLit(&buf, \"\\\\\\n\");\n    }\n    virBufferEscapeShell(&buf, cmd->args[0]);\n    for (i = 1; i < cmd->nargs; i++) {\n        virBufferAddChar(&buf, ' ');\n        if (linebreaks) {\n            /* Line break if this is a --arg or if\n             * the previous arg was a positional option\n             */\n            if (cmd->args[i][0] == '-' ||\n                !prevopt)\n                virBufferAddLit(&buf, \"\\\\\\n\");\n        }\n        virBufferEscapeShell(&buf, cmd->args[i]);\n        prevopt = (cmd->args[i][0] == '-');\n    }\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nchar *\nvirCommandToString(virCommandPtr cmd, bool linebreaks)\n{\n    size_t i;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    bool prevopt = false;\n\n    /* Cannot assume virCommandRun will be called; so report the error\n     * now.  If virCommandRun is called, it will report the same error. */\n    if (!cmd ||cmd->has_error == ENOMEM) {\n        virReportOOMError();\n        return NULL;\n    }\n    if (cmd->has_error) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"invalid use of command API\"));\n        return NULL;\n    }\n\n    for (i = 0; i < cmd->nenv; i++) {\n        /* In shell, a='b c' has a different meaning than 'a=b c', so\n         * we must determine where the '=' lives.  */\n        char *eq = strchr(cmd->env[i], '=');\n\n        if (!eq) {\n            virBufferFreeAndReset(&buf);\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"invalid use of command API\"));\n            return NULL;\n        }\n        eq++;\n        virBufferAdd(&buf, cmd->env[i], eq - cmd->env[i]);\n        virBufferEscapeShell(&buf, eq);\n        virBufferAddChar(&buf, ' ');\n        if (linebreaks)\n            virBufferAddLit(&buf, \"\\\\\\n\");\n    }\n    virBufferEscapeShell(&buf, cmd->args[0]);\n    for (i = 1; i < cmd->nargs; i++) {\n        virBufferAddChar(&buf, ' ');\n        if (linebreaks) {\n            /* Line break if this is a --arg or if\n             * the previous arg was a positional option\n             */\n            if (cmd->args[i][0] == '-' ||\n                !prevopt)\n                virBufferAddLit(&buf, \"\\\\\\n\");\n        }\n        virBufferEscapeShell(&buf, cmd->args[i]);\n        prevopt = (cmd->args[i][0] == '-');\n    }\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "get_profile_name",
          "args": [
            "def"
          ],
          "line": 636
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "use_apparmor",
          "args": [],
          "line": 632
        },
        "resolved": true,
        "details": {
          "function_name": "use_apparmor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "233-267",
          "snippet": "static int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"security label driver mismatch: \"\n                         \"\\'%s\\' model configured for domain, but \"\n                         \"hypervisor driver is \\'%s\\'.\")",
            "secdef->model",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 627
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "SECURITY_APPARMOR_NAME",
            "secdef->model"
          ],
          "line": 626
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 621
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorSetSecurityChildProcessLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                     virDomainDefPtr def,\n                                     virCommandPtr cmd)\n{\n    int rc = -1;\n    char *profile_name = NULL;\n    char *cmd_str = NULL;\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->label)\n        return 0;\n\n    if (STRNEQ(SECURITY_APPARMOR_NAME, secdef->model)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"security label driver mismatch: \"\n                         \"\\'%s\\' model configured for domain, but \"\n                         \"hypervisor driver is \\'%s\\'.\"),\n                       secdef->model, SECURITY_APPARMOR_NAME);\n        if (use_apparmor() > 0)\n            goto cleanup;\n    }\n\n    if ((profile_name = get_profile_name(def)) == NULL)\n        goto cleanup;\n\n    cmd_str = virCommandToString(cmd, false);\n    VIR_DEBUG(\"Changing AppArmor profile to %s on %s\", profile_name, cmd_str);\n    virCommandSetAppArmorProfile(cmd, profile_name);\n    rc = 0;\n\n cleanup:\n    VIR_FREE(profile_name);\n    VIR_FREE(cmd_str);\n    return rc;\n}"
  },
  {
    "function_name": "AppArmorSetSecurityProcessLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "568-605",
    "snippet": "static int\nAppArmorSetSecurityProcessLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                virDomainDefPtr def)\n{\n    int rc = -1;\n    char *profile_name = NULL;\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->label)\n        return 0;\n\n    if ((profile_name = get_profile_name(def)) == NULL)\n        return rc;\n\n    if (STRNEQ(SECURITY_APPARMOR_NAME, secdef->model)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"security label driver mismatch: \"\n                         \"\\'%s\\' model configured for domain, but \"\n                         \"hypervisor driver is \\'%s\\'.\"),\n                       secdef->model, SECURITY_APPARMOR_NAME);\n        if (use_apparmor() > 0)\n            goto cleanup;\n    }\n\n    VIR_DEBUG(\"Changing AppArmor profile to %s\", profile_name);\n    if (aa_change_profile(profile_name) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"error calling aa_change_profile()\"));\n        goto cleanup;\n    }\n    rc = 0;\n\n cleanup:\n    VIR_FREE(profile_name);\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "profile_name"
          ],
          "line": 602
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"error calling aa_change_profile()\")"
          ],
          "line": 595
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"error calling aa_change_profile()\""
          ],
          "line": 596
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "aa_change_profile",
          "args": [
            "profile_name"
          ],
          "line": 594
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Changing AppArmor profile to %s\"",
            "profile_name"
          ],
          "line": 593
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "use_apparmor",
          "args": [],
          "line": 589
        },
        "resolved": true,
        "details": {
          "function_name": "use_apparmor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "233-267",
          "snippet": "static int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"security label driver mismatch: \"\n                         \"\\'%s\\' model configured for domain, but \"\n                         \"hypervisor driver is \\'%s\\'.\")",
            "secdef->model",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "SECURITY_APPARMOR_NAME",
            "secdef->model"
          ],
          "line": 583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 575
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorSetSecurityProcessLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                virDomainDefPtr def)\n{\n    int rc = -1;\n    char *profile_name = NULL;\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->label)\n        return 0;\n\n    if ((profile_name = get_profile_name(def)) == NULL)\n        return rc;\n\n    if (STRNEQ(SECURITY_APPARMOR_NAME, secdef->model)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"security label driver mismatch: \"\n                         \"\\'%s\\' model configured for domain, but \"\n                         \"hypervisor driver is \\'%s\\'.\"),\n                       secdef->model, SECURITY_APPARMOR_NAME);\n        if (use_apparmor() > 0)\n            goto cleanup;\n    }\n\n    VIR_DEBUG(\"Changing AppArmor profile to %s\", profile_name);\n    if (aa_change_profile(profile_name) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"error calling aa_change_profile()\"));\n        goto cleanup;\n    }\n    rc = 0;\n\n cleanup:\n    VIR_FREE(profile_name);\n\n    return rc;\n}"
  },
  {
    "function_name": "AppArmorRestoreSecurityAllLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "542-563",
    "snippet": "static int\nAppArmorRestoreSecurityAllLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                virDomainDefPtr def,\n                                bool migrated G_GNUC_UNUSED,\n                                bool chardevStdioLogd G_GNUC_UNUSED)\n{\n    int rc = 0;\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef)\n        return 0;\n\n    if (secdef->type == VIR_DOMAIN_SECLABEL_DYNAMIC) {\n        if ((rc = remove_profile(secdef->label)) != 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"could not remove profile for \\'%s\\'\"),\n                           secdef->label);\n        }\n    }\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"could not remove profile for \\'%s\\'\")",
            "secdef->label"
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"could not remove profile for \\'%s\\'\""
          ],
          "line": 558
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "remove_profile",
          "args": [
            "secdef->label"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "remove_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "203-215",
          "snippet": "static int\nremove_profile(const char *profile)\n{\n    int rc = -1;\n    const char * const argv[] = {\n        VIRT_AA_HELPER, \"-D\", \"-u\", profile, NULL\n    };\n\n    if (virRun(argv, NULL) == 0)\n        rc = 0;\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\"\n\nstatic int\nremove_profile(const char *profile)\n{\n    int rc = -1;\n    const char * const argv[] = {\n        VIRT_AA_HELPER, \"-D\", \"-u\", profile, NULL\n    };\n\n    if (virRun(argv, NULL) == 0)\n        rc = 0;\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 550
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorRestoreSecurityAllLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                virDomainDefPtr def,\n                                bool migrated G_GNUC_UNUSED,\n                                bool chardevStdioLogd G_GNUC_UNUSED)\n{\n    int rc = 0;\n    virSecurityLabelDefPtr secdef =\n        virDomainDefGetSecurityLabelDef(def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef)\n        return 0;\n\n    if (secdef->type == VIR_DOMAIN_SECLABEL_DYNAMIC) {\n        if ((rc = remove_profile(secdef->label)) != 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"could not remove profile for \\'%s\\'\"),\n                           secdef->label);\n        }\n    }\n    return rc;\n}"
  },
  {
    "function_name": "AppArmorReleaseSecurityLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "526-539",
    "snippet": "static int\nAppArmorReleaseSecurityLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                             virDomainDefPtr def)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(def,\n                                                        SECURITY_APPARMOR_NAME);\n    if (secdef) {\n        VIR_FREE(secdef->model);\n        VIR_FREE(secdef->label);\n        VIR_FREE(secdef->imagelabel);\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "secdef->imagelabel"
          ],
          "line": 535
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "secdef->label"
          ],
          "line": 534
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "secdef->model"
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 530
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorReleaseSecurityLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                             virDomainDefPtr def)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(def,\n                                                        SECURITY_APPARMOR_NAME);\n    if (secdef) {\n        VIR_FREE(secdef->model);\n        VIR_FREE(secdef->label);\n        VIR_FREE(secdef->imagelabel);\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorGetSecurityProcessLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "486-521",
    "snippet": "static int\nAppArmorGetSecurityProcessLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                virDomainDefPtr def,\n                                pid_t pid G_GNUC_UNUSED,\n                                virSecurityLabelPtr sec)\n{\n    int rc = -1;\n    int status;\n    char *profile_name = NULL;\n\n    if ((profile_name = get_profile_name(def)) == NULL)\n        return rc;\n\n    status = profile_status(profile_name, 1);\n    if (status < -1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"error getting profile status\"));\n        goto cleanup;\n    } else if (status == -1) {\n        sec->label[0] = '\\0';\n    } else {\n        if (virStrcpy(sec->label, profile_name, VIR_SECURITY_LABEL_BUFLEN) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"error copying profile name\"));\n            goto cleanup;\n        }\n    }\n\n    sec->enforcing = status == 1;\n    rc = 0;\n\n cleanup:\n    VIR_FREE(profile_name);\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "profile_name"
          ],
          "line": 518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"error copying profile name\")"
          ],
          "line": 508
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"error copying profile name\""
          ],
          "line": 509
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStrcpy",
          "args": [
            "sec->label",
            "profile_name",
            "VIR_SECURITY_LABEL_BUFLEN"
          ],
          "line": 507
        },
        "resolved": true,
        "details": {
          "function_name": "virStrcpy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virstring.c",
          "lines": "780-784",
          "snippet": "int\nvirStrcpy(char *dest, const char *src, size_t destbytes)\n{\n    return virStrncpy(dest, src, -1, destbytes);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <glib/gprintf.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"virbuffer.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <glib/gprintf.h>\n#include <config.h>\n\nint\nvirStrcpy(char *dest, const char *src, size_t destbytes)\n{\n    return virStrncpy(dest, src, -1, destbytes);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"error getting profile status\")"
          ],
          "line": 501
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "profile_status",
          "args": [
            "profile_name",
            "1"
          ],
          "line": 499
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorGetSecurityProcessLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                                virDomainDefPtr def,\n                                pid_t pid G_GNUC_UNUSED,\n                                virSecurityLabelPtr sec)\n{\n    int rc = -1;\n    int status;\n    char *profile_name = NULL;\n\n    if ((profile_name = get_profile_name(def)) == NULL)\n        return rc;\n\n    status = profile_status(profile_name, 1);\n    if (status < -1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"error getting profile status\"));\n        goto cleanup;\n    } else if (status == -1) {\n        sec->label[0] = '\\0';\n    } else {\n        if (virStrcpy(sec->label, profile_name, VIR_SECURITY_LABEL_BUFLEN) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"error copying profile name\"));\n            goto cleanup;\n        }\n    }\n\n    sec->enforcing = status == 1;\n    rc = 0;\n\n cleanup:\n    VIR_FREE(profile_name);\n\n    return rc;\n}"
  },
  {
    "function_name": "AppArmorSetSecurityAllLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "463-481",
    "snippet": "static int\nAppArmorSetSecurityAllLabel(virSecurityManagerPtr mgr,\n                            virDomainDefPtr def,\n                            const char *stdin_path,\n                            bool chardevStdioLogd G_GNUC_UNUSED,\n                            bool migrated G_GNUC_UNUSED)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(def,\n                                                    SECURITY_APPARMOR_NAME);\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Reload the profile if stdin_path is specified. Note that\n       GenSecurityLabel() will have already been run. */\n    if (stdin_path)\n        return reload_profile(mgr, def, stdin_path, true);\n\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "mgr",
            "def",
            "stdin_path",
            "true"
          ],
          "line": 478
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 470
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorSetSecurityAllLabel(virSecurityManagerPtr mgr,\n                            virDomainDefPtr def,\n                            const char *stdin_path,\n                            bool chardevStdioLogd G_GNUC_UNUSED,\n                            bool migrated G_GNUC_UNUSED)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(def,\n                                                    SECURITY_APPARMOR_NAME);\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Reload the profile if stdin_path is specified. Note that\n       GenSecurityLabel() will have already been run. */\n    if (stdin_path)\n        return reload_profile(mgr, def, stdin_path, true);\n\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorGenSecurityLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "401-461",
    "snippet": "static int\nAppArmorGenSecurityLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                         virDomainDefPtr def)\n{\n    int rc = -1;\n    char *profile_name = NULL;\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(def,\n                                                SECURITY_APPARMOR_NAME);\n\n    if (!secdef)\n        return 0;\n\n    if ((secdef->type == VIR_DOMAIN_SECLABEL_STATIC) ||\n        (secdef->type == VIR_DOMAIN_SECLABEL_NONE))\n        return 0;\n\n    if (secdef->baselabel) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       \"%s\", _(\"Cannot set a base label with AppArmour\"));\n        return rc;\n    }\n\n    if (secdef->label || secdef->imagelabel) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\",\n                       _(\"security label already defined for VM\"));\n        return rc;\n    }\n\n    if ((profile_name = get_profile_name(def)) == NULL)\n        return rc;\n\n    secdef->label = g_strdup(profile_name);\n\n    /* set imagelabel the same as label (but we won't use it) */\n    secdef->imagelabel = g_strdup(profile_name);\n\n    if (!secdef->model)\n        secdef->model = g_strdup(SECURITY_APPARMOR_NAME);\n\n    /* Now that we have a label, load the profile into the kernel. */\n    if (load_profile(mgr, secdef->label, def, NULL, false) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"cannot load AppArmor profile \"\n                       \"\\'%s\\'\"), secdef->label);\n        goto err;\n    }\n\n    rc = 0;\n    goto cleanup;\n\n err:\n    VIR_FREE(secdef->label);\n    VIR_FREE(secdef->imagelabel);\n    VIR_FREE(secdef->model);\n\n cleanup:\n    VIR_FREE(profile_name);\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "profile_name"
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "secdef->model"
          ],
          "line": 455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "secdef->imagelabel"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "secdef->label"
          ],
          "line": 453
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"cannot load AppArmor profile \"\n                       \"\\'%s\\'\")",
            "secdef->label"
          ],
          "line": 443
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot load AppArmor profile \"\n                       \"\\'%s\\'\""
          ],
          "line": 444
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "load_profile",
          "args": [
            "mgr",
            "secdef->label",
            "def",
            "NULL",
            "false"
          ],
          "line": 442
        },
        "resolved": true,
        "details": {
          "function_name": "load_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "159-201",
          "snippet": "static int\nload_profile(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n             const char *profile,\n             virDomainDefPtr def,\n             const char *fn,\n             bool append)\n{\n    int rc = -1;\n    bool create = true;\n    char *xml = NULL;\n    virCommandPtr cmd = NULL;\n\n    xml = virDomainDefFormat(def, NULL, VIR_DOMAIN_DEF_FORMAT_SECURE);\n    if (!xml)\n        goto cleanup;\n\n    if (profile_status_file(profile) >= 0)\n        create = false;\n\n    cmd = virCommandNewArgList(VIRT_AA_HELPER,\n                               create ? \"-c\" : \"-r\",\n                               \"-u\", profile, NULL);\n    if (!create && fn) {\n        if (append) {\n            virCommandAddArgList(cmd, \"-F\", fn, NULL);\n        } else {\n            virCommandAddArgList(cmd, \"-f\", fn, NULL);\n        }\n    }\n\n    virCommandAddEnvFormat(cmd,\n                           \"LIBVIRT_LOG_OUTPUTS=%d:stderr\",\n                           virLogGetDefaultPriority());\n\n    virCommandSetInputBuffer(cmd, xml);\n    rc = virCommandRun(cmd, NULL);\n\n cleanup:\n    VIR_FREE(xml);\n    virCommandFree(cmd);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\"\n\nstatic int\nload_profile(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n             const char *profile,\n             virDomainDefPtr def,\n             const char *fn,\n             bool append)\n{\n    int rc = -1;\n    bool create = true;\n    char *xml = NULL;\n    virCommandPtr cmd = NULL;\n\n    xml = virDomainDefFormat(def, NULL, VIR_DOMAIN_DEF_FORMAT_SECURE);\n    if (!xml)\n        goto cleanup;\n\n    if (profile_status_file(profile) >= 0)\n        create = false;\n\n    cmd = virCommandNewArgList(VIRT_AA_HELPER,\n                               create ? \"-c\" : \"-r\",\n                               \"-u\", profile, NULL);\n    if (!create && fn) {\n        if (append) {\n            virCommandAddArgList(cmd, \"-F\", fn, NULL);\n        } else {\n            virCommandAddArgList(cmd, \"-f\", fn, NULL);\n        }\n    }\n\n    virCommandAddEnvFormat(cmd,\n                           \"LIBVIRT_LOG_OUTPUTS=%d:stderr\",\n                           virLogGetDefaultPriority());\n\n    virCommandSetInputBuffer(cmd, xml);\n    rc = virCommandRun(cmd, NULL);\n\n cleanup:\n    VIR_FREE(xml);\n    virCommandFree(cmd);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 439
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"security label already defined for VM\")"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Cannot set a base label with AppArmour\")"
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 407
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nAppArmorGenSecurityLabel(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n                         virDomainDefPtr def)\n{\n    int rc = -1;\n    char *profile_name = NULL;\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(def,\n                                                SECURITY_APPARMOR_NAME);\n\n    if (!secdef)\n        return 0;\n\n    if ((secdef->type == VIR_DOMAIN_SECLABEL_STATIC) ||\n        (secdef->type == VIR_DOMAIN_SECLABEL_NONE))\n        return 0;\n\n    if (secdef->baselabel) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED,\n                       \"%s\", _(\"Cannot set a base label with AppArmour\"));\n        return rc;\n    }\n\n    if (secdef->label || secdef->imagelabel) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\",\n                       _(\"security label already defined for VM\"));\n        return rc;\n    }\n\n    if ((profile_name = get_profile_name(def)) == NULL)\n        return rc;\n\n    secdef->label = g_strdup(profile_name);\n\n    /* set imagelabel the same as label (but we won't use it) */\n    secdef->imagelabel = g_strdup(profile_name);\n\n    if (!secdef->model)\n        secdef->model = g_strdup(SECURITY_APPARMOR_NAME);\n\n    /* Now that we have a label, load the profile into the kernel. */\n    if (load_profile(mgr, secdef->label, def, NULL, false) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"cannot load AppArmor profile \"\n                       \"\\'%s\\'\"), secdef->label);\n        goto err;\n    }\n\n    rc = 0;\n    goto cleanup;\n\n err:\n    VIR_FREE(secdef->label);\n    VIR_FREE(secdef->imagelabel);\n    VIR_FREE(secdef->model);\n\n cleanup:\n    VIR_FREE(profile_name);\n\n    return rc;\n}"
  },
  {
    "function_name": "AppArmorSecurityManagerGetDOI",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "389-393",
    "snippet": "static const char *\nAppArmorSecurityManagerGetDOI(virSecurityManagerPtr mgr G_GNUC_UNUSED)\n{\n    return SECURITY_APPARMOR_VOID_DOI;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_VOID_DOI      \"0\""
    ],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_VOID_DOI      \"0\"\n\nstatic const char *\nAppArmorSecurityManagerGetDOI(virSecurityManagerPtr mgr G_GNUC_UNUSED)\n{\n    return SECURITY_APPARMOR_VOID_DOI;\n}"
  },
  {
    "function_name": "AppArmorSecurityManagerGetModel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "383-387",
    "snippet": "static const char *\nAppArmorSecurityManagerGetModel(virSecurityManagerPtr mgr G_GNUC_UNUSED)\n{\n    return SECURITY_APPARMOR_NAME;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic const char *\nAppArmorSecurityManagerGetModel(virSecurityManagerPtr mgr G_GNUC_UNUSED)\n{\n    return SECURITY_APPARMOR_NAME;\n}"
  },
  {
    "function_name": "AppArmorSecurityManagerClose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "377-381",
    "snippet": "static int\nAppArmorSecurityManagerClose(virSecurityManagerPtr mgr G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSecurityManagerClose(virSecurityManagerPtr mgr G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorSecurityManagerOpen",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "371-375",
    "snippet": "static int\nAppArmorSecurityManagerOpen(virSecurityManagerPtr mgr G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSecurityManagerOpen(virSecurityManagerPtr mgr G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "AppArmorSecurityManagerProbe",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "335-366",
    "snippet": "static int\nAppArmorSecurityManagerProbe(const char *virtDriver G_GNUC_UNUSED)\n{\n    char *template_qemu = NULL;\n    char *template_lxc = NULL;\n    int rc = SECURITY_DRIVER_DISABLE;\n\n    if (use_apparmor() < 0)\n        return rc;\n\n    /* see if template file exists */\n    template_qemu = g_strdup_printf(\"%s/TEMPLATE.qemu\", APPARMOR_DIR \"/libvirt\");\n    template_lxc = g_strdup_printf(\"%s/TEMPLATE.lxc\", APPARMOR_DIR \"/libvirt\");\n\n    if (!virFileExists(template_qemu)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"template \\'%s\\' does not exist\"), template_qemu);\n        goto cleanup;\n    }\n    if (!virFileExists(template_lxc)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"template \\'%s\\' does not exist\"), template_lxc);\n        goto cleanup;\n    }\n    rc = SECURITY_DRIVER_ENABLE;\n\n cleanup:\n    VIR_FREE(template_qemu);\n    VIR_FREE(template_lxc);\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "template_lxc"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "template_qemu"
          ],
          "line": 362
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"template \\'%s\\' does not exist\")",
            "template_lxc"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"template \\'%s\\' does not exist\""
          ],
          "line": 356
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "template_lxc"
          ],
          "line": 354
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"template \\'%s\\' does not exist\")",
            "template_qemu"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/TEMPLATE.lxc\"",
            "APPARMOR_DIR \"/libvirt\""
          ],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "use_apparmor",
          "args": [],
          "line": 342
        },
        "resolved": true,
        "details": {
          "function_name": "use_apparmor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "233-267",
          "snippet": "static int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSecurityManagerProbe(const char *virtDriver G_GNUC_UNUSED)\n{\n    char *template_qemu = NULL;\n    char *template_lxc = NULL;\n    int rc = SECURITY_DRIVER_DISABLE;\n\n    if (use_apparmor() < 0)\n        return rc;\n\n    /* see if template file exists */\n    template_qemu = g_strdup_printf(\"%s/TEMPLATE.qemu\", APPARMOR_DIR \"/libvirt\");\n    template_lxc = g_strdup_printf(\"%s/TEMPLATE.lxc\", APPARMOR_DIR \"/libvirt\");\n\n    if (!virFileExists(template_qemu)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"template \\'%s\\' does not exist\"), template_qemu);\n        goto cleanup;\n    }\n    if (!virFileExists(template_lxc)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"template \\'%s\\' does not exist\"), template_lxc);\n        goto cleanup;\n    }\n    rc = SECURITY_DRIVER_ENABLE;\n\n cleanup:\n    VIR_FREE(template_qemu);\n    VIR_FREE(template_lxc);\n\n    return rc;\n}"
  },
  {
    "function_name": "AppArmorSetSecurityHostLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "327-332",
    "snippet": "static int\nAppArmorSetSecurityHostLabel(virSCSIVHostDevicePtr dev G_GNUC_UNUSED,\n                             const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "AppArmorSetSecurityHostdevLabelHelper",
          "args": [
            "file",
            "opaque"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "AppArmorSetSecurityHostdevLabelHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "297-304",
          "snippet": "static int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityHostLabel(virSCSIVHostDevicePtr dev G_GNUC_UNUSED,\n                             const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}"
  },
  {
    "function_name": "AppArmorSetSecuritySCSILabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "320-325",
    "snippet": "static int\nAppArmorSetSecuritySCSILabel(virSCSIDevicePtr dev G_GNUC_UNUSED,\n                             const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "AppArmorSetSecurityHostdevLabelHelper",
          "args": [
            "file",
            "opaque"
          ],
          "line": 324
        },
        "resolved": true,
        "details": {
          "function_name": "AppArmorSetSecurityHostdevLabelHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "297-304",
          "snippet": "static int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecuritySCSILabel(virSCSIDevicePtr dev G_GNUC_UNUSED,\n                             const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}"
  },
  {
    "function_name": "AppArmorSetSecurityPCILabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "313-318",
    "snippet": "static int\nAppArmorSetSecurityPCILabel(virPCIDevicePtr dev G_GNUC_UNUSED,\n                            const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "AppArmorSetSecurityHostdevLabelHelper",
          "args": [
            "file",
            "opaque"
          ],
          "line": 317
        },
        "resolved": true,
        "details": {
          "function_name": "AppArmorSetSecurityHostdevLabelHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "297-304",
          "snippet": "static int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityPCILabel(virPCIDevicePtr dev G_GNUC_UNUSED,\n                            const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}"
  },
  {
    "function_name": "AppArmorSetSecurityUSBLabel",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "306-311",
    "snippet": "static int\nAppArmorSetSecurityUSBLabel(virUSBDevicePtr dev G_GNUC_UNUSED,\n                            const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "AppArmorSetSecurityHostdevLabelHelper",
          "args": [
            "file",
            "opaque"
          ],
          "line": 310
        },
        "resolved": true,
        "details": {
          "function_name": "AppArmorSetSecurityHostdevLabelHelper",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "297-304",
          "snippet": "static int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityUSBLabel(virUSBDevicePtr dev G_GNUC_UNUSED,\n                            const char *file, void *opaque)\n{\n    return AppArmorSetSecurityHostdevLabelHelper(file, opaque);\n}"
  },
  {
    "function_name": "AppArmorSetSecurityHostdevLabelHelper",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "297-304",
    "snippet": "static int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "reload_profile",
          "args": [
            "ptr->mgr",
            "def",
            "file",
            "true"
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "reload_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "272-295",
          "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define SECURITY_APPARMOR_NAME          \"apparmor\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nAppArmorSetSecurityHostdevLabelHelper(const char *file, void *opaque)\n{\n    struct SDPDOP *ptr = opaque;\n    virDomainDefPtr def = ptr->def;\n\n    return reload_profile(ptr->mgr, def, file, true);\n}"
  },
  {
    "function_name": "reload_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "272-295",
    "snippet": "static int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define SECURITY_APPARMOR_NAME          \"apparmor\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\")",
            "secdef->imagelabel"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\""
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "load_profile",
          "args": [
            "mgr",
            "secdef->imagelabel",
            "def",
            "fn",
            "append"
          ],
          "line": 286
        },
        "resolved": true,
        "details": {
          "function_name": "load_profile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "159-201",
          "snippet": "static int\nload_profile(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n             const char *profile,\n             virDomainDefPtr def,\n             const char *fn,\n             bool append)\n{\n    int rc = -1;\n    bool create = true;\n    char *xml = NULL;\n    virCommandPtr cmd = NULL;\n\n    xml = virDomainDefFormat(def, NULL, VIR_DOMAIN_DEF_FORMAT_SECURE);\n    if (!xml)\n        goto cleanup;\n\n    if (profile_status_file(profile) >= 0)\n        create = false;\n\n    cmd = virCommandNewArgList(VIRT_AA_HELPER,\n                               create ? \"-c\" : \"-r\",\n                               \"-u\", profile, NULL);\n    if (!create && fn) {\n        if (append) {\n            virCommandAddArgList(cmd, \"-F\", fn, NULL);\n        } else {\n            virCommandAddArgList(cmd, \"-f\", fn, NULL);\n        }\n    }\n\n    virCommandAddEnvFormat(cmd,\n                           \"LIBVIRT_LOG_OUTPUTS=%d:stderr\",\n                           virLogGetDefaultPriority());\n\n    virCommandSetInputBuffer(cmd, xml);\n    rc = virCommandRun(cmd, NULL);\n\n cleanup:\n    VIR_FREE(xml);\n    virCommandFree(cmd);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\""
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\"\n\nstatic int\nload_profile(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n             const char *profile,\n             virDomainDefPtr def,\n             const char *fn,\n             bool append)\n{\n    int rc = -1;\n    bool create = true;\n    char *xml = NULL;\n    virCommandPtr cmd = NULL;\n\n    xml = virDomainDefFormat(def, NULL, VIR_DOMAIN_DEF_FORMAT_SECURE);\n    if (!xml)\n        goto cleanup;\n\n    if (profile_status_file(profile) >= 0)\n        create = false;\n\n    cmd = virCommandNewArgList(VIRT_AA_HELPER,\n                               create ? \"-c\" : \"-r\",\n                               \"-u\", profile, NULL);\n    if (!create && fn) {\n        if (append) {\n            virCommandAddArgList(cmd, \"-F\", fn, NULL);\n        } else {\n            virCommandAddArgList(cmd, \"-f\", fn, NULL);\n        }\n    }\n\n    virCommandAddEnvFormat(cmd,\n                           \"LIBVIRT_LOG_OUTPUTS=%d:stderr\",\n                           virLogGetDefaultPriority());\n\n    virCommandSetInputBuffer(cmd, xml);\n    rc = virCommandRun(cmd, NULL);\n\n cleanup:\n    VIR_FREE(xml);\n    virCommandFree(cmd);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "profile_loaded",
          "args": [
            "secdef->imagelabel"
          ],
          "line": 285
        },
        "resolved": true,
        "details": {
          "function_name": "profile_loaded",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "110-114",
          "snippet": "static int\nprofile_loaded(const char *str)\n{\n    return profile_status(str, 0);\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_loaded(const char *str)\n{\n    return profile_status(str, 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefGetSecurityLabelDef",
          "args": [
            "def",
            "SECURITY_APPARMOR_NAME"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefGetSecurityLabelDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "30583-30600",
          "snippet": "virSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nvirSecurityLabelDefPtr\nvirDomainDefGetSecurityLabelDef(virDomainDefPtr def, const char *model)\n{\n    size_t i;\n    virSecurityLabelDefPtr seclabel = NULL;\n\n    if (def == NULL || model == NULL)\n        return NULL;\n\n    for (i = 0; i < def->nseclabels; i++) {\n        if (def->seclabels[i]->model == NULL)\n            continue;\n        if (STREQ(def->seclabels[i]->model, model))\n            return def->seclabels[i];\n    }\n\n    return seclabel;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define SECURITY_APPARMOR_NAME          \"apparmor\"\n\nstatic int\nreload_profile(virSecurityManagerPtr mgr,\n               virDomainDefPtr def,\n               const char *fn,\n               bool append)\n{\n    virSecurityLabelDefPtr secdef = virDomainDefGetSecurityLabelDef(\n                                                def, SECURITY_APPARMOR_NAME);\n\n    if (!secdef || !secdef->relabel)\n        return 0;\n\n    /* Update the profile only if it is loaded */\n    if (profile_loaded(secdef->imagelabel) >= 0) {\n        if (load_profile(mgr, secdef->imagelabel, def, fn, append) < 0) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"cannot update AppArmor profile \"\n                             \"\\'%s\\'\"),\n                           secdef->imagelabel);\n            return -1;\n        }\n    }\n    return 0;\n}"
  },
  {
    "function_name": "use_apparmor",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "233-267",
    "snippet": "static int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "libvirt_daemon"
          ],
          "line": 265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "profile_status",
          "args": [
            "\"libvirtd\"",
            "1"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "APPARMOR_PROFILES_PATH",
            "R_OK"
          ],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "libvirt_daemon",
            "\"libvirt_lxc\""
          ],
          "line": 247
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"could not find libvirtd\")"
          ],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"could not find libvirtd\""
          ],
          "line": 241
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileResolveLink",
          "args": [
            "\"/proc/self/exe\"",
            "&libvirt_daemon"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "virFileResolveLink",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1608-1612",
          "snippet": "int\nvirFileResolveLink(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, false, resultpath);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileResolveLink(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, false, resultpath);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nuse_apparmor(void)\n{\n    int rc = -1;\n    char *libvirt_daemon = NULL;\n\n    if (virFileResolveLink(\"/proc/self/exe\", &libvirt_daemon) < 0) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"could not find libvirtd\"));\n        return rc;\n    }\n\n    /* If libvirt_lxc is calling us, then consider apparmor is used\n     * and enforced. */\n    if (strstr(libvirt_daemon, \"libvirt_lxc\"))\n        return 1;\n\n    if (access(APPARMOR_PROFILES_PATH, R_OK) != 0)\n        goto cleanup;\n\n    /* First check profile status using full binary path. If that fails\n     * check using profile name.\n     */\n    rc = profile_status(libvirt_daemon, 1);\n    if (rc < 0) {\n        rc = profile_status(\"libvirtd\", 1);\n        /* Error or unconfined should all result in -1 */\n        if (rc < 0)\n            rc = -1;\n    }\n\n cleanup:\n    VIR_FREE(libvirt_daemon);\n    return rc;\n}"
  },
  {
    "function_name": "get_profile_name",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "217-227",
    "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s%s\"",
            "AA_PREFIX",
            "uuidstr"
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "def->uuid",
            "uuidstr"
          ],
          "line": 223
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
  },
  {
    "function_name": "remove_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "203-215",
    "snippet": "static int\nremove_profile(const char *profile)\n{\n    int rc = -1;\n    const char * const argv[] = {\n        VIRT_AA_HELPER, \"-D\", \"-u\", profile, NULL\n    };\n\n    if (virRun(argv, NULL) == 0)\n        rc = 0;\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virRun",
          "args": [
            "argv",
            "NULL"
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "virRun",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "890-900",
          "snippet": "int\nvirRun(const char *const *argv G_GNUC_UNUSED,\n       int *status)\n{\n    if (status)\n        *status = ENOTSUP;\n    else\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"virRun is not implemented for WIN32\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirRun(const char *const *argv G_GNUC_UNUSED,\n       int *status)\n{\n    if (status)\n        *status = ENOTSUP;\n    else\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"virRun is not implemented for WIN32\"));\n    return -1;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\"\n\nstatic int\nremove_profile(const char *profile)\n{\n    int rc = -1;\n    const char * const argv[] = {\n        VIRT_AA_HELPER, \"-D\", \"-u\", profile, NULL\n    };\n\n    if (virRun(argv, NULL) == 0)\n        rc = 0;\n\n    return rc;\n}"
  },
  {
    "function_name": "load_profile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "159-201",
    "snippet": "static int\nload_profile(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n             const char *profile,\n             virDomainDefPtr def,\n             const char *fn,\n             bool append)\n{\n    int rc = -1;\n    bool create = true;\n    char *xml = NULL;\n    virCommandPtr cmd = NULL;\n\n    xml = virDomainDefFormat(def, NULL, VIR_DOMAIN_DEF_FORMAT_SECURE);\n    if (!xml)\n        goto cleanup;\n\n    if (profile_status_file(profile) >= 0)\n        create = false;\n\n    cmd = virCommandNewArgList(VIRT_AA_HELPER,\n                               create ? \"-c\" : \"-r\",\n                               \"-u\", profile, NULL);\n    if (!create && fn) {\n        if (append) {\n            virCommandAddArgList(cmd, \"-F\", fn, NULL);\n        } else {\n            virCommandAddArgList(cmd, \"-f\", fn, NULL);\n        }\n    }\n\n    virCommandAddEnvFormat(cmd,\n                           \"LIBVIRT_LOG_OUTPUTS=%d:stderr\",\n                           virLogGetDefaultPriority());\n\n    virCommandSetInputBuffer(cmd, xml);\n    rc = virCommandRun(cmd, NULL);\n\n cleanup:\n    VIR_FREE(xml);\n    virCommandFree(cmd);\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [
      "#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\""
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandFree",
          "args": [
            "cmd"
          ],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2992-3047",
          "snippet": "void\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandFree(virCommandPtr cmd)\n{\n    size_t i;\n    if (!cmd)\n        return;\n\n    for (i = 0; i < cmd->npassfd; i++) {\n        if (cmd->passfd[i].flags & VIR_COMMAND_PASS_FD_CLOSE_PARENT)\n            VIR_FORCE_CLOSE(cmd->passfd[i].fd);\n    }\n    cmd->npassfd = 0;\n    VIR_FREE(cmd->passfd);\n\n    if (cmd->asyncioThread) {\n        virThreadJoin(cmd->asyncioThread);\n        VIR_FREE(cmd->asyncioThread);\n    }\n    VIR_FREE(cmd->inbuf);\n    VIR_FORCE_CLOSE(cmd->outfd);\n    VIR_FORCE_CLOSE(cmd->errfd);\n\n    for (i = 0; i < cmd->nargs; i++)\n        VIR_FREE(cmd->args[i]);\n    VIR_FREE(cmd->args);\n\n    for (i = 0; i < cmd->nenv; i++)\n        VIR_FREE(cmd->env[i]);\n    VIR_FREE(cmd->env);\n\n    VIR_FREE(cmd->pwd);\n\n    if (cmd->handshake) {\n        /* The other 2 fds in these arrays are closed\n         * due to use with virCommandPassFD\n         */\n        VIR_FORCE_CLOSE(cmd->handshakeWait[0]);\n        VIR_FORCE_CLOSE(cmd->handshakeNotify[1]);\n    }\n\n    VIR_FREE(cmd->pidfile);\n\n    if (cmd->reap)\n        virCommandAbort(cmd);\n\n#if defined(WITH_SECDRIVER_SELINUX)\n    VIR_FREE(cmd->seLinuxLabel);\n#endif\n#if defined(WITH_SECDRIVER_APPARMOR)\n    VIR_FREE(cmd->appArmorProfile);\n#endif\n\n    virCommandFreeSendBuffers(cmd);\n\n    VIR_FREE(cmd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "xml"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 194
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandSetInputBuffer",
          "args": [
            "cmd",
            "xml"
          ],
          "line": 193
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandSetInputBuffer",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1840-1853",
          "snippet": "void\nvirCommandSetInputBuffer(virCommandPtr cmd, const char *inbuf)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->infd != -1 || cmd->inbuf) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify input twice\");\n        return;\n    }\n\n    cmd->inbuf = g_strdup(inbuf);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandSetInputBuffer(virCommandPtr cmd, const char *inbuf)\n{\n    if (!cmd || cmd->has_error)\n        return;\n\n    if (cmd->infd != -1 || cmd->inbuf) {\n        cmd->has_error = -1;\n        VIR_DEBUG(\"cannot specify input twice\");\n        return;\n    }\n\n    cmd->inbuf = g_strdup(inbuf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddEnvFormat",
          "args": [
            "cmd",
            "\"LIBVIRT_LOG_OUTPUTS=%d:stderr\"",
            "virLogGetDefaultPriority()"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddEnvFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1346-1360",
          "snippet": "void\nvirCommandAddEnvFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *env;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    env = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    virCommandAddEnv(cmd, env);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddEnvFormat(virCommandPtr cmd, const char *format, ...)\n{\n    char *env;\n    va_list list;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, format);\n    env = g_strdup_vprintf(format, list);\n    va_end(list);\n\n    virCommandAddEnv(cmd, env);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virLogGetDefaultPriority",
          "args": [],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "virLogGetDefaultPriority",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virlog.c",
          "lines": "1063-1067",
          "snippet": "virLogPriority\nvirLogGetDefaultPriority(void)\n{\n    return virLogDefaultPriority;\n}",
          "includes": [
            "# include <sys/uio.h>",
            "#include \"virsocket.h\"",
            "#include \"configmake.h\"",
            "#include \"virstring.h\"",
            "#include \"virtime.h\"",
            "#include \"virfile.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <syslog.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/time.h>",
            "#include <time.h>",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virLogPriority virLogDefaultPriority = VIR_LOG_DEFAULT;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include <sys/uio.h>\n#include \"virsocket.h\"\n#include \"configmake.h\"\n#include \"virstring.h\"\n#include \"virtime.h\"\n#include \"virfile.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <syslog.h>\n#include <unistd.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/time.h>\n#include <time.h>\n#include <stdarg.h>\n#include <config.h>\n\nstatic virLogPriority virLogDefaultPriority = VIR_LOG_DEFAULT;\n\nvirLogPriority\nvirLogGetDefaultPriority(void)\n{\n    return virLogDefaultPriority;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArgList",
          "args": [
            "cmd",
            "\"-f\"",
            "fn",
            "NULL"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "VIRT_AA_HELPER",
            "create ? \"-c\" : \"-r\"",
            "\"-u\"",
            "profile",
            "NULL"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "profile_status_file",
          "args": [
            "profile"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status_file",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "120-154",
          "snippet": "static int\nprofile_status_file(const char *str)\n{\n    char *profile = NULL;\n    char *content = NULL;\n    char *tmp = NULL;\n    int rc = -1;\n    int len;\n\n    profile = g_strdup_printf(\"%s/%s\", APPARMOR_DIR \"/libvirt\", str);\n\n    if (!virFileExists(profile))\n        goto failed;\n\n    if ((len = virFileReadAll(profile, MAX_FILE_LEN, &content)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read \\'%s\\'\"), profile);\n        goto failed;\n    }\n\n    /* create string that is ' <str> flags=(complain)\\0' */\n    tmp = g_strdup_printf(\" %s flags=(complain)\", str);\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = 1;\n\n failed:\n    VIR_FREE(tmp);\n    VIR_FREE(profile);\n    VIR_FREE(content);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status_file(const char *str)\n{\n    char *profile = NULL;\n    char *content = NULL;\n    char *tmp = NULL;\n    int rc = -1;\n    int len;\n\n    profile = g_strdup_printf(\"%s/%s\", APPARMOR_DIR \"/libvirt\", str);\n\n    if (!virFileExists(profile))\n        goto failed;\n\n    if ((len = virFileReadAll(profile, MAX_FILE_LEN, &content)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read \\'%s\\'\"), profile);\n        goto failed;\n    }\n\n    /* create string that is ' <str> flags=(complain)\\0' */\n    tmp = g_strdup_printf(\" %s flags=(complain)\", str);\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = 1;\n\n failed:\n    VIR_FREE(tmp);\n    VIR_FREE(profile);\n    VIR_FREE(content);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDefFormat",
          "args": [
            "def",
            "NULL",
            "VIR_DOMAIN_DEF_FORMAT_SECURE"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDefFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/domain_conf.c",
          "lines": "29496-29508",
          "snippet": "char *\nvirDomainDefFormat(virDomainDefPtr def,\n                   virDomainXMLOptionPtr xmlopt,\n                   unsigned int flags)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virCheckFlags(VIR_DOMAIN_DEF_FORMAT_COMMON_FLAGS, NULL);\n    if (virDomainDefFormatInternal(def, xmlopt, &buf, flags) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"vircrypto.h\"",
            "#include \"virutil.h\"",
            "#include \"virdomaincheckpointobjlist.h\"",
            "#include \"virdomainsnapshotobjlist.h\"",
            "#include \"virmdev.h\"",
            "#include \"virarptable.h\"",
            "#include \"virnetdevmacvlan.h\"",
            "#include \"virnetdevtap.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virtpm.h\"",
            "#include \"network_conf.h\"",
            "#include \"device_conf.h\"",
            "#include \"netdev_vlan_conf.h\"",
            "#include \"netdev_bandwidth_conf.h\"",
            "#include \"netdev_vport_profile_conf.h\"",
            "#include \"secret_conf.h\"",
            "#include \"virbitmap.h\"",
            "#include \"virfile.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"virnetworkportdef.h\"",
            "#include \"nwfilter_conf.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"viralloc.h\"",
            "#include \"snapshot_conf.h\"",
            "#include \"domain_conf.h\"",
            "#include \"domain_addr.h\"",
            "#include \"datatypes.h\"",
            "#include \"checkpoint_conf.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_DOMAIN_DEF_FORMAT_COMMON_FLAGS \\\n    (VIR_DOMAIN_DEF_FORMAT_SECURE | \\\n     VIR_DOMAIN_DEF_FORMAT_INACTIVE | \\\n     VIR_DOMAIN_DEF_FORMAT_MIGRATABLE)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"vircrypto.h\"\n#include \"virutil.h\"\n#include \"virdomaincheckpointobjlist.h\"\n#include \"virdomainsnapshotobjlist.h\"\n#include \"virmdev.h\"\n#include \"virarptable.h\"\n#include \"virnetdevmacvlan.h\"\n#include \"virnetdevtap.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virtpm.h\"\n#include \"network_conf.h\"\n#include \"device_conf.h\"\n#include \"netdev_vlan_conf.h\"\n#include \"netdev_bandwidth_conf.h\"\n#include \"netdev_vport_profile_conf.h\"\n#include \"secret_conf.h\"\n#include \"virbitmap.h\"\n#include \"virfile.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"virnetworkportdef.h\"\n#include \"nwfilter_conf.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"viralloc.h\"\n#include \"snapshot_conf.h\"\n#include \"domain_conf.h\"\n#include \"domain_addr.h\"\n#include \"datatypes.h\"\n#include \"checkpoint_conf.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\n#define VIR_DOMAIN_DEF_FORMAT_COMMON_FLAGS \\\n    (VIR_DOMAIN_DEF_FORMAT_SECURE | \\\n     VIR_DOMAIN_DEF_FORMAT_INACTIVE | \\\n     VIR_DOMAIN_DEF_FORMAT_MIGRATABLE)\n\nchar *\nvirDomainDefFormat(virDomainDefPtr def,\n                   virDomainXMLOptionPtr xmlopt,\n                   unsigned int flags)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n\n    virCheckFlags(VIR_DOMAIN_DEF_FORMAT_COMMON_FLAGS, NULL);\n    if (virDomainDefFormatInternal(def, xmlopt, &buf, flags) < 0)\n        return NULL;\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define VIRT_AA_HELPER LIBEXECDIR \"/virt-aa-helper\"\n\nstatic int\nload_profile(virSecurityManagerPtr mgr G_GNUC_UNUSED,\n             const char *profile,\n             virDomainDefPtr def,\n             const char *fn,\n             bool append)\n{\n    int rc = -1;\n    bool create = true;\n    char *xml = NULL;\n    virCommandPtr cmd = NULL;\n\n    xml = virDomainDefFormat(def, NULL, VIR_DOMAIN_DEF_FORMAT_SECURE);\n    if (!xml)\n        goto cleanup;\n\n    if (profile_status_file(profile) >= 0)\n        create = false;\n\n    cmd = virCommandNewArgList(VIRT_AA_HELPER,\n                               create ? \"-c\" : \"-r\",\n                               \"-u\", profile, NULL);\n    if (!create && fn) {\n        if (append) {\n            virCommandAddArgList(cmd, \"-F\", fn, NULL);\n        } else {\n            virCommandAddArgList(cmd, \"-f\", fn, NULL);\n        }\n    }\n\n    virCommandAddEnvFormat(cmd,\n                           \"LIBVIRT_LOG_OUTPUTS=%d:stderr\",\n                           virLogGetDefaultPriority());\n\n    virCommandSetInputBuffer(cmd, xml);\n    rc = virCommandRun(cmd, NULL);\n\n cleanup:\n    VIR_FREE(xml);\n    virCommandFree(cmd);\n\n    return rc;\n}"
  },
  {
    "function_name": "profile_status_file",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "120-154",
    "snippet": "static int\nprofile_status_file(const char *str)\n{\n    char *profile = NULL;\n    char *content = NULL;\n    char *tmp = NULL;\n    int rc = -1;\n    int len;\n\n    profile = g_strdup_printf(\"%s/%s\", APPARMOR_DIR \"/libvirt\", str);\n\n    if (!virFileExists(profile))\n        goto failed;\n\n    if ((len = virFileReadAll(profile, MAX_FILE_LEN, &content)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read \\'%s\\'\"), profile);\n        goto failed;\n    }\n\n    /* create string that is ' <str> flags=(complain)\\0' */\n    tmp = g_strdup_printf(\" %s flags=(complain)\", str);\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = 1;\n\n failed:\n    VIR_FREE(tmp);\n    VIR_FREE(profile);\n    VIR_FREE(content);\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "content"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "profile"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "content",
            "tmp"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\" %s flags=(complain)\"",
            "str"
          ],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to read \\'%s\\'\")",
            "profile"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to read \\'%s\\'\""
          ],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "profile",
            "MAX_FILE_LEN",
            "&content"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "profile"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status_file(const char *str)\n{\n    char *profile = NULL;\n    char *content = NULL;\n    char *tmp = NULL;\n    int rc = -1;\n    int len;\n\n    profile = g_strdup_printf(\"%s/%s\", APPARMOR_DIR \"/libvirt\", str);\n\n    if (!virFileExists(profile))\n        goto failed;\n\n    if ((len = virFileReadAll(profile, MAX_FILE_LEN, &content)) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read \\'%s\\'\"), profile);\n        goto failed;\n    }\n\n    /* create string that is ' <str> flags=(complain)\\0' */\n    tmp = g_strdup_printf(\" %s flags=(complain)\", str);\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = 1;\n\n failed:\n    VIR_FREE(tmp);\n    VIR_FREE(profile);\n    VIR_FREE(content);\n\n    return rc;\n}"
  },
  {
    "function_name": "profile_loaded",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "110-114",
    "snippet": "static int\nprofile_loaded(const char *str)\n{\n    return profile_status(str, 0);\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "profile_status",
          "args": [
            "str",
            "0"
          ],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "profile_status",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "70-108",
          "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_loaded(const char *str)\n{\n    return profile_status(str, 0);\n}"
  },
  {
    "function_name": "profile_status",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
    "lines": "70-108",
    "snippet": "static int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}",
    "includes": [
      "#include \"virmdev.h\"",
      "#include \"virscsi.h\"",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"vircommand.h\"",
      "#include \"configmake.h\"",
      "#include \"virfile.h\"",
      "#include \"virscsivhost.h\"",
      "#include \"virusb.h\"",
      "#include \"virpci.h\"",
      "#include \"viruuid.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include \"security_apparmor.h\"",
      "#include \"internal.h\"",
      "#include <wait.h>",
      "#include <unistd.h>",
      "#include <sys/apparmor.h>",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "etmp"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "tmp"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "content"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "content",
            "etmp"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "content",
            "tmp"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\")",
            "APPARMOR_PROFILES_PATH"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\""
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "get_profile_name",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/security/security_apparmor.c",
          "lines": "217-227",
          "snippet": "static char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}",
          "includes": [
            "#include \"virmdev.h\"",
            "#include \"virscsi.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"vircommand.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virscsivhost.h\"",
            "#include \"virusb.h\"",
            "#include \"virpci.h\"",
            "#include \"viruuid.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"security_apparmor.h\"",
            "#include \"internal.h\"",
            "#include <wait.h>",
            "#include <unistd.h>",
            "#include <sys/apparmor.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nget_profile_name(virDomainDefPtr def)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    char *name = NULL;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    name = g_strdup_printf(\"%s%s\", AA_PREFIX, uuidstr);\n\n    return name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileReadAll",
          "args": [
            "APPARMOR_PROFILES_PATH",
            "MAX_FILE_LEN",
            "&content"
          ],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "virFileReadAllQuiet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1459-1472",
          "snippet": "int\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileReadAllQuiet(const char *path, int maxlen, char **buf)\n{\n    int fd = open(path, O_RDONLY);\n    if (fd < 0)\n        return -errno;\n\n    int len = virFileReadLimFD(fd, maxlen, buf);\n    VIR_FORCE_CLOSE(fd);\n    if (len < 0)\n        return -errno;\n\n    return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s (enforce)\"",
            "str"
          ],
          "line": 83
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virmdev.h\"\n#include \"virscsi.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"vircommand.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virscsivhost.h\"\n#include \"virusb.h\"\n#include \"virpci.h\"\n#include \"viruuid.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"security_apparmor.h\"\n#include \"internal.h\"\n#include <wait.h>\n#include <unistd.h>\n#include <sys/apparmor.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nprofile_status(const char *str, const int check_enforcing)\n{\n    char *content = NULL;\n    char *tmp = NULL;\n    char *etmp = NULL;\n    int rc = -2;\n\n    /* create string that is '<str> \\0' for accurate matching */\n    tmp = g_strdup_printf(\"%s \", str);\n\n    if (check_enforcing != 0) {\n        /* create string that is '<str> (enforce)\\0' for accurate matching */\n        etmp = g_strdup_printf(\"%s (enforce)\", str);\n    }\n\n    if (virFileReadAll(APPARMOR_PROFILES_PATH, MAX_FILE_LEN, &content) < 0) {\n        virReportSystemError(errno,\n                             _(\"Failed to read AppArmor profiles list \"\n                             \"\\'%s\\'\"), APPARMOR_PROFILES_PATH);\n        goto cleanup;\n    }\n\n    if (strstr(content, tmp) != NULL)\n        rc = 0;\n    else\n        rc = -1; /* return -1 if not loaded */\n    if (check_enforcing != 0) {\n        if (rc == 0 && strstr(content, etmp) != NULL)\n            rc = 1;                 /* return '1' if loaded and enforcing */\n    }\n\n    VIR_FREE(content);\n cleanup:\n    VIR_FREE(tmp);\n    VIR_FREE(etmp);\n\n    return rc;\n}"
  }
]