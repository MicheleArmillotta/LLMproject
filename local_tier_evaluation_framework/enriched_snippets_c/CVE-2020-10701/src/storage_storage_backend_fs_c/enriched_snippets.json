[
  {
    "function_name": "virStorageBackendFsRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "702-725",
    "snippet": "int\nvirStorageBackendFsRegister(void)\n{\n    if (virStorageBackendRegister(&virStorageBackendDirectory) < 0)\n        return -1;\n\n#if WITH_STORAGE_FS\n    if (virStorageBackendRegister(&virStorageBackendFileSystem) < 0)\n        return -1;\n\n    if (virStorageBackendNamespaceInit(VIR_STORAGE_POOL_FS,\n                                       &virStoragePoolFSXMLNamespace) < 0)\n        return -1;\n\n    if (virStorageBackendRegister(&virStorageBackendNetFileSystem) < 0)\n        return -1;\n\n    if (virStorageBackendNamespaceInit(VIR_STORAGE_POOL_NETFS,\n                                       &virStoragePoolFSXMLNamespace) < 0)\n        return -1;\n#endif /* WITH_STORAGE_FS */\n\n    return 0;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virStorageBackend virStorageBackendDirectory = {\n    .type = VIR_STORAGE_POOL_DIR,\n\n    .buildPool = virStorageBackendFileSystemBuild,\n    .checkPool = virStorageBackendFileSystemCheck,\n    .refreshPool = virStorageBackendRefreshLocal,\n    .deletePool = virStorageBackendDeleteLocal,\n    .buildVol = virStorageBackendVolBuildLocal,\n    .buildVolFrom = virStorageBackendVolBuildFromLocal,\n    .createVol = virStorageBackendVolCreateLocal,\n    .refreshVol = virStorageBackendVolRefreshLocal,\n    .deleteVol = virStorageBackendVolDeleteLocal,\n    .resizeVol = virStorageBackendVolResizeLocal,\n    .uploadVol = virStorageBackendVolUploadLocal,\n    .downloadVol = virStorageBackendVolDownloadLocal,\n    .wipeVol = virStorageBackendVolWipeLocal,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendNamespaceInit",
          "args": [
            "VIR_STORAGE_POOL_NETFS",
            "&virStoragePoolFSXMLNamespace"
          ],
          "line": 719
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendNamespaceInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "93-98",
          "snippet": "int\nvirStorageBackendNamespaceInit(int poolType,\n                               virXMLNamespacePtr xmlns)\n{\n    return virStoragePoolOptionsPoolTypeSetXMLNamespace(poolType, xmlns);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStorageBackendNamespaceInit(int poolType,\n                               virXMLNamespacePtr xmlns)\n{\n    return virStoragePoolOptionsPoolTypeSetXMLNamespace(poolType, xmlns);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendRegister",
          "args": [
            "&virStorageBackendNetFileSystem"
          ],
          "line": 716
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend.c",
          "lines": "153-169",
          "snippet": "int\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}",
          "includes": [
            "# include \"storage_backend_vstorage.h\"",
            "# include \"storage_backend_zfs.h\"",
            "# include \"storage_backend_gluster.h\"",
            "# include \"storage_backend_sheepdog.h\"",
            "# include \"storage_backend_rbd.h\"",
            "# include \"storage_backend_fs.h\"",
            "# include \"storage_backend_disk.h\"",
            "# include \"storage_backend_mpath.h\"",
            "# include \"storage_backend_scsi.h\"",
            "# include \"storage_backend_iscsi_direct.h\"",
            "# include \"storage_backend_iscsi.h\"",
            "# include \"storage_backend_logical.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_STORAGE_BACKENDS_MAX 20"
          ],
          "globals_used": [
            "static virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];",
            "static size_t virStorageBackendsCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include \"storage_backend_vstorage.h\"\n# include \"storage_backend_zfs.h\"\n# include \"storage_backend_gluster.h\"\n# include \"storage_backend_sheepdog.h\"\n# include \"storage_backend_rbd.h\"\n# include \"storage_backend_fs.h\"\n# include \"storage_backend_disk.h\"\n# include \"storage_backend_mpath.h\"\n# include \"storage_backend_scsi.h\"\n# include \"storage_backend_iscsi_direct.h\"\n# include \"storage_backend_iscsi.h\"\n# include \"storage_backend_logical.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"storage_backend.h\"\n#include \"virstoragefile.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\n#define VIR_STORAGE_BACKENDS_MAX 20\n\nstatic virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];\nstatic size_t virStorageBackendsCount;\n\nint\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirStorageBackend virStorageBackendDirectory = {\n    .type = VIR_STORAGE_POOL_DIR,\n\n    .buildPool = virStorageBackendFileSystemBuild,\n    .checkPool = virStorageBackendFileSystemCheck,\n    .refreshPool = virStorageBackendRefreshLocal,\n    .deletePool = virStorageBackendDeleteLocal,\n    .buildVol = virStorageBackendVolBuildLocal,\n    .buildVolFrom = virStorageBackendVolBuildFromLocal,\n    .createVol = virStorageBackendVolCreateLocal,\n    .refreshVol = virStorageBackendVolRefreshLocal,\n    .deleteVol = virStorageBackendVolDeleteLocal,\n    .resizeVol = virStorageBackendVolResizeLocal,\n    .uploadVol = virStorageBackendVolUploadLocal,\n    .downloadVol = virStorageBackendVolDownloadLocal,\n    .wipeVol = virStorageBackendVolWipeLocal,\n};\n\nint\nvirStorageBackendFsRegister(void)\n{\n    if (virStorageBackendRegister(&virStorageBackendDirectory) < 0)\n        return -1;\n\n#if WITH_STORAGE_FS\n    if (virStorageBackendRegister(&virStorageBackendFileSystem) < 0)\n        return -1;\n\n    if (virStorageBackendNamespaceInit(VIR_STORAGE_POOL_FS,\n                                       &virStoragePoolFSXMLNamespace) < 0)\n        return -1;\n\n    if (virStorageBackendRegister(&virStorageBackendNetFileSystem) < 0)\n        return -1;\n\n    if (virStorageBackendNamespaceInit(VIR_STORAGE_POOL_NETFS,\n                                       &virStoragePoolFSXMLNamespace) < 0)\n        return -1;\n#endif /* WITH_STORAGE_FS */\n\n    return 0;\n}"
  },
  {
    "function_name": "virStoragePoolDefFSNamespaceFormatXML",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "606-627",
    "snippet": "static int\nvirStoragePoolDefFSNamespaceFormatXML(virBufferPtr buf,\n                                      void *nsdata)\n{\n    size_t i;\n    virStoragePoolFSMountOptionsDefPtr def = nsdata;\n\n    if (!def)\n        return 0;\n\n    virBufferAddLit(buf, \"<fs:mount_opts>\\n\");\n    virBufferAdjustIndent(buf, 2);\n\n    for (i = 0; i < def->noptions; i++)\n        virBufferEscapeString(buf, \"<fs:option name='%s'/>\\n\",\n                              def->options[i]);\n\n    virBufferAdjustIndent(buf, -2);\n    virBufferAddLit(buf, \"</fs:mount_opts>\\n\");\n\n    return 0;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "buf",
            "\"</fs:mount_opts>\\n\""
          ],
          "line": 624
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virBufferAdjustIndent",
          "args": [
            "buf",
            "-2"
          ],
          "line": 623
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferAdjustIndent",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "43-62",
          "snippet": "void\nvirBufferAdjustIndent(virBufferPtr buf, int indent)\n{\n    if (!buf)\n        return;\n\n    if (indent > 0) {\n        if (INT_MAX - indent < buf->indent) {\n            buf->indent = INT_MAX;\n            return;\n        }\n    } else {\n        if (buf->indent < -indent) {\n            buf->indent = 0;\n            return;\n        }\n    }\n\n    buf->indent += indent;\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferAdjustIndent(virBufferPtr buf, int indent)\n{\n    if (!buf)\n        return;\n\n    if (indent > 0) {\n        if (INT_MAX - indent < buf->indent) {\n            buf->indent = INT_MAX;\n            return;\n        }\n    } else {\n        if (buf->indent < -indent) {\n            buf->indent = 0;\n            return;\n        }\n    }\n\n    buf->indent += indent;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferEscapeString",
          "args": [
            "buf",
            "\"<fs:option name='%s'/>\\n\"",
            "def->options[i]"
          ],
          "line": 620
        },
        "resolved": true,
        "details": {
          "function_name": "virBufferEscapeString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virbuffer.c",
          "lines": "343-418",
          "snippet": "void\nvirBufferEscapeString(virBufferPtr buf, const char *format, const char *str)\n{\n    int len;\n    g_autofree char *escaped = NULL;\n    char *out;\n    const char *cur;\n    const char forbidden_characters[] = {\n        0x01,   0x02,   0x03,   0x04,   0x05,   0x06,   0x07,   0x08,\n        /*\\t*/  /*\\n*/  0x0B,   0x0C,   /*\\r*/  0x0E,   0x0F,   0x10,\n        0x11,   0x12,   0x13,   0x14,   0x15,   0x16,   0x17,   0x18,\n        0x19,   '\"',    '&',    '\\'',   '<',    '>',\n        '\\0'\n    };\n\n    if ((format == NULL) || (buf == NULL) || (str == NULL))\n        return;\n\n    len = strlen(str);\n    if (strcspn(str, forbidden_characters) == len) {\n        virBufferAsprintf(buf, format, str);\n        return;\n    }\n\n    escaped = g_malloc0_n(len + 1, 6);\n\n    cur = str;\n    out = escaped;\n    while (*cur != 0) {\n        if (*cur == '<') {\n            *out++ = '&';\n            *out++ = 'l';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '>') {\n            *out++ = '&';\n            *out++ = 'g';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '&') {\n            *out++ = '&';\n            *out++ = 'a';\n            *out++ = 'm';\n            *out++ = 'p';\n            *out++ = ';';\n        } else if (*cur == '\"') {\n            *out++ = '&';\n            *out++ = 'q';\n            *out++ = 'u';\n            *out++ = 'o';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '\\'') {\n            *out++ = '&';\n            *out++ = 'a';\n            *out++ = 'p';\n            *out++ = 'o';\n            *out++ = 's';\n            *out++ = ';';\n        } else if (!strchr(forbidden_characters, *cur)) {\n            /*\n             * default case, just copy !\n             * Note that character over 0x80 are likely to give problem\n             * with UTF-8 XML, but since our string don't have an encoding\n             * it's hard to handle properly we have to assume it's UTF-8 too\n             */\n            *out++ = *cur;\n        } else {\n            /* silently ignore control characters */\n        }\n        cur++;\n    }\n    *out = 0;\n\n    virBufferAsprintf(buf, format, escaped);\n}",
          "includes": [
            "#include \"viralloc.h\"",
            "#include \"virstring.h\"",
            "#include \"virbuffer.h\"",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viralloc.h\"\n#include \"virstring.h\"\n#include \"virbuffer.h\"\n#include <stdarg.h>\n#include <config.h>\n\nvoid\nvirBufferEscapeString(virBufferPtr buf, const char *format, const char *str)\n{\n    int len;\n    g_autofree char *escaped = NULL;\n    char *out;\n    const char *cur;\n    const char forbidden_characters[] = {\n        0x01,   0x02,   0x03,   0x04,   0x05,   0x06,   0x07,   0x08,\n        /*\\t*/  /*\\n*/  0x0B,   0x0C,   /*\\r*/  0x0E,   0x0F,   0x10,\n        0x11,   0x12,   0x13,   0x14,   0x15,   0x16,   0x17,   0x18,\n        0x19,   '\"',    '&',    '\\'',   '<',    '>',\n        '\\0'\n    };\n\n    if ((format == NULL) || (buf == NULL) || (str == NULL))\n        return;\n\n    len = strlen(str);\n    if (strcspn(str, forbidden_characters) == len) {\n        virBufferAsprintf(buf, format, str);\n        return;\n    }\n\n    escaped = g_malloc0_n(len + 1, 6);\n\n    cur = str;\n    out = escaped;\n    while (*cur != 0) {\n        if (*cur == '<') {\n            *out++ = '&';\n            *out++ = 'l';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '>') {\n            *out++ = '&';\n            *out++ = 'g';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '&') {\n            *out++ = '&';\n            *out++ = 'a';\n            *out++ = 'm';\n            *out++ = 'p';\n            *out++ = ';';\n        } else if (*cur == '\"') {\n            *out++ = '&';\n            *out++ = 'q';\n            *out++ = 'u';\n            *out++ = 'o';\n            *out++ = 't';\n            *out++ = ';';\n        } else if (*cur == '\\'') {\n            *out++ = '&';\n            *out++ = 'a';\n            *out++ = 'p';\n            *out++ = 'o';\n            *out++ = 's';\n            *out++ = ';';\n        } else if (!strchr(forbidden_characters, *cur)) {\n            /*\n             * default case, just copy !\n             * Note that character over 0x80 are likely to give problem\n             * with UTF-8 XML, but since our string don't have an encoding\n             * it's hard to handle properly we have to assume it's UTF-8 too\n             */\n            *out++ = *cur;\n        } else {\n            /* silently ignore control characters */\n        }\n        cur++;\n    }\n    *out = 0;\n\n    virBufferAsprintf(buf, format, escaped);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virBufferAddLit",
          "args": [
            "buf",
            "\"<fs:mount_opts>\\n\""
          ],
          "line": 616
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStoragePoolDefFSNamespaceFormatXML(virBufferPtr buf,\n                                      void *nsdata)\n{\n    size_t i;\n    virStoragePoolFSMountOptionsDefPtr def = nsdata;\n\n    if (!def)\n        return 0;\n\n    virBufferAddLit(buf, \"<fs:mount_opts>\\n\");\n    virBufferAdjustIndent(buf, 2);\n\n    for (i = 0; i < def->noptions; i++)\n        virBufferEscapeString(buf, \"<fs:option name='%s'/>\\n\",\n                              def->options[i]);\n\n    virBufferAdjustIndent(buf, -2);\n    virBufferAddLit(buf, \"</fs:mount_opts>\\n\");\n\n    return 0;\n}"
  },
  {
    "function_name": "virStoragePoolDefFSNamespaceParse",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "566-603",
    "snippet": "static int\nvirStoragePoolDefFSNamespaceParse(xmlXPathContextPtr ctxt,\n                                  void **data)\n{\n    virStoragePoolFSMountOptionsDefPtr cmdopts = NULL;\n    int nnodes;\n    size_t i;\n    int ret = -1;\n    g_autofree xmlNodePtr *nodes = NULL;\n\n    nnodes = virXPathNodeSet(\"./fs:mount_opts/fs:option\", ctxt, &nodes);\n    if (nnodes < 0)\n        return -1;\n\n    if (nnodes == 0)\n        return 0;\n\n    if (VIR_ALLOC(cmdopts) < 0 ||\n        VIR_ALLOC_N(cmdopts->options, nnodes) < 0)\n        goto cleanup;\n\n    for (i = 0; i < nnodes; i++) {\n        if (!(cmdopts->options[cmdopts->noptions] =\n              virXMLPropString(nodes[i], \"name\"))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"no fs mount option name specified\"));\n            goto cleanup;\n        }\n        cmdopts->noptions++;\n    }\n\n    *data = g_steal_pointer(&cmdopts);\n    ret = 0;\n\n cleanup:\n    virStoragePoolDefFSNamespaceFree(cmdopts);\n    return ret;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStoragePoolDefFSNamespaceFree",
          "args": [
            "cmdopts"
          ],
          "line": 601
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolDefFSNamespaceFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "549-563",
          "snippet": "static void\nvirStoragePoolDefFSNamespaceFree(void *nsdata)\n{\n    virStoragePoolFSMountOptionsDefPtr cmdopts = nsdata;\n    size_t i;\n\n    if (!cmdopts)\n        return;\n\n    for (i = 0; i < cmdopts->noptions; i++)\n        VIR_FREE(cmdopts->options[i]);\n    VIR_FREE(cmdopts->options);\n\n    VIR_FREE(cmdopts);\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic void\nvirStoragePoolDefFSNamespaceFree(void *nsdata)\n{\n    virStoragePoolFSMountOptionsDefPtr cmdopts = nsdata;\n    size_t i;\n\n    if (!cmdopts)\n        return;\n\n    for (i = 0; i < cmdopts->noptions; i++)\n        VIR_FREE(cmdopts->options[i]);\n    VIR_FREE(cmdopts->options);\n\n    VIR_FREE(cmdopts);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&cmdopts"
          ],
          "line": 597
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_XML_ERROR",
            "\"%s\"",
            "_(\"no fs mount option name specified\")"
          ],
          "line": 590
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no fs mount option name specified\""
          ],
          "line": 591
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virXMLPropString",
          "args": [
            "nodes[i]",
            "\"name\""
          ],
          "line": 589
        },
        "resolved": true,
        "details": {
          "function_name": "virXMLPropString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "515-520",
          "snippet": "char *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nchar *\nvirXMLPropString(xmlNodePtr node,\n                 const char *name)\n{\n    return (char *)xmlGetProp(node, BAD_CAST name);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "cmdopts->options",
            "nnodes"
          ],
          "line": 584
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "cmdopts"
          ],
          "line": 583
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virXPathNodeSet",
          "args": [
            "\"./fs:mount_opts/fs:option\"",
            "ctxt",
            "&nodes"
          ],
          "line": 576
        },
        "resolved": true,
        "details": {
          "function_name": "virXPathNodeSet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virxml.c",
          "lines": "647-694",
          "snippet": "int\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"virerror.h\"",
            "#include <libxml/xpathInternals.h>",
            "#include <sys/stat.h>",
            "#include <math.h>               /* for isnan() */",
            "#include <stdarg.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"virerror.h\"\n#include <libxml/xpathInternals.h>\n#include <sys/stat.h>\n#include <math.h>               /* for isnan() */\n#include <stdarg.h>\n#include <config.h>\n\nint\nvirXPathNodeSet(const char *xpath,\n                xmlXPathContextPtr ctxt,\n                xmlNodePtr **list)\n{\n    xmlXPathObjectPtr obj;\n    xmlNodePtr relnode;\n    int ret;\n\n    if ((ctxt == NULL) || (xpath == NULL)) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Invalid parameter to virXPathNodeSet()\"));\n        return -1;\n    }\n\n    if (list != NULL)\n        *list = NULL;\n\n    relnode = ctxt->node;\n    obj = xmlXPathEval(BAD_CAST xpath, ctxt);\n    ctxt->node = relnode;\n    if (obj == NULL)\n        return 0;\n\n    if (obj->type != XPATH_NODESET) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Incorrect xpath '%s'\"), xpath);\n        xmlXPathFreeObject(obj);\n        return -1;\n    }\n\n    if ((obj->nodesetval == NULL)  || (obj->nodesetval->nodeNr < 0)) {\n        xmlXPathFreeObject(obj);\n        return 0;\n    }\n\n    ret = obj->nodesetval->nodeNr;\n    if (list != NULL && ret) {\n        if (VIR_ALLOC_N(*list, ret) < 0) {\n            ret = -1;\n        } else {\n            memcpy(*list, obj->nodesetval->nodeTab,\n                   ret * sizeof(xmlNodePtr));\n        }\n    }\n    xmlXPathFreeObject(obj);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStoragePoolDefFSNamespaceParse(xmlXPathContextPtr ctxt,\n                                  void **data)\n{\n    virStoragePoolFSMountOptionsDefPtr cmdopts = NULL;\n    int nnodes;\n    size_t i;\n    int ret = -1;\n    g_autofree xmlNodePtr *nodes = NULL;\n\n    nnodes = virXPathNodeSet(\"./fs:mount_opts/fs:option\", ctxt, &nodes);\n    if (nnodes < 0)\n        return -1;\n\n    if (nnodes == 0)\n        return 0;\n\n    if (VIR_ALLOC(cmdopts) < 0 ||\n        VIR_ALLOC_N(cmdopts->options, nnodes) < 0)\n        goto cleanup;\n\n    for (i = 0; i < nnodes; i++) {\n        if (!(cmdopts->options[cmdopts->noptions] =\n              virXMLPropString(nodes[i], \"name\"))) {\n            virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                           _(\"no fs mount option name specified\"));\n            goto cleanup;\n        }\n        cmdopts->noptions++;\n    }\n\n    *data = g_steal_pointer(&cmdopts);\n    ret = 0;\n\n cleanup:\n    virStoragePoolDefFSNamespaceFree(cmdopts);\n    return ret;\n}"
  },
  {
    "function_name": "virStoragePoolDefFSNamespaceFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "549-563",
    "snippet": "static void\nvirStoragePoolDefFSNamespaceFree(void *nsdata)\n{\n    virStoragePoolFSMountOptionsDefPtr cmdopts = nsdata;\n    size_t i;\n\n    if (!cmdopts)\n        return;\n\n    for (i = 0; i < cmdopts->noptions; i++)\n        VIR_FREE(cmdopts->options[i]);\n    VIR_FREE(cmdopts->options);\n\n    VIR_FREE(cmdopts);\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdopts"
          ],
          "line": 562
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdopts->options"
          ],
          "line": 560
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "cmdopts->options[i]"
          ],
          "line": 559
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic void\nvirStoragePoolDefFSNamespaceFree(void *nsdata)\n{\n    virStoragePoolFSMountOptionsDefPtr cmdopts = nsdata;\n    size_t i;\n\n    if (!cmdopts)\n        return;\n\n    for (i = 0; i < cmdopts->noptions; i++)\n        VIR_FREE(cmdopts->options[i]);\n    VIR_FREE(cmdopts->options);\n\n    VIR_FREE(cmdopts);\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemBuild",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "512-530",
    "snippet": "static int\nvirStorageBackendFileSystemBuild(virStoragePoolObjPtr pool,\n                                 unsigned int flags)\n{\n    virCheckFlags(VIR_STORAGE_POOL_BUILD_OVERWRITE |\n                  VIR_STORAGE_POOL_BUILD_NO_OVERWRITE, -1);\n\n    VIR_EXCLUSIVE_FLAGS_RET(VIR_STORAGE_POOL_BUILD_OVERWRITE,\n                            VIR_STORAGE_POOL_BUILD_NO_OVERWRITE,\n                            -1);\n\n    if (virStorageBackendBuildLocal(pool) < 0)\n        return -1;\n\n    if (flags != 0)\n        return virStorageBackendMakeFileSystem(pool, flags);\n\n    return 0;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendMakeFileSystem",
          "args": [
            "pool",
            "flags"
          ],
          "line": 527
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendMakeFileSystem",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "448-489",
          "snippet": "static int\nvirStorageBackendMakeFileSystem(virStoragePoolObjPtr pool,\n                                unsigned int flags)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *device = NULL, *format = NULL;\n    bool ok_to_mkfs = false;\n    int ret = -1;\n\n    if (def->source.devices == NULL) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"No source device specified when formatting pool '%s'\"),\n                       def->name);\n        return -1;\n    }\n\n    device = def->source.devices[0].path;\n    format = virStoragePoolFormatFileSystemTypeToString(def->source.format);\n    VIR_DEBUG(\"source device: '%s' format: '%s'\", device, format);\n\n    virObjectUnlock(pool);\n    if (!virFileExists(device)) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"Source device does not exist when formatting pool '%s'\"),\n                       def->name);\n        goto error;\n    }\n\n    if (flags & VIR_STORAGE_POOL_BUILD_OVERWRITE) {\n        ok_to_mkfs = true;\n    } else if (flags & VIR_STORAGE_POOL_BUILD_NO_OVERWRITE &&\n               virStorageBackendDeviceIsEmpty(device, format, true)) {\n        ok_to_mkfs = true;\n    }\n\n    if (ok_to_mkfs)\n        ret = virStorageBackendExecuteMKFS(device, format);\n\n error:\n    virObjectLock(pool);\n    return ret;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendMakeFileSystem(virStoragePoolObjPtr pool,\n                                unsigned int flags)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *device = NULL, *format = NULL;\n    bool ok_to_mkfs = false;\n    int ret = -1;\n\n    if (def->source.devices == NULL) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"No source device specified when formatting pool '%s'\"),\n                       def->name);\n        return -1;\n    }\n\n    device = def->source.devices[0].path;\n    format = virStoragePoolFormatFileSystemTypeToString(def->source.format);\n    VIR_DEBUG(\"source device: '%s' format: '%s'\", device, format);\n\n    virObjectUnlock(pool);\n    if (!virFileExists(device)) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"Source device does not exist when formatting pool '%s'\"),\n                       def->name);\n        goto error;\n    }\n\n    if (flags & VIR_STORAGE_POOL_BUILD_OVERWRITE) {\n        ok_to_mkfs = true;\n    } else if (flags & VIR_STORAGE_POOL_BUILD_NO_OVERWRITE &&\n               virStorageBackendDeviceIsEmpty(device, format, true)) {\n        ok_to_mkfs = true;\n    }\n\n    if (ok_to_mkfs)\n        ret = virStorageBackendExecuteMKFS(device, format);\n\n error:\n    virObjectLock(pool);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendBuildLocal",
          "args": [
            "pool"
          ],
          "line": 523
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendBuildLocal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "2727-2774",
          "snippet": "int\nvirStorageBackendBuildLocal(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    char *p = NULL;\n    mode_t mode;\n    bool needs_create_as_uid;\n    unsigned int dir_create_flags;\n    g_autofree char *parent = NULL;\n\n    parent = g_strdup(def->target.path);\n    if (!(p = strrchr(parent, '/'))) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"path '%s' is not absolute\"),\n                       def->target.path);\n        return -1;\n    }\n\n    if (p != parent) {\n        /* assure all directories in the path prior to the final dir\n         * exist, with default uid/gid/mode. */\n        *p = '\\0';\n        if (virFileMakePath(parent) < 0) {\n            virReportSystemError(errno, _(\"cannot create path '%s'\"),\n                                 parent);\n            return -1;\n        }\n    }\n\n    dir_create_flags = VIR_DIR_CREATE_ALLOW_EXIST;\n    needs_create_as_uid = (def->type == VIR_STORAGE_POOL_NETFS);\n    mode = def->target.perms.mode;\n\n    if (mode == (mode_t)-1 &&\n        (needs_create_as_uid || !virFileExists(def->target.path)))\n        mode = VIR_STORAGE_DEFAULT_POOL_PERM_MODE;\n    if (needs_create_as_uid)\n        dir_create_flags |= VIR_DIR_CREATE_AS_UID;\n\n    /* Now create the final dir in the path with the uid/gid/mode\n     * requested in the config. If the dir already exists, just set\n     * the perms. */\n    return virDirCreate(def->target.path,\n                        mode,\n                        def->target.perms.uid,\n                        def->target.perms.gid,\n                        dir_create_flags);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStorageBackendBuildLocal(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    char *p = NULL;\n    mode_t mode;\n    bool needs_create_as_uid;\n    unsigned int dir_create_flags;\n    g_autofree char *parent = NULL;\n\n    parent = g_strdup(def->target.path);\n    if (!(p = strrchr(parent, '/'))) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"path '%s' is not absolute\"),\n                       def->target.path);\n        return -1;\n    }\n\n    if (p != parent) {\n        /* assure all directories in the path prior to the final dir\n         * exist, with default uid/gid/mode. */\n        *p = '\\0';\n        if (virFileMakePath(parent) < 0) {\n            virReportSystemError(errno, _(\"cannot create path '%s'\"),\n                                 parent);\n            return -1;\n        }\n    }\n\n    dir_create_flags = VIR_DIR_CREATE_ALLOW_EXIST;\n    needs_create_as_uid = (def->type == VIR_STORAGE_POOL_NETFS);\n    mode = def->target.perms.mode;\n\n    if (mode == (mode_t)-1 &&\n        (needs_create_as_uid || !virFileExists(def->target.path)))\n        mode = VIR_STORAGE_DEFAULT_POOL_PERM_MODE;\n    if (needs_create_as_uid)\n        dir_create_flags |= VIR_DIR_CREATE_AS_UID;\n\n    /* Now create the final dir in the path with the uid/gid/mode\n     * requested in the config. If the dir already exists, just set\n     * the perms. */\n    return virDirCreate(def->target.path,\n                        mode,\n                        def->target.perms.uid,\n                        def->target.perms.gid,\n                        dir_create_flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_EXCLUSIVE_FLAGS_RET",
          "args": [
            "VIR_STORAGE_POOL_BUILD_OVERWRITE",
            "VIR_STORAGE_POOL_BUILD_NO_OVERWRITE",
            "-1"
          ],
          "line": 519
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_STORAGE_POOL_BUILD_OVERWRITE |\n                  VIR_STORAGE_POOL_BUILD_NO_OVERWRITE",
            "-1"
          ],
          "line": 516
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemBuild(virStoragePoolObjPtr pool,\n                                 unsigned int flags)\n{\n    virCheckFlags(VIR_STORAGE_POOL_BUILD_OVERWRITE |\n                  VIR_STORAGE_POOL_BUILD_NO_OVERWRITE, -1);\n\n    VIR_EXCLUSIVE_FLAGS_RET(VIR_STORAGE_POOL_BUILD_OVERWRITE,\n                            VIR_STORAGE_POOL_BUILD_NO_OVERWRITE,\n                            -1);\n\n    if (virStorageBackendBuildLocal(pool) < 0)\n        return -1;\n\n    if (flags != 0)\n        return virStorageBackendMakeFileSystem(pool, flags);\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendMakeFileSystem",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "448-489",
    "snippet": "static int\nvirStorageBackendMakeFileSystem(virStoragePoolObjPtr pool,\n                                unsigned int flags)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *device = NULL, *format = NULL;\n    bool ok_to_mkfs = false;\n    int ret = -1;\n\n    if (def->source.devices == NULL) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"No source device specified when formatting pool '%s'\"),\n                       def->name);\n        return -1;\n    }\n\n    device = def->source.devices[0].path;\n    format = virStoragePoolFormatFileSystemTypeToString(def->source.format);\n    VIR_DEBUG(\"source device: '%s' format: '%s'\", device, format);\n\n    virObjectUnlock(pool);\n    if (!virFileExists(device)) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"Source device does not exist when formatting pool '%s'\"),\n                       def->name);\n        goto error;\n    }\n\n    if (flags & VIR_STORAGE_POOL_BUILD_OVERWRITE) {\n        ok_to_mkfs = true;\n    } else if (flags & VIR_STORAGE_POOL_BUILD_NO_OVERWRITE &&\n               virStorageBackendDeviceIsEmpty(device, format, true)) {\n        ok_to_mkfs = true;\n    }\n\n    if (ok_to_mkfs)\n        ret = virStorageBackendExecuteMKFS(device, format);\n\n error:\n    virObjectLock(pool);\n    return ret;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "pool"
          ],
          "line": 487
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendExecuteMKFS",
          "args": [
            "device",
            "format"
          ],
          "line": 484
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendExecuteMKFS",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "435-445",
          "snippet": "static int\nvirStorageBackendExecuteMKFS(const char *device G_GNUC_UNUSED,\n                             const char *format G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"mkfs is not supported on this platform: \"\n                     \"Failed to make filesystem of \"\n                     \"type '%s' on device '%s'\"),\n                   format, device);\n    return -1;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendExecuteMKFS(const char *device G_GNUC_UNUSED,\n                             const char *format G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"mkfs is not supported on this platform: \"\n                     \"Failed to make filesystem of \"\n                     \"type '%s' on device '%s'\"),\n                   format, device);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendDeviceIsEmpty",
          "args": [
            "device",
            "format",
            "true"
          ],
          "line": 479
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendDeviceIsEmpty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "3304-3326",
          "snippet": "bool\nvirStorageBackendDeviceIsEmpty(const char *devpath,\n                               const char *format,\n                               bool writelabel)\n{\n    int ret;\n\n    if ((ret = virStorageBackendBLKIDFindEmpty(devpath, format,\n                                               writelabel)) == -2)\n        ret = virStorageBackendPARTEDValidLabel(devpath, format, writelabel);\n\n    if (ret == -2 && !writelabel)\n        ret = 0;\n\n    if (ret == -2) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"Unable to probe '%s' for existing data, \"\n                         \"forced overwrite is necessary\"),\n                       devpath);\n    }\n\n    return ret == 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nbool\nvirStorageBackendDeviceIsEmpty(const char *devpath,\n                               const char *format,\n                               bool writelabel)\n{\n    int ret;\n\n    if ((ret = virStorageBackendBLKIDFindEmpty(devpath, format,\n                                               writelabel)) == -2)\n        ret = virStorageBackendPARTEDValidLabel(devpath, format, writelabel);\n\n    if (ret == -2 && !writelabel)\n        ret = 0;\n\n    if (ret == -2) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"Unable to probe '%s' for existing data, \"\n                         \"forced overwrite is necessary\"),\n                       devpath);\n    }\n\n    return ret == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "_(\"Source device does not exist when formatting pool '%s'\")",
            "def->name"
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Source device does not exist when formatting pool '%s'\""
          ],
          "line": 471
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "device"
          ],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "pool"
          ],
          "line": 468
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"source device: '%s' format: '%s'\"",
            "device",
            "format"
          ],
          "line": 466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolFormatFileSystemTypeToString",
          "args": [
            "def->source.format"
          ],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_INVALID",
            "_(\"No source device specified when formatting pool '%s'\")",
            "def->name"
          ],
          "line": 458
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 452
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendMakeFileSystem(virStoragePoolObjPtr pool,\n                                unsigned int flags)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    const char *device = NULL, *format = NULL;\n    bool ok_to_mkfs = false;\n    int ret = -1;\n\n    if (def->source.devices == NULL) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"No source device specified when formatting pool '%s'\"),\n                       def->name);\n        return -1;\n    }\n\n    device = def->source.devices[0].path;\n    format = virStoragePoolFormatFileSystemTypeToString(def->source.format);\n    VIR_DEBUG(\"source device: '%s' format: '%s'\", device, format);\n\n    virObjectUnlock(pool);\n    if (!virFileExists(device)) {\n        virReportError(VIR_ERR_OPERATION_INVALID,\n                       _(\"Source device does not exist when formatting pool '%s'\"),\n                       def->name);\n        goto error;\n    }\n\n    if (flags & VIR_STORAGE_POOL_BUILD_OVERWRITE) {\n        ok_to_mkfs = true;\n    } else if (flags & VIR_STORAGE_POOL_BUILD_NO_OVERWRITE &&\n               virStorageBackendDeviceIsEmpty(device, format, true)) {\n        ok_to_mkfs = true;\n    }\n\n    if (ok_to_mkfs)\n        ret = virStorageBackendExecuteMKFS(device, format);\n\n error:\n    virObjectLock(pool);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendExecuteMKFS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "435-445",
    "snippet": "static int\nvirStorageBackendExecuteMKFS(const char *device G_GNUC_UNUSED,\n                             const char *format G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"mkfs is not supported on this platform: \"\n                     \"Failed to make filesystem of \"\n                     \"type '%s' on device '%s'\"),\n                   format, device);\n    return -1;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"mkfs is not supported on this platform: \"\n                     \"Failed to make filesystem of \"\n                     \"type '%s' on device '%s'\")",
            "format",
            "device"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"mkfs is not supported on this platform: \"\n                     \"Failed to make filesystem of \"\n                     \"type '%s' on device '%s'\""
          ],
          "line": 440
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendExecuteMKFS(const char *device G_GNUC_UNUSED,\n                             const char *format G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"mkfs is not supported on this platform: \"\n                     \"Failed to make filesystem of \"\n                     \"type '%s' on device '%s'\"),\n                   format, device);\n    return -1;\n}"
  },
  {
    "function_name": "virStorageBackendExecuteMKFS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "407-433",
    "snippet": "static int\nvirStorageBackendExecuteMKFS(const char *device,\n                             const char *format)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(MKFS, \"-t\", format, NULL);\n\n    /* use the force, otherwise mkfs.xfs won't overwrite existing fs.\n     * Similarly mkfs.ext2, mkfs.ext3, and mkfs.ext4 require supplying -F\n     * and mkfs.vfat uses -I */\n    if (STREQ(format, \"xfs\"))\n        virCommandAddArg(cmd, \"-f\");\n    else if (STREQ(format, \"ext2\") ||\n             STREQ(format, \"ext3\") ||\n             STREQ(format, \"ext4\"))\n        virCommandAddArg(cmd, \"-F\");\n    else if (STREQ(format, \"vfat\"))\n        virCommandAddArg(cmd, \"-I\");\n\n    virCommandAddArg(cmd, device);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 429
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandAddArg",
          "args": [
            "cmd",
            "device"
          ],
          "line": 427
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandAddArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "1655-1684",
          "snippet": "void\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvoid\nvirCommandAddArgList(virCommandPtr cmd, ...)\n{\n    va_list list;\n    int narg = 0;\n\n    if (!cmd || cmd->has_error)\n        return;\n\n    va_start(list, cmd);\n    while (va_arg(list, const char *) != NULL)\n        narg++;\n    va_end(list);\n\n    /* narg plus trailing NULL. */\n    if (VIR_RESIZE_N(cmd->args, cmd->maxargs, cmd->nargs, narg + 1) < 0) {\n        cmd->has_error = ENOMEM;\n        return;\n    }\n\n    va_start(list, cmd);\n    while (1) {\n        char *arg = va_arg(list, char *);\n        if (!arg)\n            break;\n        arg = g_strdup(arg);\n        cmd->args[cmd->nargs++] = arg;\n    }\n    va_end(list);\n}"
        }
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "format",
            "\"vfat\""
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "format",
            "\"ext4\""
          ],
          "line": 422
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "format",
            "\"ext3\""
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "format",
            "\"ext2\""
          ],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "format",
            "\"xfs\""
          ],
          "line": 418
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "MKFS",
            "\"-t\"",
            "format",
            "NULL"
          ],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendExecuteMKFS(const char *device,\n                             const char *format)\n{\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(MKFS, \"-t\", format, NULL);\n\n    /* use the force, otherwise mkfs.xfs won't overwrite existing fs.\n     * Similarly mkfs.ext2, mkfs.ext3, and mkfs.ext4 require supplying -F\n     * and mkfs.vfat uses -I */\n    if (STREQ(format, \"xfs\"))\n        virCommandAddArg(cmd, \"-f\");\n    else if (STREQ(format, \"ext2\") ||\n             STREQ(format, \"ext3\") ||\n             STREQ(format, \"ext4\"))\n        virCommandAddArg(cmd, \"-F\");\n    else if (STREQ(format, \"vfat\"))\n        virCommandAddArg(cmd, \"-I\");\n\n    virCommandAddArg(cmd, device);\n\n    if (virCommandRun(cmd, NULL) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemCheck",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "378-403",
    "snippet": "static int\nvirStorageBackendFileSystemCheck(virStoragePoolObjPtr pool,\n                                 bool *isActive)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_DIR) {\n        *isActive = virFileExists(def->target.path);\n#if WITH_STORAGE_FS\n    } else {\n        int ret;\n        *isActive = false;\n\n        if (virStorageBackendFileSystemIsValid(pool) < 0)\n            return -1;\n\n        if ((ret = virStorageBackendFileSystemIsMounted(pool)) != 0) {\n            if (ret < 0)\n                return -1;\n            *isActive = true;\n        }\n#endif /* WITH_STORAGE_FS */\n    }\n\n    return 0;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemIsMounted",
          "args": [
            "pool"
          ],
          "line": 394
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemIsMounted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "240-280",
          "snippet": "static int\nvirStorageBackendFileSystemIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    int rc1, rc2;\n    g_autofree char *src = NULL;\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    if ((src = virStorageBackendFileSystemGetPoolSource(pool)) == NULL)\n        goto cleanup;\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n        /* compare both mount destinations and sources to be sure the mounted\n         * FS pool is really the one we're looking for\n         */\n        if ((rc1 = virFileComparePaths(ent.mnt_dir, def->target.path)) < 0 ||\n            (rc2 = virFileComparePaths(ent.mnt_fsname, src)) < 0)\n            goto cleanup;\n\n        if (rc1 && rc2) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    int rc1, rc2;\n    g_autofree char *src = NULL;\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    if ((src = virStorageBackendFileSystemGetPoolSource(pool)) == NULL)\n        goto cleanup;\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n        /* compare both mount destinations and sources to be sure the mounted\n         * FS pool is really the one we're looking for\n         */\n        if ((rc1 = virFileComparePaths(ent.mnt_dir, def->target.path)) < 0 ||\n            (rc2 = virFileComparePaths(ent.mnt_fsname, src)) < 0)\n            goto cleanup;\n\n        if (rc1 && rc2) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemIsValid",
          "args": [
            "pool"
          ],
          "line": 391
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemIsValid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "196-230",
          "snippet": "static int\nvirStorageBackendFileSystemIsValid(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.nhost != 1) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"expected exactly 1 host for the storage pool\"));\n            return -1;\n        }\n        if (def->source.hosts[0].name == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source host\"));\n            return -1;\n        }\n        if (def->source.dir == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source path\"));\n            return -1;\n        }\n    } else {\n        if (def->source.ndevice != 1) {\n            if (def->source.ndevice == 0)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"missing source device\"));\n            else\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                               _(\"expected exactly 1 device for the \"\n                                 \"storage pool\"));\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemIsValid(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.nhost != 1) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"expected exactly 1 host for the storage pool\"));\n            return -1;\n        }\n        if (def->source.hosts[0].name == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source host\"));\n            return -1;\n        }\n        if (def->source.dir == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source path\"));\n            return -1;\n        }\n    } else {\n        if (def->source.ndevice != 1) {\n            if (def->source.ndevice == 0)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"missing source device\"));\n            else\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                               _(\"expected exactly 1 device for the \"\n                                 \"storage pool\"));\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileExists",
          "args": [
            "def->target.path"
          ],
          "line": 385
        },
        "resolved": true,
        "details": {
          "function_name": "virFileExists",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1873-1877",
          "snippet": "bool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nbool\nvirFileExists(const char *path)\n{\n    return access(path, F_OK) == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 382
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemCheck(virStoragePoolObjPtr pool,\n                                 bool *isActive)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_DIR) {\n        *isActive = virFileExists(def->target.path);\n#if WITH_STORAGE_FS\n    } else {\n        int ret;\n        *isActive = false;\n\n        if (virStorageBackendFileSystemIsValid(pool) < 0)\n            return -1;\n\n        if ((ret = virStorageBackendFileSystemIsMounted(pool)) != 0) {\n            if (ret < 0)\n                return -1;\n            *isActive = true;\n        }\n#endif /* WITH_STORAGE_FS */\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemStop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "358-374",
    "snippet": "static int\nvirStorageBackendFileSystemStop(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc;\n    g_autoptr(virCommand) cmd = NULL;\n\n    if (virStorageBackendFileSystemIsValid(pool) < 0)\n        return -1;\n\n    /* Short-circuit if already unmounted */\n    if ((rc = virStorageBackendFileSystemIsMounted(pool)) != 1)\n        return rc;\n\n    cmd = virCommandNewArgList(UMOUNT, def->target.path, NULL);\n    return virCommandRun(cmd, NULL);\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 373
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "UMOUNT",
            "def->target.path",
            "NULL"
          ],
          "line": 372
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemIsMounted",
          "args": [
            "pool"
          ],
          "line": 369
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemIsMounted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "240-280",
          "snippet": "static int\nvirStorageBackendFileSystemIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    int rc1, rc2;\n    g_autofree char *src = NULL;\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    if ((src = virStorageBackendFileSystemGetPoolSource(pool)) == NULL)\n        goto cleanup;\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n        /* compare both mount destinations and sources to be sure the mounted\n         * FS pool is really the one we're looking for\n         */\n        if ((rc1 = virFileComparePaths(ent.mnt_dir, def->target.path)) < 0 ||\n            (rc2 = virFileComparePaths(ent.mnt_fsname, src)) < 0)\n            goto cleanup;\n\n        if (rc1 && rc2) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    int rc1, rc2;\n    g_autofree char *src = NULL;\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    if ((src = virStorageBackendFileSystemGetPoolSource(pool)) == NULL)\n        goto cleanup;\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n        /* compare both mount destinations and sources to be sure the mounted\n         * FS pool is really the one we're looking for\n         */\n        if ((rc1 = virFileComparePaths(ent.mnt_dir, def->target.path)) < 0 ||\n            (rc2 = virFileComparePaths(ent.mnt_fsname, src)) < 0)\n            goto cleanup;\n\n        if (rc1 && rc2) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemIsValid",
          "args": [
            "pool"
          ],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemIsValid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "196-230",
          "snippet": "static int\nvirStorageBackendFileSystemIsValid(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.nhost != 1) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"expected exactly 1 host for the storage pool\"));\n            return -1;\n        }\n        if (def->source.hosts[0].name == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source host\"));\n            return -1;\n        }\n        if (def->source.dir == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source path\"));\n            return -1;\n        }\n    } else {\n        if (def->source.ndevice != 1) {\n            if (def->source.ndevice == 0)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"missing source device\"));\n            else\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                               _(\"expected exactly 1 device for the \"\n                                 \"storage pool\"));\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemIsValid(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.nhost != 1) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"expected exactly 1 host for the storage pool\"));\n            return -1;\n        }\n        if (def->source.hosts[0].name == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source host\"));\n            return -1;\n        }\n        if (def->source.dir == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source path\"));\n            return -1;\n        }\n    } else {\n        if (def->source.ndevice != 1) {\n            if (def->source.ndevice == 0)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"missing source device\"));\n            else\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                               _(\"expected exactly 1 device for the \"\n                                 \"storage pool\"));\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemStop(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc;\n    g_autoptr(virCommand) cmd = NULL;\n\n    if (virStorageBackendFileSystemIsValid(pool) < 0)\n        return -1;\n\n    /* Short-circuit if already unmounted */\n    if ((rc = virStorageBackendFileSystemIsMounted(pool)) != 1)\n        return rc;\n\n    cmd = virCommandNewArgList(UMOUNT, def->target.path, NULL);\n    return virCommandRun(cmd, NULL);\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemStart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "334-344",
    "snippet": "static int\nvirStorageBackendFileSystemStart(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type != VIR_STORAGE_POOL_DIR &&\n        virStorageBackendFileSystemMount(pool) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemMount",
          "args": [
            "pool"
          ],
          "line": 340
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemMount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "291-323",
          "snippet": "static int\nvirStorageBackendFileSystemMount(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc;\n    g_autofree char *src = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    if (virStorageBackendFileSystemIsValid(pool) < 0)\n        return -1;\n\n    if ((rc = virStorageBackendFileSystemIsMounted(pool)) < 0)\n        return -1;\n\n    /* Short-circuit if already mounted */\n    if (rc == 1) {\n        VIR_INFO(\"Target '%s' is already mounted\", def->target.path);\n        return 0;\n    }\n\n    if (!(src = virStorageBackendFileSystemGetPoolSource(pool)))\n        return -1;\n\n    cmd = virStorageBackendFileSystemMountCmd(MOUNT, def, src);\n\n    /* Mounting a shared FS might take a long time. Don't hold\n     * the pool locked meanwhile. */\n    virObjectUnlock(pool);\n    rc = virCommandRun(cmd, NULL);\n    virObjectLock(pool);\n\n    return rc;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemMount(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc;\n    g_autofree char *src = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    if (virStorageBackendFileSystemIsValid(pool) < 0)\n        return -1;\n\n    if ((rc = virStorageBackendFileSystemIsMounted(pool)) < 0)\n        return -1;\n\n    /* Short-circuit if already mounted */\n    if (rc == 1) {\n        VIR_INFO(\"Target '%s' is already mounted\", def->target.path);\n        return 0;\n    }\n\n    if (!(src = virStorageBackendFileSystemGetPoolSource(pool)))\n        return -1;\n\n    cmd = virStorageBackendFileSystemMountCmd(MOUNT, def, src);\n\n    /* Mounting a shared FS might take a long time. Don't hold\n     * the pool locked meanwhile. */\n    virObjectUnlock(pool);\n    rc = virCommandRun(cmd, NULL);\n    virObjectLock(pool);\n\n    return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 337
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemStart(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type != VIR_STORAGE_POOL_DIR &&\n        virStorageBackendFileSystemMount(pool) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemMount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "291-323",
    "snippet": "static int\nvirStorageBackendFileSystemMount(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc;\n    g_autofree char *src = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    if (virStorageBackendFileSystemIsValid(pool) < 0)\n        return -1;\n\n    if ((rc = virStorageBackendFileSystemIsMounted(pool)) < 0)\n        return -1;\n\n    /* Short-circuit if already mounted */\n    if (rc == 1) {\n        VIR_INFO(\"Target '%s' is already mounted\", def->target.path);\n        return 0;\n    }\n\n    if (!(src = virStorageBackendFileSystemGetPoolSource(pool)))\n        return -1;\n\n    cmd = virStorageBackendFileSystemMountCmd(MOUNT, def, src);\n\n    /* Mounting a shared FS might take a long time. Don't hold\n     * the pool locked meanwhile. */\n    virObjectUnlock(pool);\n    rc = virCommandRun(cmd, NULL);\n    virObjectLock(pool);\n\n    return rc;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "pool"
          ],
          "line": 320
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "pool"
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemMountCmd",
          "args": [
            "MOUNT",
            "def",
            "src"
          ],
          "line": 314
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemMountCmd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "4144-4174",
          "snippet": "virCommandPtr\nvirStorageBackendFileSystemMountCmd(const char *cmdstr,\n                                    virStoragePoolDefPtr def,\n                                    const char *src)\n{\n    /* 'mount -t auto' doesn't seem to auto determine nfs (or cifs),\n     *  while plain 'mount' does. We have to craft separate argvs to\n     *  accommodate this */\n    bool netauto = (def->type == VIR_STORAGE_POOL_NETFS &&\n                    def->source.format == VIR_STORAGE_POOL_NETFS_AUTO);\n    bool glusterfs = (def->type == VIR_STORAGE_POOL_NETFS &&\n                      def->source.format == VIR_STORAGE_POOL_NETFS_GLUSTERFS);\n    bool cifsfs = (def->type == VIR_STORAGE_POOL_NETFS &&\n                   def->source.format == VIR_STORAGE_POOL_NETFS_CIFS);\n    virCommandPtr cmd = NULL;\n    g_autofree char *nfsVers = NULL;\n\n    if (def->type == VIR_STORAGE_POOL_NETFS && def->source.protocolVer > 0)\n        nfsVers = g_strdup_printf(\"nfsvers=%u\", def->source.protocolVer);\n\n    cmd = virCommandNew(cmdstr);\n    if (netauto)\n        virStorageBackendFileSystemMountNFSArgs(cmd, src, def, nfsVers);\n    else if (glusterfs)\n        virStorageBackendFileSystemMountGlusterArgs(cmd, src, def);\n    else if (cifsfs)\n        virStorageBackendFileSystemMountCIFSArgs(cmd, src, def);\n    else\n        virStorageBackendFileSystemMountDefaultArgs(cmd, src, def, nfsVers);\n    return cmd;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirCommandPtr\nvirStorageBackendFileSystemMountCmd(const char *cmdstr,\n                                    virStoragePoolDefPtr def,\n                                    const char *src)\n{\n    /* 'mount -t auto' doesn't seem to auto determine nfs (or cifs),\n     *  while plain 'mount' does. We have to craft separate argvs to\n     *  accommodate this */\n    bool netauto = (def->type == VIR_STORAGE_POOL_NETFS &&\n                    def->source.format == VIR_STORAGE_POOL_NETFS_AUTO);\n    bool glusterfs = (def->type == VIR_STORAGE_POOL_NETFS &&\n                      def->source.format == VIR_STORAGE_POOL_NETFS_GLUSTERFS);\n    bool cifsfs = (def->type == VIR_STORAGE_POOL_NETFS &&\n                   def->source.format == VIR_STORAGE_POOL_NETFS_CIFS);\n    virCommandPtr cmd = NULL;\n    g_autofree char *nfsVers = NULL;\n\n    if (def->type == VIR_STORAGE_POOL_NETFS && def->source.protocolVer > 0)\n        nfsVers = g_strdup_printf(\"nfsvers=%u\", def->source.protocolVer);\n\n    cmd = virCommandNew(cmdstr);\n    if (netauto)\n        virStorageBackendFileSystemMountNFSArgs(cmd, src, def, nfsVers);\n    else if (glusterfs)\n        virStorageBackendFileSystemMountGlusterArgs(cmd, src, def);\n    else if (cifsfs)\n        virStorageBackendFileSystemMountCIFSArgs(cmd, src, def);\n    else\n        virStorageBackendFileSystemMountDefaultArgs(cmd, src, def, nfsVers);\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemGetPoolSource",
          "args": [
            "pool"
          ],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemGetPoolSource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "4034-4052",
          "snippet": "char *\nvirStorageBackendFileSystemGetPoolSource(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    char *src = NULL;\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.format == VIR_STORAGE_POOL_NETFS_CIFS) {\n            src = g_strdup_printf(\"//%s/%s\", def->source.hosts[0].name,\n                                  def->source.dir);\n        } else {\n            src = g_strdup_printf(\"%s:%s\", def->source.hosts[0].name,\n                                  def->source.dir);\n        }\n    } else {\n        src = g_strdup(def->source.devices[0].path);\n    }\n    return src;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nchar *\nvirStorageBackendFileSystemGetPoolSource(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    char *src = NULL;\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.format == VIR_STORAGE_POOL_NETFS_CIFS) {\n            src = g_strdup_printf(\"//%s/%s\", def->source.hosts[0].name,\n                                  def->source.dir);\n        } else {\n            src = g_strdup_printf(\"%s:%s\", def->source.hosts[0].name,\n                                  def->source.dir);\n        }\n    } else {\n        src = g_strdup(def->source.devices[0].path);\n    }\n    return src;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_INFO",
          "args": [
            "\"Target '%s' is already mounted\"",
            "def->target.path"
          ],
          "line": 307
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemIsMounted",
          "args": [
            "pool"
          ],
          "line": 302
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemIsMounted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "240-280",
          "snippet": "static int\nvirStorageBackendFileSystemIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    int rc1, rc2;\n    g_autofree char *src = NULL;\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    if ((src = virStorageBackendFileSystemGetPoolSource(pool)) == NULL)\n        goto cleanup;\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n        /* compare both mount destinations and sources to be sure the mounted\n         * FS pool is really the one we're looking for\n         */\n        if ((rc1 = virFileComparePaths(ent.mnt_dir, def->target.path)) < 0 ||\n            (rc2 = virFileComparePaths(ent.mnt_fsname, src)) < 0)\n            goto cleanup;\n\n        if (rc1 && rc2) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    int rc1, rc2;\n    g_autofree char *src = NULL;\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    if ((src = virStorageBackendFileSystemGetPoolSource(pool)) == NULL)\n        goto cleanup;\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n        /* compare both mount destinations and sources to be sure the mounted\n         * FS pool is really the one we're looking for\n         */\n        if ((rc1 = virFileComparePaths(ent.mnt_dir, def->target.path)) < 0 ||\n            (rc2 = virFileComparePaths(ent.mnt_fsname, src)) < 0)\n            goto cleanup;\n\n        if (rc1 && rc2) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemIsValid",
          "args": [
            "pool"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemIsValid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "196-230",
          "snippet": "static int\nvirStorageBackendFileSystemIsValid(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.nhost != 1) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"expected exactly 1 host for the storage pool\"));\n            return -1;\n        }\n        if (def->source.hosts[0].name == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source host\"));\n            return -1;\n        }\n        if (def->source.dir == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source path\"));\n            return -1;\n        }\n    } else {\n        if (def->source.ndevice != 1) {\n            if (def->source.ndevice == 0)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"missing source device\"));\n            else\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                               _(\"expected exactly 1 device for the \"\n                                 \"storage pool\"));\n            return -1;\n        }\n    }\n    return 0;\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemIsValid(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.nhost != 1) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"expected exactly 1 host for the storage pool\"));\n            return -1;\n        }\n        if (def->source.hosts[0].name == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source host\"));\n            return -1;\n        }\n        if (def->source.dir == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source path\"));\n            return -1;\n        }\n    } else {\n        if (def->source.ndevice != 1) {\n            if (def->source.ndevice == 0)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"missing source device\"));\n            else\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                               _(\"expected exactly 1 device for the \"\n                                 \"storage pool\"));\n            return -1;\n        }\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemMount(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc;\n    g_autofree char *src = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n\n    if (virStorageBackendFileSystemIsValid(pool) < 0)\n        return -1;\n\n    if ((rc = virStorageBackendFileSystemIsMounted(pool)) < 0)\n        return -1;\n\n    /* Short-circuit if already mounted */\n    if (rc == 1) {\n        VIR_INFO(\"Target '%s' is already mounted\", def->target.path);\n        return 0;\n    }\n\n    if (!(src = virStorageBackendFileSystemGetPoolSource(pool)))\n        return -1;\n\n    cmd = virStorageBackendFileSystemMountCmd(MOUNT, def, src);\n\n    /* Mounting a shared FS might take a long time. Don't hold\n     * the pool locked meanwhile. */\n    virObjectUnlock(pool);\n    rc = virCommandRun(cmd, NULL);\n    virObjectLock(pool);\n\n    return rc;\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemIsMounted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "240-280",
    "snippet": "static int\nvirStorageBackendFileSystemIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    int rc1, rc2;\n    g_autofree char *src = NULL;\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    if ((src = virStorageBackendFileSystemGetPoolSource(pool)) == NULL)\n        goto cleanup;\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n        /* compare both mount destinations and sources to be sure the mounted\n         * FS pool is really the one we're looking for\n         */\n        if ((rc1 = virFileComparePaths(ent.mnt_dir, def->target.path)) < 0 ||\n            (rc2 = virFileComparePaths(ent.mnt_fsname, src)) < 0)\n            goto cleanup;\n\n        if (rc1 && rc2) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "mtab"
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virFileComparePaths",
          "args": [
            "ent.mnt_fsname",
            "src"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "virFileComparePaths",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3910-3930",
          "snippet": "int\nvirFileComparePaths(const char *p1, const char *p2)\n{\n    g_autofree char *res1 = NULL;\n    g_autofree char *res2 = NULL;\n\n    /* Assume p1 and p2 are symlinks, so try to resolve and canonicalize them.\n     * Canonicalization fails for example on file systems names like 'proc' or\n     * 'sysfs', since they're no real paths so fallback to plain string\n     * comparison.\n     */\n    ignore_value(virFileResolveLink(p1, &res1));\n    if (!res1)\n        res1 = g_strdup(p1);\n\n    ignore_value(virFileResolveLink(p2, &res2));\n    if (!res2)\n        res2 = g_strdup(p2);\n\n    return STREQ_NULLABLE(res1, res2);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileComparePaths(const char *p1, const char *p2)\n{\n    g_autofree char *res1 = NULL;\n    g_autofree char *res2 = NULL;\n\n    /* Assume p1 and p2 are symlinks, so try to resolve and canonicalize them.\n     * Canonicalization fails for example on file systems names like 'proc' or\n     * 'sysfs', since they're no real paths so fallback to plain string\n     * comparison.\n     */\n    ignore_value(virFileResolveLink(p1, &res1));\n    if (!res1)\n        res1 = g_strdup(p1);\n\n    ignore_value(virFileResolveLink(p2, &res2));\n    if (!res2)\n        res2 = g_strdup(p2);\n\n    return STREQ_NULLABLE(res1, res2);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getmntent_r",
          "args": [
            "mtab",
            "&ent",
            "buf",
            "sizeof(buf)"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemGetPoolSource",
          "args": [
            "pool"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemGetPoolSource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "4034-4052",
          "snippet": "char *\nvirStorageBackendFileSystemGetPoolSource(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    char *src = NULL;\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.format == VIR_STORAGE_POOL_NETFS_CIFS) {\n            src = g_strdup_printf(\"//%s/%s\", def->source.hosts[0].name,\n                                  def->source.dir);\n        } else {\n            src = g_strdup_printf(\"%s:%s\", def->source.hosts[0].name,\n                                  def->source.dir);\n        }\n    } else {\n        src = g_strdup(def->source.devices[0].path);\n    }\n    return src;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nchar *\nvirStorageBackendFileSystemGetPoolSource(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    char *src = NULL;\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.format == VIR_STORAGE_POOL_NETFS_CIFS) {\n            src = g_strdup_printf(\"//%s/%s\", def->source.hosts[0].name,\n                                  def->source.dir);\n        } else {\n            src = g_strdup_printf(\"%s:%s\", def->source.hosts[0].name,\n                                  def->source.dir);\n        }\n    } else {\n        src = g_strdup(def->source.devices[0].path);\n    }\n    return src;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot read mount list '%s'\")",
            "_PATH_MOUNTED"
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot read mount list '%s'\""
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "_PATH_MOUNTED",
            "\"r\""
          ],
          "line": 251
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    int rc1, rc2;\n    g_autofree char *src = NULL;\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    if ((src = virStorageBackendFileSystemGetPoolSource(pool)) == NULL)\n        goto cleanup;\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n        /* compare both mount destinations and sources to be sure the mounted\n         * FS pool is really the one we're looking for\n         */\n        if ((rc1 = virFileComparePaths(ent.mnt_dir, def->target.path)) < 0 ||\n            (rc2 = virFileComparePaths(ent.mnt_fsname, src)) < 0)\n            goto cleanup;\n\n        if (rc1 && rc2) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemIsValid",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "196-230",
    "snippet": "static int\nvirStorageBackendFileSystemIsValid(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.nhost != 1) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"expected exactly 1 host for the storage pool\"));\n            return -1;\n        }\n        if (def->source.hosts[0].name == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source host\"));\n            return -1;\n        }\n        if (def->source.dir == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source path\"));\n            return -1;\n        }\n    } else {\n        if (def->source.ndevice != 1) {\n            if (def->source.ndevice == 0)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"missing source device\"));\n            else\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                               _(\"expected exactly 1 device for the \"\n                                 \"storage pool\"));\n            return -1;\n        }\n    }\n    return 0;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"expected exactly 1 device for the \"\n                                 \"storage pool\")"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"expected exactly 1 device for the \"\n                                 \"storage pool\""
          ],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"missing source device\")"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"missing source path\")"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"missing source host\")"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"expected exactly 1 host for the storage pool\")"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 199
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemIsValid(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n\n    if (def->type == VIR_STORAGE_POOL_NETFS) {\n        if (def->source.nhost != 1) {\n            virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                           _(\"expected exactly 1 host for the storage pool\"));\n            return -1;\n        }\n        if (def->source.hosts[0].name == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source host\"));\n            return -1;\n        }\n        if (def->source.dir == NULL) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           \"%s\", _(\"missing source path\"));\n            return -1;\n        }\n    } else {\n        if (def->source.ndevice != 1) {\n            if (def->source.ndevice == 0)\n                virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                               _(\"missing source device\"));\n            else\n                virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                               _(\"expected exactly 1 device for the \"\n                                 \"storage pool\"));\n            return -1;\n        }\n    }\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemNetFindPoolSources",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "123-187",
    "snippet": "static char *\nvirStorageBackendFileSystemNetFindPoolSources(const char *srcSpec,\n                                              unsigned int flags)\n{\n    virNetfsDiscoverState state = {\n        .host = NULL,\n        .list = {\n            .type = VIR_STORAGE_POOL_NETFS,\n            .nsources = 0,\n            .sources = NULL\n        }\n    };\n    char *ret = NULL;\n    size_t i;\n    int retNFS = -1;\n    int retGluster = 0;\n    g_autoptr(virStoragePoolSource) source = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (!srcSpec) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"hostname must be specified for netfs sources\"));\n        return NULL;\n    }\n\n    if (!(source = virStoragePoolDefParseSourceString(srcSpec,\n                                                      VIR_STORAGE_POOL_NETFS)))\n        return NULL;\n\n    if (source->nhost != 1) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Expected exactly 1 host for the storage pool\"));\n        goto cleanup;\n    }\n\n    state.host = source->hosts[0].name;\n\n    retNFS = virStorageBackendFileSystemNetFindNFSPoolSources(&state);\n\n    retGluster = virStorageBackendFindGlusterPoolSources(state.host,\n                                                         VIR_STORAGE_POOL_NETFS,\n                                                         &state.list, false);\n\n    if (retGluster < 0)\n        goto cleanup;\n\n    /* If both fail, then we won't return an empty list - return an error */\n    if (retNFS < 0 && retGluster == 0) {\n        virReportError(VIR_ERR_OPERATION_FAILED,\n                       _(\"no storage pools were found on host '%s'\"),\n                       state.host);\n        goto cleanup;\n    }\n\n    if (!(ret = virStoragePoolSourceListFormat(&state.list)))\n        goto cleanup;\n\n cleanup:\n    for (i = 0; i < state.list.nsources; i++)\n        virStoragePoolSourceClear(&state.list.sources[i]);\n    VIR_FREE(state.list.sources);\n\n    return ret;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "state.list.sources"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolSourceClear",
          "args": [
            "&state.list.sources[i]"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolSourceClear",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/storage_conf.c",
          "lines": "471-493",
          "snippet": "void\nvirStoragePoolSourceClear(virStoragePoolSourcePtr source)\n{\n    size_t i;\n\n    if (!source)\n        return;\n\n    for (i = 0; i < source->nhost; i++)\n        VIR_FREE(source->hosts[i].name);\n    VIR_FREE(source->hosts);\n\n    for (i = 0; i < source->ndevice; i++)\n        virStoragePoolSourceDeviceClear(&source->devices[i]);\n    VIR_FREE(source->devices);\n    VIR_FREE(source->dir);\n    VIR_FREE(source->name);\n    virStorageAdapterClear(&source->adapter);\n    virStorageSourceInitiatorClear(&source->initiator);\n    virStorageAuthDefFree(source->auth);\n    VIR_FREE(source->vendor);\n    VIR_FREE(source->product);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virvhba.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_adapter_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virvhba.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"storage_adapter_conf.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvoid\nvirStoragePoolSourceClear(virStoragePoolSourcePtr source)\n{\n    size_t i;\n\n    if (!source)\n        return;\n\n    for (i = 0; i < source->nhost; i++)\n        VIR_FREE(source->hosts[i].name);\n    VIR_FREE(source->hosts);\n\n    for (i = 0; i < source->ndevice; i++)\n        virStoragePoolSourceDeviceClear(&source->devices[i]);\n    VIR_FREE(source->devices);\n    VIR_FREE(source->dir);\n    VIR_FREE(source->name);\n    virStorageAdapterClear(&source->adapter);\n    virStorageSourceInitiatorClear(&source->initiator);\n    virStorageAuthDefFree(source->auth);\n    VIR_FREE(source->vendor);\n    VIR_FREE(source->product);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolSourceListFormat",
          "args": [
            "&state.list"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolSourceListFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/storage_conf.c",
          "lines": "1744-1777",
          "snippet": "char *\nvirStoragePoolSourceListFormat(virStoragePoolSourceListPtr def)\n{\n    virStoragePoolOptionsPtr options;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    const char *type;\n    size_t i;\n\n    options = virStoragePoolOptionsForPoolType(def->type);\n    if (options == NULL)\n        return NULL;\n\n    type = virStoragePoolTypeToString(def->type);\n    if (!type) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"unexpected pool type\"));\n        goto cleanup;\n    }\n\n    virBufferAddLit(&buf, \"<sources>\\n\");\n    virBufferAdjustIndent(&buf, 2);\n\n    for (i = 0; i < def->nsources; i++)\n        virStoragePoolSourceFormat(&buf, options, &def->sources[i]);\n\n    virBufferAdjustIndent(&buf, -2);\n    virBufferAddLit(&buf, \"</sources>\\n\");\n\n    return virBufferContentAndReset(&buf);\n\n cleanup:\n    virBufferFreeAndReset(&buf);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virvhba.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_adapter_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virvhba.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"storage_adapter_conf.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nchar *\nvirStoragePoolSourceListFormat(virStoragePoolSourceListPtr def)\n{\n    virStoragePoolOptionsPtr options;\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    const char *type;\n    size_t i;\n\n    options = virStoragePoolOptionsForPoolType(def->type);\n    if (options == NULL)\n        return NULL;\n\n    type = virStoragePoolTypeToString(def->type);\n    if (!type) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"unexpected pool type\"));\n        goto cleanup;\n    }\n\n    virBufferAddLit(&buf, \"<sources>\\n\");\n    virBufferAdjustIndent(&buf, 2);\n\n    for (i = 0; i < def->nsources; i++)\n        virStoragePoolSourceFormat(&buf, options, &def->sources[i]);\n\n    virBufferAdjustIndent(&buf, -2);\n    virBufferAddLit(&buf, \"</sources>\\n\");\n\n    return virBufferContentAndReset(&buf);\n\n cleanup:\n    virBufferFreeAndReset(&buf);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_OPERATION_FAILED",
            "_(\"no storage pools were found on host '%s'\")",
            "state.host"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no storage pools were found on host '%s'\""
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendFindGlusterPoolSources",
          "args": [
            "state.host",
            "VIR_STORAGE_POOL_NETFS",
            "&state.list",
            "false"
          ],
          "line": 163
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFindGlusterPoolSources",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "2883-2919",
          "snippet": "int\nvirStorageBackendFindGlusterPoolSources(const char *host,\n                                        virStoragePoolType pooltype,\n                                        virStoragePoolSourceListPtr list,\n                                        bool report)\n{\n    int rc;\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *glusterpath = NULL;\n    g_autofree char *outbuf = NULL;\n\n    if (!(glusterpath = virFindFileInPath(\"gluster\"))) {\n        if (report) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'gluster' command line tool not found\"));\n            return -1;\n        } else {\n            return 0;\n        }\n    }\n\n    cmd = virCommandNewArgList(glusterpath,\n                               \"--xml\",\n                               \"--log-file=/dev/null\",\n                               \"volume\", \"info\", \"all\", NULL);\n\n    virCommandAddArgFormat(cmd, \"--remote-host=%s\", host);\n    virCommandSetOutputBuffer(cmd, &outbuf);\n\n    if (virCommandRun(cmd, &rc) < 0)\n        return -1;\n\n    if (rc != 0)\n        return 0;\n\n    return virStorageUtilGlusterExtractPoolSources(host, outbuf, list, pooltype);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStorageBackendFindGlusterPoolSources(const char *host,\n                                        virStoragePoolType pooltype,\n                                        virStoragePoolSourceListPtr list,\n                                        bool report)\n{\n    int rc;\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *glusterpath = NULL;\n    g_autofree char *outbuf = NULL;\n\n    if (!(glusterpath = virFindFileInPath(\"gluster\"))) {\n        if (report) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"'gluster' command line tool not found\"));\n            return -1;\n        } else {\n            return 0;\n        }\n    }\n\n    cmd = virCommandNewArgList(glusterpath,\n                               \"--xml\",\n                               \"--log-file=/dev/null\",\n                               \"volume\", \"info\", \"all\", NULL);\n\n    virCommandAddArgFormat(cmd, \"--remote-host=%s\", host);\n    virCommandSetOutputBuffer(cmd, &outbuf);\n\n    if (virCommandRun(cmd, &rc) < 0)\n        return -1;\n\n    if (rc != 0)\n        return 0;\n\n    return virStorageUtilGlusterExtractPoolSources(host, outbuf, list, pooltype);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendFileSystemNetFindNFSPoolSources",
          "args": [
            "&state"
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendFileSystemNetFindNFSPoolSources",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
          "lines": "91-120",
          "snippet": "static int\nvirStorageBackendFileSystemNetFindNFSPoolSources(virNetfsDiscoverState *state)\n{\n    /*\n     *  # showmount --no-headers -e HOSTNAME\n     *  /tmp   *\n     *  /A dir demo1.foo.bar,demo2.foo.bar\n     *\n     * Extract directory name (including possible interior spaces ...).\n     */\n\n    const char *regexes[] = {\n        \"^(/.*\\\\S) +\\\\S+$\"\n    };\n    int vars[] = {\n        1\n    };\n\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHOWMOUNT,\n                               \"--no-headers\",\n                               \"--exports\",\n                               state->host,\n                               NULL);\n\n    return virCommandRunRegex(cmd, 1, regexes, vars,\n                              virStorageBackendFileSystemNetFindPoolSourcesFunc,\n                              state, NULL, NULL);\n}",
          "includes": [
            "# include <paths.h>",
            "# include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"vircommand.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_util.h\"",
            "#include \"storage_backend_fs.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemNetFindNFSPoolSources(virNetfsDiscoverState *state)\n{\n    /*\n     *  # showmount --no-headers -e HOSTNAME\n     *  /tmp   *\n     *  /A dir demo1.foo.bar,demo2.foo.bar\n     *\n     * Extract directory name (including possible interior spaces ...).\n     */\n\n    const char *regexes[] = {\n        \"^(/.*\\\\S) +\\\\S+$\"\n    };\n    int vars[] = {\n        1\n    };\n\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHOWMOUNT,\n                               \"--no-headers\",\n                               \"--exports\",\n                               state->host,\n                               NULL);\n\n    return virCommandRunRegex(cmd, 1, regexes, vars,\n                              virStorageBackendFileSystemNetFindPoolSourcesFunc,\n                              state, NULL, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_CONFIG_UNSUPPORTED",
            "\"%s\"",
            "_(\"Expected exactly 1 host for the storage pool\")"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolDefParseSourceString",
          "args": [
            "srcSpec",
            "VIR_STORAGE_POOL_NETFS"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolDefParseSourceString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/storage_conf.c",
          "lines": "692-720",
          "snippet": "virStoragePoolSourcePtr\nvirStoragePoolDefParseSourceString(const char *srcSpec,\n                                   int pool_type)\n{\n    g_autoptr(xmlDoc) doc = NULL;\n    xmlNodePtr node = NULL;\n    g_autoptr(xmlXPathContext) xpath_ctxt = NULL;\n    g_autoptr(virStoragePoolSource) def = NULL;\n\n    if (!(doc = virXMLParseStringCtxt(srcSpec,\n                                      _(\"(storage_source_specification)\"),\n                                      &xpath_ctxt)))\n        return NULL;\n\n    if (VIR_ALLOC(def) < 0)\n        return NULL;\n\n    if (!(node = virXPathNode(\"/source\", xpath_ctxt))) {\n        virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                       _(\"root element was not source\"));\n        return NULL;\n    }\n\n    if (virStoragePoolDefParseSource(xpath_ctxt, def, pool_type,\n                                     node) < 0)\n        return NULL;\n\n    return g_steal_pointer(&def);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virvhba.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_adapter_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virvhba.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"storage_adapter_conf.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirStoragePoolSourcePtr\nvirStoragePoolDefParseSourceString(const char *srcSpec,\n                                   int pool_type)\n{\n    g_autoptr(xmlDoc) doc = NULL;\n    xmlNodePtr node = NULL;\n    g_autoptr(xmlXPathContext) xpath_ctxt = NULL;\n    g_autoptr(virStoragePoolSource) def = NULL;\n\n    if (!(doc = virXMLParseStringCtxt(srcSpec,\n                                      _(\"(storage_source_specification)\"),\n                                      &xpath_ctxt)))\n        return NULL;\n\n    if (VIR_ALLOC(def) < 0)\n        return NULL;\n\n    if (!(node = virXPathNode(\"/source\", xpath_ctxt))) {\n        virReportError(VIR_ERR_XML_ERROR, \"%s\",\n                       _(\"root element was not source\"));\n        return NULL;\n    }\n\n    if (virStoragePoolDefParseSource(xpath_ctxt, def, pool_type,\n                                     node) < 0)\n        return NULL;\n\n    return g_steal_pointer(&def);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_ARG",
            "\"%s\"",
            "_(\"hostname must be specified for netfs sources\")"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "NULL"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic char *\nvirStorageBackendFileSystemNetFindPoolSources(const char *srcSpec,\n                                              unsigned int flags)\n{\n    virNetfsDiscoverState state = {\n        .host = NULL,\n        .list = {\n            .type = VIR_STORAGE_POOL_NETFS,\n            .nsources = 0,\n            .sources = NULL\n        }\n    };\n    char *ret = NULL;\n    size_t i;\n    int retNFS = -1;\n    int retGluster = 0;\n    g_autoptr(virStoragePoolSource) source = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (!srcSpec) {\n        virReportError(VIR_ERR_INVALID_ARG, \"%s\",\n                       _(\"hostname must be specified for netfs sources\"));\n        return NULL;\n    }\n\n    if (!(source = virStoragePoolDefParseSourceString(srcSpec,\n                                                      VIR_STORAGE_POOL_NETFS)))\n        return NULL;\n\n    if (source->nhost != 1) {\n        virReportError(VIR_ERR_CONFIG_UNSUPPORTED, \"%s\",\n                       _(\"Expected exactly 1 host for the storage pool\"));\n        goto cleanup;\n    }\n\n    state.host = source->hosts[0].name;\n\n    retNFS = virStorageBackendFileSystemNetFindNFSPoolSources(&state);\n\n    retGluster = virStorageBackendFindGlusterPoolSources(state.host,\n                                                         VIR_STORAGE_POOL_NETFS,\n                                                         &state.list, false);\n\n    if (retGluster < 0)\n        goto cleanup;\n\n    /* If both fail, then we won't return an empty list - return an error */\n    if (retNFS < 0 && retGluster == 0) {\n        virReportError(VIR_ERR_OPERATION_FAILED,\n                       _(\"no storage pools were found on host '%s'\"),\n                       state.host);\n        goto cleanup;\n    }\n\n    if (!(ret = virStoragePoolSourceListFormat(&state.list)))\n        goto cleanup;\n\n cleanup:\n    for (i = 0; i < state.list.nsources; i++)\n        virStoragePoolSourceClear(&state.list.sources[i]);\n    VIR_FREE(state.list.sources);\n\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemNetFindNFSPoolSources",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "91-120",
    "snippet": "static int\nvirStorageBackendFileSystemNetFindNFSPoolSources(virNetfsDiscoverState *state)\n{\n    /*\n     *  # showmount --no-headers -e HOSTNAME\n     *  /tmp   *\n     *  /A dir demo1.foo.bar,demo2.foo.bar\n     *\n     * Extract directory name (including possible interior spaces ...).\n     */\n\n    const char *regexes[] = {\n        \"^(/.*\\\\S) +\\\\S+$\"\n    };\n    int vars[] = {\n        1\n    };\n\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHOWMOUNT,\n                               \"--no-headers\",\n                               \"--exports\",\n                               state->host,\n                               NULL);\n\n    return virCommandRunRegex(cmd, 1, regexes, vars,\n                              virStorageBackendFileSystemNetFindPoolSourcesFunc,\n                              state, NULL, NULL);\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRunRegex",
          "args": [
            "cmd",
            "1",
            "regexes",
            "vars",
            "virStorageBackendFileSystemNetFindPoolSourcesFunc",
            "state",
            "NULL",
            "NULL"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunRegex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "3341-3354",
          "snippet": "int\nvirCommandRunRegex(virCommandPtr cmd G_GNUC_UNUSED,\n                   int nregex G_GNUC_UNUSED,\n                   const char **regex G_GNUC_UNUSED,\n                   int *nvars G_GNUC_UNUSED,\n                   virCommandRunRegexFunc func G_GNUC_UNUSED,\n                   void *data G_GNUC_UNUSED,\n                   const char *prefix G_GNUC_UNUSED,\n                   int *exitstatus G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"%s not implemented on Win32\"), __FUNCTION__);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunRegex(virCommandPtr cmd G_GNUC_UNUSED,\n                   int nregex G_GNUC_UNUSED,\n                   const char **regex G_GNUC_UNUSED,\n                   int *nvars G_GNUC_UNUSED,\n                   virCommandRunRegexFunc func G_GNUC_UNUSED,\n                   void *data G_GNUC_UNUSED,\n                   const char *prefix G_GNUC_UNUSED,\n                   int *exitstatus G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   _(\"%s not implemented on Win32\"), __FUNCTION__);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "SHOWMOUNT",
            "\"--no-headers\"",
            "\"--exports\"",
            "state->host",
            "NULL"
          ],
          "line": 111
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemNetFindNFSPoolSources(virNetfsDiscoverState *state)\n{\n    /*\n     *  # showmount --no-headers -e HOSTNAME\n     *  /tmp   *\n     *  /A dir demo1.foo.bar,demo2.foo.bar\n     *\n     * Extract directory name (including possible interior spaces ...).\n     */\n\n    const char *regexes[] = {\n        \"^(/.*\\\\S) +\\\\S+$\"\n    };\n    int vars[] = {\n        1\n    };\n\n    g_autoptr(virCommand) cmd = NULL;\n\n    cmd = virCommandNewArgList(SHOWMOUNT,\n                               \"--no-headers\",\n                               \"--exports\",\n                               state->host,\n                               NULL);\n\n    return virCommandRunRegex(cmd, 1, regexes, vars,\n                              virStorageBackendFileSystemNetFindPoolSourcesFunc,\n                              state, NULL, NULL);\n}"
  },
  {
    "function_name": "virStorageBackendFileSystemNetFindPoolSourcesFunc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_fs.c",
    "lines": "54-88",
    "snippet": "static int\nvirStorageBackendFileSystemNetFindPoolSourcesFunc(char **const groups,\n                                                  void *data)\n{\n    virNetfsDiscoverState *state = data;\n    const char *name, *path;\n    virStoragePoolSource *src = NULL;\n\n    path = groups[0];\n\n    if (!(name = strrchr(path, '/'))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid netfs path (no /): %s\"), path);\n        return -1;\n    }\n    name += 1;\n    if (*name == '\\0') {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid netfs path (ends in /): %s\"), path);\n        return -1;\n    }\n\n    if (!(src = virStoragePoolSourceListNewSource(&state->list)))\n        return -1;\n\n    if (VIR_ALLOC_N(src->hosts, 1) < 0)\n        return -1;\n    src->nhost = 1;\n\n    src->hosts[0].name = g_strdup(state->host);\n    src->dir = g_strdup(path);\n    src->format = VIR_STORAGE_POOL_NETFS_NFS;\n\n    return 0;\n}",
    "includes": [
      "# include <paths.h>",
      "# include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"vircommand.h\"",
      "#include \"storage_conf.h\"",
      "#include \"storage_util.h\"",
      "#include \"storage_backend_fs.h\"",
      "#include \"virerror.h\"",
      "#include <fcntl.h>",
      "#include <sys/stat.h>",
      "#include <sys/types.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "path"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC_N",
          "args": [
            "src->hosts",
            "1"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolSourceListNewSource",
          "args": [
            "&state->list"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolSourceListNewSource",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/storage_conf.c",
          "lines": "1729-1741",
          "snippet": "virStoragePoolSourcePtr\nvirStoragePoolSourceListNewSource(virStoragePoolSourceListPtr list)\n{\n    virStoragePoolSourcePtr source;\n\n    if (VIR_REALLOC_N(list->sources, list->nsources + 1) < 0)\n        return NULL;\n\n    source = &list->sources[list->nsources++];\n    memset(source, 0, sizeof(*source));\n\n    return source;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virvhba.h\"",
            "#include \"virlog.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"storage_conf.h\"",
            "#include \"storage_adapter_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virvhba.h\"\n#include \"virlog.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"virstoragefile.h\"\n#include \"storage_conf.h\"\n#include \"storage_adapter_conf.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirStoragePoolSourcePtr\nvirStoragePoolSourceListNewSource(virStoragePoolSourceListPtr list)\n{\n    virStoragePoolSourcePtr source;\n\n    if (VIR_REALLOC_N(list->sources, list->nsources + 1) < 0)\n        return NULL;\n\n    source = &list->sources[list->nsources++];\n    memset(source, 0, sizeof(*source));\n\n    return source;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"invalid netfs path (ends in /): %s\")",
            "path"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"invalid netfs path (no /): %s\")",
            "path"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "path",
            "'/'"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "# include <paths.h>\n# include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"vircommand.h\"\n#include \"storage_conf.h\"\n#include \"storage_util.h\"\n#include \"storage_backend_fs.h\"\n#include \"virerror.h\"\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic int\nvirStorageBackendFileSystemNetFindPoolSourcesFunc(char **const groups,\n                                                  void *data)\n{\n    virNetfsDiscoverState *state = data;\n    const char *name, *path;\n    virStoragePoolSource *src = NULL;\n\n    path = groups[0];\n\n    if (!(name = strrchr(path, '/'))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid netfs path (no /): %s\"), path);\n        return -1;\n    }\n    name += 1;\n    if (*name == '\\0') {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"invalid netfs path (ends in /): %s\"), path);\n        return -1;\n    }\n\n    if (!(src = virStoragePoolSourceListNewSource(&state->list)))\n        return -1;\n\n    if (VIR_ALLOC_N(src->hosts, 1) < 0)\n        return -1;\n    src->nhost = 1;\n\n    src->hosts[0].name = g_strdup(state->host);\n    src->dir = g_strdup(path);\n    src->format = VIR_STORAGE_POOL_NETFS_NFS;\n\n    return 0;\n}"
  }
]