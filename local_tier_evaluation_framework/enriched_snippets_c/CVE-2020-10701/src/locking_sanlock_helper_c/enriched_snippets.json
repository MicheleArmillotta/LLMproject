[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/sanlock_helper.c",
    "lines": "47-108",
    "snippet": "int\nmain(int argc, char **argv)\n{\n    const char *uri;\n    const char *uuid;\n    virDomainLockFailureAction action;\n    char *xml = NULL;\n    virConnectPtr conn = NULL;\n    virDomainPtr dom = NULL;\n    int ret = EXIT_FAILURE;\n\n    int authTypes[] = {\n        VIR_CRED_AUTHNAME,\n        VIR_CRED_ECHOPROMPT,\n        VIR_CRED_PASSPHRASE,\n        VIR_CRED_NOECHOPROMPT,\n    };\n    virConnectAuth auth = {\n        .credtype = authTypes,\n        .ncredtype = G_N_ELEMENTS(authTypes),\n        .cb = authCallback,\n    };\n\n    if (virGettextInitialize() < 0)\n        exit(EXIT_FAILURE);\n\n    if (getArgs(argc, argv, &uri, &uuid, &action) < 0)\n        goto cleanup;\n\n    if (!(conn = virConnectOpenAuth(uri, &auth, 0)) ||\n        !(dom = virDomainLookupByUUIDString(conn, uuid)))\n        goto cleanup;\n\n    switch (action) {\n    case VIR_DOMAIN_LOCK_FAILURE_POWEROFF:\n        if (virDomainDestroy(dom) == 0 ||\n            virDomainIsActive(dom) == 0)\n            ret = EXIT_SUCCESS;\n        break;\n\n    case VIR_DOMAIN_LOCK_FAILURE_PAUSE:\n        if (virDomainSuspend(dom) == 0)\n            ret = EXIT_SUCCESS;\n        break;\n\n    case VIR_DOMAIN_LOCK_FAILURE_DEFAULT:\n    case VIR_DOMAIN_LOCK_FAILURE_RESTART:\n    case VIR_DOMAIN_LOCK_FAILURE_IGNORE:\n    case VIR_DOMAIN_LOCK_FAILURE_LAST:\n        fprintf(stderr, _(\"unsupported failure action: '%s'\\n\"),\n                virDomainLockFailureTypeToString(action));\n        break;\n    }\n\n cleanup:\n    virObjectUnref(dom);\n    if (conn)\n        virConnectClose(conn);\n    VIR_FREE(xml);\n\n    return ret;\n}",
    "includes": [
      "#include \"virgettext.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virconf.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "xml"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectClose",
          "args": [
            "conn"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "virConnectClose",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt.c",
          "lines": "1271-1283",
          "snippet": "int\nvirConnectClose(virConnectPtr conn)\n{\n    VIR_DEBUG(\"conn=%p\", conn);\n\n    virResetLastError();\n\n    virCheckConnectReturn(conn, -1);\n\n    if (!virObjectUnref(conn))\n        return 0;\n    return 1;\n}",
          "includes": [
            "#include \"access/viraccessmanager.h\"",
            "# include \"bhyve/bhyve_driver.h\"",
            "# include \"hyperv/hyperv_driver.h\"",
            "# include \"esx/esx_driver.h\"",
            "# include \"vmware/vmware_driver.h\"",
            "# include \"openvz/openvz_driver.h\"",
            "# include \"remote/remote_driver.h\"",
            "# include \"test/test_driver.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"viruri.h\"",
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"virevent.h\"",
            "#include \"vircommand.h\"",
            "#include \"rpc/virnettlscontext.h\"",
            "#include \"virconf.h\"",
            "#include \"configmake.h\"",
            "#include \"viralloc.h\"",
            "#include \"viruuid.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <curl/curl.h>",
            "#include <libxml/xpath.h>",
            "#include <libxml/parser.h>",
            "#include <gio/gnetworking.h>",
            "#include <time.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"access/viraccessmanager.h\"\n# include \"bhyve/bhyve_driver.h\"\n# include \"hyperv/hyperv_driver.h\"\n# include \"esx/esx_driver.h\"\n# include \"vmware/vmware_driver.h\"\n# include \"openvz/openvz_driver.h\"\n# include \"remote/remote_driver.h\"\n# include \"test/test_driver.h\"\n#include \"virtypedparam.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"viruri.h\"\n#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"virevent.h\"\n#include \"vircommand.h\"\n#include \"rpc/virnettlscontext.h\"\n#include \"virconf.h\"\n#include \"configmake.h\"\n#include \"viralloc.h\"\n#include \"viruuid.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <curl/curl.h>\n#include <libxml/xpath.h>\n#include <libxml/parser.h>\n#include <gio/gnetworking.h>\n#include <time.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirConnectClose(virConnectPtr conn)\n{\n    VIR_DEBUG(\"conn=%p\", conn);\n\n    virResetLastError();\n\n    virCheckConnectReturn(conn, -1);\n\n    if (!virObjectUnref(conn))\n        return 0;\n    return 1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "dom"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"unsupported failure action: '%s'\\n\")",
            "virDomainLockFailureTypeToString(action)"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virDomainLockFailureTypeToString",
          "args": [
            "action"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"unsupported failure action: '%s'\\n\""
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "ATTRIBUTE_NONNULL",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_driver_sanlock.c",
          "lines": "97-111",
          "snippet": "static bool\nATTRIBUTE_NONNULL(2)\nvirLockManagerSanlockError(int err,\n                           char **message)\n{\n    if (err <= -200) {\n#if HAVE_SANLOCK_STRERROR\n        *message = g_strdup(sanlock_strerror(err));\n#else\n        *message = g_strdup_printf(_(\"sanlock error %d\"), err);\n#endif\n        return true;\n    } else {\n        return false;\n    }",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virconf.h\"",
            "#include \"virfile.h\"",
            "#include \"vircrypto.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"lock_driver.h\"",
            "#include <sanlock_admin.h>",
            "#include <sanlock_resource.h>",
            "#include <sanlock.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virconf.h\"\n#include \"virfile.h\"\n#include \"vircrypto.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"lock_driver.h\"\n#include <sanlock_admin.h>\n#include <sanlock_resource.h>\n#include <sanlock.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool\nATTRIBUTE_NONNULL(2)\nvirLockManagerSanlockError(int err,\n                           char **message)\n{\n    if (err <= -200) {\n#if HAVE_SANLOCK_STRERROR\n        *message = g_strdup(sanlock_strerror(err));\n#else\n        *message = g_strdup_printf(_(\"sanlock error %d\"), err);\n#endif\n        return true;\n    } else {\n        return false;\n    }"
        }
      },
      {
        "call_info": {
          "callee": "virDomainSuspend",
          "args": [
            "dom"
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainSuspend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "618-645",
          "snippet": "int\nvirDomainSuspend(virDomainPtr domain)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    conn = domain->conn;\n\n    virCheckReadOnlyGoto(conn->flags, error);\n\n    if (conn->driver->domainSuspend) {\n        int ret;\n        ret = conn->driver->domainSuspend(domain);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nint\nvirDomainSuspend(virDomainPtr domain)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    conn = domain->conn;\n\n    virCheckReadOnlyGoto(conn->flags, error);\n\n    if (conn->driver->domainSuspend) {\n        int ret;\n        ret = conn->driver->domainSuspend(domain);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(domain->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainIsActive",
          "args": [
            "dom"
          ],
          "line": 83
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainIsActive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "8621-8642",
          "snippet": "int\nvirDomainIsActive(virDomainPtr dom)\n{\n    VIR_DEBUG(\"dom=%p\", dom);\n\n    virResetLastError();\n\n    virCheckDomainReturn(dom, -1);\n\n    if (dom->conn->driver->domainIsActive) {\n        int ret;\n        ret = dom->conn->driver->domainIsActive(dom);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n error:\n    virDispatchError(dom->conn);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nint\nvirDomainIsActive(virDomainPtr dom)\n{\n    VIR_DEBUG(\"dom=%p\", dom);\n\n    virResetLastError();\n\n    virCheckDomainReturn(dom, -1);\n\n    if (dom->conn->driver->domainIsActive) {\n        int ret;\n        ret = dom->conn->driver->domainIsActive(dom);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n error:\n    virDispatchError(dom->conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainDestroy",
          "args": [
            "dom"
          ],
          "line": 82
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "460-487",
          "snippet": "int\nvirDomainDestroy(virDomainPtr domain)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    conn = domain->conn;\n\n    virCheckReadOnlyGoto(conn->flags, error);\n\n    if (conn->driver->domainDestroy) {\n        int ret;\n        ret = conn->driver->domainDestroy(domain);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(conn);\n    return -1;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nint\nvirDomainDestroy(virDomainPtr domain)\n{\n    virConnectPtr conn;\n\n    VIR_DOMAIN_DEBUG(domain);\n\n    virResetLastError();\n\n    virCheckDomainReturn(domain, -1);\n    conn = domain->conn;\n\n    virCheckReadOnlyGoto(conn->flags, error);\n\n    if (conn->driver->domainDestroy) {\n        int ret;\n        ret = conn->driver->domainDestroy(domain);\n        if (ret < 0)\n            goto error;\n        return ret;\n    }\n\n    virReportUnsupportedError();\n\n error:\n    virDispatchError(conn);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLookupByUUIDString",
          "args": [
            "conn",
            "uuid"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "virDomainLookupByUUIDString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-domain.c",
          "lines": "373-394",
          "snippet": "virDomainPtr\nvirDomainLookupByUUIDString(virConnectPtr conn, const char *uuidstr)\n{\n    unsigned char uuid[VIR_UUID_BUFLEN];\n    VIR_DEBUG(\"conn=%p, uuidstr=%s\", conn, NULLSTR(uuidstr));\n\n    virResetLastError();\n\n    virCheckConnectReturn(conn, NULL);\n    virCheckNonNullArgGoto(uuidstr, error);\n\n    if (virUUIDParse(uuidstr, uuid) < 0) {\n        virReportInvalidArg(uuidstr, \"%s\", _(\"Invalid UUID\"));\n        goto error;\n    }\n\n    return virDomainLookupByUUID(conn, &uuid[0]);\n\n error:\n    virDispatchError(conn);\n    return NULL;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nvirDomainPtr\nvirDomainLookupByUUIDString(virConnectPtr conn, const char *uuidstr)\n{\n    unsigned char uuid[VIR_UUID_BUFLEN];\n    VIR_DEBUG(\"conn=%p, uuidstr=%s\", conn, NULLSTR(uuidstr));\n\n    virResetLastError();\n\n    virCheckConnectReturn(conn, NULL);\n    virCheckNonNullArgGoto(uuidstr, error);\n\n    if (virUUIDParse(uuidstr, uuid) < 0) {\n        virReportInvalidArg(uuidstr, \"%s\", _(\"Invalid UUID\"));\n        goto error;\n    }\n\n    return virDomainLookupByUUID(conn, &uuid[0]);\n\n error:\n    virDispatchError(conn);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectOpenAuth",
          "args": [
            "uri",
            "&auth",
            "0"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "virConnectOpenAuth",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt.c",
          "lines": "1219-1239",
          "snippet": "virConnectPtr\nvirConnectOpenAuth(const char *name,\n                   virConnectAuthPtr auth,\n                   unsigned int flags)\n{\n    virConnectPtr ret = NULL;\n\n    if (virInitialize() < 0)\n        goto error;\n\n    VIR_DEBUG(\"name=%s, auth=%p, flags=0x%x\", NULLSTR(name), auth, flags);\n    virResetLastError();\n    ret = virConnectOpenInternal(name, auth, flags);\n    if (!ret)\n        goto error;\n    return ret;\n\n error:\n    virDispatchError(NULL);\n    return NULL;\n}",
          "includes": [
            "#include \"access/viraccessmanager.h\"",
            "# include \"bhyve/bhyve_driver.h\"",
            "# include \"hyperv/hyperv_driver.h\"",
            "# include \"esx/esx_driver.h\"",
            "# include \"vmware/vmware_driver.h\"",
            "# include \"openvz/openvz_driver.h\"",
            "# include \"remote/remote_driver.h\"",
            "# include \"test/test_driver.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"viruri.h\"",
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"virevent.h\"",
            "#include \"vircommand.h\"",
            "#include \"rpc/virnettlscontext.h\"",
            "#include \"virconf.h\"",
            "#include \"configmake.h\"",
            "#include \"viralloc.h\"",
            "#include \"viruuid.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <curl/curl.h>",
            "#include <libxml/xpath.h>",
            "#include <libxml/parser.h>",
            "#include <gio/gnetworking.h>",
            "#include <time.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"access/viraccessmanager.h\"\n# include \"bhyve/bhyve_driver.h\"\n# include \"hyperv/hyperv_driver.h\"\n# include \"esx/esx_driver.h\"\n# include \"vmware/vmware_driver.h\"\n# include \"openvz/openvz_driver.h\"\n# include \"remote/remote_driver.h\"\n# include \"test/test_driver.h\"\n#include \"virtypedparam.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"viruri.h\"\n#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"virevent.h\"\n#include \"vircommand.h\"\n#include \"rpc/virnettlscontext.h\"\n#include \"virconf.h\"\n#include \"configmake.h\"\n#include \"viralloc.h\"\n#include \"viruuid.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <curl/curl.h>\n#include <libxml/xpath.h>\n#include <libxml/parser.h>\n#include <gio/gnetworking.h>\n#include <time.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nvirConnectPtr\nvirConnectOpenAuth(const char *name,\n                   virConnectAuthPtr auth,\n                   unsigned int flags)\n{\n    virConnectPtr ret = NULL;\n\n    if (virInitialize() < 0)\n        goto error;\n\n    VIR_DEBUG(\"name=%s, auth=%p, flags=0x%x\", NULLSTR(name), auth, flags);\n    virResetLastError();\n    ret = virConnectOpenInternal(name, auth, flags);\n    if (!ret)\n        goto error;\n    return ret;\n\n error:\n    virDispatchError(NULL);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getArgs",
          "args": [
            "argc",
            "argv",
            "&uri",
            "&uuid",
            "&action"
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "getArgs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/sanlock_helper.c",
          "lines": "10-35",
          "snippet": "static int\ngetArgs(int argc,\n        char **argv,\n        const char **uri,\n        const char **uuid,\n        virDomainLockFailureAction *action)\n{\n    int act;\n\n    if (argc != 4) {\n        fprintf(stderr, _(\"%s uri uuid action\\n\"), argv[0]);\n        return -1;\n    }\n\n    *uri = argv[1];\n    *uuid = argv[2];\n\n    act = virDomainLockFailureTypeFromString(argv[3]);\n    if (act < 0) {\n        fprintf(stderr, _(\"invalid failure action: '%s'\\n\"), argv[3]);\n        return -1;\n    }\n    *action = act;\n\n    return 0;\n}",
          "includes": [
            "#include \"virgettext.h\"",
            "#include \"domain_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virconf.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virgettext.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int\ngetArgs(int argc,\n        char **argv,\n        const char **uri,\n        const char **uuid,\n        virDomainLockFailureAction *action)\n{\n    int act;\n\n    if (argc != 4) {\n        fprintf(stderr, _(\"%s uri uuid action\\n\"), argv[0]);\n        return -1;\n    }\n\n    *uri = argv[1];\n    *uuid = argv[2];\n\n    act = virDomainLockFailureTypeFromString(argv[3]);\n    if (act < 0) {\n        fprintf(stderr, _(\"invalid failure action: '%s'\\n\"), argv[3]);\n        return -1;\n    }\n    *action = act;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGettextInitialize",
          "args": [],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "virGettextInitialize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virgettext.c",
          "lines": "39-59",
          "snippet": "int\nvirGettextInitialize(void)\n{\n#if HAVE_LIBINTL_H\n    if (!setlocale(LC_ALL, \"\")) {\n        perror(\"setlocale\");\n        /* failure to setup locale is not fatal */\n    }\n\n    if (!bindtextdomain(PACKAGE, LOCALEDIR)) {\n        perror(\"bindtextdomain\");\n        return -1;\n    }\n\n    if (!textdomain(PACKAGE)) {\n        perror(\"textdomain\");\n        return -1;\n    }\n#endif /* HAVE_LIBINTL_H */\n    return 0;\n}",
          "includes": [
            "#include \"virgettext.h\"",
            "#include \"internal.h\"",
            "#include \"configmake.h\"",
            "# include <xlocale.h>",
            "#include <locale.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virgettext.h\"\n#include \"internal.h\"\n#include \"configmake.h\"\n# include <xlocale.h>\n#include <locale.h>\n#include <config.h>\n\nint\nvirGettextInitialize(void)\n{\n#if HAVE_LIBINTL_H\n    if (!setlocale(LC_ALL, \"\")) {\n        perror(\"setlocale\");\n        /* failure to setup locale is not fatal */\n    }\n\n    if (!bindtextdomain(PACKAGE, LOCALEDIR)) {\n        perror(\"bindtextdomain\");\n        return -1;\n    }\n\n    if (!textdomain(PACKAGE)) {\n        perror(\"textdomain\");\n        return -1;\n    }\n#endif /* HAVE_LIBINTL_H */\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "G_N_ELEMENTS",
          "args": [
            "authTypes"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virgettext.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"internal.h\"\n#include <config.h>\n\nint\nmain(int argc, char **argv)\n{\n    const char *uri;\n    const char *uuid;\n    virDomainLockFailureAction action;\n    char *xml = NULL;\n    virConnectPtr conn = NULL;\n    virDomainPtr dom = NULL;\n    int ret = EXIT_FAILURE;\n\n    int authTypes[] = {\n        VIR_CRED_AUTHNAME,\n        VIR_CRED_ECHOPROMPT,\n        VIR_CRED_PASSPHRASE,\n        VIR_CRED_NOECHOPROMPT,\n    };\n    virConnectAuth auth = {\n        .credtype = authTypes,\n        .ncredtype = G_N_ELEMENTS(authTypes),\n        .cb = authCallback,\n    };\n\n    if (virGettextInitialize() < 0)\n        exit(EXIT_FAILURE);\n\n    if (getArgs(argc, argv, &uri, &uuid, &action) < 0)\n        goto cleanup;\n\n    if (!(conn = virConnectOpenAuth(uri, &auth, 0)) ||\n        !(dom = virDomainLookupByUUIDString(conn, uuid)))\n        goto cleanup;\n\n    switch (action) {\n    case VIR_DOMAIN_LOCK_FAILURE_POWEROFF:\n        if (virDomainDestroy(dom) == 0 ||\n            virDomainIsActive(dom) == 0)\n            ret = EXIT_SUCCESS;\n        break;\n\n    case VIR_DOMAIN_LOCK_FAILURE_PAUSE:\n        if (virDomainSuspend(dom) == 0)\n            ret = EXIT_SUCCESS;\n        break;\n\n    case VIR_DOMAIN_LOCK_FAILURE_DEFAULT:\n    case VIR_DOMAIN_LOCK_FAILURE_RESTART:\n    case VIR_DOMAIN_LOCK_FAILURE_IGNORE:\n    case VIR_DOMAIN_LOCK_FAILURE_LAST:\n        fprintf(stderr, _(\"unsupported failure action: '%s'\\n\"),\n                virDomainLockFailureTypeToString(action));\n        break;\n    }\n\n cleanup:\n    virObjectUnref(dom);\n    if (conn)\n        virConnectClose(conn);\n    VIR_FREE(xml);\n\n    return ret;\n}"
  },
  {
    "function_name": "authCallback",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/sanlock_helper.c",
    "lines": "38-44",
    "snippet": "static int\nauthCallback(virConnectCredentialPtr cred G_GNUC_UNUSED,\n             unsigned int ncred G_GNUC_UNUSED,\n             void *cbdata G_GNUC_UNUSED)\n{\n    return -1;\n}",
    "includes": [
      "#include \"virgettext.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virconf.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virgettext.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int\nauthCallback(virConnectCredentialPtr cred G_GNUC_UNUSED,\n             unsigned int ncred G_GNUC_UNUSED,\n             void *cbdata G_GNUC_UNUSED)\n{\n    return -1;\n}"
  },
  {
    "function_name": "getArgs",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/sanlock_helper.c",
    "lines": "10-35",
    "snippet": "static int\ngetArgs(int argc,\n        char **argv,\n        const char **uri,\n        const char **uuid,\n        virDomainLockFailureAction *action)\n{\n    int act;\n\n    if (argc != 4) {\n        fprintf(stderr, _(\"%s uri uuid action\\n\"), argv[0]);\n        return -1;\n    }\n\n    *uri = argv[1];\n    *uuid = argv[2];\n\n    act = virDomainLockFailureTypeFromString(argv[3]);\n    if (act < 0) {\n        fprintf(stderr, _(\"invalid failure action: '%s'\\n\"), argv[3]);\n        return -1;\n    }\n    *action = act;\n\n    return 0;\n}",
    "includes": [
      "#include \"virgettext.h\"",
      "#include \"domain_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virconf.h\"",
      "#include \"internal.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"invalid failure action: '%s'\\n\")",
            "argv[3]"
          ],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"invalid failure action: '%s'\\n\""
          ],
          "line": 29
        },
        "resolved": true,
        "details": {
          "function_name": "ATTRIBUTE_NONNULL",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/locking/lock_driver_sanlock.c",
          "lines": "97-111",
          "snippet": "static bool\nATTRIBUTE_NONNULL(2)\nvirLockManagerSanlockError(int err,\n                           char **message)\n{\n    if (err <= -200) {\n#if HAVE_SANLOCK_STRERROR\n        *message = g_strdup(sanlock_strerror(err));\n#else\n        *message = g_strdup_printf(_(\"sanlock error %d\"), err);\n#endif\n        return true;\n    } else {\n        return false;\n    }",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virconf.h\"",
            "#include \"virfile.h\"",
            "#include \"vircrypto.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"lock_driver.h\"",
            "#include <sanlock_admin.h>",
            "#include <sanlock_resource.h>",
            "#include <sanlock.h>",
            "#include <fcntl.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include <stdint.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virconf.h\"\n#include \"virfile.h\"\n#include \"vircrypto.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"lock_driver.h\"\n#include <sanlock_admin.h>\n#include <sanlock_resource.h>\n#include <sanlock.h>\n#include <fcntl.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <unistd.h>\n#include <stdint.h>\n#include <config.h>\n\nstatic bool\nATTRIBUTE_NONNULL(2)\nvirLockManagerSanlockError(int err,\n                           char **message)\n{\n    if (err <= -200) {\n#if HAVE_SANLOCK_STRERROR\n        *message = g_strdup(sanlock_strerror(err));\n#else\n        *message = g_strdup_printf(_(\"sanlock error %d\"), err);\n#endif\n        return true;\n    } else {\n        return false;\n    }"
        }
      },
      {
        "call_info": {
          "callee": "virDomainLockFailureTypeFromString",
          "args": [
            "argv[3]"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "_(\"%s uri uuid action\\n\")",
            "argv[0]"
          ],
          "line": 20
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virgettext.h\"\n#include \"domain_conf.h\"\n#include \"viralloc.h\"\n#include \"virconf.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic int\ngetArgs(int argc,\n        char **argv,\n        const char **uri,\n        const char **uuid,\n        virDomainLockFailureAction *action)\n{\n    int act;\n\n    if (argc != 4) {\n        fprintf(stderr, _(\"%s uri uuid action\\n\"), argv[0]);\n        return -1;\n    }\n\n    *uri = argv[1];\n    *uuid = argv[2];\n\n    act = virDomainLockFailureTypeFromString(argv[3]);\n    if (act < 0) {\n        fprintf(stderr, _(\"invalid failure action: '%s'\\n\"), argv[3]);\n        return -1;\n    }\n    *action = act;\n\n    return 0;\n}"
  }
]