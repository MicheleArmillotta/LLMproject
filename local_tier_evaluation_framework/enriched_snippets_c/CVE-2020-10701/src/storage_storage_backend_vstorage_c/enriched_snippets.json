[
  {
    "function_name": "virStorageBackendVstorageRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_vstorage.c",
    "lines": "175-179",
    "snippet": "int\nvirStorageBackendVstorageRegister(void)\n{\n    return virStorageBackendRegister(&virStorageBackendVstorage);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include <grp.h>",
      "#include <pwd.h>",
      "#include <paths.h>",
      "#include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"storage_backend_vstorage.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virStorageBackend virStorageBackendVstorage = {\n    .type = VIR_STORAGE_POOL_VSTORAGE,\n\n    .buildPool = virStorageBackendVzPoolBuild,\n    .startPool = virStorageBackendVzPoolStart,\n    .stopPool = virStorageBackendVzPoolStop,\n    .deletePool = virStorageBackendDeleteLocal,\n    .refreshPool = virStorageBackendRefreshLocal,\n    .checkPool = virStorageBackendVzCheck,\n    .buildVol = virStorageBackendVolBuildLocal,\n    .buildVolFrom = virStorageBackendVolBuildFromLocal,\n    .createVol = virStorageBackendVolCreateLocal,\n    .refreshVol = virStorageBackendVolRefreshLocal,\n    .deleteVol = virStorageBackendVolDeleteLocal,\n    .resizeVol = virStorageBackendVolResizeLocal,\n    .uploadVol = virStorageBackendVolUploadLocal,\n    .downloadVol = virStorageBackendVolDownloadLocal,\n    .wipeVol = virStorageBackendVolWipeLocal,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendRegister",
          "args": [
            "&virStorageBackendVstorage"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend.c",
          "lines": "153-169",
          "snippet": "int\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}",
          "includes": [
            "# include \"storage_backend_vstorage.h\"",
            "# include \"storage_backend_zfs.h\"",
            "# include \"storage_backend_gluster.h\"",
            "# include \"storage_backend_sheepdog.h\"",
            "# include \"storage_backend_rbd.h\"",
            "# include \"storage_backend_fs.h\"",
            "# include \"storage_backend_disk.h\"",
            "# include \"storage_backend_mpath.h\"",
            "# include \"storage_backend_scsi.h\"",
            "# include \"storage_backend_iscsi_direct.h\"",
            "# include \"storage_backend_iscsi.h\"",
            "# include \"storage_backend_logical.h\"",
            "#include \"configmake.h\"",
            "#include \"virfile.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define VIR_STORAGE_BACKENDS_MAX 20"
          ],
          "globals_used": [
            "static virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];",
            "static size_t virStorageBackendsCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "# include \"storage_backend_vstorage.h\"\n# include \"storage_backend_zfs.h\"\n# include \"storage_backend_gluster.h\"\n# include \"storage_backend_sheepdog.h\"\n# include \"storage_backend_rbd.h\"\n# include \"storage_backend_fs.h\"\n# include \"storage_backend_disk.h\"\n# include \"storage_backend_mpath.h\"\n# include \"storage_backend_scsi.h\"\n# include \"storage_backend_iscsi_direct.h\"\n# include \"storage_backend_iscsi.h\"\n# include \"storage_backend_logical.h\"\n#include \"configmake.h\"\n#include \"virfile.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"storage_backend.h\"\n#include \"virstoragefile.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\n#define VIR_STORAGE_BACKENDS_MAX 20\n\nstatic virStorageBackendPtr virStorageBackends[VIR_STORAGE_BACKENDS_MAX];\nstatic size_t virStorageBackendsCount;\n\nint\nvirStorageBackendRegister(virStorageBackendPtr backend)\n{\n    VIR_DEBUG(\"Registering storage backend '%s'\",\n              virStoragePoolTypeToString(backend->type));\n\n    if (virStorageBackendsCount >= VIR_STORAGE_BACKENDS_MAX) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register storage backend '%s'\"),\n                       virStoragePoolTypeToString(backend->type));\n        return -1;\n    }\n\n    virStorageBackends[virStorageBackendsCount] = backend;\n    virStorageBackendsCount++;\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <paths.h>\n#include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"storage_backend_vstorage.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nvirStorageBackend virStorageBackendVstorage = {\n    .type = VIR_STORAGE_POOL_VSTORAGE,\n\n    .buildPool = virStorageBackendVzPoolBuild,\n    .startPool = virStorageBackendVzPoolStart,\n    .stopPool = virStorageBackendVzPoolStop,\n    .deletePool = virStorageBackendDeleteLocal,\n    .refreshPool = virStorageBackendRefreshLocal,\n    .checkPool = virStorageBackendVzCheck,\n    .buildVol = virStorageBackendVolBuildLocal,\n    .buildVolFrom = virStorageBackendVolBuildFromLocal,\n    .createVol = virStorageBackendVolCreateLocal,\n    .refreshVol = virStorageBackendVolRefreshLocal,\n    .deleteVol = virStorageBackendVolDeleteLocal,\n    .resizeVol = virStorageBackendVolResizeLocal,\n    .uploadVol = virStorageBackendVolUploadLocal,\n    .downloadVol = virStorageBackendVolDownloadLocal,\n    .wipeVol = virStorageBackendVolWipeLocal,\n};\n\nint\nvirStorageBackendVstorageRegister(void)\n{\n    return virStorageBackendRegister(&virStorageBackendVstorage);\n}"
  },
  {
    "function_name": "virStorageBackendVzCheck",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_vstorage.c",
    "lines": "138-151",
    "snippet": "static int\nvirStorageBackendVzCheck(virStoragePoolObjPtr pool,\n                         bool *isActive)\n{\n    int ret = -1;\n    *isActive = false;\n    if ((ret = virStorageBackendVzIsMounted(pool)) != 0) {\n        if (ret < 0)\n            return -1;\n        *isActive = true;\n    }\n\n    return 0;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include <grp.h>",
      "#include <pwd.h>",
      "#include <paths.h>",
      "#include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"storage_backend_vstorage.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendVzIsMounted",
          "args": [
            "pool"
          ],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendVzIsMounted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_vstorage.c",
          "lines": "83-116",
          "snippet": "static int\nvirStorageBackendVzIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    g_autofree char *cluster = NULL;\n\n    cluster = g_strdup_printf(\"vstorage://%s\", def->source.name);\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n\n        if (STREQ(ent.mnt_dir, def->target.path) &&\n            STREQ(ent.mnt_fsname, cluster)) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include <grp.h>",
            "#include <pwd.h>",
            "#include <paths.h>",
            "#include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend_vstorage.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <paths.h>\n#include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"storage_backend_vstorage.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirStorageBackendVzIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    g_autofree char *cluster = NULL;\n\n    cluster = g_strdup_printf(\"vstorage://%s\", def->source.name);\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n\n        if (STREQ(ent.mnt_dir, def->target.path) &&\n            STREQ(ent.mnt_fsname, cluster)) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <paths.h>\n#include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"storage_backend_vstorage.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirStorageBackendVzCheck(virStoragePoolObjPtr pool,\n                         bool *isActive)\n{\n    int ret = -1;\n    *isActive = false;\n    if ((ret = virStorageBackendVzIsMounted(pool)) != 0) {\n        if (ret < 0)\n            return -1;\n        *isActive = true;\n    }\n\n    return 0;\n}"
  },
  {
    "function_name": "virStorageBackendVzPoolStop",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_vstorage.c",
    "lines": "119-132",
    "snippet": "static int\nvirStorageBackendVzPoolStop(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc;\n    g_autoptr(virCommand) cmd = NULL;\n\n    /* Short-circuit if already unmounted */\n    if ((rc = virStorageBackendVzIsMounted(pool)) != 1)\n        return rc;\n\n    cmd = virCommandNewArgList(UMOUNT, def->target.path, NULL);\n    return virCommandRun(cmd, NULL);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include <grp.h>",
      "#include <pwd.h>",
      "#include <paths.h>",
      "#include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"storage_backend_vstorage.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "UMOUNT",
            "def->target.path",
            "NULL"
          ],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStorageBackendVzIsMounted",
          "args": [
            "pool"
          ],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendVzIsMounted",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_vstorage.c",
          "lines": "83-116",
          "snippet": "static int\nvirStorageBackendVzIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    g_autofree char *cluster = NULL;\n\n    cluster = g_strdup_printf(\"vstorage://%s\", def->source.name);\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n\n        if (STREQ(ent.mnt_dir, def->target.path) &&\n            STREQ(ent.mnt_fsname, cluster)) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}",
          "includes": [
            "#include \"storage_util.h\"",
            "#include <grp.h>",
            "#include <pwd.h>",
            "#include <paths.h>",
            "#include <mntent.h>",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_backend_vstorage.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"storage_util.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <paths.h>\n#include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"storage_backend_vstorage.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirStorageBackendVzIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    g_autofree char *cluster = NULL;\n\n    cluster = g_strdup_printf(\"vstorage://%s\", def->source.name);\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n\n        if (STREQ(ent.mnt_dir, def->target.path) &&\n            STREQ(ent.mnt_fsname, cluster)) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <paths.h>\n#include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"storage_backend_vstorage.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirStorageBackendVzPoolStop(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    int rc;\n    g_autoptr(virCommand) cmd = NULL;\n\n    /* Short-circuit if already unmounted */\n    if ((rc = virStorageBackendVzIsMounted(pool)) != 1)\n        return rc;\n\n    cmd = virCommandNewArgList(UMOUNT, def->target.path, NULL);\n    return virCommandRun(cmd, NULL);\n}"
  },
  {
    "function_name": "virStorageBackendVzIsMounted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_vstorage.c",
    "lines": "83-116",
    "snippet": "static int\nvirStorageBackendVzIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    g_autofree char *cluster = NULL;\n\n    cluster = g_strdup_printf(\"vstorage://%s\", def->source.name);\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n\n        if (STREQ(ent.mnt_dir, def->target.path) &&\n            STREQ(ent.mnt_fsname, cluster)) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include <grp.h>",
      "#include <pwd.h>",
      "#include <paths.h>",
      "#include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"storage_backend_vstorage.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "mtab"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "ent.mnt_fsname",
            "cluster"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STREQ",
          "args": [
            "ent.mnt_dir",
            "def->target.path"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getmntent_r",
          "args": [
            "mtab",
            "&ent",
            "buf",
            "sizeof(buf)"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot read mount list '%s'\")",
            "_PATH_MOUNTED"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot read mount list '%s'\""
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "_PATH_MOUNTED",
            "\"r\""
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 87
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <paths.h>\n#include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"storage_backend_vstorage.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirStorageBackendVzIsMounted(virStoragePoolObjPtr pool)\n{\n    int ret = -1;\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    FILE *mtab;\n    struct mntent ent;\n    char buf[1024];\n    g_autofree char *cluster = NULL;\n\n    cluster = g_strdup_printf(\"vstorage://%s\", def->source.name);\n\n    if ((mtab = fopen(_PATH_MOUNTED, \"r\")) == NULL) {\n        virReportSystemError(errno,\n                             _(\"cannot read mount list '%s'\"),\n                             _PATH_MOUNTED);\n        goto cleanup;\n    }\n\n    while ((getmntent_r(mtab, &ent, buf, sizeof(buf))) != NULL) {\n\n        if (STREQ(ent.mnt_dir, def->target.path) &&\n            STREQ(ent.mnt_fsname, cluster)) {\n            ret = 1;\n            goto cleanup;\n        }\n    }\n\n    ret = 0;\n\n cleanup:\n    VIR_FORCE_FCLOSE(mtab);\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendVzPoolStart",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_vstorage.c",
    "lines": "38-80",
    "snippet": "static int\nvirStorageBackendVzPoolStart(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autofree char *grp_name = NULL;\n    g_autofree char *usr_name = NULL;\n    g_autofree char *mode = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n    int ret;\n\n    /* Check the permissions */\n    if (def->target.perms.mode == (mode_t)-1)\n        def->target.perms.mode = VIR_STORAGE_DEFAULT_POOL_PERM_MODE;\n    if (def->target.perms.uid == (uid_t)-1)\n        def->target.perms.uid = geteuid();\n    if (def->target.perms.gid == (gid_t)-1)\n        def->target.perms.gid = getegid();\n\n    /* Convert ids to names because vstorage uses names */\n\n    if (!(grp_name = virGetGroupName(def->target.perms.gid)))\n        return -1;\n\n    if (!(usr_name = virGetUserName(def->target.perms.uid)))\n        return -1;\n\n    mode = g_strdup_printf(\"%o\", def->target.perms.mode);\n\n    cmd = virCommandNewArgList(VSTORAGE_MOUNT,\n                               \"-c\", def->source.name,\n                               def->target.path,\n                               \"-m\", mode,\n                               \"-g\", grp_name, \"-u\", usr_name,\n                               NULL);\n\n    /* Mounting a shared FS might take a long time. Don't hold\n     * the pool locked meanwhile. */\n    virObjectUnlock(pool);\n    ret = virCommandRun(cmd, NULL);\n    virObjectLock(pool);\n\n    return ret;\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include <grp.h>",
      "#include <pwd.h>",
      "#include <paths.h>",
      "#include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"storage_backend_vstorage.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectLock",
          "args": [
            "pool"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "424-433",
          "snippet": "void\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectLock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexLock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandRun",
          "args": [
            "cmd",
            "NULL"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandRunAsync",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "2931-2937",
          "snippet": "int\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nint\nvirCommandRunAsync(virCommandPtr cmd G_GNUC_UNUSED, pid_t *pid G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\",\n                         _(\"Executing new processes is not supported on Win32 platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnlock",
          "args": [
            "pool"
          ],
          "line": 75
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "501-510",
          "snippet": "void\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nvoid\nvirObjectUnlock(void *anyobj)\n{\n    virObjectLockablePtr obj = virObjectGetLockableObj(anyobj);\n\n    if (!obj)\n        return;\n\n    virMutexUnlock(&obj->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCommandNewArgList",
          "args": [
            "VSTORAGE_MOUNT",
            "\"-c\"",
            "def->source.name",
            "def->target.path",
            "\"-m\"",
            "mode",
            "\"-g\"",
            "grp_name",
            "\"-u\"",
            "usr_name",
            "NULL"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "virCommandNewArgList",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/vircommand.c",
          "lines": "969-980",
          "snippet": "virCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virprocess.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommandpriv.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/apparmor.h>",
            "# include <selinux/selinux.h>",
            "# include <cap-ng.h>",
            "#include <unistd.h>",
            "#include <fcntl.h>",
            "# include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "# include <poll.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"virbuffer.h\"\n#include \"virprocess.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"virerror.h\"\n#include \"vircommandpriv.h\"\n#include \"viralloc.h\"\n# include <sys/apparmor.h>\n# include <selinux/selinux.h>\n# include <cap-ng.h>\n#include <unistd.h>\n#include <fcntl.h>\n# include <sys/wait.h>\n#include <sys/stat.h>\n#include <stdarg.h>\n#include <signal.h>\n# include <poll.h>\n#include <config.h>\n\nvirCommandPtr\nvirCommandNewArgList(const char *binary, ...)\n{\n    virCommandPtr cmd;\n    va_list list;\n\n    va_start(list, binary);\n    cmd = virCommandNewVAList(binary, list);\n    va_end(list);\n\n    return cmd;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%o\"",
            "def->target.perms.mode"
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetUserName",
          "args": [
            "def->target.perms.uid"
          ],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "virGetUserName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1119-1126",
          "snippet": "char *\nvirGetUserName(uid_t uid G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virGetUserName is not available\"));\n\n    return NULL;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *\nvirGetUserName(uid_t uid G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virGetUserName is not available\"));\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetGroupName",
          "args": [
            "def->target.perms.gid"
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "virGetGroupName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1158-1165",
          "snippet": "char *\nvirGetGroupName(gid_t gid G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virGetGroupName is not available\"));\n\n    return NULL;\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *\nvirGetGroupName(gid_t gid G_GNUC_UNUSED)\n{\n    virReportError(VIR_ERR_INTERNAL_ERROR,\n                   \"%s\", _(\"virGetGroupName is not available\"));\n\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "getegid",
          "args": [],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "getegid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.h",
          "lines": "78-79",
          "snippet": "static inline int getegid(void)\n{ return 0; }",
          "includes": [
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <unistd.h>\n#include \"internal.h\"\n\nstatic inline int getegid(void)\n{ return 0; }"
        }
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "geteuid",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.h",
          "lines": "68-69",
          "snippet": "static inline int geteuid(void)\n{ return 0; }",
          "includes": [
            "#include <sys/types.h>",
            "#include <unistd.h>",
            "#include \"internal.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <unistd.h>\n#include \"internal.h\"\n\nstatic inline int geteuid(void)\n{ return 0; }"
        }
      },
      {
        "call_info": {
          "callee": "virStoragePoolObjGetDef",
          "args": [
            "pool"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "virStoragePoolObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virstorageobj.c",
          "lines": "246-250",
          "snippet": "virStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virstorageobj.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virstorageobj.h\"\n#include \"node_device_util.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <dirent.h>\n#include <config.h>\n\nvirStoragePoolDefPtr\nvirStoragePoolObjGetDef(virStoragePoolObjPtr obj)\n{\n    return obj->def;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <paths.h>\n#include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"storage_backend_vstorage.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirStorageBackendVzPoolStart(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    g_autofree char *grp_name = NULL;\n    g_autofree char *usr_name = NULL;\n    g_autofree char *mode = NULL;\n    g_autoptr(virCommand) cmd = NULL;\n    int ret;\n\n    /* Check the permissions */\n    if (def->target.perms.mode == (mode_t)-1)\n        def->target.perms.mode = VIR_STORAGE_DEFAULT_POOL_PERM_MODE;\n    if (def->target.perms.uid == (uid_t)-1)\n        def->target.perms.uid = geteuid();\n    if (def->target.perms.gid == (gid_t)-1)\n        def->target.perms.gid = getegid();\n\n    /* Convert ids to names because vstorage uses names */\n\n    if (!(grp_name = virGetGroupName(def->target.perms.gid)))\n        return -1;\n\n    if (!(usr_name = virGetUserName(def->target.perms.uid)))\n        return -1;\n\n    mode = g_strdup_printf(\"%o\", def->target.perms.mode);\n\n    cmd = virCommandNewArgList(VSTORAGE_MOUNT,\n                               \"-c\", def->source.name,\n                               def->target.path,\n                               \"-m\", mode,\n                               \"-g\", grp_name, \"-u\", usr_name,\n                               NULL);\n\n    /* Mounting a shared FS might take a long time. Don't hold\n     * the pool locked meanwhile. */\n    virObjectUnlock(pool);\n    ret = virCommandRun(cmd, NULL);\n    virObjectLock(pool);\n\n    return ret;\n}"
  },
  {
    "function_name": "virStorageBackendVzPoolBuild",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_backend_vstorage.c",
    "lines": "28-35",
    "snippet": "static int\nvirStorageBackendVzPoolBuild(virStoragePoolObjPtr pool,\n                             unsigned int flags)\n{\n    virCheckFlags(0, -1);\n\n    return virStorageBackendBuildLocal(pool);\n}",
    "includes": [
      "#include \"storage_util.h\"",
      "#include <grp.h>",
      "#include <pwd.h>",
      "#include <paths.h>",
      "#include <mntent.h>",
      "#include \"virstring.h\"",
      "#include \"virlog.h\"",
      "#include \"storage_backend_vstorage.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viralloc.h\"",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virStorageBackendBuildLocal",
          "args": [
            "pool"
          ],
          "line": 34
        },
        "resolved": true,
        "details": {
          "function_name": "virStorageBackendBuildLocal",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/storage/storage_util.c",
          "lines": "2727-2774",
          "snippet": "int\nvirStorageBackendBuildLocal(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    char *p = NULL;\n    mode_t mode;\n    bool needs_create_as_uid;\n    unsigned int dir_create_flags;\n    g_autofree char *parent = NULL;\n\n    parent = g_strdup(def->target.path);\n    if (!(p = strrchr(parent, '/'))) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"path '%s' is not absolute\"),\n                       def->target.path);\n        return -1;\n    }\n\n    if (p != parent) {\n        /* assure all directories in the path prior to the final dir\n         * exist, with default uid/gid/mode. */\n        *p = '\\0';\n        if (virFileMakePath(parent) < 0) {\n            virReportSystemError(errno, _(\"cannot create path '%s'\"),\n                                 parent);\n            return -1;\n        }\n    }\n\n    dir_create_flags = VIR_DIR_CREATE_ALLOW_EXIST;\n    needs_create_as_uid = (def->type == VIR_STORAGE_POOL_NETFS);\n    mode = def->target.perms.mode;\n\n    if (mode == (mode_t)-1 &&\n        (needs_create_as_uid || !virFileExists(def->target.path)))\n        mode = VIR_STORAGE_DEFAULT_POOL_PERM_MODE;\n    if (needs_create_as_uid)\n        dir_create_flags |= VIR_DIR_CREATE_AS_UID;\n\n    /* Now create the final dir in the path with the uid/gid/mode\n     * requested in the config. If the dir already exists, just set\n     * the perms. */\n    return virDirCreate(def->target.path,\n                        mode,\n                        def->target.perms.uid,\n                        def->target.perms.gid,\n                        dir_create_flags);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virfdstream.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virqemu.h\"",
            "#include \"virjson.h\"",
            "#include \"virfile.h\"",
            "#include \"virlog.h\"",
            "#include \"storage_util.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"viruuid.h\"",
            "#include \"vircrypto.h\"",
            "#include \"virsecret.h\"",
            "#include \"secret_conf.h\"",
            "#include \"internal.h\"",
            "#include \"viralloc.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "# include <xfs/xfs.h>",
            "# include <linux/btrfs.h>",
            "# include <selinux/selinux.h>",
            "# include <blkid.h>",
            "# include <linux/fs.h>",
            "# include <sys/ioctl.h>",
            "#include <dirent.h>",
            "#include <sys/param.h>",
            "#include <sys/statvfs.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virfdstream.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virqemu.h\"\n#include \"virjson.h\"\n#include \"virfile.h\"\n#include \"virlog.h\"\n#include \"storage_util.h\"\n#include \"virstoragefile.h\"\n#include \"viruuid.h\"\n#include \"vircrypto.h\"\n#include \"virsecret.h\"\n#include \"secret_conf.h\"\n#include \"internal.h\"\n#include \"viralloc.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n# include <xfs/xfs.h>\n# include <linux/btrfs.h>\n# include <selinux/selinux.h>\n# include <blkid.h>\n# include <linux/fs.h>\n# include <sys/ioctl.h>\n#include <dirent.h>\n#include <sys/param.h>\n#include <sys/statvfs.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sys/types.h>\n#include <config.h>\n\nint\nvirStorageBackendBuildLocal(virStoragePoolObjPtr pool)\n{\n    virStoragePoolDefPtr def = virStoragePoolObjGetDef(pool);\n    char *p = NULL;\n    mode_t mode;\n    bool needs_create_as_uid;\n    unsigned int dir_create_flags;\n    g_autofree char *parent = NULL;\n\n    parent = g_strdup(def->target.path);\n    if (!(p = strrchr(parent, '/'))) {\n        virReportError(VIR_ERR_INVALID_ARG,\n                       _(\"path '%s' is not absolute\"),\n                       def->target.path);\n        return -1;\n    }\n\n    if (p != parent) {\n        /* assure all directories in the path prior to the final dir\n         * exist, with default uid/gid/mode. */\n        *p = '\\0';\n        if (virFileMakePath(parent) < 0) {\n            virReportSystemError(errno, _(\"cannot create path '%s'\"),\n                                 parent);\n            return -1;\n        }\n    }\n\n    dir_create_flags = VIR_DIR_CREATE_ALLOW_EXIST;\n    needs_create_as_uid = (def->type == VIR_STORAGE_POOL_NETFS);\n    mode = def->target.perms.mode;\n\n    if (mode == (mode_t)-1 &&\n        (needs_create_as_uid || !virFileExists(def->target.path)))\n        mode = VIR_STORAGE_DEFAULT_POOL_PERM_MODE;\n    if (needs_create_as_uid)\n        dir_create_flags |= VIR_DIR_CREATE_AS_UID;\n\n    /* Now create the final dir in the path with the uid/gid/mode\n     * requested in the config. If the dir already exists, just set\n     * the perms. */\n    return virDirCreate(def->target.path,\n                        mode,\n                        def->target.perms.uid,\n                        def->target.perms.gid,\n                        dir_create_flags);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"storage_util.h\"\n#include <grp.h>\n#include <pwd.h>\n#include <paths.h>\n#include <mntent.h>\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"storage_backend_vstorage.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nstatic int\nvirStorageBackendVzPoolBuild(virStoragePoolObjPtr pool,\n                             unsigned int flags)\n{\n    virCheckFlags(0, -1);\n\n    return virStorageBackendBuildLocal(pool);\n}"
  }
]