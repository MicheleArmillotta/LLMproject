[
  {
    "function_name": "libxlLoggerCloseFile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libxl/libxl_logger.c",
    "lines": "216-225",
    "snippet": "void\nlibxlLoggerCloseFile(libxlLoggerPtr logger, int id)\n{\n    char *domidstr = NULL;\n    domidstr = g_strdup_printf(\"%d\", id);\n\n    ignore_value(virHashRemoveEntry(logger->files, domidstr));\n\n    VIR_FREE(domidstr);\n}",
    "includes": [
      "#include \"util/virtime.h\"",
      "#include \"util/virstring.h\"",
      "#include \"util/virhash.h\"",
      "#include \"util/virfile.h\"",
      "#include \"util/virerror.h\"",
      "#include \"util/viralloc.h\"",
      "#include \"libxl_logger.h\"",
      "#include \"internal.h\"",
      "#include <libxl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "domidstr"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virHashRemoveEntry(logger->files, domidstr)"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashRemoveEntry",
          "args": [
            "logger->files",
            "domidstr"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "virHashRemoveEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "584-609",
          "snippet": "int\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashRemoveEntry(virHashTablePtr table, const void *name)\n{\n    virHashEntryPtr entry;\n    virHashEntryPtr *nextptr;\n\n    if (table == NULL || name == NULL)\n        return -1;\n\n    nextptr = table->table + virHashComputeKey(table, name);\n    for (entry = *nextptr; entry; entry = entry->next) {\n        if (table->keyEqual(entry->name, name)) {\n            if (table->dataFree)\n                table->dataFree(entry->payload);\n            if (table->keyFree)\n                table->keyFree(entry->name);\n            *nextptr = entry->next;\n            VIR_FREE(entry);\n            table->nbElems--;\n            return 0;\n        }\n        nextptr = &entry->next;\n    }\n\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%d\"",
            "id"
          ],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/virtime.h\"\n#include \"util/virstring.h\"\n#include \"util/virhash.h\"\n#include \"util/virfile.h\"\n#include \"util/virerror.h\"\n#include \"util/viralloc.h\"\n#include \"libxl_logger.h\"\n#include \"internal.h\"\n#include <libxl.h>\n#include <config.h>\n\nvoid\nlibxlLoggerCloseFile(libxlLoggerPtr logger, int id)\n{\n    char *domidstr = NULL;\n    domidstr = g_strdup_printf(\"%d\", id);\n\n    ignore_value(virHashRemoveEntry(logger->files, domidstr));\n\n    VIR_FREE(domidstr);\n}"
  },
  {
    "function_name": "libxlLoggerOpenFile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libxl/libxl_logger.c",
    "lines": "185-214",
    "snippet": "void\nlibxlLoggerOpenFile(libxlLoggerPtr logger,\n                    int id,\n                    const char *name,\n                    const char *domain_config)\n{\n    char *path = NULL;\n    FILE *logFile = NULL;\n    char *domidstr = NULL;\n\n    path = g_strdup_printf(\"%s/%s.log\", logger->logDir, name);\n    domidstr = g_strdup_printf(\"%d\", id);\n\n    if (!(logFile = fopen(path, \"a\"))) {\n        VIR_WARN(\"Failed to open log file %s: %s\",\n                 path, g_strerror(errno));\n        goto cleanup;\n    }\n    ignore_value(virHashAddEntry(logger->files, domidstr, logFile));\n\n    /* domain_config is non NULL only when starting a new domain */\n    if (domain_config) {\n        fprintf(logFile, \"Domain start: %s\\n\", domain_config);\n        fflush(logFile);\n    }\n\n cleanup:\n    VIR_FREE(path);\n    VIR_FREE(domidstr);\n}",
    "includes": [
      "#include \"util/virtime.h\"",
      "#include \"util/virstring.h\"",
      "#include \"util/virhash.h\"",
      "#include \"util/virfile.h\"",
      "#include \"util/virerror.h\"",
      "#include \"util/viralloc.h\"",
      "#include \"libxl_logger.h\"",
      "#include \"internal.h\"",
      "#include <libxl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "domidstr"
          ],
          "line": 213
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "path"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "logFile"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "logFile",
            "\"Domain start: %s\\n\"",
            "domain_config"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virHashAddEntry(logger->files, domidstr, logFile)"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashAddEntry",
          "args": [
            "logger->files",
            "domidstr",
            "logFile"
          ],
          "line": 203
        },
        "resolved": true,
        "details": {
          "function_name": "virHashAddEntry",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "404-408",
          "snippet": "int\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nint\nvirHashAddEntry(virHashTablePtr table, const void *name, void *userdata)\n{\n    return virHashAddOrUpdateEntry(table, name, userdata, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_WARN",
          "args": [
            "\"Failed to open log file %s: %s\"",
            "path",
            "g_strerror(errno)"
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errno"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "path",
            "\"a\""
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%d\"",
            "id"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/virtime.h\"\n#include \"util/virstring.h\"\n#include \"util/virhash.h\"\n#include \"util/virfile.h\"\n#include \"util/virerror.h\"\n#include \"util/viralloc.h\"\n#include \"libxl_logger.h\"\n#include \"internal.h\"\n#include <libxl.h>\n#include <config.h>\n\nvoid\nlibxlLoggerOpenFile(libxlLoggerPtr logger,\n                    int id,\n                    const char *name,\n                    const char *domain_config)\n{\n    char *path = NULL;\n    FILE *logFile = NULL;\n    char *domidstr = NULL;\n\n    path = g_strdup_printf(\"%s/%s.log\", logger->logDir, name);\n    domidstr = g_strdup_printf(\"%d\", id);\n\n    if (!(logFile = fopen(path, \"a\"))) {\n        VIR_WARN(\"Failed to open log file %s: %s\",\n                 path, g_strerror(errno));\n        goto cleanup;\n    }\n    ignore_value(virHashAddEntry(logger->files, domidstr, logFile));\n\n    /* domain_config is non NULL only when starting a new domain */\n    if (domain_config) {\n        fprintf(logFile, \"Domain start: %s\\n\", domain_config);\n        fflush(logFile);\n    }\n\n cleanup:\n    VIR_FREE(path);\n    VIR_FREE(domidstr);\n}"
  },
  {
    "function_name": "libxlLoggerFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libxl/libxl_logger.c",
    "lines": "175-183",
    "snippet": "void\nlibxlLoggerFree(libxlLoggerPtr logger)\n{\n    xentoollog_logger *xtl_logger = (xentoollog_logger*)logger;\n    if (logger->defaultLogFile)\n        VIR_FORCE_FCLOSE(logger->defaultLogFile);\n    virHashFree(logger->files);\n    xtl_logger_destroy(xtl_logger);\n}",
    "includes": [
      "#include \"util/virtime.h\"",
      "#include \"util/virstring.h\"",
      "#include \"util/virhash.h\"",
      "#include \"util/virfile.h\"",
      "#include \"util/virerror.h\"",
      "#include \"util/viralloc.h\"",
      "#include \"libxl_logger.h\"",
      "#include \"internal.h\"",
      "#include <libxl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "xtl_logger_destroy",
          "args": [
            "xtl_logger"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virHashFree",
          "args": [
            "logger->files"
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "virHashFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "313-337",
          "snippet": "void\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "logger->defaultLogFile"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/virtime.h\"\n#include \"util/virstring.h\"\n#include \"util/virhash.h\"\n#include \"util/virfile.h\"\n#include \"util/virerror.h\"\n#include \"util/viralloc.h\"\n#include \"libxl_logger.h\"\n#include \"internal.h\"\n#include <libxl.h>\n#include <config.h>\n\nvoid\nlibxlLoggerFree(libxlLoggerPtr logger)\n{\n    xentoollog_logger *xtl_logger = (xentoollog_logger*)logger;\n    if (logger->defaultLogFile)\n        VIR_FORCE_FCLOSE(logger->defaultLogFile);\n    virHashFree(logger->files);\n    xtl_logger_destroy(xtl_logger);\n}"
  },
  {
    "function_name": "libxlLoggerNew",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libxl/libxl_logger.c",
    "lines": "133-173",
    "snippet": "libxlLoggerPtr\nlibxlLoggerNew(const char *logDir, virLogPriority minLevel)\n{\n    xentoollog_logger_libvirt logger;\n    libxlLoggerPtr logger_out = NULL;\n    char *path = NULL;\n\n    switch (minLevel) {\n    case VIR_LOG_DEBUG:\n        logger.minLevel = XTL_DEBUG;\n        break;\n    case VIR_LOG_INFO:\n        logger.minLevel = XTL_INFO;\n        break;\n    case VIR_LOG_WARN:\n        logger.minLevel = XTL_WARN;\n        break;\n    case VIR_LOG_ERROR:\n        logger.minLevel = XTL_ERROR;\n        break;\n    }\n    logger.logDir = logDir;\n\n    if ((logger.files = virHashCreate(3, libxlLoggerFileFree)) == NULL)\n        return NULL;\n\n    path = g_strdup_printf(\"%s/libxl-driver.log\", logDir);\n\n    if ((logger.defaultLogFile = fopen(path, \"a\")) == NULL)\n        goto error;\n\n    logger_out = XTL_NEW_LOGGER(libvirt, logger);\n\n cleanup:\n    VIR_FREE(path);\n    return logger_out;\n\n error:\n    virHashFree(logger.files);\n    goto cleanup;\n}",
    "includes": [
      "#include \"util/virtime.h\"",
      "#include \"util/virstring.h\"",
      "#include \"util/virhash.h\"",
      "#include \"util/virfile.h\"",
      "#include \"util/virerror.h\"",
      "#include \"util/viralloc.h\"",
      "#include \"libxl_logger.h\"",
      "#include \"internal.h\"",
      "#include <libxl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virHashFree",
          "args": [
            "logger.files"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "virHashFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "313-337",
          "snippet": "void\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid\nvirHashFree(virHashTablePtr table)\n{\n    size_t i;\n\n    if (table == NULL)\n        return;\n\n    for (i = 0; i < table->size; i++) {\n        virHashEntryPtr iter = table->table[i];\n        while (iter) {\n            virHashEntryPtr next = iter->next;\n\n            if (table->dataFree)\n                table->dataFree(iter->payload);\n            if (table->keyFree)\n                table->keyFree(iter->name);\n            VIR_FREE(iter);\n            iter = next;\n        }\n    }\n\n    VIR_FREE(table->table);\n    VIR_FREE(table);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "path"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "XTL_NEW_LOGGER",
          "args": [
            "libvirt",
            "logger"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "path",
            "\"a\""
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_printf",
          "args": [
            "\"%s/libxl-driver.log\"",
            "logDir"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashCreate",
          "args": [
            "3",
            "libxlLoggerFileFree"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "virHashCreate",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "202-211",
          "snippet": "virHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvirHashTablePtr virHashCreate(ssize_t size, virHashDataFree dataFree)\n{\n    return virHashCreateFull(size,\n                             dataFree,\n                             virHashStrCode,\n                             virHashStrEqual,\n                             virHashStrCopy,\n                             virHashStrPrintHuman,\n                             virHashStrFree);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/virtime.h\"\n#include \"util/virstring.h\"\n#include \"util/virhash.h\"\n#include \"util/virfile.h\"\n#include \"util/virerror.h\"\n#include \"util/viralloc.h\"\n#include \"libxl_logger.h\"\n#include \"internal.h\"\n#include <libxl.h>\n#include <config.h>\n\nlibxlLoggerPtr\nlibxlLoggerNew(const char *logDir, virLogPriority minLevel)\n{\n    xentoollog_logger_libvirt logger;\n    libxlLoggerPtr logger_out = NULL;\n    char *path = NULL;\n\n    switch (minLevel) {\n    case VIR_LOG_DEBUG:\n        logger.minLevel = XTL_DEBUG;\n        break;\n    case VIR_LOG_INFO:\n        logger.minLevel = XTL_INFO;\n        break;\n    case VIR_LOG_WARN:\n        logger.minLevel = XTL_WARN;\n        break;\n    case VIR_LOG_ERROR:\n        logger.minLevel = XTL_ERROR;\n        break;\n    }\n    logger.logDir = logDir;\n\n    if ((logger.files = virHashCreate(3, libxlLoggerFileFree)) == NULL)\n        return NULL;\n\n    path = g_strdup_printf(\"%s/libxl-driver.log\", logDir);\n\n    if ((logger.defaultLogFile = fopen(path, \"a\")) == NULL)\n        goto error;\n\n    logger_out = XTL_NEW_LOGGER(libvirt, logger);\n\n cleanup:\n    VIR_FREE(path);\n    return logger_out;\n\n error:\n    virHashFree(logger.files);\n    goto cleanup;\n}"
  },
  {
    "function_name": "libvirt_destroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libxl/libxl_logger.c",
    "lines": "125-130",
    "snippet": "static void\nlibvirt_destroy(xentoollog_logger *logger_in)\n{\n    xentoollog_logger_libvirt *lg = (xentoollog_logger_libvirt*)logger_in;\n    VIR_FREE(lg);\n}",
    "includes": [
      "#include \"util/virtime.h\"",
      "#include \"util/virstring.h\"",
      "#include \"util/virhash.h\"",
      "#include \"util/virfile.h\"",
      "#include \"util/virerror.h\"",
      "#include \"util/viralloc.h\"",
      "#include \"libxl_logger.h\"",
      "#include \"internal.h\"",
      "#include <libxl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "lg"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/virtime.h\"\n#include \"util/virstring.h\"\n#include \"util/virhash.h\"\n#include \"util/virfile.h\"\n#include \"util/virerror.h\"\n#include \"util/viralloc.h\"\n#include \"libxl_logger.h\"\n#include \"internal.h\"\n#include <libxl.h>\n#include <config.h>\n\nstatic void\nlibvirt_destroy(xentoollog_logger *logger_in)\n{\n    xentoollog_logger_libvirt *lg = (xentoollog_logger_libvirt*)logger_in;\n    VIR_FREE(lg);\n}"
  },
  {
    "function_name": "libvirt_progress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libxl/libxl_logger.c",
    "lines": "114-123",
    "snippet": "static void\nlibvirt_progress(xentoollog_logger *logger_in G_GNUC_UNUSED,\n                 const char *context G_GNUC_UNUSED,\n                 const char *doingwhat G_GNUC_UNUSED,\n                 int percent G_GNUC_UNUSED,\n                 unsigned long done G_GNUC_UNUSED,\n                 unsigned long total G_GNUC_UNUSED)\n{\n    /* This function purposedly does nothing: it's no logging info */\n}",
    "includes": [
      "#include \"util/virtime.h\"",
      "#include \"util/virstring.h\"",
      "#include \"util/virhash.h\"",
      "#include \"util/virfile.h\"",
      "#include \"util/virerror.h\"",
      "#include \"util/viralloc.h\"",
      "#include \"libxl_logger.h\"",
      "#include \"internal.h\"",
      "#include <libxl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/virtime.h\"\n#include \"util/virstring.h\"\n#include \"util/virhash.h\"\n#include \"util/virfile.h\"\n#include \"util/virerror.h\"\n#include \"util/viralloc.h\"\n#include \"libxl_logger.h\"\n#include \"internal.h\"\n#include <libxl.h>\n#include <config.h>\n\nstatic void\nlibvirt_progress(xentoollog_logger *logger_in G_GNUC_UNUSED,\n                 const char *context G_GNUC_UNUSED,\n                 const char *doingwhat G_GNUC_UNUSED,\n                 int percent G_GNUC_UNUSED,\n                 unsigned long done G_GNUC_UNUSED,\n                 unsigned long total G_GNUC_UNUSED)\n{\n    /* This function purposedly does nothing: it's no logging info */\n}"
  },
  {
    "function_name": "libvirt_vmessage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libxl/libxl_logger.c",
    "lines": "57-112",
    "snippet": "static void\nlibvirt_vmessage(xentoollog_logger *logger_in,\n                 xentoollog_level level,\n                 int errnoval,\n                 const char *context,\n                 const char *format,\n                 va_list args)\n{\n    xentoollog_logger_libvirt *lg = (xentoollog_logger_libvirt *)logger_in;\n    FILE *logFile = lg->defaultLogFile;\n    char timestamp[VIR_TIME_STRING_BUFLEN];\n    char *message = NULL;\n    char *start, *end;\n\n    VIR_DEBUG(\"libvirt_vmessage: context='%s' format='%s'\", context, format);\n\n    if (level < lg->minLevel)\n        return;\n\n    message = g_strdup_vprintf(format, args);\n\n    /* Should we print to a domain-specific log file? */\n    if ((start = strstr(message, \": Domain \")) &&\n        (end = strstr(start + 9, \":\"))) {\n        FILE *domainLogFile;\n\n        VIR_DEBUG(\"Found domain log message\");\n\n        start = start + 9;\n        *end = '\\0';\n\n        domainLogFile = virHashLookup(lg->files, start);\n        if (domainLogFile)\n            logFile = domainLogFile;\n\n        *end = ':';\n    }\n\n    /* Do the actual print to the log file */\n    if (virTimeStringNowRaw(timestamp) < 0)\n        timestamp[0] = '\\0';\n\n    fprintf(logFile, \"%s: \", timestamp);\n    if (context)\n        fprintf(logFile, \"%s: \", context);\n\n    fprintf(logFile, \"%s\", message);\n\n    if (errnoval >= 0)\n        fprintf(logFile, \": %s\", g_strerror(errnoval));\n\n    fputc('\\n', logFile);\n    fflush(logFile);\n\n    VIR_FREE(message);\n}",
    "includes": [
      "#include \"util/virtime.h\"",
      "#include \"util/virstring.h\"",
      "#include \"util/virhash.h\"",
      "#include \"util/virfile.h\"",
      "#include \"util/virerror.h\"",
      "#include \"util/viralloc.h\"",
      "#include \"libxl_logger.h\"",
      "#include \"internal.h\"",
      "#include <libxl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "message"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "logFile"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fputc",
          "args": [
            "'\\n'",
            "logFile"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "logFile",
            "\": %s\"",
            "g_strerror(errnoval)"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strerror",
          "args": [
            "errnoval"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "logFile",
            "\"%s\"",
            "message"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "logFile",
            "\"%s: \"",
            "context"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "logFile",
            "\"%s: \"",
            "timestamp"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virTimeStringNowRaw",
          "args": [
            "timestamp"
          ],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "virTimeStringNowRaw",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virtime.c",
          "lines": "162-170",
          "snippet": "int virTimeStringNowRaw(char *buf)\n{\n    unsigned long long now;\n\n    if (virTimeMillisNowRaw(&now) < 0)\n        return -1;\n\n    return virTimeStringThenRaw(now, buf);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virtime.h\"",
            "#include <sys/time.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virtime.h\"\n#include <sys/time.h>\n#include <unistd.h>\n#include <config.h>\n\nint virTimeStringNowRaw(char *buf)\n{\n    unsigned long long now;\n\n    if (virTimeMillisNowRaw(&now) < 0)\n        return -1;\n\n    return virTimeStringThenRaw(now, buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virHashLookup",
          "args": [
            "lg->files",
            "start"
          ],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "virHashLookup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virhash.c",
          "lines": "473-482",
          "snippet": "void *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}",
          "includes": [
            "#include \"virobject.h\"",
            "#include \"virstring.h\"",
            "#include \"virrandom.h\"",
            "#include \"virhashcode.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virobject.h\"\n#include \"virstring.h\"\n#include \"virrandom.h\"\n#include \"virhashcode.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include <config.h>\n\nvoid *\nvirHashLookup(const virHashTable *table, const void *name)\n{\n    virHashEntryPtr entry = virHashGetEntry(table, name);\n\n    if (!entry)\n        return NULL;\n\n    return entry->payload;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"Found domain log message\""
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "start + 9",
            "\":\""
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strstr",
          "args": [
            "message",
            "\": Domain \""
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "g_strdup_vprintf",
          "args": [
            "format",
            "args"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_vprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "205-213",
          "snippet": "char *\nvir_g_strdup_vprintf(const char *msg, va_list args)\n{\n    char *ret;\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_vprintf(const char *msg, va_list args)\n{\n    char *ret;\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_DEBUG",
          "args": [
            "\"libvirt_vmessage: context='%s' format='%s'\"",
            "context",
            "format"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/virtime.h\"\n#include \"util/virstring.h\"\n#include \"util/virhash.h\"\n#include \"util/virfile.h\"\n#include \"util/virerror.h\"\n#include \"util/viralloc.h\"\n#include \"libxl_logger.h\"\n#include \"internal.h\"\n#include <libxl.h>\n#include <config.h>\n\nstatic void\nlibvirt_vmessage(xentoollog_logger *logger_in,\n                 xentoollog_level level,\n                 int errnoval,\n                 const char *context,\n                 const char *format,\n                 va_list args)\n{\n    xentoollog_logger_libvirt *lg = (xentoollog_logger_libvirt *)logger_in;\n    FILE *logFile = lg->defaultLogFile;\n    char timestamp[VIR_TIME_STRING_BUFLEN];\n    char *message = NULL;\n    char *start, *end;\n\n    VIR_DEBUG(\"libvirt_vmessage: context='%s' format='%s'\", context, format);\n\n    if (level < lg->minLevel)\n        return;\n\n    message = g_strdup_vprintf(format, args);\n\n    /* Should we print to a domain-specific log file? */\n    if ((start = strstr(message, \": Domain \")) &&\n        (end = strstr(start + 9, \":\"))) {\n        FILE *domainLogFile;\n\n        VIR_DEBUG(\"Found domain log message\");\n\n        start = start + 9;\n        *end = '\\0';\n\n        domainLogFile = virHashLookup(lg->files, start);\n        if (domainLogFile)\n            logFile = domainLogFile;\n\n        *end = ':';\n    }\n\n    /* Do the actual print to the log file */\n    if (virTimeStringNowRaw(timestamp) < 0)\n        timestamp[0] = '\\0';\n\n    fprintf(logFile, \"%s: \", timestamp);\n    if (context)\n        fprintf(logFile, \"%s: \", context);\n\n    fprintf(logFile, \"%s\", message);\n\n    if (errnoval >= 0)\n        fprintf(logFile, \": %s\", g_strerror(errnoval));\n\n    fputc('\\n', logFile);\n    fflush(logFile);\n\n    VIR_FREE(message);\n}"
  },
  {
    "function_name": "libxlLoggerFileFree",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libxl/libxl_logger.c",
    "lines": "49-55",
    "snippet": "static void\nlibxlLoggerFileFree(void *payload)\n{\n    FILE *file = payload;\n    VIR_FORCE_FCLOSE(file);\n    file = NULL;\n}",
    "includes": [
      "#include \"util/virtime.h\"",
      "#include \"util/virstring.h\"",
      "#include \"util/virhash.h\"",
      "#include \"util/virfile.h\"",
      "#include \"util/virerror.h\"",
      "#include \"util/viralloc.h\"",
      "#include \"libxl_logger.h\"",
      "#include \"internal.h\"",
      "#include <libxl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FORCE_FCLOSE",
          "args": [
            "file"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/virtime.h\"\n#include \"util/virstring.h\"\n#include \"util/virhash.h\"\n#include \"util/virfile.h\"\n#include \"util/virerror.h\"\n#include \"util/viralloc.h\"\n#include \"libxl_logger.h\"\n#include \"internal.h\"\n#include <libxl.h>\n#include <config.h>\n\nstatic void\nlibxlLoggerFileFree(void *payload)\n{\n    FILE *file = payload;\n    VIR_FORCE_FCLOSE(file);\n    file = NULL;\n}"
  }
]