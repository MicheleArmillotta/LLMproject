[
  {
    "function_name": "secretRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "708-718",
    "snippet": "int\nsecretRegister(void)\n{\n    if (virRegisterConnectDriver(&secretConnectDriver, false) < 0)\n        return -1;\n    if (virSetSharedSecretDriver(&secretDriver) < 0)\n        return -1;\n    if (virRegisterStateDriver(&stateDriver) < 0)\n        return -1;\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriver secretDriver = {\n    .name = \"secret\",\n    .connectNumOfSecrets = secretConnectNumOfSecrets, /* 0.7.1 */\n    .connectListSecrets = secretConnectListSecrets, /* 0.7.1 */\n    .connectListAllSecrets = secretConnectListAllSecrets, /* 0.10.2 */\n    .secretLookupByUUID = secretLookupByUUID, /* 0.7.1 */\n    .secretLookupByUsage = secretLookupByUsage, /* 0.7.1 */\n    .secretDefineXML = secretDefineXML, /* 0.7.1 */\n    .secretGetXMLDesc = secretGetXMLDesc, /* 0.7.1 */\n    .secretSetValue = secretSetValue, /* 0.7.1 */\n    .secretGetValue = secretGetValue, /* 0.7.1 */\n    .secretUndefine = secretUndefine, /* 0.7.1 */\n    .connectSecretEventRegisterAny = secretConnectSecretEventRegisterAny, /* 3.0.0 */\n    .connectSecretEventDeregisterAny = secretConnectSecretEventDeregisterAny, /* 3.0.0 */\n};",
      "static virConnectDriver secretConnectDriver = {\n    .localOnly = true,\n    .uriSchemes = (const char *[]){ \"secret\", NULL },\n    .embeddable = true,\n    .hypervisorDriver = &secretHypervisorDriver,\n    .secretDriver = &secretDriver,\n};",
      "static virStateDriver stateDriver = {\n    .name = \"secret\",\n    .stateInitialize = secretStateInitialize,\n    .stateCleanup = secretStateCleanup,\n    .stateReload = secretStateReload,\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virRegisterStateDriver",
          "args": [
            "&stateDriver"
          ],
          "line": 715
        },
        "resolved": true,
        "details": {
          "function_name": "virRegisterStateDriver",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt.c",
          "lines": "588-602",
          "snippet": "int\nvirRegisterStateDriver(virStateDriverPtr driver)\n{\n    virCheckNonNullArgReturn(driver, -1);\n\n    if (virStateDriverTabCount >= MAX_DRIVERS) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register %s\"),\n                       driver->name);\n        return -1;\n    }\n\n    virStateDriverTab[virStateDriverTabCount] = driver;\n    return virStateDriverTabCount++;\n}",
          "includes": [
            "#include \"access/viraccessmanager.h\"",
            "# include \"bhyve/bhyve_driver.h\"",
            "# include \"hyperv/hyperv_driver.h\"",
            "# include \"esx/esx_driver.h\"",
            "# include \"vmware/vmware_driver.h\"",
            "# include \"openvz/openvz_driver.h\"",
            "# include \"remote/remote_driver.h\"",
            "# include \"test/test_driver.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"viruri.h\"",
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"virevent.h\"",
            "#include \"vircommand.h\"",
            "#include \"rpc/virnettlscontext.h\"",
            "#include \"virconf.h\"",
            "#include \"configmake.h\"",
            "#include \"viralloc.h\"",
            "#include \"viruuid.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <curl/curl.h>",
            "#include <libxml/xpath.h>",
            "#include <libxml/parser.h>",
            "#include <gio/gnetworking.h>",
            "#include <time.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_DRIVERS 21"
          ],
          "globals_used": [
            "static virStateDriverPtr virStateDriverTab[MAX_DRIVERS];",
            "static int virStateDriverTabCount;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"access/viraccessmanager.h\"\n# include \"bhyve/bhyve_driver.h\"\n# include \"hyperv/hyperv_driver.h\"\n# include \"esx/esx_driver.h\"\n# include \"vmware/vmware_driver.h\"\n# include \"openvz/openvz_driver.h\"\n# include \"remote/remote_driver.h\"\n# include \"test/test_driver.h\"\n#include \"virtypedparam.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"viruri.h\"\n#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"virevent.h\"\n#include \"vircommand.h\"\n#include \"rpc/virnettlscontext.h\"\n#include \"virconf.h\"\n#include \"configmake.h\"\n#include \"viralloc.h\"\n#include \"viruuid.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <curl/curl.h>\n#include <libxml/xpath.h>\n#include <libxml/parser.h>\n#include <gio/gnetworking.h>\n#include <time.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define MAX_DRIVERS 21\n\nstatic virStateDriverPtr virStateDriverTab[MAX_DRIVERS];\nstatic int virStateDriverTabCount;\n\nint\nvirRegisterStateDriver(virStateDriverPtr driver)\n{\n    virCheckNonNullArgReturn(driver, -1);\n\n    if (virStateDriverTabCount >= MAX_DRIVERS) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register %s\"),\n                       driver->name);\n        return -1;\n    }\n\n    virStateDriverTab[virStateDriverTabCount] = driver;\n    return virStateDriverTabCount++;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetSharedSecretDriver",
          "args": [
            "&secretDriver"
          ],
          "line": 713
        },
        "resolved": true,
        "details": {
          "function_name": "virSetSharedSecretDriver",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt.c",
          "lines": "461-476",
          "snippet": "int\nvirSetSharedSecretDriver(virSecretDriverPtr driver)\n{\n    virCheckNonNullArgReturn(driver, -1);\n\n    if (virSharedSecretDriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"A secret driver is already registered\"));\n        return -1;\n    }\n\n    VIR_DEBUG(\"registering %s as secret driver\", driver->name);\n\n    virSharedSecretDriver = driver;\n    return 0;\n}",
          "includes": [
            "#include \"access/viraccessmanager.h\"",
            "# include \"bhyve/bhyve_driver.h\"",
            "# include \"hyperv/hyperv_driver.h\"",
            "# include \"esx/esx_driver.h\"",
            "# include \"vmware/vmware_driver.h\"",
            "# include \"openvz/openvz_driver.h\"",
            "# include \"remote/remote_driver.h\"",
            "# include \"test/test_driver.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"viruri.h\"",
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"virevent.h\"",
            "#include \"vircommand.h\"",
            "#include \"rpc/virnettlscontext.h\"",
            "#include \"virconf.h\"",
            "#include \"configmake.h\"",
            "#include \"viralloc.h\"",
            "#include \"viruuid.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <curl/curl.h>",
            "#include <libxml/xpath.h>",
            "#include <libxml/parser.h>",
            "#include <gio/gnetworking.h>",
            "#include <time.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverPtr virSharedSecretDriver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"access/viraccessmanager.h\"\n# include \"bhyve/bhyve_driver.h\"\n# include \"hyperv/hyperv_driver.h\"\n# include \"esx/esx_driver.h\"\n# include \"vmware/vmware_driver.h\"\n# include \"openvz/openvz_driver.h\"\n# include \"remote/remote_driver.h\"\n# include \"test/test_driver.h\"\n#include \"virtypedparam.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"viruri.h\"\n#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"virevent.h\"\n#include \"vircommand.h\"\n#include \"rpc/virnettlscontext.h\"\n#include \"virconf.h\"\n#include \"configmake.h\"\n#include \"viralloc.h\"\n#include \"viruuid.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <curl/curl.h>\n#include <libxml/xpath.h>\n#include <libxml/parser.h>\n#include <gio/gnetworking.h>\n#include <time.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\nstatic virSecretDriverPtr virSharedSecretDriver;\n\nint\nvirSetSharedSecretDriver(virSecretDriverPtr driver)\n{\n    virCheckNonNullArgReturn(driver, -1);\n\n    if (virSharedSecretDriver) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"A secret driver is already registered\"));\n        return -1;\n    }\n\n    VIR_DEBUG(\"registering %s as secret driver\", driver->name);\n\n    virSharedSecretDriver = driver;\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virRegisterConnectDriver",
          "args": [
            "&secretConnectDriver",
            "false"
          ],
          "line": 711
        },
        "resolved": true,
        "details": {
          "function_name": "virRegisterConnectDriver",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt.c",
          "lines": "515-550",
          "snippet": "int\nvirRegisterConnectDriver(virConnectDriverPtr driver,\n                         bool setSharedDrivers)\n{\n    VIR_DEBUG(\"driver=%p name=%s\", driver,\n              driver ? NULLSTR(driver->hypervisorDriver->name) : \"(null)\");\n\n    virCheckNonNullArgReturn(driver, -1);\n    if (virConnectDriverTabCount >= MAX_DRIVERS) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register %s\"),\n                       driver->hypervisorDriver->name);\n        return -1;\n    }\n\n    VIR_DEBUG(\"registering %s as driver %d\",\n           driver->hypervisorDriver->name, virConnectDriverTabCount);\n\n    if (setSharedDrivers) {\n        if (driver->interfaceDriver == NULL)\n            driver->interfaceDriver = virSharedInterfaceDriver;\n        if (driver->networkDriver == NULL)\n            driver->networkDriver = virSharedNetworkDriver;\n        if (driver->nodeDeviceDriver == NULL)\n            driver->nodeDeviceDriver = virSharedNodeDeviceDriver;\n        if (driver->nwfilterDriver == NULL)\n            driver->nwfilterDriver = virSharedNWFilterDriver;\n        if (driver->secretDriver == NULL)\n            driver->secretDriver = virSharedSecretDriver;\n        if (driver->storageDriver == NULL)\n            driver->storageDriver = virSharedStorageDriver;\n    }\n\n    virConnectDriverTab[virConnectDriverTabCount] = driver;\n    return virConnectDriverTabCount++;\n}",
          "includes": [
            "#include \"access/viraccessmanager.h\"",
            "# include \"bhyve/bhyve_driver.h\"",
            "# include \"hyperv/hyperv_driver.h\"",
            "# include \"esx/esx_driver.h\"",
            "# include \"vmware/vmware_driver.h\"",
            "# include \"openvz/openvz_driver.h\"",
            "# include \"remote/remote_driver.h\"",
            "# include \"test/test_driver.h\"",
            "#include \"virtypedparam.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virthread.h\"",
            "#include \"viruri.h\"",
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"virevent.h\"",
            "#include \"vircommand.h\"",
            "#include \"rpc/virnettlscontext.h\"",
            "#include \"virconf.h\"",
            "#include \"configmake.h\"",
            "#include \"viralloc.h\"",
            "#include \"viruuid.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <curl/curl.h>",
            "#include <libxml/xpath.h>",
            "#include <libxml/parser.h>",
            "#include <gio/gnetworking.h>",
            "#include <time.h>",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <config.h>"
          ],
          "macros_used": [
            "#define MAX_DRIVERS 21"
          ],
          "globals_used": [
            "static virConnectDriverPtr virConnectDriverTab[MAX_DRIVERS];",
            "static int virConnectDriverTabCount;",
            "static virNetworkDriverPtr virSharedNetworkDriver;",
            "static virInterfaceDriverPtr virSharedInterfaceDriver;",
            "static virStorageDriverPtr virSharedStorageDriver;",
            "static virNodeDeviceDriverPtr virSharedNodeDeviceDriver;",
            "static virSecretDriverPtr virSharedSecretDriver;",
            "static virNWFilterDriverPtr virSharedNWFilterDriver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"access/viraccessmanager.h\"\n# include \"bhyve/bhyve_driver.h\"\n# include \"hyperv/hyperv_driver.h\"\n# include \"esx/esx_driver.h\"\n# include \"vmware/vmware_driver.h\"\n# include \"openvz/openvz_driver.h\"\n# include \"remote/remote_driver.h\"\n# include \"test/test_driver.h\"\n#include \"virtypedparam.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virthread.h\"\n#include \"viruri.h\"\n#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"virevent.h\"\n#include \"vircommand.h\"\n#include \"rpc/virnettlscontext.h\"\n#include \"virconf.h\"\n#include \"configmake.h\"\n#include \"viralloc.h\"\n#include \"viruuid.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <curl/curl.h>\n#include <libxml/xpath.h>\n#include <libxml/parser.h>\n#include <gio/gnetworking.h>\n#include <time.h>\n#include <unistd.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <config.h>\n\n#define MAX_DRIVERS 21\n\nstatic virConnectDriverPtr virConnectDriverTab[MAX_DRIVERS];\nstatic int virConnectDriverTabCount;\nstatic virNetworkDriverPtr virSharedNetworkDriver;\nstatic virInterfaceDriverPtr virSharedInterfaceDriver;\nstatic virStorageDriverPtr virSharedStorageDriver;\nstatic virNodeDeviceDriverPtr virSharedNodeDeviceDriver;\nstatic virSecretDriverPtr virSharedSecretDriver;\nstatic virNWFilterDriverPtr virSharedNWFilterDriver;\n\nint\nvirRegisterConnectDriver(virConnectDriverPtr driver,\n                         bool setSharedDrivers)\n{\n    VIR_DEBUG(\"driver=%p name=%s\", driver,\n              driver ? NULLSTR(driver->hypervisorDriver->name) : \"(null)\");\n\n    virCheckNonNullArgReturn(driver, -1);\n    if (virConnectDriverTabCount >= MAX_DRIVERS) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"Too many drivers, cannot register %s\"),\n                       driver->hypervisorDriver->name);\n        return -1;\n    }\n\n    VIR_DEBUG(\"registering %s as driver %d\",\n           driver->hypervisorDriver->name, virConnectDriverTabCount);\n\n    if (setSharedDrivers) {\n        if (driver->interfaceDriver == NULL)\n            driver->interfaceDriver = virSharedInterfaceDriver;\n        if (driver->networkDriver == NULL)\n            driver->networkDriver = virSharedNetworkDriver;\n        if (driver->nodeDeviceDriver == NULL)\n            driver->nodeDeviceDriver = virSharedNodeDeviceDriver;\n        if (driver->nwfilterDriver == NULL)\n            driver->nwfilterDriver = virSharedNWFilterDriver;\n        if (driver->secretDriver == NULL)\n            driver->secretDriver = virSharedSecretDriver;\n        if (driver->storageDriver == NULL)\n            driver->storageDriver = virSharedStorageDriver;\n    }\n\n    virConnectDriverTab[virConnectDriverTabCount] = driver;\n    return virConnectDriverTabCount++;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriver secretDriver = {\n    .name = \"secret\",\n    .connectNumOfSecrets = secretConnectNumOfSecrets, /* 0.7.1 */\n    .connectListSecrets = secretConnectListSecrets, /* 0.7.1 */\n    .connectListAllSecrets = secretConnectListAllSecrets, /* 0.10.2 */\n    .secretLookupByUUID = secretLookupByUUID, /* 0.7.1 */\n    .secretLookupByUsage = secretLookupByUsage, /* 0.7.1 */\n    .secretDefineXML = secretDefineXML, /* 0.7.1 */\n    .secretGetXMLDesc = secretGetXMLDesc, /* 0.7.1 */\n    .secretSetValue = secretSetValue, /* 0.7.1 */\n    .secretGetValue = secretGetValue, /* 0.7.1 */\n    .secretUndefine = secretUndefine, /* 0.7.1 */\n    .connectSecretEventRegisterAny = secretConnectSecretEventRegisterAny, /* 3.0.0 */\n    .connectSecretEventDeregisterAny = secretConnectSecretEventDeregisterAny, /* 3.0.0 */\n};\nstatic virConnectDriver secretConnectDriver = {\n    .localOnly = true,\n    .uriSchemes = (const char *[]){ \"secret\", NULL },\n    .embeddable = true,\n    .hypervisorDriver = &secretHypervisorDriver,\n    .secretDriver = &secretDriver,\n};\nstatic virStateDriver stateDriver = {\n    .name = \"secret\",\n    .stateInitialize = secretStateInitialize,\n    .stateCleanup = secretStateCleanup,\n    .stateReload = secretStateReload,\n};\n\nint\nsecretRegister(void)\n{\n    if (virRegisterConnectDriver(&secretConnectDriver, false) < 0)\n        return -1;\n    if (virSetSharedSecretDriver(&secretDriver) < 0)\n        return -1;\n    if (virRegisterStateDriver(&stateDriver) < 0)\n        return -1;\n    return 0;\n}"
  },
  {
    "function_name": "secretConnectSecretEventDeregisterAny",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "648-661",
    "snippet": "static int\nsecretConnectSecretEventDeregisterAny(virConnectPtr conn,\n                                      int callbackID)\n{\n    if (virConnectSecretEventDeregisterAnyEnsureACL(conn) < 0)\n        return -1;\n\n    if (virObjectEventStateDeregisterID(conn,\n                                        driver->secretEventState,\n                                        callbackID, true) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventStateDeregisterID",
          "args": [
            "conn",
            "driver->secretEventState",
            "callbackID",
            "true"
          ],
          "line": 655
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventStateDeregisterID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "936-957",
          "snippet": "int\nvirObjectEventStateDeregisterID(virConnectPtr conn,\n                                virObjectEventStatePtr state,\n                                int callbackID,\n                                bool doFreeCb)\n{\n    int ret;\n\n    virObjectLock(state);\n    if (state->isDispatching)\n        ret = virObjectEventCallbackListMarkDeleteID(conn,\n                                                     state->callbacks,\n                                                     callbackID);\n    else\n        ret = virObjectEventCallbackListRemoveID(conn, state->callbacks,\n                                                 callbackID, doFreeCb);\n\n    virObjectEventStateCleanupTimer(state, true);\n\n    virObjectUnlock(state);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectEventStateFlush(virObjectEventStatePtr state);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic void virObjectEventStateFlush(virObjectEventStatePtr state);\n\nint\nvirObjectEventStateDeregisterID(virConnectPtr conn,\n                                virObjectEventStatePtr state,\n                                int callbackID,\n                                bool doFreeCb)\n{\n    int ret;\n\n    virObjectLock(state);\n    if (state->isDispatching)\n        ret = virObjectEventCallbackListMarkDeleteID(conn,\n                                                     state->callbacks,\n                                                     callbackID);\n    else\n        ret = virObjectEventCallbackListRemoveID(conn, state->callbacks,\n                                                 callbackID, doFreeCb);\n\n    virObjectEventStateCleanupTimer(state, true);\n\n    virObjectUnlock(state);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectSecretEventDeregisterAnyEnsureACL",
          "args": [
            "conn"
          ],
          "line": 652
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretConnectSecretEventDeregisterAny(virConnectPtr conn,\n                                      int callbackID)\n{\n    if (virConnectSecretEventDeregisterAnyEnsureACL(conn) < 0)\n        return -1;\n\n    if (virObjectEventStateDeregisterID(conn,\n                                        driver->secretEventState,\n                                        callbackID, true) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "secretConnectSecretEventRegisterAny",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "626-645",
    "snippet": "static int\nsecretConnectSecretEventRegisterAny(virConnectPtr conn,\n                                    virSecretPtr secret,\n                                    int eventID,\n                                    virConnectSecretEventGenericCallback callback,\n                                    void *opaque,\n                                    virFreeCallback freecb)\n{\n    int callbackID = -1;\n\n    if (virConnectSecretEventRegisterAnyEnsureACL(conn) < 0)\n        return -1;\n\n    if (virSecretEventStateRegisterID(conn, driver->secretEventState,\n                                      secret, eventID, callback,\n                                      opaque, freecb, &callbackID) < 0)\n        callbackID = -1;\n\n    return callbackID;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecretEventStateRegisterID",
          "args": [
            "conn",
            "driver->secretEventState",
            "secret",
            "eventID",
            "callback",
            "opaque",
            "freecb",
            "&callbackID"
          ],
          "line": 639
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretEventStateRegisterID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/secret_event.c",
          "lines": "167-190",
          "snippet": "int\nvirSecretEventStateRegisterID(virConnectPtr conn,\n                              virObjectEventStatePtr state,\n                              virSecretPtr secret,\n                              int eventID,\n                              virConnectSecretEventGenericCallback cb,\n                              void *opaque,\n                              virFreeCallback freecb,\n                              int *callbackID)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    if (virSecretEventsInitialize() < 0)\n        return -1;\n\n    if (secret)\n        virUUIDFormat(secret->uuid, uuidstr);\n    return virObjectEventStateRegisterID(conn, state, secret ? uuidstr : NULL,\n                                         NULL, NULL,\n                                         virSecretEventClass, eventID,\n                                         VIR_OBJECT_EVENT_CALLBACK(cb),\n                                         opaque, freecb,\n                                         false, callbackID, false);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"secret_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virSecretEventClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"secret_event.h\"\n#include <config.h>\n\nstatic virClassPtr virSecretEventClass;\n\nint\nvirSecretEventStateRegisterID(virConnectPtr conn,\n                              virObjectEventStatePtr state,\n                              virSecretPtr secret,\n                              int eventID,\n                              virConnectSecretEventGenericCallback cb,\n                              void *opaque,\n                              virFreeCallback freecb,\n                              int *callbackID)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    if (virSecretEventsInitialize() < 0)\n        return -1;\n\n    if (secret)\n        virUUIDFormat(secret->uuid, uuidstr);\n    return virObjectEventStateRegisterID(conn, state, secret ? uuidstr : NULL,\n                                         NULL, NULL,\n                                         virSecretEventClass, eventID,\n                                         VIR_OBJECT_EVENT_CALLBACK(cb),\n                                         opaque, freecb,\n                                         false, callbackID, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectSecretEventRegisterAnyEnsureACL",
          "args": [
            "conn"
          ],
          "line": 636
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretConnectSecretEventRegisterAny(virConnectPtr conn,\n                                    virSecretPtr secret,\n                                    int eventID,\n                                    virConnectSecretEventGenericCallback callback,\n                                    void *opaque,\n                                    virFreeCallback freecb)\n{\n    int callbackID = -1;\n\n    if (virConnectSecretEventRegisterAnyEnsureACL(conn) < 0)\n        return -1;\n\n    if (virSecretEventStateRegisterID(conn, driver->secretEventState,\n                                      secret, eventID, callback,\n                                      opaque, freecb, &callbackID) < 0)\n        callbackID = -1;\n\n    return callbackID;\n}"
  },
  {
    "function_name": "secretConnectIsAlive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "620-623",
    "snippet": "static int secretConnectIsAlive(virConnectPtr conn G_GNUC_UNUSED)\n{\n    return 1;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int secretConnectIsAlive(virConnectPtr conn G_GNUC_UNUSED)\n{\n    return 1;\n}"
  },
  {
    "function_name": "secretConnectIsEncrypted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "613-617",
    "snippet": "static int secretConnectIsEncrypted(virConnectPtr conn G_GNUC_UNUSED)\n{\n    /* Not encrypted, but remote driver takes care of that */\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int secretConnectIsEncrypted(virConnectPtr conn G_GNUC_UNUSED)\n{\n    /* Not encrypted, but remote driver takes care of that */\n    return 0;\n}"
  },
  {
    "function_name": "secretConnectIsSecure",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "606-610",
    "snippet": "static int secretConnectIsSecure(virConnectPtr conn G_GNUC_UNUSED)\n{\n    /* Trivially secure, since always inside the daemon */\n    return 1;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic int secretConnectIsSecure(virConnectPtr conn G_GNUC_UNUSED)\n{\n    /* Trivially secure, since always inside the daemon */\n    return 1;\n}"
  },
  {
    "function_name": "secretConnectClose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "593-603",
    "snippet": "static int secretConnectClose(virConnectPtr conn G_GNUC_UNUSED)\n{\n    if (driver->embeddedRoot) {\n        secretDriverLock();\n        driver->embeddedRefs--;\n        if (driver->embeddedRefs == 0)\n            virSetConnectSecret(NULL);\n        secretDriverUnlock();\n    }\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "secretDriverUnlock",
          "args": [],
          "line": 600
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "81-85",
          "snippet": "static void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetConnectSecret",
          "args": [
            "NULL"
          ],
          "line": 599
        },
        "resolved": true,
        "details": {
          "function_name": "virSetConnectSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "239-247",
          "snippet": "int\nvirSetConnectSecret(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override secret connection with %p\", conn);\n    return virThreadLocalSet(&connectSecret, conn);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virThreadLocal connectSecret;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectSecret;\n\nint\nvirSetConnectSecret(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override secret connection with %p\", conn);\n    return virThreadLocalSet(&connectSecret, conn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretDriverLock",
          "args": [],
          "line": 596
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "74-78",
          "snippet": "static void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int secretConnectClose(virConnectPtr conn G_GNUC_UNUSED)\n{\n    if (driver->embeddedRoot) {\n        secretDriverLock();\n        driver->embeddedRefs--;\n        if (driver->embeddedRefs == 0)\n            virSetConnectSecret(NULL);\n        secretDriverUnlock();\n    }\n    return 0;\n}"
  },
  {
    "function_name": "secretConnectOpen",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "540-591",
    "snippet": "static virDrvOpenStatus\nsecretConnectOpen(virConnectPtr conn,\n                  virConnectAuthPtr auth G_GNUC_UNUSED,\n                  virConfPtr conf G_GNUC_UNUSED,\n                  unsigned int flags)\n{\n    virCheckFlags(VIR_CONNECT_RO, VIR_DRV_OPEN_ERROR);\n\n    if (driver == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"secret state driver is not active\"));\n        return VIR_DRV_OPEN_ERROR;\n    }\n\n    if (driver->embeddedRoot) {\n        const char *root = virURIGetParam(conn->uri, \"root\");\n        if (!root)\n            return VIR_DRV_OPEN_ERROR;\n\n        if (STRNEQ(conn->uri->path, \"/embed\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"URI must be secret:///embed\"));\n            return VIR_DRV_OPEN_ERROR;\n        }\n\n        if (STRNEQ(root, driver->embeddedRoot)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Cannot open embedded driver at path '%s', \"\n                             \"already open with path '%s'\"),\n                           root, driver->embeddedRoot);\n            return VIR_DRV_OPEN_ERROR;\n        }\n    } else {\n        if (!virConnectValidateURIPath(conn->uri->path,\n                                       \"secret\",\n                                       driver->privileged))\n            return VIR_DRV_OPEN_ERROR;\n    }\n\n    if (virConnectOpenEnsureACL(conn) < 0)\n        return VIR_DRV_OPEN_ERROR;\n\n    if (driver->embeddedRoot) {\n        secretDriverLock();\n        if (driver->embeddedRefs == 0)\n            virSetConnectSecret(conn);\n        driver->embeddedRefs++;\n        secretDriverUnlock();\n    }\n\n    return VIR_DRV_OPEN_SUCCESS;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "secretDriverUnlock",
          "args": [],
          "line": 587
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "81-85",
          "snippet": "static void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSetConnectSecret",
          "args": [
            "conn"
          ],
          "line": 585
        },
        "resolved": true,
        "details": {
          "function_name": "virSetConnectSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "239-247",
          "snippet": "int\nvirSetConnectSecret(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override secret connection with %p\", conn);\n    return virThreadLocalSet(&connectSecret, conn);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virThreadLocal connectSecret;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirThreadLocal connectSecret;\n\nint\nvirSetConnectSecret(virConnectPtr conn)\n{\n    if (virConnectCacheInitialize() < 0)\n        return -1;\n\n    VIR_DEBUG(\"Override secret connection with %p\", conn);\n    return virThreadLocalSet(&connectSecret, conn);\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretDriverLock",
          "args": [],
          "line": 583
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "74-78",
          "snippet": "static void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectOpenEnsureACL",
          "args": [
            "conn"
          ],
          "line": 579
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectValidateURIPath",
          "args": [
            "conn->uri->path",
            "\"secret\"",
            "driver->privileged"
          ],
          "line": 573
        },
        "resolved": true,
        "details": {
          "function_name": "virConnectValidateURIPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "260-296",
          "snippet": "bool\nvirConnectValidateURIPath(const char *uriPath,\n                          const char *entityName,\n                          bool privileged)\n{\n    if (privileged) {\n        /* TODO: qemu and vbox drivers allow '/session'\n         * connections as root. This is not ideal, but changing\n         * these drivers to refuse privileged '/session'\n         * connections, like everyone else is already doing, can\n         * break existing applications. Until we decide what to do,\n         * for now we can handle them as exception in this validate\n         * function.\n         */\n        bool compatSessionRoot = (STREQ(entityName, \"qemu\") ||\n                                  STREQ(entityName, \"vbox\")) &&\n                                  STREQ(uriPath, \"/session\");\n\n        if (STRNEQ(uriPath, \"/system\") && !compatSessionRoot) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///system\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    } else {\n        if (STRNEQ(uriPath, \"/session\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///session\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    }\n\n    return true;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nbool\nvirConnectValidateURIPath(const char *uriPath,\n                          const char *entityName,\n                          bool privileged)\n{\n    if (privileged) {\n        /* TODO: qemu and vbox drivers allow '/session'\n         * connections as root. This is not ideal, but changing\n         * these drivers to refuse privileged '/session'\n         * connections, like everyone else is already doing, can\n         * break existing applications. Until we decide what to do,\n         * for now we can handle them as exception in this validate\n         * function.\n         */\n        bool compatSessionRoot = (STREQ(entityName, \"qemu\") ||\n                                  STREQ(entityName, \"vbox\")) &&\n                                  STREQ(uriPath, \"/session\");\n\n        if (STRNEQ(uriPath, \"/system\") && !compatSessionRoot) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///system\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    } else {\n        if (STRNEQ(uriPath, \"/session\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///session\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    }\n\n    return true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"Cannot open embedded driver at path '%s', \"\n                             \"already open with path '%s'\")",
            "root",
            "driver->embeddedRoot"
          ],
          "line": 566
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Cannot open embedded driver at path '%s', \"\n                             \"already open with path '%s'\""
          ],
          "line": 567
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "root",
            "driver->embeddedRoot"
          ],
          "line": 565
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"URI must be secret:///embed\")"
          ],
          "line": 560
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "STRNEQ",
          "args": [
            "conn->uri->path",
            "\"/embed\""
          ],
          "line": 559
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virURIGetParam",
          "args": [
            "conn->uri",
            "\"root\""
          ],
          "line": 555
        },
        "resolved": true,
        "details": {
          "function_name": "virURIGetParam",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruri.c",
          "lines": "380-393",
          "snippet": "const char *\nvirURIGetParam(virURIPtr uri, const char *name)\n{\n    size_t i;\n\n    for (i = 0; i < uri->paramsCount; i++) {\n        if (STREQ(uri->params[i].name, name))\n            return uri->params[i].value;\n    }\n\n    virReportError(VIR_ERR_INVALID_ARG,\n                   _(\"Missing URI parameter '%s'\"), name);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"viruri.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virbuffer.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"viruri.h\"\n#include <config.h>\n\nconst char *\nvirURIGetParam(virURIPtr uri, const char *name)\n{\n    size_t i;\n\n    for (i = 0; i < uri->paramsCount; i++) {\n        if (STREQ(uri->params[i].name, name))\n            return uri->params[i].value;\n    }\n\n    virReportError(VIR_ERR_INVALID_ARG,\n                   _(\"Missing URI parameter '%s'\"), name);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"secret state driver is not active\")"
          ],
          "line": 549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_CONNECT_RO",
            "VIR_DRV_OPEN_ERROR"
          ],
          "line": 546
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virDrvOpenStatus\nsecretConnectOpen(virConnectPtr conn,\n                  virConnectAuthPtr auth G_GNUC_UNUSED,\n                  virConfPtr conf G_GNUC_UNUSED,\n                  unsigned int flags)\n{\n    virCheckFlags(VIR_CONNECT_RO, VIR_DRV_OPEN_ERROR);\n\n    if (driver == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"secret state driver is not active\"));\n        return VIR_DRV_OPEN_ERROR;\n    }\n\n    if (driver->embeddedRoot) {\n        const char *root = virURIGetParam(conn->uri, \"root\");\n        if (!root)\n            return VIR_DRV_OPEN_ERROR;\n\n        if (STRNEQ(conn->uri->path, \"/embed\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"URI must be secret:///embed\"));\n            return VIR_DRV_OPEN_ERROR;\n        }\n\n        if (STRNEQ(root, driver->embeddedRoot)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"Cannot open embedded driver at path '%s', \"\n                             \"already open with path '%s'\"),\n                           root, driver->embeddedRoot);\n            return VIR_DRV_OPEN_ERROR;\n        }\n    } else {\n        if (!virConnectValidateURIPath(conn->uri->path,\n                                       \"secret\",\n                                       driver->privileged))\n            return VIR_DRV_OPEN_ERROR;\n    }\n\n    if (virConnectOpenEnsureACL(conn) < 0)\n        return VIR_DRV_OPEN_ERROR;\n\n    if (driver->embeddedRoot) {\n        secretDriverLock();\n        if (driver->embeddedRefs == 0)\n            virSetConnectSecret(conn);\n        driver->embeddedRefs++;\n        secretDriverUnlock();\n    }\n\n    return VIR_DRV_OPEN_SUCCESS;\n}"
  },
  {
    "function_name": "secretStateReload",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "525-537",
    "snippet": "static int\nsecretStateReload(void)\n{\n    if (!driver)\n        return -1;\n\n    secretDriverLock();\n\n    ignore_value(virSecretLoadAllConfigs(driver->secrets, driver->configDir));\n\n    secretDriverUnlock();\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "secretDriverUnlock",
          "args": [],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "81-85",
          "snippet": "static void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "ignore_value",
          "args": [
            "virSecretLoadAllConfigs(driver->secrets, driver->configDir)"
          ],
          "line": 533
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretLoadAllConfigs",
          "args": [
            "driver->secrets",
            "driver->configDir"
          ],
          "line": 533
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretLoadAllConfigs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "904-940",
          "snippet": "int\nvirSecretLoadAllConfigs(virSecretObjListPtr secrets,\n                        const char *configDir)\n{\n    DIR *dir = NULL;\n    struct dirent *de;\n    int rc;\n\n    if ((rc = virDirOpenIfExists(&dir, configDir)) <= 0)\n        return rc;\n\n    /* Ignore errors reported by readdir or other calls within the\n     * loop (if any).  It's better to keep the secrets we managed to find. */\n    while (virDirRead(dir, &de, NULL) > 0) {\n        char *path;\n        virSecretObjPtr obj;\n\n        if (!virStringHasSuffix(de->d_name, \".xml\"))\n            continue;\n\n        if (!(path = virFileBuildPath(configDir, de->d_name, NULL)))\n            continue;\n\n        if (!(obj = virSecretLoad(secrets, de->d_name, path, configDir))) {\n            VIR_ERROR(_(\"Error reading secret: %s\"),\n                      virGetLastErrorMessage());\n            VIR_FREE(path);\n            continue;\n        }\n\n        VIR_FREE(path);\n        virSecretObjEndAPI(&obj);\n    }\n\n    VIR_DIR_CLOSE(dir);\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nint\nvirSecretLoadAllConfigs(virSecretObjListPtr secrets,\n                        const char *configDir)\n{\n    DIR *dir = NULL;\n    struct dirent *de;\n    int rc;\n\n    if ((rc = virDirOpenIfExists(&dir, configDir)) <= 0)\n        return rc;\n\n    /* Ignore errors reported by readdir or other calls within the\n     * loop (if any).  It's better to keep the secrets we managed to find. */\n    while (virDirRead(dir, &de, NULL) > 0) {\n        char *path;\n        virSecretObjPtr obj;\n\n        if (!virStringHasSuffix(de->d_name, \".xml\"))\n            continue;\n\n        if (!(path = virFileBuildPath(configDir, de->d_name, NULL)))\n            continue;\n\n        if (!(obj = virSecretLoad(secrets, de->d_name, path, configDir))) {\n            VIR_ERROR(_(\"Error reading secret: %s\"),\n                      virGetLastErrorMessage());\n            VIR_FREE(path);\n            continue;\n        }\n\n        VIR_FREE(path);\n        virSecretObjEndAPI(&obj);\n    }\n\n    VIR_DIR_CLOSE(dir);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretDriverLock",
          "args": [],
          "line": 531
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "74-78",
          "snippet": "static void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretStateReload(void)\n{\n    if (!driver)\n        return -1;\n\n    secretDriverLock();\n\n    ignore_value(virSecretLoadAllConfigs(driver->secrets, driver->configDir));\n\n    secretDriverUnlock();\n    return 0;\n}"
  },
  {
    "function_name": "secretStateInitialize",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "456-522",
    "snippet": "static int\nsecretStateInitialize(bool privileged,\n                      const char *root,\n                      virStateInhibitCallback callback G_GNUC_UNUSED,\n                      void *opaque G_GNUC_UNUSED)\n{\n    if (VIR_ALLOC(driver) < 0)\n        return VIR_DRV_STATE_INIT_ERROR;\n\n    driver->lockFD = -1;\n    if (virMutexInit(&driver->lock) < 0) {\n        VIR_FREE(driver);\n        return VIR_DRV_STATE_INIT_ERROR;\n    }\n    secretDriverLock();\n\n    driver->secretEventState = virObjectEventStateNew();\n    driver->privileged = privileged;\n\n    if (root) {\n        driver->embeddedRoot = g_strdup(root);\n        driver->configDir = g_strdup_printf(\"%s/etc/secrets\", root);\n        driver->stateDir = g_strdup_printf(\"%s/run/secrets\", root);\n    } else if (privileged) {\n        driver->configDir = g_strdup_printf(\"%s/libvirt/secrets\", SYSCONFDIR);\n        driver->stateDir = g_strdup_printf(\"%s/libvirt/secrets\", RUNSTATEDIR);\n    } else {\n        g_autofree char *rundir = NULL;\n        g_autofree char *cfgdir = NULL;\n\n        cfgdir = virGetUserConfigDirectory();\n        driver->configDir = g_strdup_printf(\"%s/secrets/\", cfgdir);\n\n        rundir = virGetUserRuntimeDirectory();\n        driver->stateDir = g_strdup_printf(\"%s/secrets/run\", rundir);\n    }\n\n    if (virFileMakePathWithMode(driver->configDir, S_IRWXU) < 0) {\n        virReportSystemError(errno, _(\"cannot create config directory '%s'\"),\n                             driver->configDir);\n        goto error;\n    }\n\n    if (virFileMakePathWithMode(driver->stateDir, S_IRWXU) < 0) {\n        virReportSystemError(errno, _(\"cannot create state directory '%s'\"),\n                             driver->stateDir);\n        goto error;\n    }\n\n    if ((driver->lockFD =\n         virPidFileAcquire(driver->stateDir, \"driver\", false, getpid())) < 0)\n        goto error;\n\n    if (!(driver->secrets = virSecretObjListNew()))\n        goto error;\n\n    if (virSecretLoadAllConfigs(driver->secrets, driver->configDir) < 0)\n        goto error;\n\n    secretDriverUnlock();\n    return VIR_DRV_STATE_INIT_COMPLETE;\n\n error:\n    secretDriverUnlock();\n    secretStateCleanup();\n    return VIR_DRV_STATE_INIT_ERROR;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "secretStateCleanup",
          "args": [],
          "line": 520
        },
        "resolved": true,
        "details": {
          "function_name": "secretStateCleanup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "431-453",
          "snippet": "static int\nsecretStateCleanup(void)\n{\n    if (!driver)\n        return -1;\n\n    secretDriverLock();\n\n    virObjectUnref(driver->secrets);\n    VIR_FREE(driver->configDir);\n\n    virObjectUnref(driver->secretEventState);\n\n    if (driver->lockFD != -1)\n        virPidFileRelease(driver->stateDir, \"driver\", driver->lockFD);\n\n    VIR_FREE(driver->stateDir);\n    secretDriverUnlock();\n    virMutexDestroy(&driver->lock);\n    VIR_FREE(driver);\n\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretStateCleanup(void)\n{\n    if (!driver)\n        return -1;\n\n    secretDriverLock();\n\n    virObjectUnref(driver->secrets);\n    VIR_FREE(driver->configDir);\n\n    virObjectUnref(driver->secretEventState);\n\n    if (driver->lockFD != -1)\n        virPidFileRelease(driver->stateDir, \"driver\", driver->lockFD);\n\n    VIR_FREE(driver->stateDir);\n    secretDriverUnlock();\n    virMutexDestroy(&driver->lock);\n    VIR_FREE(driver);\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretDriverUnlock",
          "args": [],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "81-85",
          "snippet": "static void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretLoadAllConfigs",
          "args": [
            "driver->secrets",
            "driver->configDir"
          ],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretLoadAllConfigs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "904-940",
          "snippet": "int\nvirSecretLoadAllConfigs(virSecretObjListPtr secrets,\n                        const char *configDir)\n{\n    DIR *dir = NULL;\n    struct dirent *de;\n    int rc;\n\n    if ((rc = virDirOpenIfExists(&dir, configDir)) <= 0)\n        return rc;\n\n    /* Ignore errors reported by readdir or other calls within the\n     * loop (if any).  It's better to keep the secrets we managed to find. */\n    while (virDirRead(dir, &de, NULL) > 0) {\n        char *path;\n        virSecretObjPtr obj;\n\n        if (!virStringHasSuffix(de->d_name, \".xml\"))\n            continue;\n\n        if (!(path = virFileBuildPath(configDir, de->d_name, NULL)))\n            continue;\n\n        if (!(obj = virSecretLoad(secrets, de->d_name, path, configDir))) {\n            VIR_ERROR(_(\"Error reading secret: %s\"),\n                      virGetLastErrorMessage());\n            VIR_FREE(path);\n            continue;\n        }\n\n        VIR_FREE(path);\n        virSecretObjEndAPI(&obj);\n    }\n\n    VIR_DIR_CLOSE(dir);\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nint\nvirSecretLoadAllConfigs(virSecretObjListPtr secrets,\n                        const char *configDir)\n{\n    DIR *dir = NULL;\n    struct dirent *de;\n    int rc;\n\n    if ((rc = virDirOpenIfExists(&dir, configDir)) <= 0)\n        return rc;\n\n    /* Ignore errors reported by readdir or other calls within the\n     * loop (if any).  It's better to keep the secrets we managed to find. */\n    while (virDirRead(dir, &de, NULL) > 0) {\n        char *path;\n        virSecretObjPtr obj;\n\n        if (!virStringHasSuffix(de->d_name, \".xml\"))\n            continue;\n\n        if (!(path = virFileBuildPath(configDir, de->d_name, NULL)))\n            continue;\n\n        if (!(obj = virSecretLoad(secrets, de->d_name, path, configDir))) {\n            VIR_ERROR(_(\"Error reading secret: %s\"),\n                      virGetLastErrorMessage());\n            VIR_FREE(path);\n            continue;\n        }\n\n        VIR_FREE(path);\n        virSecretObjEndAPI(&obj);\n    }\n\n    VIR_DIR_CLOSE(dir);\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjListNew",
          "args": [],
          "line": 509
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "111-128",
          "snippet": "virSecretObjListPtr\nvirSecretObjListNew(void)\n{\n    virSecretObjListPtr secrets;\n\n    if (virSecretObjInitialize() < 0)\n        return NULL;\n\n    if (!(secrets = virObjectRWLockableNew(virSecretObjListClass)))\n        return NULL;\n\n    if (!(secrets->objs = virHashCreate(50, virObjectFreeHashData))) {\n        virObjectUnref(secrets);\n        return NULL;\n    }\n\n    return secrets;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virSecretObjListClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic virClassPtr virSecretObjListClass;\n\nvirSecretObjListPtr\nvirSecretObjListNew(void)\n{\n    virSecretObjListPtr secrets;\n\n    if (virSecretObjInitialize() < 0)\n        return NULL;\n\n    if (!(secrets = virObjectRWLockableNew(virSecretObjListClass)))\n        return NULL;\n\n    if (!(secrets->objs = virHashCreate(50, virObjectFreeHashData))) {\n        virObjectUnref(secrets);\n        return NULL;\n    }\n\n    return secrets;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virPidFileAcquire",
          "args": [
            "driver->stateDir",
            "\"driver\"",
            "false",
            "getpid()"
          ],
          "line": 506
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileAcquire",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "413-427",
          "snippet": "int virPidFileAcquire(const char *dir,\n                      const char *name,\n                      bool waitForLock,\n                      pid_t pid)\n{\n    g_autofree char *pidfile = NULL;\n\n    if (name == NULL || dir == NULL)\n        return -EINVAL;\n\n    if (!(pidfile = virPidFileBuildPath(dir, name)))\n        return -ENOMEM;\n\n    return virPidFileAcquirePath(pidfile, waitForLock, pid);\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileAcquire(const char *dir,\n                      const char *name,\n                      bool waitForLock,\n                      pid_t pid)\n{\n    g_autofree char *pidfile = NULL;\n\n    if (name == NULL || dir == NULL)\n        return -EINVAL;\n\n    if (!(pidfile = virPidFileBuildPath(dir, name)))\n        return -ENOMEM;\n\n    return virPidFileAcquirePath(pidfile, waitForLock, pid);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getpid",
          "args": [],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot create state directory '%s'\")",
            "driver->stateDir"
          ],
          "line": 500
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot create state directory '%s'\""
          ],
          "line": 500
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileMakePathWithMode",
          "args": [
            "driver->stateDir",
            "S_IRWXU"
          ],
          "line": 499
        },
        "resolved": true,
        "details": {
          "function_name": "virFileMakePathWithMode",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "3082-3091",
          "snippet": "int\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileMakePathWithMode(const char *path,\n                        mode_t mode)\n{\n    g_autofree char *tmp = NULL;\n\n    tmp = g_strdup(path);\n\n    return virFileMakePathHelper(tmp, mode);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot create config directory '%s'\")",
            "driver->configDir"
          ],
          "line": 494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virGetUserRuntimeDirectory",
          "args": [],
          "line": 489
        },
        "resolved": true,
        "details": {
          "function_name": "virGetUserRuntimeDirectory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "594-601",
          "snippet": "char *virGetUserRuntimeDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_runtime_dir());\n#else\n    return g_build_filename(g_get_user_runtime_dir(), \"libvirt\", NULL);\n#endif\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *virGetUserRuntimeDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_runtime_dir());\n#else\n    return g_build_filename(g_get_user_runtime_dir(), \"libvirt\", NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetUserConfigDirectory",
          "args": [],
          "line": 486
        },
        "resolved": true,
        "details": {
          "function_name": "virGetUserConfigDirectory",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "574-581",
          "snippet": "char *virGetUserConfigDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_config_dir());\n#else\n    return g_build_filename(g_get_user_config_dir(), \"libvirt\", NULL);\n#endif\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *virGetUserConfigDirectory(void)\n{\n#ifdef WIN32\n    return g_strdup(g_get_user_config_dir());\n#else\n    return g_build_filename(g_get_user_config_dir(), \"libvirt\", NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectEventStateNew",
          "args": [],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventStateNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "558-582",
          "snippet": "virObjectEventStatePtr\nvirObjectEventStateNew(void)\n{\n    virObjectEventStatePtr state = NULL;\n\n    if (virObjectEventInitialize() < 0)\n        return NULL;\n\n    if (!(state = virObjectLockableNew(virObjectEventStateClass)))\n        return NULL;\n\n    if (VIR_ALLOC(state->callbacks) < 0)\n        goto error;\n\n    if (!(state->queue = virObjectEventQueueNew()))\n        goto error;\n\n    state->timer = -1;\n\n    return state;\n\n error:\n    virObjectUnref(state);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virObjectEventStateClass;",
            "static void virObjectEventStateFlush(virObjectEventStatePtr state);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic virClassPtr virObjectEventStateClass;\nstatic void virObjectEventStateFlush(virObjectEventStatePtr state);\n\nvirObjectEventStatePtr\nvirObjectEventStateNew(void)\n{\n    virObjectEventStatePtr state = NULL;\n\n    if (virObjectEventInitialize() < 0)\n        return NULL;\n\n    if (!(state = virObjectLockableNew(virObjectEventStateClass)))\n        return NULL;\n\n    if (VIR_ALLOC(state->callbacks) < 0)\n        goto error;\n\n    if (!(state->queue = virObjectEventQueueNew()))\n        goto error;\n\n    state->timer = -1;\n\n    return state;\n\n error:\n    virObjectUnref(state);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretDriverLock",
          "args": [],
          "line": 470
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "74-78",
          "snippet": "static void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "driver"
          ],
          "line": 467
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexInit",
          "args": [
            "&driver->lock"
          ],
          "line": 466
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexInitRecursive",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "61-74",
          "snippet": "int virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virMutexInitRecursive(virMutexPtr m)\n{\n    int ret;\n    pthread_mutexattr_t attr;\n    pthread_mutexattr_init(&attr);\n    pthread_mutexattr_settype(&attr, PTHREAD_MUTEX_RECURSIVE);\n    ret = pthread_mutex_init(&m->lock, &attr);\n    pthread_mutexattr_destroy(&attr);\n    if (ret != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_ALLOC",
          "args": [
            "driver"
          ],
          "line": 462
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretStateInitialize(bool privileged,\n                      const char *root,\n                      virStateInhibitCallback callback G_GNUC_UNUSED,\n                      void *opaque G_GNUC_UNUSED)\n{\n    if (VIR_ALLOC(driver) < 0)\n        return VIR_DRV_STATE_INIT_ERROR;\n\n    driver->lockFD = -1;\n    if (virMutexInit(&driver->lock) < 0) {\n        VIR_FREE(driver);\n        return VIR_DRV_STATE_INIT_ERROR;\n    }\n    secretDriverLock();\n\n    driver->secretEventState = virObjectEventStateNew();\n    driver->privileged = privileged;\n\n    if (root) {\n        driver->embeddedRoot = g_strdup(root);\n        driver->configDir = g_strdup_printf(\"%s/etc/secrets\", root);\n        driver->stateDir = g_strdup_printf(\"%s/run/secrets\", root);\n    } else if (privileged) {\n        driver->configDir = g_strdup_printf(\"%s/libvirt/secrets\", SYSCONFDIR);\n        driver->stateDir = g_strdup_printf(\"%s/libvirt/secrets\", RUNSTATEDIR);\n    } else {\n        g_autofree char *rundir = NULL;\n        g_autofree char *cfgdir = NULL;\n\n        cfgdir = virGetUserConfigDirectory();\n        driver->configDir = g_strdup_printf(\"%s/secrets/\", cfgdir);\n\n        rundir = virGetUserRuntimeDirectory();\n        driver->stateDir = g_strdup_printf(\"%s/secrets/run\", rundir);\n    }\n\n    if (virFileMakePathWithMode(driver->configDir, S_IRWXU) < 0) {\n        virReportSystemError(errno, _(\"cannot create config directory '%s'\"),\n                             driver->configDir);\n        goto error;\n    }\n\n    if (virFileMakePathWithMode(driver->stateDir, S_IRWXU) < 0) {\n        virReportSystemError(errno, _(\"cannot create state directory '%s'\"),\n                             driver->stateDir);\n        goto error;\n    }\n\n    if ((driver->lockFD =\n         virPidFileAcquire(driver->stateDir, \"driver\", false, getpid())) < 0)\n        goto error;\n\n    if (!(driver->secrets = virSecretObjListNew()))\n        goto error;\n\n    if (virSecretLoadAllConfigs(driver->secrets, driver->configDir) < 0)\n        goto error;\n\n    secretDriverUnlock();\n    return VIR_DRV_STATE_INIT_COMPLETE;\n\n error:\n    secretDriverUnlock();\n    secretStateCleanup();\n    return VIR_DRV_STATE_INIT_ERROR;\n}"
  },
  {
    "function_name": "secretStateCleanup",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "431-453",
    "snippet": "static int\nsecretStateCleanup(void)\n{\n    if (!driver)\n        return -1;\n\n    secretDriverLock();\n\n    virObjectUnref(driver->secrets);\n    VIR_FREE(driver->configDir);\n\n    virObjectUnref(driver->secretEventState);\n\n    if (driver->lockFD != -1)\n        virPidFileRelease(driver->stateDir, \"driver\", driver->lockFD);\n\n    VIR_FREE(driver->stateDir);\n    secretDriverUnlock();\n    virMutexDestroy(&driver->lock);\n    VIR_FREE(driver);\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "driver"
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virMutexDestroy",
          "args": [
            "&driver->lock"
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexDestroy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "76-79",
          "snippet": "void virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexDestroy(virMutexPtr m)\n{\n    pthread_mutex_destroy(&m->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretDriverUnlock",
          "args": [],
          "line": 448
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "81-85",
          "snippet": "static void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "driver->stateDir"
          ],
          "line": 447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virPidFileRelease",
          "args": [
            "driver->stateDir",
            "\"driver\"",
            "driver->lockFD"
          ],
          "line": 445
        },
        "resolved": true,
        "details": {
          "function_name": "virPidFileRelease",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virpidfile.c",
          "lines": "453-466",
          "snippet": "int virPidFileRelease(const char *dir,\n                      const char *name,\n                      int fd)\n{\n    g_autofree char *pidfile = NULL;\n\n    if (name == NULL || dir == NULL)\n        return -EINVAL;\n\n    if (!(pidfile = virPidFileBuildPath(dir, name)))\n        return -ENOMEM;\n\n    return virPidFileReleasePath(pidfile, fd);\n}",
          "includes": [
            "#include \"virprocess.h\"",
            "#include \"virstring.h\"",
            "#include \"virerror.h\"",
            "#include \"virlog.h\"",
            "#include \"virutil.h\"",
            "#include \"viralloc.h\"",
            "#include \"virfile.h\"",
            "#include \"virpidfile.h\"",
            "#include <sys/stat.h>",
            "#include <signal.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virprocess.h\"\n#include \"virstring.h\"\n#include \"virerror.h\"\n#include \"virlog.h\"\n#include \"virutil.h\"\n#include \"viralloc.h\"\n#include \"virfile.h\"\n#include \"virpidfile.h\"\n#include <sys/stat.h>\n#include <signal.h>\n#include <fcntl.h>\n#include <config.h>\n\nint virPidFileRelease(const char *dir,\n                      const char *name,\n                      int fd)\n{\n    g_autofree char *pidfile = NULL;\n\n    if (name == NULL || dir == NULL)\n        return -EINVAL;\n\n    if (!(pidfile = virPidFileBuildPath(dir, name)))\n        return -ENOMEM;\n\n    return virPidFileReleasePath(pidfile, fd);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "driver->secretEventState"
          ],
          "line": 442
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "driver->configDir"
          ],
          "line": 440
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "secretDriverLock",
          "args": [],
          "line": 437
        },
        "resolved": true,
        "details": {
          "function_name": "secretDriverLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "74-78",
          "snippet": "static void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretStateCleanup(void)\n{\n    if (!driver)\n        return -1;\n\n    secretDriverLock();\n\n    virObjectUnref(driver->secrets);\n    VIR_FREE(driver->configDir);\n\n    virObjectUnref(driver->secretEventState);\n\n    if (driver->lockFD != -1)\n        virPidFileRelease(driver->stateDir, \"driver\", driver->lockFD);\n\n    VIR_FREE(driver->stateDir);\n    secretDriverUnlock();\n    virMutexDestroy(&driver->lock);\n    VIR_FREE(driver);\n\n    return 0;\n}"
  },
  {
    "function_name": "secretUndefine",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "391-428",
    "snippet": "static int\nsecretUndefine(virSecretPtr secret)\n{\n    int ret = -1;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n    virObjectEventPtr event = NULL;\n\n    if (!(obj = secretObjFromSecret(secret)))\n        goto cleanup;\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretUndefineEnsureACL(secret->conn, def) < 0)\n        goto cleanup;\n\n    if (virSecretObjDeleteConfig(obj) < 0)\n        goto cleanup;\n\n    event = virSecretEventLifecycleNew(def->uuid,\n                                       def->usage_type,\n                                       def->usage_id,\n                                       VIR_SECRET_EVENT_UNDEFINED,\n                                       0);\n\n    virSecretObjDeleteData(obj);\n\n    virSecretObjListRemove(driver->secrets, obj);\n    virObjectUnref(obj);\n    obj = NULL;\n\n    ret = 0;\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    virObjectEventStateQueue(driver->secretEventState, event);\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventStateQueue",
          "args": [
            "driver->secretEventState",
            "event"
          ],
          "line": 425
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventStateQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "772-777",
          "snippet": "void\nvirObjectEventStateQueue(virObjectEventStatePtr state,\n                         virObjectEventPtr event)\n{\n    virObjectEventStateQueueRemote(state, event, -1);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectEventStateFlush(virObjectEventStatePtr state);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic void virObjectEventStateFlush(virObjectEventStatePtr state);\n\nvoid\nvirObjectEventStateQueue(virObjectEventStatePtr state,\n                         virObjectEventPtr event)\n{\n    virObjectEventStateQueueRemote(state, event, -1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 424
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "99-108",
          "snippet": "void\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "obj"
          ],
          "line": 418
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjListRemove",
          "args": [
            "driver->secrets",
            "obj"
          ],
          "line": 417
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListRemove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "286-307",
          "snippet": "void\nvirSecretObjListRemove(virSecretObjListPtr secrets,\n                       virSecretObjPtr obj)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virSecretDefPtr def;\n\n    if (!obj)\n        return;\n    def = obj->def;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    virObjectRef(obj);\n    virObjectUnlock(obj);\n\n    virObjectRWLockWrite(secrets);\n    virObjectLock(obj);\n    virHashRemoveEntry(secrets->objs, uuidstr);\n    virObjectUnlock(obj);\n    virObjectUnref(obj);\n    virObjectRWUnlock(secrets);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjListRemove(virSecretObjListPtr secrets,\n                       virSecretObjPtr obj)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virSecretDefPtr def;\n\n    if (!obj)\n        return;\n    def = obj->def;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    virObjectRef(obj);\n    virObjectUnlock(obj);\n\n    virObjectRWLockWrite(secrets);\n    virObjectLock(obj);\n    virHashRemoveEntry(secrets->objs, uuidstr);\n    virObjectUnlock(obj);\n    virObjectUnref(obj);\n    virObjectRWUnlock(secrets);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjDeleteData",
          "args": [
            "obj"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjDeleteData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "662-668",
          "snippet": "void\nvirSecretObjDeleteData(virSecretObjPtr obj)\n{\n    /* The configFile will already be removed, so secret won't be\n     * loaded again if this fails */\n    unlink(obj->base64File);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjDeleteData(virSecretObjPtr obj)\n{\n    /* The configFile will already be removed, so secret won't be\n     * loaded again if this fails */\n    unlink(obj->base64File);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretEventLifecycleNew",
          "args": [
            "def->uuid",
            "def->usage_type",
            "def->usage_id",
            "VIR_SECRET_EVENT_UNDEFINED",
            "0"
          ],
          "line": 409
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretEventLifecycleNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/secret_event.c",
          "lines": "248-273",
          "snippet": "virObjectEventPtr\nvirSecretEventLifecycleNew(const unsigned char *uuid,\n                           int usage_type,\n                           const char *usage_id,\n                           int type,\n                           int detail)\n{\n    virSecretEventLifecyclePtr event;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    if (virSecretEventsInitialize() < 0)\n        return NULL;\n\n    virUUIDFormat(uuid, uuidstr);\n    VIR_DEBUG(\"Event %s %d %s %d %d\", uuidstr, usage_type, usage_id, type, detail);\n    if (!(event = virObjectEventNew(virSecretEventLifecycleClass,\n                                    virSecretEventDispatchDefaultFunc,\n                                    VIR_SECRET_EVENT_ID_LIFECYCLE,\n                                    usage_type, usage_id, uuid, uuidstr)))\n        return NULL;\n\n    event->type = type;\n    event->detail = detail;\n\n    return (virObjectEventPtr)event;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"secret_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virSecretEventLifecycleClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"secret_event.h\"\n#include <config.h>\n\nstatic virClassPtr virSecretEventLifecycleClass;\n\nvirObjectEventPtr\nvirSecretEventLifecycleNew(const unsigned char *uuid,\n                           int usage_type,\n                           const char *usage_id,\n                           int type,\n                           int detail)\n{\n    virSecretEventLifecyclePtr event;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    if (virSecretEventsInitialize() < 0)\n        return NULL;\n\n    virUUIDFormat(uuid, uuidstr);\n    VIR_DEBUG(\"Event %s %d %s %d %d\", uuidstr, usage_type, usage_id, type, detail);\n    if (!(event = virObjectEventNew(virSecretEventLifecycleClass,\n                                    virSecretEventDispatchDefaultFunc,\n                                    VIR_SECRET_EVENT_ID_LIFECYCLE,\n                                    usage_type, usage_id, uuid, uuidstr)))\n        return NULL;\n\n    event->type = type;\n    event->detail = detail;\n\n    return (virObjectEventPtr)event;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjDeleteConfig",
          "args": [
            "obj"
          ],
          "line": 406
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjDeleteConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "646-659",
          "snippet": "int\nvirSecretObjDeleteConfig(virSecretObjPtr obj)\n{\n    virSecretDefPtr def = obj->def;\n\n    if (!def->isephemeral &&\n        unlink(obj->configFile) < 0 && errno != ENOENT) {\n        virReportSystemError(errno, _(\"cannot unlink '%s'\"),\n                             obj->configFile);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nint\nvirSecretObjDeleteConfig(virSecretObjPtr obj)\n{\n    virSecretDefPtr def = obj->def;\n\n    if (!def->isephemeral &&\n        unlink(obj->configFile) < 0 && errno != ENOENT) {\n        virReportSystemError(errno, _(\"cannot unlink '%s'\"),\n                             obj->configFile);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretUndefineEnsureACL",
          "args": [
            "secret->conn",
            "def"
          ],
          "line": 403
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretObjGetDef",
          "args": [
            "obj"
          ],
          "line": 402
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "709-713",
          "snippet": "virSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretObjFromSecret",
          "args": [
            "secret"
          ],
          "line": 399
        },
        "resolved": true,
        "details": {
          "function_name": "secretObjFromSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "88-101",
          "snippet": "static virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretUndefine(virSecretPtr secret)\n{\n    int ret = -1;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n    virObjectEventPtr event = NULL;\n\n    if (!(obj = secretObjFromSecret(secret)))\n        goto cleanup;\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretUndefineEnsureACL(secret->conn, def) < 0)\n        goto cleanup;\n\n    if (virSecretObjDeleteConfig(obj) < 0)\n        goto cleanup;\n\n    event = virSecretEventLifecycleNew(def->uuid,\n                                       def->usage_type,\n                                       def->usage_id,\n                                       VIR_SECRET_EVENT_UNDEFINED,\n                                       0);\n\n    virSecretObjDeleteData(obj);\n\n    virSecretObjListRemove(driver->secrets, obj);\n    virObjectUnref(obj);\n    obj = NULL;\n\n    ret = 0;\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    virObjectEventStateQueue(driver->secretEventState, event);\n\n    return ret;\n}"
  },
  {
    "function_name": "secretGetValue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "353-388",
    "snippet": "static unsigned char *\nsecretGetValue(virSecretPtr secret,\n               size_t *value_size,\n               unsigned int flags,\n               unsigned int internalFlags)\n{\n    unsigned char *ret = NULL;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n\n    virCheckFlags(0, NULL);\n\n    if (!(obj = secretObjFromSecret(secret)))\n        goto cleanup;\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretGetValueEnsureACL(secret->conn, def) < 0)\n        goto cleanup;\n\n    if ((internalFlags & VIR_SECRET_GET_VALUE_INTERNAL_CALL) == 0 &&\n        def->isprivate) {\n        virReportError(VIR_ERR_INVALID_SECRET, \"%s\",\n                       _(\"secret is private\"));\n        goto cleanup;\n    }\n\n    if (!(ret = virSecretObjGetValue(obj)))\n        goto cleanup;\n\n    *value_size = virSecretObjGetValueSize(obj);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecretObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 385
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "99-108",
          "snippet": "void\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjGetValueSize",
          "args": [
            "obj"
          ],
          "line": 382
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjGetValueSize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "785-789",
          "snippet": "size_t\nvirSecretObjGetValueSize(virSecretObjPtr obj)\n{\n    return obj->value_size;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nsize_t\nvirSecretObjGetValueSize(virSecretObjPtr obj)\n{\n    return obj->value_size;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INVALID_SECRET",
            "\"%s\"",
            "_(\"secret is private\")"
          ],
          "line": 374
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"secret is private\""
          ],
          "line": 375
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretGetValueEnsureACL",
          "args": [
            "secret->conn",
            "def"
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretObjGetDef",
          "args": [
            "obj"
          ],
          "line": 368
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "709-713",
          "snippet": "virSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretObjFromSecret",
          "args": [
            "secret"
          ],
          "line": 365
        },
        "resolved": true,
        "details": {
          "function_name": "secretObjFromSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "88-101",
          "snippet": "static virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "NULL"
          ],
          "line": 363
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic unsigned char *\nsecretGetValue(virSecretPtr secret,\n               size_t *value_size,\n               unsigned int flags,\n               unsigned int internalFlags)\n{\n    unsigned char *ret = NULL;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n\n    virCheckFlags(0, NULL);\n\n    if (!(obj = secretObjFromSecret(secret)))\n        goto cleanup;\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretGetValueEnsureACL(secret->conn, def) < 0)\n        goto cleanup;\n\n    if ((internalFlags & VIR_SECRET_GET_VALUE_INTERNAL_CALL) == 0 &&\n        def->isprivate) {\n        virReportError(VIR_ERR_INVALID_SECRET, \"%s\",\n                       _(\"secret is private\"));\n        goto cleanup;\n    }\n\n    if (!(ret = virSecretObjGetValue(obj)))\n        goto cleanup;\n\n    *value_size = virSecretObjGetValueSize(obj);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n\n    return ret;\n}"
  },
  {
    "function_name": "secretSetValue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "317-350",
    "snippet": "static int\nsecretSetValue(virSecretPtr secret,\n               const unsigned char *value,\n               size_t value_size,\n               unsigned int flags)\n{\n    int ret = -1;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n    virObjectEventPtr event = NULL;\n\n    virCheckFlags(0, -1);\n\n    if (!(obj = secretObjFromSecret(secret)))\n        goto cleanup;\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretSetValueEnsureACL(secret->conn, def) < 0)\n        goto cleanup;\n\n    if (virSecretObjSetValue(obj, value, value_size) < 0)\n        goto cleanup;\n\n    event = virSecretEventValueChangedNew(def->uuid,\n                                          def->usage_type,\n                                          def->usage_id);\n    ret = 0;\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    virObjectEventStateQueue(driver->secretEventState, event);\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventStateQueue",
          "args": [
            "driver->secretEventState",
            "event"
          ],
          "line": 347
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventStateQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "772-777",
          "snippet": "void\nvirObjectEventStateQueue(virObjectEventStatePtr state,\n                         virObjectEventPtr event)\n{\n    virObjectEventStateQueueRemote(state, event, -1);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectEventStateFlush(virObjectEventStatePtr state);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic void virObjectEventStateFlush(virObjectEventStatePtr state);\n\nvoid\nvirObjectEventStateQueue(virObjectEventStatePtr state,\n                         virObjectEventPtr event)\n{\n    virObjectEventStateQueueRemote(state, event, -1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 346
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "99-108",
          "snippet": "void\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretEventValueChangedNew",
          "args": [
            "def->uuid",
            "def->usage_type",
            "def->usage_id"
          ],
          "line": 340
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretEventValueChangedNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/secret_event.c",
          "lines": "282-302",
          "snippet": "virObjectEventPtr\nvirSecretEventValueChangedNew(const unsigned char *uuid,\n                              int usage_type,\n                              const char *usage_id)\n{\n    virSecretEventValueChangedPtr event;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    if (virSecretEventsInitialize() < 0)\n        return NULL;\n\n    virUUIDFormat(uuid, uuidstr);\n    VIR_DEBUG(\"Event %s %d %s\", uuidstr, usage_type, usage_id);\n    if (!(event = virObjectEventNew(virSecretEventValueChangedClass,\n                                    virSecretEventDispatchDefaultFunc,\n                                    VIR_SECRET_EVENT_ID_VALUE_CHANGED,\n                                    usage_type, usage_id, uuid, uuidstr)))\n        return NULL;\n\n    return (virObjectEventPtr)event;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"secret_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virSecretEventValueChangedClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"secret_event.h\"\n#include <config.h>\n\nstatic virClassPtr virSecretEventValueChangedClass;\n\nvirObjectEventPtr\nvirSecretEventValueChangedNew(const unsigned char *uuid,\n                              int usage_type,\n                              const char *usage_id)\n{\n    virSecretEventValueChangedPtr event;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    if (virSecretEventsInitialize() < 0)\n        return NULL;\n\n    virUUIDFormat(uuid, uuidstr);\n    VIR_DEBUG(\"Event %s %d %s\", uuidstr, usage_type, usage_id);\n    if (!(event = virObjectEventNew(virSecretEventValueChangedClass,\n                                    virSecretEventDispatchDefaultFunc,\n                                    VIR_SECRET_EVENT_ID_VALUE_CHANGED,\n                                    usage_type, usage_id, uuid, uuidstr)))\n        return NULL;\n\n    return (virObjectEventPtr)event;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjSetValue",
          "args": [
            "obj",
            "value",
            "value_size"
          ],
          "line": 337
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjSetValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "746-782",
          "snippet": "int\nvirSecretObjSetValue(virSecretObjPtr obj,\n                     const unsigned char *value,\n                     size_t value_size)\n{\n    virSecretDefPtr def = obj->def;\n    g_autofree unsigned char *old_value = NULL;\n    g_autofree unsigned char *new_value = NULL;\n    size_t old_value_size;\n\n    if (VIR_ALLOC_N(new_value, value_size) < 0)\n        return -1;\n\n    old_value = obj->value;\n    old_value_size = obj->value_size;\n\n    memcpy(new_value, value, value_size);\n    obj->value = g_steal_pointer(&new_value);\n    obj->value_size = value_size;\n\n    if (!def->isephemeral && virSecretObjSaveData(obj) < 0)\n        goto error;\n\n    /* Saved successfully - drop old value */\n    if (old_value)\n        memset(old_value, 0, old_value_size);\n\n    return 0;\n\n error:\n    /* Error - restore previous state and free new value */\n    new_value = g_steal_pointer(&obj->value);\n    obj->value = g_steal_pointer(&old_value);\n    obj->value_size = old_value_size;\n    memset(new_value, 0, value_size);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nint\nvirSecretObjSetValue(virSecretObjPtr obj,\n                     const unsigned char *value,\n                     size_t value_size)\n{\n    virSecretDefPtr def = obj->def;\n    g_autofree unsigned char *old_value = NULL;\n    g_autofree unsigned char *new_value = NULL;\n    size_t old_value_size;\n\n    if (VIR_ALLOC_N(new_value, value_size) < 0)\n        return -1;\n\n    old_value = obj->value;\n    old_value_size = obj->value_size;\n\n    memcpy(new_value, value, value_size);\n    obj->value = g_steal_pointer(&new_value);\n    obj->value_size = value_size;\n\n    if (!def->isephemeral && virSecretObjSaveData(obj) < 0)\n        goto error;\n\n    /* Saved successfully - drop old value */\n    if (old_value)\n        memset(old_value, 0, old_value_size);\n\n    return 0;\n\n error:\n    /* Error - restore previous state and free new value */\n    new_value = g_steal_pointer(&obj->value);\n    obj->value = g_steal_pointer(&old_value);\n    obj->value_size = old_value_size;\n    memset(new_value, 0, value_size);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretSetValueEnsureACL",
          "args": [
            "secret->conn",
            "def"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretObjGetDef",
          "args": [
            "obj"
          ],
          "line": 333
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "709-713",
          "snippet": "virSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretObjFromSecret",
          "args": [
            "secret"
          ],
          "line": 330
        },
        "resolved": true,
        "details": {
          "function_name": "secretObjFromSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "88-101",
          "snippet": "static virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretSetValue(virSecretPtr secret,\n               const unsigned char *value,\n               size_t value_size,\n               unsigned int flags)\n{\n    int ret = -1;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n    virObjectEventPtr event = NULL;\n\n    virCheckFlags(0, -1);\n\n    if (!(obj = secretObjFromSecret(secret)))\n        goto cleanup;\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretSetValueEnsureACL(secret->conn, def) < 0)\n        goto cleanup;\n\n    if (virSecretObjSetValue(obj, value, value_size) < 0)\n        goto cleanup;\n\n    event = virSecretEventValueChangedNew(def->uuid,\n                                          def->usage_type,\n                                          def->usage_id);\n    ret = 0;\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    virObjectEventStateQueue(driver->secretEventState, event);\n\n    return ret;\n}"
  },
  {
    "function_name": "secretGetXMLDesc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "291-314",
    "snippet": "static char *\nsecretGetXMLDesc(virSecretPtr secret,\n                 unsigned int flags)\n{\n    char *ret = NULL;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n\n    virCheckFlags(0, NULL);\n\n    if (!(obj = secretObjFromSecret(secret)))\n        goto cleanup;\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretGetXMLDescEnsureACL(secret->conn, def) < 0)\n        goto cleanup;\n\n    ret = virSecretDefFormat(def);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecretObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "99-108",
          "snippet": "void\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretDefFormat",
          "args": [
            "def"
          ],
          "line": 308
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretDefFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/secret_conf.c",
          "lines": "277-306",
          "snippet": "char *\nvirSecretDefFormat(const virSecretDef *def)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    const unsigned char *uuid;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virBufferAsprintf(&buf, \"<secret ephemeral='%s' private='%s'>\\n\",\n                      def->isephemeral ? \"yes\" : \"no\",\n                      def->isprivate ? \"yes\" : \"no\");\n\n    uuid = def->uuid;\n    virUUIDFormat(uuid, uuidstr);\n    virBufferAdjustIndent(&buf, 2);\n    virBufferEscapeString(&buf, \"<uuid>%s</uuid>\\n\", uuidstr);\n    if (def->description != NULL)\n        virBufferEscapeString(&buf, \"<description>%s</description>\\n\",\n                              def->description);\n    if (def->usage_type != VIR_SECRET_USAGE_TYPE_NONE &&\n        virSecretDefFormatUsage(&buf, def) < 0)\n        goto error;\n    virBufferAdjustIndent(&buf, -2);\n    virBufferAddLit(&buf, \"</secret>\\n\");\n\n    return virBufferContentAndReset(&buf);\n\n error:\n    virBufferFreeAndReset(&buf);\n    return NULL;\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virerror.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virerror.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include <config.h>\n\nchar *\nvirSecretDefFormat(const virSecretDef *def)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    const unsigned char *uuid;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virBufferAsprintf(&buf, \"<secret ephemeral='%s' private='%s'>\\n\",\n                      def->isephemeral ? \"yes\" : \"no\",\n                      def->isprivate ? \"yes\" : \"no\");\n\n    uuid = def->uuid;\n    virUUIDFormat(uuid, uuidstr);\n    virBufferAdjustIndent(&buf, 2);\n    virBufferEscapeString(&buf, \"<uuid>%s</uuid>\\n\", uuidstr);\n    if (def->description != NULL)\n        virBufferEscapeString(&buf, \"<description>%s</description>\\n\",\n                              def->description);\n    if (def->usage_type != VIR_SECRET_USAGE_TYPE_NONE &&\n        virSecretDefFormatUsage(&buf, def) < 0)\n        goto error;\n    virBufferAdjustIndent(&buf, -2);\n    virBufferAddLit(&buf, \"</secret>\\n\");\n\n    return virBufferContentAndReset(&buf);\n\n error:\n    virBufferFreeAndReset(&buf);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretGetXMLDescEnsureACL",
          "args": [
            "secret->conn",
            "def"
          ],
          "line": 305
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretObjGetDef",
          "args": [
            "obj"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "709-713",
          "snippet": "virSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "secretObjFromSecret",
          "args": [
            "secret"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "secretObjFromSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
          "lines": "88-101",
          "snippet": "static virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"secret_event.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virstring.h\"",
            "#include \"configmake.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viruuid.h\"",
            "#include \"virthread.h\"",
            "#include \"secret_driver.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"driver.h\"",
            "#include \"datatypes.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virSecretDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "NULL"
          ],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic char *\nsecretGetXMLDesc(virSecretPtr secret,\n                 unsigned int flags)\n{\n    char *ret = NULL;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n\n    virCheckFlags(0, NULL);\n\n    if (!(obj = secretObjFromSecret(secret)))\n        goto cleanup;\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretGetXMLDescEnsureACL(secret->conn, def) < 0)\n        goto cleanup;\n\n    ret = virSecretDefFormat(def);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n\n    return ret;\n}"
  },
  {
    "function_name": "secretDefineXML",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "211-288",
    "snippet": "static virSecretPtr\nsecretDefineXML(virConnectPtr conn,\n                const char *xml,\n                unsigned int flags)\n{\n    virSecretPtr ret = NULL;\n    virSecretObjPtr obj = NULL;\n    virSecretDefPtr objDef;\n    virSecretDefPtr backup = NULL;\n    virSecretDefPtr def;\n    virObjectEventPtr event = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (!(def = virSecretDefParseString(xml)))\n        return NULL;\n\n    if (virSecretDefineXMLEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    if (!(obj = virSecretObjListAdd(driver->secrets, def,\n                                    driver->configDir, &backup)))\n        goto cleanup;\n    objDef = g_steal_pointer(&def);\n\n    if (!objDef->isephemeral) {\n        if (backup && backup->isephemeral) {\n            if (virSecretObjSaveData(obj) < 0)\n                goto restore_backup;\n        }\n\n        if (virSecretObjSaveConfig(obj) < 0) {\n            if (backup && backup->isephemeral) {\n                /* Undo the virSecretObjSaveData() above; ignore errors */\n                virSecretObjDeleteData(obj);\n            }\n            goto restore_backup;\n        }\n    } else if (backup && !backup->isephemeral) {\n        if (virSecretObjDeleteConfig(obj) < 0)\n            goto restore_backup;\n\n        virSecretObjDeleteData(obj);\n    }\n    /* Saved successfully - drop old values */\n    virSecretDefFree(backup);\n\n    event = virSecretEventLifecycleNew(objDef->uuid,\n                                       objDef->usage_type,\n                                       objDef->usage_id,\n                                       VIR_SECRET_EVENT_DEFINED,\n                                       0);\n\n    ret = virGetSecret(conn,\n                       objDef->uuid,\n                       objDef->usage_type,\n                       objDef->usage_id);\n    goto cleanup;\n\n restore_backup:\n    /* If we have a backup, then secret was defined before, so just restore\n     * the backup; otherwise, this is a new secret, thus remove it. */\n    if (backup) {\n        virSecretObjSetDef(obj, backup);\n        def = g_steal_pointer(&objDef);\n    } else {\n        virSecretObjListRemove(driver->secrets, obj);\n        virObjectUnref(obj);\n        obj = NULL;\n    }\n\n cleanup:\n    virSecretDefFree(def);\n    virSecretObjEndAPI(&obj);\n    virObjectEventStateQueue(driver->secretEventState, event);\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventStateQueue",
          "args": [
            "driver->secretEventState",
            "event"
          ],
          "line": 285
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventStateQueue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "772-777",
          "snippet": "void\nvirObjectEventStateQueue(virObjectEventStatePtr state,\n                         virObjectEventPtr event)\n{\n    virObjectEventStateQueueRemote(state, event, -1);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectEventStateFlush(virObjectEventStatePtr state);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic void virObjectEventStateFlush(virObjectEventStatePtr state);\n\nvoid\nvirObjectEventStateQueue(virObjectEventStatePtr state,\n                         virObjectEventPtr event)\n{\n    virObjectEventStateQueueRemote(state, event, -1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "99-108",
          "snippet": "void\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretDefFree",
          "args": [
            "def"
          ],
          "line": 283
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretDefFree",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/secret_conf.c",
          "lines": "40-49",
          "snippet": "void\nvirSecretDefFree(virSecretDefPtr def)\n{\n    if (def == NULL)\n        return;\n\n    VIR_FREE(def->description);\n    VIR_FREE(def->usage_id);\n    VIR_FREE(def);\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virerror.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virerror.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvoid\nvirSecretDefFree(virSecretDefPtr def)\n{\n    if (def == NULL)\n        return;\n\n    VIR_FREE(def->description);\n    VIR_FREE(def->usage_id);\n    VIR_FREE(def);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virObjectUnref",
          "args": [
            "obj"
          ],
          "line": 278
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectUnref",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virobject.c",
          "lines": "338-365",
          "snippet": "bool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virprobe.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virthread.h\"",
            "#include \"virobject.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectLockableDispose(void *anyobj);",
            "static void virObjectRWLockableDispose(void *anyobj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virprobe.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virthread.h\"\n#include \"virobject.h\"\n#include <config.h>\n\nstatic void virObjectLockableDispose(void *anyobj);\nstatic void virObjectRWLockableDispose(void *anyobj);\n\nbool\nvirObjectUnref(void *anyobj)\n{\n    virObjectPtr obj = anyobj;\n\n    if (VIR_OBJECT_NOTVALID(obj))\n        return false;\n\n    bool lastRef = !!g_atomic_int_dec_and_test(&obj->u.s.refs);\n    PROBE(OBJECT_UNREF, \"obj=%p\", obj);\n    if (lastRef) {\n        PROBE(OBJECT_DISPOSE, \"obj=%p\", obj);\n        virClassPtr klass = obj->klass;\n        while (klass) {\n            if (klass->dispose)\n                klass->dispose(obj);\n            klass = klass->parent;\n        }\n\n        /* Clear & poison object */\n        memset(obj, 0, obj->klass->objectSize);\n        obj->u.s.magic = 0xDEADBEEF;\n        obj->klass = (void*)0xDEADBEEF;\n        VIR_FREE(obj);\n    }\n\n    return !lastRef;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjListRemove",
          "args": [
            "driver->secrets",
            "obj"
          ],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListRemove",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "286-307",
          "snippet": "void\nvirSecretObjListRemove(virSecretObjListPtr secrets,\n                       virSecretObjPtr obj)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virSecretDefPtr def;\n\n    if (!obj)\n        return;\n    def = obj->def;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    virObjectRef(obj);\n    virObjectUnlock(obj);\n\n    virObjectRWLockWrite(secrets);\n    virObjectLock(obj);\n    virHashRemoveEntry(secrets->objs, uuidstr);\n    virObjectUnlock(obj);\n    virObjectUnref(obj);\n    virObjectRWUnlock(secrets);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjListRemove(virSecretObjListPtr secrets,\n                       virSecretObjPtr obj)\n{\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n    virSecretDefPtr def;\n\n    if (!obj)\n        return;\n    def = obj->def;\n\n    virUUIDFormat(def->uuid, uuidstr);\n    virObjectRef(obj);\n    virObjectUnlock(obj);\n\n    virObjectRWLockWrite(secrets);\n    virObjectLock(obj);\n    virHashRemoveEntry(secrets->objs, uuidstr);\n    virObjectUnlock(obj);\n    virObjectUnref(obj);\n    virObjectRWUnlock(secrets);\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&objDef"
          ],
          "line": 275
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretObjSetDef",
          "args": [
            "obj",
            "backup"
          ],
          "line": 274
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjSetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "716-721",
          "snippet": "void\nvirSecretObjSetDef(virSecretObjPtr obj,\n                   virSecretDefPtr def)\n{\n    obj->def = def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjSetDef(virSecretObjPtr obj,\n                   virSecretDefPtr def)\n{\n    obj->def = def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetSecret",
          "args": [
            "conn",
            "objDef->uuid",
            "objDef->usage_type",
            "objDef->usage_id"
          ],
          "line": 264
        },
        "resolved": true,
        "details": {
          "function_name": "virGetSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/datatypes.c",
          "lines": "729-755",
          "snippet": "virSecretPtr\nvirGetSecret(virConnectPtr conn, const unsigned char *uuid,\n             int usageType, const char *usageID)\n{\n    virSecretPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(uuid, error);\n\n    if (!(ret = virObjectNew(virSecretClass)))\n        return NULL;\n\n    memcpy(&(ret->uuid[0]), uuid, VIR_UUID_BUFLEN);\n    ret->usageType = usageType;\n    ret->usageID = g_strdup(NULLSTR_EMPTY(usageID));\n\n    ret->conn = virObjectRef(conn);\n\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virClassPtr virSecretClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirClassPtr virSecretClass;\n\nvirSecretPtr\nvirGetSecret(virConnectPtr conn, const unsigned char *uuid,\n             int usageType, const char *usageID)\n{\n    virSecretPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(uuid, error);\n\n    if (!(ret = virObjectNew(virSecretClass)))\n        return NULL;\n\n    memcpy(&(ret->uuid[0]), uuid, VIR_UUID_BUFLEN);\n    ret->usageType = usageType;\n    ret->usageID = g_strdup(NULLSTR_EMPTY(usageID));\n\n    ret->conn = virObjectRef(conn);\n\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretEventLifecycleNew",
          "args": [
            "objDef->uuid",
            "objDef->usage_type",
            "objDef->usage_id",
            "VIR_SECRET_EVENT_DEFINED",
            "0"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretEventLifecycleNew",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/secret_event.c",
          "lines": "248-273",
          "snippet": "virObjectEventPtr\nvirSecretEventLifecycleNew(const unsigned char *uuid,\n                           int usage_type,\n                           const char *usage_id,\n                           int type,\n                           int detail)\n{\n    virSecretEventLifecyclePtr event;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    if (virSecretEventsInitialize() < 0)\n        return NULL;\n\n    virUUIDFormat(uuid, uuidstr);\n    VIR_DEBUG(\"Event %s %d %s %d %d\", uuidstr, usage_type, usage_id, type, detail);\n    if (!(event = virObjectEventNew(virSecretEventLifecycleClass,\n                                    virSecretEventDispatchDefaultFunc,\n                                    VIR_SECRET_EVENT_ID_LIFECYCLE,\n                                    usage_type, usage_id, uuid, uuidstr)))\n        return NULL;\n\n    event->type = type;\n    event->detail = detail;\n\n    return (virObjectEventPtr)event;\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"secret_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virSecretEventLifecycleClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"secret_event.h\"\n#include <config.h>\n\nstatic virClassPtr virSecretEventLifecycleClass;\n\nvirObjectEventPtr\nvirSecretEventLifecycleNew(const unsigned char *uuid,\n                           int usage_type,\n                           const char *usage_id,\n                           int type,\n                           int detail)\n{\n    virSecretEventLifecyclePtr event;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    if (virSecretEventsInitialize() < 0)\n        return NULL;\n\n    virUUIDFormat(uuid, uuidstr);\n    VIR_DEBUG(\"Event %s %d %s %d %d\", uuidstr, usage_type, usage_id, type, detail);\n    if (!(event = virObjectEventNew(virSecretEventLifecycleClass,\n                                    virSecretEventDispatchDefaultFunc,\n                                    VIR_SECRET_EVENT_ID_LIFECYCLE,\n                                    usage_type, usage_id, uuid, uuidstr)))\n        return NULL;\n\n    event->type = type;\n    event->detail = detail;\n\n    return (virObjectEventPtr)event;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjDeleteData",
          "args": [
            "obj"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjDeleteData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "662-668",
          "snippet": "void\nvirSecretObjDeleteData(virSecretObjPtr obj)\n{\n    /* The configFile will already be removed, so secret won't be\n     * loaded again if this fails */\n    unlink(obj->base64File);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjDeleteData(virSecretObjPtr obj)\n{\n    /* The configFile will already be removed, so secret won't be\n     * loaded again if this fails */\n    unlink(obj->base64File);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjDeleteConfig",
          "args": [
            "obj"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjDeleteConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "646-659",
          "snippet": "int\nvirSecretObjDeleteConfig(virSecretObjPtr obj)\n{\n    virSecretDefPtr def = obj->def;\n\n    if (!def->isephemeral &&\n        unlink(obj->configFile) < 0 && errno != ENOENT) {\n        virReportSystemError(errno, _(\"cannot unlink '%s'\"),\n                             obj->configFile);\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nint\nvirSecretObjDeleteConfig(virSecretObjPtr obj)\n{\n    virSecretDefPtr def = obj->def;\n\n    if (!def->isephemeral &&\n        unlink(obj->configFile) < 0 && errno != ENOENT) {\n        virReportSystemError(errno, _(\"cannot unlink '%s'\"),\n                             obj->configFile);\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjSaveConfig",
          "args": [
            "obj"
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjSaveConfig",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "677-689",
          "snippet": "int\nvirSecretObjSaveConfig(virSecretObjPtr obj)\n{\n    g_autofree char *xml = NULL;\n\n    if (!(xml = virSecretDefFormat(obj->def)))\n        return -1;\n\n    if (virFileRewriteStr(obj->configFile, S_IRUSR | S_IWUSR, xml) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nint\nvirSecretObjSaveConfig(virSecretObjPtr obj)\n{\n    g_autofree char *xml = NULL;\n\n    if (!(xml = virSecretDefFormat(obj->def)))\n        return -1;\n\n    if (virFileRewriteStr(obj->configFile, S_IRUSR | S_IWUSR, xml) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjSaveData",
          "args": [
            "obj"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjSaveData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "692-706",
          "snippet": "int\nvirSecretObjSaveData(virSecretObjPtr obj)\n{\n    g_autofree char *base64 = NULL;\n\n    if (!obj->value)\n        return 0;\n\n    base64 = g_base64_encode(obj->value, obj->value_size);\n\n    if (virFileRewriteStr(obj->base64File, S_IRUSR | S_IWUSR, base64) < 0)\n        return -1;\n\n    return 0;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nint\nvirSecretObjSaveData(virSecretObjPtr obj)\n{\n    g_autofree char *base64 = NULL;\n\n    if (!obj->value)\n        return 0;\n\n    base64 = g_base64_encode(obj->value, obj->value_size);\n\n    if (virFileRewriteStr(obj->base64File, S_IRUSR | S_IWUSR, base64) < 0)\n        return -1;\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_steal_pointer",
          "args": [
            "&def"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretObjListAdd",
          "args": [
            "driver->secrets",
            "def",
            "driver->configDir",
            "&backup"
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListAdd",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "321-402",
          "snippet": "virSecretObjPtr\nvirSecretObjListAdd(virSecretObjListPtr secrets,\n                    virSecretDefPtr newdef,\n                    const char *configDir,\n                    virSecretDefPtr *oldDef)\n{\n    virSecretObjPtr obj;\n    virSecretDefPtr objdef;\n    virSecretObjPtr ret = NULL;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virObjectRWLockWrite(secrets);\n\n    if (oldDef)\n        *oldDef = NULL;\n\n    virUUIDFormat(newdef->uuid, uuidstr);\n\n    /* Is there a secret already matching this UUID */\n    if ((obj = virSecretObjListFindByUUIDLocked(secrets, uuidstr))) {\n        virObjectLock(obj);\n        objdef = obj->def;\n\n        if (STRNEQ_NULLABLE(objdef->usage_id, newdef->usage_id)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"a secret with UUID %s is already defined for \"\n                             \"use with %s\"),\n                           uuidstr, objdef->usage_id);\n            goto cleanup;\n        }\n\n        if (objdef->isprivate && !newdef->isprivate) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"cannot change private flag on existing secret\"));\n            goto cleanup;\n        }\n\n        if (oldDef)\n            *oldDef = objdef;\n        else\n            virSecretDefFree(objdef);\n        obj->def = newdef;\n    } else {\n        /* No existing secret with same UUID,\n         * try look for matching usage instead */\n        if ((obj = virSecretObjListFindByUsageLocked(secrets,\n                                                     newdef->usage_type,\n                                                     newdef->usage_id))) {\n            virObjectLock(obj);\n            objdef = obj->def;\n            virUUIDFormat(objdef->uuid, uuidstr);\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"a secret with UUID %s already defined for \"\n                             \"use with %s\"),\n                           uuidstr, newdef->usage_id);\n            goto cleanup;\n        }\n\n        if (!(obj = virSecretObjNew()))\n            goto cleanup;\n\n        /* Generate the possible configFile and base64File strings\n         * using the configDir, uuidstr, and appropriate suffix\n         */\n        if (!(obj->configFile = virFileBuildPath(configDir, uuidstr, \".xml\")) ||\n            !(obj->base64File = virFileBuildPath(configDir, uuidstr, \".base64\")))\n            goto cleanup;\n\n        if (virHashAddEntry(secrets->objs, uuidstr, obj) < 0)\n            goto cleanup;\n\n        obj->def = newdef;\n        virObjectRef(obj);\n    }\n\n    ret = g_steal_pointer(&obj);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    virObjectRWUnlock(secrets);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretObjPtr\nvirSecretObjListAdd(virSecretObjListPtr secrets,\n                    virSecretDefPtr newdef,\n                    const char *configDir,\n                    virSecretDefPtr *oldDef)\n{\n    virSecretObjPtr obj;\n    virSecretDefPtr objdef;\n    virSecretObjPtr ret = NULL;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virObjectRWLockWrite(secrets);\n\n    if (oldDef)\n        *oldDef = NULL;\n\n    virUUIDFormat(newdef->uuid, uuidstr);\n\n    /* Is there a secret already matching this UUID */\n    if ((obj = virSecretObjListFindByUUIDLocked(secrets, uuidstr))) {\n        virObjectLock(obj);\n        objdef = obj->def;\n\n        if (STRNEQ_NULLABLE(objdef->usage_id, newdef->usage_id)) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"a secret with UUID %s is already defined for \"\n                             \"use with %s\"),\n                           uuidstr, objdef->usage_id);\n            goto cleanup;\n        }\n\n        if (objdef->isprivate && !newdef->isprivate) {\n            virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                           _(\"cannot change private flag on existing secret\"));\n            goto cleanup;\n        }\n\n        if (oldDef)\n            *oldDef = objdef;\n        else\n            virSecretDefFree(objdef);\n        obj->def = newdef;\n    } else {\n        /* No existing secret with same UUID,\n         * try look for matching usage instead */\n        if ((obj = virSecretObjListFindByUsageLocked(secrets,\n                                                     newdef->usage_type,\n                                                     newdef->usage_id))) {\n            virObjectLock(obj);\n            objdef = obj->def;\n            virUUIDFormat(objdef->uuid, uuidstr);\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"a secret with UUID %s already defined for \"\n                             \"use with %s\"),\n                           uuidstr, newdef->usage_id);\n            goto cleanup;\n        }\n\n        if (!(obj = virSecretObjNew()))\n            goto cleanup;\n\n        /* Generate the possible configFile and base64File strings\n         * using the configDir, uuidstr, and appropriate suffix\n         */\n        if (!(obj->configFile = virFileBuildPath(configDir, uuidstr, \".xml\")) ||\n            !(obj->base64File = virFileBuildPath(configDir, uuidstr, \".base64\")))\n            goto cleanup;\n\n        if (virHashAddEntry(secrets->objs, uuidstr, obj) < 0)\n            goto cleanup;\n\n        obj->def = newdef;\n        virObjectRef(obj);\n    }\n\n    ret = g_steal_pointer(&obj);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    virObjectRWUnlock(secrets);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretDefineXMLEnsureACL",
          "args": [
            "conn",
            "def"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretDefParseString",
          "args": [
            "xml"
          ],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretDefParseString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/secret_conf.c",
          "lines": "214-218",
          "snippet": "virSecretDefPtr\nvirSecretDefParseString(const char *xmlStr)\n{\n    return virSecretDefParse(xmlStr, NULL);\n}",
          "includes": [
            "#include \"viruuid.h\"",
            "#include \"virxml.h\"",
            "#include \"virstring.h\"",
            "#include \"virsecret.h\"",
            "#include \"virerror.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"secret_conf.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"virbuffer.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"viruuid.h\"\n#include \"virxml.h\"\n#include \"virstring.h\"\n#include \"virsecret.h\"\n#include \"virerror.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"virbuffer.h\"\n#include \"internal.h\"\n#include <config.h>\n\nvirSecretDefPtr\nvirSecretDefParseString(const char *xmlStr)\n{\n    return virSecretDefParse(xmlStr, NULL);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "NULL"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virSecretPtr\nsecretDefineXML(virConnectPtr conn,\n                const char *xml,\n                unsigned int flags)\n{\n    virSecretPtr ret = NULL;\n    virSecretObjPtr obj = NULL;\n    virSecretDefPtr objDef;\n    virSecretDefPtr backup = NULL;\n    virSecretDefPtr def;\n    virObjectEventPtr event = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (!(def = virSecretDefParseString(xml)))\n        return NULL;\n\n    if (virSecretDefineXMLEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    if (!(obj = virSecretObjListAdd(driver->secrets, def,\n                                    driver->configDir, &backup)))\n        goto cleanup;\n    objDef = g_steal_pointer(&def);\n\n    if (!objDef->isephemeral) {\n        if (backup && backup->isephemeral) {\n            if (virSecretObjSaveData(obj) < 0)\n                goto restore_backup;\n        }\n\n        if (virSecretObjSaveConfig(obj) < 0) {\n            if (backup && backup->isephemeral) {\n                /* Undo the virSecretObjSaveData() above; ignore errors */\n                virSecretObjDeleteData(obj);\n            }\n            goto restore_backup;\n        }\n    } else if (backup && !backup->isephemeral) {\n        if (virSecretObjDeleteConfig(obj) < 0)\n            goto restore_backup;\n\n        virSecretObjDeleteData(obj);\n    }\n    /* Saved successfully - drop old values */\n    virSecretDefFree(backup);\n\n    event = virSecretEventLifecycleNew(objDef->uuid,\n                                       objDef->usage_type,\n                                       objDef->usage_id,\n                                       VIR_SECRET_EVENT_DEFINED,\n                                       0);\n\n    ret = virGetSecret(conn,\n                       objDef->uuid,\n                       objDef->usage_type,\n                       objDef->usage_id);\n    goto cleanup;\n\n restore_backup:\n    /* If we have a backup, then secret was defined before, so just restore\n     * the backup; otherwise, this is a new secret, thus remove it. */\n    if (backup) {\n        virSecretObjSetDef(obj, backup);\n        def = g_steal_pointer(&objDef);\n    } else {\n        virSecretObjListRemove(driver->secrets, obj);\n        virObjectUnref(obj);\n        obj = NULL;\n    }\n\n cleanup:\n    virSecretDefFree(def);\n    virSecretObjEndAPI(&obj);\n    virObjectEventStateQueue(driver->secretEventState, event);\n\n    return ret;\n}"
  },
  {
    "function_name": "secretLookupByUsage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "180-208",
    "snippet": "static virSecretPtr\nsecretLookupByUsage(virConnectPtr conn,\n                    int usageType,\n                    const char *usageID)\n{\n    virSecretPtr ret = NULL;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n\n    if (!(obj = virSecretObjListFindByUsage(driver->secrets,\n                                            usageType, usageID))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching usage '%s'\"), usageID);\n        goto cleanup;\n    }\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretLookupByUsageEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    ret = virGetSecret(conn,\n                       def->uuid,\n                       def->usage_type,\n                       def->usage_id);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecretObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "99-108",
          "snippet": "void\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetSecret",
          "args": [
            "conn",
            "def->uuid",
            "def->usage_type",
            "def->usage_id"
          ],
          "line": 200
        },
        "resolved": true,
        "details": {
          "function_name": "virGetSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/datatypes.c",
          "lines": "729-755",
          "snippet": "virSecretPtr\nvirGetSecret(virConnectPtr conn, const unsigned char *uuid,\n             int usageType, const char *usageID)\n{\n    virSecretPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(uuid, error);\n\n    if (!(ret = virObjectNew(virSecretClass)))\n        return NULL;\n\n    memcpy(&(ret->uuid[0]), uuid, VIR_UUID_BUFLEN);\n    ret->usageType = usageType;\n    ret->usageID = g_strdup(NULLSTR_EMPTY(usageID));\n\n    ret->conn = virObjectRef(conn);\n\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virClassPtr virSecretClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirClassPtr virSecretClass;\n\nvirSecretPtr\nvirGetSecret(virConnectPtr conn, const unsigned char *uuid,\n             int usageType, const char *usageID)\n{\n    virSecretPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(uuid, error);\n\n    if (!(ret = virObjectNew(virSecretClass)))\n        return NULL;\n\n    memcpy(&(ret->uuid[0]), uuid, VIR_UUID_BUFLEN);\n    ret->usageType = usageType;\n    ret->usageID = g_strdup(NULLSTR_EMPTY(usageID));\n\n    ret->conn = virObjectRef(conn);\n\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretLookupByUsageEnsureACL",
          "args": [
            "conn",
            "def"
          ],
          "line": 197
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretObjGetDef",
          "args": [
            "obj"
          ],
          "line": 196
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "709-713",
          "snippet": "virSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_SECRET",
            "_(\"no secret with matching usage '%s'\")",
            "usageID"
          ],
          "line": 191
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no secret with matching usage '%s'\""
          ],
          "line": 192
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjListFindByUsage",
          "args": [
            "driver->secrets",
            "usageType",
            "usageID"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListFindByUsage",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "261-274",
          "snippet": "virSecretObjPtr\nvirSecretObjListFindByUsage(virSecretObjListPtr secrets,\n                            int usageType,\n                            const char *usageID)\n{\n    virSecretObjPtr obj;\n\n    virObjectRWLockRead(secrets);\n    obj = virSecretObjListFindByUsageLocked(secrets, usageType, usageID);\n    virObjectRWUnlock(secrets);\n    if (obj)\n        virObjectLock(obj);\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretObjPtr\nvirSecretObjListFindByUsage(virSecretObjListPtr secrets,\n                            int usageType,\n                            const char *usageID)\n{\n    virSecretObjPtr obj;\n\n    virObjectRWLockRead(secrets);\n    obj = virSecretObjListFindByUsageLocked(secrets, usageType, usageID);\n    virObjectRWUnlock(secrets);\n    if (obj)\n        virObjectLock(obj);\n    return obj;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virSecretPtr\nsecretLookupByUsage(virConnectPtr conn,\n                    int usageType,\n                    const char *usageID)\n{\n    virSecretPtr ret = NULL;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n\n    if (!(obj = virSecretObjListFindByUsage(driver->secrets,\n                                            usageType, usageID))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching usage '%s'\"), usageID);\n        goto cleanup;\n    }\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretLookupByUsageEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    ret = virGetSecret(conn,\n                       def->uuid,\n                       def->usage_type,\n                       def->usage_id);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    return ret;\n}"
  },
  {
    "function_name": "secretLookupByUUID",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "149-177",
    "snippet": "static virSecretPtr\nsecretLookupByUUID(virConnectPtr conn,\n                   const unsigned char *uuid)\n{\n    virSecretPtr ret = NULL;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        goto cleanup;\n    }\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretLookupByUUIDEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    ret = virGetSecret(conn,\n                       def->uuid,\n                       def->usage_type,\n                       def->usage_id);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecretObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 175
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "99-108",
          "snippet": "void\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvoid\nvirSecretObjEndAPI(virSecretObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetSecret",
          "args": [
            "conn",
            "def->uuid",
            "def->usage_type",
            "def->usage_id"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "virGetSecret",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/datatypes.c",
          "lines": "729-755",
          "snippet": "virSecretPtr\nvirGetSecret(virConnectPtr conn, const unsigned char *uuid,\n             int usageType, const char *usageID)\n{\n    virSecretPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(uuid, error);\n\n    if (!(ret = virObjectNew(virSecretClass)))\n        return NULL;\n\n    memcpy(&(ret->uuid[0]), uuid, VIR_UUID_BUFLEN);\n    ret->usageType = usageType;\n    ret->usageID = g_strdup(NULLSTR_EMPTY(usageID));\n\n    ret->conn = virObjectRef(conn);\n\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virClassPtr virSecretClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirClassPtr virSecretClass;\n\nvirSecretPtr\nvirGetSecret(virConnectPtr conn, const unsigned char *uuid,\n             int usageType, const char *usageID)\n{\n    virSecretPtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(uuid, error);\n\n    if (!(ret = virObjectNew(virSecretClass)))\n        return NULL;\n\n    memcpy(&(ret->uuid[0]), uuid, VIR_UUID_BUFLEN);\n    ret->usageType = usageType;\n    ret->usageID = g_strdup(NULLSTR_EMPTY(usageID));\n\n    ret->conn = virObjectRef(conn);\n\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretLookupByUUIDEnsureACL",
          "args": [
            "conn",
            "def"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virSecretObjGetDef",
          "args": [
            "obj"
          ],
          "line": 165
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "709-713",
          "snippet": "virSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretDefPtr\nvirSecretObjGetDef(virSecretObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_SECRET",
            "_(\"no secret with matching uuid '%s'\")",
            "uuidstr"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no secret with matching uuid '%s'\""
          ],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjListFindByUUID",
          "args": [
            "driver->secrets",
            "uuidstr"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListFindByUUID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "183-195",
          "snippet": "virSecretObjPtr\nvirSecretObjListFindByUUID(virSecretObjListPtr secrets,\n                           const char *uuidstr)\n{\n    virSecretObjPtr obj;\n\n    virObjectRWLockRead(secrets);\n    obj = virSecretObjListFindByUUIDLocked(secrets, uuidstr);\n    virObjectRWUnlock(secrets);\n    if (obj)\n        virObjectLock(obj);\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretObjPtr\nvirSecretObjListFindByUUID(virSecretObjListPtr secrets,\n                           const char *uuidstr)\n{\n    virSecretObjPtr obj;\n\n    virObjectRWLockRead(secrets);\n    obj = virSecretObjListFindByUUIDLocked(secrets, uuidstr);\n    virObjectRWUnlock(secrets);\n    if (obj)\n        virObjectLock(obj);\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "uuid",
            "uuidstr"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virSecretPtr\nsecretLookupByUUID(virConnectPtr conn,\n                   const unsigned char *uuid)\n{\n    virSecretPtr ret = NULL;\n    virSecretObjPtr obj;\n    virSecretDefPtr def;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        goto cleanup;\n    }\n\n    def = virSecretObjGetDef(obj);\n    if (virSecretLookupByUUIDEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    ret = virGetSecret(conn,\n                       def->uuid,\n                       def->usage_type,\n                       def->usage_id);\n\n cleanup:\n    virSecretObjEndAPI(&obj);\n    return ret;\n}"
  },
  {
    "function_name": "secretConnectListAllSecrets",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "133-146",
    "snippet": "static int\nsecretConnectListAllSecrets(virConnectPtr conn,\n                            virSecretPtr **secrets,\n                            unsigned int flags)\n{\n    virCheckFlags(VIR_CONNECT_LIST_SECRETS_FILTERS_ALL, -1);\n\n    if (virConnectListAllSecretsEnsureACL(conn) < 0)\n        return -1;\n\n    return virSecretObjListExport(conn, driver->secrets, secrets,\n                                  virConnectListAllSecretsCheckACL,\n                                  flags);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecretObjListExport",
          "args": [
            "conn",
            "driver->secrets",
            "secrets",
            "virConnectListAllSecretsCheckACL",
            "flags"
          ],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListExport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "580-616",
          "snippet": "int\nvirSecretObjListExport(virConnectPtr conn,\n                       virSecretObjListPtr secretobjs,\n                       virSecretPtr **secrets,\n                       virSecretObjListACLFilter filter,\n                       unsigned int flags)\n{\n    virSecretObjListExportData data = {\n        .conn = conn, .secrets = NULL,\n        .filter = filter, .flags = flags,\n        .nsecrets = 0, .error = false };\n\n    virObjectRWLockRead(secretobjs);\n    if (secrets &&\n        VIR_ALLOC_N(data.secrets, virHashSize(secretobjs->objs) + 1) < 0) {\n        virObjectRWUnlock(secretobjs);\n        return -1;\n    }\n\n    virHashForEach(secretobjs->objs, virSecretObjListExportCallback, &data);\n    virObjectRWUnlock(secretobjs);\n\n    if (data.error)\n        goto error;\n\n    if (data.secrets) {\n        /* trim the array to the final size */\n        ignore_value(VIR_REALLOC_N(data.secrets, data.nsecrets + 1));\n        *secrets = data.secrets;\n    }\n\n    return data.nsecrets;\n\n error:\n    virObjectListFree(data.secrets);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSecretObjListExport(virConnectPtr conn,\n                       virSecretObjListPtr secretobjs,\n                       virSecretPtr **secrets,\n                       virSecretObjListACLFilter filter,\n                       unsigned int flags)\n{\n    virSecretObjListExportData data = {\n        .conn = conn, .secrets = NULL,\n        .filter = filter, .flags = flags,\n        .nsecrets = 0, .error = false };\n\n    virObjectRWLockRead(secretobjs);\n    if (secrets &&\n        VIR_ALLOC_N(data.secrets, virHashSize(secretobjs->objs) + 1) < 0) {\n        virObjectRWUnlock(secretobjs);\n        return -1;\n    }\n\n    virHashForEach(secretobjs->objs, virSecretObjListExportCallback, &data);\n    virObjectRWUnlock(secretobjs);\n\n    if (data.error)\n        goto error;\n\n    if (data.secrets) {\n        /* trim the array to the final size */\n        ignore_value(VIR_REALLOC_N(data.secrets, data.nsecrets + 1));\n        *secrets = data.secrets;\n    }\n\n    return data.nsecrets;\n\n error:\n    virObjectListFree(data.secrets);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectListAllSecretsEnsureACL",
          "args": [
            "conn"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_CONNECT_LIST_SECRETS_FILTERS_ALL",
            "-1"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretConnectListAllSecrets(virConnectPtr conn,\n                            virSecretPtr **secrets,\n                            unsigned int flags)\n{\n    virCheckFlags(VIR_CONNECT_LIST_SECRETS_FILTERS_ALL, -1);\n\n    if (virConnectListAllSecretsEnsureACL(conn) < 0)\n        return -1;\n\n    return virSecretObjListExport(conn, driver->secrets, secrets,\n                                  virConnectListAllSecretsCheckACL,\n                                  flags);\n}"
  },
  {
    "function_name": "secretConnectListSecrets",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "118-130",
    "snippet": "static int\nsecretConnectListSecrets(virConnectPtr conn,\n                         char **uuids,\n                         int maxuuids)\n{\n    memset(uuids, 0, maxuuids * sizeof(*uuids));\n\n    if (virConnectListSecretsEnsureACL(conn) < 0)\n        return -1;\n\n    return virSecretObjListGetUUIDs(driver->secrets, uuids, maxuuids,\n                                    virConnectListSecretsCheckACL, conn);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecretObjListGetUUIDs",
          "args": [
            "driver->secrets",
            "uuids",
            "maxuuids",
            "virConnectListSecretsCheckACL",
            "conn"
          ],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListGetUUIDs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "619-643",
          "snippet": "int\nvirSecretObjListGetUUIDs(virSecretObjListPtr secrets,\n                         char **uuids,\n                         int maxuuids,\n                         virSecretObjListACLFilter filter,\n                         virConnectPtr conn)\n{\n    struct virSecretListData data = {\n        .conn = conn, .filter = filter, .uuids = uuids, .nuuids = 0,\n        .maxuuids = maxuuids, .error = false };\n\n    virObjectRWLockRead(secrets);\n    virHashForEach(secrets->objs, virSecretObjListGetUUIDsCallback, &data);\n    virObjectRWUnlock(secrets);\n\n    if (data.error)\n        goto error;\n\n    return data.nuuids;\n\n error:\n    while (--data.nuuids)\n        VIR_FREE(data.uuids[data.nuuids]);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSecretObjListGetUUIDs(virSecretObjListPtr secrets,\n                         char **uuids,\n                         int maxuuids,\n                         virSecretObjListACLFilter filter,\n                         virConnectPtr conn)\n{\n    struct virSecretListData data = {\n        .conn = conn, .filter = filter, .uuids = uuids, .nuuids = 0,\n        .maxuuids = maxuuids, .error = false };\n\n    virObjectRWLockRead(secrets);\n    virHashForEach(secrets->objs, virSecretObjListGetUUIDsCallback, &data);\n    virObjectRWUnlock(secrets);\n\n    if (data.error)\n        goto error;\n\n    return data.nuuids;\n\n error:\n    while (--data.nuuids)\n        VIR_FREE(data.uuids[data.nuuids]);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectListSecretsEnsureACL",
          "args": [
            "conn"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "uuids",
            "0",
            "maxuuids * sizeof(*uuids)"
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretConnectListSecrets(virConnectPtr conn,\n                         char **uuids,\n                         int maxuuids)\n{\n    memset(uuids, 0, maxuuids * sizeof(*uuids));\n\n    if (virConnectListSecretsEnsureACL(conn) < 0)\n        return -1;\n\n    return virSecretObjListGetUUIDs(driver->secrets, uuids, maxuuids,\n                                    virConnectListSecretsCheckACL, conn);\n}"
  },
  {
    "function_name": "secretConnectNumOfSecrets",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "106-115",
    "snippet": "static int\nsecretConnectNumOfSecrets(virConnectPtr conn)\n{\n    if (virConnectNumOfSecretsEnsureACL(conn) < 0)\n        return -1;\n\n    return virSecretObjListNumOfSecrets(driver->secrets,\n                                        virConnectNumOfSecretsCheckACL,\n                                        conn);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virSecretObjListNumOfSecrets",
          "args": [
            "driver->secrets",
            "virConnectNumOfSecretsCheckACL",
            "conn"
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListNumOfSecrets",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "483-496",
          "snippet": "int\nvirSecretObjListNumOfSecrets(virSecretObjListPtr secrets,\n                             virSecretObjListACLFilter filter,\n                             virConnectPtr conn)\n{\n    struct virSecretCountData data = {\n        .conn = conn, .filter = filter, .count = 0 };\n\n    virObjectRWLockRead(secrets);\n    virHashForEach(secrets->objs, virSecretObjListNumOfSecretsCallback, &data);\n    virObjectRWUnlock(secrets);\n\n    return data.count;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSecretObjListNumOfSecrets(virSecretObjListPtr secrets,\n                             virSecretObjListACLFilter filter,\n                             virConnectPtr conn)\n{\n    struct virSecretCountData data = {\n        .conn = conn, .filter = filter, .count = 0 };\n\n    virObjectRWLockRead(secrets);\n    virHashForEach(secrets->objs, virSecretObjListNumOfSecretsCallback, &data);\n    virObjectRWUnlock(secrets);\n\n    return data.count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectNumOfSecretsEnsureACL",
          "args": [
            "conn"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic int\nsecretConnectNumOfSecrets(virConnectPtr conn)\n{\n    if (virConnectNumOfSecretsEnsureACL(conn) < 0)\n        return -1;\n\n    return virSecretObjListNumOfSecrets(driver->secrets,\n                                        virConnectNumOfSecretsCheckACL,\n                                        conn);\n}"
  },
  {
    "function_name": "secretObjFromSecret",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "88-101",
    "snippet": "static virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_SECRET",
            "_(\"no secret with matching uuid '%s'\")",
            "uuidstr"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no secret with matching uuid '%s'\""
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSecretObjListFindByUUID",
          "args": [
            "driver->secrets",
            "uuidstr"
          ],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "virSecretObjListFindByUUID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virsecretobj.c",
          "lines": "183-195",
          "snippet": "virSecretObjPtr\nvirSecretObjListFindByUUID(virSecretObjListPtr secrets,\n                           const char *uuidstr)\n{\n    virSecretObjPtr obj;\n\n    virObjectRWLockRead(secrets);\n    obj = virSecretObjListFindByUUIDLocked(secrets, uuidstr);\n    virObjectRWUnlock(secrets);\n    if (obj)\n        virObjectLock(obj);\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"virsecretobj.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virSecretObjDispose(void *obj);",
            "static void virSecretObjListDispose(void *obj);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"virsecretobj.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <dirent.h>\n#include <config.h>\n\nstatic void virSecretObjDispose(void *obj);\nstatic void virSecretObjListDispose(void *obj);\n\nvirSecretObjPtr\nvirSecretObjListFindByUUID(virSecretObjListPtr secrets,\n                           const char *uuidstr)\n{\n    virSecretObjPtr obj;\n\n    virObjectRWLockRead(secrets);\n    obj = virSecretObjListFindByUUIDLocked(secrets, uuidstr);\n    virObjectRWUnlock(secrets);\n    if (obj)\n        virObjectLock(obj);\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virUUIDFormat",
          "args": [
            "secret->uuid",
            "uuidstr"
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "virUUIDFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/viruuid.c",
          "lines": "148-159",
          "snippet": "const char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}",
          "includes": [
            "#include \"virrandom.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"internal.h\"",
            "#include <unistd.h>",
            "#include <time.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <fcntl.h>",
            "#include \"viruuid.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virrandom.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <time.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <fcntl.h>\n#include \"viruuid.h\"\n#include <config.h>\n\nconst char *\nvirUUIDFormat(const unsigned char *uuid, char *uuidstr)\n{\n    g_snprintf(uuidstr, VIR_UUID_STRING_BUFLEN,\n               \"%02x%02x%02x%02x-%02x%02x-%02x%02x-%02x%02x-%02x%02x%02x%02x%02x%02x\",\n               uuid[0], uuid[1], uuid[2], uuid[3],\n               uuid[4], uuid[5], uuid[6], uuid[7],\n               uuid[8], uuid[9], uuid[10], uuid[11],\n               uuid[12], uuid[13], uuid[14], uuid[15]);\n    uuidstr[VIR_UUID_STRING_BUFLEN-1] = '\\0';\n    return uuidstr;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic virSecretObjPtr\nsecretObjFromSecret(virSecretPtr secret)\n{\n    virSecretObjPtr obj;\n    char uuidstr[VIR_UUID_STRING_BUFLEN];\n\n    virUUIDFormat(secret->uuid, uuidstr);\n    if (!(obj = virSecretObjListFindByUUID(driver->secrets, uuidstr))) {\n        virReportError(VIR_ERR_NO_SECRET,\n                       _(\"no secret with matching uuid '%s'\"), uuidstr);\n        return NULL;\n    }\n    return obj;\n}"
  },
  {
    "function_name": "secretDriverUnlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "81-85",
    "snippet": "static void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&driver->lock"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}"
  },
  {
    "function_name": "secretDriverLock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/secret/secret_driver.c",
    "lines": "74-78",
    "snippet": "static void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"secret_event.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virstring.h\"",
      "#include \"configmake.h\"",
      "#include \"virpidfile.h\"",
      "#include \"virfile.h\"",
      "#include \"virerror.h\"",
      "#include \"viruuid.h\"",
      "#include \"virthread.h\"",
      "#include \"secret_driver.h\"",
      "#include \"virsecretobj.h\"",
      "#include \"secret_conf.h\"",
      "#include \"viralloc.h\"",
      "#include \"virlog.h\"",
      "#include \"driver.h\"",
      "#include \"datatypes.h\"",
      "#include \"internal.h\"",
      "#include <unistd.h>",
      "#include <sys/stat.h>",
      "#include <fcntl.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static virSecretDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&driver->lock"
          ],
          "line": 77
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"secret_event.h\"\n#include \"viraccessapicheck.h\"\n#include \"virstring.h\"\n#include \"configmake.h\"\n#include \"virpidfile.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viruuid.h\"\n#include \"virthread.h\"\n#include \"secret_driver.h\"\n#include \"virsecretobj.h\"\n#include \"secret_conf.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"driver.h\"\n#include \"datatypes.h\"\n#include \"internal.h\"\n#include <unistd.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <config.h>\n\nstatic virSecretDriverStatePtr driver;\n\nstatic void\nsecretDriverLock(void)\n{\n    virMutexLock(&driver->lock);\n}"
  }
]