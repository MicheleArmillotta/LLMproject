[
  {
    "function_name": "nodedevRegister",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "635-645",
    "snippet": "int\nnodedevRegister(void)\n{\n#ifdef WITH_UDEV\n    return udevNodeRegister();\n#else\n# ifdef WITH_HAL\n    return halNodeRegister();\n# endif\n#endif\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "halNodeRegister",
          "args": [],
          "line": 642
        },
        "resolved": true,
        "details": {
          "function_name": "halNodeRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "835-843",
          "snippet": "int\nhalNodeRegister(void)\n{\n    if (virRegisterConnectDriver(&halConnectDriver, false) < 0)\n        return -1;\n    if (virSetSharedNodeDeviceDriver(&halNodeDeviceDriver) < 0)\n        return -1;\n    return virRegisterStateDriver(&halStateDriver);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virNodeDeviceDriver halNodeDeviceDriver = {\n    .name = \"HAL\",\n    .nodeNumOfDevices = nodeNumOfDevices, /* 0.5.0 */\n    .nodeListDevices = nodeListDevices, /* 0.5.0 */\n    .connectListAllNodeDevices = nodeConnectListAllNodeDevices, /* 0.10.2 */\n    .nodeDeviceLookupByName = nodeDeviceLookupByName, /* 0.5.0 */\n    .nodeDeviceLookupSCSIHostByWWN = nodeDeviceLookupSCSIHostByWWN, /* 1.0.2 */\n    .nodeDeviceGetXMLDesc = nodeDeviceGetXMLDesc, /* 0.5.0 */\n    .nodeDeviceGetParent = nodeDeviceGetParent, /* 0.5.0 */\n    .nodeDeviceNumOfCaps = nodeDeviceNumOfCaps, /* 0.5.0 */\n    .nodeDeviceListCaps = nodeDeviceListCaps, /* 0.5.0 */\n    .nodeDeviceCreateXML = nodeDeviceCreateXML, /* 0.6.5 */\n    .nodeDeviceDestroy = nodeDeviceDestroy, /* 0.6.5 */\n};",
            "static virConnectDriver halConnectDriver = {\n    .localOnly = true,\n    .uriSchemes = (const char *[]){ \"nodedev\", NULL },\n    .hypervisorDriver = &halHypervisorDriver,\n    .nodeDeviceDriver = &halNodeDeviceDriver,\n};",
            "static virStateDriver halStateDriver = {\n    .name = \"HAL\",\n    .stateInitialize = nodeStateInitialize, /* 0.5.0 */\n    .stateCleanup = nodeStateCleanup, /* 0.5.0 */\n    .stateReload = nodeStateReload, /* 0.5.0 */\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic virNodeDeviceDriver halNodeDeviceDriver = {\n    .name = \"HAL\",\n    .nodeNumOfDevices = nodeNumOfDevices, /* 0.5.0 */\n    .nodeListDevices = nodeListDevices, /* 0.5.0 */\n    .connectListAllNodeDevices = nodeConnectListAllNodeDevices, /* 0.10.2 */\n    .nodeDeviceLookupByName = nodeDeviceLookupByName, /* 0.5.0 */\n    .nodeDeviceLookupSCSIHostByWWN = nodeDeviceLookupSCSIHostByWWN, /* 1.0.2 */\n    .nodeDeviceGetXMLDesc = nodeDeviceGetXMLDesc, /* 0.5.0 */\n    .nodeDeviceGetParent = nodeDeviceGetParent, /* 0.5.0 */\n    .nodeDeviceNumOfCaps = nodeDeviceNumOfCaps, /* 0.5.0 */\n    .nodeDeviceListCaps = nodeDeviceListCaps, /* 0.5.0 */\n    .nodeDeviceCreateXML = nodeDeviceCreateXML, /* 0.6.5 */\n    .nodeDeviceDestroy = nodeDeviceDestroy, /* 0.6.5 */\n};\nstatic virConnectDriver halConnectDriver = {\n    .localOnly = true,\n    .uriSchemes = (const char *[]){ \"nodedev\", NULL },\n    .hypervisorDriver = &halHypervisorDriver,\n    .nodeDeviceDriver = &halNodeDeviceDriver,\n};\nstatic virStateDriver halStateDriver = {\n    .name = \"HAL\",\n    .stateInitialize = nodeStateInitialize, /* 0.5.0 */\n    .stateCleanup = nodeStateCleanup, /* 0.5.0 */\n    .stateReload = nodeStateReload, /* 0.5.0 */\n};\n\nint\nhalNodeRegister(void)\n{\n    if (virRegisterConnectDriver(&halConnectDriver, false) < 0)\n        return -1;\n    if (virSetSharedNodeDeviceDriver(&halNodeDeviceDriver) < 0)\n        return -1;\n    return virRegisterStateDriver(&halStateDriver);\n}"
        }
      },
      {
        "call_info": {
          "callee": "udevNodeRegister",
          "args": [],
          "line": 639
        },
        "resolved": true,
        "details": {
          "function_name": "udevNodeRegister",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_udev.c",
          "lines": "1976-1987",
          "snippet": "int\nudevNodeRegister(void)\n{\n    VIR_DEBUG(\"Registering udev node device backend\");\n\n    if (virRegisterConnectDriver(&udevConnectDriver, false) < 0)\n        return -1;\n    if (virSetSharedNodeDeviceDriver(&udevNodeDeviceDriver) < 0)\n        return -1;\n\n    return virRegisterStateDriver(&udevStateDriver);\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virmdev.h\"",
            "#include \"virnetdev.h\"",
            "#include \"virstring.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"virbuffer.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_udev.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include <scsi/scsi.h>",
            "#include <pciaccess.h>",
            "#include <libudev.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virNodeDeviceDriver udevNodeDeviceDriver = {\n    .name = \"udev\",\n    .nodeNumOfDevices = nodeNumOfDevices, /* 0.7.3 */\n    .nodeListDevices = nodeListDevices, /* 0.7.3 */\n    .connectListAllNodeDevices = nodeConnectListAllNodeDevices, /* 0.10.2 */\n    .connectNodeDeviceEventRegisterAny = nodeConnectNodeDeviceEventRegisterAny, /* 2.2.0 */\n    .connectNodeDeviceEventDeregisterAny = nodeConnectNodeDeviceEventDeregisterAny, /* 2.2.0 */\n    .nodeDeviceLookupByName = nodeDeviceLookupByName, /* 0.7.3 */\n    .nodeDeviceLookupSCSIHostByWWN = nodeDeviceLookupSCSIHostByWWN, /* 1.0.2 */\n    .nodeDeviceGetXMLDesc = nodeDeviceGetXMLDesc, /* 0.7.3 */\n    .nodeDeviceGetParent = nodeDeviceGetParent, /* 0.7.3 */\n    .nodeDeviceNumOfCaps = nodeDeviceNumOfCaps, /* 0.7.3 */\n    .nodeDeviceListCaps = nodeDeviceListCaps, /* 0.7.3 */\n    .nodeDeviceCreateXML = nodeDeviceCreateXML, /* 0.7.3 */\n    .nodeDeviceDestroy = nodeDeviceDestroy, /* 0.7.3 */\n};",
            "static virConnectDriver udevConnectDriver = {\n    .localOnly = true,\n    .uriSchemes = (const char *[]){ \"nodedev\", NULL },\n    .hypervisorDriver = &udevHypervisorDriver,\n    .nodeDeviceDriver = &udevNodeDeviceDriver,\n};",
            "static virStateDriver udevStateDriver = {\n    .name = \"udev\",\n    .stateInitialize = nodeStateInitialize, /* 0.7.3 */\n    .stateCleanup = nodeStateCleanup, /* 0.7.3 */\n    .stateReload = nodeStateReload, /* 0.7.3 */\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virmdev.h\"\n#include \"virnetdev.h\"\n#include \"virstring.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"virbuffer.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_udev.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include <scsi/scsi.h>\n#include <pciaccess.h>\n#include <libudev.h>\n#include <config.h>\n\nstatic virNodeDeviceDriver udevNodeDeviceDriver = {\n    .name = \"udev\",\n    .nodeNumOfDevices = nodeNumOfDevices, /* 0.7.3 */\n    .nodeListDevices = nodeListDevices, /* 0.7.3 */\n    .connectListAllNodeDevices = nodeConnectListAllNodeDevices, /* 0.10.2 */\n    .connectNodeDeviceEventRegisterAny = nodeConnectNodeDeviceEventRegisterAny, /* 2.2.0 */\n    .connectNodeDeviceEventDeregisterAny = nodeConnectNodeDeviceEventDeregisterAny, /* 2.2.0 */\n    .nodeDeviceLookupByName = nodeDeviceLookupByName, /* 0.7.3 */\n    .nodeDeviceLookupSCSIHostByWWN = nodeDeviceLookupSCSIHostByWWN, /* 1.0.2 */\n    .nodeDeviceGetXMLDesc = nodeDeviceGetXMLDesc, /* 0.7.3 */\n    .nodeDeviceGetParent = nodeDeviceGetParent, /* 0.7.3 */\n    .nodeDeviceNumOfCaps = nodeDeviceNumOfCaps, /* 0.7.3 */\n    .nodeDeviceListCaps = nodeDeviceListCaps, /* 0.7.3 */\n    .nodeDeviceCreateXML = nodeDeviceCreateXML, /* 0.7.3 */\n    .nodeDeviceDestroy = nodeDeviceDestroy, /* 0.7.3 */\n};\nstatic virConnectDriver udevConnectDriver = {\n    .localOnly = true,\n    .uriSchemes = (const char *[]){ \"nodedev\", NULL },\n    .hypervisorDriver = &udevHypervisorDriver,\n    .nodeDeviceDriver = &udevNodeDeviceDriver,\n};\nstatic virStateDriver udevStateDriver = {\n    .name = \"udev\",\n    .stateInitialize = nodeStateInitialize, /* 0.7.3 */\n    .stateCleanup = nodeStateCleanup, /* 0.7.3 */\n    .stateReload = nodeStateReload, /* 0.7.3 */\n};\n\nint\nudevNodeRegister(void)\n{\n    VIR_DEBUG(\"Registering udev node device backend\");\n\n    if (virRegisterConnectDriver(&udevConnectDriver, false) < 0)\n        return -1;\n    if (virSetSharedNodeDeviceDriver(&udevNodeDeviceDriver) < 0)\n        return -1;\n\n    return virRegisterStateDriver(&udevStateDriver);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nnodedevRegister(void)\n{\n#ifdef WITH_UDEV\n    return udevNodeRegister();\n#else\n# ifdef WITH_HAL\n    return halNodeRegister();\n# endif\n#endif\n}"
  },
  {
    "function_name": "nodeConnectNodeDeviceEventDeregisterAny",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "617-633",
    "snippet": "int\nnodeConnectNodeDeviceEventDeregisterAny(virConnectPtr conn,\n                                        int callbackID)\n{\n    if (virConnectNodeDeviceEventDeregisterAnyEnsureACL(conn) < 0)\n        return -1;\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    if (virObjectEventStateDeregisterID(conn,\n                                        driver->nodeDeviceEventState,\n                                        callbackID, true) < 0)\n        return -1;\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virObjectEventStateDeregisterID",
          "args": [
            "conn",
            "driver->nodeDeviceEventState",
            "callbackID",
            "true"
          ],
          "line": 627
        },
        "resolved": true,
        "details": {
          "function_name": "virObjectEventStateDeregisterID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/object_event.c",
          "lines": "936-957",
          "snippet": "int\nvirObjectEventStateDeregisterID(virConnectPtr conn,\n                                virObjectEventStatePtr state,\n                                int callbackID,\n                                bool doFreeCb)\n{\n    int ret;\n\n    virObjectLock(state);\n    if (state->isDispatching)\n        ret = virObjectEventCallbackListMarkDeleteID(conn,\n                                                     state->callbacks,\n                                                     callbackID);\n    else\n        ret = virObjectEventCallbackListRemoveID(conn, state->callbacks,\n                                                 callbackID, doFreeCb);\n\n    virObjectEventStateCleanupTimer(state, true);\n\n    virObjectUnlock(state);\n    return ret;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virobject.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virlog.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"network_event.h\"",
            "#include \"domain_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void virObjectEventStateFlush(virObjectEventStatePtr state);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virobject.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virlog.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"network_event.h\"\n#include \"domain_event.h\"\n#include <config.h>\n\nstatic void virObjectEventStateFlush(virObjectEventStatePtr state);\n\nint\nvirObjectEventStateDeregisterID(virConnectPtr conn,\n                                virObjectEventStatePtr state,\n                                int callbackID,\n                                bool doFreeCb)\n{\n    int ret;\n\n    virObjectLock(state);\n    if (state->isDispatching)\n        ret = virObjectEventCallbackListMarkDeleteID(conn,\n                                                     state->callbacks,\n                                                     callbackID);\n    else\n        ret = virObjectEventCallbackListRemoveID(conn, state->callbacks,\n                                                 callbackID, doFreeCb);\n\n    virObjectEventStateCleanupTimer(state, true);\n\n    virObjectUnlock(state);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 624
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectNodeDeviceEventDeregisterAnyEnsureACL",
          "args": [
            "conn"
          ],
          "line": 621
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nint\nnodeConnectNodeDeviceEventDeregisterAny(virConnectPtr conn,\n                                        int callbackID)\n{\n    if (virConnectNodeDeviceEventDeregisterAnyEnsureACL(conn) < 0)\n        return -1;\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    if (virObjectEventStateDeregisterID(conn,\n                                        driver->nodeDeviceEventState,\n                                        callbackID, true) < 0)\n        return -1;\n\n    return 0;\n}"
  },
  {
    "function_name": "nodeConnectNodeDeviceEventRegisterAny",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "592-614",
    "snippet": "int\nnodeConnectNodeDeviceEventRegisterAny(virConnectPtr conn,\n                                      virNodeDevicePtr device,\n                                      int eventID,\n                                      virConnectNodeDeviceEventGenericCallback callback,\n                                      void *opaque,\n                                      virFreeCallback freecb)\n{\n    int callbackID = -1;\n\n    if (virConnectNodeDeviceEventRegisterAnyEnsureACL(conn) < 0)\n        return -1;\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    if (virNodeDeviceEventStateRegisterID(conn, driver->nodeDeviceEventState,\n                                          device, eventID, callback,\n                                          opaque, freecb, &callbackID) < 0)\n        callbackID = -1;\n\n    return callbackID;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceEventStateRegisterID",
          "args": [
            "conn",
            "driver->nodeDeviceEventState",
            "device",
            "eventID",
            "callback",
            "opaque",
            "freecb",
            "&callbackID"
          ],
          "line": 608
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceEventStateRegisterID",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_event.c",
          "lines": "166-185",
          "snippet": "int\nvirNodeDeviceEventStateRegisterID(virConnectPtr conn,\n                                  virObjectEventStatePtr state,\n                                  virNodeDevicePtr dev,\n                                  int eventID,\n                                  virConnectNodeDeviceEventGenericCallback cb,\n                                  void *opaque,\n                                  virFreeCallback freecb,\n                                  int *callbackID)\n{\n    if (virNodeDeviceEventsInitialize() < 0)\n        return -1;\n\n    return virObjectEventStateRegisterID(conn, state, dev ? dev->name : NULL,\n                                         NULL, NULL,\n                                         virNodeDeviceEventClass, eventID,\n                                         VIR_OBJECT_EVENT_CALLBACK(cb),\n                                         opaque, freecb,\n                                         false, callbackID, false);\n}",
          "includes": [
            "#include \"virlog.h\"",
            "#include \"datatypes.h\"",
            "#include \"object_event_private.h\"",
            "#include \"object_event.h\"",
            "#include \"node_device_event.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static virClassPtr virNodeDeviceEventClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virlog.h\"\n#include \"datatypes.h\"\n#include \"object_event_private.h\"\n#include \"object_event.h\"\n#include \"node_device_event.h\"\n#include <config.h>\n\nstatic virClassPtr virNodeDeviceEventClass;\n\nint\nvirNodeDeviceEventStateRegisterID(virConnectPtr conn,\n                                  virObjectEventStatePtr state,\n                                  virNodeDevicePtr dev,\n                                  int eventID,\n                                  virConnectNodeDeviceEventGenericCallback cb,\n                                  void *opaque,\n                                  virFreeCallback freecb,\n                                  int *callbackID)\n{\n    if (virNodeDeviceEventsInitialize() < 0)\n        return -1;\n\n    return virObjectEventStateRegisterID(conn, state, dev ? dev->name : NULL,\n                                         NULL, NULL,\n                                         virNodeDeviceEventClass, eventID,\n                                         VIR_OBJECT_EVENT_CALLBACK(cb),\n                                         opaque, freecb,\n                                         false, callbackID, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 605
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectNodeDeviceEventRegisterAnyEnsureACL",
          "args": [
            "conn"
          ],
          "line": 602
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nint\nnodeConnectNodeDeviceEventRegisterAny(virConnectPtr conn,\n                                      virNodeDevicePtr device,\n                                      int eventID,\n                                      virConnectNodeDeviceEventGenericCallback callback,\n                                      void *opaque,\n                                      virFreeCallback freecb)\n{\n    int callbackID = -1;\n\n    if (virConnectNodeDeviceEventRegisterAnyEnsureACL(conn) < 0)\n        return -1;\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    if (virNodeDeviceEventStateRegisterID(conn, driver->nodeDeviceEventState,\n                                          device, eventID, callback,\n                                          opaque, freecb, &callbackID) < 0)\n        callbackID = -1;\n\n    return callbackID;\n}"
  },
  {
    "function_name": "nodeDeviceDestroy",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "539-589",
    "snippet": "int\nnodeDeviceDestroy(virNodeDevicePtr device)\n{\n    int ret = -1;\n    virNodeDeviceObjPtr obj = NULL;\n    virNodeDeviceDefPtr def;\n    g_autofree char *parent = NULL;\n    g_autofree char *wwnn = NULL;\n    g_autofree char *wwpn = NULL;\n    unsigned int parent_host;\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return -1;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceDestroyEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    if (virNodeDeviceGetWWNs(def, &wwnn, &wwpn) < 0)\n        goto cleanup;\n\n    /* Because we're about to release the lock and thus run into a race\n     * possibility (however improbable) with a udevAddOneDevice change\n     * event which would essentially free the existing @def (obj->def) and\n     * replace it with something new, we need to grab the parent field\n     * and then find the parent obj in order to manage the vport */\n    parent = g_strdup(def->parent);\n\n    virNodeDeviceObjEndAPI(&obj);\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, parent))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"cannot find parent '%s' definition\"), parent);\n        goto cleanup;\n    }\n\n    if (virSCSIHostGetNumber(parent, &parent_host) < 0)\n        goto cleanup;\n\n    if (virVHBAManageVport(parent_host, wwpn, wwnn, VPORT_DELETE) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 587
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "101-110",
          "snippet": "void\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvoid\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virVHBAManageVport",
          "args": [
            "parent_host",
            "wwpn",
            "wwnn",
            "VPORT_DELETE"
          ],
          "line": 581
        },
        "resolved": true,
        "details": {
          "function_name": "virVHBAManageVport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvhba.c",
          "lines": "489-497",
          "snippet": "int\nvirVHBAManageVport(const int parent_host G_GNUC_UNUSED,\n                   const char *wwpn G_GNUC_UNUSED,\n                   const char *wwnn G_GNUC_UNUSED,\n                   int operation G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nint\nvirVHBAManageVport(const int parent_host G_GNUC_UNUSED,\n                   const char *wwpn G_GNUC_UNUSED,\n                   const char *wwnn G_GNUC_UNUSED,\n                   int operation G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virSCSIHostGetNumber",
          "args": [
            "parent",
            "&parent_host"
          ],
          "line": 578
        },
        "resolved": true,
        "details": {
          "function_name": "virSCSIHostGetNumber",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virscsihost.c",
          "lines": "272-278",
          "snippet": "int\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virscsihost.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <dirent.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virscsihost.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <dirent.h>\n#include <config.h>\n\nint\nvirSCSIHostGetNumber(const char *adapter_name G_GNUC_UNUSED,\n                     unsigned int *result G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "_(\"cannot find parent '%s' definition\")",
            "parent"
          ],
          "line": 573
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot find parent '%s' definition\""
          ],
          "line": 574
        },
        "resolved": true,
        "details": {
          "function_name": "dev_refresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "493-509",
          "snippet": "static void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjListFindByName",
          "args": [
            "driver->devs",
            "parent"
          ],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjListFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "236-249",
          "snippet": "virNodeDeviceObjPtr\nvirNodeDeviceObjListFindByName(virNodeDeviceObjListPtr devs,\n                               const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    virObjectRWLockRead(devs);\n    obj = virNodeDeviceObjListFindByNameLocked(devs, name);\n    virObjectRWUnlock(devs);\n    if (obj)\n        virObjectLock(obj);\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceObjPtr\nvirNodeDeviceObjListFindByName(virNodeDeviceObjListPtr devs,\n                               const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    virObjectRWLockRead(devs);\n    obj = virNodeDeviceObjListFindByNameLocked(devs, name);\n    virObjectRWUnlock(devs);\n    if (obj)\n        virObjectLock(obj);\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "def->parent"
          ],
          "line": 568
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceGetWWNs",
          "args": [
            "def",
            "&wwnn",
            "&wwpn"
          ],
          "line": 560
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceGetWWNs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_conf.c",
          "lines": "2108-2134",
          "snippet": "int\nvirNodeDeviceGetWWNs(virNodeDeviceDefPtr def,\n                     char **wwnn,\n                     char **wwpn)\n{\n    virNodeDevCapsDefPtr cap = NULL;\n\n    cap = def->caps;\n    while (cap != NULL) {\n        if (cap->data.type == VIR_NODE_DEV_CAP_SCSI_HOST &&\n            cap->data.scsi_host.flags & VIR_NODE_DEV_CAP_FLAG_HBA_FC_HOST) {\n            *wwnn = g_strdup(cap->data.scsi_host.wwnn);\n            *wwpn = g_strdup(cap->data.scsi_host.wwpn);\n            break;\n        }\n\n        cap = cap->next;\n    }\n\n    if (cap == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Device is not a fibre channel HBA\"));\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virfcp.h\"",
            "#include \"virlog.h\"",
            "#include \"virrandom.h\"",
            "#include \"viruuid.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"device_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfcp.h\"\n#include \"virlog.h\"\n#include \"virrandom.h\"\n#include \"viruuid.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"device_conf.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNodeDeviceGetWWNs(virNodeDeviceDefPtr def,\n                     char **wwnn,\n                     char **wwpn)\n{\n    virNodeDevCapsDefPtr cap = NULL;\n\n    cap = def->caps;\n    while (cap != NULL) {\n        if (cap->data.type == VIR_NODE_DEV_CAP_SCSI_HOST &&\n            cap->data.scsi_host.flags & VIR_NODE_DEV_CAP_FLAG_HBA_FC_HOST) {\n            *wwnn = g_strdup(cap->data.scsi_host.wwnn);\n            *wwpn = g_strdup(cap->data.scsi_host.wwpn);\n            break;\n        }\n\n        cap = cap->next;\n    }\n\n    if (cap == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Device is not a fibre channel HBA\"));\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceDestroyEnsureACL",
          "args": [
            "device->conn",
            "def"
          ],
          "line": 557
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjGetDef",
          "args": [
            "obj"
          ],
          "line": 555
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "113-117",
          "snippet": "virNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceObjFindByName",
          "args": [
            "device->name"
          ],
          "line": 553
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceObjFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "233-245",
          "snippet": "static virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 550
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nint\nnodeDeviceDestroy(virNodeDevicePtr device)\n{\n    int ret = -1;\n    virNodeDeviceObjPtr obj = NULL;\n    virNodeDeviceDefPtr def;\n    g_autofree char *parent = NULL;\n    g_autofree char *wwnn = NULL;\n    g_autofree char *wwpn = NULL;\n    unsigned int parent_host;\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return -1;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceDestroyEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    if (virNodeDeviceGetWWNs(def, &wwnn, &wwpn) < 0)\n        goto cleanup;\n\n    /* Because we're about to release the lock and thus run into a race\n     * possibility (however improbable) with a udevAddOneDevice change\n     * event which would essentially free the existing @def (obj->def) and\n     * replace it with something new, we need to grab the parent field\n     * and then find the parent obj in order to manage the vport */\n    parent = g_strdup(def->parent);\n\n    virNodeDeviceObjEndAPI(&obj);\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, parent))) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       _(\"cannot find parent '%s' definition\"), parent);\n        goto cleanup;\n    }\n\n    if (virSCSIHostGetNumber(parent, &parent_host) < 0)\n        goto cleanup;\n\n    if (virVHBAManageVport(parent_host, wwpn, wwnn, VPORT_DELETE) < 0)\n        goto cleanup;\n\n    ret = 0;\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return ret;\n}"
  },
  {
    "function_name": "nodeDeviceCreateXML",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "491-536",
    "snippet": "virNodeDevicePtr\nnodeDeviceCreateXML(virConnectPtr conn,\n                    const char *xmlDesc,\n                    unsigned int flags)\n{\n    g_autoptr(virNodeDeviceDef) def = NULL;\n    g_autofree char *wwnn = NULL;\n    g_autofree char *wwpn = NULL;\n    int parent_host = -1;\n    virNodeDevicePtr device = NULL;\n    const char *virt_type = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (nodeDeviceWaitInit() < 0)\n        return NULL;\n\n    virt_type  = virConnectGetType(conn);\n\n    if (!(def = virNodeDeviceDefParseString(xmlDesc, CREATE_DEVICE, virt_type)))\n        return NULL;\n\n    if (virNodeDeviceCreateXMLEnsureACL(conn, def) < 0)\n        return NULL;\n\n    if (virNodeDeviceGetWWNs(def, &wwnn, &wwpn) == -1)\n        return NULL;\n\n    if ((parent_host = virNodeDeviceObjListGetParentHost(driver->devs, def)) < 0)\n        return NULL;\n\n    if (virVHBAManageVport(parent_host, wwpn, wwnn, VPORT_CREATE) < 0)\n        return NULL;\n\n    device = nodeDeviceFindNewDevice(conn, wwnn, wwpn);\n    /* We don't check the return value, because one way or another,\n     * we're returning what we get... */\n\n    if (device == NULL)\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device for '%s' with matching \"\n                         \"wwnn '%s' and wwpn '%s'\"),\n                       def->name, wwnn, wwpn);\n\n    return device;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_NODE_DEVICE",
            "_(\"no node device for '%s' with matching \"\n                         \"wwnn '%s' and wwpn '%s'\")",
            "def->name",
            "wwnn",
            "wwpn"
          ],
          "line": 530
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no node device for '%s' with matching \"\n                         \"wwnn '%s' and wwpn '%s'\""
          ],
          "line": 531
        },
        "resolved": true,
        "details": {
          "function_name": "dev_refresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "493-509",
          "snippet": "static void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceFindNewDevice",
          "args": [
            "conn",
            "wwnn",
            "wwpn"
          ],
          "line": 525
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceFindNewDevice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "463-488",
          "snippet": "static virNodeDevicePtr\nnodeDeviceFindNewDevice(virConnectPtr conn,\n                        const char *wwnn,\n                        const char *wwpn)\n{\n    virNodeDevicePtr device = NULL;\n    time_t start = 0, now = 0;\n\n    nodeDeviceGetTime(&start);\n\n    while ((now - start) < LINUX_NEW_DEVICE_WAIT_TIME) {\n\n        virWaitForDevices();\n\n        device = nodeDeviceLookupSCSIHostByWWN(conn, wwnn, wwpn, 0);\n\n        if (device != NULL)\n            break;\n\n        sleep(5);\n        if (nodeDeviceGetTime(&now) == -1)\n            break;\n    }\n\n    return device;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virNodeDevicePtr\nnodeDeviceFindNewDevice(virConnectPtr conn,\n                        const char *wwnn,\n                        const char *wwpn)\n{\n    virNodeDevicePtr device = NULL;\n    time_t start = 0, now = 0;\n\n    nodeDeviceGetTime(&start);\n\n    while ((now - start) < LINUX_NEW_DEVICE_WAIT_TIME) {\n\n        virWaitForDevices();\n\n        device = nodeDeviceLookupSCSIHostByWWN(conn, wwnn, wwpn, 0);\n\n        if (device != NULL)\n            break;\n\n        sleep(5);\n        if (nodeDeviceGetTime(&now) == -1)\n            break;\n    }\n\n    return device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virVHBAManageVport",
          "args": [
            "parent_host",
            "wwpn",
            "wwnn",
            "VPORT_CREATE"
          ],
          "line": 522
        },
        "resolved": true,
        "details": {
          "function_name": "virVHBAManageVport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virvhba.c",
          "lines": "489-497",
          "snippet": "int\nvirVHBAManageVport(const int parent_host G_GNUC_UNUSED,\n                   const char *wwpn G_GNUC_UNUSED,\n                   const char *wwnn G_GNUC_UNUSED,\n                   int operation G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}",
          "includes": [
            "#include \"virvhba.h\"",
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"viralloc.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virvhba.h\"\n#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"viralloc.h\"\n#include <config.h>\n\nint\nvirVHBAManageVport(const int parent_host G_GNUC_UNUSED,\n                   const char *wwpn G_GNUC_UNUSED,\n                   const char *wwnn G_GNUC_UNUSED,\n                   int operation G_GNUC_UNUSED)\n{\n    virReportSystemError(ENOSYS, \"%s\", _(\"Not supported on this platform\"));\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjListGetParentHost",
          "args": [
            "driver->devs",
            "def"
          ],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjListGetParentHost",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "612-635",
          "snippet": "int\nvirNodeDeviceObjListGetParentHost(virNodeDeviceObjListPtr devs,\n                                  virNodeDeviceDefPtr def)\n{\n    int parent_host = -1;\n\n    if (def->parent) {\n        parent_host = virNodeDeviceObjListGetParentHostByParent(devs, def->name,\n                                                                def->parent);\n    } else if (def->parent_wwnn && def->parent_wwpn) {\n        parent_host = virNodeDeviceObjListGetParentHostByWWNs(devs, def->name,\n                                                              def->parent_wwnn,\n                                                              def->parent_wwpn);\n    } else if (def->parent_fabric_wwn) {\n        parent_host =\n            virNodeDeviceObjListGetParentHostByFabricWWN(devs, def->name,\n                                                         def->parent_fabric_wwn);\n    } else {\n        /* Try to find a vport capable scsi_host when no parent supplied */\n        parent_host = virNodeDeviceObjListFindVportParentHost(devs);\n    }\n\n    return parent_host;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirNodeDeviceObjListGetParentHost(virNodeDeviceObjListPtr devs,\n                                  virNodeDeviceDefPtr def)\n{\n    int parent_host = -1;\n\n    if (def->parent) {\n        parent_host = virNodeDeviceObjListGetParentHostByParent(devs, def->name,\n                                                                def->parent);\n    } else if (def->parent_wwnn && def->parent_wwpn) {\n        parent_host = virNodeDeviceObjListGetParentHostByWWNs(devs, def->name,\n                                                              def->parent_wwnn,\n                                                              def->parent_wwpn);\n    } else if (def->parent_fabric_wwn) {\n        parent_host =\n            virNodeDeviceObjListGetParentHostByFabricWWN(devs, def->name,\n                                                         def->parent_fabric_wwn);\n    } else {\n        /* Try to find a vport capable scsi_host when no parent supplied */\n        parent_host = virNodeDeviceObjListFindVportParentHost(devs);\n    }\n\n    return parent_host;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceGetWWNs",
          "args": [
            "def",
            "&wwnn",
            "&wwpn"
          ],
          "line": 516
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceGetWWNs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_conf.c",
          "lines": "2108-2134",
          "snippet": "int\nvirNodeDeviceGetWWNs(virNodeDeviceDefPtr def,\n                     char **wwnn,\n                     char **wwpn)\n{\n    virNodeDevCapsDefPtr cap = NULL;\n\n    cap = def->caps;\n    while (cap != NULL) {\n        if (cap->data.type == VIR_NODE_DEV_CAP_SCSI_HOST &&\n            cap->data.scsi_host.flags & VIR_NODE_DEV_CAP_FLAG_HBA_FC_HOST) {\n            *wwnn = g_strdup(cap->data.scsi_host.wwnn);\n            *wwpn = g_strdup(cap->data.scsi_host.wwpn);\n            break;\n        }\n\n        cap = cap->next;\n    }\n\n    if (cap == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Device is not a fibre channel HBA\"));\n        return -1;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virfcp.h\"",
            "#include \"virlog.h\"",
            "#include \"virrandom.h\"",
            "#include \"viruuid.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"device_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfcp.h\"\n#include \"virlog.h\"\n#include \"virrandom.h\"\n#include \"viruuid.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"device_conf.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNodeDeviceGetWWNs(virNodeDeviceDefPtr def,\n                     char **wwnn,\n                     char **wwpn)\n{\n    virNodeDevCapsDefPtr cap = NULL;\n\n    cap = def->caps;\n    while (cap != NULL) {\n        if (cap->data.type == VIR_NODE_DEV_CAP_SCSI_HOST &&\n            cap->data.scsi_host.flags & VIR_NODE_DEV_CAP_FLAG_HBA_FC_HOST) {\n            *wwnn = g_strdup(cap->data.scsi_host.wwnn);\n            *wwpn = g_strdup(cap->data.scsi_host.wwpn);\n            break;\n        }\n\n        cap = cap->next;\n    }\n\n    if (cap == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Device is not a fibre channel HBA\"));\n        return -1;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceCreateXMLEnsureACL",
          "args": [
            "conn",
            "def"
          ],
          "line": 513
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceDefParseString",
          "args": [
            "xmlDesc",
            "CREATE_DEVICE",
            "virt_type"
          ],
          "line": 510
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceDefParseString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_conf.c",
          "lines": "2087-2093",
          "snippet": "virNodeDeviceDefPtr\nvirNodeDeviceDefParseString(const char *str,\n                            int create,\n                            const char *virt_type)\n{\n    return virNodeDeviceDefParse(str, NULL, create, virt_type);\n}",
          "includes": [
            "#include \"virfcp.h\"",
            "#include \"virlog.h\"",
            "#include \"virrandom.h\"",
            "#include \"viruuid.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"device_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfcp.h\"\n#include \"virlog.h\"\n#include \"virrandom.h\"\n#include \"viruuid.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"device_conf.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDefPtr\nvirNodeDeviceDefParseString(const char *str,\n                            int create,\n                            const char *virt_type)\n{\n    return virNodeDeviceDefParse(str, NULL, create, virt_type);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectGetType",
          "args": [
            "conn"
          ],
          "line": 508
        },
        "resolved": true,
        "details": {
          "function_name": "virConnectGetType",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/libvirt-host.c",
          "lines": "153-168",
          "snippet": "const char *\nvirConnectGetType(virConnectPtr conn)\n{\n    const char *ret;\n    VIR_DEBUG(\"conn=%p\", conn);\n\n    virResetLastError();\n\n    virCheckConnectReturn(conn, NULL);\n\n    if (conn->driver->connectGetType) {\n        ret = conn->driver->connectGetType(conn);\n        if (ret) return ret;\n    }\n    return conn->driver->name;\n}",
          "includes": [
            "#include \"virtypedparam.h\"",
            "#include \"virlog.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include <sys/stat.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virtypedparam.h\"\n#include \"virlog.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include <sys/stat.h>\n#include <config.h>\n\nconst char *\nvirConnectGetType(virConnectPtr conn)\n{\n    const char *ret;\n    VIR_DEBUG(\"conn=%p\", conn);\n\n    virResetLastError();\n\n    virCheckConnectReturn(conn, NULL);\n\n    if (conn->driver->connectGetType) {\n        ret = conn->driver->connectGetType(conn);\n        if (ret) return ret;\n    }\n    return conn->driver->name;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 505
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "NULL"
          ],
          "line": 503
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nvirNodeDevicePtr\nnodeDeviceCreateXML(virConnectPtr conn,\n                    const char *xmlDesc,\n                    unsigned int flags)\n{\n    g_autoptr(virNodeDeviceDef) def = NULL;\n    g_autofree char *wwnn = NULL;\n    g_autofree char *wwpn = NULL;\n    int parent_host = -1;\n    virNodeDevicePtr device = NULL;\n    const char *virt_type = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (nodeDeviceWaitInit() < 0)\n        return NULL;\n\n    virt_type  = virConnectGetType(conn);\n\n    if (!(def = virNodeDeviceDefParseString(xmlDesc, CREATE_DEVICE, virt_type)))\n        return NULL;\n\n    if (virNodeDeviceCreateXMLEnsureACL(conn, def) < 0)\n        return NULL;\n\n    if (virNodeDeviceGetWWNs(def, &wwnn, &wwpn) == -1)\n        return NULL;\n\n    if ((parent_host = virNodeDeviceObjListGetParentHost(driver->devs, def)) < 0)\n        return NULL;\n\n    if (virVHBAManageVport(parent_host, wwpn, wwnn, VPORT_CREATE) < 0)\n        return NULL;\n\n    device = nodeDeviceFindNewDevice(conn, wwnn, wwpn);\n    /* We don't check the return value, because one way or another,\n     * we're returning what we get... */\n\n    if (device == NULL)\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device for '%s' with matching \"\n                         \"wwnn '%s' and wwpn '%s'\"),\n                       def->name, wwnn, wwpn);\n\n    return device;\n}"
  },
  {
    "function_name": "nodeDeviceFindNewDevice",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "463-488",
    "snippet": "static virNodeDevicePtr\nnodeDeviceFindNewDevice(virConnectPtr conn,\n                        const char *wwnn,\n                        const char *wwpn)\n{\n    virNodeDevicePtr device = NULL;\n    time_t start = 0, now = 0;\n\n    nodeDeviceGetTime(&start);\n\n    while ((now - start) < LINUX_NEW_DEVICE_WAIT_TIME) {\n\n        virWaitForDevices();\n\n        device = nodeDeviceLookupSCSIHostByWWN(conn, wwnn, wwpn, 0);\n\n        if (device != NULL)\n            break;\n\n        sleep(5);\n        if (nodeDeviceGetTime(&now) == -1)\n            break;\n    }\n\n    return device;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "nodeDeviceGetTime",
          "args": [
            "&now"
          ],
          "line": 483
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceGetTime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "432-447",
          "snippet": "static int\nnodeDeviceGetTime(time_t *t)\n{\n    int ret = 0;\n\n    *t = time(NULL);\n    if (*t == (time_t)-1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Could not get current time\"));\n\n        *t = 0;\n        ret = -1;\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nnodeDeviceGetTime(time_t *t)\n{\n    int ret = 0;\n\n    *t = time(NULL);\n    if (*t == (time_t)-1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Could not get current time\"));\n\n        *t = 0;\n        ret = -1;\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "sleep",
          "args": [
            "5"
          ],
          "line": 482
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "nodeDeviceLookupSCSIHostByWWN",
          "args": [
            "conn",
            "wwnn",
            "wwpn",
            "0"
          ],
          "line": 477
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceLookupSCSIHostByWWN",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "275-305",
          "snippet": "virNodeDevicePtr\nnodeDeviceLookupSCSIHostByWWN(virConnectPtr conn,\n                              const char *wwnn,\n                              const char *wwpn,\n                              unsigned int flags)\n{\n    virNodeDeviceObjPtr obj = NULL;\n    virNodeDeviceDefPtr def;\n    virNodeDevicePtr device = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (nodeDeviceWaitInit() < 0)\n        return NULL;\n\n    if (!(obj = virNodeDeviceObjListFindSCSIHostByWWNs(driver->devs,\n                                                       wwnn, wwpn)))\n        return NULL;\n\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceLookupSCSIHostByWWNEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    if ((device = virGetNodeDevice(conn, def->name)))\n        device->parentName = g_strdup(def->parent);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return device;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nvirNodeDevicePtr\nnodeDeviceLookupSCSIHostByWWN(virConnectPtr conn,\n                              const char *wwnn,\n                              const char *wwpn,\n                              unsigned int flags)\n{\n    virNodeDeviceObjPtr obj = NULL;\n    virNodeDeviceDefPtr def;\n    virNodeDevicePtr device = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (nodeDeviceWaitInit() < 0)\n        return NULL;\n\n    if (!(obj = virNodeDeviceObjListFindSCSIHostByWWNs(driver->devs,\n                                                       wwnn, wwpn)))\n        return NULL;\n\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceLookupSCSIHostByWWNEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    if ((device = virGetNodeDevice(conn, def->name)))\n        device->parentName = g_strdup(def->parent);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return device;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virWaitForDevices",
          "args": [],
          "line": 475
        },
        "resolved": true,
        "details": {
          "function_name": "virWaitForDevices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virutil.c",
          "lines": "1324-1341",
          "snippet": "void virWaitForDevices(void)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *udev = NULL;\n    int exitstatus;\n\n    if (!(udev = virFindFileInPath(UDEVADM)))\n        return;\n\n    if (!(cmd = virCommandNewArgList(udev, \"settle\", NULL)))\n        return;\n\n    /*\n     * NOTE: we ignore errors here; this is just to make sure that any device\n     * nodes that are being created finish before we try to scan them.\n     */\n    ignore_value(virCommandRun(cmd, &exitstatus));\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"vircommand.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "# include <sys/prctl.h>",
            "# include <cap-ng.h>",
            "# include <grp.h>",
            "# include <pwd.h>",
            "# include <libdevmapper.h>",
            "#include <sys/types.h>",
            "# include <sys/sysmacros.h>",
            "# include <conio.h>",
            "#include <sys/stat.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"vircommand.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"virbuffer.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n# include <sys/prctl.h>\n# include <cap-ng.h>\n# include <grp.h>\n# include <pwd.h>\n# include <libdevmapper.h>\n#include <sys/types.h>\n# include <sys/sysmacros.h>\n# include <conio.h>\n#include <sys/stat.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvoid virWaitForDevices(void)\n{\n    g_autoptr(virCommand) cmd = NULL;\n    g_autofree char *udev = NULL;\n    int exitstatus;\n\n    if (!(udev = virFindFileInPath(UDEVADM)))\n        return;\n\n    if (!(cmd = virCommandNewArgList(udev, \"settle\", NULL)))\n        return;\n\n    /*\n     * NOTE: we ignore errors here; this is just to make sure that any device\n     * nodes that are being created finish before we try to scan them.\n     */\n    ignore_value(virCommandRun(cmd, &exitstatus));\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic virNodeDevicePtr\nnodeDeviceFindNewDevice(virConnectPtr conn,\n                        const char *wwnn,\n                        const char *wwpn)\n{\n    virNodeDevicePtr device = NULL;\n    time_t start = 0, now = 0;\n\n    nodeDeviceGetTime(&start);\n\n    while ((now - start) < LINUX_NEW_DEVICE_WAIT_TIME) {\n\n        virWaitForDevices();\n\n        device = nodeDeviceLookupSCSIHostByWWN(conn, wwnn, wwpn, 0);\n\n        if (device != NULL)\n            break;\n\n        sleep(5);\n        if (nodeDeviceGetTime(&now) == -1)\n            break;\n    }\n\n    return device;\n}"
  },
  {
    "function_name": "nodeDeviceGetTime",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "432-447",
    "snippet": "static int\nnodeDeviceGetTime(time_t *t)\n{\n    int ret = 0;\n\n    *t = time(NULL);\n    if (*t == (time_t)-1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Could not get current time\"));\n\n        *t = 0;\n        ret = -1;\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"Could not get current time\")"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"Could not get current time\""
          ],
          "line": 440
        },
        "resolved": true,
        "details": {
          "function_name": "dev_refresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "493-509",
          "snippet": "static void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "NULL"
          ],
          "line": 437
        },
        "resolved": true,
        "details": {
          "function_name": "qemuBlockJobCleanStorageSourceRuntime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/qemu/qemu_blockjob.c",
          "lines": "636-647",
          "snippet": "static void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}",
          "includes": [
            "#include \"qemu_security.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"locking/domain_lock.h\"",
            "#include \"virtime.h\"",
            "#include \"virthread.h\"",
            "#include \"virstoragefile.h\"",
            "#include \"virlog.h\"",
            "#include \"conf/domain_event.h\"",
            "#include \"conf/domain_conf.h\"",
            "#include \"qemu_backup.h\"",
            "#include \"qemu_alias.h\"",
            "#include \"qemu_domain.h\"",
            "#include \"qemu_block.h\"",
            "#include \"qemu_blockjob.h\"",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"qemu_security.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"locking/domain_lock.h\"\n#include \"virtime.h\"\n#include \"virthread.h\"\n#include \"virstoragefile.h\"\n#include \"virlog.h\"\n#include \"conf/domain_event.h\"\n#include \"conf/domain_conf.h\"\n#include \"qemu_backup.h\"\n#include \"qemu_alias.h\"\n#include \"qemu_domain.h\"\n#include \"qemu_block.h\"\n#include \"qemu_blockjob.h\"\n#include \"internal.h\"\n#include <config.h>\n\nstatic void\nqemuBlockJobCleanStorageSourceRuntime(virStorageSourcePtr src)\n{\n    src->id = 0;\n    src->detected = false;\n    VIR_FREE(src->relPath);\n    VIR_FREE(src->backingStoreRaw);\n    VIR_FREE(src->nodestorage);\n    VIR_FREE(src->nodeformat);\n    VIR_FREE(src->tlsAlias);\n    VIR_FREE(src->tlsCertdir);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nnodeDeviceGetTime(time_t *t)\n{\n    int ret = 0;\n\n    *t = time(NULL);\n    if (*t == (time_t)-1) {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"Could not get current time\"));\n\n        *t = 0;\n        ret = -1;\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "nodeDeviceListCaps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "389-429",
    "snippet": "int\nnodeDeviceListCaps(virNodeDevicePtr device,\n                   char **const names,\n                   int maxnames)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    virNodeDevCapType *list = NULL;\n    int ncaps = 0;\n    int ret = -1;\n    size_t i = 0;\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return -1;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceListCapsEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    if ((ncaps = virNodeDeviceCapsListExport(def, &list)) < 0)\n        goto cleanup;\n\n    if (ncaps > maxnames)\n        ncaps = maxnames;\n\n    for (i = 0; i < ncaps; i++)\n        names[i] = g_strdup(virNodeDevCapTypeToString(list[i]));\n\n    ret = ncaps;\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    if (ret < 0) {\n        size_t j;\n        for (j = 0; j < i; j++)\n            VIR_FREE(names[j]);\n    }\n\n    VIR_FREE(list);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "list"
          ],
          "line": 427
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "names[j]"
          ],
          "line": 424
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 420
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "101-110",
          "snippet": "void\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvoid\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "virNodeDevCapTypeToString(list[i])"
          ],
          "line": 415
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDevCapTypeToString",
          "args": [
            "list[i]"
          ],
          "line": 415
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceCapsListExport",
          "args": [
            "def",
            "&list"
          ],
          "line": 408
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceCapsListExport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_conf.c",
          "lines": "2289-2350",
          "snippet": "int\nvirNodeDeviceCapsListExport(virNodeDeviceDefPtr def,\n                            virNodeDevCapType **list)\n{\n    virNodeDevCapsDefPtr caps = NULL;\n    virNodeDevCapType *tmp = NULL;\n    bool want_list = !!list;\n    int ncaps = 0;\n    int ret = -1;\n\n#define MAYBE_ADD_CAP(cap) \\\n    do { \\\n        if (want_list) \\\n            tmp[ncaps] = cap; \\\n    } while (0)\n\n    if (virNodeDeviceUpdateCaps(def) < 0)\n        goto cleanup;\n\n    if (want_list && VIR_ALLOC_N(tmp, VIR_NODE_DEV_CAP_LAST - 1) < 0)\n        goto cleanup;\n\n    for (caps = def->caps; caps; caps = caps->next) {\n        unsigned int flags;\n\n        MAYBE_ADD_CAP(caps->data.type);\n        ncaps++;\n\n        /* check nested caps for a given type as well */\n        if (caps->data.type == VIR_NODE_DEV_CAP_SCSI_HOST) {\n            flags = caps->data.scsi_host.flags;\n\n            if (flags & VIR_NODE_DEV_CAP_FLAG_HBA_FC_HOST) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_FC_HOST);\n                ncaps++;\n            }\n\n            if (flags  & VIR_NODE_DEV_CAP_FLAG_HBA_VPORT_OPS) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_VPORTS);\n                ncaps++;\n            }\n        }\n\n        if (caps->data.type == VIR_NODE_DEV_CAP_PCI_DEV) {\n            flags = caps->data.pci_dev.flags;\n\n            if (flags & VIR_NODE_DEV_CAP_FLAG_PCI_MDEV) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_MDEV_TYPES);\n                ncaps++;\n            }\n        }\n    }\n\n#undef MAYBE_ADD_CAP\n\n    if (want_list)\n        *list = g_steal_pointer(&tmp);\n    ret = ncaps;\n cleanup:\n    VIR_FREE(tmp);\n    return ret;\n}",
          "includes": [
            "#include \"virfcp.h\"",
            "#include \"virlog.h\"",
            "#include \"virrandom.h\"",
            "#include \"viruuid.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"device_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfcp.h\"\n#include \"virlog.h\"\n#include \"virrandom.h\"\n#include \"viruuid.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"device_conf.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNodeDeviceCapsListExport(virNodeDeviceDefPtr def,\n                            virNodeDevCapType **list)\n{\n    virNodeDevCapsDefPtr caps = NULL;\n    virNodeDevCapType *tmp = NULL;\n    bool want_list = !!list;\n    int ncaps = 0;\n    int ret = -1;\n\n#define MAYBE_ADD_CAP(cap) \\\n    do { \\\n        if (want_list) \\\n            tmp[ncaps] = cap; \\\n    } while (0)\n\n    if (virNodeDeviceUpdateCaps(def) < 0)\n        goto cleanup;\n\n    if (want_list && VIR_ALLOC_N(tmp, VIR_NODE_DEV_CAP_LAST - 1) < 0)\n        goto cleanup;\n\n    for (caps = def->caps; caps; caps = caps->next) {\n        unsigned int flags;\n\n        MAYBE_ADD_CAP(caps->data.type);\n        ncaps++;\n\n        /* check nested caps for a given type as well */\n        if (caps->data.type == VIR_NODE_DEV_CAP_SCSI_HOST) {\n            flags = caps->data.scsi_host.flags;\n\n            if (flags & VIR_NODE_DEV_CAP_FLAG_HBA_FC_HOST) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_FC_HOST);\n                ncaps++;\n            }\n\n            if (flags  & VIR_NODE_DEV_CAP_FLAG_HBA_VPORT_OPS) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_VPORTS);\n                ncaps++;\n            }\n        }\n\n        if (caps->data.type == VIR_NODE_DEV_CAP_PCI_DEV) {\n            flags = caps->data.pci_dev.flags;\n\n            if (flags & VIR_NODE_DEV_CAP_FLAG_PCI_MDEV) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_MDEV_TYPES);\n                ncaps++;\n            }\n        }\n    }\n\n#undef MAYBE_ADD_CAP\n\n    if (want_list)\n        *list = g_steal_pointer(&tmp);\n    ret = ncaps;\n cleanup:\n    VIR_FREE(tmp);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceListCapsEnsureACL",
          "args": [
            "device->conn",
            "def"
          ],
          "line": 405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjGetDef",
          "args": [
            "obj"
          ],
          "line": 403
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "113-117",
          "snippet": "virNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceObjFindByName",
          "args": [
            "device->name"
          ],
          "line": 401
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceObjFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "233-245",
          "snippet": "static virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nnodeDeviceListCaps(virNodeDevicePtr device,\n                   char **const names,\n                   int maxnames)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    virNodeDevCapType *list = NULL;\n    int ncaps = 0;\n    int ret = -1;\n    size_t i = 0;\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return -1;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceListCapsEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    if ((ncaps = virNodeDeviceCapsListExport(def, &list)) < 0)\n        goto cleanup;\n\n    if (ncaps > maxnames)\n        ncaps = maxnames;\n\n    for (i = 0; i < ncaps; i++)\n        names[i] = g_strdup(virNodeDevCapTypeToString(list[i]));\n\n    ret = ncaps;\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    if (ret < 0) {\n        size_t j;\n        for (j = 0; j < i; j++)\n            VIR_FREE(names[j]);\n    }\n\n    VIR_FREE(list);\n    return ret;\n}"
  },
  {
    "function_name": "nodeDeviceNumOfCaps",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "366-385",
    "snippet": "int\nnodeDeviceNumOfCaps(virNodeDevicePtr device)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    int ret = -1;\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return -1;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceNumOfCapsEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    ret = virNodeDeviceCapsListExport(def, NULL);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 383
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "101-110",
          "snippet": "void\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvoid\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceCapsListExport",
          "args": [
            "def",
            "NULL"
          ],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceCapsListExport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_conf.c",
          "lines": "2289-2350",
          "snippet": "int\nvirNodeDeviceCapsListExport(virNodeDeviceDefPtr def,\n                            virNodeDevCapType **list)\n{\n    virNodeDevCapsDefPtr caps = NULL;\n    virNodeDevCapType *tmp = NULL;\n    bool want_list = !!list;\n    int ncaps = 0;\n    int ret = -1;\n\n#define MAYBE_ADD_CAP(cap) \\\n    do { \\\n        if (want_list) \\\n            tmp[ncaps] = cap; \\\n    } while (0)\n\n    if (virNodeDeviceUpdateCaps(def) < 0)\n        goto cleanup;\n\n    if (want_list && VIR_ALLOC_N(tmp, VIR_NODE_DEV_CAP_LAST - 1) < 0)\n        goto cleanup;\n\n    for (caps = def->caps; caps; caps = caps->next) {\n        unsigned int flags;\n\n        MAYBE_ADD_CAP(caps->data.type);\n        ncaps++;\n\n        /* check nested caps for a given type as well */\n        if (caps->data.type == VIR_NODE_DEV_CAP_SCSI_HOST) {\n            flags = caps->data.scsi_host.flags;\n\n            if (flags & VIR_NODE_DEV_CAP_FLAG_HBA_FC_HOST) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_FC_HOST);\n                ncaps++;\n            }\n\n            if (flags  & VIR_NODE_DEV_CAP_FLAG_HBA_VPORT_OPS) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_VPORTS);\n                ncaps++;\n            }\n        }\n\n        if (caps->data.type == VIR_NODE_DEV_CAP_PCI_DEV) {\n            flags = caps->data.pci_dev.flags;\n\n            if (flags & VIR_NODE_DEV_CAP_FLAG_PCI_MDEV) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_MDEV_TYPES);\n                ncaps++;\n            }\n        }\n    }\n\n#undef MAYBE_ADD_CAP\n\n    if (want_list)\n        *list = g_steal_pointer(&tmp);\n    ret = ncaps;\n cleanup:\n    VIR_FREE(tmp);\n    return ret;\n}",
          "includes": [
            "#include \"virfcp.h\"",
            "#include \"virlog.h\"",
            "#include \"virrandom.h\"",
            "#include \"viruuid.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"device_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfcp.h\"\n#include \"virlog.h\"\n#include \"virrandom.h\"\n#include \"viruuid.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"device_conf.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNodeDeviceCapsListExport(virNodeDeviceDefPtr def,\n                            virNodeDevCapType **list)\n{\n    virNodeDevCapsDefPtr caps = NULL;\n    virNodeDevCapType *tmp = NULL;\n    bool want_list = !!list;\n    int ncaps = 0;\n    int ret = -1;\n\n#define MAYBE_ADD_CAP(cap) \\\n    do { \\\n        if (want_list) \\\n            tmp[ncaps] = cap; \\\n    } while (0)\n\n    if (virNodeDeviceUpdateCaps(def) < 0)\n        goto cleanup;\n\n    if (want_list && VIR_ALLOC_N(tmp, VIR_NODE_DEV_CAP_LAST - 1) < 0)\n        goto cleanup;\n\n    for (caps = def->caps; caps; caps = caps->next) {\n        unsigned int flags;\n\n        MAYBE_ADD_CAP(caps->data.type);\n        ncaps++;\n\n        /* check nested caps for a given type as well */\n        if (caps->data.type == VIR_NODE_DEV_CAP_SCSI_HOST) {\n            flags = caps->data.scsi_host.flags;\n\n            if (flags & VIR_NODE_DEV_CAP_FLAG_HBA_FC_HOST) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_FC_HOST);\n                ncaps++;\n            }\n\n            if (flags  & VIR_NODE_DEV_CAP_FLAG_HBA_VPORT_OPS) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_VPORTS);\n                ncaps++;\n            }\n        }\n\n        if (caps->data.type == VIR_NODE_DEV_CAP_PCI_DEV) {\n            flags = caps->data.pci_dev.flags;\n\n            if (flags & VIR_NODE_DEV_CAP_FLAG_PCI_MDEV) {\n                MAYBE_ADD_CAP(VIR_NODE_DEV_CAP_MDEV_TYPES);\n                ncaps++;\n            }\n        }\n    }\n\n#undef MAYBE_ADD_CAP\n\n    if (want_list)\n        *list = g_steal_pointer(&tmp);\n    ret = ncaps;\n cleanup:\n    VIR_FREE(tmp);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceNumOfCapsEnsureACL",
          "args": [
            "device->conn",
            "def"
          ],
          "line": 377
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjGetDef",
          "args": [
            "obj"
          ],
          "line": 375
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "113-117",
          "snippet": "virNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceObjFindByName",
          "args": [
            "device->name"
          ],
          "line": 373
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceObjFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "233-245",
          "snippet": "static virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint\nnodeDeviceNumOfCaps(virNodeDevicePtr device)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    int ret = -1;\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return -1;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceNumOfCapsEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    ret = virNodeDeviceCapsListExport(def, NULL);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return ret;\n}"
  },
  {
    "function_name": "nodeDeviceGetParent",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "339-363",
    "snippet": "char *\nnodeDeviceGetParent(virNodeDevicePtr device)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    char *ret = NULL;\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return NULL;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceGetParentEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    if (def->parent) {\n        ret = g_strdup(def->parent);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"no parent for this device\"));\n    }\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "101-110",
          "snippet": "void\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvoid\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"no parent for this device\")"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no parent for this device\""
          ],
          "line": 357
        },
        "resolved": true,
        "details": {
          "function_name": "dev_refresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "493-509",
          "snippet": "static void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "def->parent"
          ],
          "line": 354
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceGetParentEnsureACL",
          "args": [
            "device->conn",
            "def"
          ],
          "line": 350
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjGetDef",
          "args": [
            "obj"
          ],
          "line": 348
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "113-117",
          "snippet": "virNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceObjFindByName",
          "args": [
            "device->name"
          ],
          "line": 346
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceObjFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "233-245",
          "snippet": "static virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *\nnodeDeviceGetParent(virNodeDevicePtr device)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    char *ret = NULL;\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return NULL;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceGetParentEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    if (def->parent) {\n        ret = g_strdup(def->parent);\n    } else {\n        virReportError(VIR_ERR_INTERNAL_ERROR,\n                       \"%s\", _(\"no parent for this device\"));\n    }\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return ret;\n}"
  },
  {
    "function_name": "nodeDeviceGetXMLDesc",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "308-336",
    "snippet": "char *\nnodeDeviceGetXMLDesc(virNodeDevicePtr device,\n                     unsigned int flags)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    char *ret = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return NULL;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceGetXMLDescEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    if (nodeDeviceUpdateDriverName(def) < 0)\n        goto cleanup;\n\n    if (virNodeDeviceUpdateCaps(def) < 0)\n        goto cleanup;\n\n    ret = virNodeDeviceDefFormat(def);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return ret;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 334
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "101-110",
          "snippet": "void\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvoid\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceDefFormat",
          "args": [
            "def"
          ],
          "line": 331
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceDefFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_conf.c",
          "lines": "504-613",
          "snippet": "char *\nvirNodeDeviceDefFormat(const virNodeDeviceDef *def)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    virNodeDevCapsDefPtr caps;\n    size_t i = 0;\n\n    virBufferAddLit(&buf, \"<device>\\n\");\n    virBufferAdjustIndent(&buf, 2);\n    virBufferEscapeString(&buf, \"<name>%s</name>\\n\", def->name);\n    virBufferEscapeString(&buf, \"<path>%s</path>\\n\", def->sysfs_path);\n    if (def->devnode)\n        virBufferEscapeString(&buf, \"<devnode type='dev'>%s</devnode>\\n\",\n                              def->devnode);\n    if (def->devlinks) {\n        for (i = 0; def->devlinks[i]; i++)\n            virBufferEscapeString(&buf, \"<devnode type='link'>%s</devnode>\\n\",\n                                  def->devlinks[i]);\n    }\n    if (def->parent)\n        virBufferEscapeString(&buf, \"<parent>%s</parent>\\n\", def->parent);\n    if (def->driver) {\n        virBufferAddLit(&buf, \"<driver>\\n\");\n        virBufferAdjustIndent(&buf, 2);\n        virBufferEscapeString(&buf, \"<name>%s</name>\\n\", def->driver);\n        virBufferAdjustIndent(&buf, -2);\n        virBufferAddLit(&buf, \"</driver>\\n\");\n    }\n\n    for (caps = def->caps; caps; caps = caps->next) {\n        virNodeDevCapDataPtr data = &caps->data;\n\n        virBufferAsprintf(&buf, \"<capability type='%s'>\\n\",\n                          virNodeDevCapTypeToString(caps->data.type));\n        virBufferAdjustIndent(&buf, 2);\n        switch (caps->data.type) {\n        case VIR_NODE_DEV_CAP_SYSTEM:\n            virNodeDeviceCapSystemDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_PCI_DEV:\n            virNodeDeviceCapPCIDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_USB_DEV:\n            virNodeDeviceCapUSBDevDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_USB_INTERFACE:\n            virNodeDeviceCapUSBInterfaceDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_NET:\n            virNodeDeviceCapNetDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_SCSI_HOST:\n            virNodeDeviceCapSCSIHostDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_SCSI_TARGET:\n            virBufferEscapeString(&buf, \"<target>%s</target>\\n\",\n                                  data->scsi_target.name);\n            if (data->scsi_target.flags & VIR_NODE_DEV_CAP_FLAG_FC_RPORT) {\n                virBufferAddLit(&buf, \"<capability type='fc_remote_port'>\\n\");\n                virBufferAdjustIndent(&buf, 2);\n                virBufferAsprintf(&buf, \"<rport>%s</rport>\\n\",\n                                  data->scsi_target.rport);\n                virBufferAsprintf(&buf, \"<wwpn>%s</wwpn>\\n\",\n                                  data->scsi_target.wwpn);\n                virBufferAdjustIndent(&buf, -2);\n                virBufferAddLit(&buf, \"</capability>\\n\");\n            }\n            break;\n        case VIR_NODE_DEV_CAP_SCSI:\n            virNodeDeviceCapSCSIDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_STORAGE:\n            virNodeDeviceCapStorageDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_SCSI_GENERIC:\n            virBufferEscapeString(&buf, \"<char>%s</char>\\n\",\n                                  data->sg.path);\n            break;\n        case VIR_NODE_DEV_CAP_DRM:\n            virBufferEscapeString(&buf, \"<type>%s</type>\\n\", virNodeDevDRMTypeToString(data->drm.type));\n            break;\n        case VIR_NODE_DEV_CAP_MDEV:\n            virBufferEscapeString(&buf, \"<type id='%s'/>\\n\", data->mdev.type);\n            virBufferAsprintf(&buf, \"<iommuGroup number='%u'/>\\n\",\n                              data->mdev.iommuGroupNumber);\n            break;\n        case VIR_NODE_DEV_CAP_CCW_DEV:\n            virBufferAsprintf(&buf, \"<cssid>0x%x</cssid>\\n\",\n                              data->ccw_dev.cssid);\n            virBufferAsprintf(&buf, \"<ssid>0x%x</ssid>\\n\",\n                              data->ccw_dev.ssid);\n            virBufferAsprintf(&buf, \"<devno>0x%04x</devno>\\n\",\n                              data->ccw_dev.devno);\n            break;\n        case VIR_NODE_DEV_CAP_MDEV_TYPES:\n        case VIR_NODE_DEV_CAP_FC_HOST:\n        case VIR_NODE_DEV_CAP_VPORTS:\n        case VIR_NODE_DEV_CAP_LAST:\n            break;\n        }\n\n        virBufferAdjustIndent(&buf, -2);\n        virBufferAddLit(&buf, \"</capability>\\n\");\n    }\n\n    virBufferAdjustIndent(&buf, -2);\n    virBufferAddLit(&buf, \"</device>\\n\");\n\n    return virBufferContentAndReset(&buf);\n}",
          "includes": [
            "#include \"virfcp.h\"",
            "#include \"virlog.h\"",
            "#include \"virrandom.h\"",
            "#include \"viruuid.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"device_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfcp.h\"\n#include \"virlog.h\"\n#include \"virrandom.h\"\n#include \"viruuid.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"device_conf.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <unistd.h>\n#include <config.h>\n\nchar *\nvirNodeDeviceDefFormat(const virNodeDeviceDef *def)\n{\n    virBuffer buf = VIR_BUFFER_INITIALIZER;\n    virNodeDevCapsDefPtr caps;\n    size_t i = 0;\n\n    virBufferAddLit(&buf, \"<device>\\n\");\n    virBufferAdjustIndent(&buf, 2);\n    virBufferEscapeString(&buf, \"<name>%s</name>\\n\", def->name);\n    virBufferEscapeString(&buf, \"<path>%s</path>\\n\", def->sysfs_path);\n    if (def->devnode)\n        virBufferEscapeString(&buf, \"<devnode type='dev'>%s</devnode>\\n\",\n                              def->devnode);\n    if (def->devlinks) {\n        for (i = 0; def->devlinks[i]; i++)\n            virBufferEscapeString(&buf, \"<devnode type='link'>%s</devnode>\\n\",\n                                  def->devlinks[i]);\n    }\n    if (def->parent)\n        virBufferEscapeString(&buf, \"<parent>%s</parent>\\n\", def->parent);\n    if (def->driver) {\n        virBufferAddLit(&buf, \"<driver>\\n\");\n        virBufferAdjustIndent(&buf, 2);\n        virBufferEscapeString(&buf, \"<name>%s</name>\\n\", def->driver);\n        virBufferAdjustIndent(&buf, -2);\n        virBufferAddLit(&buf, \"</driver>\\n\");\n    }\n\n    for (caps = def->caps; caps; caps = caps->next) {\n        virNodeDevCapDataPtr data = &caps->data;\n\n        virBufferAsprintf(&buf, \"<capability type='%s'>\\n\",\n                          virNodeDevCapTypeToString(caps->data.type));\n        virBufferAdjustIndent(&buf, 2);\n        switch (caps->data.type) {\n        case VIR_NODE_DEV_CAP_SYSTEM:\n            virNodeDeviceCapSystemDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_PCI_DEV:\n            virNodeDeviceCapPCIDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_USB_DEV:\n            virNodeDeviceCapUSBDevDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_USB_INTERFACE:\n            virNodeDeviceCapUSBInterfaceDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_NET:\n            virNodeDeviceCapNetDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_SCSI_HOST:\n            virNodeDeviceCapSCSIHostDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_SCSI_TARGET:\n            virBufferEscapeString(&buf, \"<target>%s</target>\\n\",\n                                  data->scsi_target.name);\n            if (data->scsi_target.flags & VIR_NODE_DEV_CAP_FLAG_FC_RPORT) {\n                virBufferAddLit(&buf, \"<capability type='fc_remote_port'>\\n\");\n                virBufferAdjustIndent(&buf, 2);\n                virBufferAsprintf(&buf, \"<rport>%s</rport>\\n\",\n                                  data->scsi_target.rport);\n                virBufferAsprintf(&buf, \"<wwpn>%s</wwpn>\\n\",\n                                  data->scsi_target.wwpn);\n                virBufferAdjustIndent(&buf, -2);\n                virBufferAddLit(&buf, \"</capability>\\n\");\n            }\n            break;\n        case VIR_NODE_DEV_CAP_SCSI:\n            virNodeDeviceCapSCSIDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_STORAGE:\n            virNodeDeviceCapStorageDefFormat(&buf, data);\n            break;\n        case VIR_NODE_DEV_CAP_SCSI_GENERIC:\n            virBufferEscapeString(&buf, \"<char>%s</char>\\n\",\n                                  data->sg.path);\n            break;\n        case VIR_NODE_DEV_CAP_DRM:\n            virBufferEscapeString(&buf, \"<type>%s</type>\\n\", virNodeDevDRMTypeToString(data->drm.type));\n            break;\n        case VIR_NODE_DEV_CAP_MDEV:\n            virBufferEscapeString(&buf, \"<type id='%s'/>\\n\", data->mdev.type);\n            virBufferAsprintf(&buf, \"<iommuGroup number='%u'/>\\n\",\n                              data->mdev.iommuGroupNumber);\n            break;\n        case VIR_NODE_DEV_CAP_CCW_DEV:\n            virBufferAsprintf(&buf, \"<cssid>0x%x</cssid>\\n\",\n                              data->ccw_dev.cssid);\n            virBufferAsprintf(&buf, \"<ssid>0x%x</ssid>\\n\",\n                              data->ccw_dev.ssid);\n            virBufferAsprintf(&buf, \"<devno>0x%04x</devno>\\n\",\n                              data->ccw_dev.devno);\n            break;\n        case VIR_NODE_DEV_CAP_MDEV_TYPES:\n        case VIR_NODE_DEV_CAP_FC_HOST:\n        case VIR_NODE_DEV_CAP_VPORTS:\n        case VIR_NODE_DEV_CAP_LAST:\n            break;\n        }\n\n        virBufferAdjustIndent(&buf, -2);\n        virBufferAddLit(&buf, \"</capability>\\n\");\n    }\n\n    virBufferAdjustIndent(&buf, -2);\n    virBufferAddLit(&buf, \"</device>\\n\");\n\n    return virBufferContentAndReset(&buf);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceUpdateCaps",
          "args": [
            "def"
          ],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceUpdateCaps",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/node_device_conf.c",
          "lines": "2223-2274",
          "snippet": "int\nvirNodeDeviceUpdateCaps(virNodeDeviceDefPtr def)\n{\n    virNodeDevCapsDefPtr cap = def->caps;\n\n    while (cap) {\n        switch (cap->data.type) {\n        case VIR_NODE_DEV_CAP_SCSI_HOST:\n            virNodeDeviceGetSCSIHostCaps(&cap->data.scsi_host);\n            break;\n        case VIR_NODE_DEV_CAP_SCSI_TARGET:\n            virNodeDeviceGetSCSITargetCaps(def->sysfs_path,\n                                           &cap->data.scsi_target);\n            break;\n        case VIR_NODE_DEV_CAP_NET:\n            if (virNetDevGetLinkInfo(cap->data.net.ifname,\n                                     &cap->data.net.lnk) < 0)\n                return -1;\n            virBitmapFree(cap->data.net.features);\n            if (virNetDevGetFeatures(cap->data.net.ifname,\n                                     &cap->data.net.features) < 0)\n                return -1;\n            break;\n        case VIR_NODE_DEV_CAP_PCI_DEV:\n            if (virNodeDeviceGetPCIDynamicCaps(def->sysfs_path,\n                                               &cap->data.pci_dev) < 0)\n                return -1;\n            break;\n\n            /* all types that (supposedly) don't require any updates\n             * relative to what's in the cache.\n             */\n        case VIR_NODE_DEV_CAP_DRM:\n        case VIR_NODE_DEV_CAP_SYSTEM:\n        case VIR_NODE_DEV_CAP_USB_DEV:\n        case VIR_NODE_DEV_CAP_USB_INTERFACE:\n        case VIR_NODE_DEV_CAP_SCSI:\n        case VIR_NODE_DEV_CAP_STORAGE:\n        case VIR_NODE_DEV_CAP_FC_HOST:\n        case VIR_NODE_DEV_CAP_VPORTS:\n        case VIR_NODE_DEV_CAP_SCSI_GENERIC:\n        case VIR_NODE_DEV_CAP_MDEV_TYPES:\n        case VIR_NODE_DEV_CAP_MDEV:\n        case VIR_NODE_DEV_CAP_CCW_DEV:\n        case VIR_NODE_DEV_CAP_LAST:\n            break;\n        }\n        cap = cap->next;\n    }\n\n    return 0;\n}",
          "includes": [
            "#include \"virfcp.h\"",
            "#include \"virlog.h\"",
            "#include \"virrandom.h\"",
            "#include \"viruuid.h\"",
            "#include \"virbuffer.h\"",
            "#include \"virxml.h\"",
            "#include \"device_conf.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virfcp.h\"\n#include \"virlog.h\"\n#include \"virrandom.h\"\n#include \"viruuid.h\"\n#include \"virbuffer.h\"\n#include \"virxml.h\"\n#include \"device_conf.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <unistd.h>\n#include <config.h>\n\nint\nvirNodeDeviceUpdateCaps(virNodeDeviceDefPtr def)\n{\n    virNodeDevCapsDefPtr cap = def->caps;\n\n    while (cap) {\n        switch (cap->data.type) {\n        case VIR_NODE_DEV_CAP_SCSI_HOST:\n            virNodeDeviceGetSCSIHostCaps(&cap->data.scsi_host);\n            break;\n        case VIR_NODE_DEV_CAP_SCSI_TARGET:\n            virNodeDeviceGetSCSITargetCaps(def->sysfs_path,\n                                           &cap->data.scsi_target);\n            break;\n        case VIR_NODE_DEV_CAP_NET:\n            if (virNetDevGetLinkInfo(cap->data.net.ifname,\n                                     &cap->data.net.lnk) < 0)\n                return -1;\n            virBitmapFree(cap->data.net.features);\n            if (virNetDevGetFeatures(cap->data.net.ifname,\n                                     &cap->data.net.features) < 0)\n                return -1;\n            break;\n        case VIR_NODE_DEV_CAP_PCI_DEV:\n            if (virNodeDeviceGetPCIDynamicCaps(def->sysfs_path,\n                                               &cap->data.pci_dev) < 0)\n                return -1;\n            break;\n\n            /* all types that (supposedly) don't require any updates\n             * relative to what's in the cache.\n             */\n        case VIR_NODE_DEV_CAP_DRM:\n        case VIR_NODE_DEV_CAP_SYSTEM:\n        case VIR_NODE_DEV_CAP_USB_DEV:\n        case VIR_NODE_DEV_CAP_USB_INTERFACE:\n        case VIR_NODE_DEV_CAP_SCSI:\n        case VIR_NODE_DEV_CAP_STORAGE:\n        case VIR_NODE_DEV_CAP_FC_HOST:\n        case VIR_NODE_DEV_CAP_VPORTS:\n        case VIR_NODE_DEV_CAP_SCSI_GENERIC:\n        case VIR_NODE_DEV_CAP_MDEV_TYPES:\n        case VIR_NODE_DEV_CAP_MDEV:\n        case VIR_NODE_DEV_CAP_CCW_DEV:\n        case VIR_NODE_DEV_CAP_LAST:\n            break;\n        }\n        cap = cap->next;\n    }\n\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceUpdateDriverName",
          "args": [
            "def"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceUpdateDriverName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "137-141",
          "snippet": "static int\nnodeDeviceUpdateDriverName(virNodeDeviceDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nnodeDeviceUpdateDriverName(virNodeDeviceDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceGetXMLDescEnsureACL",
          "args": [
            "device->conn",
            "def"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjGetDef",
          "args": [
            "obj"
          ],
          "line": 320
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "113-117",
          "snippet": "virNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceObjFindByName",
          "args": [
            "device->name"
          ],
          "line": 318
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceObjFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "233-245",
          "snippet": "static virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "NULL"
          ],
          "line": 316
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nchar *\nnodeDeviceGetXMLDesc(virNodeDevicePtr device,\n                     unsigned int flags)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    char *ret = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (!(obj = nodeDeviceObjFindByName(device->name)))\n        return NULL;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceGetXMLDescEnsureACL(device->conn, def) < 0)\n        goto cleanup;\n\n    if (nodeDeviceUpdateDriverName(def) < 0)\n        goto cleanup;\n\n    if (virNodeDeviceUpdateCaps(def) < 0)\n        goto cleanup;\n\n    ret = virNodeDeviceDefFormat(def);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return ret;\n}"
  },
  {
    "function_name": "nodeDeviceLookupSCSIHostByWWN",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "275-305",
    "snippet": "virNodeDevicePtr\nnodeDeviceLookupSCSIHostByWWN(virConnectPtr conn,\n                              const char *wwnn,\n                              const char *wwpn,\n                              unsigned int flags)\n{\n    virNodeDeviceObjPtr obj = NULL;\n    virNodeDeviceDefPtr def;\n    virNodeDevicePtr device = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (nodeDeviceWaitInit() < 0)\n        return NULL;\n\n    if (!(obj = virNodeDeviceObjListFindSCSIHostByWWNs(driver->devs,\n                                                       wwnn, wwpn)))\n        return NULL;\n\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceLookupSCSIHostByWWNEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    if ((device = virGetNodeDevice(conn, def->name)))\n        device->parentName = g_strdup(def->parent);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return device;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "101-110",
          "snippet": "void\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvoid\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "def->parent"
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetNodeDevice",
          "args": [
            "conn",
            "def->name"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "virGetNodeDevice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/datatypes.c",
          "lines": "671-693",
          "snippet": "virNodeDevicePtr\nvirGetNodeDevice(virConnectPtr conn, const char *name)\n{\n    virNodeDevicePtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(name, error);\n\n    if (!(ret = virObjectNew(virNodeDeviceClass)))\n        goto error;\n\n    ret->name = g_strdup(name);\n\n    ret->conn = virObjectRef(conn);\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virClassPtr virNodeDeviceClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirClassPtr virNodeDeviceClass;\n\nvirNodeDevicePtr\nvirGetNodeDevice(virConnectPtr conn, const char *name)\n{\n    virNodeDevicePtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(name, error);\n\n    if (!(ret = virObjectNew(virNodeDeviceClass)))\n        goto error;\n\n    ret->name = g_strdup(name);\n\n    ret->conn = virObjectRef(conn);\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceLookupSCSIHostByWWNEnsureACL",
          "args": [
            "conn",
            "def"
          ],
          "line": 296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjGetDef",
          "args": [
            "obj"
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "113-117",
          "snippet": "virNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjListFindSCSIHostByWWNs",
          "args": [
            "driver->devs",
            "wwnn",
            "wwpn"
          ],
          "line": 290
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjListFindSCSIHostByWWNs",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "389-400",
          "snippet": "virNodeDeviceObjPtr\nvirNodeDeviceObjListFindSCSIHostByWWNs(virNodeDeviceObjListPtr devs,\n                                       const char *wwnn,\n                                       const char *wwpn)\n{\n    struct virNodeDeviceObjListFindSCSIHostByWWNsData data = {\n        .wwnn = wwnn, .wwpn = wwpn };\n\n    return virNodeDeviceObjListSearch(devs,\n                                      virNodeDeviceObjListFindSCSIHostByWWNsCallback,\n                                      &data);\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceObjPtr\nvirNodeDeviceObjListFindSCSIHostByWWNs(virNodeDeviceObjListPtr devs,\n                                       const char *wwnn,\n                                       const char *wwpn)\n{\n    struct virNodeDeviceObjListFindSCSIHostByWWNsData data = {\n        .wwnn = wwnn, .wwpn = wwpn };\n\n    return virNodeDeviceObjListSearch(devs,\n                                      virNodeDeviceObjListFindSCSIHostByWWNsCallback,\n                                      &data);\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 287
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "NULL"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nvirNodeDevicePtr\nnodeDeviceLookupSCSIHostByWWN(virConnectPtr conn,\n                              const char *wwnn,\n                              const char *wwpn,\n                              unsigned int flags)\n{\n    virNodeDeviceObjPtr obj = NULL;\n    virNodeDeviceDefPtr def;\n    virNodeDevicePtr device = NULL;\n\n    virCheckFlags(0, NULL);\n\n    if (nodeDeviceWaitInit() < 0)\n        return NULL;\n\n    if (!(obj = virNodeDeviceObjListFindSCSIHostByWWNs(driver->devs,\n                                                       wwnn, wwpn)))\n        return NULL;\n\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceLookupSCSIHostByWWNEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    if ((device = virGetNodeDevice(conn, def->name)))\n        device->parentName = g_strdup(def->parent);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return device;\n}"
  },
  {
    "function_name": "nodeDeviceLookupByName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "248-272",
    "snippet": "virNodeDevicePtr\nnodeDeviceLookupByName(virConnectPtr conn,\n                       const char *name)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    virNodeDevicePtr device = NULL;\n\n    if (nodeDeviceWaitInit() < 0)\n        return NULL;\n\n    if (!(obj = nodeDeviceObjFindByName(name)))\n        return NULL;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceLookupByNameEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    if ((device = virGetNodeDevice(conn, name)))\n        device->parentName = g_strdup(def->parent);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return device;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjEndAPI",
          "args": [
            "&obj"
          ],
          "line": 270
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjEndAPI",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "101-110",
          "snippet": "void\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvoid\nvirNodeDeviceObjEndAPI(virNodeDeviceObjPtr *obj)\n{\n    if (!*obj)\n        return;\n\n    virObjectUnlock(*obj);\n    virObjectUnref(*obj);\n    *obj = NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "def->parent"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virGetNodeDevice",
          "args": [
            "conn",
            "name"
          ],
          "line": 266
        },
        "resolved": true,
        "details": {
          "function_name": "virGetNodeDevice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/datatypes.c",
          "lines": "671-693",
          "snippet": "virNodeDevicePtr\nvirGetNodeDevice(virConnectPtr conn, const char *name)\n{\n    virNodeDevicePtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(name, error);\n\n    if (!(ret = virObjectNew(virNodeDeviceClass)))\n        goto error;\n\n    ret->name = g_strdup(name);\n\n    ret->conn = virObjectRef(conn);\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"virlog.h\"",
            "#include \"virerror.h\"",
            "#include \"datatypes.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virClassPtr virNodeDeviceClass;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"virlog.h\"\n#include \"virerror.h\"\n#include \"datatypes.h\"\n#include <unistd.h>\n#include <config.h>\n\nvirClassPtr virNodeDeviceClass;\n\nvirNodeDevicePtr\nvirGetNodeDevice(virConnectPtr conn, const char *name)\n{\n    virNodeDevicePtr ret = NULL;\n\n    if (virDataTypesInitialize() < 0)\n        return NULL;\n\n    virCheckConnectGoto(conn, error);\n    virCheckNonNullArgGoto(name, error);\n\n    if (!(ret = virObjectNew(virNodeDeviceClass)))\n        goto error;\n\n    ret->name = g_strdup(name);\n\n    ret->conn = virObjectRef(conn);\n    return ret;\n\n error:\n    virObjectUnref(ret);\n    return NULL;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceLookupByNameEnsureACL",
          "args": [
            "conn",
            "def"
          ],
          "line": 263
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjGetDef",
          "args": [
            "obj"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjGetDef",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "113-117",
          "snippet": "virNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceDefPtr\nvirNodeDeviceObjGetDef(virNodeDeviceObjPtr obj)\n{\n    return obj->def;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceObjFindByName",
          "args": [
            "name"
          ],
          "line": 259
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceObjFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "233-245",
          "snippet": "static virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDevicePtr\nnodeDeviceLookupByName(virConnectPtr conn,\n                       const char *name)\n{\n    virNodeDeviceObjPtr obj;\n    virNodeDeviceDefPtr def;\n    virNodeDevicePtr device = NULL;\n\n    if (nodeDeviceWaitInit() < 0)\n        return NULL;\n\n    if (!(obj = nodeDeviceObjFindByName(name)))\n        return NULL;\n    def = virNodeDeviceObjGetDef(obj);\n\n    if (virNodeDeviceLookupByNameEnsureACL(conn, def) < 0)\n        goto cleanup;\n\n    if ((device = virGetNodeDevice(conn, name)))\n        device->parentName = g_strdup(def->parent);\n\n cleanup:\n    virNodeDeviceObjEndAPI(&obj);\n    return device;\n}"
  },
  {
    "function_name": "nodeDeviceObjFindByName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "233-245",
    "snippet": "static virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_NO_NODE_DEVICE",
            "_(\"no node device with matching name '%s'\")",
            "name"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"no node device with matching name '%s'\""
          ],
          "line": 240
        },
        "resolved": true,
        "details": {
          "function_name": "dev_refresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "493-509",
          "snippet": "static void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virNodeDeviceObjListFindByName",
          "args": [
            "driver->devs",
            "name"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjListFindByName",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "236-249",
          "snippet": "virNodeDeviceObjPtr\nvirNodeDeviceObjListFindByName(virNodeDeviceObjListPtr devs,\n                               const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    virObjectRWLockRead(devs);\n    obj = virNodeDeviceObjListFindByNameLocked(devs, name);\n    virObjectRWUnlock(devs);\n    if (obj)\n        virObjectLock(obj);\n\n    return obj;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nvirNodeDeviceObjPtr\nvirNodeDeviceObjListFindByName(virNodeDeviceObjListPtr devs,\n                               const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    virObjectRWLockRead(devs);\n    obj = virNodeDeviceObjListFindByNameLocked(devs, name);\n    virObjectRWUnlock(devs);\n    if (obj)\n        virObjectLock(obj);\n\n    return obj;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic virNodeDeviceObjPtr\nnodeDeviceObjFindByName(const char *name)\n{\n    virNodeDeviceObjPtr obj;\n\n    if (!(obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        virReportError(VIR_ERR_NO_NODE_DEVICE,\n                       _(\"no node device with matching name '%s'\"),\n                       name);\n    }\n\n    return obj;\n}"
  },
  {
    "function_name": "nodeConnectListAllNodeDevices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "214-230",
    "snippet": "int\nnodeConnectListAllNodeDevices(virConnectPtr conn,\n                              virNodeDevicePtr **devices,\n                              unsigned int flags)\n{\n    virCheckFlags(VIR_CONNECT_LIST_NODE_DEVICES_FILTERS_CAP, -1);\n\n    if (virConnectListAllNodeDevicesEnsureACL(conn) < 0)\n        return -1;\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    return virNodeDeviceObjListExport(conn, driver->devs, devices,\n                                      virConnectListAllNodeDevicesCheckACL,\n                                      flags);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjListExport",
          "args": [
            "conn",
            "driver->devs",
            "devices",
            "virConnectListAllNodeDevicesCheckACL",
            "flags"
          ],
          "line": 227
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjListExport",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "885-919",
          "snippet": "int\nvirNodeDeviceObjListExport(virConnectPtr conn,\n                           virNodeDeviceObjListPtr devs,\n                           virNodeDevicePtr **devices,\n                           virNodeDeviceObjListFilter filter,\n                           unsigned int flags)\n{\n    virNodeDeviceObjListExportData data = {\n        .conn = conn, .filter = filter, .flags = flags,\n        .devices = NULL, .ndevices = 0, .error = false };\n\n    virObjectRWLockRead(devs);\n    if (devices &&\n        VIR_ALLOC_N(data.devices, virHashSize(devs->objs) + 1) < 0) {\n        virObjectRWUnlock(devs);\n        return -1;\n    }\n\n    virHashForEach(devs->objs, virNodeDeviceObjListExportCallback, &data);\n    virObjectRWUnlock(devs);\n\n    if (data.error)\n        goto cleanup;\n\n    if (data.devices) {\n        ignore_value(VIR_REALLOC_N(data.devices, data.ndevices + 1));\n        *devices = data.devices;\n     }\n\n    return data.ndevices;\n\n cleanup:\n    virObjectListFree(data.devices);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirNodeDeviceObjListExport(virConnectPtr conn,\n                           virNodeDeviceObjListPtr devs,\n                           virNodeDevicePtr **devices,\n                           virNodeDeviceObjListFilter filter,\n                           unsigned int flags)\n{\n    virNodeDeviceObjListExportData data = {\n        .conn = conn, .filter = filter, .flags = flags,\n        .devices = NULL, .ndevices = 0, .error = false };\n\n    virObjectRWLockRead(devs);\n    if (devices &&\n        VIR_ALLOC_N(data.devices, virHashSize(devs->objs) + 1) < 0) {\n        virObjectRWUnlock(devs);\n        return -1;\n    }\n\n    virHashForEach(devs->objs, virNodeDeviceObjListExportCallback, &data);\n    virObjectRWUnlock(devs);\n\n    if (data.error)\n        goto cleanup;\n\n    if (data.devices) {\n        ignore_value(VIR_REALLOC_N(data.devices, data.ndevices + 1));\n        *devices = data.devices;\n     }\n\n    return data.ndevices;\n\n cleanup:\n    virObjectListFree(data.devices);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 224
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virConnectListAllNodeDevicesEnsureACL",
          "args": [
            "conn"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_CONNECT_LIST_NODE_DEVICES_FILTERS_CAP",
            "-1"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nint\nnodeConnectListAllNodeDevices(virConnectPtr conn,\n                              virNodeDevicePtr **devices,\n                              unsigned int flags)\n{\n    virCheckFlags(VIR_CONNECT_LIST_NODE_DEVICES_FILTERS_CAP, -1);\n\n    if (virConnectListAllNodeDevicesEnsureACL(conn) < 0)\n        return -1;\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    return virNodeDeviceObjListExport(conn, driver->devs, devices,\n                                      virConnectListAllNodeDevicesCheckACL,\n                                      flags);\n}"
  },
  {
    "function_name": "nodeListDevices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "193-211",
    "snippet": "int\nnodeListDevices(virConnectPtr conn,\n                const char *cap,\n                char **const names,\n                int maxnames,\n                unsigned int flags)\n{\n    if (virNodeListDevicesEnsureACL(conn) < 0)\n        return -1;\n\n    virCheckFlags(0, -1);\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    return virNodeDeviceObjListGetNames(driver->devs, conn,\n                                        virNodeListDevicesCheckACL,\n                                        cap, names, maxnames);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjListGetNames",
          "args": [
            "driver->devs",
            "conn",
            "virNodeListDevicesCheckACL",
            "cap",
            "names",
            "maxnames"
          ],
          "line": 208
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjListGetNames",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "773-798",
          "snippet": "int\nvirNodeDeviceObjListGetNames(virNodeDeviceObjListPtr devs,\n                             virConnectPtr conn,\n                             virNodeDeviceObjListFilter filter,\n                             const char *cap,\n                             char **const names,\n                             int maxnames)\n{\n    struct virNodeDeviceGetNamesData data = {\n        .conn = conn, .filter = filter, .matchstr = cap, .names = names,\n        .nnames = 0, .maxnames = maxnames, .error = false };\n\n    virObjectRWLockRead(devs);\n    virHashForEach(devs->objs, virNodeDeviceObjListGetNamesCallback, &data);\n    virObjectRWUnlock(devs);\n\n    if (data.error)\n        goto error;\n\n    return data.nnames;\n\n error:\n    while (--data.nnames)\n        VIR_FREE(data.names[data.nnames]);\n    return -1;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirNodeDeviceObjListGetNames(virNodeDeviceObjListPtr devs,\n                             virConnectPtr conn,\n                             virNodeDeviceObjListFilter filter,\n                             const char *cap,\n                             char **const names,\n                             int maxnames)\n{\n    struct virNodeDeviceGetNamesData data = {\n        .conn = conn, .filter = filter, .matchstr = cap, .names = names,\n        .nnames = 0, .maxnames = maxnames, .error = false };\n\n    virObjectRWLockRead(devs);\n    virHashForEach(devs->objs, virNodeDeviceObjListGetNamesCallback, &data);\n    virObjectRWUnlock(devs);\n\n    if (data.error)\n        goto error;\n\n    return data.nnames;\n\n error:\n    while (--data.nnames)\n        VIR_FREE(data.names[data.nnames]);\n    return -1;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeListDevicesEnsureACL",
          "args": [
            "conn"
          ],
          "line": 200
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nint\nnodeListDevices(virConnectPtr conn,\n                const char *cap,\n                char **const names,\n                int maxnames,\n                unsigned int flags)\n{\n    if (virNodeListDevicesEnsureACL(conn) < 0)\n        return -1;\n\n    virCheckFlags(0, -1);\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    return virNodeDeviceObjListGetNames(driver->devs, conn,\n                                        virNodeListDevicesCheckACL,\n                                        cap, names, maxnames);\n}"
  },
  {
    "function_name": "nodeNumOfDevices",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "175-190",
    "snippet": "int\nnodeNumOfDevices(virConnectPtr conn,\n                 const char *cap,\n                 unsigned int flags)\n{\n    if (virNodeNumOfDevicesEnsureACL(conn) < 0)\n        return -1;\n\n    virCheckFlags(0, -1);\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    return virNodeDeviceObjListNumOfDevices(driver->devs, conn, cap,\n                                            virNodeNumOfDevicesCheckACL);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virNodeDeviceObjListNumOfDevices",
          "args": [
            "driver->devs",
            "conn",
            "cap",
            "virNodeNumOfDevicesCheckACL"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "virNodeDeviceObjListNumOfDevices",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/conf/virnodedeviceobj.c",
          "lines": "716-730",
          "snippet": "int\nvirNodeDeviceObjListNumOfDevices(virNodeDeviceObjListPtr devs,\n                                 virConnectPtr conn,\n                                 const char *cap,\n                                 virNodeDeviceObjListFilter filter)\n{\n    struct virNodeDeviceCountData data = {\n        .conn = conn, .filter = filter, .matchstr = cap, .count = 0 };\n\n    virObjectRWLockRead(devs);\n    virHashForEach(devs->objs, virNodeDeviceObjListNumOfDevicesCallback, &data);\n    virObjectRWUnlock(devs);\n\n    return data.count;\n}",
          "includes": [
            "#include \"virstring.h\"",
            "#include \"virlog.h\"",
            "#include \"virhash.h\"",
            "#include \"virerror.h\"",
            "#include \"virnodedeviceobj.h\"",
            "#include \"viralloc.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"datatypes.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virstring.h\"\n#include \"virlog.h\"\n#include \"virhash.h\"\n#include \"virerror.h\"\n#include \"virnodedeviceobj.h\"\n#include \"viralloc.h\"\n#include \"node_device_conf.h\"\n#include \"datatypes.h\"\n#include <config.h>\n\nint\nvirNodeDeviceObjListNumOfDevices(virNodeDeviceObjListPtr devs,\n                                 virConnectPtr conn,\n                                 const char *cap,\n                                 virNodeDeviceObjListFilter filter)\n{\n    struct virNodeDeviceCountData data = {\n        .conn = conn, .filter = filter, .matchstr = cap, .count = 0 };\n\n    virObjectRWLockRead(devs);\n    virHashForEach(devs->objs, virNodeDeviceObjListNumOfDevicesCallback, &data);\n    virObjectRWUnlock(devs);\n\n    return data.count;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceWaitInit",
          "args": [],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceWaitInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "159-173",
          "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "0",
            "-1"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virNodeNumOfDevicesEnsureACL",
          "args": [
            "conn"
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nint\nnodeNumOfDevices(virConnectPtr conn,\n                 const char *cap,\n                 unsigned int flags)\n{\n    if (virNodeNumOfDevicesEnsureACL(conn) < 0)\n        return -1;\n\n    virCheckFlags(0, -1);\n\n    if (nodeDeviceWaitInit() < 0)\n        return -1;\n\n    return virNodeDeviceObjListNumOfDevices(driver->devs, conn, cap,\n                                            virNodeNumOfDevicesCheckACL);\n}"
  },
  {
    "function_name": "nodeDeviceWaitInit",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "159-173",
    "snippet": "static int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "nodeDeviceUnlock",
          "args": [],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "152-156",
          "snippet": "void\nnodeDeviceUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nvoid\nnodeDeviceUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "\"%s\"",
            "_(\"failed to wait on condition\")"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"failed to wait on condition\""
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "dev_refresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "493-509",
          "snippet": "static void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCondWait",
          "args": [
            "&driver->initCond",
            "&driver->lock"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "virCondWait",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "145-153",
          "snippet": "int virCondWait(virCondPtr c, virMutexPtr m)\n{\n    int ret;\n    if ((ret = pthread_cond_wait(&c->cond, &m->lock)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nint virCondWait(virCondPtr c, virMutexPtr m)\n{\n    int ret;\n    if ((ret = pthread_cond_wait(&c->cond, &m->lock)) != 0) {\n        errno = ret;\n        return -1;\n    }\n    return 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "nodeDeviceLock",
          "args": [],
          "line": 162
        },
        "resolved": true,
        "details": {
          "function_name": "nodeDeviceLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
          "lines": "145-149",
          "snippet": "void\nnodeDeviceLock(void)\n{\n    virMutexLock(&driver->lock);\n}",
          "includes": [
            "#include \"virutil.h\"",
            "#include \"virnetdev.h\"",
            "#include \"viraccessapicheck.h\"",
            "#include \"virvhba.h\"",
            "#include \"node_device_util.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_event.h\"",
            "#include \"node_device_conf.h\"",
            "#include \"virstring.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"virerror.h\"",
            "#include <time.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "virNodeDeviceDriverStatePtr driver;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nvoid\nnodeDeviceLock(void)\n{\n    virMutexLock(&driver->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceWaitInit(void)\n{\n    nodeDeviceLock();\n    while (!driver->initialized) {\n        if (virCondWait(&driver->initCond, &driver->lock) < 0) {\n            virReportSystemError(errno, \"%s\",\n                                 _(\"failed to wait on condition\"));\n            nodeDeviceUnlock();\n            return -1;\n        }\n    }\n    nodeDeviceUnlock();\n    return 0;\n}"
  },
  {
    "function_name": "nodeDeviceUnlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "152-156",
    "snippet": "void\nnodeDeviceUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexUnlock",
          "args": [
            "&driver->lock"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexUnlock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "86-89",
          "snippet": "void virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexUnlock(virMutexPtr m)\n{\n    pthread_mutex_unlock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nvoid\nnodeDeviceUnlock(void)\n{\n    virMutexUnlock(&driver->lock);\n}"
  },
  {
    "function_name": "nodeDeviceLock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "145-149",
    "snippet": "void\nnodeDeviceLock(void)\n{\n    virMutexLock(&driver->lock);\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virMutexLock",
          "args": [
            "&driver->lock"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "virMutexLock",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virthread.c",
          "lines": "81-84",
          "snippet": "void virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}",
          "includes": [
            "#include \"virthreadjob.h\"",
            "#include \"viralloc.h\"",
            "# include <sys/syscall.h>",
            "#include <inttypes.h>",
            "#include <unistd.h>",
            "# include <pthread_np.h>",
            "#include \"virthread.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virthreadjob.h\"\n#include \"viralloc.h\"\n# include <sys/syscall.h>\n#include <inttypes.h>\n#include <unistd.h>\n# include <pthread_np.h>\n#include \"virthread.h\"\n#include <config.h>\n\nvoid virMutexLock(virMutexPtr m)\n{\n    pthread_mutex_lock(&m->lock);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nvoid\nnodeDeviceLock(void)\n{\n    virMutexLock(&driver->lock);\n}"
  },
  {
    "function_name": "nodeDeviceUpdateDriverName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "137-141",
    "snippet": "static int\nnodeDeviceUpdateDriverName(virNodeDeviceDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nstatic int\nnodeDeviceUpdateDriverName(virNodeDeviceDefPtr def G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "nodeDeviceUpdateDriverName",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "107-134",
    "snippet": "static int\nnodeDeviceUpdateDriverName(virNodeDeviceDefPtr def)\n{\n    g_autofree char *driver_link = NULL;\n    g_autofree char *devpath = NULL;\n    char *p;\n\n    VIR_FREE(def->driver);\n\n    driver_link = g_strdup_printf(\"%s/driver\", def->sysfs_path);\n\n    /* Some devices don't have an explicit driver, so just return\n       without a name */\n    if (access(driver_link, R_OK) < 0)\n        return 0;\n\n    if (virFileResolveLink(driver_link, &devpath) < 0) {\n        virReportSystemError(errno,\n                             _(\"cannot resolve driver link %s\"), driver_link);\n        return -1;\n    }\n\n    p = strrchr(devpath, '/');\n    if (p)\n        def->driver = g_strdup(p + 1);\n\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "g_strdup",
          "args": [
            "p + 1"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "vir_g_strdup_printf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/glibcompat.c",
          "lines": "191-202",
          "snippet": "char *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}",
          "includes": [
            "#include \"glibcompat.h\"",
            "#include <unistd.h>",
            "#include <string.h>",
            "#include <stdlib.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"glibcompat.h\"\n#include <unistd.h>\n#include <string.h>\n#include <stdlib.h>\n#include <config.h>\n\nchar *\nvir_g_strdup_printf(const char *msg, ...)\n{\n    va_list args;\n    char *ret;\n    va_start(args, msg);\n    ret = g_strdup_vprintf(msg, args);\n    if (!ret)\n        abort();\n    va_end(args);\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strrchr",
          "args": [
            "devpath",
            "'/'"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virReportSystemError",
          "args": [
            "errno",
            "_(\"cannot resolve driver link %s\")",
            "driver_link"
          ],
          "line": 124
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"cannot resolve driver link %s\""
          ],
          "line": 125
        },
        "resolved": true,
        "details": {
          "function_name": "dev_refresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "493-509",
          "snippet": "static void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virFileResolveLink",
          "args": [
            "driver_link",
            "&devpath"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "virFileResolveLink",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/util/virfile.c",
          "lines": "1608-1612",
          "snippet": "int\nvirFileResolveLink(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, false, resultpath);\n}",
          "includes": [
            "#include \"virsocket.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virprocess.h\"",
            "#include \"virlog.h\"",
            "#include \"virkmod.h\"",
            "#include \"virfile.h\"",
            "#include \"virerror.h\"",
            "#include \"vircommand.h\"",
            "#include \"viralloc.h\"",
            "#include \"configmake.h\"",
            "# include <sys/xattr.h>",
            "# include <linux/cdrom.h>",
            "# include <sys/ioctl.h>",
            "#  include <linux/loop.h>",
            "# include <sys/statfs.h>",
            "#  include <linux/magic.h>",
            "#include <sys/file.h>",
            "# include <sys/acl.h>",
            "# include <sys/syscall.h>",
            "# include <sys/mman.h>",
            "# include <mntent.h>",
            "#include <dirent.h>",
            "#include <unistd.h>",
            "# include <sys/mount.h>",
            "#include <sys/stat.h>",
            "# include <libutil.h>",
            "# include <util.h>",
            "# include <pty.h>",
            "# include <termios.h>",
            "#include <fcntl.h>",
            "#include \"internal.h\"",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"virsocket.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virprocess.h\"\n#include \"virlog.h\"\n#include \"virkmod.h\"\n#include \"virfile.h\"\n#include \"virerror.h\"\n#include \"vircommand.h\"\n#include \"viralloc.h\"\n#include \"configmake.h\"\n# include <sys/xattr.h>\n# include <linux/cdrom.h>\n# include <sys/ioctl.h>\n#  include <linux/loop.h>\n# include <sys/statfs.h>\n#  include <linux/magic.h>\n#include <sys/file.h>\n# include <sys/acl.h>\n# include <sys/syscall.h>\n# include <sys/mman.h>\n# include <mntent.h>\n#include <dirent.h>\n#include <unistd.h>\n# include <sys/mount.h>\n#include <sys/stat.h>\n# include <libutil.h>\n# include <util.h>\n# include <pty.h>\n# include <termios.h>\n#include <fcntl.h>\n#include \"internal.h\"\n#include <config.h>\n\nint\nvirFileResolveLink(const char *linkpath, char **resultpath)\n{\n    return virFileResolveLinkHelper(linkpath, false, resultpath);\n}"
        }
      },
      {
        "call_info": {
          "callee": "access",
          "args": [
            "driver_link",
            "R_OK"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "VIR_FREE",
          "args": [
            "def->driver"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nstatic int\nnodeDeviceUpdateDriverName(virNodeDeviceDefPtr def)\n{\n    g_autofree char *driver_link = NULL;\n    g_autofree char *devpath = NULL;\n    char *p;\n\n    VIR_FREE(def->driver);\n\n    driver_link = g_strdup_printf(\"%s/driver\", def->sysfs_path);\n\n    /* Some devices don't have an explicit driver, so just return\n       without a name */\n    if (access(driver_link, R_OK) < 0)\n        return 0;\n\n    if (virFileResolveLink(driver_link, &devpath) < 0) {\n        virReportSystemError(errno,\n                             _(\"cannot resolve driver link %s\"), driver_link);\n        return -1;\n    }\n\n    p = strrchr(devpath, '/');\n    if (p)\n        def->driver = g_strdup(p + 1);\n\n    return 0;\n}"
  },
  {
    "function_name": "nodeConnectIsAlive",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "93-96",
    "snippet": "int nodeConnectIsAlive(virConnectPtr conn G_GNUC_UNUSED)\n{\n    return 1;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint nodeConnectIsAlive(virConnectPtr conn G_GNUC_UNUSED)\n{\n    return 1;\n}"
  },
  {
    "function_name": "nodeConnectIsEncrypted",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "86-90",
    "snippet": "int nodeConnectIsEncrypted(virConnectPtr conn G_GNUC_UNUSED)\n{\n    /* Not encrypted, but remote driver takes care of that */\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nint nodeConnectIsEncrypted(virConnectPtr conn G_GNUC_UNUSED)\n{\n    /* Not encrypted, but remote driver takes care of that */\n    return 0;\n}"
  },
  {
    "function_name": "nodeConnectIsSecure",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "79-83",
    "snippet": "int nodeConnectIsSecure(virConnectPtr conn G_GNUC_UNUSED)\n{\n    /* Trivially secure, since always inside the daemon */\n    return 1;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint nodeConnectIsSecure(virConnectPtr conn G_GNUC_UNUSED)\n{\n    /* Trivially secure, since always inside the daemon */\n    return 1;\n}"
  },
  {
    "function_name": "nodeConnectClose",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "73-76",
    "snippet": "int nodeConnectClose(virConnectPtr conn G_GNUC_UNUSED)\n{\n    return 0;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nint nodeConnectClose(virConnectPtr conn G_GNUC_UNUSED)\n{\n    return 0;\n}"
  },
  {
    "function_name": "nodeConnectOpen",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_driver.c",
    "lines": "48-71",
    "snippet": "virDrvOpenStatus\nnodeConnectOpen(virConnectPtr conn,\n                virConnectAuthPtr auth G_GNUC_UNUSED,\n                virConfPtr conf G_GNUC_UNUSED,\n                unsigned int flags)\n{\n    virCheckFlags(VIR_CONNECT_RO, VIR_DRV_OPEN_ERROR);\n\n    if (driver == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"nodedev state driver is not active\"));\n        return VIR_DRV_OPEN_ERROR;\n    }\n\n    if (!virConnectValidateURIPath(conn->uri->path,\n                                   \"nodedev\",\n                                   driver->privileged))\n        return VIR_DRV_OPEN_ERROR;\n\n    if (virConnectOpenEnsureACL(conn) < 0)\n        return VIR_DRV_OPEN_ERROR;\n\n    return VIR_DRV_OPEN_SUCCESS;\n}",
    "includes": [
      "#include \"virutil.h\"",
      "#include \"virnetdev.h\"",
      "#include \"viraccessapicheck.h\"",
      "#include \"virvhba.h\"",
      "#include \"node_device_util.h\"",
      "#include \"node_device_hal.h\"",
      "#include \"node_device_driver.h\"",
      "#include \"node_device_event.h\"",
      "#include \"node_device_conf.h\"",
      "#include \"virstring.h\"",
      "#include \"virfile.h\"",
      "#include \"viralloc.h\"",
      "#include \"datatypes.h\"",
      "#include \"virerror.h\"",
      "#include <time.h>",
      "#include <fcntl.h>",
      "#include <unistd.h>",
      "#include <config.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "virNodeDeviceDriverStatePtr driver;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "virConnectOpenEnsureACL",
          "args": [
            "conn"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "virConnectValidateURIPath",
          "args": [
            "conn->uri->path",
            "\"nodedev\"",
            "driver->privileged"
          ],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "virConnectValidateURIPath",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/driver.c",
          "lines": "260-296",
          "snippet": "bool\nvirConnectValidateURIPath(const char *uriPath,\n                          const char *entityName,\n                          bool privileged)\n{\n    if (privileged) {\n        /* TODO: qemu and vbox drivers allow '/session'\n         * connections as root. This is not ideal, but changing\n         * these drivers to refuse privileged '/session'\n         * connections, like everyone else is already doing, can\n         * break existing applications. Until we decide what to do,\n         * for now we can handle them as exception in this validate\n         * function.\n         */\n        bool compatSessionRoot = (STREQ(entityName, \"qemu\") ||\n                                  STREQ(entityName, \"vbox\")) &&\n                                  STREQ(uriPath, \"/session\");\n\n        if (STRNEQ(uriPath, \"/system\") && !compatSessionRoot) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///system\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    } else {\n        if (STRNEQ(uriPath, \"/session\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///session\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    }\n\n    return true;\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virthread.h\"",
            "#include \"virstring.h\"",
            "#include \"virmodule.h\"",
            "#include \"virlog.h\"",
            "#include \"virfile.h\"",
            "#include \"viralloc.h\"",
            "#include \"driver.h\"",
            "#include <unistd.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virthread.h\"\n#include \"virstring.h\"\n#include \"virmodule.h\"\n#include \"virlog.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"driver.h\"\n#include <unistd.h>\n#include <config.h>\n\nbool\nvirConnectValidateURIPath(const char *uriPath,\n                          const char *entityName,\n                          bool privileged)\n{\n    if (privileged) {\n        /* TODO: qemu and vbox drivers allow '/session'\n         * connections as root. This is not ideal, but changing\n         * these drivers to refuse privileged '/session'\n         * connections, like everyone else is already doing, can\n         * break existing applications. Until we decide what to do,\n         * for now we can handle them as exception in this validate\n         * function.\n         */\n        bool compatSessionRoot = (STREQ(entityName, \"qemu\") ||\n                                  STREQ(entityName, \"vbox\")) &&\n                                  STREQ(uriPath, \"/session\");\n\n        if (STRNEQ(uriPath, \"/system\") && !compatSessionRoot) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///system\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    } else {\n        if (STRNEQ(uriPath, \"/session\")) {\n            virReportError(VIR_ERR_INTERNAL_ERROR,\n                           _(\"unexpected %s URI path '%s', try \"\n                             \"%s:///session\"),\n                           entityName, uriPath, entityName);\n            return false;\n        }\n    }\n\n    return true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "virReportError",
          "args": [
            "VIR_ERR_INTERNAL_ERROR",
            "\"%s\"",
            "_(\"nodedev state driver is not active\")"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "_",
          "args": [
            "\"nodedev state driver is not active\""
          ],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "dev_refresh",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_c/CVE-2020-10701/repo/src/node_device/node_device_hal.c",
          "lines": "493-509",
          "snippet": "static void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}",
          "includes": [
            "#include \"configmake.h\"",
            "#include \"virutil.h\"",
            "#include \"virstring.h\"",
            "#include \"virdbus.h\"",
            "#include \"virlog.h\"",
            "#include \"virpidfile.h\"",
            "#include \"virpci.h\"",
            "#include \"virfile.h\"",
            "#include \"viruuid.h\"",
            "#include \"viralloc.h\"",
            "#include \"datatypes.h\"",
            "#include \"driver.h\"",
            "#include \"virerror.h\"",
            "#include \"node_device_hal.h\"",
            "#include \"node_device_driver.h\"",
            "#include \"node_device_conf.h\"",
            "#include <libhal.h>",
            "#include <config.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"configmake.h\"\n#include \"virutil.h\"\n#include \"virstring.h\"\n#include \"virdbus.h\"\n#include \"virlog.h\"\n#include \"virpidfile.h\"\n#include \"virpci.h\"\n#include \"virfile.h\"\n#include \"viruuid.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"driver.h\"\n#include \"virerror.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_conf.h\"\n#include <libhal.h>\n#include <config.h>\n\nstatic void\ndev_refresh(const char *udi)\n{\n    const char *name = hal_name(udi);\n    virNodeDeviceObjPtr obj;\n\n    if ((obj = virNodeDeviceObjListFindByName(driver->devs, name))) {\n        /* Simply \"rediscover\" device -- incrementally handling changes\n         * to sub-capabilities (like net.80203) is nasty ... so avoid it.\n         */\n        virNodeDeviceObjListRemove(driver->devs, obj);\n        virObjectUnref(obj);\n        dev_create(udi);\n    } else {\n        VIR_DEBUG(\"no device named %s\", name);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "virCheckFlags",
          "args": [
            "VIR_CONNECT_RO",
            "VIR_DRV_OPEN_ERROR"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"virutil.h\"\n#include \"virnetdev.h\"\n#include \"viraccessapicheck.h\"\n#include \"virvhba.h\"\n#include \"node_device_util.h\"\n#include \"node_device_hal.h\"\n#include \"node_device_driver.h\"\n#include \"node_device_event.h\"\n#include \"node_device_conf.h\"\n#include \"virstring.h\"\n#include \"virfile.h\"\n#include \"viralloc.h\"\n#include \"datatypes.h\"\n#include \"virerror.h\"\n#include <time.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <config.h>\n\nvirNodeDeviceDriverStatePtr driver;\n\nvirDrvOpenStatus\nnodeConnectOpen(virConnectPtr conn,\n                virConnectAuthPtr auth G_GNUC_UNUSED,\n                virConfPtr conf G_GNUC_UNUSED,\n                unsigned int flags)\n{\n    virCheckFlags(VIR_CONNECT_RO, VIR_DRV_OPEN_ERROR);\n\n    if (driver == NULL) {\n        virReportError(VIR_ERR_INTERNAL_ERROR, \"%s\",\n                       _(\"nodedev state driver is not active\"));\n        return VIR_DRV_OPEN_ERROR;\n    }\n\n    if (!virConnectValidateURIPath(conn->uri->path,\n                                   \"nodedev\",\n                                   driver->privileged))\n        return VIR_DRV_OPEN_ERROR;\n\n    if (virConnectOpenEnsureACL(conn) < 0)\n        return VIR_DRV_OPEN_ERROR;\n\n    return VIR_DRV_OPEN_SUCCESS;\n}"
  }
]